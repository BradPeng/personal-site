/*! For license information please see main.3e0cb181.js.LICENSE.txt */
(()=>{var e={3803:(e,t,n)=>{"use strict";n.d(t,{A:()=>oe});var i=function(){function e(e){var t=this;this._insertTag=function(e){var n;n=0===t.tags.length?t.insertionPoint?t.insertionPoint.nextSibling:t.prepend?t.container.firstChild:t.before:t.tags[t.tags.length-1].nextSibling,t.container.insertBefore(e,n),t.tags.push(e)},this.isSpeedy=void 0===e.speedy||e.speedy,this.tags=[],this.ctr=0,this.nonce=e.nonce,this.key=e.key,this.container=e.container,this.prepend=e.prepend,this.insertionPoint=e.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(e){e.forEach(this._insertTag)},t.insert=function(e){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(function(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),void 0!==e.nonce&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}(this));var t=this.tags[this.tags.length-1];if(this.isSpeedy){var n=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}(t);try{n.insertRule(e,n.cssRules.length)}catch(i){}}else t.appendChild(document.createTextNode(e));this.ctr++},t.flush=function(){this.tags.forEach((function(e){var t;return null==(t=e.parentNode)?void 0:t.removeChild(e)})),this.tags=[],this.ctr=0},e}(),o=Math.abs,r=String.fromCharCode,a=Object.assign;function s(e){return e.trim()}function g(e,t,n){return e.replace(t,n)}function l(e,t){return e.indexOf(t)}function c(e,t){return 0|e.charCodeAt(t)}function I(e,t,n){return e.slice(t,n)}function C(e){return e.length}function u(e){return e.length}function d(e,t){return t.push(e),e}var h=1,A=1,p=0,m=0,b=0,f="";function y(e,t,n,i,o,r,a){return{value:e,root:t,parent:n,type:i,props:o,children:r,line:h,column:A,length:a,return:""}}function G(e,t){return a(y("",null,null,"",null,null,0),e,{length:-e.length},t)}function v(){return b=m>0?c(f,--m):0,A--,10===b&&(A=1,h--),b}function B(){return b=m<p?c(f,m++):0,A++,10===b&&(A=1,h++),b}function Z(){return c(f,m)}function w(){return m}function W(e,t){return I(f,e,t)}function S(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function R(e){return h=A=1,p=C(f=e),m=0,[]}function x(e){return f="",e}function V(e){return s(W(m-1,Y(91===e?e+2:40===e?e+1:e)))}function X(e){for(;(b=Z())&&b<33;)B();return S(e)>2||S(b)>3?"":" "}function H(e,t){for(;--t&&B()&&!(b<48||b>102||b>57&&b<65||b>70&&b<97););return W(e,w()+(t<6&&32==Z()&&32==B()))}function Y(e){for(;B();)switch(b){case e:return m;case 34:case 39:34!==e&&39!==e&&Y(b);break;case 40:41===e&&Y(e);break;case 92:B()}return m}function K(e,t){for(;B()&&e+b!==57&&(e+b!==84||47!==Z()););return"/*"+W(t,m-1)+"*"+r(47===e?e:B())}function N(e){for(;!S(Z());)B();return W(e,m)}var M="-ms-",F="-moz-",k="-webkit-",z="comm",L="rule",T="decl",E="@keyframes";function J(e,t){for(var n="",i=u(e),o=0;o<i;o++)n+=t(e[o],o,e,t)||"";return n}function U(e,t,n,i){switch(e.type){case"@layer":if(e.children.length)break;case"@import":case T:return e.return=e.return||e.value;case z:return"";case E:return e.return=e.value+"{"+J(e.children,i)+"}";case L:e.value=e.props.join(",")}return C(n=J(e.children,i))?e.return=e.value+"{"+n+"}":""}function D(e){return x(P("",null,null,null,[""],e=R(e),0,[0],e))}function P(e,t,n,i,o,a,s,I,u){for(var h=0,A=0,p=s,m=0,b=0,f=0,y=1,G=1,W=1,S=0,R="",x=o,Y=a,M=i,F=R;G;)switch(f=S,S=B()){case 40:if(108!=f&&58==c(F,p-1)){-1!=l(F+=g(V(S),"&","&\f"),"&\f")&&(W=-1);break}case 34:case 39:case 91:F+=V(S);break;case 9:case 10:case 13:case 32:F+=X(f);break;case 92:F+=H(w()-1,7);continue;case 47:switch(Z()){case 42:case 47:d(_(K(B(),w()),t,n),u);break;default:F+="/"}break;case 123*y:I[h++]=C(F)*W;case 125*y:case 59:case 0:switch(S){case 0:case 125:G=0;case 59+A:-1==W&&(F=g(F,/\f/g,"")),b>0&&C(F)-p&&d(b>32?j(F+";",i,n,p-1):j(g(F," ","")+";",i,n,p-2),u);break;case 59:F+=";";default:if(d(M=Q(F,t,n,h,A,o,I,R,x=[],Y=[],p),a),123===S)if(0===A)P(F,t,M,M,x,a,p,I,Y);else switch(99===m&&110===c(F,3)?100:m){case 100:case 108:case 109:case 115:P(e,M,M,i&&d(Q(e,M,M,0,0,o,I,R,o,x=[],p),Y),o,Y,p,I,i?x:Y);break;default:P(F,M,M,M,[""],Y,0,I,Y)}}h=A=b=0,y=W=1,R=F="",p=s;break;case 58:p=1+C(F),b=f;default:if(y<1)if(123==S)--y;else if(125==S&&0==y++&&125==v())continue;switch(F+=r(S),S*y){case 38:W=A>0?1:(F+="\f",-1);break;case 44:I[h++]=(C(F)-1)*W,W=1;break;case 64:45===Z()&&(F+=V(B())),m=Z(),A=p=C(R=F+=N(w())),S++;break;case 45:45===f&&2==C(F)&&(y=0)}}return a}function Q(e,t,n,i,r,a,l,c,C,d,h){for(var A=r-1,p=0===r?a:[""],m=u(p),b=0,f=0,G=0;b<i;++b)for(var v=0,B=I(e,A+1,A=o(f=l[b])),Z=e;v<m;++v)(Z=s(f>0?p[v]+" "+B:g(B,/&\f/g,p[v])))&&(C[G++]=Z);return y(e,t,n,0===r?L:c,C,d,h)}function _(e,t,n){return y(e,t,n,z,r(b),I(e,2,-2),0)}function j(e,t,n,i){return y(e,t,n,T,I(e,0,i),I(e,i+1,-1),i)}var O=function(e,t,n){for(var i=0,o=0;i=o,o=Z(),38===i&&12===o&&(t[n]=1),!S(o);)B();return W(e,m)},q=function(e,t){return x(function(e,t){var n=-1,i=44;do{switch(S(i)){case 0:38===i&&12===Z()&&(t[n]=1),e[n]+=O(m-1,t,n);break;case 2:e[n]+=V(i);break;case 4:if(44===i){e[++n]=58===Z()?"&\f":"",t[n]=e[n].length;break}default:e[n]+=r(i)}}while(i=B());return e}(R(e),t))},$=new WeakMap,ee=function(e){if("rule"===e.type&&e.parent&&!(e.length<1)){for(var t=e.value,n=e.parent,i=e.column===n.column&&e.line===n.line;"rule"!==n.type;)if(!(n=n.parent))return;if((1!==e.props.length||58===t.charCodeAt(0)||$.get(n))&&!i){$.set(e,!0);for(var o=[],r=q(t,o),a=n.props,s=0,g=0;s<r.length;s++)for(var l=0;l<a.length;l++,g++)e.props[g]=o[s]?r[s].replace(/&\f/g,a[l]):a[l]+" "+r[s]}}},te=function(e){if("decl"===e.type){var t=e.value;108===t.charCodeAt(0)&&98===t.charCodeAt(2)&&(e.return="",e.value="")}};function ne(e,t){switch(function(e,t){return 45^c(e,0)?(((t<<2^c(e,0))<<2^c(e,1))<<2^c(e,2))<<2^c(e,3):0}(e,t)){case 5103:return k+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return k+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return k+e+F+e+M+e+e;case 6828:case 4268:return k+e+M+e+e;case 6165:return k+e+M+"flex-"+e+e;case 5187:return k+e+g(e,/(\w+).+(:[^]+)/,k+"box-$1$2"+M+"flex-$1$2")+e;case 5443:return k+e+M+"flex-item-"+g(e,/flex-|-self/,"")+e;case 4675:return k+e+M+"flex-line-pack"+g(e,/align-content|flex-|-self/,"")+e;case 5548:return k+e+M+g(e,"shrink","negative")+e;case 5292:return k+e+M+g(e,"basis","preferred-size")+e;case 6060:return k+"box-"+g(e,"-grow","")+k+e+M+g(e,"grow","positive")+e;case 4554:return k+g(e,/([^-])(transform)/g,"$1"+k+"$2")+e;case 6187:return g(g(g(e,/(zoom-|grab)/,k+"$1"),/(image-set)/,k+"$1"),e,"")+e;case 5495:case 3959:return g(e,/(image-set\([^]*)/,k+"$1$`$1");case 4968:return g(g(e,/(.+:)(flex-)?(.*)/,k+"box-pack:$3"+M+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+k+e+e;case 4095:case 3583:case 4068:case 2532:return g(e,/(.+)-inline(.+)/,k+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(C(e)-1-t>6)switch(c(e,t+1)){case 109:if(45!==c(e,t+4))break;case 102:return g(e,/(.+:)(.+)-([^]+)/,"$1"+k+"$2-$3$1"+F+(108==c(e,t+3)?"$3":"$2-$3"))+e;case 115:return~l(e,"stretch")?ne(g(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(115!==c(e,t+1))break;case 6444:switch(c(e,C(e)-3-(~l(e,"!important")&&10))){case 107:return g(e,":",":"+k)+e;case 101:return g(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+k+(45===c(e,14)?"inline-":"")+"box$3$1"+k+"$2$3$1"+M+"$2box$3")+e}break;case 5936:switch(c(e,t+11)){case 114:return k+e+M+g(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return k+e+M+g(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return k+e+M+g(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return k+e+M+e+e}return e}var ie=[function(e,t,n,i){if(e.length>-1&&!e.return)switch(e.type){case T:e.return=ne(e.value,e.length);break;case E:return J([G(e,{value:g(e.value,"@","@"+k)})],i);case L:if(e.length)return function(e,t){return e.map(t).join("")}(e.props,(function(t){switch(function(e,t){return(e=t.exec(e))?e[0]:e}(t,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return J([G(e,{props:[g(t,/:(read-\w+)/,":-moz-$1")]})],i);case"::placeholder":return J([G(e,{props:[g(t,/:(plac\w+)/,":"+k+"input-$1")]}),G(e,{props:[g(t,/:(plac\w+)/,":-moz-$1")]}),G(e,{props:[g(t,/:(plac\w+)/,M+"input-$1")]})],i)}return""}))}}],oe=function(e){var t=e.key;if("css"===t){var n=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(n,(function(e){-1!==e.getAttribute("data-emotion").indexOf(" ")&&(document.head.appendChild(e),e.setAttribute("data-s",""))}))}var o,r,a=e.stylisPlugins||ie,s={},g=[];o=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),(function(e){for(var t=e.getAttribute("data-emotion").split(" "),n=1;n<t.length;n++)s[t[n]]=!0;g.push(e)}));var l,c,I=[U,(c=function(e){l.insert(e)},function(e){e.root||(e=e.return)&&c(e)})],C=function(e){var t=u(e);return function(n,i,o,r){for(var a="",s=0;s<t;s++)a+=e[s](n,i,o,r)||"";return a}}([ee,te].concat(a,I));r=function(e,t,n,i){l=n,J(D(e?e+"{"+t.styles+"}":t.styles),C),i&&(d.inserted[t.name]=!0)};var d={key:t,sheet:new i({key:t,container:o,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:s,registered:{},insert:r};return d.sheet.hydrate(g),d}},918:(e,t,n)=>{"use strict";function i(e){var t=Object.create(null);return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}}n.d(t,{A:()=>i})},4575:(e,t,n)=>{"use strict";n.d(t,{C:()=>a,T:()=>g,w:()=>s});var i=n(5043),o=n(3803),r=(n(6598),n(9436),i.createContext("undefined"!==typeof HTMLElement?(0,o.A)({key:"css"}):null)),a=r.Provider,s=function(e){return(0,i.forwardRef)((function(t,n){var o=(0,i.useContext)(r);return e(t,o,n)}))},g=i.createContext({})},3290:(e,t,n)=>{"use strict";n.d(t,{AH:()=>l,i7:()=>c,mL:()=>g});var i=n(4575),o=n(5043),r=n(1722),a=n(9436),s=n(6598),g=(n(3803),n(219),(0,i.w)((function(e,t){var n=e.styles,g=(0,s.J)([n],void 0,o.useContext(i.T)),l=o.useRef();return(0,a.i)((function(){var e=t.key+"-global",n=new t.sheet.constructor({key:e,nonce:t.sheet.nonce,container:t.sheet.container,speedy:t.sheet.isSpeedy}),i=!1,o=document.querySelector('style[data-emotion="'+e+" "+g.name+'"]');return t.sheet.tags.length&&(n.before=t.sheet.tags[0]),null!==o&&(i=!0,o.setAttribute("data-emotion",e),n.hydrate([o])),l.current=[n,i],function(){n.flush()}}),[t]),(0,a.i)((function(){var e=l.current,n=e[0];if(e[1])e[1]=!1;else{if(void 0!==g.next&&(0,r.sk)(t,g.next,!0),n.tags.length){var i=n.tags[n.tags.length-1].nextElementSibling;n.before=i,n.flush()}t.insert("",g,n,!1)}}),[t,g.name]),null})));function l(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,s.J)(t)}var c=function(){var e=l.apply(void 0,arguments),t="animation-"+e.name;return{name:t,styles:"@keyframes "+t+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}},6598:(e,t,n)=>{"use strict";n.d(t,{J:()=>A});var i={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},o=n(918),r=!1,a=/[A-Z]|^ms/g,s=/_EMO_([^_]+?)_([^]*?)_EMO_/g,g=function(e){return 45===e.charCodeAt(1)},l=function(e){return null!=e&&"boolean"!==typeof e},c=(0,o.A)((function(e){return g(e)?e:e.replace(a,"-$&").toLowerCase()})),I=function(e,t){switch(e){case"animation":case"animationName":if("string"===typeof t)return t.replace(s,(function(e,t,n){return d={name:t,styles:n,next:d},t}))}return 1===i[e]||g(e)||"number"!==typeof t||0===t?t:t+"px"},C="Component selectors can only be used in conjunction with @emotion/babel-plugin, the swc Emotion plugin, or another Emotion-aware compiler transform.";function u(e,t,n){if(null==n)return"";var i=n;if(void 0!==i.__emotion_styles)return i;switch(typeof n){case"boolean":return"";case"object":var o=n;if(1===o.anim)return d={name:o.name,styles:o.styles,next:d},o.name;var a=n;if(void 0!==a.styles){var s=a.next;if(void 0!==s)for(;void 0!==s;)d={name:s.name,styles:s.styles,next:d},s=s.next;return a.styles+";"}return function(e,t,n){var i="";if(Array.isArray(n))for(var o=0;o<n.length;o++)i+=u(e,t,n[o])+";";else for(var a in n){var s=n[a];if("object"!==typeof s){var g=s;null!=t&&void 0!==t[g]?i+=a+"{"+t[g]+"}":l(g)&&(i+=c(a)+":"+I(a,g)+";")}else{if("NO_COMPONENT_SELECTOR"===a&&r)throw new Error(C);if(!Array.isArray(s)||"string"!==typeof s[0]||null!=t&&void 0!==t[s[0]]){var d=u(e,t,s);switch(a){case"animation":case"animationName":i+=c(a)+":"+d+";";break;default:i+=a+"{"+d+"}"}}else for(var h=0;h<s.length;h++)l(s[h])&&(i+=c(a)+":"+I(a,s[h])+";")}}return i}(e,t,n);case"function":if(void 0!==e){var g=d,h=n(e);return d=g,u(e,t,h)}}var A=n;if(null==t)return A;var p=t[A];return void 0!==p?p:A}var d,h=/label:\s*([^\s;\n{]+)\s*(;|$)/g;function A(e,t,n){if(1===e.length&&"object"===typeof e[0]&&null!==e[0]&&void 0!==e[0].styles)return e[0];var i=!0,o="";d=void 0;var r=e[0];null==r||void 0===r.raw?(i=!1,o+=u(n,t,r)):o+=r[0];for(var a=1;a<e.length;a++){if(o+=u(n,t,e[a]),i)o+=r[a]}h.lastIndex=0;for(var s,g="";null!==(s=h.exec(o));)g+="-"+s[1];var l=function(e){for(var t,n=0,i=0,o=e.length;o>=4;++i,o-=4)t=1540483477*(65535&(t=255&e.charCodeAt(i)|(255&e.charCodeAt(++i))<<8|(255&e.charCodeAt(++i))<<16|(255&e.charCodeAt(++i))<<24))+(59797*(t>>>16)<<16),n=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&n)+(59797*(n>>>16)<<16);switch(o){case 3:n^=(255&e.charCodeAt(i+2))<<16;case 2:n^=(255&e.charCodeAt(i+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(i)))+(59797*(n>>>16)<<16)}return(((n=1540483477*(65535&(n^=n>>>13))+(59797*(n>>>16)<<16))^n>>>15)>>>0).toString(36)}(o)+g;return{name:l,styles:o,next:d}}},9436:(e,t,n)=>{"use strict";var i;n.d(t,{i:()=>s,s:()=>a});var o=n(5043),r=!!(i||(i=n.t(o,2))).useInsertionEffect&&(i||(i=n.t(o,2))).useInsertionEffect,a=r||function(e){return e()},s=r||o.useLayoutEffect},1722:(e,t,n)=>{"use strict";n.d(t,{Rk:()=>i,SF:()=>o,sk:()=>r});function i(e,t,n){var i="";return n.split(" ").forEach((function(n){void 0!==e[n]?t.push(e[n]+";"):i+=n+" "})),i}var o=function(e,t,n){var i=e.key+"-"+t.name;!1===n&&void 0===e.registered[i]&&(e.registered[i]=t.styles)},r=function(e,t,n){o(e,t,n);var i=e.key+"-"+t.name;if(void 0===e.inserted[t.name]){var r=t;do{e.insert(t===r?"."+i:"",r,e.sheet,!0),r=r.next}while(void 0!==r)}}},7713:(e,t,n)=>{"use strict";n.r(t),n.d(t,{GlobalStyles:()=>v,StyledEngineProvider:()=>G,ThemeContext:()=>g.T,css:()=>m.AH,default:()=>B,internal_processStyles:()=>Z,keyframes:()=>m.i7});var i=n(8168),o=n(5043),r=n(918),a=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,s=(0,r.A)((function(e){return a.test(e)||111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)<91})),g=n(4575),l=n(1722),c=n(6598),I=n(9436),C=s,u=function(e){return"theme"!==e},d=function(e){return"string"===typeof e&&e.charCodeAt(0)>96?C:u},h=function(e,t,n){var i;if(t){var o=t.shouldForwardProp;i=e.__emotion_forwardProp&&o?function(t){return e.__emotion_forwardProp(t)&&o(t)}:o}return"function"!==typeof i&&n&&(i=e.__emotion_forwardProp),i},A=function(e){var t=e.cache,n=e.serialized,i=e.isStringTag;return(0,l.SF)(t,n,i),(0,I.s)((function(){return(0,l.sk)(t,n,i)})),null},p=function e(t,n){var r,a,s=t.__emotion_real===t,I=s&&t.__emotion_base||t;void 0!==n&&(r=n.label,a=n.target);var C=h(t,n,s),u=C||d(I),p=!u("as");return function(){var m=arguments,b=s&&void 0!==t.__emotion_styles?t.__emotion_styles.slice(0):[];if(void 0!==r&&b.push("label:"+r+";"),null==m[0]||void 0===m[0].raw)b.push.apply(b,m);else{b.push(m[0][0]);for(var f=m.length,y=1;y<f;y++)b.push(m[y],m[0][y])}var G=(0,g.w)((function(e,t,n){var i=p&&e.as||I,r="",s=[],h=e;if(null==e.theme){for(var m in h={},e)h[m]=e[m];h.theme=o.useContext(g.T)}"string"===typeof e.className?r=(0,l.Rk)(t.registered,s,e.className):null!=e.className&&(r=e.className+" ");var f=(0,c.J)(b.concat(s),t.registered,h);r+=t.key+"-"+f.name,void 0!==a&&(r+=" "+a);var y=p&&void 0===C?d(i):u,G={};for(var v in e)p&&"as"===v||y(v)&&(G[v]=e[v]);return G.className=r,n&&(G.ref=n),o.createElement(o.Fragment,null,o.createElement(A,{cache:t,serialized:f,isStringTag:"string"===typeof i}),o.createElement(i,G))}));return G.displayName=void 0!==r?r:"Styled("+("string"===typeof I?I:I.displayName||I.name||"Component")+")",G.defaultProps=t.defaultProps,G.__emotion_real=G,G.__emotion_base=I,G.__emotion_styles=b,G.__emotion_forwardProp=C,Object.defineProperty(G,"toString",{value:function(){return"."+a}}),G.withComponent=function(t,o){return e(t,(0,i.A)({},n,o,{shouldForwardProp:h(G,o,!0)})).apply(void 0,b)},G}}.bind();["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"].forEach((function(e){p[e]=p(e)}));var m=n(3290),b=n(3803),f=n(579);let y;function G(e){const{injectFirst:t,children:n}=e;return t&&y?(0,f.jsx)(g.C,{value:y,children:n}):n}function v(e){const{styles:t,defaultTheme:n={}}=e,i="function"===typeof t?e=>{return t(void 0===(i=e)||null===i||0===Object.keys(i).length?n:e);var i}:t;return(0,f.jsx)(m.mL,{styles:i})}function B(e,t){return p(e,t)}"object"===typeof document&&(y=(0,b.A)({key:"css",prepend:!0}));const Z=(e,t)=>{Array.isArray(e.__emotion_styles)&&(e.__emotion_styles=t(e.__emotion_styles))}},7266:(e,t,n)=>{"use strict";var i=n(4994);t.X4=u,t.e$=d,t.eM=function(e,t){const n=C(e),i=C(t);return(Math.max(n,i)+.05)/(Math.min(n,i)+.05)},t.a=h;var o=i(n(457)),r=i(n(9214));function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return(0,r.default)(e,t,n)}function s(e){e=e.slice(1);const t=new RegExp(`.{1,${e.length>=6?2:1}}`,"g");let n=e.match(t);return n&&1===n[0].length&&(n=n.map((e=>e+e))),n?`rgb${4===n.length?"a":""}(${n.map(((e,t)=>t<3?parseInt(e,16):Math.round(parseInt(e,16)/255*1e3)/1e3)).join(", ")})`:""}function g(e){if(e.type)return e;if("#"===e.charAt(0))return g(s(e));const t=e.indexOf("("),n=e.substring(0,t);if(-1===["rgb","rgba","hsl","hsla","color"].indexOf(n))throw new Error((0,o.default)(9,e));let i,r=e.substring(t+1,e.length-1);if("color"===n){if(r=r.split(" "),i=r.shift(),4===r.length&&"/"===r[3].charAt(0)&&(r[3]=r[3].slice(1)),-1===["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].indexOf(i))throw new Error((0,o.default)(10,i))}else r=r.split(",");return r=r.map((e=>parseFloat(e))),{type:n,values:r,colorSpace:i}}const l=e=>{const t=g(e);return t.values.slice(0,3).map(((e,n)=>-1!==t.type.indexOf("hsl")&&0!==n?`${e}%`:e)).join(" ")};function c(e){const{type:t,colorSpace:n}=e;let{values:i}=e;return-1!==t.indexOf("rgb")?i=i.map(((e,t)=>t<3?parseInt(e,10):e)):-1!==t.indexOf("hsl")&&(i[1]=`${i[1]}%`,i[2]=`${i[2]}%`),i=-1!==t.indexOf("color")?`${n} ${i.join(" ")}`:`${i.join(", ")}`,`${t}(${i})`}function I(e){e=g(e);const{values:t}=e,n=t[0],i=t[1]/100,o=t[2]/100,r=i*Math.min(o,1-o),a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e+n/30)%12;return o-r*Math.max(Math.min(t-3,9-t,1),-1)};let s="rgb";const l=[Math.round(255*a(0)),Math.round(255*a(8)),Math.round(255*a(4))];return"hsla"===e.type&&(s+="a",l.push(t[3])),c({type:s,values:l})}function C(e){let t="hsl"===(e=g(e)).type||"hsla"===e.type?g(I(e)).values:e.values;return t=t.map((t=>("color"!==e.type&&(t/=255),t<=.03928?t/12.92:((t+.055)/1.055)**2.4))),Number((.2126*t[0]+.7152*t[1]+.0722*t[2]).toFixed(3))}function u(e,t){return e=g(e),t=a(t),"rgb"!==e.type&&"hsl"!==e.type||(e.type+="a"),"color"===e.type?e.values[3]=`/${t}`:e.values[3]=t,c(e)}function d(e,t){if(e=g(e),t=a(t),-1!==e.type.indexOf("hsl"))e.values[2]*=1-t;else if(-1!==e.type.indexOf("rgb")||-1!==e.type.indexOf("color"))for(let n=0;n<3;n+=1)e.values[n]*=1-t;return c(e)}function h(e,t){if(e=g(e),t=a(t),-1!==e.type.indexOf("hsl"))e.values[2]+=(100-e.values[2])*t;else if(-1!==e.type.indexOf("rgb"))for(let n=0;n<3;n+=1)e.values[n]+=(255-e.values[n])*t;else if(-1!==e.type.indexOf("color"))for(let n=0;n<3;n+=1)e.values[n]+=(1-e.values[n])*t;return c(e)}function A(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.15;return C(e)>.5?d(e,t):h(e,t)}},8052:(e,t,n)=>{"use strict";var i=n(4994);t.Ay=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{themeId:t,defaultTheme:n=h,rootShouldForwardProp:i=d,slotShouldForwardProp:g=d}=e,c=e=>(0,l.default)((0,o.default)({},e,{theme:p((0,o.default)({},e,{defaultTheme:n,themeId:t}))}));return c.__mui_systemSx=!0,function(e){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,a.internal_processStyles)(e,(e=>e.filter((e=>!(null!=e&&e.__mui_systemSx)))));const{name:I,slot:u,skipVariantsResolver:h,skipSx:f,overridesResolver:y=m(A(u))}=l,G=(0,r.default)(l,C),v=void 0!==h?h:u&&"Root"!==u&&"root"!==u||!1,B=f||!1;let Z=d;"Root"===u||"root"===u?Z=i:u?Z=g:function(e){return"string"===typeof e&&e.charCodeAt(0)>96}(e)&&(Z=void 0);const w=(0,a.default)(e,(0,o.default)({shouldForwardProp:Z,label:undefined},G)),W=e=>"function"===typeof e&&e.__emotion_real!==e||(0,s.isPlainObject)(e)?i=>b(e,(0,o.default)({},i,{theme:p({theme:i.theme,defaultTheme:n,themeId:t})})):e,S=function(i){let r=W(i);for(var a=arguments.length,s=new Array(a>1?a-1:0),g=1;g<a;g++)s[g-1]=arguments[g];const l=s?s.map(W):[];I&&y&&l.push((e=>{const i=p((0,o.default)({},e,{defaultTheme:n,themeId:t}));if(!i.components||!i.components[I]||!i.components[I].styleOverrides)return null;const r=i.components[I].styleOverrides,a={};return Object.entries(r).forEach((t=>{let[n,r]=t;a[n]=b(r,(0,o.default)({},e,{theme:i}))})),y(e,a)})),I&&!v&&l.push((e=>{var i;const r=p((0,o.default)({},e,{defaultTheme:n,themeId:t}));return b({variants:null==r||null==(i=r.components)||null==(i=i[I])?void 0:i.variants},(0,o.default)({},e,{theme:r}))})),B||l.push(c);const C=l.length-s.length;if(Array.isArray(i)&&C>0){const e=new Array(C).fill("");r=[...i,...e],r.raw=[...i.raw,...e]}const u=w(r,...l);return e.muiName&&(u.muiName=e.muiName),u};return w.withConfig&&(S.withConfig=w.withConfig),S}};var o=i(n(4634)),r=i(n(4893)),a=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=u(t);if(n&&n.has(e))return n.get(e);var i={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if("default"!==r&&Object.prototype.hasOwnProperty.call(e,r)){var a=o?Object.getOwnPropertyDescriptor(e,r):null;a&&(a.get||a.set)?Object.defineProperty(i,r,a):i[r]=e[r]}return i.default=e,n&&n.set(e,i),i}(n(7713)),s=n(9482),g=(i(n(7918)),i(n(3382)),i(n(4989))),l=i(n(3234));const c=["ownerState"],I=["variants"],C=["name","slot","skipVariantsResolver","skipSx","overridesResolver"];function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(u=function(e){return e?n:t})(e)}function d(e){return"ownerState"!==e&&"theme"!==e&&"sx"!==e&&"as"!==e}const h=(0,g.default)(),A=e=>e?e.charAt(0).toLowerCase()+e.slice(1):e;function p(e){let{defaultTheme:t,theme:n,themeId:i}=e;return o=n,0===Object.keys(o).length?t:n[i]||n;var o}function m(e){return e?(t,n)=>n[e]:null}function b(e,t){let{ownerState:n}=t,i=(0,r.default)(t,c);const a="function"===typeof e?e((0,o.default)({ownerState:n},i)):e;if(Array.isArray(a))return a.flatMap((e=>b(e,(0,o.default)({ownerState:n},i))));if(a&&"object"===typeof a&&Array.isArray(a.variants)){const{variants:e=[]}=a;let t=(0,r.default)(a,I);return e.forEach((e=>{let r=!0;"function"===typeof e.props?r=e.props((0,o.default)({ownerState:n},i,n)):Object.keys(e.props).forEach((t=>{(null==n?void 0:n[t])!==e.props[t]&&i[t]!==e.props[t]&&(r=!1)})),r&&(Array.isArray(t)||(t=[t]),t.push("function"===typeof e.style?e.style((0,o.default)({ownerState:n},i,n)):e.style))})),t}return a}},9751:(e,t,n)=>{"use strict";n.d(t,{EU:()=>a,NI:()=>r,kW:()=>g,vf:()=>s,zu:()=>i});const i={xs:0,sm:600,md:900,lg:1200,xl:1536},o={keys:["xs","sm","md","lg","xl"],up:e=>`@media (min-width:${i[e]}px)`};function r(e,t,n){const r=e.theme||{};if(Array.isArray(t)){const e=r.breakpoints||o;return t.reduce(((i,o,r)=>(i[e.up(e.keys[r])]=n(t[r]),i)),{})}if("object"===typeof t){const e=r.breakpoints||o;return Object.keys(t).reduce(((o,r)=>{if(-1!==Object.keys(e.values||i).indexOf(r)){o[e.up(r)]=n(t[r],r)}else{const e=r;o[e]=t[e]}return o}),{})}return n(t)}function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t;return(null==(t=e.keys)?void 0:t.reduce(((t,n)=>(t[e.up(n)]={},t)),{}))||{}}function s(e,t){return e.reduce(((e,t)=>{const n=e[t];return(!n||0===Object.keys(n).length)&&delete e[t],e}),t)}function g(e){let{values:t,breakpoints:n,base:i}=e;const o=i||function(e,t){if("object"!==typeof e)return{};const n={},i=Object.keys(t);return Array.isArray(e)?i.forEach(((t,i)=>{i<e.length&&(n[t]=!0)})):i.forEach((t=>{null!=e[t]&&(n[t]=!0)})),n}(t,n),r=Object.keys(o);if(0===r.length)return t;let a;return r.reduce(((e,n,i)=>(Array.isArray(t)?(e[n]=null!=t[i]?t[i]:t[a],a=i):"object"===typeof t?(e[n]=null!=t[n]?t[n]:t[a],a=n):e[n]=t,e)),{})}},9703:(e,t,n)=>{"use strict";function i(e,t){const n=this;if(n.vars&&"function"===typeof n.getColorSchemeSelector){const i=n.getColorSchemeSelector(e).replace(/(\[[^\]]+\])/,"*:where($1)");return{[i]:t}}return n.palette.mode===e?t:{}}n.d(t,{A:()=>i})},4853:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var i=n(8587),o=n(8168);const r=["values","unit","step"],a=e=>{const t=Object.keys(e).map((t=>({key:t,val:e[t]})))||[];return t.sort(((e,t)=>e.val-t.val)),t.reduce(((e,t)=>(0,o.A)({},e,{[t.key]:t.val})),{})};function s(e){const{values:t={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:n="px",step:s=5}=e,g=(0,i.A)(e,r),l=a(t),c=Object.keys(l);function I(e){return`@media (min-width:${"number"===typeof t[e]?t[e]:e}${n})`}function C(e){return`@media (max-width:${("number"===typeof t[e]?t[e]:e)-s/100}${n})`}function u(e,i){const o=c.indexOf(i);return`@media (min-width:${"number"===typeof t[e]?t[e]:e}${n}) and (max-width:${(-1!==o&&"number"===typeof t[c[o]]?t[c[o]]:i)-s/100}${n})`}return(0,o.A)({keys:c,values:l,up:I,down:C,between:u,only:function(e){return c.indexOf(e)+1<c.length?u(e,c[c.indexOf(e)+1]):I(e)},not:function(e){const t=c.indexOf(e);return 0===t?I(c[1]):t===c.length-1?C(c[t]):u(e,c[c.indexOf(e)+1]).replace("@media","@media not all and")},unit:n},g)}},8280:(e,t,n)=>{"use strict";n.d(t,{A:()=>u});var i=n(8168),o=n(8587),r=n(9172),a=n(4853);const s={borderRadius:4};var g=n(8604);var l=n(8812),c=n(7758),I=n(9703);const C=["breakpoints","palette","spacing","shape"];const u=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{breakpoints:t={},palette:n={},spacing:u,shape:d={}}=e,h=(0,o.A)(e,C),A=(0,a.A)(t),p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;if(e.mui)return e;const t=(0,g.LX)({spacing:e}),n=function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return(0===n.length?[1]:n).map((e=>{const n=t(e);return"number"===typeof n?`${n}px`:n})).join(" ")};return n.mui=!0,n}(u);let m=(0,r.A)({breakpoints:A,direction:"ltr",components:{},palette:(0,i.A)({mode:"light"},n),spacing:p,shape:(0,i.A)({},s,d)},h);m.applyStyles=I.A;for(var b=arguments.length,f=new Array(b>1?b-1:0),y=1;y<b;y++)f[y-1]=arguments[y];return m=f.reduce(((e,t)=>(0,r.A)(e,t)),m),m.unstable_sxConfig=(0,i.A)({},c.A,null==h?void 0:h.unstable_sxConfig),m.unstable_sx=function(e){return(0,l.A)({sx:e,theme:this})},m}},4989:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i.A,private_createBreakpoints:()=>o.A,unstable_applyStyles:()=>r.A});var i=n(8280),o=n(4853),r=n(9703)},3815:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var i=n(9172);const o=function(e,t){return t?(0,i.A)(e,t,{clone:!1}):e}},8604:(e,t,n)=>{"use strict";n.d(t,{LX:()=>d,MA:()=>u,_W:()=>h,Lc:()=>m,Ms:()=>b});var i=n(9751),o=n(7162),r=n(3815);const a={m:"margin",p:"padding"},s={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},g={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},l=function(e){const t={};return n=>(void 0===t[n]&&(t[n]=e(n)),t[n])}((e=>{if(e.length>2){if(!g[e])return[e];e=g[e]}const[t,n]=e.split(""),i=a[t],o=s[n]||"";return Array.isArray(o)?o.map((e=>i+e)):[i+o]})),c=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],I=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"],C=[...c,...I];function u(e,t,n,i){var r;const a=null!=(r=(0,o.Yn)(e,t,!1))?r:n;return"number"===typeof a?e=>"string"===typeof e?e:a*e:Array.isArray(a)?e=>"string"===typeof e?e:a[e]:"function"===typeof a?a:()=>{}}function d(e){return u(e,"spacing",8)}function h(e,t){if("string"===typeof t||null==t)return t;const n=e(Math.abs(t));return t>=0?n:"number"===typeof n?-n:`-${n}`}function A(e,t,n,o){if(-1===t.indexOf(n))return null;const r=function(e,t){return n=>e.reduce(((e,i)=>(e[i]=h(t,n),e)),{})}(l(n),o),a=e[n];return(0,i.NI)(e,a,r)}function p(e,t){const n=d(e.theme);return Object.keys(e).map((i=>A(e,t,i,n))).reduce(r.A,{})}function m(e){return p(e,c)}function b(e){return p(e,I)}function f(e){return p(e,C)}m.propTypes={},m.filterProps=c,b.propTypes={},b.filterProps=I,f.propTypes={},f.filterProps=C},7162:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>s,BO:()=>a,Yn:()=>r});var i=n(7598),o=n(9751);function r(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t||"string"!==typeof t)return null;if(e&&e.vars&&n){const n=`vars.${t}`.split(".").reduce(((e,t)=>e&&e[t]?e[t]:null),e);if(null!=n)return n}return t.split(".").reduce(((e,t)=>e&&null!=e[t]?e[t]:null),e)}function a(e,t,n){let i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;return i="function"===typeof e?e(n):Array.isArray(e)?e[n]||o:r(e,n)||o,t&&(i=t(i,o,e)),i}const s=function(e){const{prop:t,cssProperty:n=e.prop,themeKey:s,transform:g}=e,l=e=>{if(null==e[t])return null;const l=e[t],c=r(e.theme,s)||{};return(0,o.NI)(e,l,(e=>{let o=a(c,g,e);return e===o&&"string"===typeof e&&(o=a(c,g,`${t}${"default"===e?"":(0,i.A)(e)}`,e)),!1===n?o:{[n]:o}}))};return l.propTypes={},l.filterProps=[t],l}},7758:(e,t,n)=>{"use strict";n.d(t,{A:()=>Y});var i=n(8604),o=n(7162),r=n(3815);const a=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=t.reduce(((e,t)=>(t.filterProps.forEach((n=>{e[n]=t})),e)),{}),o=e=>Object.keys(e).reduce(((t,n)=>i[n]?(0,r.A)(t,i[n](e)):t),{});return o.propTypes={},o.filterProps=t.reduce(((e,t)=>e.concat(t.filterProps)),[]),o};var s=n(9751);function g(e){return"number"!==typeof e?e:`${e}px solid`}function l(e,t){return(0,o.Ay)({prop:e,themeKey:"borders",transform:t})}const c=l("border",g),I=l("borderTop",g),C=l("borderRight",g),u=l("borderBottom",g),d=l("borderLeft",g),h=l("borderColor"),A=l("borderTopColor"),p=l("borderRightColor"),m=l("borderBottomColor"),b=l("borderLeftColor"),f=l("outline",g),y=l("outlineColor"),G=e=>{if(void 0!==e.borderRadius&&null!==e.borderRadius){const t=(0,i.MA)(e.theme,"shape.borderRadius",4,"borderRadius"),n=e=>({borderRadius:(0,i._W)(t,e)});return(0,s.NI)(e,e.borderRadius,n)}return null};G.propTypes={},G.filterProps=["borderRadius"];a(c,I,C,u,d,h,A,p,m,b,G,f,y);const v=e=>{if(void 0!==e.gap&&null!==e.gap){const t=(0,i.MA)(e.theme,"spacing",8,"gap"),n=e=>({gap:(0,i._W)(t,e)});return(0,s.NI)(e,e.gap,n)}return null};v.propTypes={},v.filterProps=["gap"];const B=e=>{if(void 0!==e.columnGap&&null!==e.columnGap){const t=(0,i.MA)(e.theme,"spacing",8,"columnGap"),n=e=>({columnGap:(0,i._W)(t,e)});return(0,s.NI)(e,e.columnGap,n)}return null};B.propTypes={},B.filterProps=["columnGap"];const Z=e=>{if(void 0!==e.rowGap&&null!==e.rowGap){const t=(0,i.MA)(e.theme,"spacing",8,"rowGap"),n=e=>({rowGap:(0,i._W)(t,e)});return(0,s.NI)(e,e.rowGap,n)}return null};Z.propTypes={},Z.filterProps=["rowGap"];a(v,B,Z,(0,o.Ay)({prop:"gridColumn"}),(0,o.Ay)({prop:"gridRow"}),(0,o.Ay)({prop:"gridAutoFlow"}),(0,o.Ay)({prop:"gridAutoColumns"}),(0,o.Ay)({prop:"gridAutoRows"}),(0,o.Ay)({prop:"gridTemplateColumns"}),(0,o.Ay)({prop:"gridTemplateRows"}),(0,o.Ay)({prop:"gridTemplateAreas"}),(0,o.Ay)({prop:"gridArea"}));function w(e,t){return"grey"===t?t:e}a((0,o.Ay)({prop:"color",themeKey:"palette",transform:w}),(0,o.Ay)({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:w}),(0,o.Ay)({prop:"backgroundColor",themeKey:"palette",transform:w}));function W(e){return e<=1&&0!==e?100*e+"%":e}const S=(0,o.Ay)({prop:"width",transform:W}),R=e=>{if(void 0!==e.maxWidth&&null!==e.maxWidth){const t=t=>{var n,i;const o=(null==(n=e.theme)||null==(n=n.breakpoints)||null==(n=n.values)?void 0:n[t])||s.zu[t];return o?"px"!==(null==(i=e.theme)||null==(i=i.breakpoints)?void 0:i.unit)?{maxWidth:`${o}${e.theme.breakpoints.unit}`}:{maxWidth:o}:{maxWidth:W(t)}};return(0,s.NI)(e,e.maxWidth,t)}return null};R.filterProps=["maxWidth"];const x=(0,o.Ay)({prop:"minWidth",transform:W}),V=(0,o.Ay)({prop:"height",transform:W}),X=(0,o.Ay)({prop:"maxHeight",transform:W}),H=(0,o.Ay)({prop:"minHeight",transform:W}),Y=((0,o.Ay)({prop:"size",cssProperty:"width",transform:W}),(0,o.Ay)({prop:"size",cssProperty:"height",transform:W}),a(S,R,x,V,X,H,(0,o.Ay)({prop:"boxSizing"})),{border:{themeKey:"borders",transform:g},borderTop:{themeKey:"borders",transform:g},borderRight:{themeKey:"borders",transform:g},borderBottom:{themeKey:"borders",transform:g},borderLeft:{themeKey:"borders",transform:g},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},outline:{themeKey:"borders",transform:g},outlineColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:G},color:{themeKey:"palette",transform:w},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:w},backgroundColor:{themeKey:"palette",transform:w},p:{style:i.Ms},pt:{style:i.Ms},pr:{style:i.Ms},pb:{style:i.Ms},pl:{style:i.Ms},px:{style:i.Ms},py:{style:i.Ms},padding:{style:i.Ms},paddingTop:{style:i.Ms},paddingRight:{style:i.Ms},paddingBottom:{style:i.Ms},paddingLeft:{style:i.Ms},paddingX:{style:i.Ms},paddingY:{style:i.Ms},paddingInline:{style:i.Ms},paddingInlineStart:{style:i.Ms},paddingInlineEnd:{style:i.Ms},paddingBlock:{style:i.Ms},paddingBlockStart:{style:i.Ms},paddingBlockEnd:{style:i.Ms},m:{style:i.Lc},mt:{style:i.Lc},mr:{style:i.Lc},mb:{style:i.Lc},ml:{style:i.Lc},mx:{style:i.Lc},my:{style:i.Lc},margin:{style:i.Lc},marginTop:{style:i.Lc},marginRight:{style:i.Lc},marginBottom:{style:i.Lc},marginLeft:{style:i.Lc},marginX:{style:i.Lc},marginY:{style:i.Lc},marginInline:{style:i.Lc},marginInlineStart:{style:i.Lc},marginInlineEnd:{style:i.Lc},marginBlock:{style:i.Lc},marginBlockStart:{style:i.Lc},marginBlockEnd:{style:i.Lc},displayPrint:{cssProperty:!1,transform:e=>({"@media print":{display:e}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:v},rowGap:{style:Z},columnGap:{style:B},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:W},maxWidth:{style:R},minWidth:{transform:W},height:{transform:W},maxHeight:{transform:W},minHeight:{transform:W},boxSizing:{},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}})},8698:(e,t,n)=>{"use strict";n.d(t,{A:()=>l});var i=n(8168),o=n(8587),r=n(9172),a=n(7758);const s=["sx"],g=e=>{var t,n;const i={systemProps:{},otherProps:{}},o=null!=(t=null==e||null==(n=e.theme)?void 0:n.unstable_sxConfig)?t:a.A;return Object.keys(e).forEach((t=>{o[t]?i.systemProps[t]=e[t]:i.otherProps[t]=e[t]})),i};function l(e){const{sx:t}=e,n=(0,o.A)(e,s),{systemProps:a,otherProps:l}=g(n);let c;return c=Array.isArray(t)?[a,...t]:"function"===typeof t?function(){const e=t(...arguments);return(0,r.Q)(e)?(0,i.A)({},a,e):a}:(0,i.A)({},a,t),(0,i.A)({},l,{sx:c})}},3234:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i.A,extendSxProp:()=>o.A,unstable_createStyleFunctionSx:()=>i.k,unstable_defaultSxConfig:()=>r.A});var i=n(8812),o=n(8698),r=n(7758)},8812:(e,t,n)=>{"use strict";n.d(t,{A:()=>c,k:()=>g});var i=n(7598),o=n(3815),r=n(7162),a=n(9751),s=n(7758);function g(){function e(e,t,n,o){const s={[e]:t,theme:n},g=o[e];if(!g)return{[e]:t};const{cssProperty:l=e,themeKey:c,transform:I,style:C}=g;if(null==t)return null;if("typography"===c&&"inherit"===t)return{[e]:t};const u=(0,r.Yn)(n,c)||{};if(C)return C(s);return(0,a.NI)(s,t,(t=>{let n=(0,r.BO)(u,I,t);return t===n&&"string"===typeof t&&(n=(0,r.BO)(u,I,`${e}${"default"===t?"":(0,i.A)(t)}`,t)),!1===l?n:{[l]:n}}))}return function t(n){var i;const{sx:r,theme:g={}}=n||{};if(!r)return null;const l=null!=(i=g.unstable_sxConfig)?i:s.A;function c(n){let i=n;if("function"===typeof n)i=n(g);else if("object"!==typeof n)return n;if(!i)return null;const r=(0,a.EU)(g.breakpoints),s=Object.keys(r);let c=r;return Object.keys(i).forEach((n=>{const r=(s=i[n],I=g,"function"===typeof s?s(I):s);var s,I;if(null!==r&&void 0!==r)if("object"===typeof r)if(l[n])c=(0,o.A)(c,e(n,r,g,l));else{const e=(0,a.NI)({theme:g},r,(e=>({[n]:e})));!function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=t.reduce(((e,t)=>e.concat(Object.keys(t))),[]),o=new Set(i);return t.every((e=>o.size===Object.keys(e).length))}(e,r)?c=(0,o.A)(c,e):c[n]=t({sx:r,theme:g})}else c=(0,o.A)(c,e(n,r,g,l))})),(0,a.vf)(s,c)}return Array.isArray(r)?r.map(c):c(r)}}const l=g();l.filterProps=["sx"];const c=l},7598:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var i=n(7868);function o(e){if("string"!==typeof e)throw new Error((0,i.A)(7));return e.charAt(0).toUpperCase()+e.slice(1)}},7918:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i.A});var i=n(7598)},9214:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});const i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MIN_SAFE_INTEGER,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_SAFE_INTEGER;return Math.max(t,Math.min(e,n))}},9172:(e,t,n)=>{"use strict";n.d(t,{A:()=>a,Q:()=>o});var i=n(8168);function o(e){if("object"!==typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function r(e){if(!o(e))return e;const t={};return Object.keys(e).forEach((n=>{t[n]=r(e[n])})),t}function a(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{clone:!0};const s=n.clone?(0,i.A)({},e):e;return o(e)&&o(t)&&Object.keys(t).forEach((i=>{o(t[i])&&Object.prototype.hasOwnProperty.call(e,i)&&o(e[i])?s[i]=a(e[i],t[i],n):n.clone?s[i]=o(t[i])?r(t[i]):t[i]:s[i]=t[i]})),s}},9482:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i.A,isPlainObject:()=>i.Q});var i=n(9172)},7868:(e,t,n)=>{"use strict";function i(e){let t="https://mui.com/production-error/?code="+e;for(let n=1;n<arguments.length;n+=1)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified MUI error #"+e+"; visit "+t+" for the full message."}n.d(t,{A:()=>i})},457:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i.A});var i=n(7868)},3382:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>g,getFunctionName:()=>r});var i=n(2086);const o=/^\s*function(?:\s|\s*\/\*.*\*\/\s*)+([^(\s/]*)\s*/;function r(e){const t=`${e}`.match(o);return t&&t[1]||""}function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.displayName||e.name||r(e)||t}function s(e,t,n){const i=a(t);return e.displayName||(""!==i?`${n}(${i})`:n)}function g(e){if(null!=e){if("string"===typeof e)return e;if("function"===typeof e)return a(e,"Component");if("object"===typeof e)switch(e.$$typeof){case i.ForwardRef:return s(e,e.render,"ForwardRef");case i.Memo:return s(e,e.type,"memo");default:return}}}},8055:(e,t,n)=>{"use strict";n.d(t,{AQ:()=>bt,ON:()=>pt,z9:()=>mt});var i=n(5043),o=n(295),r=n(9408),a=n(7284),s=n.n(a),g=n(579);e=n.hmd(e);var l=null;try{var c="function"===typeof e.require&&n(Object(function(){var e=new Error("Cannot find module 'worker_threads'");throw e.code="MODULE_NOT_FOUND",e}()))||"function"===typeof require&&require("worker_threads")||n(Object(function(){var e=new Error("Cannot find module 'worker_threads'");throw e.code="MODULE_NOT_FOUND",e}()));l=c.Worker}catch(lt){}function I(e,t,n){var i=void 0===t?null:t,o=function(e,t){return Buffer.from(e,"base64").toString(t?"utf16":"utf8")}(e,void 0!==n&&n),r=o.indexOf("\n",10)+1,a=o.substring(r)+(i?"//# sourceMappingURL="+i:"");return function(e){return new l(a,Object.assign({},e,{eval:!0}))}}function C(e,t,n){var i=void 0===t?null:t,o=function(e,t){var n=atob(e);if(t){for(var i=new Uint8Array(n.length),o=0,r=n.length;o<r;++o)i[o]=n.charCodeAt(o);return String.fromCharCode.apply(null,new Uint16Array(i.buffer))}return n}(e,void 0!==n&&n),r=o.indexOf("\n",10)+1,a=o.substring(r)+(i?"//# sourceMappingURL="+i:""),s=new Blob([a],{type:"application/javascript"});return URL.createObjectURL(s)}var u="[object process]"===Object.prototype.toString.call("undefined"!==typeof process?process:0);var d,h,A,p=(d="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogUmVjb3JkcyB3aGF0IG9iamVjdHMgYXJlIGNvbGxpZGluZyB3aXRoIGVhY2ggb3RoZXIKICAgKi8KICAvKioKICAgKiBBIDN4MyBtYXRyaXguCiAgICogQXV0aG9yZWQgYnkge0BsaW5rIGh0dHA6Ly9naXRodWIuY29tL3NjaHRlcHBlLyBzY2h0ZXBwZX0KICAgKi8KCgogIGNsYXNzIE1hdDMgewogICAgLyoqCiAgICAgKiBBIHZlY3RvciBvZiBsZW5ndGggOSwgY29udGFpbmluZyBhbGwgbWF0cml4IGVsZW1lbnRzLgogICAgICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gZWxlbWVudHMgQSB2ZWN0b3Igb2YgbGVuZ3RoIDksIGNvbnRhaW5pbmcgYWxsIG1hdHJpeCBlbGVtZW50cy4KICAgICAqLwogICAgY29uc3RydWN0b3IoZWxlbWVudHMpIHsKICAgICAgaWYgKGVsZW1lbnRzID09PSB2b2lkIDApIHsKICAgICAgICBlbGVtZW50cyA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXTsKICAgICAgfQoKICAgICAgdGhpcy5lbGVtZW50cyA9IHZvaWQgMDsKICAgICAgdGhpcy5lbGVtZW50cyA9IGVsZW1lbnRzOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBtYXRyaXggdG8gaWRlbnRpdHkKICAgICAqIEB0b2RvIFNob3VsZCBwZXJoYXBzIGJlIHJlbmFtZWQgdG8gYHNldElkZW50aXR5KClgIHRvIGJlIG1vcmUgY2xlYXIuCiAgICAgKiBAdG9kbyBDcmVhdGUgYW5vdGhlciBmdW5jdGlvbiB0aGF0IGltbWVkaWF0ZWx5IGNyZWF0ZXMgYW4gaWRlbnRpdHkgbWF0cml4IGVnLiBgZXllKClgCiAgICAgKi8KCgogICAgaWRlbnRpdHkoKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBlWzBdID0gMTsKICAgICAgZVsxXSA9IDA7CiAgICAgIGVbMl0gPSAwOwogICAgICBlWzNdID0gMDsKICAgICAgZVs0XSA9IDE7CiAgICAgIGVbNV0gPSAwOwogICAgICBlWzZdID0gMDsKICAgICAgZVs3XSA9IDA7CiAgICAgIGVbOF0gPSAxOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYWxsIGVsZW1lbnRzIHRvIHplcm8KICAgICAqLwoKCiAgICBzZXRaZXJvKCkgewogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgZVswXSA9IDA7CiAgICAgIGVbMV0gPSAwOwogICAgICBlWzJdID0gMDsKICAgICAgZVszXSA9IDA7CiAgICAgIGVbNF0gPSAwOwogICAgICBlWzVdID0gMDsKICAgICAgZVs2XSA9IDA7CiAgICAgIGVbN10gPSAwOwogICAgICBlWzhdID0gMDsKICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgbWF0cml4IGRpYWdvbmFsIGVsZW1lbnRzIGZyb20gYSBWZWMzCiAgICAgKi8KCgogICAgc2V0VHJhY2UodmVjdG9yKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBlWzBdID0gdmVjdG9yLng7CiAgICAgIGVbNF0gPSB2ZWN0b3IueTsKICAgICAgZVs4XSA9IHZlY3Rvci56OwogICAgfQogICAgLyoqCiAgICAgKiBHZXRzIHRoZSBtYXRyaXggZGlhZ29uYWwgZWxlbWVudHMKICAgICAqLwoKCiAgICBnZXRUcmFjZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIHRhcmdldC54ID0gZVswXTsKICAgICAgdGFyZ2V0LnkgPSBlWzRdOwogICAgICB0YXJnZXQueiA9IGVbOF07CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIE1hdHJpeC1WZWN0b3IgbXVsdGlwbGljYXRpb24KICAgICAqIEBwYXJhbSB2IFRoZSB2ZWN0b3IgdG8gbXVsdGlwbHkgd2l0aAogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCwgdGFyZ2V0IHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICB2bXVsdCh2LCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IHggPSB2Lng7CiAgICAgIGNvbnN0IHkgPSB2Lnk7CiAgICAgIGNvbnN0IHogPSB2Lno7CiAgICAgIHRhcmdldC54ID0gZVswXSAqIHggKyBlWzFdICogeSArIGVbMl0gKiB6OwogICAgICB0YXJnZXQueSA9IGVbM10gKiB4ICsgZVs0XSAqIHkgKyBlWzVdICogejsKICAgICAgdGFyZ2V0LnogPSBlWzZdICogeCArIGVbN10gKiB5ICsgZVs4XSAqIHo7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIE1hdHJpeC1zY2FsYXIgbXVsdGlwbGljYXRpb24KICAgICAqLwoKCiAgICBzbXVsdChzKSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5lbGVtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgIHRoaXMuZWxlbWVudHNbaV0gKj0gczsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBNYXRyaXggbXVsdGlwbGljYXRpb24KICAgICAqIEBwYXJhbSBtYXRyaXggTWF0cml4IHRvIG11bHRpcGx5IHdpdGggZnJvbSBsZWZ0IHNpZGUuCiAgICAgKi8KCgogICAgbW11bHQobWF0cml4LCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IE1hdDMoKTsKICAgICAgfQoKICAgICAgY29uc3QgQSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IEIgPSBtYXRyaXguZWxlbWVudHM7CiAgICAgIGNvbnN0IFQgPSB0YXJnZXQuZWxlbWVudHM7CiAgICAgIGNvbnN0IGExMSA9IEFbMF0sCiAgICAgICAgICAgIGExMiA9IEFbMV0sCiAgICAgICAgICAgIGExMyA9IEFbMl0sCiAgICAgICAgICAgIGEyMSA9IEFbM10sCiAgICAgICAgICAgIGEyMiA9IEFbNF0sCiAgICAgICAgICAgIGEyMyA9IEFbNV0sCiAgICAgICAgICAgIGEzMSA9IEFbNl0sCiAgICAgICAgICAgIGEzMiA9IEFbN10sCiAgICAgICAgICAgIGEzMyA9IEFbOF07CiAgICAgIGNvbnN0IGIxMSA9IEJbMF0sCiAgICAgICAgICAgIGIxMiA9IEJbMV0sCiAgICAgICAgICAgIGIxMyA9IEJbMl0sCiAgICAgICAgICAgIGIyMSA9IEJbM10sCiAgICAgICAgICAgIGIyMiA9IEJbNF0sCiAgICAgICAgICAgIGIyMyA9IEJbNV0sCiAgICAgICAgICAgIGIzMSA9IEJbNl0sCiAgICAgICAgICAgIGIzMiA9IEJbN10sCiAgICAgICAgICAgIGIzMyA9IEJbOF07CiAgICAgIFRbMF0gPSBhMTEgKiBiMTEgKyBhMTIgKiBiMjEgKyBhMTMgKiBiMzE7CiAgICAgIFRbMV0gPSBhMTEgKiBiMTIgKyBhMTIgKiBiMjIgKyBhMTMgKiBiMzI7CiAgICAgIFRbMl0gPSBhMTEgKiBiMTMgKyBhMTIgKiBiMjMgKyBhMTMgKiBiMzM7CiAgICAgIFRbM10gPSBhMjEgKiBiMTEgKyBhMjIgKiBiMjEgKyBhMjMgKiBiMzE7CiAgICAgIFRbNF0gPSBhMjEgKiBiMTIgKyBhMjIgKiBiMjIgKyBhMjMgKiBiMzI7CiAgICAgIFRbNV0gPSBhMjEgKiBiMTMgKyBhMjIgKiBiMjMgKyBhMjMgKiBiMzM7CiAgICAgIFRbNl0gPSBhMzEgKiBiMTEgKyBhMzIgKiBiMjEgKyBhMzMgKiBiMzE7CiAgICAgIFRbN10gPSBhMzEgKiBiMTIgKyBhMzIgKiBiMjIgKyBhMzMgKiBiMzI7CiAgICAgIFRbOF0gPSBhMzEgKiBiMTMgKyBhMzIgKiBiMjMgKyBhMzMgKiBiMzM7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFNjYWxlIGVhY2ggY29sdW1uIG9mIHRoZSBtYXRyaXgKICAgICAqLwoKCiAgICBzY2FsZSh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgTWF0MygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgdCA9IHRhcmdldC5lbGVtZW50czsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSAzOyBpKyspIHsKICAgICAgICB0WzMgKiBpICsgMF0gPSB2ZWN0b3IueCAqIGVbMyAqIGkgKyAwXTsKICAgICAgICB0WzMgKiBpICsgMV0gPSB2ZWN0b3IueSAqIGVbMyAqIGkgKyAxXTsKICAgICAgICB0WzMgKiBpICsgMl0gPSB2ZWN0b3IueiAqIGVbMyAqIGkgKyAyXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU29sdmUgQXg9YgogICAgICogQHBhcmFtIGIgVGhlIHJpZ2h0IGhhbmQgc2lkZQogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbC4gVGFyZ2V0IHZlY3RvciB0byBzYXZlIGluLgogICAgICogQHJldHVybiBUaGUgc29sdXRpb24geAogICAgICogQHRvZG8gc2hvdWxkIHJldXNlIGFycmF5cwogICAgICovCgoKICAgIHNvbHZlKGIsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICAvLyBDb25zdHJ1Y3QgZXF1YXRpb25zCiAgICAgIGNvbnN0IG5yID0gMzsgLy8gbnVtIHJvd3MKCiAgICAgIGNvbnN0IG5jID0gNDsgLy8gbnVtIGNvbHMKCiAgICAgIGNvbnN0IGVxbnMgPSBbXTsKICAgICAgbGV0IGk7CiAgICAgIGxldCBqOwoKICAgICAgZm9yIChpID0gMDsgaSA8IG5yICogbmM7IGkrKykgewogICAgICAgIGVxbnMucHVzaCgwKTsKICAgICAgfQoKICAgICAgZm9yIChpID0gMDsgaSA8IDM7IGkrKykgewogICAgICAgIGZvciAoaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIGVxbnNbaSArIG5jICogal0gPSB0aGlzLmVsZW1lbnRzW2kgKyAzICogal07CiAgICAgICAgfQogICAgICB9CgogICAgICBlcW5zWzMgKyA0ICogMF0gPSBiLng7CiAgICAgIGVxbnNbMyArIDQgKiAxXSA9IGIueTsKICAgICAgZXFuc1szICsgNCAqIDJdID0gYi56OyAvLyBDb21wdXRlIHJpZ2h0IHVwcGVyIHRyaWFuZ3VsYXIgdmVyc2lvbiBvZiB0aGUgbWF0cml4IC0gR2F1c3MgZWxpbWluYXRpb24KCiAgICAgIGxldCBuID0gMzsKICAgICAgY29uc3QgayA9IG47CiAgICAgIGxldCBucDsKICAgICAgY29uc3Qga3AgPSA0OyAvLyBudW0gcm93cwoKICAgICAgbGV0IHA7CgogICAgICBkbyB7CiAgICAgICAgaSA9IGsgLSBuOwoKICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBpXSA9PT0gMCkgewogICAgICAgICAgLy8gdGhlIHBpdm90IGlzIG51bGwsIHN3YXAgbGluZXMKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGpdICE9PSAwKSB7CiAgICAgICAgICAgICAgbnAgPSBrcDsKCiAgICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgLy8gZG8gbGlnbmUoIGkgKSA9IGxpZ25lKCBpICkgKyBsaWduZSggayApCiAgICAgICAgICAgICAgICBwID0ga3AgLSBucDsKICAgICAgICAgICAgICAgIGVxbnNbcCArIG5jICogaV0gKz0gZXFuc1twICsgbmMgKiBqXTsKICAgICAgICAgICAgICB9IHdoaWxlICgtLW5wKTsKCiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGldICE9PSAwKSB7CiAgICAgICAgICBmb3IgKGogPSBpICsgMTsgaiA8IGs7IGorKykgewogICAgICAgICAgICBjb25zdCBtdWx0aXBsaWVyID0gZXFuc1tpICsgbmMgKiBqXSAvIGVxbnNbaSArIG5jICogaV07CiAgICAgICAgICAgIG5wID0ga3A7CgogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgLy8gZG8gbGlnbmUoIGsgKSA9IGxpZ25lKCBrICkgLSBtdWx0aXBsaWVyICogbGlnbmUoIGkgKQogICAgICAgICAgICAgIHAgPSBrcCAtIG5wOwogICAgICAgICAgICAgIGVxbnNbcCArIG5jICogal0gPSBwIDw9IGkgPyAwIDogZXFuc1twICsgbmMgKiBqXSAtIGVxbnNbcCArIG5jICogaV0gKiBtdWx0aXBsaWVyOwogICAgICAgICAgICB9IHdoaWxlICgtLW5wKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gd2hpbGUgKC0tbik7IC8vIEdldCB0aGUgc29sdXRpb24KCgogICAgICB0YXJnZXQueiA9IGVxbnNbMiAqIG5jICsgM10gLyBlcW5zWzIgKiBuYyArIDJdOwogICAgICB0YXJnZXQueSA9IChlcW5zWzEgKiBuYyArIDNdIC0gZXFuc1sxICogbmMgKyAyXSAqIHRhcmdldC56KSAvIGVxbnNbMSAqIG5jICsgMV07CiAgICAgIHRhcmdldC54ID0gKGVxbnNbMCAqIG5jICsgM10gLSBlcW5zWzAgKiBuYyArIDJdICogdGFyZ2V0LnogLSBlcW5zWzAgKiBuYyArIDFdICogdGFyZ2V0LnkpIC8gZXFuc1swICogbmMgKyAwXTsKCiAgICAgIGlmIChpc05hTih0YXJnZXQueCkgfHwgaXNOYU4odGFyZ2V0LnkpIHx8IGlzTmFOKHRhcmdldC56KSB8fCB0YXJnZXQueCA9PT0gSW5maW5pdHkgfHwgdGFyZ2V0LnkgPT09IEluZmluaXR5IHx8IHRhcmdldC56ID09PSBJbmZpbml0eSkgewogICAgICAgIHRocm93ICJDb3VsZCBub3Qgc29sdmUgZXF1YXRpb24hIEdvdCB4PVsiICsgdGFyZ2V0LnRvU3RyaW5nKCkgKyAiXSwgYj1bIiArIGIudG9TdHJpbmcoKSArICJdLCBBPVsiICsgdGhpcy50b1N0cmluZygpICsgIl0iOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYW4gZWxlbWVudCBpbiB0aGUgbWF0cml4IGJ5IGluZGV4LiBJbmRleCBzdGFydHMgYXQgMCwgbm90IDEhISEKICAgICAqIEBwYXJhbSB2YWx1ZSBJZiBwcm92aWRlZCwgdGhlIG1hdHJpeCBlbGVtZW50IHdpbGwgYmUgc2V0IHRvIHRoaXMgdmFsdWUuCiAgICAgKi8KCgogICAgZShyb3csIGNvbHVtbiwgdmFsdWUpIHsKICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50c1tjb2x1bW4gKyAzICogcm93XTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBTZXQgdmFsdWUKICAgICAgICB0aGlzLmVsZW1lbnRzW2NvbHVtbiArIDMgKiByb3ddID0gdmFsdWU7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29weSBhbm90aGVyIG1hdHJpeCBpbnRvIHRoaXMgbWF0cml4IG9iamVjdC4KICAgICAqLwoKCiAgICBjb3B5KG1hdHJpeCkgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1hdHJpeC5lbGVtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgIHRoaXMuZWxlbWVudHNbaV0gPSBtYXRyaXguZWxlbWVudHNbaV07CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBtYXRyaXguCiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIGxldCByID0gJyc7CiAgICAgIGNvbnN0IHNlcCA9ICcsJzsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgOTsgaSsrKSB7CiAgICAgICAgciArPSB0aGlzLmVsZW1lbnRzW2ldICsgc2VwOwogICAgICB9CgogICAgICByZXR1cm4gcjsKICAgIH0KICAgIC8qKgogICAgICogcmV2ZXJzZSB0aGUgbWF0cml4CiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRhcmdldCBtYXRyaXggdG8gc2F2ZSBpbi4KICAgICAqIEByZXR1cm4gVGhlIHNvbHV0aW9uIHgKICAgICAqLwoKCiAgICByZXZlcnNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgTWF0MygpOwogICAgICB9CgogICAgICAvLyBDb25zdHJ1Y3QgZXF1YXRpb25zCiAgICAgIGNvbnN0IG5yID0gMzsgLy8gbnVtIHJvd3MKCiAgICAgIGNvbnN0IG5jID0gNjsgLy8gbnVtIGNvbHMKCiAgICAgIGNvbnN0IGVxbnMgPSByZXZlcnNlX2VxbnM7CiAgICAgIGxldCBpOwogICAgICBsZXQgajsKCiAgICAgIGZvciAoaSA9IDA7IGkgPCAzOyBpKyspIHsKICAgICAgICBmb3IgKGogPSAwOyBqIDwgMzsgaisrKSB7CiAgICAgICAgICBlcW5zW2kgKyBuYyAqIGpdID0gdGhpcy5lbGVtZW50c1tpICsgMyAqIGpdOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZXFuc1szICsgNiAqIDBdID0gMTsKICAgICAgZXFuc1szICsgNiAqIDFdID0gMDsKICAgICAgZXFuc1szICsgNiAqIDJdID0gMDsKICAgICAgZXFuc1s0ICsgNiAqIDBdID0gMDsKICAgICAgZXFuc1s0ICsgNiAqIDFdID0gMTsKICAgICAgZXFuc1s0ICsgNiAqIDJdID0gMDsKICAgICAgZXFuc1s1ICsgNiAqIDBdID0gMDsKICAgICAgZXFuc1s1ICsgNiAqIDFdID0gMDsKICAgICAgZXFuc1s1ICsgNiAqIDJdID0gMTsgLy8gQ29tcHV0ZSByaWdodCB1cHBlciB0cmlhbmd1bGFyIHZlcnNpb24gb2YgdGhlIG1hdHJpeCAtIEdhdXNzIGVsaW1pbmF0aW9uCgogICAgICBsZXQgbiA9IDM7CiAgICAgIGNvbnN0IGsgPSBuOwogICAgICBsZXQgbnA7CiAgICAgIGNvbnN0IGtwID0gbmM7IC8vIG51bSByb3dzCgogICAgICBsZXQgcDsKCiAgICAgIGRvIHsKICAgICAgICBpID0gayAtIG47CgogICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGldID09PSAwKSB7CiAgICAgICAgICAvLyB0aGUgcGl2b3QgaXMgbnVsbCwgc3dhcCBsaW5lcwogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgaWYgKGVxbnNbaSArIG5jICogal0gIT09IDApIHsKICAgICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAvLyBkbyBsaW5lKCBpICkgPSBsaW5lKCBpICkgKyBsaW5lKCBrICkKICAgICAgICAgICAgICAgIHAgPSBrcCAtIG5wOwogICAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBpXSArPSBlcW5zW3AgKyBuYyAqIGpdOwogICAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gIT09IDApIHsKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgICAgbnAgPSBrcDsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAvLyBkbyBsaW5lKCBrICkgPSBsaW5lKCBrICkgLSBtdWx0aXBsaWVyICogbGluZSggaSApCiAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IHAgPD0gaSA/IDAgOiBlcW5zW3AgKyBuYyAqIGpdIC0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSB3aGlsZSAoLS1uKTsgLy8gZWxpbWluYXRlIHRoZSB1cHBlciBsZWZ0IHRyaWFuZ2xlIG9mIHRoZSBtYXRyaXgKCgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBqID0gaSAtIDE7CgogICAgICAgIGRvIHsKICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgIG5wID0gbmM7CgogICAgICAgICAgZG8gewogICAgICAgICAgICBwID0gbmMgLSBucDsKICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IGVxbnNbcCArIG5jICogal0gLSBlcW5zW3AgKyBuYyAqIGldICogbXVsdGlwbGllcjsKICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgIH0gd2hpbGUgKGotLSk7CiAgICAgIH0gd2hpbGUgKC0taSk7IC8vIG9wZXJhdGlvbnMgb24gdGhlIGRpYWdvbmFsCgoKICAgICAgaSA9IDI7CgogICAgICBkbyB7CiAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IDEgLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgIG5wID0gbmM7CgogICAgICAgIGRvIHsKICAgICAgICAgIHAgPSBuYyAtIG5wOwogICAgICAgICAgZXFuc1twICsgbmMgKiBpXSA9IGVxbnNbcCArIG5jICogaV0gKiBtdWx0aXBsaWVyOwogICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICB9IHdoaWxlIChpLS0pOwoKICAgICAgaSA9IDI7CgogICAgICBkbyB7CiAgICAgICAgaiA9IDI7CgogICAgICAgIGRvIHsKICAgICAgICAgIHAgPSBlcW5zW25yICsgaiArIG5jICogaV07CgogICAgICAgICAgaWYgKGlzTmFOKHApIHx8IHAgPT09IEluZmluaXR5KSB7CiAgICAgICAgICAgIHRocm93ICJDb3VsZCBub3QgcmV2ZXJzZSEgQT1bIiArIHRoaXMudG9TdHJpbmcoKSArICJdIjsKICAgICAgICAgIH0KCiAgICAgICAgICB0YXJnZXQuZShpLCBqLCBwKTsKICAgICAgICB9IHdoaWxlIChqLS0pOwogICAgICB9IHdoaWxlIChpLS0pOwoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBtYXRyaXggZnJvbSBhIHF1YXRlcmlvbgogICAgICovCgoKICAgIHNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24ocSkgewogICAgICBjb25zdCB4ID0gcS54OwogICAgICBjb25zdCB5ID0gcS55OwogICAgICBjb25zdCB6ID0gcS56OwogICAgICBjb25zdCB3ID0gcS53OwogICAgICBjb25zdCB4MiA9IHggKyB4OwogICAgICBjb25zdCB5MiA9IHkgKyB5OwogICAgICBjb25zdCB6MiA9IHogKyB6OwogICAgICBjb25zdCB4eCA9IHggKiB4MjsKICAgICAgY29uc3QgeHkgPSB4ICogeTI7CiAgICAgIGNvbnN0IHh6ID0geCAqIHoyOwogICAgICBjb25zdCB5eSA9IHkgKiB5MjsKICAgICAgY29uc3QgeXogPSB5ICogejI7CiAgICAgIGNvbnN0IHp6ID0geiAqIHoyOwogICAgICBjb25zdCB3eCA9IHcgKiB4MjsKICAgICAgY29uc3Qgd3kgPSB3ICogeTI7CiAgICAgIGNvbnN0IHd6ID0gdyAqIHoyOwogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgZVszICogMCArIDBdID0gMSAtICh5eSArIHp6KTsKICAgICAgZVszICogMCArIDFdID0geHkgLSB3ejsKICAgICAgZVszICogMCArIDJdID0geHogKyB3eTsKICAgICAgZVszICogMSArIDBdID0geHkgKyB3ejsKICAgICAgZVszICogMSArIDFdID0gMSAtICh4eCArIHp6KTsKICAgICAgZVszICogMSArIDJdID0geXogLSB3eDsKICAgICAgZVszICogMiArIDBdID0geHogLSB3eTsKICAgICAgZVszICogMiArIDFdID0geXogKyB3eDsKICAgICAgZVszICogMiArIDJdID0gMSAtICh4eCArIHl5KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zcG9zZSB0aGUgbWF0cml4CiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0LgogICAgICogQHJldHVybiBUaGUgdGFyZ2V0IE1hdDMsIG9yIGEgbmV3IE1hdDMgaWYgdGFyZ2V0IHdhcyBvbWl0dGVkLgogICAgICovCgoKICAgIHRyYW5zcG9zZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IE1hdDMoKTsKICAgICAgfQoKICAgICAgY29uc3QgTSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IFQgPSB0YXJnZXQuZWxlbWVudHM7CiAgICAgIGxldCB0bXA7IC8vU2V0IGRpYWdvbmFscwoKICAgICAgVFswXSA9IE1bMF07CiAgICAgIFRbNF0gPSBNWzRdOwogICAgICBUWzhdID0gTVs4XTsKICAgICAgdG1wID0gTVsxXTsKICAgICAgVFsxXSA9IE1bM107CiAgICAgIFRbM10gPSB0bXA7CiAgICAgIHRtcCA9IE1bMl07CiAgICAgIFRbMl0gPSBNWzZdOwogICAgICBUWzZdID0gdG1wOwogICAgICB0bXAgPSBNWzVdOwogICAgICBUWzVdID0gTVs3XTsKICAgICAgVFs3XSA9IHRtcDsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgfQoKICBjb25zdCByZXZlcnNlX2VxbnMgPSBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF07CiAgLyoqCiAgICogMy1kaW1lbnNpb25hbCB2ZWN0b3IKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCB2ID0gbmV3IFZlYzMoMSwgMiwgMykKICAgKiAgICAgY29uc29sZS5sb2coJ3g9JyArIHYueCkgLy8geD0xCiAgICovCgogIGNsYXNzIFZlYzMgewogICAgY29uc3RydWN0b3IoeCwgeSwgeikgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDAuMDsKICAgICAgfQoKICAgICAgaWYgKHkgPT09IHZvaWQgMCkgewogICAgICAgIHkgPSAwLjA7CiAgICAgIH0KCiAgICAgIGlmICh6ID09PSB2b2lkIDApIHsKICAgICAgICB6ID0gMC4wOwogICAgICB9CgogICAgICB0aGlzLnggPSB2b2lkIDA7CiAgICAgIHRoaXMueSA9IHZvaWQgMDsKICAgICAgdGhpcy56ID0gdm9pZCAwOwogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgY3Jvc3MgcHJvZHVjdAogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbi4KICAgICAqLwoKCiAgICBjcm9zcyh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB2eCA9IHZlY3Rvci54OwogICAgICBjb25zdCB2eSA9IHZlY3Rvci55OwogICAgICBjb25zdCB2eiA9IHZlY3Rvci56OwogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHkgKiB2eiAtIHogKiB2eTsKICAgICAgdGFyZ2V0LnkgPSB6ICogdnggLSB4ICogdno7CiAgICAgIHRhcmdldC56ID0geCAqIHZ5IC0geSAqIHZ4OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZlY3RvcnMnIDMgZWxlbWVudHMKICAgICAqLwoKCiAgICBzZXQoeCwgeSwgeikgewogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogU2V0IGFsbCBjb21wb25lbnRzIG9mIHRoZSB2ZWN0b3IgdG8gemVyby4KICAgICAqLwoKCiAgICBzZXRaZXJvKCkgewogICAgICB0aGlzLnggPSB0aGlzLnkgPSB0aGlzLnogPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgYWRkaXRpb24KICAgICAqLwoKCiAgICB2YWRkKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICsgdGhpcy54OwogICAgICAgIHRhcmdldC55ID0gdmVjdG9yLnkgKyB0aGlzLnk7CiAgICAgICAgdGFyZ2V0LnogPSB2ZWN0b3IueiArIHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54ICsgdmVjdG9yLngsIHRoaXMueSArIHZlY3Rvci55LCB0aGlzLnogKyB2ZWN0b3Iueik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVmVjdG9yIHN1YnRyYWN0aW9uCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluLgogICAgICovCgoKICAgIHZzdWIodmVjdG9yLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCkgewogICAgICAgIHRhcmdldC54ID0gdGhpcy54IC0gdmVjdG9yLng7CiAgICAgICAgdGFyZ2V0LnkgPSB0aGlzLnkgLSB2ZWN0b3IueTsKICAgICAgICB0YXJnZXQueiA9IHRoaXMueiAtIHZlY3Rvci56OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLnggLSB2ZWN0b3IueCwgdGhpcy55IC0gdmVjdG9yLnksIHRoaXMueiAtIHZlY3Rvci56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNyb3NzIHByb2R1Y3QgbWF0cml4IGFfY3Jvc3MgZnJvbSBhIHZlY3Rvciwgc3VjaCB0aGF0IGEgeCBiID0gYV9jcm9zcyAqIGIgPSBjCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dzguY3MudW11LnNlL2t1cnNlci9UREJEMjQvVlQwNi9sZWN0dXJlcy9MZWN0dXJlNi5wZGYgVW1lw6UgVW5pdmVyc2l0eSBMZWN0dXJlfQogICAgICovCgoKICAgIGNyb3NzbWF0KCkgewogICAgICByZXR1cm4gbmV3IE1hdDMoWzAsIC10aGlzLnosIHRoaXMueSwgdGhpcy56LCAwLCAtdGhpcy54LCAtdGhpcy55LCB0aGlzLngsIDBdKTsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSB2ZWN0b3IuIE5vdGUgdGhhdCB0aGlzIGNoYW5nZXMgdGhlIHZhbHVlcyBpbiB0aGUgdmVjdG9yLgogICAgICAqIEByZXR1cm4gUmV0dXJucyB0aGUgbm9ybSBvZiB0aGUgdmVjdG9yCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBuID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkgKyB6ICogeik7CgogICAgICBpZiAobiA+IDAuMCkgewogICAgICAgIGNvbnN0IGludk4gPSAxIC8gbjsKICAgICAgICB0aGlzLnggKj0gaW52TjsKICAgICAgICB0aGlzLnkgKj0gaW52TjsKICAgICAgICB0aGlzLnogKj0gaW52TjsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBNYWtlIHNvbWV0aGluZyB1cAogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICB9CgogICAgICByZXR1cm4gbjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB2ZXJzaW9uIG9mIHRoaXMgdmVjdG9yIHRoYXQgaXMgb2YgbGVuZ3RoIDEuCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluCiAgICAgKiBAcmV0dXJuIFJldHVybnMgdGhlIHVuaXQgdmVjdG9yCiAgICAgKi8KCgogICAgdW5pdCh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgbGV0IG5pbnYgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKCiAgICAgIGlmIChuaW52ID4gMC4wKSB7CiAgICAgICAgbmludiA9IDEuMCAvIG5pbnY7CiAgICAgICAgdGFyZ2V0LnggPSB4ICogbmludjsKICAgICAgICB0YXJnZXQueSA9IHkgKiBuaW52OwogICAgICAgIHRhcmdldC56ID0geiAqIG5pbnY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGFyZ2V0LnggPSAxOwogICAgICAgIHRhcmdldC55ID0gMDsKICAgICAgICB0YXJnZXQueiA9IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgbGVuZ3RoIG9mIHRoZSB2ZWN0b3IKICAgICAqLwoKCiAgICBsZW5ndGgoKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBzcXVhcmVkIGxlbmd0aCBvZiB0aGUgdmVjdG9yLgogICAgICovCgoKICAgIGxlbmd0aFNxdWFyZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmRvdCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGRpc3RhbmNlIGZyb20gdGhpcyBwb2ludCB0byBhbm90aGVyIHBvaW50CiAgICAgKi8KCgogICAgZGlzdGFuY2VUbyhwKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIGNvbnN0IHB4ID0gcC54OwogICAgICBjb25zdCBweSA9IHAueTsKICAgICAgY29uc3QgcHogPSBwLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGlzIHBvaW50IHRvIGFub3RoZXIgcG9pbnQKICAgICAqLwoKCiAgICBkaXN0YW5jZVNxdWFyZWQocCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBweCA9IHAueDsKICAgICAgY29uc3QgcHkgPSBwLnk7CiAgICAgIGNvbnN0IHB6ID0gcC56OwogICAgICByZXR1cm4gKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSBhbGwgdGhlIGNvbXBvbmVudHMgb2YgdGhlIHZlY3RvciB3aXRoIGEgc2NhbGFyLgogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBzY2FsZShzY2FsYXIsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHNjYWxhciAqIHg7CiAgICAgIHRhcmdldC55ID0gc2NhbGFyICogeTsKICAgICAgdGFyZ2V0LnogPSBzY2FsYXIgKiB6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgdmVjdG9yIHdpdGggYW4gb3RoZXIgdmVjdG9yLCBjb21wb25lbnQtd2lzZS4KICAgICAqIEBwYXJhbSB0YXJnZXQgVGhlIHZlY3RvciB0byBzYXZlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgdm11bCh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICogdGhpcy54OwogICAgICB0YXJnZXQueSA9IHZlY3Rvci55ICogdGhpcy55OwogICAgICB0YXJnZXQueiA9IHZlY3Rvci56ICogdGhpcy56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTY2FsZSBhIHZlY3RvciBhbmQgYWRkIGl0IHRvIHRoaXMgdmVjdG9yLiBTYXZlIHRoZSByZXN1bHQgaW4gInRhcmdldCIuICh0YXJnZXQgPSB0aGlzICsgdmVjdG9yICogc2NhbGFyKQogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBhZGRTY2FsZWRWZWN0b3Ioc2NhbGFyLCB2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHRoaXMueCArIHNjYWxhciAqIHZlY3Rvci54OwogICAgICB0YXJnZXQueSA9IHRoaXMueSArIHNjYWxhciAqIHZlY3Rvci55OwogICAgICB0YXJnZXQueiA9IHRoaXMueiArIHNjYWxhciAqIHZlY3Rvci56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgZG90IHByb2R1Y3QKICAgICAqIEBwYXJhbSB2ZWN0b3IKICAgICAqLwoKCiAgICBkb3QodmVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLnggKiB2ZWN0b3IueCArIHRoaXMueSAqIHZlY3Rvci55ICsgdGhpcy56ICogdmVjdG9yLno7CiAgICB9CgogICAgaXNaZXJvKCkgewogICAgICByZXR1cm4gdGhpcy54ID09PSAwICYmIHRoaXMueSA9PT0gMCAmJiB0aGlzLnogPT09IDA7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgdGhlIHZlY3RvciBwb2ludCBpbiB0aGUgb3Bwb3NpdGUgZGlyZWN0aW9uLgogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbgogICAgICovCgoKICAgIG5lZ2F0ZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnggPSAtdGhpcy54OwogICAgICB0YXJnZXQueSA9IC10aGlzLnk7CiAgICAgIHRhcmdldC56ID0gLXRoaXMuejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0d28gYXJ0aWZpY2lhbCB0YW5nZW50cyB0byB0aGUgdmVjdG9yCiAgICAgKiBAcGFyYW0gdDEgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBmaXJzdCB0YW5nZW50IGluCiAgICAgKiBAcGFyYW0gdDIgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBzZWNvbmQgdGFuZ2VudCBpbgogICAgICovCgoKICAgIHRhbmdlbnRzKHQxLCB0MikgewogICAgICBjb25zdCBub3JtID0gdGhpcy5sZW5ndGgoKTsKCiAgICAgIGlmIChub3JtID4gMC4wKSB7CiAgICAgICAgY29uc3QgbiA9IFZlYzNfdGFuZ2VudHNfbjsKICAgICAgICBjb25zdCBpbm9ybSA9IDEgLyBub3JtOwogICAgICAgIG4uc2V0KHRoaXMueCAqIGlub3JtLCB0aGlzLnkgKiBpbm9ybSwgdGhpcy56ICogaW5vcm0pOwogICAgICAgIGNvbnN0IHJhbmRWZWMgPSBWZWMzX3RhbmdlbnRzX3JhbmRWZWM7CgogICAgICAgIGlmIChNYXRoLmFicyhuLngpIDwgMC45KSB7CiAgICAgICAgICByYW5kVmVjLnNldCgxLCAwLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByYW5kVmVjLnNldCgwLCAxLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0KCiAgICAgICAgbi5jcm9zcyh0MSwgdDIpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRoZSBub3JtYWwgbGVuZ3RoIGlzIHplcm8sIG1ha2Ugc29tZXRoaW5nIHVwCiAgICAgICAgdDEuc2V0KDEsIDAsIDApOwogICAgICAgIHQyLnNldCgwLCAxLCAwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhIG1vcmUgcmVhZGFibGUgZm9ybWF0CiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiB0aGlzLnggKyAiLCIgKyB0aGlzLnkgKyAiLCIgKyB0aGlzLno7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnRzIHRvIGFuIGFycmF5CiAgICAgKi8KCgogICAgdG9BcnJheSgpIHsKICAgICAgcmV0dXJuIFt0aGlzLngsIHRoaXMueSwgdGhpcy56XTsKICAgIH0KICAgIC8qKgogICAgICogQ29waWVzIHZhbHVlIG9mIHNvdXJjZSB0byB0aGlzIHZlY3Rvci4KICAgICAqLwoKCiAgICBjb3B5KHZlY3RvcikgewogICAgICB0aGlzLnggPSB2ZWN0b3IueDsKICAgICAgdGhpcy55ID0gdmVjdG9yLnk7CiAgICAgIHRoaXMueiA9IHZlY3Rvci56OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogRG8gYSBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHR3byB2ZWN0b3JzCiAgICAgKiBAcGFyYW0gdCBBIG51bWJlciBiZXR3ZWVuIDAgYW5kIDEuIDAgd2lsbCBtYWtlIHRoaXMgZnVuY3Rpb24gcmV0dXJuIHUsIGFuZCAxIHdpbGwgbWFrZSBpdCByZXR1cm4gdi4gTnVtYmVycyBpbiBiZXR3ZWVuIHdpbGwgZ2VuZXJhdGUgYSB2ZWN0b3IgaW4gYmV0d2VlbiB0aGVtLgogICAgICovCgoKICAgIGxlcnAodmVjdG9yLCB0LCB0YXJnZXQpIHsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgdGFyZ2V0LnggPSB4ICsgKHZlY3Rvci54IC0geCkgKiB0OwogICAgICB0YXJnZXQueSA9IHkgKyAodmVjdG9yLnkgLSB5KSAqIHQ7CiAgICAgIHRhcmdldC56ID0geiArICh2ZWN0b3IueiAtIHopICogdDsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSB2ZWN0b3IgZXF1YWxzIGlzIGFsbW9zdCBlcXVhbCB0byBhbm90aGVyIG9uZS4KICAgICAqLwoKCiAgICBhbG1vc3RFcXVhbHModmVjdG9yLCBwcmVjaXNpb24pIHsKICAgICAgaWYgKHByZWNpc2lvbiA9PT0gdm9pZCAwKSB7CiAgICAgICAgcHJlY2lzaW9uID0gMWUtNjsKICAgICAgfQoKICAgICAgaWYgKE1hdGguYWJzKHRoaXMueCAtIHZlY3Rvci54KSA+IHByZWNpc2lvbiB8fCBNYXRoLmFicyh0aGlzLnkgLSB2ZWN0b3IueSkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy56IC0gdmVjdG9yLnopID4gcHJlY2lzaW9uKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSB2ZWN0b3IgaXMgYWxtb3N0IHplcm8KICAgICAqLwoKCiAgICBhbG1vc3RaZXJvKHByZWNpc2lvbikgewogICAgICBpZiAocHJlY2lzaW9uID09PSB2b2lkIDApIHsKICAgICAgICBwcmVjaXNpb24gPSAxZS02OwogICAgICB9CgogICAgICBpZiAoTWF0aC5hYnModGhpcy54KSA+IHByZWNpc2lvbiB8fCBNYXRoLmFicyh0aGlzLnkpID4gcHJlY2lzaW9uIHx8IE1hdGguYWJzKHRoaXMueikgPiBwcmVjaXNpb24pIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgdmVjdG9yIGlzIGFudGktcGFyYWxsZWwgdG8gYW5vdGhlciB2ZWN0b3IuCiAgICAgKiBAcGFyYW0gcHJlY2lzaW9uIFNldCB0byB6ZXJvIGZvciBleGFjdCBjb21wYXJpc29ucwogICAgICovCgoKICAgIGlzQW50aXBhcmFsbGVsVG8odmVjdG9yLCBwcmVjaXNpb24pIHsKICAgICAgdGhpcy5uZWdhdGUoYW50aXBfbmVnKTsKICAgICAgcmV0dXJuIGFudGlwX25lZy5hbG1vc3RFcXVhbHModmVjdG9yLCBwcmVjaXNpb24pOwogICAgfQogICAgLyoqCiAgICAgKiBDbG9uZSB0aGUgdmVjdG9yCiAgICAgKi8KCgogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLngsIHRoaXMueSwgdGhpcy56KTsKICAgIH0KCiAgfQoKICBWZWMzLlpFUk8gPSB2b2lkIDA7CiAgVmVjMy5VTklUX1ggPSB2b2lkIDA7CiAgVmVjMy5VTklUX1kgPSB2b2lkIDA7CiAgVmVjMy5VTklUX1ogPSB2b2lkIDA7CiAgVmVjMy5aRVJPID0gbmV3IFZlYzMoMCwgMCwgMCk7CiAgVmVjMy5VTklUX1ggPSBuZXcgVmVjMygxLCAwLCAwKTsKICBWZWMzLlVOSVRfWSA9IG5ldyBWZWMzKDAsIDEsIDApOwogIFZlYzMuVU5JVF9aID0gbmV3IFZlYzMoMCwgMCwgMSk7CiAgY29uc3QgVmVjM190YW5nZW50c19uID0gbmV3IFZlYzMoKTsKICBjb25zdCBWZWMzX3RhbmdlbnRzX3JhbmRWZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFudGlwX25lZyA9IG5ldyBWZWMzKCk7CiAgLyoqCiAgICogQXhpcyBhbGlnbmVkIGJvdW5kaW5nIGJveCBjbGFzcy4KICAgKi8KCiAgY2xhc3MgQUFCQiB7CiAgICAvKioKICAgICAqIFRoZSBsb3dlciBib3VuZCBvZiB0aGUgYm91bmRpbmcgYm94CiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSB1cHBlciBib3VuZCBvZiB0aGUgYm91bmRpbmcgYm94CiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5sb3dlckJvdW5kID0gdm9pZCAwOwogICAgICB0aGlzLnVwcGVyQm91bmQgPSB2b2lkIDA7CiAgICAgIHRoaXMubG93ZXJCb3VuZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMudXBwZXJCb3VuZCA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5sb3dlckJvdW5kKSB7CiAgICAgICAgdGhpcy5sb3dlckJvdW5kLmNvcHkob3B0aW9ucy5sb3dlckJvdW5kKTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMudXBwZXJCb3VuZCkgewogICAgICAgIHRoaXMudXBwZXJCb3VuZC5jb3B5KG9wdGlvbnMudXBwZXJCb3VuZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBBQUJCIGJvdW5kcyBmcm9tIGEgc2V0IG9mIHBvaW50cy4KICAgICAqIEBwYXJhbSBwb2ludHMgQW4gYXJyYXkgb2YgVmVjMydzLgogICAgICogQHJldHVybiBUaGUgc2VsZiBvYmplY3QKICAgICAqLwoKCiAgICBzZXRGcm9tUG9pbnRzKHBvaW50cywgcG9zaXRpb24sIHF1YXRlcm5pb24sIHNraW5TaXplKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIGNvbnN0IHEgPSBxdWF0ZXJuaW9uOyAvLyBTZXQgdG8gdGhlIGZpcnN0IHBvaW50CgogICAgICBsLmNvcHkocG9pbnRzWzBdKTsKCiAgICAgIGlmIChxKSB7CiAgICAgICAgcS52bXVsdChsLCBsKTsKICAgICAgfQoKICAgICAgdS5jb3B5KGwpOwoKICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBwb2ludHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgcCA9IHBvaW50c1tpXTsKCiAgICAgICAgaWYgKHEpIHsKICAgICAgICAgIHEudm11bHQocCwgdG1wJDEpOwogICAgICAgICAgcCA9IHRtcCQxOwogICAgICAgIH0KCiAgICAgICAgaWYgKHAueCA+IHUueCkgewogICAgICAgICAgdS54ID0gcC54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHAueCA8IGwueCkgewogICAgICAgICAgbC54ID0gcC54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHAueSA+IHUueSkgewogICAgICAgICAgdS55ID0gcC55OwogICAgICAgIH0KCiAgICAgICAgaWYgKHAueSA8IGwueSkgewogICAgICAgICAgbC55ID0gcC55OwogICAgICAgIH0KCiAgICAgICAgaWYgKHAueiA+IHUueikgewogICAgICAgICAgdS56ID0gcC56OwogICAgICAgIH0KCiAgICAgICAgaWYgKHAueiA8IGwueikgewogICAgICAgICAgbC56ID0gcC56OwogICAgICAgIH0KICAgICAgfSAvLyBBZGQgb2Zmc2V0CgoKICAgICAgaWYgKHBvc2l0aW9uKSB7CiAgICAgICAgcG9zaXRpb24udmFkZChsLCBsKTsKICAgICAgICBwb3NpdGlvbi52YWRkKHUsIHUpOwogICAgICB9CgogICAgICBpZiAoc2tpblNpemUpIHsKICAgICAgICBsLnggLT0gc2tpblNpemU7CiAgICAgICAgbC55IC09IHNraW5TaXplOwogICAgICAgIGwueiAtPSBza2luU2l6ZTsKICAgICAgICB1LnggKz0gc2tpblNpemU7CiAgICAgICAgdS55ICs9IHNraW5TaXplOwogICAgICAgIHUueiArPSBza2luU2l6ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvcHkgYm91bmRzIGZyb20gYW4gQUFCQiB0byB0aGlzIEFBQkIKICAgICAqIEBwYXJhbSBhYWJiIFNvdXJjZSB0byBjb3B5IGZyb20KICAgICAqIEByZXR1cm4gVGhlIHRoaXMgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5CiAgICAgKi8KCgogICAgY29weShhYWJiKSB7CiAgICAgIHRoaXMubG93ZXJCb3VuZC5jb3B5KGFhYmIubG93ZXJCb3VuZCk7CiAgICAgIHRoaXMudXBwZXJCb3VuZC5jb3B5KGFhYmIudXBwZXJCb3VuZCk7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBDbG9uZSBhbiBBQUJCCiAgICAgKi8KCgogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgQUFCQigpLmNvcHkodGhpcyk7CiAgICB9CiAgICAvKioKICAgICAqIEV4dGVuZCB0aGlzIEFBQkIgc28gdGhhdCBpdCBjb3ZlcnMgdGhlIGdpdmVuIEFBQkIgdG9vLgogICAgICovCgoKICAgIGV4dGVuZChhYWJiKSB7CiAgICAgIHRoaXMubG93ZXJCb3VuZC54ID0gTWF0aC5taW4odGhpcy5sb3dlckJvdW5kLngsIGFhYmIubG93ZXJCb3VuZC54KTsKICAgICAgdGhpcy51cHBlckJvdW5kLnggPSBNYXRoLm1heCh0aGlzLnVwcGVyQm91bmQueCwgYWFiYi51cHBlckJvdW5kLngpOwogICAgICB0aGlzLmxvd2VyQm91bmQueSA9IE1hdGgubWluKHRoaXMubG93ZXJCb3VuZC55LCBhYWJiLmxvd2VyQm91bmQueSk7CiAgICAgIHRoaXMudXBwZXJCb3VuZC55ID0gTWF0aC5tYXgodGhpcy51cHBlckJvdW5kLnksIGFhYmIudXBwZXJCb3VuZC55KTsKICAgICAgdGhpcy5sb3dlckJvdW5kLnogPSBNYXRoLm1pbih0aGlzLmxvd2VyQm91bmQueiwgYWFiYi5sb3dlckJvdW5kLnopOwogICAgICB0aGlzLnVwcGVyQm91bmQueiA9IE1hdGgubWF4KHRoaXMudXBwZXJCb3VuZC56LCBhYWJiLnVwcGVyQm91bmQueik7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gQUFCQiBvdmVybGFwcyB0aGlzIEFBQkIuCiAgICAgKi8KCgogICAgb3ZlcmxhcHMoYWFiYikgewogICAgICBjb25zdCBsMSA9IHRoaXMubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTEgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIGNvbnN0IGwyID0gYWFiYi5sb3dlckJvdW5kOwogICAgICBjb25zdCB1MiA9IGFhYmIudXBwZXJCb3VuZDsgLy8gICAgICBsMiAgICAgICAgdTIKICAgICAgLy8gICAgICB8LS0tLS0tLS0tfAogICAgICAvLyB8LS0tLS0tLS18CiAgICAgIC8vIGwxICAgICAgIHUxCgogICAgICBjb25zdCBvdmVybGFwc1ggPSBsMi54IDw9IHUxLnggJiYgdTEueCA8PSB1Mi54IHx8IGwxLnggPD0gdTIueCAmJiB1Mi54IDw9IHUxLng7CiAgICAgIGNvbnN0IG92ZXJsYXBzWSA9IGwyLnkgPD0gdTEueSAmJiB1MS55IDw9IHUyLnkgfHwgbDEueSA8PSB1Mi55ICYmIHUyLnkgPD0gdTEueTsKICAgICAgY29uc3Qgb3ZlcmxhcHNaID0gbDIueiA8PSB1MS56ICYmIHUxLnogPD0gdTIueiB8fCBsMS56IDw9IHUyLnogJiYgdTIueiA8PSB1MS56OwogICAgICByZXR1cm4gb3ZlcmxhcHNYICYmIG92ZXJsYXBzWSAmJiBvdmVybGFwc1o7CiAgICB9IC8vIE1vc3RseSBmb3IgZGVidWdnaW5nCgoKICAgIHZvbHVtZSgpIHsKICAgICAgY29uc3QgbCA9IHRoaXMubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IHRoaXMudXBwZXJCb3VuZDsKICAgICAgcmV0dXJuICh1LnggLSBsLngpICogKHUueSAtIGwueSkgKiAodS56IC0gbC56KTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBnaXZlbiBBQUJCIGlzIGZ1bGx5IGNvbnRhaW5lZCBpbiB0aGlzIEFBQkIuCiAgICAgKi8KCgogICAgY29udGFpbnMoYWFiYikgewogICAgICBjb25zdCBsMSA9IHRoaXMubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTEgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIGNvbnN0IGwyID0gYWFiYi5sb3dlckJvdW5kOwogICAgICBjb25zdCB1MiA9IGFhYmIudXBwZXJCb3VuZDsgLy8gICAgICBsMiAgICAgICAgdTIKICAgICAgLy8gICAgICB8LS0tLS0tLS0tfAogICAgICAvLyB8LS0tLS0tLS0tLS0tLS0tfAogICAgICAvLyBsMSAgICAgICAgICAgICAgdTEKCiAgICAgIHJldHVybiBsMS54IDw9IGwyLnggJiYgdTEueCA+PSB1Mi54ICYmIGwxLnkgPD0gbDIueSAmJiB1MS55ID49IHUyLnkgJiYgbDEueiA8PSBsMi56ICYmIHUxLnogPj0gdTIuejsKICAgIH0KCiAgICBnZXRDb3JuZXJzKGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgpIHsKICAgICAgY29uc3QgbCA9IHRoaXMubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IHRoaXMudXBwZXJCb3VuZDsKICAgICAgYS5jb3B5KGwpOwogICAgICBiLnNldCh1LngsIGwueSwgbC56KTsKICAgICAgYy5zZXQodS54LCB1LnksIGwueik7CiAgICAgIGQuc2V0KGwueCwgdS55LCB1LnopOwogICAgICBlLnNldCh1LngsIGwueSwgdS56KTsKICAgICAgZi5zZXQobC54LCB1LnksIGwueik7CiAgICAgIGcuc2V0KGwueCwgbC55LCB1LnopOwogICAgICBoLmNvcHkodSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgcmVwcmVzZW50YXRpb24gb2YgYW4gQUFCQiBpbiBhbm90aGVyIGZyYW1lLgogICAgICogQHJldHVybiBUaGUgInRhcmdldCIgQUFCQiBvYmplY3QuCiAgICAgKi8KCgogICAgdG9Mb2NhbEZyYW1lKGZyYW1lLCB0YXJnZXQpIHsKICAgICAgY29uc3QgY29ybmVycyA9IHRyYW5zZm9ybUludG9GcmFtZV9jb3JuZXJzOwogICAgICBjb25zdCBhID0gY29ybmVyc1swXTsKICAgICAgY29uc3QgYiA9IGNvcm5lcnNbMV07CiAgICAgIGNvbnN0IGMgPSBjb3JuZXJzWzJdOwogICAgICBjb25zdCBkID0gY29ybmVyc1szXTsKICAgICAgY29uc3QgZSA9IGNvcm5lcnNbNF07CiAgICAgIGNvbnN0IGYgPSBjb3JuZXJzWzVdOwogICAgICBjb25zdCBnID0gY29ybmVyc1s2XTsKICAgICAgY29uc3QgaCA9IGNvcm5lcnNbN107IC8vIEdldCBjb3JuZXJzIGluIGN1cnJlbnQgZnJhbWUKCiAgICAgIHRoaXMuZ2V0Q29ybmVycyhhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKTsgLy8gVHJhbnNmb3JtIHRoZW0gdG8gbmV3IGxvY2FsIGZyYW1lCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gODsgaSsrKSB7CiAgICAgICAgY29uc3QgY29ybmVyID0gY29ybmVyc1tpXTsKICAgICAgICBmcmFtZS5wb2ludFRvTG9jYWwoY29ybmVyLCBjb3JuZXIpOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0LnNldEZyb21Qb2ludHMoY29ybmVycyk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgcmVwcmVzZW50YXRpb24gb2YgYW4gQUFCQiBpbiB0aGUgZ2xvYmFsIGZyYW1lLgogICAgICogQHJldHVybiBUaGUgInRhcmdldCIgQUFCQiBvYmplY3QuCiAgICAgKi8KCgogICAgdG9Xb3JsZEZyYW1lKGZyYW1lLCB0YXJnZXQpIHsKICAgICAgY29uc3QgY29ybmVycyA9IHRyYW5zZm9ybUludG9GcmFtZV9jb3JuZXJzOwogICAgICBjb25zdCBhID0gY29ybmVyc1swXTsKICAgICAgY29uc3QgYiA9IGNvcm5lcnNbMV07CiAgICAgIGNvbnN0IGMgPSBjb3JuZXJzWzJdOwogICAgICBjb25zdCBkID0gY29ybmVyc1szXTsKICAgICAgY29uc3QgZSA9IGNvcm5lcnNbNF07CiAgICAgIGNvbnN0IGYgPSBjb3JuZXJzWzVdOwogICAgICBjb25zdCBnID0gY29ybmVyc1s2XTsKICAgICAgY29uc3QgaCA9IGNvcm5lcnNbN107IC8vIEdldCBjb3JuZXJzIGluIGN1cnJlbnQgZnJhbWUKCiAgICAgIHRoaXMuZ2V0Q29ybmVycyhhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKTsgLy8gVHJhbnNmb3JtIHRoZW0gdG8gbmV3IGxvY2FsIGZyYW1lCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gODsgaSsrKSB7CiAgICAgICAgY29uc3QgY29ybmVyID0gY29ybmVyc1tpXTsKICAgICAgICBmcmFtZS5wb2ludFRvV29ybGQoY29ybmVyLCBjb3JuZXIpOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0LnNldEZyb21Qb2ludHMoY29ybmVycyk7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBBQUJCIGlzIGhpdCBieSBhIHJheS4KICAgICAqLwoKCiAgICBvdmVybGFwc1JheShyYXkpIHsKICAgICAgY29uc3QgewogICAgICAgIGRpcmVjdGlvbiwKICAgICAgICBmcm9tCiAgICAgIH0gPSByYXk7IC8vIGNvbnN0IHQgPSAwCiAgICAgIC8vIHJheS5kaXJlY3Rpb24gaXMgdW5pdCBkaXJlY3Rpb24gdmVjdG9yIG9mIHJheQoKICAgICAgY29uc3QgZGlyRnJhY1ggPSAxIC8gZGlyZWN0aW9uLng7CiAgICAgIGNvbnN0IGRpckZyYWNZID0gMSAvIGRpcmVjdGlvbi55OwogICAgICBjb25zdCBkaXJGcmFjWiA9IDEgLyBkaXJlY3Rpb24uejsgLy8gdGhpcy5sb3dlckJvdW5kIGlzIHRoZSBjb3JuZXIgb2YgQUFCQiB3aXRoIG1pbmltYWwgY29vcmRpbmF0ZXMgLSBsZWZ0IGJvdHRvbSwgcnQgaXMgbWF4aW1hbCBjb3JuZXIKCiAgICAgIGNvbnN0IHQxID0gKHRoaXMubG93ZXJCb3VuZC54IC0gZnJvbS54KSAqIGRpckZyYWNYOwogICAgICBjb25zdCB0MiA9ICh0aGlzLnVwcGVyQm91bmQueCAtIGZyb20ueCkgKiBkaXJGcmFjWDsKICAgICAgY29uc3QgdDMgPSAodGhpcy5sb3dlckJvdW5kLnkgLSBmcm9tLnkpICogZGlyRnJhY1k7CiAgICAgIGNvbnN0IHQ0ID0gKHRoaXMudXBwZXJCb3VuZC55IC0gZnJvbS55KSAqIGRpckZyYWNZOwogICAgICBjb25zdCB0NSA9ICh0aGlzLmxvd2VyQm91bmQueiAtIGZyb20ueikgKiBkaXJGcmFjWjsKICAgICAgY29uc3QgdDYgPSAodGhpcy51cHBlckJvdW5kLnogLSBmcm9tLnopICogZGlyRnJhY1o7IC8vIGNvbnN0IHRtaW4gPSBNYXRoLm1heChNYXRoLm1heChNYXRoLm1pbih0MSwgdDIpLCBNYXRoLm1pbih0MywgdDQpKSk7CiAgICAgIC8vIGNvbnN0IHRtYXggPSBNYXRoLm1pbihNYXRoLm1pbihNYXRoLm1heCh0MSwgdDIpLCBNYXRoLm1heCh0MywgdDQpKSk7CgogICAgICBjb25zdCB0bWluID0gTWF0aC5tYXgoTWF0aC5tYXgoTWF0aC5taW4odDEsIHQyKSwgTWF0aC5taW4odDMsIHQ0KSksIE1hdGgubWluKHQ1LCB0NikpOwogICAgICBjb25zdCB0bWF4ID0gTWF0aC5taW4oTWF0aC5taW4oTWF0aC5tYXgodDEsIHQyKSwgTWF0aC5tYXgodDMsIHQ0KSksIE1hdGgubWF4KHQ1LCB0NikpOyAvLyBpZiB0bWF4IDwgMCwgcmF5IChsaW5lKSBpcyBpbnRlcnNlY3RpbmcgQUFCQiwgYnV0IHdob2xlIEFBQkIgaXMgYmVoaW5nIHVzCgogICAgICBpZiAodG1heCA8IDApIHsKICAgICAgICAvL3QgPSB0bWF4OwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSAvLyBpZiB0bWluID4gdG1heCwgcmF5IGRvZXNuJ3QgaW50ZXJzZWN0IEFBQkIKCgogICAgICBpZiAodG1pbiA+IHRtYXgpIHsKICAgICAgICAvL3QgPSB0bWF4OwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogIH0KCiAgY29uc3QgdG1wJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRyYW5zZm9ybUludG9GcmFtZV9jb3JuZXJzID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwogIC8qKgogICAqIENvbGxpc2lvbiAibWF0cml4Ii4KICAgKiBJdCdzIGFjdHVhbGx5IGEgdHJpYW5ndWxhci1zaGFwZWQgYXJyYXkgb2Ygd2hldGhlciB0d28gYm9kaWVzIGFyZSB0b3VjaGluZyB0aGlzIHN0ZXAsIGZvciByZWZlcmVuY2UgbmV4dCBzdGVwCiAgICovCgogIGNsYXNzIEFycmF5Q29sbGlzaW9uTWF0cml4IHsKICAgIC8qKgogICAgICogVGhlIG1hdHJpeCBzdG9yYWdlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5tYXRyaXggPSB2b2lkIDA7CiAgICAgIHRoaXMubWF0cml4ID0gW107CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlbGVtZW50CiAgICAgKi8KCgogICAgZ2V0KGJpLCBiaikgewogICAgICBsZXQgewogICAgICAgIGluZGV4OiBpCiAgICAgIH0gPSBiaTsKICAgICAgbGV0IHsKICAgICAgICBpbmRleDogagogICAgICB9ID0gYmo7CgogICAgICBpZiAoaiA+IGkpIHsKICAgICAgICBjb25zdCB0ZW1wID0gajsKICAgICAgICBqID0gaTsKICAgICAgICBpID0gdGVtcDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMubWF0cml4WyhpICogKGkgKyAxKSA+PiAxKSArIGogLSAxXTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IGFuIGVsZW1lbnQKICAgICAqLwoKCiAgICBzZXQoYmksIGJqLCB2YWx1ZSkgewogICAgICBsZXQgewogICAgICAgIGluZGV4OiBpCiAgICAgIH0gPSBiaTsKICAgICAgbGV0IHsKICAgICAgICBpbmRleDogagogICAgICB9ID0gYmo7CgogICAgICBpZiAoaiA+IGkpIHsKICAgICAgICBjb25zdCB0ZW1wID0gajsKICAgICAgICBqID0gaTsKICAgICAgICBpID0gdGVtcDsKICAgICAgfQoKICAgICAgdGhpcy5tYXRyaXhbKGkgKiAoaSArIDEpID4+IDEpICsgaiAtIDFdID0gdmFsdWUgPyAxIDogMDsKICAgIH0KICAgIC8qKgogICAgICogU2V0cyBhbGwgZWxlbWVudHMgdG8gemVybwogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHRoaXMubWF0cml4Lmxlbmd0aDsgaSAhPT0gbDsgaSsrKSB7CiAgICAgICAgdGhpcy5tYXRyaXhbaV0gPSAwOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgdGhlIG1heCBudW1iZXIgb2Ygb2JqZWN0cwogICAgICovCgoKICAgIHNldE51bU9iamVjdHMobikgewogICAgICB0aGlzLm1hdHJpeC5sZW5ndGggPSBuICogKG4gLSAxKSA+PiAxOwogICAgfQoKICB9CiAgLyoqCiAgICogQmFzZSBjbGFzcyBmb3Igb2JqZWN0cyB0aGF0IGRpc3BhdGNoZXMgZXZlbnRzLgogICAqLwoKCiAgY2xhc3MgRXZlbnRUYXJnZXQgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuX2xpc3RlbmVycyA9IHZvaWQgMDsKICAgIH0KICAgIC8qKgogICAgICogQWRkIGFuIGV2ZW50IGxpc3RlbmVyCiAgICAgKiBAcmV0dXJuIFRoZSBzZWxmIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwoKCiAgICBhZGRFdmVudExpc3RlbmVyKHR5cGUsIGxpc3RlbmVyKSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHRoaXMuX2xpc3RlbmVycyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7CgogICAgICBpZiAobGlzdGVuZXJzW3R5cGVdID09PSB1bmRlZmluZWQpIHsKICAgICAgICBsaXN0ZW5lcnNbdHlwZV0gPSBbXTsKICAgICAgfQoKICAgICAgaWYgKCFsaXN0ZW5lcnNbdHlwZV0uaW5jbHVkZXMobGlzdGVuZXIpKSB7CiAgICAgICAgbGlzdGVuZXJzW3R5cGVdLnB1c2gobGlzdGVuZXIpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW4gZXZlbnQgbGlzdGVuZXIgaXMgYWRkZWQKICAgICAqLwoKCiAgICBoYXNFdmVudExpc3RlbmVyKHR5cGUsIGxpc3RlbmVyKSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSAhPT0gdW5kZWZpbmVkICYmIGxpc3RlbmVyc1t0eXBlXS5pbmNsdWRlcyhsaXN0ZW5lcikpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhbnkgZXZlbnQgbGlzdGVuZXIgb2YgdGhlIGdpdmVuIHR5cGUgaXMgYWRkZWQKICAgICAqLwoKCiAgICBoYXNBbnlFdmVudExpc3RlbmVyKHR5cGUpIHsKICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICBjb25zdCBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7CiAgICAgIHJldHVybiBsaXN0ZW5lcnNbdHlwZV0gIT09IHVuZGVmaW5lZDsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGFuIGV2ZW50IGxpc3RlbmVyCiAgICAgKiBAcmV0dXJuIFRoZSBzZWxmIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwoKCiAgICByZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsIGxpc3RlbmVyKSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CgogICAgICBjb25zdCBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7CgogICAgICBpZiAobGlzdGVuZXJzW3R5cGVdID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgY29uc3QgaW5kZXggPSBsaXN0ZW5lcnNbdHlwZV0uaW5kZXhPZihsaXN0ZW5lcik7CgogICAgICBpZiAoaW5kZXggIT09IC0xKSB7CiAgICAgICAgbGlzdGVuZXJzW3R5cGVdLnNwbGljZShpbmRleCwgMSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBFbWl0IGFuIGV2ZW50LgogICAgICogQHJldHVybiBUaGUgc2VsZiBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgZGlzcGF0Y2hFdmVudChldmVudCkgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwogICAgICBjb25zdCBsaXN0ZW5lckFycmF5ID0gbGlzdGVuZXJzW2V2ZW50LnR5cGVdOwoKICAgICAgaWYgKGxpc3RlbmVyQXJyYXkgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGV2ZW50LnRhcmdldCA9IHRoaXM7CgogICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gbGlzdGVuZXJBcnJheS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgIGxpc3RlbmVyQXJyYXlbaV0uY2FsbCh0aGlzLCBldmVudCk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgfQogIC8qKgogICAqIEEgUXVhdGVybmlvbiBkZXNjcmliZXMgYSByb3RhdGlvbiBpbiAzRCBzcGFjZS4gVGhlIFF1YXRlcm5pb24gaXMgbWF0aGVtYXRpY2FsbHkgZGVmaW5lZCBhcyBRID0geCppICsgeSpqICsgeiprICsgdywgd2hlcmUgKGksaixrKSBhcmUgaW1hZ2luYXJ5IGJhc2lzIHZlY3RvcnMuICh4LHkseikgY2FuIGJlIHNlZW4gYXMgYSB2ZWN0b3IgcmVsYXRlZCB0byB0aGUgYXhpcyBvZiByb3RhdGlvbiwgd2hpbGUgdGhlIHJlYWwgbXVsdGlwbGllciwgdywgaXMgcmVsYXRlZCB0byB0aGUgYW1vdW50IG9mIHJvdGF0aW9uLgogICAqIEBwYXJhbSB4IE11bHRpcGxpZXIgb2YgdGhlIGltYWdpbmFyeSBiYXNpcyB2ZWN0b3IgaS4KICAgKiBAcGFyYW0geSBNdWx0aXBsaWVyIG9mIHRoZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9yIGouCiAgICogQHBhcmFtIHogTXVsdGlwbGllciBvZiB0aGUgaW1hZ2luYXJ5IGJhc2lzIHZlY3RvciBrLgogICAqIEBwYXJhbSB3IE11bHRpcGxpZXIgb2YgdGhlIHJlYWwgcGFydC4KICAgKiBAc2VlIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvUXVhdGVybmlvbgogICAqLwoKCiAgY2xhc3MgUXVhdGVybmlvbiB7CiAgICBjb25zdHJ1Y3Rvcih4LCB5LCB6LCB3KSB7CiAgICAgIGlmICh4ID09PSB2b2lkIDApIHsKICAgICAgICB4ID0gMDsKICAgICAgfQoKICAgICAgaWYgKHkgPT09IHZvaWQgMCkgewogICAgICAgIHkgPSAwOwogICAgICB9CgogICAgICBpZiAoeiA9PT0gdm9pZCAwKSB7CiAgICAgICAgeiA9IDA7CiAgICAgIH0KCiAgICAgIGlmICh3ID09PSB2b2lkIDApIHsKICAgICAgICB3ID0gMTsKICAgICAgfQoKICAgICAgdGhpcy54ID0gdm9pZCAwOwogICAgICB0aGlzLnkgPSB2b2lkIDA7CiAgICAgIHRoaXMueiA9IHZvaWQgMDsKICAgICAgdGhpcy53ID0gdm9pZCAwOwogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgICB0aGlzLncgPSB3OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZhbHVlIG9mIHRoZSBxdWF0ZXJuaW9uLgogICAgICovCgoKICAgIHNldCh4LCB5LCB6LCB3KSB7CiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHRoaXMudyA9IHc7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRvIGEgcmVhZGFibGUgZm9ybWF0CiAgICAgKiBAcmV0dXJuICJ4LHkseix3IgogICAgICovCgoKICAgIHRvU3RyaW5nKCkgewogICAgICByZXR1cm4gdGhpcy54ICsgIiwiICsgdGhpcy55ICsgIiwiICsgdGhpcy56ICsgIiwiICsgdGhpcy53OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRvIGFuIEFycmF5CiAgICAgKiBAcmV0dXJuIFt4LCB5LCB6LCB3XQogICAgICovCgoKICAgIHRvQXJyYXkoKSB7CiAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnksIHRoaXMueiwgdGhpcy53XTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBxdWF0ZXJuaW9uIGNvbXBvbmVudHMgZ2l2ZW4gYW4gYXhpcyBhbmQgYW4gYW5nbGUgaW4gcmFkaWFucy4KICAgICAqLwoKCiAgICBzZXRGcm9tQXhpc0FuZ2xlKHZlY3RvciwgYW5nbGUpIHsKICAgICAgY29uc3QgcyA9IE1hdGguc2luKGFuZ2xlICogMC41KTsKICAgICAgdGhpcy54ID0gdmVjdG9yLnggKiBzOwogICAgICB0aGlzLnkgPSB2ZWN0b3IueSAqIHM7CiAgICAgIHRoaXMueiA9IHZlY3Rvci56ICogczsKICAgICAgdGhpcy53ID0gTWF0aC5jb3MoYW5nbGUgKiAwLjUpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydHMgdGhlIHF1YXRlcm5pb24gdG8gWyBheGlzLCBhbmdsZSBdIHJlcHJlc2VudGF0aW9uLgogICAgICogQHBhcmFtIHRhcmdldEF4aXMgQSB2ZWN0b3Igb2JqZWN0IHRvIHJldXNlIGZvciBzdG9yaW5nIHRoZSBheGlzLgogICAgICogQHJldHVybiBBbiBhcnJheSwgZmlyc3QgZWxlbWVudCBpcyB0aGUgYXhpcyBhbmQgdGhlIHNlY29uZCBpcyB0aGUgYW5nbGUgaW4gcmFkaWFucy4KICAgICAqLwoKCiAgICB0b0F4aXNBbmdsZSh0YXJnZXRBeGlzKSB7CiAgICAgIGlmICh0YXJnZXRBeGlzID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXRBeGlzID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGhpcy5ub3JtYWxpemUoKTsgLy8gaWYgdz4xIGFjb3MgYW5kIHNxcnQgd2lsbCBwcm9kdWNlIGVycm9ycywgdGhpcyBjYW50IGhhcHBlbiBpZiBxdWF0ZXJuaW9uIGlzIG5vcm1hbGlzZWQKCiAgICAgIGNvbnN0IGFuZ2xlID0gMiAqIE1hdGguYWNvcyh0aGlzLncpOwogICAgICBjb25zdCBzID0gTWF0aC5zcXJ0KDEgLSB0aGlzLncgKiB0aGlzLncpOyAvLyBhc3N1bWluZyBxdWF0ZXJuaW9uIG5vcm1hbGlzZWQgdGhlbiB3IGlzIGxlc3MgdGhhbiAxLCBzbyB0ZXJtIGFsd2F5cyBwb3NpdGl2ZS4KCiAgICAgIGlmIChzIDwgMC4wMDEpIHsKICAgICAgICAvLyB0ZXN0IHRvIGF2b2lkIGRpdmlkZSBieSB6ZXJvLCBzIGlzIGFsd2F5cyBwb3NpdGl2ZSBkdWUgdG8gc3FydAogICAgICAgIC8vIGlmIHMgY2xvc2UgdG8gemVybyB0aGVuIGRpcmVjdGlvbiBvZiBheGlzIG5vdCBpbXBvcnRhbnQKICAgICAgICB0YXJnZXRBeGlzLnggPSB0aGlzLng7IC8vIGlmIGl0IGlzIGltcG9ydGFudCB0aGF0IGF4aXMgaXMgbm9ybWFsaXNlZCB0aGVuIHJlcGxhY2Ugd2l0aCB4PTE7IHk9ej0wOwoKICAgICAgICB0YXJnZXRBeGlzLnkgPSB0aGlzLnk7CiAgICAgICAgdGFyZ2V0QXhpcy56ID0gdGhpcy56OwogICAgICB9IGVsc2UgewogICAgICAgIHRhcmdldEF4aXMueCA9IHRoaXMueCAvIHM7IC8vIG5vcm1hbGlzZSBheGlzCgogICAgICAgIHRhcmdldEF4aXMueSA9IHRoaXMueSAvIHM7CiAgICAgICAgdGFyZ2V0QXhpcy56ID0gdGhpcy56IC8gczsKICAgICAgfQoKICAgICAgcmV0dXJuIFt0YXJnZXRBeGlzLCBhbmdsZV07CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiB2YWx1ZSBnaXZlbiB0d28gdmVjdG9ycy4gVGhlIHJlc3VsdGluZyByb3RhdGlvbiB3aWxsIGJlIHRoZSBuZWVkZWQgcm90YXRpb24gdG8gcm90YXRlIHUgdG8gdi4KICAgICAqLwoKCiAgICBzZXRGcm9tVmVjdG9ycyh1LCB2KSB7CiAgICAgIGlmICh1LmlzQW50aXBhcmFsbGVsVG8odikpIHsKICAgICAgICBjb25zdCB0MSA9IHNmdl90MTsKICAgICAgICBjb25zdCB0MiA9IHNmdl90MjsKICAgICAgICB1LnRhbmdlbnRzKHQxLCB0Mik7CiAgICAgICAgdGhpcy5zZXRGcm9tQXhpc0FuZ2xlKHQxLCBNYXRoLlBJKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBhID0gdS5jcm9zcyh2KTsKICAgICAgICB0aGlzLnggPSBhLng7CiAgICAgICAgdGhpcy55ID0gYS55OwogICAgICAgIHRoaXMueiA9IGEuejsKICAgICAgICB0aGlzLncgPSBNYXRoLnNxcnQodS5sZW5ndGgoKSAqKiAyICogdi5sZW5ndGgoKSAqKiAyKSArIHUuZG90KHYpOwogICAgICAgIHRoaXMubm9ybWFsaXplKCk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgcXVhdGVybmlvbiB3aXRoIGFuIG90aGVyIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgbXVsdChxdWF0LCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgYXggPSB0aGlzLng7CiAgICAgIGNvbnN0IGF5ID0gdGhpcy55OwogICAgICBjb25zdCBheiA9IHRoaXMuejsKICAgICAgY29uc3QgYXcgPSB0aGlzLnc7CiAgICAgIGNvbnN0IGJ4ID0gcXVhdC54OwogICAgICBjb25zdCBieSA9IHF1YXQueTsKICAgICAgY29uc3QgYnogPSBxdWF0Lno7CiAgICAgIGNvbnN0IGJ3ID0gcXVhdC53OwogICAgICB0YXJnZXQueCA9IGF4ICogYncgKyBhdyAqIGJ4ICsgYXkgKiBieiAtIGF6ICogYnk7CiAgICAgIHRhcmdldC55ID0gYXkgKiBidyArIGF3ICogYnkgKyBheiAqIGJ4IC0gYXggKiBiejsKICAgICAgdGFyZ2V0LnogPSBheiAqIGJ3ICsgYXcgKiBieiArIGF4ICogYnkgLSBheSAqIGJ4OwogICAgICB0YXJnZXQudyA9IGF3ICogYncgLSBheCAqIGJ4IC0gYXkgKiBieSAtIGF6ICogYno7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgaW52ZXJzZSBxdWF0ZXJuaW9uIHJvdGF0aW9uLgogICAgICovCgoKICAgIGludmVyc2UodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIGNvbnN0IHcgPSB0aGlzLnc7CiAgICAgIHRoaXMuY29uanVnYXRlKHRhcmdldCk7CiAgICAgIGNvbnN0IGlub3JtMiA9IDEgLyAoeCAqIHggKyB5ICogeSArIHogKiB6ICsgdyAqIHcpOwogICAgICB0YXJnZXQueCAqPSBpbm9ybTI7CiAgICAgIHRhcmdldC55ICo9IGlub3JtMjsKICAgICAgdGFyZ2V0LnogKj0gaW5vcm0yOwogICAgICB0YXJnZXQudyAqPSBpbm9ybTI7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgcXVhdGVybmlvbiBjb25qdWdhdGUKICAgICAqLwoKCiAgICBjb25qdWdhdGUodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIHRhcmdldC54ID0gLXRoaXMueDsKICAgICAgdGFyZ2V0LnkgPSAtdGhpcy55OwogICAgICB0YXJnZXQueiA9IC10aGlzLno7CiAgICAgIHRhcmdldC53ID0gdGhpcy53OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBOb3JtYWxpemUgdGhlIHF1YXRlcm5pb24uIE5vdGUgdGhhdCB0aGlzIGNoYW5nZXMgdGhlIHZhbHVlcyBvZiB0aGUgcXVhdGVybmlvbi4KICAgICAqLwoKCiAgICBub3JtYWxpemUoKSB7CiAgICAgIGxldCBsID0gTWF0aC5zcXJ0KHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueSArIHRoaXMueiAqIHRoaXMueiArIHRoaXMudyAqIHRoaXMudyk7CgogICAgICBpZiAobCA9PT0gMCkgewogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICAgIHRoaXMudyA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbCA9IDEgLyBsOwogICAgICAgIHRoaXMueCAqPSBsOwogICAgICAgIHRoaXMueSAqPSBsOwogICAgICAgIHRoaXMueiAqPSBsOwogICAgICAgIHRoaXMudyAqPSBsOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQXBwcm94aW1hdGlvbiBvZiBxdWF0ZXJuaW9uIG5vcm1hbGl6YXRpb24uIFdvcmtzIGJlc3Qgd2hlbiBxdWF0IGlzIGFscmVhZHkgYWxtb3N0LW5vcm1hbGl6ZWQuCiAgICAgKiBAYXV0aG9yIHVucGhhc2VkLCBodHRwczovL2dpdGh1Yi5jb20vdW5waGFzZWQKICAgICAqLwoKCiAgICBub3JtYWxpemVGYXN0KCkgewogICAgICBjb25zdCBmID0gKDMuMCAtICh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLncpKSAvIDIuMDsKCiAgICAgIGlmIChmID09PSAwKSB7CiAgICAgICAgdGhpcy54ID0gMDsKICAgICAgICB0aGlzLnkgPSAwOwogICAgICAgIHRoaXMueiA9IDA7CiAgICAgICAgdGhpcy53ID0gMDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnggKj0gZjsKICAgICAgICB0aGlzLnkgKj0gZjsKICAgICAgICB0aGlzLnogKj0gZjsKICAgICAgICB0aGlzLncgKj0gZjsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIE11bHRpcGx5IHRoZSBxdWF0ZXJuaW9uIGJ5IGEgdmVjdG9yCiAgICAgKi8KCgogICAgdm11bHQodiwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHggPSB2Lng7CiAgICAgIGNvbnN0IHkgPSB2Lnk7CiAgICAgIGNvbnN0IHogPSB2Lno7CiAgICAgIGNvbnN0IHF4ID0gdGhpcy54OwogICAgICBjb25zdCBxeSA9IHRoaXMueTsKICAgICAgY29uc3QgcXogPSB0aGlzLno7CiAgICAgIGNvbnN0IHF3ID0gdGhpcy53OyAvLyBxKnYKCiAgICAgIGNvbnN0IGl4ID0gcXcgKiB4ICsgcXkgKiB6IC0gcXogKiB5OwogICAgICBjb25zdCBpeSA9IHF3ICogeSArIHF6ICogeCAtIHF4ICogejsKICAgICAgY29uc3QgaXogPSBxdyAqIHogKyBxeCAqIHkgLSBxeSAqIHg7CiAgICAgIGNvbnN0IGl3ID0gLXF4ICogeCAtIHF5ICogeSAtIHF6ICogejsKICAgICAgdGFyZ2V0LnggPSBpeCAqIHF3ICsgaXcgKiAtcXggKyBpeSAqIC1xeiAtIGl6ICogLXF5OwogICAgICB0YXJnZXQueSA9IGl5ICogcXcgKyBpdyAqIC1xeSArIGl6ICogLXF4IC0gaXggKiAtcXo7CiAgICAgIHRhcmdldC56ID0gaXogKiBxdyArIGl3ICogLXF6ICsgaXggKiAtcXkgLSBpeSAqIC1xeDsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogQ29waWVzIHZhbHVlIG9mIHNvdXJjZSB0byB0aGlzIHF1YXRlcm5pb24uCiAgICAgKiBAcmV0dXJuIHRoaXMKICAgICAqLwoKCiAgICBjb3B5KHF1YXQpIHsKICAgICAgdGhpcy54ID0gcXVhdC54OwogICAgICB0aGlzLnkgPSBxdWF0Lnk7CiAgICAgIHRoaXMueiA9IHF1YXQuejsKICAgICAgdGhpcy53ID0gcXVhdC53OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCB0aGUgcXVhdGVybmlvbiB0byBldWxlciBhbmdsZSByZXByZXNlbnRhdGlvbi4gT3JkZXI6IFlaWCwgYXMgdGhpcyBwYWdlIGRlc2NyaWJlczogaHR0cHM6Ly93d3cuZXVjbGlkZWFuc3BhY2UuY29tL21hdGhzL3N0YW5kYXJkcy9pbmRleC5odG0KICAgICAqIEBwYXJhbSBvcmRlciBUaHJlZS1jaGFyYWN0ZXIgc3RyaW5nLCBkZWZhdWx0cyB0byAiWVpYIgogICAgICovCgoKICAgIHRvRXVsZXIodGFyZ2V0LCBvcmRlcikgewogICAgICBpZiAob3JkZXIgPT09IHZvaWQgMCkgewogICAgICAgIG9yZGVyID0gJ1laWCc7CiAgICAgIH0KCiAgICAgIGxldCBoZWFkaW5nOwogICAgICBsZXQgYXR0aXR1ZGU7CiAgICAgIGxldCBiYW5rOwogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCB3ID0gdGhpcy53OwoKICAgICAgc3dpdGNoIChvcmRlcikgewogICAgICAgIGNhc2UgJ1laWCc6CiAgICAgICAgICBjb25zdCB0ZXN0ID0geCAqIHkgKyB6ICogdzsKCiAgICAgICAgICBpZiAodGVzdCA+IDAuNDk5KSB7CiAgICAgICAgICAgIC8vIHNpbmd1bGFyaXR5IGF0IG5vcnRoIHBvbGUKICAgICAgICAgICAgaGVhZGluZyA9IDIgKiBNYXRoLmF0YW4yKHgsIHcpOwogICAgICAgICAgICBhdHRpdHVkZSA9IE1hdGguUEkgLyAyOwogICAgICAgICAgICBiYW5rID0gMDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodGVzdCA8IC0wLjQ5OSkgewogICAgICAgICAgICAvLyBzaW5ndWxhcml0eSBhdCBzb3V0aCBwb2xlCiAgICAgICAgICAgIGhlYWRpbmcgPSAtMiAqIE1hdGguYXRhbjIoeCwgdyk7CiAgICAgICAgICAgIGF0dGl0dWRlID0gLU1hdGguUEkgLyAyOwogICAgICAgICAgICBiYW5rID0gMDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoaGVhZGluZyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGNvbnN0IHNxeCA9IHggKiB4OwogICAgICAgICAgICBjb25zdCBzcXkgPSB5ICogeTsKICAgICAgICAgICAgY29uc3Qgc3F6ID0geiAqIHo7CiAgICAgICAgICAgIGhlYWRpbmcgPSBNYXRoLmF0YW4yKDIgKiB5ICogdyAtIDIgKiB4ICogeiwgMSAtIDIgKiBzcXkgLSAyICogc3F6KTsgLy8gSGVhZGluZwoKICAgICAgICAgICAgYXR0aXR1ZGUgPSBNYXRoLmFzaW4oMiAqIHRlc3QpOyAvLyBhdHRpdHVkZQoKICAgICAgICAgICAgYmFuayA9IE1hdGguYXRhbjIoMiAqIHggKiB3IC0gMiAqIHkgKiB6LCAxIC0gMiAqIHNxeCAtIDIgKiBzcXopOyAvLyBiYW5rCiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkV1bGVyIG9yZGVyICIgKyBvcmRlciArICIgbm90IHN1cHBvcnRlZCB5ZXQuIik7CiAgICAgIH0KCiAgICAgIHRhcmdldC55ID0gaGVhZGluZzsKICAgICAgdGFyZ2V0LnogPSBhdHRpdHVkZTsKICAgICAgdGFyZ2V0LnggPSBiYW5rOwogICAgfQogICAgLyoqCiAgICAgKiBAcGFyYW0gb3JkZXIgVGhlIG9yZGVyIHRvIGFwcGx5IGFuZ2xlczogJ1hZWicgb3IgJ1lYWicgb3IgYW55IG90aGVyIGNvbWJpbmF0aW9uLgogICAgICoKICAgICAqIFNlZSB7QGxpbmsgaHR0cHM6Ly93d3cubWF0aHdvcmtzLmNvbS9tYXRsYWJjZW50cmFsL2ZpbGVleGNoYW5nZS8yMDY5Ni1mdW5jdGlvbi10by1jb252ZXJ0LWJldHdlZW4tZGNtLWV1bGVyLWFuZ2xlcy1xdWF0ZXJuaW9ucy1hbmQtZXVsZXItdmVjdG9ycyBNYXRoV29ya3N9IHJlZmVyZW5jZQogICAgICovCgoKICAgIHNldEZyb21FdWxlcih4LCB5LCB6LCBvcmRlcikgewogICAgICBpZiAob3JkZXIgPT09IHZvaWQgMCkgewogICAgICAgIG9yZGVyID0gJ1hZWic7CiAgICAgIH0KCiAgICAgIGNvbnN0IGMxID0gTWF0aC5jb3MoeCAvIDIpOwogICAgICBjb25zdCBjMiA9IE1hdGguY29zKHkgLyAyKTsKICAgICAgY29uc3QgYzMgPSBNYXRoLmNvcyh6IC8gMik7CiAgICAgIGNvbnN0IHMxID0gTWF0aC5zaW4oeCAvIDIpOwogICAgICBjb25zdCBzMiA9IE1hdGguc2luKHkgLyAyKTsKICAgICAgY29uc3QgczMgPSBNYXRoLnNpbih6IC8gMik7CgogICAgICBpZiAob3JkZXIgPT09ICdYWVonKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgKyBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWVhaJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyArIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzIC0gczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKICAgICAgfSBlbHNlIGlmIChvcmRlciA9PT0gJ1pYWScpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdaWVgnKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzIC0gYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWVpYJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyArIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzIC0gczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgICAgfSBlbHNlIGlmIChvcmRlciA9PT0gJ1haWScpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IFF1YXRlcm5pb24odGhpcy54LCB0aGlzLnksIHRoaXMueiwgdGhpcy53KTsKICAgIH0KICAgIC8qKgogICAgICogUGVyZm9ybXMgYSBzcGhlcmljYWwgbGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gcXVhdAogICAgICoKICAgICAqIEBwYXJhbSB0b1F1YXQgc2Vjb25kIG9wZXJhbmQKICAgICAqIEBwYXJhbSB0IGludGVycG9sYXRpb24gYW1vdW50IGJldHdlZW4gdGhlIHNlbGYgcXVhdGVybmlvbiBhbmQgdG9RdWF0CiAgICAgKiBAcGFyYW0gdGFyZ2V0IEEgcXVhdGVybmlvbiB0byBzdG9yZSB0aGUgcmVzdWx0IGluLiBJZiBub3QgcHJvdmlkZWQsIGEgbmV3IG9uZSB3aWxsIGJlIGNyZWF0ZWQuCiAgICAgKiBAcmV0dXJucyB7UXVhdGVybmlvbn0gVGhlICJ0YXJnZXQiIG9iamVjdAogICAgICovCgoKICAgIHNsZXJwKHRvUXVhdCwgdCwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gdGhpcy54OwogICAgICBjb25zdCBheSA9IHRoaXMueTsKICAgICAgY29uc3QgYXogPSB0aGlzLno7CiAgICAgIGNvbnN0IGF3ID0gdGhpcy53OwogICAgICBsZXQgYnggPSB0b1F1YXQueDsKICAgICAgbGV0IGJ5ID0gdG9RdWF0Lnk7CiAgICAgIGxldCBieiA9IHRvUXVhdC56OwogICAgICBsZXQgYncgPSB0b1F1YXQudzsKICAgICAgbGV0IG9tZWdhOwogICAgICBsZXQgY29zb207CiAgICAgIGxldCBzaW5vbTsKICAgICAgbGV0IHNjYWxlMDsKICAgICAgbGV0IHNjYWxlMTsgLy8gY2FsYyBjb3NpbmUKCiAgICAgIGNvc29tID0gYXggKiBieCArIGF5ICogYnkgKyBheiAqIGJ6ICsgYXcgKiBidzsgLy8gYWRqdXN0IHNpZ25zIChpZiBuZWNlc3NhcnkpCgogICAgICBpZiAoY29zb20gPCAwLjApIHsKICAgICAgICBjb3NvbSA9IC1jb3NvbTsKICAgICAgICBieCA9IC1ieDsKICAgICAgICBieSA9IC1ieTsKICAgICAgICBieiA9IC1iejsKICAgICAgICBidyA9IC1idzsKICAgICAgfSAvLyBjYWxjdWxhdGUgY29lZmZpY2llbnRzCgoKICAgICAgaWYgKDEuMCAtIGNvc29tID4gMC4wMDAwMDEpIHsKICAgICAgICAvLyBzdGFuZGFyZCBjYXNlIChzbGVycCkKICAgICAgICBvbWVnYSA9IE1hdGguYWNvcyhjb3NvbSk7CiAgICAgICAgc2lub20gPSBNYXRoLnNpbihvbWVnYSk7CiAgICAgICAgc2NhbGUwID0gTWF0aC5zaW4oKDEuMCAtIHQpICogb21lZ2EpIC8gc2lub207CiAgICAgICAgc2NhbGUxID0gTWF0aC5zaW4odCAqIG9tZWdhKSAvIHNpbm9tOwogICAgICB9IGVsc2UgewogICAgICAgIC8vICJmcm9tIiBhbmQgInRvIiBxdWF0ZXJuaW9ucyBhcmUgdmVyeSBjbG9zZQogICAgICAgIC8vICAuLi4gc28gd2UgY2FuIGRvIGEgbGluZWFyIGludGVycG9sYXRpb24KICAgICAgICBzY2FsZTAgPSAxLjAgLSB0OwogICAgICAgIHNjYWxlMSA9IHQ7CiAgICAgIH0gLy8gY2FsY3VsYXRlIGZpbmFsIHZhbHVlcwoKCiAgICAgIHRhcmdldC54ID0gc2NhbGUwICogYXggKyBzY2FsZTEgKiBieDsKICAgICAgdGFyZ2V0LnkgPSBzY2FsZTAgKiBheSArIHNjYWxlMSAqIGJ5OwogICAgICB0YXJnZXQueiA9IHNjYWxlMCAqIGF6ICsgc2NhbGUxICogYno7CiAgICAgIHRhcmdldC53ID0gc2NhbGUwICogYXcgKyBzY2FsZTEgKiBidzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogUm90YXRlIGFuIGFic29sdXRlIG9yaWVudGF0aW9uIHF1YXRlcm5pb24gZ2l2ZW4gYW4gYW5ndWxhciB2ZWxvY2l0eSBhbmQgYSB0aW1lIHN0ZXAuCiAgICAgKi8KCgogICAgaW50ZWdyYXRlKGFuZ3VsYXJWZWxvY2l0eSwgZHQsIGFuZ3VsYXJGYWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICBjb25zdCBheCA9IGFuZ3VsYXJWZWxvY2l0eS54ICogYW5ndWxhckZhY3Rvci54LAogICAgICAgICAgICBheSA9IGFuZ3VsYXJWZWxvY2l0eS55ICogYW5ndWxhckZhY3Rvci55LAogICAgICAgICAgICBheiA9IGFuZ3VsYXJWZWxvY2l0eS56ICogYW5ndWxhckZhY3Rvci56LAogICAgICAgICAgICBieCA9IHRoaXMueCwKICAgICAgICAgICAgYnkgPSB0aGlzLnksCiAgICAgICAgICAgIGJ6ID0gdGhpcy56LAogICAgICAgICAgICBidyA9IHRoaXMudzsKICAgICAgY29uc3QgaGFsZl9kdCA9IGR0ICogMC41OwogICAgICB0YXJnZXQueCArPSBoYWxmX2R0ICogKGF4ICogYncgKyBheSAqIGJ6IC0gYXogKiBieSk7CiAgICAgIHRhcmdldC55ICs9IGhhbGZfZHQgKiAoYXkgKiBidyArIGF6ICogYnggLSBheCAqIGJ6KTsKICAgICAgdGFyZ2V0LnogKz0gaGFsZl9kdCAqIChheiAqIGJ3ICsgYXggKiBieSAtIGF5ICogYngpOwogICAgICB0YXJnZXQudyArPSBoYWxmX2R0ICogKC1heCAqIGJ4IC0gYXkgKiBieSAtIGF6ICogYnopOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICB9CgogIGNvbnN0IHNmdl90MSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc2Z2X3QyID0gbmV3IFZlYzMoKTsKICAvKioKICAgKiBUaGUgYXZhaWxhYmxlIHNoYXBlIHR5cGVzLgogICAqLwoKICBjb25zdCBTSEFQRV9UWVBFUyA9IHsKICAgIC8qKiBTUEhFUkUgKi8KICAgIFNQSEVSRTogMSwKCiAgICAvKiogUExBTkUgKi8KICAgIFBMQU5FOiAyLAoKICAgIC8qKiBCT1ggKi8KICAgIEJPWDogNCwKCiAgICAvKiogQ09NUE9VTkQgKi8KICAgIENPTVBPVU5EOiA4LAoKICAgIC8qKiBDT05WRVhQT0xZSEVEUk9OICovCiAgICBDT05WRVhQT0xZSEVEUk9OOiAxNiwKCiAgICAvKiogSEVJR0hURklFTEQgKi8KICAgIEhFSUdIVEZJRUxEOiAzMiwKCiAgICAvKiogUEFSVElDTEUgKi8KICAgIFBBUlRJQ0xFOiA2NCwKCiAgICAvKiogQ1lMSU5ERVIgKi8KICAgIENZTElOREVSOiAxMjgsCgogICAgLyoqIFRSSU1FU0ggKi8KICAgIFRSSU1FU0g6IDI1NgogIH07CiAgLyoqCiAgICogU2hhcGVUeXBlCiAgICovCgogIC8qKgogICAqIEJhc2UgY2xhc3MgZm9yIHNoYXBlcwogICAqLwoKICBjbGFzcyBTaGFwZSB7CiAgICAvKioKICAgICAqIElkZW50aWZpZXIgb2YgdGhlIFNoYXBlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHlwZSBvZiB0aGlzIHNoYXBlLiBNdXN0IGJlIHNldCB0byBhbiBpbnQgPiAwIGJ5IHN1YmNsYXNzZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBib3VuZGluZyBzcGhlcmUgcmFkaXVzIG9mIHRoaXMgc2hhcGUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcHJvZHVjZSBjb250YWN0IGZvcmNlcyB3aGVuIGluIGNvbnRhY3Qgd2l0aCBvdGhlciBib2RpZXMuIE5vdGUgdGhhdCBjb250YWN0cyB3aWxsIGJlIGdlbmVyYXRlZCwgYnV0IHRoZXkgd2lsbCBiZSBkaXNhYmxlZC4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBPcHRpb25hbCBtYXRlcmlhbCBvZiB0aGUgc2hhcGUgdGhhdCByZWd1bGF0ZXMgY29udGFjdCBwcm9wZXJ0aWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYm9keSB0byB3aGljaCB0aGUgc2hhcGUgaXMgYWRkZWQgdG8uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCB0aGUgU2hhcGUgdHlwZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5pZCA9IHZvaWQgMDsKICAgICAgdGhpcy50eXBlID0gdm9pZCAwOwogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gdm9pZCAwOwogICAgICB0aGlzLmNvbGxpc2lvblJlc3BvbnNlID0gdm9pZCAwOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gdm9pZCAwOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSB2b2lkIDA7CiAgICAgIHRoaXMubWF0ZXJpYWwgPSB2b2lkIDA7CiAgICAgIHRoaXMuYm9keSA9IHZvaWQgMDsKICAgICAgdGhpcy5pZCA9IFNoYXBlLmlkQ291bnRlcisrOwogICAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgMDsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IDA7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID8gb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgPyBvcHRpb25zLm1hdGVyaWFsIDogbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIGJvdW5kaW5nIHNwaGVyZSByYWRpdXMuCiAgICAgKiBUaGUgcmVzdWx0IGlzIHN0b3JlZCBpbiB0aGUgcHJvcGVydHkgYC5ib3VuZGluZ1NwaGVyZVJhZGl1c2AKICAgICAqLwoKCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhyb3cgImNvbXB1dGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAiICsgdGhpcy50eXBlOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHZvbHVtZSBvZiB0aGlzIHNoYXBlCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICB0aHJvdyAidm9sdW1lKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICIgKyB0aGlzLnR5cGU7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZXMgdGhlIGluZXJ0aWEgaW4gdGhlIGxvY2FsIGZyYW1lIGZvciB0aGlzIHNoYXBlLgogICAgICogQHNlZSBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbW9tZW50c19vZl9pbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICB0aHJvdyAiY2FsY3VsYXRlTG9jYWxJbmVydGlhKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICIgKyB0aGlzLnR5cGU7CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIHVzZSBhYnN0cmFjdCBmb3IgdGhlc2Uga2luZCBvZiBtZXRob2RzCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgdGhyb3cgImNhbGN1bGF0ZVdvcmxkQUFCQigpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAiICsgdGhpcy50eXBlOwogICAgfQoKICB9CgogIFNoYXBlLmlkQ291bnRlciA9IDA7CiAgU2hhcGUudHlwZXMgPSBTSEFQRV9UWVBFUzsKICAvKioKICAgKiBUcmFuc2Zvcm1hdGlvbiB1dGlsaXRpZXMuCiAgICovCgogIGNsYXNzIFRyYW5zZm9ybSB7CiAgICAvKioKICAgICAqIHBvc2l0aW9uCiAgICAgKi8KCiAgICAvKioKICAgICAqIHF1YXRlcm5pb24KICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnBvc2l0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLnF1YXRlcm5pb24gPSB2b2lkIDA7CiAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKG9wdGlvbnMucG9zaXRpb24pIHsKICAgICAgICB0aGlzLnBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIGdsb2JhbCBwb2ludCBpbiBsb2NhbCB0cmFuc2Zvcm0gY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgcG9pbnRUb0xvY2FsKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICByZXR1cm4gVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHRoaXMucG9zaXRpb24sIHRoaXMucXVhdGVybmlvbiwgd29ybGRQb2ludCwgcmVzdWx0KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgbG9jYWwgcG9pbnQgaW4gZ2xvYmFsIHRyYW5zZm9ybSBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBwb2ludFRvV29ybGQobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIHJldHVybiBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5wb3NpdGlvbiwgdGhpcy5xdWF0ZXJuaW9uLCBsb2NhbFBvaW50LCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb1dvcmxkRnJhbWUKICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHBvaW50VG9Mb2NhbEZyYW1lCiAgICAgKi8KCgogICAgc3RhdGljIHBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgd29ybGRQb2ludC52c3ViKHBvc2l0aW9uLCByZXN1bHQpOwogICAgICBxdWF0ZXJuaW9uLmNvbmp1Z2F0ZSh0bXBRdWF0JDEpOwogICAgICB0bXBRdWF0JDEudm11bHQocmVzdWx0LCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBwb2ludFRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyBwb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdGVybmlvbiwgbG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udm11bHQobG9jYWxQb2ludCwgcmVzdWx0KTsKICAgICAgcmVzdWx0LnZhZGQocG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHZlY3RvclRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyB2ZWN0b3JUb1dvcmxkRnJhbWUocXVhdGVybmlvbiwgbG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBxdWF0ZXJuaW9uLnZtdWx0KGxvY2FsVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb0xvY2FsRnJhbWUKICAgICAqLwoKCiAgICBzdGF0aWMgdmVjdG9yVG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udyAqPSAtMTsKICAgICAgcXVhdGVybmlvbi52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcXVhdGVybmlvbi53ICo9IC0xOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CgogIGNvbnN0IHRtcFF1YXQkMSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgLyoqCiAgICogQSBzZXQgb2YgcG9seWdvbnMgZGVzY3JpYmluZyBhIGNvbnZleCBzaGFwZS4KICAgKgogICAqIFRoZSBzaGFwZSBNVVNUIGJlIGNvbnZleCBmb3IgdGhlIGNvZGUgdG8gd29yayBwcm9wZXJseS4gTm8gcG9seWdvbnMgbWF5IGJlIGNvcGxhbmFyIChjb250YWluZWQKICAgKiBpbiB0aGUgc2FtZSAzRCBwbGFuZSksIGluc3RlYWQgdGhlc2Ugc2hvdWxkIGJlIG1lcmdlZCBpbnRvIG9uZSBwb2x5Z29uLgogICAqCiAgICogQGF1dGhvciBxaWFvIC8gaHR0cHM6Ly9naXRodWIuY29tL3FpYW8gKG9yaWdpbmFsIGF1dGhvciwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9xaWFvL3RocmVlLmpzL2NvbW1pdC84NTAyNmYwYzc2OWU0MDAwMTQ4YTY3ZDQ1YTllOWI5YzUxMDg4MzZmKQogICAqIEBhdXRob3Igc2NodGVwcGUgLyBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUKICAgKiBAc2VlIGh0dHBzOi8vd3d3LmFsdGRldmJsb2dhZGF5LmNvbS8yMDExLzA1LzEzL2NvbnRhY3QtZ2VuZXJhdGlvbi1iZXR3ZWVuLTNkLWNvbnZleC1tZXNoZXMvCiAgICoKICAgKiBAdG9kbyBNb3ZlIHRoZSBjbGlwcGluZyBmdW5jdGlvbnMgdG8gQ29udGFjdEdlbmVyYXRvcj8KICAgKiBAdG9kbyBBdXRvbWF0aWNhbGx5IG1lcmdlIGNvcGxhbmFyIHBvbHlnb25zIGluIGNvbnN0cnVjdG9yLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGNvbnZleFNoYXBlID0gbmV3IENBTk5PTi5Db252ZXhQb2x5aGVkcm9uKHsgdmVydGljZXMsIGZhY2VzIH0pCiAgICogICAgIGNvbnN0IGNvbnZleEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY29udmV4U2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShjb252ZXhCb2R5KQogICAqLwoKICBjbGFzcyBDb252ZXhQb2x5aGVkcm9uIGV4dGVuZHMgU2hhcGUgewogICAgLyoqIHZlcnRpY2VzICovCgogICAgLyoqCiAgICAgKiBBcnJheSBvZiBpbnRlZ2VyIGFycmF5cywgaW5kaWNhdGluZyB3aGljaCB2ZXJ0aWNlcyBlYWNoIGZhY2UgY29uc2lzdHMgb2YKICAgICAqLwoKICAgIC8qKiBmYWNlTm9ybWFscyAqLwoKICAgIC8qKiB3b3JsZFZlcnRpY2VzICovCgogICAgLyoqIHdvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSAqLwoKICAgIC8qKiB3b3JsZEZhY2VOb3JtYWxzICovCgogICAgLyoqIHdvcmxkRmFjZU5vcm1hbHNOZWVkc1VwZGF0ZSAqLwoKICAgIC8qKgogICAgICogSWYgZ2l2ZW4sIHRoZXNlIGxvY2FsbHkgZGVmaW5lZCwgbm9ybWFsaXplZCBheGVzIGFyZSB0aGUgb25seSBvbmVzIGJlaW5nIGNoZWNrZWQgd2hlbiBkb2luZyBzZXBhcmF0aW5nIGF4aXMgY2hlY2suCiAgICAgKi8KCiAgICAvKiogdW5pcXVlRWRnZXMgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSB2ZXJ0aWNlcyBBbiBhcnJheSBvZiBWZWMzJ3MKICAgICAqIEBwYXJhbSBmYWNlcyBBcnJheSBvZiBpbnRlZ2VyIGFycmF5cywgZGVzY3JpYmluZyB3aGljaCB2ZXJ0aWNlcyB0aGF0IGlzIGluY2x1ZGVkIGluIGVhY2ggZmFjZS4KICAgICAqLwogICAgY29uc3RydWN0b3IocHJvcHMpIHsKICAgICAgaWYgKHByb3BzID09PSB2b2lkIDApIHsKICAgICAgICBwcm9wcyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCB7CiAgICAgICAgdmVydGljZXMgPSBbXSwKICAgICAgICBmYWNlcyA9IFtdLAogICAgICAgIG5vcm1hbHMgPSBbXSwKICAgICAgICBheGVzLAogICAgICAgIGJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgIH0gPSBwcm9wczsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04KICAgICAgfSk7CiAgICAgIHRoaXMudmVydGljZXMgPSB2b2lkIDA7CiAgICAgIHRoaXMuZmFjZXMgPSB2b2lkIDA7CiAgICAgIHRoaXMuZmFjZU5vcm1hbHMgPSB2b2lkIDA7CiAgICAgIHRoaXMud29ybGRWZXJ0aWNlcyA9IHZvaWQgMDsKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUgPSB2b2lkIDA7CiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFscyA9IHZvaWQgMDsKICAgICAgdGhpcy53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUgPSB2b2lkIDA7CiAgICAgIHRoaXMudW5pcXVlQXhlcyA9IHZvaWQgMDsKICAgICAgdGhpcy51bmlxdWVFZGdlcyA9IHZvaWQgMDsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzOwogICAgICB0aGlzLmZhY2VzID0gZmFjZXM7CiAgICAgIHRoaXMuZmFjZU5vcm1hbHMgPSBub3JtYWxzOwoKICAgICAgaWYgKHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5jb21wdXRlTm9ybWFscygpOwogICAgICB9CgogICAgICBpZiAoIWJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBib3VuZGluZ1NwaGVyZVJhZGl1czsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzID0gW107IC8vIFdvcmxkIHRyYW5zZm9ybWVkIHZlcnNpb24gb2YgLnZlcnRpY2VzCgogICAgICB0aGlzLndvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFscyA9IFtdOyAvLyBXb3JsZCB0cmFuc2Zvcm1lZCB2ZXJzaW9uIG9mIC5mYWNlTm9ybWFscwoKICAgICAgdGhpcy53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB0aGlzLnVuaXF1ZUF4ZXMgPSBheGVzID8gYXhlcy5zbGljZSgpIDogbnVsbDsKICAgICAgdGhpcy51bmlxdWVFZGdlcyA9IFtdOwogICAgICB0aGlzLmNvbXB1dGVFZGdlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB1bmlxdWVFZGdlcwogICAgICovCgoKICAgIGNvbXB1dGVFZGdlcygpIHsKICAgICAgY29uc3QgZmFjZXMgPSB0aGlzLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IGVkZ2VzID0gdGhpcy51bmlxdWVFZGdlczsKICAgICAgZWRnZXMubGVuZ3RoID0gMDsKICAgICAgY29uc3QgZWRnZSA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07CiAgICAgICAgY29uc3QgbnVtVmVydGljZXMgPSBmYWNlLmxlbmd0aDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IG51bVZlcnRpY2VzOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGsgPSAoaiArIDEpICUgbnVtVmVydGljZXM7CiAgICAgICAgICB2ZXJ0aWNlc1tmYWNlW2pdXS52c3ViKHZlcnRpY2VzW2ZhY2Vba11dLCBlZGdlKTsKICAgICAgICAgIGVkZ2Uubm9ybWFsaXplKCk7CiAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKCiAgICAgICAgICBmb3IgKGxldCBwID0gMDsgcCAhPT0gZWRnZXMubGVuZ3RoOyBwKyspIHsKICAgICAgICAgICAgaWYgKGVkZ2VzW3BdLmFsbW9zdEVxdWFscyhlZGdlKSB8fCBlZGdlc1twXS5hbG1vc3RFcXVhbHMoZWRnZSkpIHsKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgIGVkZ2VzLnB1c2goZWRnZS5jbG9uZSgpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuCiAgICAgKiBXaWxsIHJldXNlIGV4aXN0aW5nIFZlYzMgb2JqZWN0cyBpbiB0aGUgYGZhY2VOb3JtYWxzYCBhcnJheSBpZiB0aGV5IGV4aXN0LgogICAgICovCgoKICAgIGNvbXB1dGVOb3JtYWxzKCkgewogICAgICB0aGlzLmZhY2VOb3JtYWxzLmxlbmd0aCA9IHRoaXMuZmFjZXMubGVuZ3RoOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBDaGVjayBzbyBhbGwgdmVydGljZXMgZXhpc3RzIGZvciB0aGlzIGZhY2UKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZmFjZXNbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICghdGhpcy52ZXJ0aWNlc1t0aGlzLmZhY2VzW2ldW2pdXSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlZlcnRleCAiICsgdGhpcy5mYWNlc1tpXVtqXSArICIgbm90IGZvdW5kISIpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgY29uc3QgbiA9IHRoaXMuZmFjZU5vcm1hbHNbaV0gfHwgbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLmdldEZhY2VOb3JtYWwoaSwgbik7CiAgICAgICAgbi5uZWdhdGUobik7CiAgICAgICAgdGhpcy5mYWNlTm9ybWFsc1tpXSA9IG47CiAgICAgICAgY29uc3QgdmVydGV4ID0gdGhpcy52ZXJ0aWNlc1t0aGlzLmZhY2VzW2ldWzBdXTsKCiAgICAgICAgaWYgKG4uZG90KHZlcnRleCkgPCAwKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCIuZmFjZU5vcm1hbHNbIiArIGkgKyAiXSA9IFZlYzMoIiArIG4udG9TdHJpbmcoKSArICIpIGxvb2tzIGxpa2UgaXQgcG9pbnRzIGludG8gdGhlIHNoYXBlPyBUaGUgdmVydGljZXMgZm9sbG93LiBNYWtlIHN1cmUgdGhleSBhcmUgb3JkZXJlZCBDQ1cgYXJvdW5kIHRoZSBub3JtYWwsIHVzaW5nIHRoZSByaWdodCBoYW5kIHJ1bGUuIik7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmZhY2VzW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybigiLnZlcnRpY2VzWyIgKyB0aGlzLmZhY2VzW2ldW2pdICsgIl0gPSBWZWMzKCIgKyB0aGlzLnZlcnRpY2VzW3RoaXMuZmFjZXNbaV1bal1dLnRvU3RyaW5nKCkgKyAiKSIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlIHRoZSBub3JtYWwgb2YgYSBmYWNlIGZyb20gaXRzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgZ2V0RmFjZU5vcm1hbChpLCB0YXJnZXQpIHsKICAgICAgY29uc3QgZiA9IHRoaXMuZmFjZXNbaV07CiAgICAgIGNvbnN0IHZhID0gdGhpcy52ZXJ0aWNlc1tmWzBdXTsKICAgICAgY29uc3QgdmIgPSB0aGlzLnZlcnRpY2VzW2ZbMV1dOwogICAgICBjb25zdCB2YyA9IHRoaXMudmVydGljZXNbZlsyXV07CiAgICAgIENvbnZleFBvbHloZWRyb24uY29tcHV0ZU5vcm1hbCh2YSwgdmIsIHZjLCB0YXJnZXQpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgZmFjZSBub3JtYWwgZ2l2ZW4gMyB2ZXJ0aWNlcwogICAgICovCgoKICAgIHN0YXRpYyBjb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCkgewogICAgICBjb25zdCBjYiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGFiID0gbmV3IFZlYzMoKTsKICAgICAgdmIudnN1Yih2YSwgYWIpOwogICAgICB2Yy52c3ViKHZiLCBjYik7CiAgICAgIGNiLmNyb3NzKGFiLCB0YXJnZXQpOwoKICAgICAgaWYgKCF0YXJnZXQuaXNaZXJvKCkpIHsKICAgICAgICB0YXJnZXQubm9ybWFsaXplKCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQHBhcmFtIG1pbkRpc3QgQ2xhbXAgZGlzdGFuY2UKICAgICAqIEBwYXJhbSByZXN1bHQgVGhlIGFuIGFycmF5IG9mIGNvbnRhY3QgcG9pbnQgb2JqZWN0cywgc2VlIGNsaXBGYWNlQWdhaW5zdEh1bGwKICAgICAqLwoKCiAgICBjbGlwQWdhaW5zdEh1bGwocG9zQSwgcXVhdEEsIGh1bGxCLCBwb3NCLCBxdWF0Qiwgc2VwYXJhdGluZ05vcm1hbCwgbWluRGlzdCwgbWF4RGlzdCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IFdvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICAgICAgbGV0IGNsb3Nlc3RGYWNlQiA9IC0xOwogICAgICBsZXQgZG1heCA9IC1OdW1iZXIuTUFYX1ZBTFVFOwoKICAgICAgZm9yIChsZXQgZmFjZSA9IDA7IGZhY2UgPCBodWxsQi5mYWNlcy5sZW5ndGg7IGZhY2UrKykgewogICAgICAgIFdvcmxkTm9ybWFsLmNvcHkoaHVsbEIuZmFjZU5vcm1hbHNbZmFjZV0pOwogICAgICAgIHF1YXRCLnZtdWx0KFdvcmxkTm9ybWFsLCBXb3JsZE5vcm1hbCk7CiAgICAgICAgY29uc3QgZCA9IFdvcmxkTm9ybWFsLmRvdChzZXBhcmF0aW5nTm9ybWFsKTsKCiAgICAgICAgaWYgKGQgPiBkbWF4KSB7CiAgICAgICAgICBkbWF4ID0gZDsKICAgICAgICAgIGNsb3Nlc3RGYWNlQiA9IGZhY2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBjb25zdCB3b3JsZFZlcnRzQjEgPSBbXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaHVsbEIuZmFjZXNbY2xvc2VzdEZhY2VCXS5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGIgPSBodWxsQi52ZXJ0aWNlc1todWxsQi5mYWNlc1tjbG9zZXN0RmFjZUJdW2ldXTsKICAgICAgICBjb25zdCB3b3JsZGIgPSBuZXcgVmVjMygpOwogICAgICAgIHdvcmxkYi5jb3B5KGIpOwogICAgICAgIHF1YXRCLnZtdWx0KHdvcmxkYiwgd29ybGRiKTsKICAgICAgICBwb3NCLnZhZGQod29ybGRiLCB3b3JsZGIpOwogICAgICAgIHdvcmxkVmVydHNCMS5wdXNoKHdvcmxkYik7CiAgICAgIH0KCiAgICAgIGlmIChjbG9zZXN0RmFjZUIgPj0gMCkgewogICAgICAgIHRoaXMuY2xpcEZhY2VBZ2FpbnN0SHVsbChzZXBhcmF0aW5nTm9ybWFsLCBwb3NBLCBxdWF0QSwgd29ybGRWZXJ0c0IxLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEZpbmQgdGhlIHNlcGFyYXRpbmcgYXhpcyBiZXR3ZWVuIHRoaXMgaHVsbCBhbmQgYW5vdGhlcgogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdGFyZ2V0IHZlY3RvciB0byBzYXZlIHRoZSBheGlzIGluCiAgICAgKiBAcmV0dXJuIFJldHVybnMgZmFsc2UgaWYgYSBzZXBhcmF0aW9uIGlzIGZvdW5kLCBlbHNlIHRydWUKICAgICAqLwoKCiAgICBmaW5kU2VwYXJhdGluZ0F4aXMoaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0QiwgdGFyZ2V0LCBmYWNlTGlzdEEsIGZhY2VMaXN0QikgewogICAgICBjb25zdCBmYWNlQU5vcm1hbFdTMyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IFdvcmxkbm9ybWFsMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGRlbHRhQyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkRWRnZTAgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCB3b3JsZEVkZ2UxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgQ3Jvc3MgPSBuZXcgVmVjMygpOwogICAgICBsZXQgZG1pbiA9IE51bWJlci5NQVhfVkFMVUU7CiAgICAgIGNvbnN0IGh1bGxBID0gdGhpczsKCiAgICAgIGlmICghaHVsbEEudW5pcXVlQXhlcykgewogICAgICAgIGNvbnN0IG51bUZhY2VzQSA9IGZhY2VMaXN0QSA/IGZhY2VMaXN0QS5sZW5ndGggOiBodWxsQS5mYWNlcy5sZW5ndGg7IC8vIFRlc3QgZmFjZSBub3JtYWxzIGZyb20gaHVsbEEKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1GYWNlc0E7IGkrKykgewogICAgICAgICAgY29uc3QgZmkgPSBmYWNlTGlzdEEgPyBmYWNlTGlzdEFbaV0gOiBpOyAvLyBHZXQgd29ybGQgZmFjZSBub3JtYWwKCiAgICAgICAgICBmYWNlQU5vcm1hbFdTMy5jb3B5KGh1bGxBLmZhY2VOb3JtYWxzW2ZpXSk7CiAgICAgICAgICBxdWF0QS52bXVsdChmYWNlQU5vcm1hbFdTMywgZmFjZUFOb3JtYWxXUzMpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKGZhY2VBTm9ybWFsV1MzLCBodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCKTsKCiAgICAgICAgICBpZiAoZCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChkIDwgZG1pbikgewogICAgICAgICAgICBkbWluID0gZDsKICAgICAgICAgICAgdGFyZ2V0LmNvcHkoZmFjZUFOb3JtYWxXUzMpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUZXN0IHVuaXF1ZSBheGVzCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IGh1bGxBLnVuaXF1ZUF4ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIC8vIEdldCB3b3JsZCBheGlzCiAgICAgICAgICBxdWF0QS52bXVsdChodWxsQS51bmlxdWVBeGVzW2ldLCBmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICBjb25zdCBkID0gaHVsbEEudGVzdFNlcEF4aXMoZmFjZUFOb3JtYWxXUzMsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoIWh1bGxCLnVuaXF1ZUF4ZXMpIHsKICAgICAgICAvLyBUZXN0IGZhY2Ugbm9ybWFscyBmcm9tIGh1bGxCCiAgICAgICAgY29uc3QgbnVtRmFjZXNCID0gZmFjZUxpc3RCID8gZmFjZUxpc3RCLmxlbmd0aCA6IGh1bGxCLmZhY2VzLmxlbmd0aDsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1GYWNlc0I7IGkrKykgewogICAgICAgICAgY29uc3QgZmkgPSBmYWNlTGlzdEIgPyBmYWNlTGlzdEJbaV0gOiBpOwogICAgICAgICAgV29ybGRub3JtYWwxLmNvcHkoaHVsbEIuZmFjZU5vcm1hbHNbZmldKTsKICAgICAgICAgIHF1YXRCLnZtdWx0KFdvcmxkbm9ybWFsMSwgV29ybGRub3JtYWwxKTsKICAgICAgICAgIGNvbnN0IGQgPSBodWxsQS50ZXN0U2VwQXhpcyhXb3JsZG5vcm1hbDEsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShXb3JsZG5vcm1hbDEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUZXN0IHVuaXF1ZSBheGVzIGluIEIKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gaHVsbEIudW5pcXVlQXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgcXVhdEIudm11bHQoaHVsbEIudW5pcXVlQXhlc1tpXSwgV29ybGRub3JtYWwxKTsKICAgICAgICAgIGNvbnN0IGQgPSBodWxsQS50ZXN0U2VwQXhpcyhXb3JsZG5vcm1hbDEsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShXb3JsZG5vcm1hbDEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBUZXN0IGVkZ2VzCgoKICAgICAgZm9yIChsZXQgZTAgPSAwOyBlMCAhPT0gaHVsbEEudW5pcXVlRWRnZXMubGVuZ3RoOyBlMCsrKSB7CiAgICAgICAgLy8gR2V0IHdvcmxkIGVkZ2UKICAgICAgICBxdWF0QS52bXVsdChodWxsQS51bmlxdWVFZGdlc1tlMF0sIHdvcmxkRWRnZTApOwoKICAgICAgICBmb3IgKGxldCBlMSA9IDA7IGUxICE9PSBodWxsQi51bmlxdWVFZGdlcy5sZW5ndGg7IGUxKyspIHsKICAgICAgICAgIC8vIEdldCB3b3JsZCBlZGdlIDIKICAgICAgICAgIHF1YXRCLnZtdWx0KGh1bGxCLnVuaXF1ZUVkZ2VzW2UxXSwgd29ybGRFZGdlMSk7CiAgICAgICAgICB3b3JsZEVkZ2UwLmNyb3NzKHdvcmxkRWRnZTEsIENyb3NzKTsKCiAgICAgICAgICBpZiAoIUNyb3NzLmFsbW9zdFplcm8oKSkgewogICAgICAgICAgICBDcm9zcy5ub3JtYWxpemUoKTsKICAgICAgICAgICAgY29uc3QgZGlzdCA9IGh1bGxBLnRlc3RTZXBBeGlzKENyb3NzLCBodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCKTsKCiAgICAgICAgICAgIGlmIChkaXN0ID09PSBmYWxzZSkgewogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGRpc3QgPCBkbWluKSB7CiAgICAgICAgICAgICAgZG1pbiA9IGRpc3Q7CiAgICAgICAgICAgICAgdGFyZ2V0LmNvcHkoQ3Jvc3MpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBwb3NCLnZzdWIocG9zQSwgZGVsdGFDKTsKCiAgICAgIGlmIChkZWx0YUMuZG90KHRhcmdldCkgPiAwLjApIHsKICAgICAgICB0YXJnZXQubmVnYXRlKHRhcmdldCk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBUZXN0IHNlcGFyYXRpbmcgYXhpcyBhZ2FpbnN0IHR3byBodWxscy4gQm90aCBodWxscyBhcmUgcHJvamVjdGVkIG9udG8gdGhlIGF4aXMgYW5kIHRoZSBvdmVybGFwIHNpemUgaXMgcmV0dXJuZWQgaWYgdGhlcmUgaXMgb25lLgogICAgICogQHJldHVybiBUaGUgb3ZlcmxhcCBkZXB0aCwgb3IgRkFMU0UgaWYgbm8gcGVuZXRyYXRpb24uCiAgICAgKi8KCgogICAgdGVzdFNlcEF4aXMoYXhpcywgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0QikgewogICAgICBjb25zdCBodWxsQSA9IHRoaXM7CiAgICAgIENvbnZleFBvbHloZWRyb24ucHJvamVjdChodWxsQSwgYXhpcywgcG9zQSwgcXVhdEEsIG1heG1pbkEpOwogICAgICBDb252ZXhQb2x5aGVkcm9uLnByb2plY3QoaHVsbEIsIGF4aXMsIHBvc0IsIHF1YXRCLCBtYXhtaW5CKTsKICAgICAgY29uc3QgbWF4QSA9IG1heG1pbkFbMF07CiAgICAgIGNvbnN0IG1pbkEgPSBtYXhtaW5BWzFdOwogICAgICBjb25zdCBtYXhCID0gbWF4bWluQlswXTsKICAgICAgY29uc3QgbWluQiA9IG1heG1pbkJbMV07CgogICAgICBpZiAobWF4QSA8IG1pbkIgfHwgbWF4QiA8IG1pbkEpIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIFNlcGFyYXRlZAogICAgICB9CgogICAgICBjb25zdCBkMCA9IG1heEEgLSBtaW5COwogICAgICBjb25zdCBkMSA9IG1heEIgLSBtaW5BOwogICAgICBjb25zdCBkZXB0aCA9IGQwIDwgZDEgPyBkMCA6IGQxOwogICAgICByZXR1cm4gZGVwdGg7CiAgICB9CiAgICAvKioKICAgICAqIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYQogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgLy8gQXBwcm94aW1hdGUgd2l0aCBib3ggaW5lcnRpYQogICAgICAvLyBFeGFjdCBpbmVydGlhIGNhbGN1bGF0aW9uIGlzIG92ZXJraWxsLCBidXQgc2VlIGh0dHA6Ly9nZW9tZXRyaWN0b29scy5jb20vRG9jdW1lbnRhdGlvbi9Qb2x5aGVkcmFsTWFzc1Byb3BlcnRpZXMucGRmIGZvciB0aGUgY29ycmVjdCB3YXkgdG8gZG8gaXQKICAgICAgY29uc3QgYWFiYm1heCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGFhYmJtaW4gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIoYWFiYm1pbiwgYWFiYm1heCk7CiAgICAgIGNvbnN0IHggPSBhYWJibWF4LnggLSBhYWJibWluLng7CiAgICAgIGNvbnN0IHkgPSBhYWJibWF4LnkgLSBhYWJibWluLnk7CiAgICAgIGNvbnN0IHogPSBhYWJibWF4LnogLSBhYWJibWluLno7CiAgICAgIHRhcmdldC54ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHkgKiAyICogeSArIDIgKiB6ICogMiAqIHopOwogICAgICB0YXJnZXQueSA9IDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB4ICogMiAqIHggKyAyICogeiAqIDIgKiB6KTsKICAgICAgdGFyZ2V0LnogPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHggKiAyICogeCk7CiAgICB9CiAgICAvKioKICAgICAqIEBwYXJhbSBmYWNlX2kgSW5kZXggb2YgdGhlIGZhY2UKICAgICAqLwoKCiAgICBnZXRQbGFuZUNvbnN0YW50T2ZGYWNlKGZhY2VfaSkgewogICAgICBjb25zdCBmID0gdGhpcy5mYWNlc1tmYWNlX2ldOwogICAgICBjb25zdCBuID0gdGhpcy5mYWNlTm9ybWFsc1tmYWNlX2ldOwogICAgICBjb25zdCB2ID0gdGhpcy52ZXJ0aWNlc1tmWzBdXTsKICAgICAgY29uc3QgYyA9IC1uLmRvdCh2KTsKICAgICAgcmV0dXJuIGM7CiAgICB9CiAgICAvKioKICAgICAqIENsaXAgYSBmYWNlIGFnYWluc3QgYSBodWxsLgogICAgICogQHBhcmFtIHdvcmxkVmVydHNCMSBBbiBhcnJheSBvZiBWZWMzIHdpdGggdmVydGljZXMgaW4gdGhlIHdvcmxkIGZyYW1lLgogICAgICogQHBhcmFtIG1pbkRpc3QgRGlzdGFuY2UgY2xhbXBpbmcKICAgICAqIEBwYXJhbSBBcnJheSByZXN1bHQgQXJyYXkgdG8gc3RvcmUgcmVzdWx0aW5nIGNvbnRhY3QgcG9pbnRzIGluLiBXaWxsIGJlIG9iamVjdHMgd2l0aCBwcm9wZXJ0aWVzOiBwb2ludCwgZGVwdGgsIG5vcm1hbC4gVGhlc2UgYXJlIHJlcHJlc2VudGVkIGluIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICovCgoKICAgIGNsaXBGYWNlQWdhaW5zdEh1bGwoc2VwYXJhdGluZ05vcm1hbCwgcG9zQSwgcXVhdEEsIHdvcmxkVmVydHNCMSwgbWluRGlzdCwgbWF4RGlzdCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IGZhY2VBTm9ybWFsV1MgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBlZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IFdvcmxkRWRnZTAgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCB3b3JsZFBsYW5lQW5vcm1hbDEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwbGFuZU5vcm1hbFdTMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkQTEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBsb2NhbFBsYW5lTm9ybWFsID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGxhbmVOb3JtYWxXUyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGh1bGxBID0gdGhpczsKICAgICAgY29uc3Qgd29ybGRWZXJ0c0IyID0gW107CiAgICAgIGNvbnN0IHBWdHhJbiA9IHdvcmxkVmVydHNCMTsKICAgICAgY29uc3QgcFZ0eE91dCA9IHdvcmxkVmVydHNCMjsKICAgICAgbGV0IGNsb3Nlc3RGYWNlQSA9IC0xOwogICAgICBsZXQgZG1pbiA9IE51bWJlci5NQVhfVkFMVUU7IC8vIEZpbmQgdGhlIGZhY2Ugd2l0aCBub3JtYWwgY2xvc2VzdCB0byB0aGUgc2VwYXJhdGluZyBheGlzCgogICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IGh1bGxBLmZhY2VzLmxlbmd0aDsgZmFjZSsrKSB7CiAgICAgICAgZmFjZUFOb3JtYWxXUy5jb3B5KGh1bGxBLmZhY2VOb3JtYWxzW2ZhY2VdKTsKICAgICAgICBxdWF0QS52bXVsdChmYWNlQU5vcm1hbFdTLCBmYWNlQU5vcm1hbFdTKTsKICAgICAgICBjb25zdCBkID0gZmFjZUFOb3JtYWxXUy5kb3Qoc2VwYXJhdGluZ05vcm1hbCk7CgogICAgICAgIGlmIChkIDwgZG1pbikgewogICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICBjbG9zZXN0RmFjZUEgPSBmYWNlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKGNsb3Nlc3RGYWNlQSA8IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gR2V0IHRoZSBmYWNlIGFuZCBjb25zdHJ1Y3QgY29ubmVjdGVkIGZhY2VzCgoKICAgICAgY29uc3QgcG9seUEgPSBodWxsQS5mYWNlc1tjbG9zZXN0RmFjZUFdOwogICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcyA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBodWxsQS5mYWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgaHVsbEEuZmFjZXNbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICgKICAgICAgICAgIC8qIFNoYXJpbmcgYSB2ZXJ0ZXgqLwogICAgICAgICAgcG9seUEuaW5kZXhPZihodWxsQS5mYWNlc1tpXVtqXSkgIT09IC0xICYmCiAgICAgICAgICAvKiBOb3QgdGhlIG9uZSB3ZSBhcmUgbG9va2luZyBmb3IgY29ubmVjdGlvbnMgZnJvbSAqLwogICAgICAgICAgaSAhPT0gY2xvc2VzdEZhY2VBICYmCiAgICAgICAgICAvKiBOb3QgYWxyZWFkeSBhZGRlZCAqLwogICAgICAgICAgcG9seUEuY29ubmVjdGVkRmFjZXMuaW5kZXhPZihpKSA9PT0gLTEpIHsKICAgICAgICAgICAgcG9seUEuY29ubmVjdGVkRmFjZXMucHVzaChpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gLy8gQ2xpcCB0aGUgcG9seWdvbiB0byB0aGUgYmFjayBvZiB0aGUgcGxhbmVzIG9mIGFsbCBmYWNlcyBvZiBodWxsIEEsCiAgICAgIC8vIHRoYXQgYXJlIGFkamFjZW50IHRvIHRoZSB3aXRuZXNzIGZhY2UKCgogICAgICBjb25zdCBudW1WZXJ0aWNlc0EgPSBwb2x5QS5sZW5ndGg7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVZlcnRpY2VzQTsgaSsrKSB7CiAgICAgICAgY29uc3QgYSA9IGh1bGxBLnZlcnRpY2VzW3BvbHlBW2ldXTsKICAgICAgICBjb25zdCBiID0gaHVsbEEudmVydGljZXNbcG9seUFbKGkgKyAxKSAlIG51bVZlcnRpY2VzQV1dOwogICAgICAgIGEudnN1YihiLCBlZGdlMCk7CiAgICAgICAgV29ybGRFZGdlMC5jb3B5KGVkZ2UwKTsKICAgICAgICBxdWF0QS52bXVsdChXb3JsZEVkZ2UwLCBXb3JsZEVkZ2UwKTsKICAgICAgICBwb3NBLnZhZGQoV29ybGRFZGdlMCwgV29ybGRFZGdlMCk7CiAgICAgICAgd29ybGRQbGFuZUFub3JtYWwxLmNvcHkodGhpcy5mYWNlTm9ybWFsc1tjbG9zZXN0RmFjZUFdKTsKICAgICAgICBxdWF0QS52bXVsdCh3b3JsZFBsYW5lQW5vcm1hbDEsIHdvcmxkUGxhbmVBbm9ybWFsMSk7CiAgICAgICAgcG9zQS52YWRkKHdvcmxkUGxhbmVBbm9ybWFsMSwgd29ybGRQbGFuZUFub3JtYWwxKTsKICAgICAgICBXb3JsZEVkZ2UwLmNyb3NzKHdvcmxkUGxhbmVBbm9ybWFsMSwgcGxhbmVOb3JtYWxXUzEpOwogICAgICAgIHBsYW5lTm9ybWFsV1MxLm5lZ2F0ZShwbGFuZU5vcm1hbFdTMSk7CiAgICAgICAgd29ybGRBMS5jb3B5KGEpOwogICAgICAgIHF1YXRBLnZtdWx0KHdvcmxkQTEsIHdvcmxkQTEpOwogICAgICAgIHBvc0EudmFkZCh3b3JsZEExLCB3b3JsZEExKTsKICAgICAgICBjb25zdCBvdGhlckZhY2UgPSBwb2x5QS5jb25uZWN0ZWRGYWNlc1tpXTsKICAgICAgICBsb2NhbFBsYW5lTm9ybWFsLmNvcHkodGhpcy5mYWNlTm9ybWFsc1tvdGhlckZhY2VdKTsKICAgICAgICBjb25zdCBsb2NhbFBsYW5lRXEgPSB0aGlzLmdldFBsYW5lQ29uc3RhbnRPZkZhY2Uob3RoZXJGYWNlKTsKICAgICAgICBwbGFuZU5vcm1hbFdTLmNvcHkobG9jYWxQbGFuZU5vcm1hbCk7CiAgICAgICAgcXVhdEEudm11bHQocGxhbmVOb3JtYWxXUywgcGxhbmVOb3JtYWxXUyk7CiAgICAgICAgY29uc3QgcGxhbmVFcVdTID0gbG9jYWxQbGFuZUVxIC0gcGxhbmVOb3JtYWxXUy5kb3QocG9zQSk7IC8vIENsaXAgZmFjZSBhZ2FpbnN0IG91ciBjb25zdHJ1Y3RlZCBwbGFuZQoKICAgICAgICB0aGlzLmNsaXBGYWNlQWdhaW5zdFBsYW5lKHBWdHhJbiwgcFZ0eE91dCwgcGxhbmVOb3JtYWxXUywgcGxhbmVFcVdTKTsgLy8gVGhyb3cgYXdheSBhbGwgY2xpcHBlZCBwb2ludHMsIGJ1dCBzYXZlIHRoZSByZW1haW5pbmcgdW50aWwgbmV4dCBjbGlwCgogICAgICAgIHdoaWxlIChwVnR4SW4ubGVuZ3RoKSB7CiAgICAgICAgICBwVnR4SW4uc2hpZnQoKTsKICAgICAgICB9CgogICAgICAgIHdoaWxlIChwVnR4T3V0Lmxlbmd0aCkgewogICAgICAgICAgcFZ0eEluLnB1c2gocFZ0eE91dC5zaGlmdCgpKTsKICAgICAgICB9CiAgICAgIH0gLy8gb25seSBrZWVwIGNvbnRhY3QgcG9pbnRzIHRoYXQgYXJlIGJlaGluZCB0aGUgd2l0bmVzcyBmYWNlCgoKICAgICAgbG9jYWxQbGFuZU5vcm1hbC5jb3B5KHRoaXMuZmFjZU5vcm1hbHNbY2xvc2VzdEZhY2VBXSk7CiAgICAgIGNvbnN0IGxvY2FsUGxhbmVFcSA9IHRoaXMuZ2V0UGxhbmVDb25zdGFudE9mRmFjZShjbG9zZXN0RmFjZUEpOwogICAgICBwbGFuZU5vcm1hbFdTLmNvcHkobG9jYWxQbGFuZU5vcm1hbCk7CiAgICAgIHF1YXRBLnZtdWx0KHBsYW5lTm9ybWFsV1MsIHBsYW5lTm9ybWFsV1MpOwogICAgICBjb25zdCBwbGFuZUVxV1MgPSBsb2NhbFBsYW5lRXEgLSBwbGFuZU5vcm1hbFdTLmRvdChwb3NBKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcFZ0eEluLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IGRlcHRoID0gcGxhbmVOb3JtYWxXUy5kb3QocFZ0eEluW2ldKSArIHBsYW5lRXFXUzsgLy8gPz8/CgogICAgICAgIGlmIChkZXB0aCA8PSBtaW5EaXN0KSB7CiAgICAgICAgICBjb25zb2xlLmxvZygiY2xhbXBlZDogZGVwdGg9IiArIGRlcHRoICsgIiB0byBtaW5EaXN0PSIgKyBtaW5EaXN0KTsKICAgICAgICAgIGRlcHRoID0gbWluRGlzdDsKICAgICAgICB9CgogICAgICAgIGlmIChkZXB0aCA8PSBtYXhEaXN0KSB7CiAgICAgICAgICBjb25zdCBwb2ludCA9IHBWdHhJbltpXTsKCiAgICAgICAgICBpZiAoZGVwdGggPD0gMWUtNikgewogICAgICAgICAgICBjb25zdCBwID0gewogICAgICAgICAgICAgIHBvaW50LAogICAgICAgICAgICAgIG5vcm1hbDogcGxhbmVOb3JtYWxXUywKICAgICAgICAgICAgICBkZXB0aAogICAgICAgICAgICB9OwogICAgICAgICAgICByZXN1bHQucHVzaChwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgaW4gYSBodWxsIGFnYWluc3QgdGhlIGJhY2sgb2YgYSBwbGFuZS4KICAgICAqIEBwYXJhbSBwbGFuZUNvbnN0YW50IFRoZSBjb25zdGFudCBpbiB0aGUgbWF0aGVtYXRpY2FsIHBsYW5lIGVxdWF0aW9uCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0UGxhbmUoaW5WZXJ0aWNlcywgb3V0VmVydGljZXMsIHBsYW5lTm9ybWFsLCBwbGFuZUNvbnN0YW50KSB7CiAgICAgIGxldCBuX2RvdF9maXJzdDsKICAgICAgbGV0IG5fZG90X2xhc3Q7CiAgICAgIGNvbnN0IG51bVZlcnRzID0gaW5WZXJ0aWNlcy5sZW5ndGg7CgogICAgICBpZiAobnVtVmVydHMgPCAyKSB7CiAgICAgICAgcmV0dXJuIG91dFZlcnRpY2VzOwogICAgICB9CgogICAgICBsZXQgZmlyc3RWZXJ0ZXggPSBpblZlcnRpY2VzW2luVmVydGljZXMubGVuZ3RoIC0gMV07CiAgICAgIGxldCBsYXN0VmVydGV4ID0gaW5WZXJ0aWNlc1swXTsKICAgICAgbl9kb3RfZmlyc3QgPSBwbGFuZU5vcm1hbC5kb3QoZmlyc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgIGZvciAobGV0IHZpID0gMDsgdmkgPCBudW1WZXJ0czsgdmkrKykgewogICAgICAgIGxhc3RWZXJ0ZXggPSBpblZlcnRpY2VzW3ZpXTsKICAgICAgICBuX2RvdF9sYXN0ID0gcGxhbmVOb3JtYWwuZG90KGxhc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgICAgaWYgKG5fZG90X2ZpcnN0IDwgMCkgewogICAgICAgICAgaWYgKG5fZG90X2xhc3QgPCAwKSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kIDwgMCwgc28gb3V0cHV0IGxhc3RWZXJ0ZXgKICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIG5ld3YuY29weShsYXN0VmVydGV4KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kID49IDAsIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24KICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIGZpcnN0VmVydGV4LmxlcnAobGFzdFZlcnRleCwgbl9kb3RfZmlyc3QgLyAobl9kb3RfZmlyc3QgLSBuX2RvdF9sYXN0KSwgbmV3dik7CiAgICAgICAgICAgIG91dFZlcnRpY2VzLnB1c2gobmV3dik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChuX2RvdF9sYXN0IDwgMCkgewogICAgICAgICAgICAvLyBTdGFydCA+PSAwLCBlbmQgPCAwIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24gYW5kIGVuZAogICAgICAgICAgICBjb25zdCBuZXd2ID0gbmV3IFZlYzMoKTsKICAgICAgICAgICAgZmlyc3RWZXJ0ZXgubGVycChsYXN0VmVydGV4LCBuX2RvdF9maXJzdCAvIChuX2RvdF9maXJzdCAtIG5fZG90X2xhc3QpLCBuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChsYXN0VmVydGV4KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpcnN0VmVydGV4ID0gbGFzdFZlcnRleDsKICAgICAgICBuX2RvdF9maXJzdCA9IG5fZG90X2xhc3Q7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXRWZXJ0aWNlczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgLndvcmxkVmVydGljZXNgIGFuZCBzZXRzIGAud29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlYCB0byBmYWxzZS4KICAgICAqLwoKCiAgICBjb21wdXRlV29ybGRWZXJ0aWNlcyhwb3NpdGlvbiwgcXVhdCkgewogICAgICB3aGlsZSAodGhpcy53b3JsZFZlcnRpY2VzLmxlbmd0aCA8IHRoaXMudmVydGljZXMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy53b3JsZFZlcnRpY2VzLnB1c2gobmV3IFZlYzMoKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3Qgd29ybGRWZXJ0cyA9IHRoaXMud29ybGRWZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcXVhdC52bXVsdCh2ZXJ0c1tpXSwgd29ybGRWZXJ0c1tpXSk7CiAgICAgICAgcG9zaXRpb24udmFkZCh3b3JsZFZlcnRzW2ldLCB3b3JsZFZlcnRzW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmJtaW4sIGFhYmJtYXgpIHsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBhYWJibWluLnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgYWFiYm1heC5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydGljZXNbaV07CgogICAgICAgIGlmICh2LnggPCBhYWJibWluLngpIHsKICAgICAgICAgIGFhYmJtaW4ueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IGFhYmJtYXgueCkgewogICAgICAgICAgYWFiYm1heC54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGFhYmJtaW4ueSkgewogICAgICAgICAgYWFiYm1pbi55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gYWFiYm1heC55KSB7CiAgICAgICAgICBhYWJibWF4LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgYWFiYm1pbi56KSB7CiAgICAgICAgICBhYWJibWluLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiBhYWJibWF4LnopIHsKICAgICAgICAgIGFhYmJtYXgueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgd29ybGRWZXJ0aWNlc2AgYW5kIHNldHMgYHdvcmxkVmVydGljZXNOZWVkc1VwZGF0ZWAgdG8gZmFsc2UuCiAgICAgKi8KCgogICAgY29tcHV0ZVdvcmxkRmFjZU5vcm1hbHMocXVhdCkgewogICAgICBjb25zdCBOID0gdGhpcy5mYWNlTm9ybWFscy5sZW5ndGg7CgogICAgICB3aGlsZSAodGhpcy53b3JsZEZhY2VOb3JtYWxzLmxlbmd0aCA8IE4pIHsKICAgICAgICB0aGlzLndvcmxkRmFjZU5vcm1hbHMucHVzaChuZXcgVmVjMygpKTsKICAgICAgfQoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMuZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFscyA9IHRoaXMud29ybGRGYWNlTm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBxdWF0LnZtdWx0KG5vcm1hbHNbaV0sIHdvcmxkTm9ybWFsc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBub3JtMiA9IHZlcnRzW2ldLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBsZXQgbWlueDsKICAgICAgbGV0IG1pbnk7CiAgICAgIGxldCBtaW56OwogICAgICBsZXQgbWF4eDsKICAgICAgbGV0IG1heHk7CiAgICAgIGxldCBtYXh6OwogICAgICBsZXQgdGVtcFdvcmxkVmVydGV4ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0ZW1wV29ybGRWZXJ0ZXguY29weSh2ZXJ0c1tpXSk7CiAgICAgICAgcXVhdC52bXVsdCh0ZW1wV29ybGRWZXJ0ZXgsIHRlbXBXb3JsZFZlcnRleCk7CiAgICAgICAgcG9zLnZhZGQodGVtcFdvcmxkVmVydGV4LCB0ZW1wV29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnN0IHYgPSB0ZW1wV29ybGRWZXJ0ZXg7CgogICAgICAgIGlmIChtaW54ID09PSB1bmRlZmluZWQgfHwgdi54IDwgbWlueCkgewogICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh4ID09PSB1bmRlZmluZWQgfHwgdi54ID4gbWF4eCkgewogICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtaW55ID09PSB1bmRlZmluZWQgfHwgdi55IDwgbWlueSkgewogICAgICAgICAgbWlueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh5ID09PSB1bmRlZmluZWQgfHwgdi55ID4gbWF4eSkgewogICAgICAgICAgbWF4eSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtaW56ID09PSB1bmRlZmluZWQgfHwgdi56IDwgbWlueikgewogICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh6ID09PSB1bmRlZmluZWQgfHwgdi56ID4gbWF4eikgewogICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1pbi5zZXQobWlueCwgbWlueSwgbWlueik7CiAgICAgIG1heC5zZXQobWF4eCwgbWF4eSwgbWF4eik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSBjb252ZXggdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBhdmVyYWdlIG9mIGFsbCB0aGUgdmVydGljZXMgcG9zaXRpb25zCiAgICAgKi8KCgogICAgZ2V0QXZlcmFnZVBvaW50TG9jYWwodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0YXJnZXQudmFkZCh2ZXJ0c1tpXSwgdGFyZ2V0KTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNjYWxlKDEgLyB2ZXJ0cy5sZW5ndGgsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zZm9ybSBhbGwgbG9jYWwgcG9pbnRzLiBXaWxsIGNoYW5nZSB0aGUgLnZlcnRpY2VzCiAgICAgKi8KCgogICAgdHJhbnNmb3JtQWxsUG9pbnRzKG9mZnNldCwgcXVhdCkgewogICAgICBjb25zdCBuID0gdGhpcy52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsgLy8gQXBwbHkgcm90YXRpb24KCiAgICAgIGlmIChxdWF0KSB7CiAgICAgICAgLy8gUm90YXRlIHZlcnRpY2VzCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsKICAgICAgICAgIHF1YXQudm11bHQodiwgdik7CiAgICAgICAgfSAvLyBSb3RhdGUgZmFjZSBub3JtYWxzCgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLmZhY2VOb3JtYWxzW2ldOwogICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICB9CiAgICAgICAgLyoKICAgICAgICAgICAgICAvLyBSb3RhdGUgZWRnZXMKICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTx0aGlzLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgICAgICAgY29uc3QgdiA9IHRoaXMudW5pcXVlRWRnZXNbaV07CiAgICAgICAgICAgICAgICAgIHF1YXQudm11bHQodix2KTsKICAgICAgICAgICAgICB9Ki8KCiAgICAgIH0gLy8gQXBwbHkgb2Zmc2V0CgoKICAgICAgaWYgKG9mZnNldCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07CiAgICAgICAgICB2LnZhZGQob2Zmc2V0LCB2KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2tzIHdoZXRoZXIgcCBpcyBpbnNpZGUgdGhlIHBvbHloZWRyYS4gTXVzdCBiZSBpbiBsb2NhbCBjb29yZHMuCiAgICAgKiBUaGUgcG9pbnQgbGllcyBvdXRzaWRlIG9mIHRoZSBjb252ZXggaHVsbCBvZiB0aGUgb3RoZXIgcG9pbnRzIGlmIGFuZCBvbmx5IGlmIHRoZSBkaXJlY3Rpb24KICAgICAqIG9mIGFsbCB0aGUgdmVjdG9ycyBmcm9tIGl0IHRvIHRob3NlIG90aGVyIHBvaW50cyBhcmUgb24gbGVzcyB0aGFuIG9uZSBoYWxmIG9mIGEgc3BoZXJlIGFyb3VuZCBpdC4KICAgICAqIEBwYXJhbSBwIEEgcG9pbnQgZ2l2ZW4gaW4gbG9jYWwgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBwb2ludElzSW5zaWRlKHApIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCBmYWNlcyA9IHRoaXMuZmFjZXM7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSB0aGlzLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBwb2ludEluc2lkZSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuZ2V0QXZlcmFnZVBvaW50TG9jYWwocG9pbnRJbnNpZGUpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IG4gPSBub3JtYWxzW2ldOwogICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tmYWNlc1tpXVswXV07IC8vIFdlIG9ubHkgbmVlZCBvbmUgcG9pbnQgaW4gdGhlIGZhY2UKICAgICAgICAvLyBUaGlzIGRvdCBwcm9kdWN0IGRldGVybWluZXMgd2hpY2ggc2lkZSBvZiB0aGUgZWRnZSB0aGUgcG9pbnQgaXMKCiAgICAgICAgY29uc3QgdlRvUCA9IG5ldyBWZWMzKCk7CiAgICAgICAgcC52c3ViKHYsIHZUb1ApOwogICAgICAgIGNvbnN0IHIxID0gbi5kb3QodlRvUCk7CiAgICAgICAgY29uc3QgdlRvUG9pbnRJbnNpZGUgPSBuZXcgVmVjMygpOwogICAgICAgIHBvaW50SW5zaWRlLnZzdWIodiwgdlRvUG9pbnRJbnNpZGUpOwogICAgICAgIGNvbnN0IHIyID0gbi5kb3QodlRvUG9pbnRJbnNpZGUpOwoKICAgICAgICBpZiAocjEgPCAwICYmIHIyID4gMCB8fCByMSA+IDAgJiYgcjIgPCAwKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7IC8vIEVuY291bnRlcmVkIHNvbWUgb3RoZXIgc2lnbi4gRXhpdC4KICAgICAgICB9CiAgICAgIH0gLy8gSWYgd2UgZ290IGhlcmUsIGFsbCBkb3QgcHJvZHVjdHMgd2VyZSBvZiB0aGUgc2FtZSBzaWduLgoKCiAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IG1heCBhbmQgbWluIGRvdCBwcm9kdWN0IG9mIGEgY29udmV4IGh1bGwgYXQgcG9zaXRpb24gKHBvcyxxdWF0KSBwcm9qZWN0ZWQgb250byBhbiBheGlzLgogICAgICogUmVzdWx0cyBhcmUgc2F2ZWQgaW4gdGhlIGFycmF5IG1heG1pbi4KICAgICAqIEBwYXJhbSByZXN1bHQgcmVzdWx0WzBdIGFuZCByZXN1bHRbMV0gd2lsbCBiZSBzZXQgdG8gbWF4aW11bSBhbmQgbWluaW11bSwgcmVzcGVjdGl2ZWx5LgogICAgICovCgoKICAgIHN0YXRpYyBwcm9qZWN0KHNoYXBlLCBheGlzLCBwb3MsIHF1YXQsIHJlc3VsdCkgewogICAgICBjb25zdCBuID0gc2hhcGUudmVydGljZXMubGVuZ3RoOwogICAgICBjb25zdCBsb2NhbEF4aXMgPSBwcm9qZWN0X2xvY2FsQXhpczsKICAgICAgbGV0IG1heCA9IDA7CiAgICAgIGxldCBtaW4gPSAwOwogICAgICBjb25zdCBsb2NhbE9yaWdpbiA9IHByb2plY3RfbG9jYWxPcmlnaW47CiAgICAgIGNvbnN0IHZzID0gc2hhcGUudmVydGljZXM7CiAgICAgIGxvY2FsT3JpZ2luLnNldFplcm8oKTsgLy8gVHJhbnNmb3JtIHRoZSBheGlzIHRvIGxvY2FsCgogICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Mb2NhbEZyYW1lKHBvcywgcXVhdCwgYXhpcywgbG9jYWxBeGlzKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvcywgcXVhdCwgbG9jYWxPcmlnaW4sIGxvY2FsT3JpZ2luKTsKICAgICAgY29uc3QgYWRkID0gbG9jYWxPcmlnaW4uZG90KGxvY2FsQXhpcyk7CiAgICAgIG1pbiA9IG1heCA9IHZzWzBdLmRvdChsb2NhbEF4aXMpOwoKICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBuOyBpKyspIHsKICAgICAgICBjb25zdCB2YWwgPSB2c1tpXS5kb3QobG9jYWxBeGlzKTsKCiAgICAgICAgaWYgKHZhbCA+IG1heCkgewogICAgICAgICAgbWF4ID0gdmFsOwogICAgICAgIH0KCiAgICAgICAgaWYgKHZhbCA8IG1pbikgewogICAgICAgICAgbWluID0gdmFsOwogICAgICAgIH0KICAgICAgfQoKICAgICAgbWluIC09IGFkZDsKICAgICAgbWF4IC09IGFkZDsKCiAgICAgIGlmIChtaW4gPiBtYXgpIHsKICAgICAgICAvLyBJbmNvbnNpc3RlbnQgLSBzd2FwCiAgICAgICAgY29uc3QgdGVtcCA9IG1pbjsKICAgICAgICBtaW4gPSBtYXg7CiAgICAgICAgbWF4ID0gdGVtcDsKICAgICAgfSAvLyBPdXRwdXQKCgogICAgICByZXN1bHRbMF0gPSBtYXg7CiAgICAgIHJlc3VsdFsxXSA9IG1pbjsKICAgIH0KCiAgfQoKICBjb25zdCBtYXhtaW5BID0gW107CiAgY29uc3QgbWF4bWluQiA9IFtdOwogIGNvbnN0IHByb2plY3RfbG9jYWxBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBwcm9qZWN0X2xvY2FsT3JpZ2luID0gbmV3IFZlYzMoKTsKICAvKioKICAgKiBBIDNkIGJveCBzaGFwZS4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBzaXplID0gMQogICAqICAgICBjb25zdCBoYWxmRXh0ZW50cyA9IG5ldyBDQU5OT04uVmVjMyhzaXplLCBzaXplLCBzaXplKQogICAqICAgICBjb25zdCBib3hTaGFwZSA9IG5ldyBDQU5OT04uQm94KGhhbGZFeHRlbnRzKQogICAqICAgICBjb25zdCBib3hCb2R5ID0gbmV3IENBTk5PTi5Cb2R5KHsgbWFzczogMSwgc2hhcGU6IGJveFNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm94Qm9keSkKICAgKi8KCiAgY2xhc3MgQm94IGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBUaGUgaGFsZiBleHRlbnRzIG9mIHRoZSBib3guCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgYnkgdGhlIGNvbnRhY3QgZ2VuZXJhdG9yIHRvIG1ha2UgY29udGFjdHMgd2l0aCBvdGhlciBjb252ZXggcG9seWhlZHJhIGZvciBleGFtcGxlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihoYWxmRXh0ZW50cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQk9YCiAgICAgIH0pOwogICAgICB0aGlzLmhhbGZFeHRlbnRzID0gdm9pZCAwOwogICAgICB0aGlzLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5oYWxmRXh0ZW50cyA9IGhhbGZFeHRlbnRzOwogICAgICB0aGlzLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiA9IG51bGw7CiAgICAgIHRoaXMudXBkYXRlQ29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgbG9jYWwgY29udmV4IHBvbHloZWRyb24gcmVwcmVzZW50YXRpb24gdXNlZCBmb3Igc29tZSBjb2xsaXNpb25zLgogICAgICovCgoKICAgIHVwZGF0ZUNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbigpIHsKICAgICAgY29uc3Qgc3ggPSB0aGlzLmhhbGZFeHRlbnRzLng7CiAgICAgIGNvbnN0IHN5ID0gdGhpcy5oYWxmRXh0ZW50cy55OwogICAgICBjb25zdCBzeiA9IHRoaXMuaGFsZkV4dGVudHMuejsKICAgICAgY29uc3QgViA9IFZlYzM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW25ldyBWKC1zeCwgLXN5LCAtc3opLCBuZXcgVihzeCwgLXN5LCAtc3opLCBuZXcgVihzeCwgc3ksIC1zeiksIG5ldyBWKC1zeCwgc3ksIC1zeiksIG5ldyBWKC1zeCwgLXN5LCBzeiksIG5ldyBWKHN4LCAtc3ksIHN6KSwgbmV3IFYoc3gsIHN5LCBzeiksIG5ldyBWKC1zeCwgc3ksIHN6KV07CiAgICAgIGNvbnN0IGZhY2VzID0gW1szLCAyLCAxLCAwXSwgLy8gLXoKICAgICAgWzQsIDUsIDYsIDddLCAvLyAregogICAgICBbNSwgNCwgMCwgMV0sIC8vIC15CiAgICAgIFsyLCAzLCA3LCA2XSwgLy8gK3kKICAgICAgWzAsIDQsIDcsIDNdLCAvLyAteAogICAgICBbMSwgMiwgNiwgNV0gLy8gK3gKICAgICAgXTsKICAgICAgY29uc3QgYXhlcyA9IFtuZXcgVigwLCAwLCAxKSwgbmV3IFYoMCwgMSwgMCksIG5ldyBWKDEsIDAsIDApXTsKICAgICAgY29uc3QgaCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKHsKICAgICAgICB2ZXJ0aWNlcywKICAgICAgICBmYWNlcywKICAgICAgICBheGVzCiAgICAgIH0pOwogICAgICB0aGlzLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiA9IGg7CiAgICAgIGgubWF0ZXJpYWwgPSB0aGlzLm1hdGVyaWFsOwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgdGhlIGluZXJ0aWEgb2YgdGhlIGJveC4KICAgICAqLwoKCiAgICBjYWxjdWxhdGVMb2NhbEluZXJ0aWEobWFzcywgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIEJveC5jYWxjdWxhdGVJbmVydGlhKHRoaXMuaGFsZkV4dGVudHMsIG1hc3MsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogICAgc3RhdGljIGNhbGN1bGF0ZUluZXJ0aWEoaGFsZkV4dGVudHMsIG1hc3MsIHRhcmdldCkgewogICAgICBjb25zdCBlID0gaGFsZkV4dGVudHM7CiAgICAgIHRhcmdldC54ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIGUueSAqIDIgKiBlLnkgKyAyICogZS56ICogMiAqIGUueik7CiAgICAgIHRhcmdldC55ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIGUueCAqIDIgKiBlLnggKyAyICogZS56ICogMiAqIGUueik7CiAgICAgIHRhcmdldC56ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIGUueSAqIDIgKiBlLnkgKyAyICogZS54ICogMiAqIGUueCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYm94IDYgc2lkZSBub3JtYWxzCiAgICAgKiBAcGFyYW0gc2l4VGFyZ2V0VmVjdG9ycyBBbiBhcnJheSBvZiA2IHZlY3RvcnMsIHRvIHN0b3JlIHRoZSByZXN1bHRpbmcgc2lkZSBub3JtYWxzIGluLgogICAgICogQHBhcmFtIHF1YXQgT3JpZW50YXRpb24gdG8gYXBwbHkgdG8gdGhlIG5vcm1hbCB2ZWN0b3JzLiBJZiBub3QgcHJvdmlkZWQsIHRoZSB2ZWN0b3JzIHdpbGwgYmUgaW4gcmVzcGVjdCB0byB0aGUgbG9jYWwgZnJhbWUuCiAgICAgKi8KCgogICAgZ2V0U2lkZU5vcm1hbHMoc2l4VGFyZ2V0VmVjdG9ycywgcXVhdCkgewogICAgICBjb25zdCBzaWRlcyA9IHNpeFRhcmdldFZlY3RvcnM7CiAgICAgIGNvbnN0IGV4ID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgc2lkZXNbMF0uc2V0KGV4LngsIDAsIDApOwogICAgICBzaWRlc1sxXS5zZXQoMCwgZXgueSwgMCk7CiAgICAgIHNpZGVzWzJdLnNldCgwLCAwLCBleC56KTsKICAgICAgc2lkZXNbM10uc2V0KC1leC54LCAwLCAwKTsKICAgICAgc2lkZXNbNF0uc2V0KDAsIC1leC55LCAwKTsKICAgICAgc2lkZXNbNV0uc2V0KDAsIDAsIC1leC56KTsKCiAgICAgIGlmIChxdWF0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gc2lkZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHF1YXQudm11bHQoc2lkZXNbaV0sIHNpZGVzW2ldKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBzaWRlczsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgdm9sdW1lIG9mIHRoZSBib3guCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gOC4wICogdGhpcy5oYWxmRXh0ZW50cy54ICogdGhpcy5oYWxmRXh0ZW50cy55ICogdGhpcy5oYWxmRXh0ZW50cy56OwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cwogICAgICovCgoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gdGhpcy5oYWxmRXh0ZW50cy5sZW5ndGgoKTsKICAgIH0KICAgIC8qKgogICAgICogZm9yRWFjaFdvcmxkQ29ybmVyCiAgICAgKi8KCgogICAgZm9yRWFjaFdvcmxkQ29ybmVyKHBvcywgcXVhdCwgY2FsbGJhY2spIHsKICAgICAgY29uc3QgZSA9IHRoaXMuaGFsZkV4dGVudHM7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSBbW2UueCwgZS55LCBlLnpdLCBbLWUueCwgZS55LCBlLnpdLCBbLWUueCwgLWUueSwgZS56XSwgWy1lLngsIC1lLnksIC1lLnpdLCBbZS54LCAtZS55LCAtZS56XSwgW2UueCwgZS55LCAtZS56XSwgWy1lLngsIGUueSwgLWUuel0sIFtlLngsIC1lLnksIGUuel1dOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3JuZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgd29ybGRDb3JuZXJUZW1wUG9zLnNldChjb3JuZXJzW2ldWzBdLCBjb3JuZXJzW2ldWzFdLCBjb3JuZXJzW2ldWzJdKTsKICAgICAgICBxdWF0LnZtdWx0KHdvcmxkQ29ybmVyVGVtcFBvcywgd29ybGRDb3JuZXJUZW1wUG9zKTsKICAgICAgICBwb3MudmFkZCh3b3JsZENvcm5lclRlbXBQb3MsIHdvcmxkQ29ybmVyVGVtcFBvcyk7CiAgICAgICAgY2FsbGJhY2sod29ybGRDb3JuZXJUZW1wUG9zLngsIHdvcmxkQ29ybmVyVGVtcFBvcy55LCB3b3JsZENvcm5lclRlbXBQb3Mueik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuaGFsZkV4dGVudHM7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMF0uc2V0KGUueCwgZS55LCBlLnopOwogICAgICB3b3JsZENvcm5lcnNUZW1wWzFdLnNldCgtZS54LCBlLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMl0uc2V0KC1lLngsIC1lLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbM10uc2V0KC1lLngsIC1lLnksIC1lLnopOwogICAgICB3b3JsZENvcm5lcnNUZW1wWzRdLnNldChlLngsIC1lLnksIC1lLnopOwogICAgICB3b3JsZENvcm5lcnNUZW1wWzVdLnNldChlLngsIGUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNl0uc2V0KC1lLngsIGUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbN10uc2V0KGUueCwgLWUueSwgZS56KTsKICAgICAgY29uc3Qgd2MgPSB3b3JsZENvcm5lcnNUZW1wWzBdOwogICAgICBxdWF0LnZtdWx0KHdjLCB3Yyk7CiAgICAgIHBvcy52YWRkKHdjLCB3Yyk7CiAgICAgIG1heC5jb3B5KHdjKTsKICAgICAgbWluLmNvcHkod2MpOwoKICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCA4OyBpKyspIHsKICAgICAgICBjb25zdCB3YyA9IHdvcmxkQ29ybmVyc1RlbXBbaV07CiAgICAgICAgcXVhdC52bXVsdCh3Yywgd2MpOwogICAgICAgIHBvcy52YWRkKHdjLCB3Yyk7CiAgICAgICAgY29uc3QgeCA9IHdjLng7CiAgICAgICAgY29uc3QgeSA9IHdjLnk7CiAgICAgICAgY29uc3QgeiA9IHdjLno7CgogICAgICAgIGlmICh4ID4gbWF4LngpIHsKICAgICAgICAgIG1heC54ID0geDsKICAgICAgICB9CgogICAgICAgIGlmICh5ID4gbWF4LnkpIHsKICAgICAgICAgIG1heC55ID0geTsKICAgICAgICB9CgogICAgICAgIGlmICh6ID4gbWF4LnopIHsKICAgICAgICAgIG1heC56ID0gejsKICAgICAgICB9CgogICAgICAgIGlmICh4IDwgbWluLngpIHsKICAgICAgICAgIG1pbi54ID0geDsKICAgICAgICB9CgogICAgICAgIGlmICh5IDwgbWluLnkpIHsKICAgICAgICAgIG1pbi55ID0geTsKICAgICAgICB9CgogICAgICAgIGlmICh6IDwgbWluLnopIHsKICAgICAgICAgIG1pbi56ID0gejsKICAgICAgICB9CiAgICAgIH0gLy8gR2V0IGVhY2ggYXhpcyBtYXgKICAgICAgLy8gbWluLnNldChJbmZpbml0eSxJbmZpbml0eSxJbmZpbml0eSk7CiAgICAgIC8vIG1heC5zZXQoLUluZmluaXR5LC1JbmZpbml0eSwtSW5maW5pdHkpOwogICAgICAvLyB0aGlzLmZvckVhY2hXb3JsZENvcm5lcihwb3MscXVhdCxmdW5jdGlvbih4LHkseil7CiAgICAgIC8vICAgICBpZih4ID4gbWF4LngpewogICAgICAvLyAgICAgICAgIG1heC54ID0geDsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHkgPiBtYXgueSl7CiAgICAgIC8vICAgICAgICAgbWF4LnkgPSB5OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeiA+IG1heC56KXsKICAgICAgLy8gICAgICAgICBtYXgueiA9IHo7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih4IDwgbWluLngpewogICAgICAvLyAgICAgICAgIG1pbi54ID0geDsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHkgPCBtaW4ueSl7CiAgICAgIC8vICAgICAgICAgbWluLnkgPSB5OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeiA8IG1pbi56KXsKICAgICAgLy8gICAgICAgICBtaW4ueiA9IHo7CiAgICAgIC8vICAgICB9CiAgICAgIC8vIH0pOwoKICAgIH0KCiAgfQoKICBjb25zdCB3b3JsZENvcm5lclRlbXBQb3MgPSBuZXcgVmVjMygpOwogIGNvbnN0IHdvcmxkQ29ybmVyc1RlbXAgPSBbbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKV07CiAgLyoqCiAgICogQk9EWV9UWVBFUwogICAqLwoKICBjb25zdCBCT0RZX1RZUEVTID0gewogICAgLyoqIERZTkFNSUMgKi8KICAgIERZTkFNSUM6IDEsCgogICAgLyoqIFNUQVRJQyAqLwogICAgU1RBVElDOiAyLAoKICAgIC8qKiBLSU5FTUFUSUMgKi8KICAgIEtJTkVNQVRJQzogNAogIH07CiAgLyoqCiAgICogQm9keVR5cGUKICAgKi8KCiAgLyoqCiAgICogQk9EWV9TTEVFUF9TVEFURVMKICAgKi8KCiAgY29uc3QgQk9EWV9TTEVFUF9TVEFURVMgPSB7CiAgICAvKiogQVdBS0UgKi8KICAgIEFXQUtFOiAwLAoKICAgIC8qKiBTTEVFUFkgKi8KICAgIFNMRUVQWTogMSwKCiAgICAvKiogU0xFRVBJTkcgKi8KICAgIFNMRUVQSU5HOiAyCiAgfTsKICAvKioKICAgKiBCb2R5U2xlZXBTdGF0ZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBhbGwgYm9keSB0eXBlcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBzaGFwZSA9IG5ldyBDQU5OT04uU3BoZXJlKDEpCiAgICogICAgIGNvbnN0IGJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoewogICAqICAgICAgIG1hc3M6IDEsCiAgICogICAgICAgc2hhcGUsCiAgICogICAgIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keSkKICAgKi8KCiAgY2xhc3MgQm9keSBleHRlbmRzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciB0d28gYm9kaWVzIGNvbGxpZGUuIFRoaXMgZXZlbnQgaXMgZGlzcGF0Y2hlZCBvbiBlYWNoCiAgICAgKiBvZiB0aGUgdHdvIGJvZGllcyBpbnZvbHZlZCBpbiB0aGUgY29sbGlzaW9uLgogICAgICogQGV2ZW50IGNvbGxpZGUKICAgICAqIEBwYXJhbSBib2R5IFRoZSBib2R5IHRoYXQgd2FzIGludm9sdmVkIGluIHRoZSBjb2xsaXNpb24uCiAgICAgKiBAcGFyYW0gY29udGFjdCBUaGUgZGV0YWlscyBvZiB0aGUgY29sbGlzaW9uLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIGR5bmFtaWMgYm9keSBpcyBmdWxseSBzaW11bGF0ZWQuIENhbiBiZSBtb3ZlZCBtYW51YWxseSBieSB0aGUgdXNlciwgYnV0IG5vcm1hbGx5IHRoZXkgbW92ZSBhY2NvcmRpbmcgdG8gZm9yY2VzLiBBIGR5bmFtaWMgYm9keSBjYW4gY29sbGlkZSB3aXRoIGFsbCBib2R5IHR5cGVzLiBBIGR5bmFtaWMgYm9keSBhbHdheXMgaGFzIGZpbml0ZSwgbm9uLXplcm8gbWFzcy4KICAgICAqLwoKICAgIC8qKgogICAgICogQSBzdGF0aWMgYm9keSBkb2VzIG5vdCBtb3ZlIGR1cmluZyBzaW11bGF0aW9uIGFuZCBiZWhhdmVzIGFzIGlmIGl0IGhhcyBpbmZpbml0ZSBtYXNzLiBTdGF0aWMgYm9kaWVzIGNhbiBiZSBtb3ZlZCBtYW51YWxseSBieSBzZXR0aW5nIHRoZSBwb3NpdGlvbiBvZiB0aGUgYm9keS4gVGhlIHZlbG9jaXR5IG9mIGEgc3RhdGljIGJvZHkgaXMgYWx3YXlzIHplcm8uIFN0YXRpYyBib2RpZXMgZG8gbm90IGNvbGxpZGUgd2l0aCBvdGhlciBzdGF0aWMgb3Iga2luZW1hdGljIGJvZGllcy4KICAgICAqLwoKICAgIC8qKgogICAgICogQSBraW5lbWF0aWMgYm9keSBtb3ZlcyB1bmRlciBzaW11bGF0aW9uIGFjY29yZGluZyB0byBpdHMgdmVsb2NpdHkuIFRoZXkgZG8gbm90IHJlc3BvbmQgdG8gZm9yY2VzLiBUaGV5IGNhbiBiZSBtb3ZlZCBtYW51YWxseSwgYnV0IG5vcm1hbGx5IGEga2luZW1hdGljIGJvZHkgaXMgbW92ZWQgYnkgc2V0dGluZyBpdHMgdmVsb2NpdHkuIEEga2luZW1hdGljIGJvZHkgYmVoYXZlcyBhcyBpZiBpdCBoYXMgaW5maW5pdGUgbWFzcy4gS2luZW1hdGljIGJvZGllcyBkbyBub3QgY29sbGlkZSB3aXRoIG90aGVyIHN0YXRpYyBvciBraW5lbWF0aWMgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBV0FLRQogICAgICovCgogICAgLyoqCiAgICAgKiBTTEVFUFkKICAgICAqLwoKICAgIC8qKgogICAgICogU0xFRVBJTkcKICAgICAqLwoKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciBhIHNsZWVwaW5nIGJvZHkgaGFzIHdva2VuIHVwLgogICAgICogQGV2ZW50IHdha2V1cAogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgYm9keSBoYXMgZ29uZSBpbiB0byB0aGUgc2xlZXB5IHN0YXRlLgogICAgICogQGV2ZW50IHNsZWVweQogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgYm9keSBoYXMgZmFsbGVuIGFzbGVlcC4KICAgICAqIEBldmVudCBzbGVlcAogICAgICovCgogICAgLyoqCiAgICAgKiBJZGVudGlmaWVyIG9mIHRoZSBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBQb3NpdGlvbiBvZiBib2R5IGluIFdvcmxkLmJvZGllcy4gVXBkYXRlZCBieSBXb3JsZCBhbmQgdXNlZCBpbiBBcnJheUNvbGxpc2lvbk1hdHJpeC4KICAgICAqLwoKICAgIC8qKgogICAgICogUmVmZXJlbmNlIHRvIHRoZSB3b3JsZCB0aGUgYm9keSBpcyBsaXZpbmcgaW4uCiAgICAgKi8KCiAgICAvKioKICAgICAqIENhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgaXMgdXNlZCBCRUZPUkUgc3RlcHBpbmcgdGhlIHN5c3RlbS4gVXNlIGl0IHRvIGFwcGx5IGZvcmNlcywgZm9yIGV4YW1wbGUuIEluc2lkZSB0aGUgZnVuY3Rpb24sICJ0aGlzIiB3aWxsIHJlZmVyIHRvIHRoaXMgQm9keSBvYmplY3QuIERlcHJlY2F0ZWQgLSB1c2UgV29ybGQgZXZlbnRzIGluc3RlYWQuCiAgICAgKiBAZGVwcmVjYXRlZCBVc2UgV29ybGQgZXZlbnRzIGluc3RlYWQKICAgICAqLwoKICAgIC8qKgogICAgICogQ2FsbGJhY2sgZnVuY3Rpb24gdGhhdCBpcyB1c2VkIEFGVEVSIHN0ZXBwaW5nIHRoZSBzeXN0ZW0uIEluc2lkZSB0aGUgZnVuY3Rpb24sICJ0aGlzIiB3aWxsIHJlZmVyIHRvIHRoaXMgQm9keSBvYmplY3QuIERlcHJlY2F0ZWQgLSB1c2UgV29ybGQgZXZlbnRzIGluc3RlYWQuCiAgICAgKiBAZGVwcmVjYXRlZCBVc2UgV29ybGQgZXZlbnRzIGluc3RlYWQKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGNvbGxpc2lvbiBncm91cCB0aGUgYm9keSBiZWxvbmdzIHRvLgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgY29sbGlzaW9uIGdyb3VwIHRoZSBib2R5IGNhbiBjb2xsaWRlIHdpdGguCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIHByb2R1Y2UgY29udGFjdCBmb3JjZXMgd2hlbiBpbiBjb250YWN0IHdpdGggb3RoZXIgYm9kaWVzLiBOb3RlIHRoYXQgY29udGFjdHMgd2lsbCBiZSBnZW5lcmF0ZWQsIGJ1dCB0aGV5IHdpbGwgYmUgZGlzYWJsZWQgLSBpLmUuICJjb2xsaWRlIiBldmVudHMgd2lsbCBiZSByYWlzZWQsIGJ1dCBmb3JjZXMgd2lsbCBub3QgYmUgYWx0ZXJlZC4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQgc3BhY2UgcG9zaXRpb24gb2YgdGhlIGJvZHkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEludGVycG9sYXRlZCBwb3NpdGlvbiBvZiB0aGUgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogSW5pdGlhbCBwb3NpdGlvbiBvZiB0aGUgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQgc3BhY2UgdmVsb2NpdHkgb2YgdGhlIGJvZHkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEluaXRpYWwgdmVsb2NpdHkgb2YgdGhlIGJvZHkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIExpbmVhciBmb3JjZSBvbiB0aGUgYm9keSBpbiB3b3JsZCBzcGFjZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIG1hc3Mgb2YgdGhlIGJvZHkuCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBwaHlzaWNzIG1hdGVyaWFsIG9mIHRoZSBib2R5LiBJdCBkZWZpbmVzIHRoZSBib2R5IGludGVyYWN0aW9uIHdpdGggb3RoZXIgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBIb3cgbXVjaCB0byBkYW1wIHRoZSBib2R5IHZlbG9jaXR5IGVhY2ggc3RlcC4gSXQgY2FuIGdvIGZyb20gMCB0byAxLgogICAgICogQGRlZmF1bHQgMC4wMQogICAgICovCgogICAgLyoqCiAgICAgKiBPbmUgb2Y6IGBCb2R5LkRZTkFNSUNgLCBgQm9keS5TVEFUSUNgIGFuZCBgQm9keS5LSU5FTUFUSUNgLgogICAgICovCgogICAgLyoqCiAgICAgKiBJZiB0cnVlLCB0aGUgYm9keSB3aWxsIGF1dG9tYXRpY2FsbHkgZmFsbCB0byBzbGVlcC4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQ3VycmVudCBzbGVlcCBzdGF0ZS4KICAgICAqLwoKICAgIC8qKgogICAgICogSWYgdGhlIHNwZWVkICh0aGUgbm9ybSBvZiB0aGUgdmVsb2NpdHkpIGlzIHNtYWxsZXIgdGhhbiB0aGlzIHZhbHVlLCB0aGUgYm9keSBpcyBjb25zaWRlcmVkIHNsZWVweS4KICAgICAqIEBkZWZhdWx0IDAuMQogICAgICovCgogICAgLyoqCiAgICAgKiBJZiB0aGUgYm9keSBoYXMgYmVlbiBzbGVlcHkgZm9yIHRoaXMgc2xlZXBUaW1lTGltaXQgc2Vjb25kcywgaXQgaXMgY29uc2lkZXJlZCBzbGVlcGluZy4KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQgc3BhY2Ugcm90YXRpb25hbCBmb3JjZSBvbiB0aGUgYm9keSwgYXJvdW5kIGNlbnRlciBvZiBtYXNzLgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBzcGFjZSBvcmllbnRhdGlvbiBvZiB0aGUgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogSW5pdGlhbCBxdWF0ZXJuaW9uIG9mIHRoZSBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBJbnRlcnBvbGF0ZWQgb3JpZW50YXRpb24gb2YgdGhlIGJvZHkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFuZ3VsYXIgdmVsb2NpdHkgb2YgdGhlIGJvZHksIGluIHdvcmxkIHNwYWNlLiBUaGluayBvZiB0aGUgYW5ndWxhciB2ZWxvY2l0eSBhcyBhIHZlY3Rvciwgd2hpY2ggdGhlIGJvZHkgcm90YXRlcyBhcm91bmQuIFRoZSBsZW5ndGggb2YgdGhpcyB2ZWN0b3IgZGV0ZXJtaW5lcyBob3cgZmFzdCAoaW4gcmFkaWFucyBwZXIgc2Vjb25kKSB0aGUgYm9keSByb3RhdGVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBJbml0aWFsIGFuZ3VsYXIgdmVsb2NpdHkgb2YgdGhlIGJvZHkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIExpc3Qgb2YgU2hhcGVzIHRoYXQgaGF2ZSBiZWVuIGFkZGVkIHRvIHRoZSBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBQb3NpdGlvbiBvZiBlYWNoIFNoYXBlIGluIHRoZSBib2R5LCBnaXZlbiBpbiBsb2NhbCBCb2R5IHNwYWNlLgogICAgICovCgogICAgLyoqCiAgICAgKiBPcmllbnRhdGlvbiBvZiBlYWNoIFNoYXBlLCBnaXZlbiBpbiBsb2NhbCBCb2R5IHNwYWNlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgaW5lcnRpYSBvZiB0aGUgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIHRydWUgaWYgeW91IGRvbid0IHdhbnQgdGhlIGJvZHkgdG8gcm90YXRlLiBNYWtlIHN1cmUgdG8gcnVuIC51cGRhdGVNYXNzUHJvcGVydGllcygpIGlmIHlvdSBjaGFuZ2UgdGhpcyBhZnRlciB0aGUgYm9keSBjcmVhdGlvbi4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIEhvdyBtdWNoIHRvIGRhbXAgdGhlIGJvZHkgYW5ndWxhciB2ZWxvY2l0eSBlYWNoIHN0ZXAuIEl0IGNhbiBnbyBmcm9tIDAgdG8gMS4KICAgICAqIEBkZWZhdWx0IDAuMDEKICAgICAqLwoKICAgIC8qKgogICAgICogVXNlIHRoaXMgcHJvcGVydHkgdG8gbGltaXQgdGhlIG1vdGlvbiBhbG9uZyBhbnkgd29ybGQgYXhpcy4gKDEsMSwxKSB3aWxsIGFsbG93IG1vdGlvbiBhbG9uZyBhbGwgYXhlcyB3aGlsZSAoMCwwLDApIGFsbG93cyBub25lLgogICAgICovCgogICAgLyoqCiAgICAgKiBVc2UgdGhpcyBwcm9wZXJ0eSB0byBsaW1pdCB0aGUgcm90YXRpb25hbCBtb3Rpb24gYWxvbmcgYW55IHdvcmxkIGF4aXMuICgxLDEsMSkgd2lsbCBhbGxvdyByb3RhdGlvbiBhbG9uZyBhbGwgYXhlcyB3aGlsZSAoMCwwLDApIGFsbG93cyBub25lLgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBzcGFjZSBib3VuZGluZyBib3ggb2YgdGhlIGJvZHkgYW5kIGl0cyBzaGFwZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEluZGljYXRlcyBpZiB0aGUgQUFCQiBuZWVkcyB0byBiZSB1cGRhdGVkIGJlZm9yZSB1c2UuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRvdGFsIGJvdW5kaW5nIHJhZGl1cyBvZiB0aGUgQm9keSBpbmNsdWRpbmcgaXRzIHNoYXBlcywgcmVsYXRpdmUgdG8gYm9keS5wb3NpdGlvbi4KICAgICAqLwoKICAgIC8qKgogICAgICogV2hlbiB0cnVlIHRoZSBib2R5IGJlaGF2ZXMgbGlrZSBhIHRyaWdnZXIuIEl0IGRvZXMgbm90IGNvbGxpZGUKICAgICAqIHdpdGggb3RoZXIgYm9kaWVzIGJ1dCBjb2xsaXNpb24gZXZlbnRzIGFyZSBzdGlsbCB0cmlnZ2VyZWQuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuaWQgPSB2b2lkIDA7CiAgICAgIHRoaXMuaW5kZXggPSB2b2lkIDA7CiAgICAgIHRoaXMud29ybGQgPSB2b2lkIDA7CiAgICAgIHRoaXMucHJlU3RlcCA9IHZvaWQgMDsKICAgICAgdGhpcy5wb3N0U3RlcCA9IHZvaWQgMDsKICAgICAgdGhpcy52bGFtYmRhID0gdm9pZCAwOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gdm9pZCAwOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSB2b2lkIDA7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSB2b2lkIDA7CiAgICAgIHRoaXMucG9zaXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRQb3NpdGlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5pbml0UG9zaXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMudmVsb2NpdHkgPSB2b2lkIDA7CiAgICAgIHRoaXMuaW5pdFZlbG9jaXR5ID0gdm9pZCAwOwogICAgICB0aGlzLmZvcmNlID0gdm9pZCAwOwogICAgICB0aGlzLm1hc3MgPSB2b2lkIDA7CiAgICAgIHRoaXMuaW52TWFzcyA9IHZvaWQgMDsKICAgICAgdGhpcy5tYXRlcmlhbCA9IHZvaWQgMDsKICAgICAgdGhpcy5saW5lYXJEYW1waW5nID0gdm9pZCAwOwogICAgICB0aGlzLnR5cGUgPSB2b2lkIDA7CiAgICAgIHRoaXMuYWxsb3dTbGVlcCA9IHZvaWQgMDsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gdm9pZCAwOwogICAgICB0aGlzLnNsZWVwU3BlZWRMaW1pdCA9IHZvaWQgMDsKICAgICAgdGhpcy5zbGVlcFRpbWVMaW1pdCA9IHZvaWQgMDsKICAgICAgdGhpcy50aW1lTGFzdFNsZWVweSA9IHZvaWQgMDsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gdm9pZCAwOwogICAgICB0aGlzLnRvcnF1ZSA9IHZvaWQgMDsKICAgICAgdGhpcy5xdWF0ZXJuaW9uID0gdm9pZCAwOwogICAgICB0aGlzLmluaXRRdWF0ZXJuaW9uID0gdm9pZCAwOwogICAgICB0aGlzLnByZXZpb3VzUXVhdGVybmlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uID0gdm9pZCAwOwogICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eSA9IHZvaWQgMDsKICAgICAgdGhpcy5pbml0QW5ndWxhclZlbG9jaXR5ID0gdm9pZCAwOwogICAgICB0aGlzLnNoYXBlcyA9IHZvaWQgMDsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMgPSB2b2lkIDA7CiAgICAgIHRoaXMuc2hhcGVPcmllbnRhdGlvbnMgPSB2b2lkIDA7CiAgICAgIHRoaXMuaW5lcnRpYSA9IHZvaWQgMDsKICAgICAgdGhpcy5pbnZJbmVydGlhID0gdm9pZCAwOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZCA9IHZvaWQgMDsKICAgICAgdGhpcy5pbnZNYXNzU29sdmUgPSB2b2lkIDA7CiAgICAgIHRoaXMuaW52SW5lcnRpYVNvbHZlID0gdm9pZCAwOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlID0gdm9pZCAwOwogICAgICB0aGlzLmZpeGVkUm90YXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMuYW5ndWxhckRhbXBpbmcgPSB2b2lkIDA7CiAgICAgIHRoaXMubGluZWFyRmFjdG9yID0gdm9pZCAwOwogICAgICB0aGlzLmFuZ3VsYXJGYWN0b3IgPSB2b2lkIDA7CiAgICAgIHRoaXMuYWFiYiA9IHZvaWQgMDsKICAgICAgdGhpcy5hYWJiTmVlZHNVcGRhdGUgPSB2b2lkIDA7CiAgICAgIHRoaXMuYm91bmRpbmdSYWRpdXMgPSB2b2lkIDA7CiAgICAgIHRoaXMud2xhbWJkYSA9IHZvaWQgMDsKICAgICAgdGhpcy5pc1RyaWdnZXIgPSB2b2lkIDA7CiAgICAgIHRoaXMuaWQgPSBCb2R5LmlkQ291bnRlcisrOwogICAgICB0aGlzLmluZGV4ID0gLTE7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLnByZVN0ZXAgPSBudWxsOwogICAgICB0aGlzLnBvc3RTdGVwID0gbnVsbDsKICAgICAgdGhpcy52bGFtYmRhID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwID09PSAnbnVtYmVyJyA/IG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyR3JvdXAgOiAxOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrID09PSAnbnVtYmVyJyA/IG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyTWFzayA6IC0xOwogICAgICB0aGlzLmNvbGxpc2lvblJlc3BvbnNlID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uUmVzcG9uc2UgPT09ICdib29sZWFuJyA/IG9wdGlvbnMuY29sbGlzaW9uUmVzcG9uc2UgOiB0cnVlOwogICAgICB0aGlzLnBvc2l0aW9uID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaW5pdFBvc2l0aW9uID0gbmV3IFZlYzMoKTsKCiAgICAgIGlmIChvcHRpb25zLnBvc2l0aW9uKSB7CiAgICAgICAgdGhpcy5wb3NpdGlvbi5jb3B5KG9wdGlvbnMucG9zaXRpb24pOwogICAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbi5jb3B5KG9wdGlvbnMucG9zaXRpb24pOwogICAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLmluaXRQb3NpdGlvbi5jb3B5KG9wdGlvbnMucG9zaXRpb24pOwogICAgICB9CgogICAgICB0aGlzLnZlbG9jaXR5ID0gbmV3IFZlYzMoKTsKCiAgICAgIGlmIChvcHRpb25zLnZlbG9jaXR5KSB7CiAgICAgICAgdGhpcy52ZWxvY2l0eS5jb3B5KG9wdGlvbnMudmVsb2NpdHkpOwogICAgICB9CgogICAgICB0aGlzLmluaXRWZWxvY2l0eSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuZm9yY2UgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBtYXNzID0gdHlwZW9mIG9wdGlvbnMubWFzcyA9PT0gJ251bWJlcicgPyBvcHRpb25zLm1hc3MgOiAwOwogICAgICB0aGlzLm1hc3MgPSBtYXNzOwogICAgICB0aGlzLmludk1hc3MgPSBtYXNzID4gMCA/IDEuMCAvIG1hc3MgOiAwOwogICAgICB0aGlzLm1hdGVyaWFsID0gb3B0aW9ucy5tYXRlcmlhbCB8fCBudWxsOwogICAgICB0aGlzLmxpbmVhckRhbXBpbmcgPSB0eXBlb2Ygb3B0aW9ucy5saW5lYXJEYW1waW5nID09PSAnbnVtYmVyJyA/IG9wdGlvbnMubGluZWFyRGFtcGluZyA6IDAuMDE7CiAgICAgIHRoaXMudHlwZSA9IG1hc3MgPD0gMC4wID8gQm9keS5TVEFUSUMgOiBCb2R5LkRZTkFNSUM7CgogICAgICBpZiAodHlwZW9mIG9wdGlvbnMudHlwZSA9PT0gdHlwZW9mIEJvZHkuU1RBVElDKSB7CiAgICAgICAgdGhpcy50eXBlID0gb3B0aW9ucy50eXBlOwogICAgICB9CgogICAgICB0aGlzLmFsbG93U2xlZXAgPSB0eXBlb2Ygb3B0aW9ucy5hbGxvd1NsZWVwICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuYWxsb3dTbGVlcCA6IHRydWU7CiAgICAgIHRoaXMuc2xlZXBTdGF0ZSA9IEJvZHkuQVdBS0U7CiAgICAgIHRoaXMuc2xlZXBTcGVlZExpbWl0ID0gdHlwZW9mIG9wdGlvbnMuc2xlZXBTcGVlZExpbWl0ICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuc2xlZXBTcGVlZExpbWl0IDogMC4xOwogICAgICB0aGlzLnNsZWVwVGltZUxpbWl0ID0gdHlwZW9mIG9wdGlvbnMuc2xlZXBUaW1lTGltaXQgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5zbGVlcFRpbWVMaW1pdCA6IDE7CiAgICAgIHRoaXMudGltZUxhc3RTbGVlcHkgPSAwOwogICAgICB0aGlzLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSBmYWxzZTsKICAgICAgdGhpcy50b3JxdWUgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB0aGlzLmluaXRRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5wcmV2aW91c1F1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB0aGlzLmludGVycG9sYXRlZFF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKG9wdGlvbnMucXVhdGVybmlvbikgewogICAgICAgIHRoaXMucXVhdGVybmlvbi5jb3B5KG9wdGlvbnMucXVhdGVybmlvbik7CiAgICAgICAgdGhpcy5pbml0UXVhdGVybmlvbi5jb3B5KG9wdGlvbnMucXVhdGVybmlvbik7CiAgICAgICAgdGhpcy5wcmV2aW91c1F1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUXVhdGVybmlvbi5jb3B5KG9wdGlvbnMucXVhdGVybmlvbik7CiAgICAgIH0KCiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5ID0gbmV3IFZlYzMoKTsKCiAgICAgIGlmIChvcHRpb25zLmFuZ3VsYXJWZWxvY2l0eSkgewogICAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LmNvcHkob3B0aW9ucy5hbmd1bGFyVmVsb2NpdHkpOwogICAgICB9CgogICAgICB0aGlzLmluaXRBbmd1bGFyVmVsb2NpdHkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnNoYXBlcyA9IFtdOwogICAgICB0aGlzLnNoYXBlT2Zmc2V0cyA9IFtdOwogICAgICB0aGlzLnNoYXBlT3JpZW50YXRpb25zID0gW107CiAgICAgIHRoaXMuaW5lcnRpYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaW52SW5lcnRpYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaW52SW5lcnRpYVdvcmxkID0gbmV3IE1hdDMoKTsKICAgICAgdGhpcy5pbnZNYXNzU29sdmUgPSAwOwogICAgICB0aGlzLmludkluZXJ0aWFTb2x2ZSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaW52SW5lcnRpYVdvcmxkU29sdmUgPSBuZXcgTWF0MygpOwogICAgICB0aGlzLmZpeGVkUm90YXRpb24gPSB0eXBlb2Ygb3B0aW9ucy5maXhlZFJvdGF0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuZml4ZWRSb3RhdGlvbiA6IGZhbHNlOwogICAgICB0aGlzLmFuZ3VsYXJEYW1waW5nID0gdHlwZW9mIG9wdGlvbnMuYW5ndWxhckRhbXBpbmcgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5hbmd1bGFyRGFtcGluZyA6IDAuMDE7CiAgICAgIHRoaXMubGluZWFyRmFjdG9yID0gbmV3IFZlYzMoMSwgMSwgMSk7CgogICAgICBpZiAob3B0aW9ucy5saW5lYXJGYWN0b3IpIHsKICAgICAgICB0aGlzLmxpbmVhckZhY3Rvci5jb3B5KG9wdGlvbnMubGluZWFyRmFjdG9yKTsKICAgICAgfQoKICAgICAgdGhpcy5hbmd1bGFyRmFjdG9yID0gbmV3IFZlYzMoMSwgMSwgMSk7CgogICAgICBpZiAob3B0aW9ucy5hbmd1bGFyRmFjdG9yKSB7CiAgICAgICAgdGhpcy5hbmd1bGFyRmFjdG9yLmNvcHkob3B0aW9ucy5hbmd1bGFyRmFjdG9yKTsKICAgICAgfQoKICAgICAgdGhpcy5hYWJiID0gbmV3IEFBQkIoKTsKICAgICAgdGhpcy5hYWJiTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB0aGlzLmJvdW5kaW5nUmFkaXVzID0gMDsKICAgICAgdGhpcy53bGFtYmRhID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5pc1RyaWdnZXIgPSBCb29sZWFuKG9wdGlvbnMuaXNUcmlnZ2VyKTsKCiAgICAgIGlmIChvcHRpb25zLnNoYXBlKSB7CiAgICAgICAgdGhpcy5hZGRTaGFwZShvcHRpb25zLnNoYXBlKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgfQogICAgLyoqCiAgICAgKiBXYWtlIHRoZSBib2R5IHVwLgogICAgICovCgoKICAgIHdha2VVcCgpIHsKICAgICAgY29uc3QgcHJldlN0YXRlID0gdGhpcy5zbGVlcFN0YXRlOwogICAgICB0aGlzLnNsZWVwU3RhdGUgPSBCb2R5LkFXQUtFOwogICAgICB0aGlzLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSBmYWxzZTsKCiAgICAgIGlmIChwcmV2U3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoQm9keS53YWtldXBFdmVudCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRm9yY2UgYm9keSBzbGVlcAogICAgICovCgoKICAgIHNsZWVwKCkgewogICAgICB0aGlzLnNsZWVwU3RhdGUgPSBCb2R5LlNMRUVQSU5HOwogICAgICB0aGlzLnZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuc2V0KDAsIDAsIDApOwogICAgICB0aGlzLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogQ2FsbGVkIGV2ZXJ5IHRpbWVzdGVwIHRvIHVwZGF0ZSBpbnRlcm5hbCBzbGVlcCB0aW1lciBhbmQgY2hhbmdlIHNsZWVwIHN0YXRlIGlmIG5lZWRlZC4KICAgICAqIEBwYXJhbSB0aW1lIFRoZSB3b3JsZCB0aW1lIGluIHNlY29uZHMKICAgICAqLwoKCiAgICBzbGVlcFRpY2sodGltZSkgewogICAgICBpZiAodGhpcy5hbGxvd1NsZWVwKSB7CiAgICAgICAgY29uc3Qgc2xlZXBTdGF0ZSA9IHRoaXMuc2xlZXBTdGF0ZTsKICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWQgPSB0aGlzLnZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKSArIHRoaXMuYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICBjb25zdCBzcGVlZExpbWl0U3F1YXJlZCA9IHRoaXMuc2xlZXBTcGVlZExpbWl0ICoqIDI7CgogICAgICAgIGlmIChzbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIHNwZWVkU3F1YXJlZCA8IHNwZWVkTGltaXRTcXVhcmVkKSB7CiAgICAgICAgICB0aGlzLnNsZWVwU3RhdGUgPSBCb2R5LlNMRUVQWTsgLy8gU2xlZXB5CgogICAgICAgICAgdGhpcy50aW1lTGFzdFNsZWVweSA9IHRpbWU7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoQm9keS5zbGVlcHlFdmVudCk7CiAgICAgICAgfSBlbHNlIGlmIChzbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQWSAmJiBzcGVlZFNxdWFyZWQgPiBzcGVlZExpbWl0U3F1YXJlZCkgewogICAgICAgICAgdGhpcy53YWtlVXAoKTsgLy8gV2FrZSB1cAogICAgICAgIH0gZWxzZSBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUFkgJiYgdGltZSAtIHRoaXMudGltZUxhc3RTbGVlcHkgPiB0aGlzLnNsZWVwVGltZUxpbWl0KSB7CiAgICAgICAgICB0aGlzLnNsZWVwKCk7IC8vIFNsZWVwaW5nCgogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkuc2xlZXBFdmVudCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIElmIHRoZSBib2R5IGlzIHNsZWVwaW5nLCBpdCBzaG91bGQgYmUgaW1tb3ZhYmxlIC8gaGF2ZSBpbmZpbml0ZSBtYXNzIGR1cmluZyBzb2x2ZS4gV2Ugc29sdmUgaXQgYnkgaGF2aW5nIGEgc2VwYXJhdGUgInNvbHZlIG1hc3MiLgogICAgICovCgoKICAgIHVwZGF0ZVNvbHZlTWFzc1Byb3BlcnRpZXMoKSB7CiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcgfHwgdGhpcy50eXBlID09PSBCb2R5LktJTkVNQVRJQykgewogICAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gMDsKICAgICAgICB0aGlzLmludkluZXJ0aWFTb2x2ZS5zZXRaZXJvKCk7CiAgICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGRTb2x2ZS5zZXRaZXJvKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5pbnZNYXNzU29sdmUgPSB0aGlzLmludk1hc3M7CiAgICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUuY29weSh0aGlzLmludkluZXJ0aWEpOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVdvcmxkU29sdmUuY29weSh0aGlzLmludkluZXJ0aWFXb3JsZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIHdvcmxkIHBvaW50IHRvIGxvY2FsIGJvZHkgZnJhbWUuCiAgICAgKi8KCgogICAgcG9pbnRUb0xvY2FsRnJhbWUod29ybGRQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHdvcmxkUG9pbnQudnN1Yih0aGlzLnBvc2l0aW9uLCByZXN1bHQpOwogICAgICB0aGlzLnF1YXRlcm5pb24uY29uanVnYXRlKCkudm11bHQocmVzdWx0LCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgd29ybGQgdmVjdG9yIHRvIGxvY2FsIGJvZHkgZnJhbWUuCiAgICAgKi8KCgogICAgdmVjdG9yVG9Mb2NhbEZyYW1lKHdvcmxkVmVjdG9yLCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGhpcy5xdWF0ZXJuaW9uLmNvbmp1Z2F0ZSgpLnZtdWx0KHdvcmxkVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgbG9jYWwgYm9keSBwb2ludCB0byB3b3JsZCBmcmFtZS4KICAgICAqLwoKCiAgICBwb2ludFRvV29ybGRGcmFtZShsb2NhbFBvaW50LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGhpcy5xdWF0ZXJuaW9uLnZtdWx0KGxvY2FsUG9pbnQsIHJlc3VsdCk7CiAgICAgIHJlc3VsdC52YWRkKHRoaXMucG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSBsb2NhbCBib2R5IHBvaW50IHRvIHdvcmxkIGZyYW1lLgogICAgICovCgoKICAgIHZlY3RvclRvV29ybGRGcmFtZShsb2NhbFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi52bXVsdChsb2NhbFZlY3RvciwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQWRkIGEgc2hhcGUgdG8gdGhlIGJvZHkgd2l0aCBhIGxvY2FsIG9mZnNldCBhbmQgb3JpZW50YXRpb24uCiAgICAgKiBAcmV0dXJuIFRoZSBib2R5IG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwoKCiAgICBhZGRTaGFwZShzaGFwZSwgX29mZnNldCwgX29yaWVudGF0aW9uKSB7CiAgICAgIGNvbnN0IG9mZnNldCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IG9yaWVudGF0aW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgICAgIGlmIChfb2Zmc2V0KSB7CiAgICAgICAgb2Zmc2V0LmNvcHkoX29mZnNldCk7CiAgICAgIH0KCiAgICAgIGlmIChfb3JpZW50YXRpb24pIHsKICAgICAgICBvcmllbnRhdGlvbi5jb3B5KF9vcmllbnRhdGlvbik7CiAgICAgIH0KCiAgICAgIHRoaXMuc2hhcGVzLnB1c2goc2hhcGUpOwogICAgICB0aGlzLnNoYXBlT2Zmc2V0cy5wdXNoKG9mZnNldCk7CiAgICAgIHRoaXMuc2hhcGVPcmllbnRhdGlvbnMucHVzaChvcmllbnRhdGlvbik7CiAgICAgIHRoaXMudXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1JhZGl1cygpOwogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHNoYXBlLmJvZHkgPSB0aGlzOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGEgc2hhcGUgZnJvbSB0aGUgYm9keS4KICAgICAqIEByZXR1cm4gVGhlIGJvZHkgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIHJlbW92ZVNoYXBlKHNoYXBlKSB7CiAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5zaGFwZXMuaW5kZXhPZihzaGFwZSk7CgogICAgICBpZiAoaW5kZXggPT09IC0xKSB7CiAgICAgICAgY29uc29sZS53YXJuKCdTaGFwZSBkb2VzIG5vdCBiZWxvbmcgdG8gdGhlIGJvZHknKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgdGhpcy5zaGFwZXMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgdGhpcy5zaGFwZU9yaWVudGF0aW9ucy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB0aGlzLnVwZGF0ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdSYWRpdXMoKTsKICAgICAgdGhpcy5hYWJiTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICBzaGFwZS5ib2R5ID0gbnVsbDsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYm91bmRpbmcgcmFkaXVzIG9mIHRoZSBib2R5LiBTaG91bGQgYmUgZG9uZSBpZiBhbnkgb2YgdGhlIHNoYXBlcyBhcmUgY2hhbmdlZC4KICAgICAqLwoKCiAgICB1cGRhdGVCb3VuZGluZ1JhZGl1cygpIHsKICAgICAgY29uc3Qgc2hhcGVzID0gdGhpcy5zaGFwZXM7CiAgICAgIGNvbnN0IHNoYXBlT2Zmc2V0cyA9IHRoaXMuc2hhcGVPZmZzZXRzOwogICAgICBjb25zdCBOID0gc2hhcGVzLmxlbmd0aDsKICAgICAgbGV0IHJhZGl1cyA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGUgPSBzaGFwZXNbaV07CiAgICAgICAgc2hhcGUudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgICAgICBjb25zdCBvZmZzZXQgPSBzaGFwZU9mZnNldHNbaV0ubGVuZ3RoKCk7CiAgICAgICAgY29uc3QgciA9IHNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzOwoKICAgICAgICBpZiAob2Zmc2V0ICsgciA+IHJhZGl1cykgewogICAgICAgICAgcmFkaXVzID0gb2Zmc2V0ICsgcjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuYm91bmRpbmdSYWRpdXMgPSByYWRpdXM7CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZXMgdGhlIC5hYWJiCiAgICAgKi8KCgogICAgdXBkYXRlQUFCQigpIHsKICAgICAgY29uc3Qgc2hhcGVzID0gdGhpcy5zaGFwZXM7CiAgICAgIGNvbnN0IHNoYXBlT2Zmc2V0cyA9IHRoaXMuc2hhcGVPZmZzZXRzOwogICAgICBjb25zdCBzaGFwZU9yaWVudGF0aW9ucyA9IHRoaXMuc2hhcGVPcmllbnRhdGlvbnM7CiAgICAgIGNvbnN0IE4gPSBzaGFwZXMubGVuZ3RoOwogICAgICBjb25zdCBvZmZzZXQgPSB0bXBWZWM7CiAgICAgIGNvbnN0IG9yaWVudGF0aW9uID0gdG1wUXVhdDsKICAgICAgY29uc3QgYm9keVF1YXQgPSB0aGlzLnF1YXRlcm5pb247CiAgICAgIGNvbnN0IGFhYmIgPSB0aGlzLmFhYmI7CiAgICAgIGNvbnN0IHNoYXBlQUFCQiA9IHVwZGF0ZUFBQkJfc2hhcGVBQUJCOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2ldOyAvLyBHZXQgc2hhcGUgd29ybGQgcG9zaXRpb24KCiAgICAgICAgYm9keVF1YXQudm11bHQoc2hhcGVPZmZzZXRzW2ldLCBvZmZzZXQpOwogICAgICAgIG9mZnNldC52YWRkKHRoaXMucG9zaXRpb24sIG9mZnNldCk7IC8vIEdldCBzaGFwZSB3b3JsZCBxdWF0ZXJuaW9uCgogICAgICAgIGJvZHlRdWF0Lm11bHQoc2hhcGVPcmllbnRhdGlvbnNbaV0sIG9yaWVudGF0aW9uKTsgLy8gR2V0IHNoYXBlIEFBQkIKCiAgICAgICAgc2hhcGUuY2FsY3VsYXRlV29ybGRBQUJCKG9mZnNldCwgb3JpZW50YXRpb24sIHNoYXBlQUFCQi5sb3dlckJvdW5kLCBzaGFwZUFBQkIudXBwZXJCb3VuZCk7CgogICAgICAgIGlmIChpID09PSAwKSB7CiAgICAgICAgICBhYWJiLmNvcHkoc2hhcGVBQUJCKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYWFiYi5leHRlbmQoc2hhcGVBQUJCKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSBgLmluZXJ0aWFXb3JsZGAgYW5kIGAuaW52SW5lcnRpYVdvcmxkYAogICAgICovCgoKICAgIHVwZGF0ZUluZXJ0aWFXb3JsZChmb3JjZSkgewogICAgICBjb25zdCBJID0gdGhpcy5pbnZJbmVydGlhOwogICAgICBpZiAoSS54ID09PSBJLnkgJiYgSS55ID09PSBJLnogJiYgIWZvcmNlKSA7ZWxzZSB7CiAgICAgICAgY29uc3QgbTEgPSB1aXdfbTE7CiAgICAgICAgY29uc3QgbTIgPSB1aXdfbTI7CiAgICAgICAgbTEuc2V0Um90YXRpb25Gcm9tUXVhdGVybmlvbih0aGlzLnF1YXRlcm5pb24pOwogICAgICAgIG0xLnRyYW5zcG9zZShtMik7CiAgICAgICAgbTEuc2NhbGUoSSwgbTEpOwogICAgICAgIG0xLm1tdWx0KG0yLCB0aGlzLmludkluZXJ0aWFXb3JsZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgZm9yY2UgdG8gYSBwb2ludCBvZiB0aGUgYm9keS4gVGhpcyBjb3VsZCBmb3IgZXhhbXBsZSBiZSBhIHBvaW50IG9uIHRoZSBCb2R5IHN1cmZhY2UuCiAgICAgKiBBcHBseWluZyBmb3JjZSB0aGlzIHdheSB3aWxsIGFkZCB0byBCb2R5LmZvcmNlIGFuZCBCb2R5LnRvcnF1ZS4KICAgICAqIEBwYXJhbSBmb3JjZSBUaGUgYW1vdW50IG9mIGZvcmNlIHRvIGFkZC4KICAgICAqIEBwYXJhbSByZWxhdGl2ZVBvaW50IEEgcG9pbnQgcmVsYXRpdmUgdG8gdGhlIGNlbnRlciBvZiBtYXNzIHRvIGFwcGx5IHRoZSBmb3JjZSBvbi4KICAgICAqLwoKCiAgICBhcHBseUZvcmNlKGZvcmNlLCByZWxhdGl2ZVBvaW50KSB7CiAgICAgIGlmIChyZWxhdGl2ZVBvaW50ID09PSB2b2lkIDApIHsKICAgICAgICByZWxhdGl2ZVBvaW50ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgLy8gTmVlZGVkPwogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcHJvZHVjZWQgcm90YXRpb25hbCBmb3JjZQoKCiAgICAgIGNvbnN0IHJvdEZvcmNlID0gQm9keV9hcHBseUZvcmNlX3JvdEZvcmNlOwogICAgICByZWxhdGl2ZVBvaW50LmNyb3NzKGZvcmNlLCByb3RGb3JjZSk7IC8vIEFkZCBsaW5lYXIgZm9yY2UKCiAgICAgIHRoaXMuZm9yY2UudmFkZChmb3JjZSwgdGhpcy5mb3JjZSk7IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgogICAgICB0aGlzLnRvcnF1ZS52YWRkKHJvdEZvcmNlLCB0aGlzLnRvcnF1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IGZvcmNlIHRvIGEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gZm9yY2UgVGhlIGZvcmNlIHZlY3RvciB0byBhcHBseSwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBib2R5IGZyYW1lLgogICAgICogQHBhcmFtIGxvY2FsUG9pbnQgQSBsb2NhbCBwb2ludCBpbiB0aGUgYm9keSB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlMb2NhbEZvcmNlKGxvY2FsRm9yY2UsIGxvY2FsUG9pbnQpIHsKICAgICAgaWYgKGxvY2FsUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIGxvY2FsUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkRm9yY2UgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV93b3JsZEZvcmNlOwogICAgICBjb25zdCByZWxhdGl2ZVBvaW50V29ybGQgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV9yZWxhdGl2ZVBvaW50V29ybGQ7IC8vIFRyYW5zZm9ybSB0aGUgZm9yY2UgdmVjdG9yIHRvIHdvcmxkIHNwYWNlCgogICAgICB0aGlzLnZlY3RvclRvV29ybGRGcmFtZShsb2NhbEZvcmNlLCB3b3JsZEZvcmNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUZvcmNlKHdvcmxkRm9yY2UsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRvcnF1ZSB0byB0aGUgYm9keS4KICAgICAqIEBwYXJhbSB0b3JxdWUgVGhlIGFtb3VudCBvZiB0b3JxdWUgdG8gYWRkLgogICAgICovCgoKICAgIGFwcGx5VG9ycXVlKHRvcnF1ZSkgewogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgoKICAgICAgdGhpcy50b3JxdWUudmFkZCh0b3JxdWUsIHRoaXMudG9ycXVlKTsKICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgaW1wdWxzZSB0byBhIHBvaW50IG9mIHRoZSBib2R5LiBUaGlzIGNvdWxkIGZvciBleGFtcGxlIGJlIGEgcG9pbnQgb24gdGhlIEJvZHkgc3VyZmFjZS4KICAgICAqIEFuIGltcHVsc2UgaXMgYSBmb3JjZSBhZGRlZCB0byBhIGJvZHkgZHVyaW5nIGEgc2hvcnQgcGVyaW9kIG9mIHRpbWUgKGltcHVsc2UgPSBmb3JjZSAqIHRpbWUpLgogICAgICogSW1wdWxzZXMgd2lsbCBiZSBhZGRlZCB0byBCb2R5LnZlbG9jaXR5IGFuZCBCb2R5LmFuZ3VsYXJWZWxvY2l0eS4KICAgICAqIEBwYXJhbSBpbXB1bHNlIFRoZSBhbW91bnQgb2YgaW1wdWxzZSB0byBhZGQuCiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQb2ludCBBIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlJbXB1bHNlKGltcHVsc2UsIHJlbGF0aXZlUG9pbnQpIHsKICAgICAgaWYgKHJlbGF0aXZlUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIHJlbGF0aXZlUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcG9pbnQgcG9zaXRpb24gcmVsYXRpdmUgdG8gdGhlIGJvZHkgY2VudGVyCgoKICAgICAgY29uc3QgciA9IHJlbGF0aXZlUG9pbnQ7IC8vIENvbXB1dGUgcHJvZHVjZWQgY2VudHJhbCBpbXB1bHNlIHZlbG9jaXR5CgogICAgICBjb25zdCB2ZWxvID0gQm9keV9hcHBseUltcHVsc2VfdmVsbzsKICAgICAgdmVsby5jb3B5KGltcHVsc2UpOwogICAgICB2ZWxvLnNjYWxlKHRoaXMuaW52TWFzcywgdmVsbyk7IC8vIEFkZCBsaW5lYXIgaW1wdWxzZQoKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHZlbG8sIHRoaXMudmVsb2NpdHkpOyAvLyBDb21wdXRlIHByb2R1Y2VkIHJvdGF0aW9uYWwgaW1wdWxzZSB2ZWxvY2l0eQoKICAgICAgY29uc3Qgcm90VmVsbyA9IEJvZHlfYXBwbHlJbXB1bHNlX3JvdFZlbG87CiAgICAgIHIuY3Jvc3MoaW1wdWxzZSwgcm90VmVsbyk7CiAgICAgIC8qCiAgICAgICByb3RWZWxvLnggKj0gdGhpcy5pbnZJbmVydGlhLng7CiAgICAgICByb3RWZWxvLnkgKj0gdGhpcy5pbnZJbmVydGlhLnk7CiAgICAgICByb3RWZWxvLnogKj0gdGhpcy5pbnZJbmVydGlhLno7CiAgICAgICAqLwoKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGQudm11bHQocm90VmVsbywgcm90VmVsbyk7IC8vIEFkZCByb3RhdGlvbmFsIEltcHVsc2UKCiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnZhZGQocm90VmVsbywgdGhpcy5hbmd1bGFyVmVsb2NpdHkpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSBsb2NhbGx5LWRlZmluZWQgaW1wdWxzZSB0byBhIGxvY2FsIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIGZvcmNlIFRoZSBmb3JjZSB2ZWN0b3IgdG8gYXBwbHksIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgYm9keSBmcmFtZS4KICAgICAqIEBwYXJhbSBsb2NhbFBvaW50IEEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5TG9jYWxJbXB1bHNlKGxvY2FsSW1wdWxzZSwgbG9jYWxQb2ludCkgewogICAgICBpZiAobG9jYWxQb2ludCA9PT0gdm9pZCAwKSB7CiAgICAgICAgbG9jYWxQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnR5cGUgIT09IEJvZHkuRFlOQU1JQykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgd29ybGRJbXB1bHNlID0gQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2U7CiAgICAgIGNvbnN0IHJlbGF0aXZlUG9pbnRXb3JsZCA9IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludDsgLy8gVHJhbnNmb3JtIHRoZSBmb3JjZSB2ZWN0b3IgdG8gd29ybGQgc3BhY2UKCiAgICAgIHRoaXMudmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsSW1wdWxzZSwgd29ybGRJbXB1bHNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUltcHVsc2Uod29ybGRJbXB1bHNlLCByZWxhdGl2ZVBvaW50V29ybGQpOwogICAgfQogICAgLyoqCiAgICAgKiBTaG91bGQgYmUgY2FsbGVkIHdoZW5ldmVyIHlvdSBjaGFuZ2UgdGhlIGJvZHkgc2hhcGUgb3IgbWFzcy4KICAgICAqLwoKCiAgICB1cGRhdGVNYXNzUHJvcGVydGllcygpIHsKICAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBCb2R5X3VwZGF0ZU1hc3NQcm9wZXJ0aWVzX2hhbGZFeHRlbnRzOwogICAgICB0aGlzLmludk1hc3MgPSB0aGlzLm1hc3MgPiAwID8gMS4wIC8gdGhpcy5tYXNzIDogMDsKICAgICAgY29uc3QgSSA9IHRoaXMuaW5lcnRpYTsKICAgICAgY29uc3QgZml4ZWQgPSB0aGlzLmZpeGVkUm90YXRpb247IC8vIEFwcHJveGltYXRlIHdpdGggQUFCQiBib3gKCiAgICAgIHRoaXMudXBkYXRlQUFCQigpOwogICAgICBoYWxmRXh0ZW50cy5zZXQoKHRoaXMuYWFiYi51cHBlckJvdW5kLnggLSB0aGlzLmFhYmIubG93ZXJCb3VuZC54KSAvIDIsICh0aGlzLmFhYmIudXBwZXJCb3VuZC55IC0gdGhpcy5hYWJiLmxvd2VyQm91bmQueSkgLyAyLCAodGhpcy5hYWJiLnVwcGVyQm91bmQueiAtIHRoaXMuYWFiYi5sb3dlckJvdW5kLnopIC8gMik7CiAgICAgIEJveC5jYWxjdWxhdGVJbmVydGlhKGhhbGZFeHRlbnRzLCB0aGlzLm1hc3MsIEkpOwogICAgICB0aGlzLmludkluZXJ0aWEuc2V0KEkueCA+IDAgJiYgIWZpeGVkID8gMS4wIC8gSS54IDogMCwgSS55ID4gMCAmJiAhZml4ZWQgPyAxLjAgLyBJLnkgOiAwLCBJLnogPiAwICYmICFmaXhlZCA/IDEuMCAvIEkueiA6IDApOwogICAgICB0aGlzLnVwZGF0ZUluZXJ0aWFXb3JsZCh0cnVlKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHdvcmxkIHZlbG9jaXR5IG9mIGEgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gd29ybGRQb2ludAogICAgICogQHBhcmFtIHJlc3VsdAogICAgICogQHJldHVybiBUaGUgcmVzdWx0IHZlY3Rvci4KICAgICAqLwoKCiAgICBnZXRWZWxvY2l0eUF0V29ybGRQb2ludCh3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgY29uc3QgciA9IG5ldyBWZWMzKCk7CiAgICAgIHdvcmxkUG9pbnQudnN1Yih0aGlzLnBvc2l0aW9uLCByKTsKICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MociwgcmVzdWx0KTsKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogTW92ZSB0aGUgYm9keSBmb3J3YXJkIGluIHRpbWUuCiAgICAgKiBAcGFyYW0gZHQgVGltZSBzdGVwCiAgICAgKiBAcGFyYW0gcXVhdE5vcm1hbGl6ZSBTZXQgdG8gdHJ1ZSB0byBub3JtYWxpemUgdGhlIGJvZHkgcXVhdGVybmlvbgogICAgICogQHBhcmFtIHF1YXROb3JtYWxpemVGYXN0IElmIHRoZSBxdWF0ZXJuaW9uIHNob3VsZCBiZSBub3JtYWxpemVkIHVzaW5nICJmYXN0IiBxdWF0ZXJuaW9uIG5vcm1hbGl6YXRpb24KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgIC8vIFNhdmUgcHJldmlvdXMgcG9zaXRpb24KICAgICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uLmNvcHkodGhpcy5wb3NpdGlvbik7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkodGhpcy5xdWF0ZXJuaW9uKTsKCiAgICAgIGlmICghKHRoaXMudHlwZSA9PT0gQm9keS5EWU5BTUlDIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHx8IHRoaXMuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORykgewogICAgICAgIC8vIE9ubHkgZm9yIGR5bmFtaWMKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlbG8gPSB0aGlzLnZlbG9jaXR5OwogICAgICBjb25zdCBhbmd1bGFyVmVsbyA9IHRoaXMuYW5ndWxhclZlbG9jaXR5OwogICAgICBjb25zdCBwb3MgPSB0aGlzLnBvc2l0aW9uOwogICAgICBjb25zdCBmb3JjZSA9IHRoaXMuZm9yY2U7CiAgICAgIGNvbnN0IHRvcnF1ZSA9IHRoaXMudG9ycXVlOwogICAgICBjb25zdCBxdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBpbnZNYXNzID0gdGhpcy5pbnZNYXNzOwogICAgICBjb25zdCBpbnZJbmVydGlhID0gdGhpcy5pbnZJbmVydGlhV29ybGQ7CiAgICAgIGNvbnN0IGxpbmVhckZhY3RvciA9IHRoaXMubGluZWFyRmFjdG9yOwogICAgICBjb25zdCBpTWR0ID0gaW52TWFzcyAqIGR0OwogICAgICB2ZWxvLnggKz0gZm9yY2UueCAqIGlNZHQgKiBsaW5lYXJGYWN0b3IueDsKICAgICAgdmVsby55ICs9IGZvcmNlLnkgKiBpTWR0ICogbGluZWFyRmFjdG9yLnk7CiAgICAgIHZlbG8ueiArPSBmb3JjZS56ICogaU1kdCAqIGxpbmVhckZhY3Rvci56OwogICAgICBjb25zdCBlID0gaW52SW5lcnRpYS5lbGVtZW50czsKICAgICAgY29uc3QgYW5ndWxhckZhY3RvciA9IHRoaXMuYW5ndWxhckZhY3RvcjsKICAgICAgY29uc3QgdHggPSB0b3JxdWUueCAqIGFuZ3VsYXJGYWN0b3IueDsKICAgICAgY29uc3QgdHkgPSB0b3JxdWUueSAqIGFuZ3VsYXJGYWN0b3IueTsKICAgICAgY29uc3QgdHogPSB0b3JxdWUueiAqIGFuZ3VsYXJGYWN0b3IuejsKICAgICAgYW5ndWxhclZlbG8ueCArPSBkdCAqIChlWzBdICogdHggKyBlWzFdICogdHkgKyBlWzJdICogdHopOwogICAgICBhbmd1bGFyVmVsby55ICs9IGR0ICogKGVbM10gKiB0eCArIGVbNF0gKiB0eSArIGVbNV0gKiB0eik7CiAgICAgIGFuZ3VsYXJWZWxvLnogKz0gZHQgKiAoZVs2XSAqIHR4ICsgZVs3XSAqIHR5ICsgZVs4XSAqIHR6KTsgLy8gVXNlIG5ldyB2ZWxvY2l0eSAgLSBsZWFwIGZyb2cKCiAgICAgIHBvcy54ICs9IHZlbG8ueCAqIGR0OwogICAgICBwb3MueSArPSB2ZWxvLnkgKiBkdDsKICAgICAgcG9zLnogKz0gdmVsby56ICogZHQ7CiAgICAgIHF1YXQuaW50ZWdyYXRlKHRoaXMuYW5ndWxhclZlbG9jaXR5LCBkdCwgdGhpcy5hbmd1bGFyRmFjdG9yLCBxdWF0KTsKCiAgICAgIGlmIChxdWF0Tm9ybWFsaXplKSB7CiAgICAgICAgaWYgKHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgICAgICBxdWF0Lm5vcm1hbGl6ZUZhc3QoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcXVhdC5ub3JtYWxpemUoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsgLy8gVXBkYXRlIHdvcmxkIGluZXJ0aWEKCiAgICAgIHRoaXMudXBkYXRlSW5lcnRpYVdvcmxkKCk7CiAgICB9CgogIH0KCiAgQm9keS5pZENvdW50ZXIgPSAwOwogIEJvZHkuQ09MTElERV9FVkVOVF9OQU1FID0gJ2NvbGxpZGUnOwogIEJvZHkuRFlOQU1JQyA9IEJPRFlfVFlQRVMuRFlOQU1JQzsKICBCb2R5LlNUQVRJQyA9IEJPRFlfVFlQRVMuU1RBVElDOwogIEJvZHkuS0lORU1BVElDID0gQk9EWV9UWVBFUy5LSU5FTUFUSUM7CiAgQm9keS5BV0FLRSA9IEJPRFlfU0xFRVBfU1RBVEVTLkFXQUtFOwogIEJvZHkuU0xFRVBZID0gQk9EWV9TTEVFUF9TVEFURVMuU0xFRVBZOwogIEJvZHkuU0xFRVBJTkcgPSBCT0RZX1NMRUVQX1NUQVRFUy5TTEVFUElORzsKICBCb2R5Lndha2V1cEV2ZW50ID0gewogICAgdHlwZTogJ3dha2V1cCcKICB9OwogIEJvZHkuc2xlZXB5RXZlbnQgPSB7CiAgICB0eXBlOiAnc2xlZXB5JwogIH07CiAgQm9keS5zbGVlcEV2ZW50ID0gewogICAgdHlwZTogJ3NsZWVwJwogIH07CiAgY29uc3QgdG1wVmVjID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBRdWF0ID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCB1cGRhdGVBQUJCX3NoYXBlQUFCQiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgdWl3X20xID0gbmV3IE1hdDMoKTsKICBjb25zdCB1aXdfbTIgPSBuZXcgTWF0MygpOwogIGNvbnN0IEJvZHlfYXBwbHlGb3JjZV9yb3RGb3JjZSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUxvY2FsRm9yY2Vfd29ybGRGb3JjZSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUxvY2FsRm9yY2VfcmVsYXRpdmVQb2ludFdvcmxkID0gbmV3IFZlYzMoKTsKICBjb25zdCBCb2R5X2FwcGx5SW1wdWxzZV92ZWxvID0gbmV3IFZlYzMoKTsKICBjb25zdCBCb2R5X2FwcGx5SW1wdWxzZV9yb3RWZWxvID0gbmV3IFZlYzMoKTsKICBjb25zdCBCb2R5X2FwcGx5TG9jYWxJbXB1bHNlX3dvcmxkSW1wdWxzZSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUxvY2FsSW1wdWxzZV9yZWxhdGl2ZVBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCBCb2R5X3VwZGF0ZU1hc3NQcm9wZXJ0aWVzX2hhbGZFeHRlbnRzID0gbmV3IFZlYzMoKTsKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBicm9hZHBoYXNlIGltcGxlbWVudGF0aW9ucwogICAqIEBhdXRob3Igc2NodGVwcGUKICAgKi8KCiAgY2xhc3MgQnJvYWRwaGFzZSB7CiAgICAvKioKICAgICAqIFRoZSB3b3JsZCB0byBzZWFyY2ggZm9yIGNvbGxpc2lvbnMgaW4uCiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHNldCB0byB0cnVlLCB0aGUgYnJvYWRwaGFzZSB1c2VzIGJvdW5kaW5nIGJveGVzIGZvciBpbnRlcnNlY3Rpb24gdGVzdHMsIGVsc2UgaXQgdXNlcyBib3VuZGluZyBzcGhlcmVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBTZXQgdG8gdHJ1ZSBpZiB0aGUgb2JqZWN0cyBpbiB0aGUgd29ybGQgbW92ZWQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLndvcmxkID0gdm9pZCAwOwogICAgICB0aGlzLnVzZUJvdW5kaW5nQm94ZXMgPSB2b2lkIDA7CiAgICAgIHRoaXMuZGlydHkgPSB2b2lkIDA7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLnVzZUJvdW5kaW5nQm94ZXMgPSBmYWxzZTsKICAgICAgdGhpcy5kaXJ0eSA9IHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgY29sbGlzaW9uIHBhaXJzIGZyb20gdGhlIHdvcmxkCiAgICAgKiBAcGFyYW0gd29ybGQgVGhlIHdvcmxkIHRvIHNlYXJjaCBpbgogICAgICogQHBhcmFtIHAxIEVtcHR5IGFycmF5IHRvIGJlIGZpbGxlZCB3aXRoIGJvZHkgb2JqZWN0cwogICAgICogQHBhcmFtIHAyIEVtcHR5IGFycmF5IHRvIGJlIGZpbGxlZCB3aXRoIGJvZHkgb2JqZWN0cwogICAgICovCgoKICAgIGNvbGxpc2lvblBhaXJzKHdvcmxkLCBwMSwgcDIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb2xsaXNpb25QYWlycyBub3QgaW1wbGVtZW50ZWQgZm9yIHRoaXMgQnJvYWRQaGFzZSBjbGFzcyEnKTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSBib2R5IHBhaXIgbmVlZHMgdG8gYmUgaW50ZXJzZWN0aW9uIHRlc3RlZCBhdCBhbGwuCiAgICAgKi8KCgogICAgbmVlZEJyb2FkcGhhc2VDb2xsaXNpb24oYm9keUEsIGJvZHlCKSB7CiAgICAgIC8vIENoZWNrIGNvbGxpc2lvbiBmaWx0ZXIgbWFza3MKICAgICAgaWYgKChib2R5QS5jb2xsaXNpb25GaWx0ZXJHcm91cCAmIGJvZHlCLmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwIHx8IChib2R5Qi5jb2xsaXNpb25GaWx0ZXJHcm91cCAmIGJvZHlBLmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9IC8vIENoZWNrIHR5cGVzCgoKICAgICAgaWYgKCgoYm9keUEudHlwZSAmIEJvZHkuU1RBVElDKSAhPT0gMCB8fCBib2R5QS5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSAmJiAoKGJvZHlCLnR5cGUgJiBCb2R5LlNUQVRJQykgIT09IDAgfHwgYm9keUIuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORykpIHsKICAgICAgICAvLyBCb3RoIGJvZGllcyBhcmUgc3RhdGljIG9yIHNsZWVwaW5nLiBTa2lwLgogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBib3VuZGluZyB2b2x1bWVzIG9mIHR3byBib2RpZXMgaW50ZXJzZWN0LgogICAgICovCgoKICAgIGludGVyc2VjdGlvblRlc3QoYm9keUEsIGJvZHlCLCBwYWlyczEsIHBhaXJzMikgewogICAgICBpZiAodGhpcy51c2VCb3VuZGluZ0JveGVzKSB7CiAgICAgICAgdGhpcy5kb0JvdW5kaW5nQm94QnJvYWRwaGFzZShib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmRvQm91bmRpbmdTcGhlcmVCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBib3VuZGluZyBzcGhlcmVzIG9mIHR3byBib2RpZXMgYXJlIGludGVyc2VjdGluZy4KICAgICAqIEBwYXJhbSBwYWlyczEgYm9keUEgaXMgYXBwZW5kZWQgdG8gdGhpcyBhcnJheSBpZiBpbnRlcnNlY3Rpb24KICAgICAqIEBwYXJhbSBwYWlyczIgYm9keUIgaXMgYXBwZW5kZWQgdG8gdGhpcyBhcnJheSBpZiBpbnRlcnNlY3Rpb24KICAgICAqLwoKCiAgICBkb0JvdW5kaW5nU3BoZXJlQnJvYWRwaGFzZShib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IHIgPSBCcm9hZHBoYXNlX2NvbGxpc2lvblBhaXJzX3I7CiAgICAgIGJvZHlCLnBvc2l0aW9uLnZzdWIoYm9keUEucG9zaXRpb24sIHIpOwogICAgICBjb25zdCBib3VuZGluZ1JhZGl1c1N1bTIgPSAoYm9keUEuYm91bmRpbmdSYWRpdXMgKyBib2R5Qi5ib3VuZGluZ1JhZGl1cykgKiogMjsKICAgICAgY29uc3Qgbm9ybTIgPSByLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgIGlmIChub3JtMiA8IGJvdW5kaW5nUmFkaXVzU3VtMikgewogICAgICAgIHBhaXJzMS5wdXNoKGJvZHlBKTsKICAgICAgICBwYWlyczIucHVzaChib2R5Qik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIGJveGVzIG9mIHR3byBib2RpZXMgYXJlIGludGVyc2VjdGluZy4KICAgICAqLwoKCiAgICBkb0JvdW5kaW5nQm94QnJvYWRwaGFzZShib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGlmIChib2R5QS5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICBib2R5QS51cGRhdGVBQUJCKCk7CiAgICAgIH0KCiAgICAgIGlmIChib2R5Qi5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICBib2R5Qi51cGRhdGVBQUJCKCk7CiAgICAgIH0gLy8gQ2hlY2sgQUFCQiAvIEFBQkIKCgogICAgICBpZiAoYm9keUEuYWFiYi5vdmVybGFwcyhib2R5Qi5hYWJiKSkgewogICAgICAgIHBhaXJzMS5wdXNoKGJvZHlBKTsKICAgICAgICBwYWlyczIucHVzaChib2R5Qik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBkdXBsaWNhdGUgcGFpcnMgZnJvbSB0aGUgcGFpciBhcnJheXMuCiAgICAgKi8KCgogICAgbWFrZVBhaXJzVW5pcXVlKHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IHQgPSBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV90ZW1wOwogICAgICBjb25zdCBwMSA9IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AxOwogICAgICBjb25zdCBwMiA9IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AyOwogICAgICBjb25zdCBOID0gcGFpcnMxLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBwMVtpXSA9IHBhaXJzMVtpXTsKICAgICAgICBwMltpXSA9IHBhaXJzMltpXTsKICAgICAgfQoKICAgICAgcGFpcnMxLmxlbmd0aCA9IDA7CiAgICAgIHBhaXJzMi5sZW5ndGggPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGlkMSA9IHAxW2ldLmlkOwogICAgICAgIGNvbnN0IGlkMiA9IHAyW2ldLmlkOwogICAgICAgIGNvbnN0IGtleSA9IGlkMSA8IGlkMiA/IGlkMSArICIsIiArIGlkMiA6IGlkMiArICIsIiArIGlkMTsKICAgICAgICB0W2tleV0gPSBpOwogICAgICAgIHQua2V5cy5wdXNoKGtleSk7CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0LmtleXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBrZXkgPSB0LmtleXMucG9wKCk7CiAgICAgICAgY29uc3QgcGFpckluZGV4ID0gdFtrZXldOwogICAgICAgIHBhaXJzMS5wdXNoKHAxW3BhaXJJbmRleF0pOwogICAgICAgIHBhaXJzMi5wdXNoKHAyW3BhaXJJbmRleF0pOwogICAgICAgIGRlbGV0ZSB0W2tleV07CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVG8gYmUgaW1wbGVtZW50ZWQgYnkgc3ViY2Fzc2VzCiAgICAgKi8KCgogICAgc2V0V29ybGQod29ybGQpIHt9CiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBib3VuZGluZyBzcGhlcmVzIG9mIHR3byBib2RpZXMgb3ZlcmxhcC4KICAgICAqLwoKCiAgICBzdGF0aWMgYm91bmRpbmdTcGhlcmVDaGVjayhib2R5QSwgYm9keUIpIHsKICAgICAgY29uc3QgZGlzdCA9IG5ldyBWZWMzKCk7IC8vIGJzY19kaXN0OwoKICAgICAgYm9keUEucG9zaXRpb24udnN1Yihib2R5Qi5wb3NpdGlvbiwgZGlzdCk7CiAgICAgIGNvbnN0IHNhID0gYm9keUEuc2hhcGVzWzBdOwogICAgICBjb25zdCBzYiA9IGJvZHlCLnNoYXBlc1swXTsKICAgICAgcmV0dXJuIE1hdGgucG93KHNhLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2IuYm91bmRpbmdTcGhlcmVSYWRpdXMsIDIpID4gZGlzdC5sZW5ndGhTcXVhcmVkKCk7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYWxsIHRoZSBib2RpZXMgd2l0aGluIHRoZSBBQUJCLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGNvbnNvbGUud2FybignLmFhYmJRdWVyeSBpcyBub3QgaW1wbGVtZW50ZWQgaW4gdGhpcyBCcm9hZHBoYXNlIHN1YmNsYXNzLicpOwogICAgICByZXR1cm4gW107CiAgICB9CgogIH0gLy8gVGVtcCBvYmplY3RzCgoKICBjb25zdCBCcm9hZHBoYXNlX2NvbGxpc2lvblBhaXJzX3IgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3RlbXAgPSB7CiAgICBrZXlzOiBbXQogIH07CiAgY29uc3QgQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDEgPSBbXTsKICBjb25zdCBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV9wMiA9IFtdOwoKICBuZXcgVmVjMygpOwogIC8qKgogICAqIE5haXZlIGJyb2FkcGhhc2UgaW1wbGVtZW50YXRpb24sIHVzZWQgaW4gbGFjayBvZiBiZXR0ZXIgb25lcy4KICAgKgogICAqIFRoZSBuYWl2ZSBicm9hZHBoYXNlIGxvb2tzIGF0IGFsbCBwb3NzaWJsZSBwYWlycyB3aXRob3V0IHJlc3RyaWN0aW9uLCB0aGVyZWZvcmUgaXQgaGFzIGNvbXBsZXhpdHkgTl4yIF8od2hpY2ggaXMgYmFkKV8KICAgKi8KCiAgY2xhc3MgTmFpdmVCcm9hZHBoYXNlIGV4dGVuZHMgQnJvYWRwaGFzZSB7CiAgICAvKioKICAgICAqIEB0b2RvIFJlbW92ZSB1c2VsZXNzIGNvbnN0cnVjdG9yCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICBzdXBlcigpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYWxsIHRoZSBjb2xsaXNpb24gcGFpcnMgaW4gdGhlIHBoeXNpY3Mgd29ybGQKICAgICAqLwoKCiAgICBjb2xsaXNpb25QYWlycyh3b3JsZCwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgYm9kaWVzID0gd29ybGQuYm9kaWVzOwogICAgICBjb25zdCBuID0gYm9kaWVzLmxlbmd0aDsKICAgICAgbGV0IGJpOwogICAgICBsZXQgYmo7IC8vIE5haXZlIE5eMiBmdHchCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gbjsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IGk7IGorKykgewogICAgICAgICAgYmkgPSBib2RpZXNbaV07CiAgICAgICAgICBiaiA9IGJvZGllc1tqXTsKCiAgICAgICAgICBpZiAoIXRoaXMubmVlZEJyb2FkcGhhc2VDb2xsaXNpb24oYmksIGJqKSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmludGVyc2VjdGlvblRlc3QoYmksIGJqLCBwYWlyczEsIHBhaXJzMik7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYWxsIHRoZSBib2RpZXMgd2l0aGluIGFuIEFBQkIuCiAgICAgKiBAcGFyYW0gcmVzdWx0IEFuIGFycmF5IHRvIHN0b3JlIHJlc3VsdGluZyBib2RpZXMgaW4uCiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KHdvcmxkLCBhYWJiLCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gW107CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd29ybGQuYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IHdvcmxkLmJvZGllc1tpXTsKCiAgICAgICAgaWYgKGIuYWFiYk5lZWRzVXBkYXRlKSB7CiAgICAgICAgICBiLnVwZGF0ZUFBQkIoKTsKICAgICAgICB9IC8vIFVnbHkgaGFjayB1bnRpbCBCb2R5IGdldHMgYWFiYgoKCiAgICAgICAgaWYgKGIuYWFiYi5vdmVybGFwcyhhYWJiKSkgewogICAgICAgICAgcmVzdWx0LnB1c2goYik7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CiAgLyoqCiAgICogU3RvcmFnZSBmb3IgUmF5IGNhc3RpbmcgZGF0YQogICAqLwoKCiAgY2xhc3MgUmF5Y2FzdFJlc3VsdCB7CiAgICAvKioKICAgICAqIHJheUZyb21Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiByYXlUb1dvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdE5vcm1hbFdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdFBvaW50V29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogaGFzSGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIHNoYXBlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJvZHkKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGluZGV4IG9mIHRoZSBoaXQgdHJpYW5nbGUsIGlmIHRoZSBoaXQgc2hhcGUgd2FzIGEgdHJpbWVzaAogICAgICovCgogICAgLyoqCiAgICAgKiBEaXN0YW5jZSB0byB0aGUgaGl0LiBXaWxsIGJlIHNldCB0byAtMSBpZiB0aGVyZSB3YXMgbm8gaGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHRoZSByYXkgc2hvdWxkIHN0b3AgdHJhdmVyc2luZyB0aGUgYm9kaWVzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZCA9IHZvaWQgMDsKICAgICAgdGhpcy5yYXlUb1dvcmxkID0gdm9pZCAwOwogICAgICB0aGlzLmhpdE5vcm1hbFdvcmxkID0gdm9pZCAwOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQgPSB2b2lkIDA7CiAgICAgIHRoaXMuaGFzSGl0ID0gdm9pZCAwOwogICAgICB0aGlzLnNoYXBlID0gdm9pZCAwOwogICAgICB0aGlzLmJvZHkgPSB2b2lkIDA7CiAgICAgIHRoaXMuaGl0RmFjZUluZGV4ID0gdm9pZCAwOwogICAgICB0aGlzLmRpc3RhbmNlID0gdm9pZCAwOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSB2b2lkIDA7CiAgICAgIHRoaXMucmF5RnJvbVdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5yYXlUb1dvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5oaXROb3JtYWxXb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaGl0UG9pbnRXb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CiAgICAgIHRoaXMuc2hhcGUgPSBudWxsOwogICAgICB0aGlzLmJvZHkgPSBudWxsOwogICAgICB0aGlzLmhpdEZhY2VJbmRleCA9IC0xOwogICAgICB0aGlzLmRpc3RhbmNlID0gLTE7CiAgICAgIHRoaXMuc2hvdWxkU3RvcCA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBSZXNldCBhbGwgcmVzdWx0IGRhdGEuCiAgICAgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIHRoaXMucmF5RnJvbVdvcmxkLnNldFplcm8oKTsKICAgICAgdGhpcy5yYXlUb1dvcmxkLnNldFplcm8oKTsKICAgICAgdGhpcy5oaXROb3JtYWxXb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMuaGl0UG9pbnRXb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CiAgICAgIHRoaXMuc2hhcGUgPSBudWxsOwogICAgICB0aGlzLmJvZHkgPSBudWxsOwogICAgICB0aGlzLmhpdEZhY2VJbmRleCA9IC0xOwogICAgICB0aGlzLmRpc3RhbmNlID0gLTE7CiAgICAgIHRoaXMuc2hvdWxkU3RvcCA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBhYm9ydAogICAgICovCgoKICAgIGFib3J0KCkgewogICAgICB0aGlzLnNob3VsZFN0b3AgPSB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgcmVzdWx0IGRhdGEuCiAgICAgKi8KCgogICAgc2V0KHJheUZyb21Xb3JsZCwgcmF5VG9Xb3JsZCwgaGl0Tm9ybWFsV29ybGQsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBkaXN0YW5jZSkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZC5jb3B5KHJheUZyb21Xb3JsZCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZC5jb3B5KHJheVRvV29ybGQpOwogICAgICB0aGlzLmhpdE5vcm1hbFdvcmxkLmNvcHkoaGl0Tm9ybWFsV29ybGQpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQuY29weShoaXRQb2ludFdvcmxkKTsKICAgICAgdGhpcy5zaGFwZSA9IHNoYXBlOwogICAgICB0aGlzLmJvZHkgPSBib2R5OwogICAgICB0aGlzLmRpc3RhbmNlID0gZGlzdGFuY2U7CiAgICB9CgogIH0KCiAgbGV0IF9TaGFwZSR0eXBlcyRTUEhFUkUsIF9TaGFwZSR0eXBlcyRQTEFORSwgX1NoYXBlJHR5cGVzJEJPWCwgX1NoYXBlJHR5cGVzJENZTElOREVSLCBfU2hhcGUkdHlwZXMkQ09OVkVYUE8sIF9TaGFwZSR0eXBlcyRIRUlHSFRGSSwgX1NoYXBlJHR5cGVzJFRSSU1FU0g7CiAgLyoqCiAgICogUkFZX01PREVTCiAgICovCgoKICBjb25zdCBSQVlfTU9ERVMgPSB7CiAgICAvKiogQ0xPU0VTVCAqLwogICAgQ0xPU0VTVDogMSwKCiAgICAvKiogQU5ZICovCiAgICBBTlk6IDIsCgogICAgLyoqIEFMTCAqLwogICAgQUxMOiA0CiAgfTsKICAvKioKICAgKiBSYXlNb2RlCiAgICovCgogIF9TaGFwZSR0eXBlcyRTUEhFUkUgPSBTaGFwZS50eXBlcy5TUEhFUkU7CiAgX1NoYXBlJHR5cGVzJFBMQU5FID0gU2hhcGUudHlwZXMuUExBTkU7CiAgX1NoYXBlJHR5cGVzJEJPWCA9IFNoYXBlLnR5cGVzLkJPWDsKICBfU2hhcGUkdHlwZXMkQ1lMSU5ERVIgPSBTaGFwZS50eXBlcy5DWUxJTkRFUjsKICBfU2hhcGUkdHlwZXMkQ09OVkVYUE8gPSBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OOwogIF9TaGFwZSR0eXBlcyRIRUlHSFRGSSA9IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxEOwogIF9TaGFwZSR0eXBlcyRUUklNRVNIID0gU2hhcGUudHlwZXMuVFJJTUVTSDsKICAvKioKICAgKiBBIGxpbmUgaW4gM0Qgc3BhY2UgdGhhdCBpbnRlcnNlY3RzIGJvZGllcyBhbmQgcmV0dXJuIHBvaW50cy4KICAgKi8KCiAgY2xhc3MgUmF5IHsKICAgIC8qKgogICAgICogZnJvbQogICAgICovCgogICAgLyoqCiAgICAgKiB0bwogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb24KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHByZWNpc2lvbiBvZiB0aGUgcmF5LiBVc2VkIHdoZW4gY2hlY2tpbmcgcGFyYWxsZWxpdHkgZXRjLgogICAgICogQGRlZmF1bHQgMC4wMDAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byBgZmFsc2VgIGlmIHlvdSBkb24ndCB3YW50IHRoZSBSYXkgdG8gdGFrZSBgY29sbGlzaW9uUmVzcG9uc2VgIGZsYWdzIGludG8gYWNjb3VudCBvbiBib2RpZXMgYW5kIHNoYXBlcy4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIHJheSBza2lwcyBhbnkgaGl0cyB3aXRoIG5vcm1hbC5kb3QocmF5RGlyZWN0aW9uKSA8IDAuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJNYXNrCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJHcm91cAogICAgICogQGRlZmF1bHQgLTEKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGludGVyc2VjdGlvbiBtb2RlLiBTaG91bGQgYmUgUmF5LkFOWSwgUmF5LkFMTCBvciBSYXkuQ0xPU0VTVC4KICAgICAqIEBkZWZhdWx0IFJBWS5BTlkKICAgICAqLwoKICAgIC8qKgogICAgICogQ3VycmVudCByZXN1bHQgb2JqZWN0LgogICAgICovCgogICAgLyoqCiAgICAgKiBXaWxsIGJlIHNldCB0byBgdHJ1ZWAgZHVyaW5nIGludGVyc2VjdFdvcmxkKCkgaWYgdGhlIHJheSBoaXQgYW55dGhpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZXItcHJvdmlkZWQgcmVzdWx0IGNhbGxiYWNrLiBXaWxsIGJlIHVzZWQgaWYgbW9kZSBpcyBSYXkuQUxMLgogICAgICovCgogICAgLyoqCiAgICAgKiBDTE9TRVNUCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFOWQogICAgICovCgogICAgLyoqCiAgICAgKiBBTEwKICAgICAqLwogICAgZ2V0IFtfU2hhcGUkdHlwZXMkU1BIRVJFXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdFNwaGVyZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRQTEFORV0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RQbGFuZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRCT1hdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0Qm94OwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJENZTElOREVSXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleDsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRDT05WRVhQT10oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkSEVJR0hURkldKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0SGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkVFJJTUVTSF0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RUcmltZXNoOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKGZyb20sIHRvKSB7CiAgICAgIGlmIChmcm9tID09PSB2b2lkIDApIHsKICAgICAgICBmcm9tID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHRvID09PSB2b2lkIDApIHsKICAgICAgICB0byA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuZnJvbSA9IHZvaWQgMDsKICAgICAgdGhpcy50byA9IHZvaWQgMDsKICAgICAgdGhpcy5kaXJlY3Rpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMucHJlY2lzaW9uID0gdm9pZCAwOwogICAgICB0aGlzLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuc2tpcEJhY2tmYWNlcyA9IHZvaWQgMDsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gdm9pZCAwOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gdm9pZCAwOwogICAgICB0aGlzLm1vZGUgPSB2b2lkIDA7CiAgICAgIHRoaXMucmVzdWx0ID0gdm9pZCAwOwogICAgICB0aGlzLmhhc0hpdCA9IHZvaWQgMDsKICAgICAgdGhpcy5jYWxsYmFjayA9IHZvaWQgMDsKICAgICAgdGhpcy5mcm9tID0gZnJvbS5jbG9uZSgpOwogICAgICB0aGlzLnRvID0gdG8uY2xvbmUoKTsKICAgICAgdGhpcy5kaXJlY3Rpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnByZWNpc2lvbiA9IDAuMDAwMTsKICAgICAgdGhpcy5jaGVja0NvbGxpc2lvblJlc3BvbnNlID0gdHJ1ZTsKICAgICAgdGhpcy5za2lwQmFja2ZhY2VzID0gZmFsc2U7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzayA9IC0xOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gLTE7CiAgICAgIHRoaXMubW9kZSA9IFJheS5BTlk7CiAgICAgIHRoaXMucmVzdWx0ID0gbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy5oYXNIaXQgPSBmYWxzZTsKCiAgICAgIHRoaXMuY2FsbGJhY2sgPSByZXN1bHQgPT4ge307CiAgICB9CiAgICAvKioKICAgICAqIERvIGl0ZXJzZWN0aW9uIGFnYWluc3QgYWxsIGJvZGllcyBpbiB0aGUgZ2l2ZW4gV29ybGQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIHJheSBoaXQgYW55dGhpbmcsIG90aGVyd2lzZSBmYWxzZS4KICAgICAqLwoKCiAgICBpbnRlcnNlY3RXb3JsZCh3b3JsZCwgb3B0aW9ucykgewogICAgICB0aGlzLm1vZGUgPSBvcHRpb25zLm1vZGUgfHwgUmF5LkFOWTsKICAgICAgdGhpcy5yZXN1bHQgPSBvcHRpb25zLnJlc3VsdCB8fCBuZXcgUmF5Y2FzdFJlc3VsdCgpOwogICAgICB0aGlzLnNraXBCYWNrZmFjZXMgPSAhIW9wdGlvbnMuc2tpcEJhY2tmYWNlczsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyTWFzayAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyR3JvdXAgOiAtMTsKICAgICAgdGhpcy5jaGVja0NvbGxpc2lvblJlc3BvbnNlID0gdHlwZW9mIG9wdGlvbnMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgOiB0cnVlOwoKICAgICAgaWYgKG9wdGlvbnMuZnJvbSkgewogICAgICAgIHRoaXMuZnJvbS5jb3B5KG9wdGlvbnMuZnJvbSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnRvKSB7CiAgICAgICAgdGhpcy50by5jb3B5KG9wdGlvbnMudG8pOwogICAgICB9CgogICAgICB0aGlzLmNhbGxiYWNrID0gb3B0aW9ucy5jYWxsYmFjayB8fCAoKCkgPT4ge30pOwoKICAgICAgdGhpcy5oYXNIaXQgPSBmYWxzZTsKICAgICAgdGhpcy5yZXN1bHQucmVzZXQoKTsKICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgdGhpcy5nZXRBQUJCKHRtcEFBQkIkMSk7CiAgICAgIHRtcEFycmF5Lmxlbmd0aCA9IDA7CiAgICAgIHdvcmxkLmJyb2FkcGhhc2UuYWFiYlF1ZXJ5KHdvcmxkLCB0bXBBQUJCJDEsIHRtcEFycmF5KTsKICAgICAgdGhpcy5pbnRlcnNlY3RCb2RpZXModG1wQXJyYXkpOwogICAgICByZXR1cm4gdGhpcy5oYXNIaXQ7CiAgICB9CiAgICAvKioKICAgICAqIFNob290IGEgcmF5IGF0IGEgYm9keSwgZ2V0IGJhY2sgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGhpdC4KICAgICAqIEBkZXByZWNhdGVkIEBwYXJhbSByZXN1bHQgc2V0IHRoZSByZXN1bHQgcHJvcGVydHkgb2YgdGhlIFJheSBpbnN0ZWFkLgogICAgICovCgoKICAgIGludGVyc2VjdEJvZHkoYm9keSwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICB0aGlzLnJlc3VsdCA9IHJlc3VsdDsKICAgICAgICB0aGlzLnVwZGF0ZURpcmVjdGlvbigpOwogICAgICB9CgogICAgICBjb25zdCBjaGVja0NvbGxpc2lvblJlc3BvbnNlID0gdGhpcy5jaGVja0NvbGxpc2lvblJlc3BvbnNlOwoKICAgICAgaWYgKGNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgJiYgIWJvZHkuY29sbGlzaW9uUmVzcG9uc2UpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICgodGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCAmIGJvZHkuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDAgfHwgKGJvZHkuY29sbGlzaW9uRmlsdGVyR3JvdXAgJiB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCB4aSA9IGludGVyc2VjdEJvZHlfeGk7CiAgICAgIGNvbnN0IHFpID0gaW50ZXJzZWN0Qm9keV9xaTsKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOID0gYm9keS5zaGFwZXMubGVuZ3RoOyBpIDwgTjsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGUgPSBib2R5LnNoYXBlc1tpXTsKCiAgICAgICAgaWYgKGNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgJiYgIXNoYXBlLmNvbGxpc2lvblJlc3BvbnNlKSB7CiAgICAgICAgICBjb250aW51ZTsgLy8gU2tpcAogICAgICAgIH0KCiAgICAgICAgYm9keS5xdWF0ZXJuaW9uLm11bHQoYm9keS5zaGFwZU9yaWVudGF0aW9uc1tpXSwgcWkpOwogICAgICAgIGJvZHkucXVhdGVybmlvbi52bXVsdChib2R5LnNoYXBlT2Zmc2V0c1tpXSwgeGkpOwogICAgICAgIHhpLnZhZGQoYm9keS5wb3NpdGlvbiwgeGkpOwogICAgICAgIHRoaXMuaW50ZXJzZWN0U2hhcGUoc2hhcGUsIHFpLCB4aSwgYm9keSk7CgogICAgICAgIGlmICh0aGlzLnJlc3VsdC5zaG91bGRTdG9wKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2hvb3QgYSByYXkgYXQgYW4gYXJyYXkgYm9kaWVzLCBnZXQgYmFjayBpbmZvcm1hdGlvbiBhYm91dCB0aGUgaGl0LgogICAgICogQHBhcmFtIGJvZGllcyBBbiBhcnJheSBvZiBCb2R5IG9iamVjdHMuCiAgICAgKiBAZGVwcmVjYXRlZCBAcGFyYW0gcmVzdWx0IHNldCB0aGUgcmVzdWx0IHByb3BlcnR5IG9mIHRoZSBSYXkgaW5zdGVhZC4KICAgICAqCiAgICAgKi8KCgogICAgaW50ZXJzZWN0Qm9kaWVzKGJvZGllcywgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICB0aGlzLnJlc3VsdCA9IHJlc3VsdDsKICAgICAgICB0aGlzLnVwZGF0ZURpcmVjdGlvbigpOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGJvZGllcy5sZW5ndGg7ICF0aGlzLnJlc3VsdC5zaG91bGRTdG9wICYmIGkgPCBsOyBpKyspIHsKICAgICAgICB0aGlzLmludGVyc2VjdEJvZHkoYm9kaWVzW2ldKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSBkaXJlY3Rpb24gdmVjdG9yLgogICAgICovCgoKICAgIHVwZGF0ZURpcmVjdGlvbigpIHsKICAgICAgdGhpcy50by52c3ViKHRoaXMuZnJvbSwgdGhpcy5kaXJlY3Rpb24pOwogICAgICB0aGlzLmRpcmVjdGlvbi5ub3JtYWxpemUoKTsKICAgIH0KCiAgICBpbnRlcnNlY3RTaGFwZShzaGFwZSwgcXVhdCwgcG9zaXRpb24sIGJvZHkpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsgLy8gQ2hlY2tpbmcgYm91bmRpbmdTcGhlcmUKCiAgICAgIGNvbnN0IGRpc3RhbmNlID0gZGlzdGFuY2VGcm9tSW50ZXJzZWN0aW9uKGZyb20sIHRoaXMuZGlyZWN0aW9uLCBwb3NpdGlvbik7CgogICAgICBpZiAoZGlzdGFuY2UgPiBzaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1cykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgaW50ZXJzZWN0TWV0aG9kID0gdGhpc1tzaGFwZS50eXBlXTsKCiAgICAgIGlmIChpbnRlcnNlY3RNZXRob2QpIHsKICAgICAgICBpbnRlcnNlY3RNZXRob2QuY2FsbCh0aGlzLCBzaGFwZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHNoYXBlKTsKICAgICAgfQogICAgfQoKICAgIF9pbnRlcnNlY3RCb3goYm94LCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0Q29udmV4KGJveC5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlKTsKICAgIH0KCiAgICBfaW50ZXJzZWN0UGxhbmUoc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlKSB7CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZGlyZWN0aW9uID0gdGhpcy5kaXJlY3Rpb247IC8vIEdldCBwbGFuZSBub3JtYWwKCiAgICAgIGNvbnN0IHdvcmxkTm9ybWFsID0gbmV3IFZlYzMoMCwgMCwgMSk7CiAgICAgIHF1YXQudm11bHQod29ybGROb3JtYWwsIHdvcmxkTm9ybWFsKTsKICAgICAgY29uc3QgbGVuID0gbmV3IFZlYzMoKTsKICAgICAgZnJvbS52c3ViKHBvc2l0aW9uLCBsZW4pOwogICAgICBjb25zdCBwbGFuZVRvRnJvbSA9IGxlbi5kb3Qod29ybGROb3JtYWwpOwogICAgICB0by52c3ViKHBvc2l0aW9uLCBsZW4pOwogICAgICBjb25zdCBwbGFuZVRvVG8gPSBsZW4uZG90KHdvcmxkTm9ybWFsKTsKCiAgICAgIGlmIChwbGFuZVRvRnJvbSAqIHBsYW5lVG9UbyA+IDApIHsKICAgICAgICAvLyAiZnJvbSIgYW5kICJ0byIgYXJlIG9uIHRoZSBzYW1lIHNpZGUgb2YgdGhlIHBsYW5lLi4uIGJhaWwgb3V0CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoZnJvbS5kaXN0YW5jZVRvKHRvKSA8IHBsYW5lVG9Gcm9tKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBuX2RvdF9kaXIgPSB3b3JsZE5vcm1hbC5kb3QoZGlyZWN0aW9uKTsKCiAgICAgIGlmIChNYXRoLmFicyhuX2RvdF9kaXIpIDwgdGhpcy5wcmVjaXNpb24pIHsKICAgICAgICAvLyBObyBpbnRlcnNlY3Rpb24KICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHBsYW5lUG9pbnRUb0Zyb20gPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBkaXJfc2NhbGVkX3dpdGhfdCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGhpdFBvaW50V29ybGQgPSBuZXcgVmVjMygpOwogICAgICBmcm9tLnZzdWIocG9zaXRpb24sIHBsYW5lUG9pbnRUb0Zyb20pOwogICAgICBjb25zdCB0ID0gLXdvcmxkTm9ybWFsLmRvdChwbGFuZVBvaW50VG9Gcm9tKSAvIG5fZG90X2RpcjsKICAgICAgZGlyZWN0aW9uLnNjYWxlKHQsIGRpcl9zY2FsZWRfd2l0aF90KTsKICAgICAgZnJvbS52YWRkKGRpcl9zY2FsZWRfd2l0aF90LCBoaXRQb2ludFdvcmxkKTsKICAgICAgdGhpcy5yZXBvcnRJbnRlcnNlY3Rpb24od29ybGROb3JtYWwsIGhpdFBvaW50V29ybGQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIC0xKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB3b3JsZCBBQUJCIG9mIHRoZSByYXkuCiAgICAgKi8KCgogICAgZ2V0QUFCQihhYWJiKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBsb3dlckJvdW5kLAogICAgICAgIHVwcGVyQm91bmQKICAgICAgfSA9IGFhYmI7CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgbG93ZXJCb3VuZC54ID0gTWF0aC5taW4odG8ueCwgZnJvbS54KTsKICAgICAgbG93ZXJCb3VuZC55ID0gTWF0aC5taW4odG8ueSwgZnJvbS55KTsKICAgICAgbG93ZXJCb3VuZC56ID0gTWF0aC5taW4odG8ueiwgZnJvbS56KTsKICAgICAgdXBwZXJCb3VuZC54ID0gTWF0aC5tYXgodG8ueCwgZnJvbS54KTsKICAgICAgdXBwZXJCb3VuZC55ID0gTWF0aC5tYXgodG8ueSwgZnJvbS55KTsKICAgICAgdXBwZXJCb3VuZC56ID0gTWF0aC5tYXgodG8ueiwgZnJvbS56KTsKICAgIH0KCiAgICBfaW50ZXJzZWN0SGVpZ2h0ZmllbGQoc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlKSB7CiAgICAgIHNoYXBlLmRhdGE7CiAgICAgIHNoYXBlLmVsZW1lbnRTaXplOyAvLyBDb252ZXJ0IHRoZSByYXkgdG8gbG9jYWwgaGVpZ2h0ZmllbGQgY29vcmRpbmF0ZXMKCiAgICAgIGNvbnN0IGxvY2FsUmF5ID0gaW50ZXJzZWN0SGVpZ2h0ZmllbGRfbG9jYWxSYXk7IC8vbmV3IFJheSh0aGlzLmZyb20sIHRoaXMudG8pOwoKICAgICAgbG9jYWxSYXkuZnJvbS5jb3B5KHRoaXMuZnJvbSk7CiAgICAgIGxvY2FsUmF5LnRvLmNvcHkodGhpcy50byk7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgbG9jYWxSYXkuZnJvbSwgbG9jYWxSYXkuZnJvbSk7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgbG9jYWxSYXkudG8sIGxvY2FsUmF5LnRvKTsKICAgICAgbG9jYWxSYXkudXBkYXRlRGlyZWN0aW9uKCk7IC8vIEdldCB0aGUgaW5kZXggb2YgdGhlIGRhdGEgcG9pbnRzIHRvIHRlc3QgYWdhaW5zdAoKICAgICAgY29uc3QgaW5kZXggPSBpbnRlcnNlY3RIZWlnaHRmaWVsZF9pbmRleDsKICAgICAgbGV0IGlNaW5YOwogICAgICBsZXQgaU1pblk7CiAgICAgIGxldCBpTWF4WDsKICAgICAgbGV0IGlNYXhZOyAvLyBTZXQgdG8gbWF4CgogICAgICBpTWluWCA9IGlNaW5ZID0gMDsKICAgICAgaU1heFggPSBpTWF4WSA9IHNoYXBlLmRhdGEubGVuZ3RoIC0gMTsKICAgICAgY29uc3QgYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIGxvY2FsUmF5LmdldEFBQkIoYWFiYik7CiAgICAgIHNoYXBlLmdldEluZGV4T2ZQb3NpdGlvbihhYWJiLmxvd2VyQm91bmQueCwgYWFiYi5sb3dlckJvdW5kLnksIGluZGV4LCB0cnVlKTsKICAgICAgaU1pblggPSBNYXRoLm1heChpTWluWCwgaW5kZXhbMF0pOwogICAgICBpTWluWSA9IE1hdGgubWF4KGlNaW5ZLCBpbmRleFsxXSk7CiAgICAgIHNoYXBlLmdldEluZGV4T2ZQb3NpdGlvbihhYWJiLnVwcGVyQm91bmQueCwgYWFiYi51cHBlckJvdW5kLnksIGluZGV4LCB0cnVlKTsKICAgICAgaU1heFggPSBNYXRoLm1pbihpTWF4WCwgaW5kZXhbMF0gKyAxKTsKICAgICAgaU1heFkgPSBNYXRoLm1pbihpTWF4WSwgaW5kZXhbMV0gKyAxKTsKCiAgICAgIGZvciAobGV0IGkgPSBpTWluWDsgaSA8IGlNYXhYOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gaU1pblk7IGogPCBpTWF4WTsgaisrKSB7CiAgICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgc2hhcGUuZ2V0QWFiYkF0SW5kZXgoaSwgaiwgYWFiYik7CgogICAgICAgICAgaWYgKCFhYWJiLm92ZXJsYXBzUmF5KGxvY2FsUmF5KSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0gLy8gTG93ZXIgdHJpYW5nbGUKCgogICAgICAgICAgc2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgZmFsc2UpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHBvc2l0aW9uLCBxdWF0LCBzaGFwZS5waWxsYXJPZmZzZXQsIHdvcmxkUGlsbGFyT2Zmc2V0KTsKCiAgICAgICAgICB0aGlzLl9pbnRlcnNlY3RDb252ZXgoc2hhcGUucGlsbGFyQ29udmV4LCBxdWF0LCB3b3JsZFBpbGxhck9mZnNldCwgYm9keSwgcmVwb3J0ZWRTaGFwZSwgaW50ZXJzZWN0Q29udmV4T3B0aW9ucyk7CgogICAgICAgICAgaWYgKHRoaXMucmVzdWx0LnNob3VsZFN0b3ApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfSAvLyBVcHBlciB0cmlhbmdsZQoKCiAgICAgICAgICBzaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCB0cnVlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdCwgc2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgdGhpcy5faW50ZXJzZWN0Q29udmV4KHNoYXBlLnBpbGxhckNvbnZleCwgcXVhdCwgd29ybGRQaWxsYXJPZmZzZXQsIGJvZHksIHJlcG9ydGVkU2hhcGUsIGludGVyc2VjdENvbnZleE9wdGlvbnMpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIF9pbnRlcnNlY3RTcGhlcmUoc3BoZXJlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IHIgPSBzcGhlcmUucmFkaXVzOwogICAgICBjb25zdCBhID0gKHRvLnggLSBmcm9tLngpICoqIDIgKyAodG8ueSAtIGZyb20ueSkgKiogMiArICh0by56IC0gZnJvbS56KSAqKiAyOwogICAgICBjb25zdCBiID0gMiAqICgodG8ueCAtIGZyb20ueCkgKiAoZnJvbS54IC0gcG9zaXRpb24ueCkgKyAodG8ueSAtIGZyb20ueSkgKiAoZnJvbS55IC0gcG9zaXRpb24ueSkgKyAodG8ueiAtIGZyb20ueikgKiAoZnJvbS56IC0gcG9zaXRpb24ueikpOwogICAgICBjb25zdCBjID0gKGZyb20ueCAtIHBvc2l0aW9uLngpICoqIDIgKyAoZnJvbS55IC0gcG9zaXRpb24ueSkgKiogMiArIChmcm9tLnogLSBwb3NpdGlvbi56KSAqKiAyIC0gciAqKiAyOwogICAgICBjb25zdCBkZWx0YSA9IGIgKiogMiAtIDQgKiBhICogYzsKICAgICAgY29uc3QgaW50ZXJzZWN0aW9uUG9pbnQgPSBSYXlfaW50ZXJzZWN0U3BoZXJlX2ludGVyc2VjdGlvblBvaW50OwogICAgICBjb25zdCBub3JtYWwgPSBSYXlfaW50ZXJzZWN0U3BoZXJlX25vcm1hbDsKCiAgICAgIGlmIChkZWx0YSA8IDApIHsKICAgICAgICAvLyBObyBpbnRlcnNlY3Rpb24KICAgICAgICByZXR1cm47CiAgICAgIH0gZWxzZSBpZiAoZGVsdGEgPT09IDApIHsKICAgICAgICAvLyBzaW5nbGUgaW50ZXJzZWN0aW9uIHBvaW50CiAgICAgICAgZnJvbS5sZXJwKHRvLCBkZWx0YSwgaW50ZXJzZWN0aW9uUG9pbnQpOwogICAgICAgIGludGVyc2VjdGlvblBvaW50LnZzdWIocG9zaXRpb24sIG5vcm1hbCk7CiAgICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKG5vcm1hbCwgaW50ZXJzZWN0aW9uUG9pbnQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIC0xKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBkMSA9ICgtYiAtIE1hdGguc3FydChkZWx0YSkpIC8gKDIgKiBhKTsKICAgICAgICBjb25zdCBkMiA9ICgtYiArIE1hdGguc3FydChkZWx0YSkpIC8gKDIgKiBhKTsKCiAgICAgICAgaWYgKGQxID49IDAgJiYgZDEgPD0gMSkgewogICAgICAgICAgZnJvbS5sZXJwKHRvLCBkMSwgaW50ZXJzZWN0aW9uUG9pbnQpOwogICAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQudnN1Yihwb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKG5vcm1hbCwgaW50ZXJzZWN0aW9uUG9pbnQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIC0xKTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLnJlc3VsdC5zaG91bGRTdG9wKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoZDIgPj0gMCAmJiBkMiA8PSAxKSB7CiAgICAgICAgICBmcm9tLmxlcnAodG8sIGQyLCBpbnRlcnNlY3Rpb25Qb2ludCk7CiAgICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludC52c3ViKHBvc2l0aW9uLCBub3JtYWwpOwogICAgICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICAgICAgdGhpcy5yZXBvcnRJbnRlcnNlY3Rpb24obm9ybWFsLCBpbnRlcnNlY3Rpb25Qb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgLTEpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIF9pbnRlcnNlY3RDb252ZXgoc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlLCBvcHRpb25zKSB7CiAgICAgIGNvbnN0IG5vcm1hbCA9IGludGVyc2VjdENvbnZleF9ub3JtYWw7CiAgICAgIGNvbnN0IHZlY3RvciA9IGludGVyc2VjdENvbnZleF92ZWN0b3I7CiAgICAgIGNvbnN0IGZhY2VMaXN0ID0gb3B0aW9ucyAmJiBvcHRpb25zLmZhY2VMaXN0IHx8IG51bGw7IC8vIENoZWNraW5nIGZhY2VzCgogICAgICBjb25zdCBmYWNlcyA9IHNoYXBlLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHNoYXBlLnZlcnRpY2VzOwogICAgICBjb25zdCBub3JtYWxzID0gc2hhcGUuZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHRoaXMuZGlyZWN0aW9uOwogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGZyb21Ub0Rpc3RhbmNlID0gZnJvbS5kaXN0YW5jZVRvKHRvKTsKICAgICAgY29uc3QgTmZhY2VzID0gZmFjZUxpc3QgPyBmYWNlTGlzdC5sZW5ndGggOiBmYWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucmVzdWx0OwoKICAgICAgZm9yIChsZXQgaiA9IDA7ICFyZXN1bHQuc2hvdWxkU3RvcCAmJiBqIDwgTmZhY2VzOyBqKyspIHsKICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0ID8gZmFjZUxpc3Rbal0gOiBqOwogICAgICAgIGNvbnN0IGZhY2UgPSBmYWNlc1tmaV07CiAgICAgICAgY29uc3QgZmFjZU5vcm1hbCA9IG5vcm1hbHNbZmldOwogICAgICAgIGNvbnN0IHEgPSBxdWF0OwogICAgICAgIGNvbnN0IHggPSBwb3NpdGlvbjsgLy8gZGV0ZXJtaW5lIGlmIHJheSBpbnRlcnNlY3RzIHRoZSBwbGFuZSBvZiB0aGUgZmFjZQogICAgICAgIC8vIG5vdGU6IHRoaXMgd29ya3MgcmVnYXJkbGVzcyBvZiB0aGUgZGlyZWN0aW9uIG9mIHRoZSBmYWNlIG5vcm1hbAogICAgICAgIC8vIEdldCBwbGFuZSBwb2ludCBpbiB3b3JsZCBjb29yZGluYXRlcy4uLgoKICAgICAgICB2ZWN0b3IuY29weSh2ZXJ0aWNlc1tmYWNlWzBdXSk7CiAgICAgICAgcS52bXVsdCh2ZWN0b3IsIHZlY3Rvcik7CiAgICAgICAgdmVjdG9yLnZhZGQoeCwgdmVjdG9yKTsgLy8gLi4uYnV0IG1ha2UgaXQgcmVsYXRpdmUgdG8gdGhlIHJheSBmcm9tLiBXZSdsbCBmaXggdGhpcyBsYXRlci4KCiAgICAgICAgdmVjdG9yLnZzdWIoZnJvbSwgdmVjdG9yKTsgLy8gR2V0IHBsYW5lIG5vcm1hbAoKICAgICAgICBxLnZtdWx0KGZhY2VOb3JtYWwsIG5vcm1hbCk7IC8vIElmIHRoaXMgZG90IHByb2R1Y3QgaXMgbmVnYXRpdmUsIHdlIGhhdmUgc29tZXRoaW5nIGludGVyZXN0aW5nCgogICAgICAgIGNvbnN0IGRvdCA9IGRpcmVjdGlvbi5kb3Qobm9ybWFsKTsgLy8gQmFpbCBvdXQgaWYgcmF5IGFuZCBwbGFuZSBhcmUgcGFyYWxsZWwKCiAgICAgICAgaWYgKE1hdGguYWJzKGRvdCkgPCB0aGlzLnByZWNpc2lvbikgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSAvLyBjYWxjIGRpc3RhbmNlIHRvIHBsYW5lCgoKICAgICAgICBjb25zdCBzY2FsYXIgPSBub3JtYWwuZG90KHZlY3RvcikgLyBkb3Q7IC8vIGlmIG5lZ2F0aXZlIGRpc3RhbmNlLCB0aGVuIHBsYW5lIGlzIGJlaGluZCByYXkKCiAgICAgICAgaWYgKHNjYWxhciA8IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gaWYgKGRvdCA8IDApIHsKICAgICAgICAvLyBJbnRlcnNlY3Rpb24gcG9pbnQgaXMgZnJvbSArIGRpcmVjdGlvbiAqIHNjYWxhcgoKCiAgICAgICAgZGlyZWN0aW9uLnNjYWxlKHNjYWxhciwgaW50ZXJzZWN0UG9pbnQpOwogICAgICAgIGludGVyc2VjdFBvaW50LnZhZGQoZnJvbSwgaW50ZXJzZWN0UG9pbnQpOyAvLyBhIGlzIHRoZSBwb2ludCB3ZSBjb21wYXJlIHBvaW50cyBiIGFuZCBjIHdpdGguCgogICAgICAgIGEuY29weSh2ZXJ0aWNlc1tmYWNlWzBdXSk7CiAgICAgICAgcS52bXVsdChhLCBhKTsKICAgICAgICB4LnZhZGQoYSwgYSk7CgogICAgICAgIGZvciAobGV0IGkgPSAxOyAhcmVzdWx0LnNob3VsZFN0b3AgJiYgaSA8IGZhY2UubGVuZ3RoIC0gMTsgaSsrKSB7CiAgICAgICAgICAvLyBUcmFuc2Zvcm0gMyB2ZXJ0aWNlcyB0byB3b3JsZCBjb29yZHMKICAgICAgICAgIGIuY29weSh2ZXJ0aWNlc1tmYWNlW2ldXSk7CiAgICAgICAgICBjLmNvcHkodmVydGljZXNbZmFjZVtpICsgMV1dKTsKICAgICAgICAgIHEudm11bHQoYiwgYik7CiAgICAgICAgICBxLnZtdWx0KGMsIGMpOwogICAgICAgICAgeC52YWRkKGIsIGIpOwogICAgICAgICAgeC52YWRkKGMsIGMpOwogICAgICAgICAgY29uc3QgZGlzdGFuY2UgPSBpbnRlcnNlY3RQb2ludC5kaXN0YW5jZVRvKGZyb20pOwoKICAgICAgICAgIGlmICghKFJheS5wb2ludEluVHJpYW5nbGUoaW50ZXJzZWN0UG9pbnQsIGEsIGIsIGMpIHx8IFJheS5wb2ludEluVHJpYW5nbGUoaW50ZXJzZWN0UG9pbnQsIGIsIGEsIGMpKSB8fCBkaXN0YW5jZSA+IGZyb21Ub0Rpc3RhbmNlKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKG5vcm1hbCwgaW50ZXJzZWN0UG9pbnQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIGZpKTsKICAgICAgICB9IC8vIH0KCiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQHRvZG8gT3B0aW1pemUgYnkgdHJhbnNmb3JtaW5nIHRoZSB3b3JsZCB0byBsb2NhbCBzcGFjZSBmaXJzdC4KICAgICAqIEB0b2RvIFVzZSBPY3RyZWUgbG9va3VwCiAgICAgKi8KCgogICAgX2ludGVyc2VjdFRyaW1lc2gobWVzaCwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUsIG9wdGlvbnMpIHsKICAgICAgY29uc3Qgbm9ybWFsID0gaW50ZXJzZWN0VHJpbWVzaF9ub3JtYWw7CiAgICAgIGNvbnN0IHRyaWFuZ2xlcyA9IGludGVyc2VjdFRyaW1lc2hfdHJpYW5nbGVzOwogICAgICBjb25zdCB0cmVlVHJhbnNmb3JtID0gaW50ZXJzZWN0VHJpbWVzaF90cmVlVHJhbnNmb3JtOwogICAgICBjb25zdCB2ZWN0b3IgPSBpbnRlcnNlY3RDb252ZXhfdmVjdG9yOwogICAgICBjb25zdCBsb2NhbERpcmVjdGlvbiA9IGludGVyc2VjdFRyaW1lc2hfbG9jYWxEaXJlY3Rpb247CiAgICAgIGNvbnN0IGxvY2FsRnJvbSA9IGludGVyc2VjdFRyaW1lc2hfbG9jYWxGcm9tOwogICAgICBjb25zdCBsb2NhbFRvID0gaW50ZXJzZWN0VHJpbWVzaF9sb2NhbFRvOwogICAgICBjb25zdCB3b3JsZEludGVyc2VjdFBvaW50ID0gaW50ZXJzZWN0VHJpbWVzaF93b3JsZEludGVyc2VjdFBvaW50OwogICAgICBjb25zdCB3b3JsZE5vcm1hbCA9IGludGVyc2VjdFRyaW1lc2hfd29ybGROb3JtYWw7IC8vIENoZWNraW5nIGZhY2VzCgogICAgICBjb25zdCBpbmRpY2VzID0gbWVzaC5pbmRpY2VzOwogICAgICBtZXNoLnZlcnRpY2VzOyAvLyBjb25zdCBub3JtYWxzID0gbWVzaC5mYWNlTm9ybWFscwoKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBkaXJlY3Rpb24gPSB0aGlzLmRpcmVjdGlvbjsKICAgICAgdHJlZVRyYW5zZm9ybS5wb3NpdGlvbi5jb3B5KHBvc2l0aW9uKTsKICAgICAgdHJlZVRyYW5zZm9ybS5xdWF0ZXJuaW9uLmNvcHkocXVhdCk7IC8vIFRyYW5zZm9ybSByYXkgdG8gbG9jYWwgc3BhY2UhCgogICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCBkaXJlY3Rpb24sIGxvY2FsRGlyZWN0aW9uKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCBmcm9tLCBsb2NhbEZyb20pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIHRvLCBsb2NhbFRvKTsKICAgICAgbG9jYWxUby54ICo9IG1lc2guc2NhbGUueDsKICAgICAgbG9jYWxUby55ICo9IG1lc2guc2NhbGUueTsKICAgICAgbG9jYWxUby56ICo9IG1lc2guc2NhbGUuejsKICAgICAgbG9jYWxGcm9tLnggKj0gbWVzaC5zY2FsZS54OwogICAgICBsb2NhbEZyb20ueSAqPSBtZXNoLnNjYWxlLnk7CiAgICAgIGxvY2FsRnJvbS56ICo9IG1lc2guc2NhbGUuejsKICAgICAgbG9jYWxUby52c3ViKGxvY2FsRnJvbSwgbG9jYWxEaXJlY3Rpb24pOwogICAgICBsb2NhbERpcmVjdGlvbi5ub3JtYWxpemUoKTsKICAgICAgY29uc3QgZnJvbVRvRGlzdGFuY2VTcXVhcmVkID0gbG9jYWxGcm9tLmRpc3RhbmNlU3F1YXJlZChsb2NhbFRvKTsKICAgICAgbWVzaC50cmVlLnJheVF1ZXJ5KHRoaXMsIHRyZWVUcmFuc2Zvcm0sIHRyaWFuZ2xlcyk7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IHRyaWFuZ2xlcy5sZW5ndGg7ICF0aGlzLnJlc3VsdC5zaG91bGRTdG9wICYmIGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IHRyaWFuZ2xlc0luZGV4ID0gdHJpYW5nbGVzW2ldOwogICAgICAgIG1lc2guZ2V0Tm9ybWFsKHRyaWFuZ2xlc0luZGV4LCBub3JtYWwpOyAvLyBkZXRlcm1pbmUgaWYgcmF5IGludGVyc2VjdHMgdGhlIHBsYW5lIG9mIHRoZSBmYWNlCiAgICAgICAgLy8gbm90ZTogdGhpcyB3b3JrcyByZWdhcmRsZXNzIG9mIHRoZSBkaXJlY3Rpb24gb2YgdGhlIGZhY2Ugbm9ybWFsCiAgICAgICAgLy8gR2V0IHBsYW5lIHBvaW50IGluIHdvcmxkIGNvb3JkaW5hdGVzLi4uCgogICAgICAgIG1lc2guZ2V0VmVydGV4KGluZGljZXNbdHJpYW5nbGVzSW5kZXggKiAzXSwgYSk7IC8vIC4uLmJ1dCBtYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSByYXkgZnJvbS4gV2UnbGwgZml4IHRoaXMgbGF0ZXIuCgogICAgICAgIGEudnN1Yihsb2NhbEZyb20sIHZlY3Rvcik7IC8vIElmIHRoaXMgZG90IHByb2R1Y3QgaXMgbmVnYXRpdmUsIHdlIGhhdmUgc29tZXRoaW5nIGludGVyZXN0aW5nCgogICAgICAgIGNvbnN0IGRvdCA9IGxvY2FsRGlyZWN0aW9uLmRvdChub3JtYWwpOyAvLyBCYWlsIG91dCBpZiByYXkgYW5kIHBsYW5lIGFyZSBwYXJhbGxlbAogICAgICAgIC8vIGlmIChNYXRoLmFicyggZG90ICkgPCB0aGlzLnByZWNpc2lvbil7CiAgICAgICAgLy8gICAgIGNvbnRpbnVlOwogICAgICAgIC8vIH0KICAgICAgICAvLyBjYWxjIGRpc3RhbmNlIHRvIHBsYW5lCgogICAgICAgIGNvbnN0IHNjYWxhciA9IG5vcm1hbC5kb3QodmVjdG9yKSAvIGRvdDsgLy8gaWYgbmVnYXRpdmUgZGlzdGFuY2UsIHRoZW4gcGxhbmUgaXMgYmVoaW5kIHJheQoKICAgICAgICBpZiAoc2NhbGFyIDwgMCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSAvLyBJbnRlcnNlY3Rpb24gcG9pbnQgaXMgZnJvbSArIGRpcmVjdGlvbiAqIHNjYWxhcgoKCiAgICAgICAgbG9jYWxEaXJlY3Rpb24uc2NhbGUoc2NhbGFyLCBpbnRlcnNlY3RQb2ludCk7CiAgICAgICAgaW50ZXJzZWN0UG9pbnQudmFkZChsb2NhbEZyb20sIGludGVyc2VjdFBvaW50KTsgLy8gR2V0IHRyaWFuZ2xlIHZlcnRpY2VzCgogICAgICAgIG1lc2guZ2V0VmVydGV4KGluZGljZXNbdHJpYW5nbGVzSW5kZXggKiAzICsgMV0sIGIpOwogICAgICAgIG1lc2guZ2V0VmVydGV4KGluZGljZXNbdHJpYW5nbGVzSW5kZXggKiAzICsgMl0sIGMpOwogICAgICAgIGNvbnN0IHNxdWFyZWREaXN0YW5jZSA9IGludGVyc2VjdFBvaW50LmRpc3RhbmNlU3F1YXJlZChsb2NhbEZyb20pOwoKICAgICAgICBpZiAoIShSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBiLCBhLCBjKSB8fCBSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBhLCBiLCBjKSkgfHwgc3F1YXJlZERpc3RhbmNlID4gZnJvbVRvRGlzdGFuY2VTcXVhcmVkKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIHRyYW5zZm9ybSBpbnRlcnNlY3Rwb2ludCBhbmQgbm9ybWFsIHRvIHdvcmxkCgoKICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHF1YXQsIG5vcm1hbCwgd29ybGROb3JtYWwpOwogICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdCwgaW50ZXJzZWN0UG9pbnQsIHdvcmxkSW50ZXJzZWN0UG9pbnQpOwogICAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKHdvcmxkTm9ybWFsLCB3b3JsZEludGVyc2VjdFBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCB0cmlhbmdsZXNJbmRleCk7CiAgICAgIH0KCiAgICAgIHRyaWFuZ2xlcy5sZW5ndGggPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIGludGVyc2VjdGlvbnMgc2hvdWxkIGNvbnRpbnVlCiAgICAgKi8KCgogICAgcmVwb3J0SW50ZXJzZWN0aW9uKG5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGhpdEZhY2VJbmRleCkgewogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGRpc3RhbmNlID0gZnJvbS5kaXN0YW5jZVRvKGhpdFBvaW50V29ybGQpOwogICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdDsgLy8gU2tpcCBiYWNrIGZhY2VzPwoKICAgICAgaWYgKHRoaXMuc2tpcEJhY2tmYWNlcyAmJiBub3JtYWwuZG90KHRoaXMuZGlyZWN0aW9uKSA+IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHJlc3VsdC5oaXRGYWNlSW5kZXggPSB0eXBlb2YgaGl0RmFjZUluZGV4ICE9PSAndW5kZWZpbmVkJyA/IGhpdEZhY2VJbmRleCA6IC0xOwoKICAgICAgc3dpdGNoICh0aGlzLm1vZGUpIHsKICAgICAgICBjYXNlIFJheS5BTEw6CiAgICAgICAgICB0aGlzLmhhc0hpdCA9IHRydWU7CiAgICAgICAgICByZXN1bHQuc2V0KGZyb20sIHRvLCBub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBkaXN0YW5jZSk7CiAgICAgICAgICByZXN1bHQuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgIHRoaXMuY2FsbGJhY2socmVzdWx0KTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIFJheS5DTE9TRVNUOgogICAgICAgICAgLy8gU3RvcmUgaWYgY2xvc2VyIHRoYW4gY3VycmVudCBjbG9zZXN0CiAgICAgICAgICBpZiAoZGlzdGFuY2UgPCByZXN1bHQuZGlzdGFuY2UgfHwgIXJlc3VsdC5oYXNIaXQpIHsKICAgICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgICByZXN1bHQuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgICAgcmVzdWx0LnNldChmcm9tLCB0bywgbm9ybWFsLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpOwogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIFJheS5BTlk6CiAgICAgICAgICAvLyBSZXBvcnQgYW5kIHN0b3AuCiAgICAgICAgICB0aGlzLmhhc0hpdCA9IHRydWU7CiAgICAgICAgICByZXN1bHQuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgIHJlc3VsdC5zZXQoZnJvbSwgdG8sIG5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKTsKICAgICAgICAgIHJlc3VsdC5zaG91bGRTdG9wID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEFzIHBlciAiQmFyeWNlbnRyaWMgVGVjaG5pcXVlIiBhcyBuYW1lZAogICAgICoge0BsaW5rIGh0dHBzOi8vd3d3LmJsYWNrcGF3bi5jb20vdGV4dHMvcG9pbnRpbnBvbHkvZGVmYXVsdC5odG1sIGhlcmV9IGJ1dCB3aXRob3V0IHRoZSBkaXZpc2lvbgogICAgICovCgoKICAgIHN0YXRpYyBwb2ludEluVHJpYW5nbGUocCwgYSwgYiwgYykgewogICAgICBjLnZzdWIoYSwgdjApOwogICAgICBiLnZzdWIoYSwgdjEpOwogICAgICBwLnZzdWIoYSwgdjIpOwogICAgICBjb25zdCBkb3QwMCA9IHYwLmRvdCh2MCk7CiAgICAgIGNvbnN0IGRvdDAxID0gdjAuZG90KHYxKTsKICAgICAgY29uc3QgZG90MDIgPSB2MC5kb3QodjIpOwogICAgICBjb25zdCBkb3QxMSA9IHYxLmRvdCh2MSk7CiAgICAgIGNvbnN0IGRvdDEyID0gdjEuZG90KHYyKTsKICAgICAgbGV0IHU7CiAgICAgIGxldCB2OwogICAgICByZXR1cm4gKHUgPSBkb3QxMSAqIGRvdDAyIC0gZG90MDEgKiBkb3QxMikgPj0gMCAmJiAodiA9IGRvdDAwICogZG90MTIgLSBkb3QwMSAqIGRvdDAyKSA+PSAwICYmIHUgKyB2IDwgZG90MDAgKiBkb3QxMSAtIGRvdDAxICogZG90MDE7CiAgICB9CgogIH0KCiAgUmF5LkNMT1NFU1QgPSBSQVlfTU9ERVMuQ0xPU0VTVDsKICBSYXkuQU5ZID0gUkFZX01PREVTLkFOWTsKICBSYXkuQUxMID0gUkFZX01PREVTLkFMTDsKICBjb25zdCB0bXBBQUJCJDEgPSBuZXcgQUFCQigpOwogIGNvbnN0IHRtcEFycmF5ID0gW107CiAgY29uc3QgdjEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3hpID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3FpID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCBpbnRlcnNlY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Q29udmV4T3B0aW9ucyA9IHsKICAgIGZhY2VMaXN0OiBbMF0KICB9OwogIGNvbnN0IHdvcmxkUGlsbGFyT2Zmc2V0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RIZWlnaHRmaWVsZF9sb2NhbFJheSA9IG5ldyBSYXkoKTsKICBjb25zdCBpbnRlcnNlY3RIZWlnaHRmaWVsZF9pbmRleCA9IFtdOwogIGNvbnN0IFJheV9pbnRlcnNlY3RTcGhlcmVfaW50ZXJzZWN0aW9uUG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IFJheV9pbnRlcnNlY3RTcGhlcmVfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RDb252ZXhfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RDb252ZXhfdmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9sb2NhbERpcmVjdGlvbiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9sb2NhbEZyb20gPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfbG9jYWxUbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF93b3JsZE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF93b3JsZEludGVyc2VjdFBvaW50ID0gbmV3IFZlYzMoKTsKICBuZXcgQUFCQigpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfdHJpYW5nbGVzID0gW107CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF90cmVlVHJhbnNmb3JtID0gbmV3IFRyYW5zZm9ybSgpOwogIGNvbnN0IHYwID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3QgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBkaXN0YW5jZUZyb21JbnRlcnNlY3Rpb24oZnJvbSwgZGlyZWN0aW9uLCBwb3NpdGlvbikgewogICAgLy8gdjAgaXMgdmVjdG9yIGZyb20gZnJvbSB0byBwb3NpdGlvbgogICAgcG9zaXRpb24udnN1Yihmcm9tLCB2MCk7CiAgICBjb25zdCBkb3QgPSB2MC5kb3QoZGlyZWN0aW9uKTsgLy8gaW50ZXJzZWN0ID0gZGlyZWN0aW9uKmRvdCArIGZyb20KCiAgICBkaXJlY3Rpb24uc2NhbGUoZG90LCBpbnRlcnNlY3QpOwogICAgaW50ZXJzZWN0LnZhZGQoZnJvbSwgaW50ZXJzZWN0KTsKICAgIGNvbnN0IGRpc3RhbmNlID0gcG9zaXRpb24uZGlzdGFuY2VUbyhpbnRlcnNlY3QpOwogICAgcmV0dXJuIGRpc3RhbmNlOwogIH0KICAvKioKICAgKiBTd2VlcCBhbmQgcHJ1bmUgYnJvYWRwaGFzZSBhbG9uZyBvbmUgYXhpcy4KICAgKi8KCgogIGNsYXNzIFNBUEJyb2FkcGhhc2UgZXh0ZW5kcyBCcm9hZHBoYXNlIHsKICAgIC8qKgogICAgICogTGlzdCBvZiBib2RpZXMgY3VycmVudGx5IGluIHRoZSBicm9hZHBoYXNlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgd29ybGQgdG8gc2VhcmNoIGluLgogICAgICovCgogICAgLyoqCiAgICAgKiBBeGlzIHRvIHNvcnQgdGhlIGJvZGllcyBhbG9uZy4KICAgICAqIFNldCB0byAwIGZvciB4IGF4aXMsIGFuZCAxIGZvciB5IGF4aXMuCiAgICAgKiBGb3IgYmVzdCBwZXJmb3JtYW5jZSwgcGljayB0aGUgYXhpcyB3aGVyZSBib2RpZXMgYXJlIG1vc3QgZGlzdHJpYnV0ZWQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBib3VuZHMgb2YgdHdvIGJvZGllcyBvdmVybGFwLCBhbG9uZyB0aGUgZ2l2ZW4gU0FQIGF4aXMuCiAgICAgKi8KICAgIHN0YXRpYyBjaGVja0JvdW5kcyhiaSwgYmosIGF4aXNJbmRleCkgewogICAgICBsZXQgYmlQb3M7CiAgICAgIGxldCBialBvczsKCiAgICAgIGlmIChheGlzSW5kZXggPT09IDApIHsKICAgICAgICBiaVBvcyA9IGJpLnBvc2l0aW9uLng7CiAgICAgICAgYmpQb3MgPSBiai5wb3NpdGlvbi54OwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMSkgewogICAgICAgIGJpUG9zID0gYmkucG9zaXRpb24ueTsKICAgICAgICBialBvcyA9IGJqLnBvc2l0aW9uLnk7CiAgICAgIH0gZWxzZSBpZiAoYXhpc0luZGV4ID09PSAyKSB7CiAgICAgICAgYmlQb3MgPSBiaS5wb3NpdGlvbi56OwogICAgICAgIGJqUG9zID0gYmoucG9zaXRpb24uejsKICAgICAgfQoKICAgICAgY29uc3QgcmkgPSBiaS5ib3VuZGluZ1JhZGl1cywKICAgICAgICAgICAgcmogPSBiai5ib3VuZGluZ1JhZGl1cywKICAgICAgICAgICAgYm91bmRBMiA9IGJpUG9zICsgcmksCiAgICAgICAgICAgIGJvdW5kQjEgPSBialBvcyAtIHJqOwogICAgICByZXR1cm4gYm91bmRCMSA8IGJvdW5kQTI7CiAgICB9IC8vIE5vdGU6IHRoZXNlIGFyZSBpZGVudGljYWwsIHNhdmUgZm9yIHgveS96IGxvd2VyYm91bmQKCiAgICAvKioKICAgICAqIGluc2VydGlvblNvcnRYCiAgICAgKi8KCgogICAgc3RhdGljIGluc2VydGlvblNvcnRYKGEpIHsKICAgICAgZm9yIChsZXQgaSA9IDEsIGwgPSBhLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IHYgPSBhW2ldOwogICAgICAgIGxldCBqOwoKICAgICAgICBmb3IgKGogPSBpIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgIGlmIChhW2pdLmFhYmIubG93ZXJCb3VuZC54IDw9IHYuYWFiYi5sb3dlckJvdW5kLngpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgYVtqICsgMV0gPSBhW2pdOwogICAgICAgIH0KCiAgICAgICAgYVtqICsgMV0gPSB2OwogICAgICB9CgogICAgICByZXR1cm4gYTsKICAgIH0KICAgIC8qKgogICAgICogaW5zZXJ0aW9uU29ydFkKICAgICAqLwoKCiAgICBzdGF0aWMgaW5zZXJ0aW9uU29ydFkoYSkgewogICAgICBmb3IgKGxldCBpID0gMSwgbCA9IGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IGFbaV07CiAgICAgICAgbGV0IGo7CgogICAgICAgIGZvciAoaiA9IGkgLSAxOyBqID49IDA7IGotLSkgewogICAgICAgICAgaWYgKGFbal0uYWFiYi5sb3dlckJvdW5kLnkgPD0gdi5hYWJiLmxvd2VyQm91bmQueSkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBhW2ogKyAxXSA9IGFbal07CiAgICAgICAgfQoKICAgICAgICBhW2ogKyAxXSA9IHY7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfQogICAgLyoqCiAgICAgKiBpbnNlcnRpb25Tb3J0WgogICAgICovCgoKICAgIHN0YXRpYyBpbnNlcnRpb25Tb3J0WihhKSB7CiAgICAgIGZvciAobGV0IGkgPSAxLCBsID0gYS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gYVtpXTsKICAgICAgICBsZXQgajsKCiAgICAgICAgZm9yIChqID0gaSAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICBpZiAoYVtqXS5hYWJiLmxvd2VyQm91bmQueiA8PSB2LmFhYmIubG93ZXJCb3VuZC56KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGFbaiArIDFdID0gYVtqXTsKICAgICAgICB9CgogICAgICAgIGFbaiArIDFdID0gdjsKICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9CgogICAgY29uc3RydWN0b3Iod29ybGQpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5heGlzTGlzdCA9IHZvaWQgMDsKICAgICAgdGhpcy53b3JsZCA9IHZvaWQgMDsKICAgICAgdGhpcy5heGlzSW5kZXggPSB2b2lkIDA7CiAgICAgIHRoaXMuX2FkZEJvZHlIYW5kbGVyID0gdm9pZCAwOwogICAgICB0aGlzLl9yZW1vdmVCb2R5SGFuZGxlciA9IHZvaWQgMDsKICAgICAgdGhpcy5heGlzTGlzdCA9IFtdOwogICAgICB0aGlzLndvcmxkID0gbnVsbDsKICAgICAgdGhpcy5heGlzSW5kZXggPSAwOwogICAgICBjb25zdCBheGlzTGlzdCA9IHRoaXMuYXhpc0xpc3Q7CgogICAgICB0aGlzLl9hZGRCb2R5SGFuZGxlciA9IGV2ZW50ID0+IHsKICAgICAgICBheGlzTGlzdC5wdXNoKGV2ZW50LmJvZHkpOwogICAgICB9OwoKICAgICAgdGhpcy5fcmVtb3ZlQm9keUhhbmRsZXIgPSBldmVudCA9PiB7CiAgICAgICAgY29uc3QgaWR4ID0gYXhpc0xpc3QuaW5kZXhPZihldmVudC5ib2R5KTsKCiAgICAgICAgaWYgKGlkeCAhPT0gLTEpIHsKICAgICAgICAgIGF4aXNMaXN0LnNwbGljZShpZHgsIDEpOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGlmICh3b3JsZCkgewogICAgICAgIHRoaXMuc2V0V29ybGQod29ybGQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENoYW5nZSB0aGUgd29ybGQKICAgICAqLwoKCiAgICBzZXRXb3JsZCh3b3JsZCkgewogICAgICAvLyBDbGVhciB0aGUgb2xkIGF4aXMgYXJyYXkKICAgICAgdGhpcy5heGlzTGlzdC5sZW5ndGggPSAwOyAvLyBBZGQgYWxsIGJvZGllcyBmcm9tIHRoZSBuZXcgd29ybGQKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd29ybGQuYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5heGlzTGlzdC5wdXNoKHdvcmxkLmJvZGllc1tpXSk7CiAgICAgIH0gLy8gUmVtb3ZlIG9sZCBoYW5kbGVycywgaWYgYW55CgoKICAgICAgd29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcignYWRkQm9keScsIHRoaXMuX2FkZEJvZHlIYW5kbGVyKTsKICAgICAgd29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVtb3ZlQm9keScsIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyKTsgLy8gQWRkIGhhbmRsZXJzIHRvIHVwZGF0ZSB0aGUgbGlzdCBvZiBib2RpZXMuCgogICAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdhZGRCb2R5JywgdGhpcy5fYWRkQm9keUhhbmRsZXIpOwogICAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdyZW1vdmVCb2R5JywgdGhpcy5fcmVtb3ZlQm9keUhhbmRsZXIpOwogICAgICB0aGlzLndvcmxkID0gd29ybGQ7CiAgICAgIHRoaXMuZGlydHkgPSB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBDb2xsZWN0IGFsbCBjb2xsaXNpb24gcGFpcnMKICAgICAqLwoKCiAgICBjb2xsaXNpb25QYWlycyh3b3JsZCwgcDEsIHAyKSB7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYXhpc0xpc3Q7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBheGlzSW5kZXggPSB0aGlzLmF4aXNJbmRleDsKICAgICAgbGV0IGk7CiAgICAgIGxldCBqOwoKICAgICAgaWYgKHRoaXMuZGlydHkpIHsKICAgICAgICB0aGlzLnNvcnRMaXN0KCk7CiAgICAgICAgdGhpcy5kaXJ0eSA9IGZhbHNlOwogICAgICB9IC8vIExvb2sgdGhyb3VnaCB0aGUgbGlzdAoKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBmb3IgKGogPSBpICsgMTsgaiA8IE47IGorKykgewogICAgICAgICAgY29uc3QgYmogPSBib2RpZXNbal07CgogICAgICAgICAgaWYgKCF0aGlzLm5lZWRCcm9hZHBoYXNlQ29sbGlzaW9uKGJpLCBiaikpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCFTQVBCcm9hZHBoYXNlLmNoZWNrQm91bmRzKGJpLCBiaiwgYXhpc0luZGV4KSkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLmludGVyc2VjdGlvblRlc3QoYmksIGJqLCBwMSwgcDIpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHNvcnRMaXN0KCkgewogICAgICBjb25zdCBheGlzTGlzdCA9IHRoaXMuYXhpc0xpc3Q7CiAgICAgIGNvbnN0IGF4aXNJbmRleCA9IHRoaXMuYXhpc0luZGV4OwogICAgICBjb25zdCBOID0gYXhpc0xpc3QubGVuZ3RoOyAvLyBVcGRhdGUgQUFCQnMKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGF4aXNMaXN0W2ldOwoKICAgICAgICBpZiAoYmkuYWFiYk5lZWRzVXBkYXRlKSB7CiAgICAgICAgICBiaS51cGRhdGVBQUJCKCk7CiAgICAgICAgfQogICAgICB9IC8vIFNvcnQgdGhlIGxpc3QKCgogICAgICBpZiAoYXhpc0luZGV4ID09PSAwKSB7CiAgICAgICAgU0FQQnJvYWRwaGFzZS5pbnNlcnRpb25Tb3J0WChheGlzTGlzdCk7CiAgICAgIH0gZWxzZSBpZiAoYXhpc0luZGV4ID09PSAxKSB7CiAgICAgICAgU0FQQnJvYWRwaGFzZS5pbnNlcnRpb25Tb3J0WShheGlzTGlzdCk7CiAgICAgIH0gZWxzZSBpZiAoYXhpc0luZGV4ID09PSAyKSB7CiAgICAgICAgU0FQQnJvYWRwaGFzZS5pbnNlcnRpb25Tb3J0WihheGlzTGlzdCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIHZhcmlhbmNlIG9mIHRoZSBib2R5IHBvc2l0aW9ucyBhbmQgZXN0aW1hdGVzIHRoZSBiZXN0IGF4aXMgdG8gdXNlLgogICAgICogV2lsbCBhdXRvbWF0aWNhbGx5IHNldCBwcm9wZXJ0eSBgYXhpc0luZGV4YC4KICAgICAqLwoKCiAgICBhdXRvRGV0ZWN0QXhpcygpIHsKICAgICAgbGV0IHN1bVggPSAwOwogICAgICBsZXQgc3VtWDIgPSAwOwogICAgICBsZXQgc3VtWSA9IDA7CiAgICAgIGxldCBzdW1ZMiA9IDA7CiAgICAgIGxldCBzdW1aID0gMDsKICAgICAgbGV0IHN1bVoyID0gMDsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5heGlzTGlzdDsKICAgICAgY29uc3QgTiA9IGJvZGllcy5sZW5ndGg7CiAgICAgIGNvbnN0IGludk4gPSAxIC8gTjsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgIGNvbnN0IGNlbnRlclggPSBiLnBvc2l0aW9uLng7CiAgICAgICAgc3VtWCArPSBjZW50ZXJYOwogICAgICAgIHN1bVgyICs9IGNlbnRlclggKiBjZW50ZXJYOwogICAgICAgIGNvbnN0IGNlbnRlclkgPSBiLnBvc2l0aW9uLnk7CiAgICAgICAgc3VtWSArPSBjZW50ZXJZOwogICAgICAgIHN1bVkyICs9IGNlbnRlclkgKiBjZW50ZXJZOwogICAgICAgIGNvbnN0IGNlbnRlclogPSBiLnBvc2l0aW9uLno7CiAgICAgICAgc3VtWiArPSBjZW50ZXJaOwogICAgICAgIHN1bVoyICs9IGNlbnRlclogKiBjZW50ZXJaOwogICAgICB9CgogICAgICBjb25zdCB2YXJpYW5jZVggPSBzdW1YMiAtIHN1bVggKiBzdW1YICogaW52TjsKICAgICAgY29uc3QgdmFyaWFuY2VZID0gc3VtWTIgLSBzdW1ZICogc3VtWSAqIGludk47CiAgICAgIGNvbnN0IHZhcmlhbmNlWiA9IHN1bVoyIC0gc3VtWiAqIHN1bVogKiBpbnZOOwoKICAgICAgaWYgKHZhcmlhbmNlWCA+IHZhcmlhbmNlWSkgewogICAgICAgIGlmICh2YXJpYW5jZVggPiB2YXJpYW5jZVopIHsKICAgICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5heGlzSW5kZXggPSAyOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh2YXJpYW5jZVkgPiB2YXJpYW5jZVopIHsKICAgICAgICB0aGlzLmF4aXNJbmRleCA9IDE7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5heGlzSW5kZXggPSAyOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYWxsIHRoZSBib2RpZXMgd2l0aGluIGFuIEFBQkIuCiAgICAgKiBAcGFyYW0gcmVzdWx0IEFuIGFycmF5IHRvIHN0b3JlIHJlc3VsdGluZyBib2RpZXMgaW4uCiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KHdvcmxkLCBhYWJiLCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gW107CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmRpcnR5KSB7CiAgICAgICAgdGhpcy5zb3J0TGlzdCgpOwogICAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTsKICAgICAgfQoKICAgICAgY29uc3QgYXhpc0luZGV4ID0gdGhpcy5heGlzSW5kZXg7CiAgICAgIGxldCBheGlzID0gJ3gnOwoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMSkgewogICAgICAgIGF4aXMgPSAneSc7CiAgICAgIH0KCiAgICAgIGlmIChheGlzSW5kZXggPT09IDIpIHsKICAgICAgICBheGlzID0gJ3onOwogICAgICB9CgogICAgICBjb25zdCBheGlzTGlzdCA9IHRoaXMuYXhpc0xpc3Q7CiAgICAgIGFhYmIubG93ZXJCb3VuZFtheGlzXTsKICAgICAgYWFiYi51cHBlckJvdW5kW2F4aXNdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBheGlzTGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGIgPSBheGlzTGlzdFtpXTsKCiAgICAgICAgaWYgKGIuYWFiYk5lZWRzVXBkYXRlKSB7CiAgICAgICAgICBiLnVwZGF0ZUFBQkIoKTsKICAgICAgICB9CgogICAgICAgIGlmIChiLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIHJlc3VsdC5wdXNoKGIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgfQoKICBjbGFzcyBVdGlscyB7CiAgICAvKioKICAgICAqIEV4dGVuZCBhbiBvcHRpb25zIG9iamVjdCB3aXRoIGRlZmF1bHQgdmFsdWVzLgogICAgICogQHBhcmFtIG9wdGlvbnMgVGhlIG9wdGlvbnMgb2JqZWN0LiBNYXkgYmUgZmFsc3k6IGluIHRoaXMgY2FzZSwgYSBuZXcgb2JqZWN0IGlzIGNyZWF0ZWQgYW5kIHJldHVybmVkLgogICAgICogQHBhcmFtIGRlZmF1bHRzIEFuIG9iamVjdCBjb250YWluaW5nIGRlZmF1bHQgdmFsdWVzLgogICAgICogQHJldHVybiBUaGUgbW9kaWZpZWQgb3B0aW9ucyBvYmplY3QuCiAgICAgKi8KICAgIHN0YXRpYyBkZWZhdWx0cyhvcHRpb25zLCBkZWZhdWx0cykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBmb3IgKGxldCBrZXkgaW4gZGVmYXVsdHMpIHsKICAgICAgICBpZiAoIShrZXkgaW4gb3B0aW9ucykpIHsKICAgICAgICAgIG9wdGlvbnNba2V5XSA9IGRlZmF1bHRzW2tleV07CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gb3B0aW9uczsKICAgIH0KCiAgfQogIC8qKgogICAqIENvbnN0cmFpbnQgYmFzZSBjbGFzcwogICAqLwoKCiAgY2xhc3MgQ29uc3RyYWludCB7CiAgICAvKioKICAgICAqIEVxdWF0aW9ucyB0byBiZSBzb2x2ZWQgaW4gdGhpcyBjb25zdHJhaW50LgogICAgICovCgogICAgLyoqCiAgICAgKiBCb2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIGZhbHNlIGlmIHlvdSBkb24ndCB3YW50IHRoZSBib2RpZXMgdG8gY29sbGlkZSB3aGVuIHRoZXkgYXJlIGNvbm5lY3RlZC4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMuZXF1YXRpb25zID0gdm9pZCAwOwogICAgICB0aGlzLmJvZHlBID0gdm9pZCAwOwogICAgICB0aGlzLmJvZHlCID0gdm9pZCAwOwogICAgICB0aGlzLmlkID0gdm9pZCAwOwogICAgICB0aGlzLmNvbGxpZGVDb25uZWN0ZWQgPSB2b2lkIDA7CiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgY29sbGlkZUNvbm5lY3RlZDogdHJ1ZSwKICAgICAgICB3YWtlVXBCb2RpZXM6IHRydWUKICAgICAgfSk7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICAgIHRoaXMuYm9keUEgPSBib2R5QTsKICAgICAgdGhpcy5ib2R5QiA9IGJvZHlCOwogICAgICB0aGlzLmlkID0gQ29uc3RyYWludC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gb3B0aW9ucy5jb2xsaWRlQ29ubmVjdGVkOwoKICAgICAgaWYgKG9wdGlvbnMud2FrZVVwQm9kaWVzKSB7CiAgICAgICAgaWYgKGJvZHlBKSB7CiAgICAgICAgICBib2R5QS53YWtlVXAoKTsKICAgICAgICB9CgogICAgICAgIGlmIChib2R5QikgewogICAgICAgICAgYm9keUIud2FrZVVwKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSBhbGwgdGhlIGVxdWF0aW9ucyB3aXRoIGRhdGEuCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ21ldGhvZCB1cGRhdGUoKSBub3QgaW1wbG1lbWVudGVkIGluIHRoaXMgQ29uc3RyYWludCBzdWJjbGFzcyEnKTsKICAgIH0KICAgIC8qKgogICAgICogRW5hYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGVuYWJsZSgpIHsKICAgICAgY29uc3QgZXFzID0gdGhpcy5lcXVhdGlvbnM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVxcy5sZW5ndGg7IGkrKykgewogICAgICAgIGVxc1tpXS5lbmFibGVkID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBEaXNhYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGRpc2FibGUoKSB7CiAgICAgIGNvbnN0IGVxcyA9IHRoaXMuZXF1YXRpb25zOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlcXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBlcXNbaV0uZW5hYmxlZCA9IGZhbHNlOwogICAgICB9CiAgICB9CgogIH0KCiAgQ29uc3RyYWludC5pZENvdW50ZXIgPSAwOwogIC8qKgogICAqIEFuIGVsZW1lbnQgY29udGFpbmluZyA2IGVudHJpZXMsIDMgc3BhdGlhbCBhbmQgMyByb3RhdGlvbmFsIGRlZ3JlZXMgb2YgZnJlZWRvbS4KICAgKi8KCiAgY2xhc3MgSmFjb2JpYW5FbGVtZW50IHsKICAgIC8qKgogICAgICogc3BhdGlhbAogICAgICovCgogICAgLyoqCiAgICAgKiByb3RhdGlvbmFsCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnNwYXRpYWwgPSB2b2lkIDA7CiAgICAgIHRoaXMucm90YXRpb25hbCA9IHZvaWQgMDsKICAgICAgdGhpcy5zcGF0aWFsID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5yb3RhdGlvbmFsID0gbmV3IFZlYzMoKTsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgd2l0aCBvdGhlciBKYWNvYmlhbkVsZW1lbnQKICAgICAqLwoKCiAgICBtdWx0aXBseUVsZW1lbnQoZWxlbWVudCkgewogICAgICByZXR1cm4gZWxlbWVudC5zcGF0aWFsLmRvdCh0aGlzLnNwYXRpYWwpICsgZWxlbWVudC5yb3RhdGlvbmFsLmRvdCh0aGlzLnJvdGF0aW9uYWwpOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB3aXRoIHR3byB2ZWN0b3JzCiAgICAgKi8KCgogICAgbXVsdGlwbHlWZWN0b3JzKHNwYXRpYWwsIHJvdGF0aW9uYWwpIHsKICAgICAgcmV0dXJuIHNwYXRpYWwuZG90KHRoaXMuc3BhdGlhbCkgKyByb3RhdGlvbmFsLmRvdCh0aGlzLnJvdGF0aW9uYWwpOwogICAgfQoKICB9CiAgLyoqCiAgICogRXF1YXRpb24gYmFzZSBjbGFzcy4KICAgKgogICAqIGBhYCwgYGJgIGFuZCBgZXBzYCBhcmUge0BsaW5rIGh0dHBzOi8vd3d3OC5jcy51bXUuc2Uva3Vyc2VyLzVEVjA1OC9WVDE1L2xlY3R1cmVzL1NQT09LbGFibm90ZXMucGRmIFNQT09LfSBwYXJhbWV0ZXJzIHRoYXQgZGVmYXVsdCB0byBgMC4wYC4gU2VlIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUvY2Fubm9uLmpzL2lzc3Vlcy8yMzgjaXNzdWVjb21tZW50LTE0NzE3MjMyNyB0aGlzIGV4Y2hhbmdlfSBmb3IgbW9yZSBkZXRhaWxzIG9uIENhbm5vbidzIHBoeXNpY3MgaW1wbGVtZW50YXRpb24uCiAgICovCgoKICBjbGFzcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqIE1pbmltdW0gKHJlYWQ6IG5lZ2F0aXZlIG1heCkgZm9yY2UgdG8gYmUgYXBwbGllZCBieSB0aGUgY29uc3RyYWludC4KICAgICAqLwoKICAgIC8qKgogICAgICogTWF4aW11bSAocmVhZDogcG9zaXRpdmUgbWF4KSBmb3JjZSB0byBiZSBhcHBsaWVkIGJ5IHRoZSBjb25zdHJhaW50LgogICAgICovCgogICAgLyoqCiAgICAgKiBTUE9PSyBwYXJhbWV0ZXIKICAgICAqLwoKICAgIC8qKgogICAgICogU1BPT0sgcGFyYW1ldGVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNQT09LIHBhcmFtZXRlcgogICAgICovCgogICAgLyoqCiAgICAgKiBBIG51bWJlciwgcHJvcG9ydGlvbmFsIHRvIHRoZSBmb3JjZSBhZGRlZCB0byB0aGUgYm9kaWVzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihiaSwgYmosIG1pbkZvcmNlLCBtYXhGb3JjZSkgewogICAgICBpZiAobWluRm9yY2UgPT09IHZvaWQgMCkgewogICAgICAgIG1pbkZvcmNlID0gLTFlNjsKICAgICAgfQoKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgdGhpcy5pZCA9IHZvaWQgMDsKICAgICAgdGhpcy5taW5Gb3JjZSA9IHZvaWQgMDsKICAgICAgdGhpcy5tYXhGb3JjZSA9IHZvaWQgMDsKICAgICAgdGhpcy5iaSA9IHZvaWQgMDsKICAgICAgdGhpcy5iaiA9IHZvaWQgMDsKICAgICAgdGhpcy5zaSA9IHZvaWQgMDsKICAgICAgdGhpcy5zaiA9IHZvaWQgMDsKICAgICAgdGhpcy5hID0gdm9pZCAwOwogICAgICB0aGlzLmIgPSB2b2lkIDA7CiAgICAgIHRoaXMuZXBzID0gdm9pZCAwOwogICAgICB0aGlzLmphY29iaWFuRWxlbWVudEEgPSB2b2lkIDA7CiAgICAgIHRoaXMuamFjb2JpYW5FbGVtZW50QiA9IHZvaWQgMDsKICAgICAgdGhpcy5lbmFibGVkID0gdm9pZCAwOwogICAgICB0aGlzLm11bHRpcGxpZXIgPSB2b2lkIDA7CiAgICAgIHRoaXMuaWQgPSBFcXVhdGlvbi5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5taW5Gb3JjZSA9IG1pbkZvcmNlOwogICAgICB0aGlzLm1heEZvcmNlID0gbWF4Rm9yY2U7CiAgICAgIHRoaXMuYmkgPSBiaTsKICAgICAgdGhpcy5iaiA9IGJqOwogICAgICB0aGlzLmEgPSAwLjA7IC8vIFNQT09LIHBhcmFtZXRlcgoKICAgICAgdGhpcy5iID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuZXBzID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuamFjb2JpYW5FbGVtZW50QSA9IG5ldyBKYWNvYmlhbkVsZW1lbnQoKTsKICAgICAgdGhpcy5qYWNvYmlhbkVsZW1lbnRCID0gbmV3IEphY29iaWFuRWxlbWVudCgpOwogICAgICB0aGlzLmVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLm11bHRpcGxpZXIgPSAwOwogICAgICB0aGlzLnNldFNwb29rUGFyYW1zKDFlNywgNCwgMSAvIDYwKTsgLy8gU2V0IHR5cGljYWwgc3Bvb2sgcGFyYW1zCiAgICB9CiAgICAvKioKICAgICAqIFJlY2FsY3VsYXRlcyBhLCBiLCBhbmQgZXBzLgogICAgICoKICAgICAqIFRoZSBFcXVhdGlvbiBjb25zdHJ1Y3RvciBzZXRzIHR5cGljYWwgU1BPT0sgcGFyYW1ldGVycyBhcyBzdWNoOgogICAgICogKiBgc3RpZmZuZXNzYCA9IDFlNwogICAgICogKiBgcmVsYXhhdGlvbmAgPSA0CiAgICAgKiAqIGB0aW1lU3RlcGA9IDEgLyA2MCwgX25vdGUgdGhlIGhhcmRjb2RlZCByZWZyZXNoIHJhdGUuXwogICAgICovCgoKICAgIHNldFNwb29rUGFyYW1zKHN0aWZmbmVzcywgcmVsYXhhdGlvbiwgdGltZVN0ZXApIHsKICAgICAgY29uc3QgZCA9IHJlbGF4YXRpb247CiAgICAgIGNvbnN0IGsgPSBzdGlmZm5lc3M7CiAgICAgIGNvbnN0IGggPSB0aW1lU3RlcDsKICAgICAgdGhpcy5hID0gNC4wIC8gKGggKiAoMSArIDQgKiBkKSk7CiAgICAgIHRoaXMuYiA9IDQuMCAqIGQgLyAoMSArIDQgKiBkKTsKICAgICAgdGhpcy5lcHMgPSA0LjAgLyAoaCAqIGggKiBrICogKDEgKyA0ICogZCkpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB0aGUgcmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBTUE9PSyBlcXVhdGlvbgogICAgICovCgoKICAgIGNvbXB1dGVCKGEsIGIsIGgpIHsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHcSA9IHRoaXMuY29tcHV0ZUdxKCk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIHJldHVybiAtR3EgKiBhIC0gR1cgKiBiIC0gR2lNZiAqIGg7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqcSwgd2hlcmUgcSBhcmUgdGhlIGdlbmVyYWxpemVkIGJvZHkgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBjb21wdXRlR3EoKSB7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHhpID0gYmkucG9zaXRpb247CiAgICAgIGNvbnN0IHhqID0gYmoucG9zaXRpb247CiAgICAgIHJldHVybiBHQS5zcGF0aWFsLmRvdCh4aSkgKyBHQi5zcGF0aWFsLmRvdCh4aik7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqVywgd2hlcmUgVyBhcmUgdGhlIGJvZHkgdmVsb2NpdGllcwogICAgICovCgoKICAgIGNvbXB1dGVHVygpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgdmkgPSBiaS52ZWxvY2l0eTsKICAgICAgY29uc3QgdmogPSBiai52ZWxvY2l0eTsKICAgICAgY29uc3Qgd2kgPSBiaS5hbmd1bGFyVmVsb2NpdHk7CiAgICAgIGNvbnN0IHdqID0gYmouYW5ndWxhclZlbG9jaXR5OwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKHZpLCB3aSkgKyBHQi5tdWx0aXBseVZlY3RvcnModmosIHdqKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgRypXbGFtYmRhLCB3aGVyZSBXIGFyZSB0aGUgYm9keSB2ZWxvY2l0aWVzCiAgICAgKi8KCgogICAgY29tcHV0ZUdXbGFtYmRhKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB2aSA9IGJpLnZsYW1iZGE7CiAgICAgIGNvbnN0IHZqID0gYmoudmxhbWJkYTsKICAgICAgY29uc3Qgd2kgPSBiaS53bGFtYmRhOwogICAgICBjb25zdCB3aiA9IGJqLndsYW1iZGE7CiAgICAgIHJldHVybiBHQS5tdWx0aXBseVZlY3RvcnModmksIHdpKSArIEdCLm11bHRpcGx5VmVjdG9ycyh2aiwgd2opOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpmLCB3aGVyZSBNIGlzIHRoZSBtYXNzIG1hdHJpeCB3aXRoIGRpYWdvbmFsIGJsb2NrcyBmb3IgZWFjaCBib2R5LCBhbmQgZiBhcmUgdGhlIGZvcmNlcyBvbiB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGNvbXB1dGVHaU1mKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCBmaSA9IGJpLmZvcmNlOwogICAgICBjb25zdCB0aSA9IGJpLnRvcnF1ZTsKICAgICAgY29uc3QgZmogPSBiai5mb3JjZTsKICAgICAgY29uc3QgdGogPSBiai50b3JxdWU7CiAgICAgIGNvbnN0IGludk1hc3NpID0gYmkuaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZNYXNzaiA9IGJqLmludk1hc3NTb2x2ZTsKICAgICAgZmkuc2NhbGUoaW52TWFzc2ksIGlNZmkpOwogICAgICBmai5zY2FsZShpbnZNYXNzaiwgaU1maik7CiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KHRpLCBpbnZJaV92bXVsdF90YXVpKTsKICAgICAgYmouaW52SW5lcnRpYVdvcmxkU29sdmUudm11bHQodGosIGludklqX3ZtdWx0X3RhdWopOwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKGlNZmksIGludklpX3ZtdWx0X3RhdWkpICsgR0IubXVsdGlwbHlWZWN0b3JzKGlNZmosIGludklqX3ZtdWx0X3RhdWopOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpHJwogICAgICovCgoKICAgIGNvbXB1dGVHaU1HdCgpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgaW52TWFzc2kgPSBiaS5pbnZNYXNzU29sdmU7CiAgICAgIGNvbnN0IGludk1hc3NqID0gYmouaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZJaSA9IGJpLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBjb25zdCBpbnZJaiA9IGJqLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBsZXQgcmVzdWx0ID0gaW52TWFzc2kgKyBpbnZNYXNzajsKICAgICAgaW52SWkudm11bHQoR0Eucm90YXRpb25hbCwgdG1wKTsKICAgICAgcmVzdWx0ICs9IHRtcC5kb3QoR0Eucm90YXRpb25hbCk7CiAgICAgIGludklqLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRtcCk7CiAgICAgIHJlc3VsdCArPSB0bXAuZG90KEdCLnJvdGF0aW9uYWwpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgY29uc3RyYWludCB2ZWxvY2l0eSB0byB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGFkZFRvV2xhbWJkYShkZWx0YWxhbWJkYSkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB0ZW1wID0gYWRkVG9XbGFtYmRhX3RlbXA7IC8vIEFkZCB0byBsaW5lYXIgdmVsb2NpdHkKICAgICAgLy8gdl9sYW1iZGEgKz0gaW52KE0pICogZGVsdGFfbGFtYmEgKiBHCgogICAgICBiaS52bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihiaS5pbnZNYXNzU29sdmUgKiBkZWx0YWxhbWJkYSwgR0Euc3BhdGlhbCwgYmkudmxhbWJkYSk7CiAgICAgIGJqLnZsYW1iZGEuYWRkU2NhbGVkVmVjdG9yKGJqLmludk1hc3NTb2x2ZSAqIGRlbHRhbGFtYmRhLCBHQi5zcGF0aWFsLCBiai52bGFtYmRhKTsgLy8gQWRkIHRvIGFuZ3VsYXIgdmVsb2NpdHkKCiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdBLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiaS53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmkud2xhbWJkYSk7CiAgICAgIGJqLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiai53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmoud2xhbWJkYSk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIGRlbm9taW5hdG9yIHBhcnQgb2YgdGhlIFNQT09LIGVxdWF0aW9uOiBDID0gRyppbnYoTSkqRycgKyBlcHMKICAgICAqLwoKCiAgICBjb21wdXRlQygpIHsKICAgICAgcmV0dXJuIHRoaXMuY29tcHV0ZUdpTUd0KCkgKyB0aGlzLmVwczsKICAgIH0KCiAgfQoKICBFcXVhdGlvbi5pZENvdW50ZXIgPSAwOwogIGNvbnN0IGlNZmkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGlNZmogPSBuZXcgVmVjMygpOwogIGNvbnN0IGludklpX3ZtdWx0X3RhdWkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludklqX3ZtdWx0X3RhdWogPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYWRkVG9XbGFtYmRhX3RlbXAgPSBuZXcgVmVjMygpOwogIC8qKgogICAqIENvbnRhY3Qvbm9uLXBlbmV0cmF0aW9uIGNvbnN0cmFpbnQgZXF1YXRpb24KICAgKi8KCiAgY2xhc3MgQ29udGFjdEVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiAiYm91bmNpbmVzcyI6IHUxID0gLWUqdTAKICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQtb3JpZW50ZWQgdmVjdG9yIHRoYXQgZ29lcyBmcm9tIHRoZSBjZW50ZXIgb2YgYmkgdG8gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkLW9yaWVudGVkIHZlY3RvciB0aGF0IHN0YXJ0cyBpbiBib2R5IGogcG9zaXRpb24gYW5kIGdvZXMgdG8gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIENvbnRhY3Qgbm9ybWFsLCBwb2ludGluZyBvdXQgb2YgYm9keSBpLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgMCwgbWF4Rm9yY2UpOwogICAgICB0aGlzLnJlc3RpdHV0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLnJpID0gdm9pZCAwOwogICAgICB0aGlzLnJqID0gdm9pZCAwOwogICAgICB0aGlzLm5pID0gdm9pZCAwOwogICAgICB0aGlzLnJlc3RpdHV0aW9uID0gMC4wOwogICAgICB0aGlzLnJpID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5yaiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMubmkgPSBuZXcgVmVjMygpOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHJpID0gdGhpcy5yaTsKICAgICAgY29uc3QgcmogPSB0aGlzLnJqOwogICAgICBjb25zdCByaXhuID0gQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAxOwogICAgICBjb25zdCByanhuID0gQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyOwogICAgICBjb25zdCB2aSA9IGJpLnZlbG9jaXR5OwogICAgICBjb25zdCB3aSA9IGJpLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgYmkuZm9yY2U7CiAgICAgIGJpLnRvcnF1ZTsKICAgICAgY29uc3QgdmogPSBiai52ZWxvY2l0eTsKICAgICAgY29uc3Qgd2ogPSBiai5hbmd1bGFyVmVsb2NpdHk7CiAgICAgIGJqLmZvcmNlOwogICAgICBiai50b3JxdWU7CiAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjID0gQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAzOwogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IG4gPSB0aGlzLm5pOyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIHJpLmNyb3NzKG4sIHJpeG4pOwogICAgICByai5jcm9zcyhuLCByanhuKTsgLy8gZyA9IHhqK3JqIC0oeGkrcmkpCiAgICAgIC8vIEcgPSBbIC1uaSAgLXJpeG4gIG5pICByanhuIF0KCiAgICAgIG4ubmVnYXRlKEdBLnNwYXRpYWwpOwogICAgICByaXhuLm5lZ2F0ZShHQS5yb3RhdGlvbmFsKTsKICAgICAgR0Iuc3BhdGlhbC5jb3B5KG4pOwogICAgICBHQi5yb3RhdGlvbmFsLmNvcHkocmp4bik7IC8vIENhbGN1bGF0ZSB0aGUgcGVuZXRyYXRpb24gdmVjdG9yCgogICAgICBwZW5ldHJhdGlvblZlYy5jb3B5KGJqLnBvc2l0aW9uKTsKICAgICAgcGVuZXRyYXRpb25WZWMudmFkZChyaiwgcGVuZXRyYXRpb25WZWMpOwogICAgICBwZW5ldHJhdGlvblZlYy52c3ViKGJpLnBvc2l0aW9uLCBwZW5ldHJhdGlvblZlYyk7CiAgICAgIHBlbmV0cmF0aW9uVmVjLnZzdWIocmksIHBlbmV0cmF0aW9uVmVjKTsKICAgICAgY29uc3QgZyA9IG4uZG90KHBlbmV0cmF0aW9uVmVjKTsgLy8gQ29tcHV0ZSBpdGVyYXRpb24KCiAgICAgIGNvbnN0IGVQbHVzT25lID0gdGhpcy5yZXN0aXR1dGlvbiArIDE7CiAgICAgIGNvbnN0IEdXID0gZVBsdXNPbmUgKiB2ai5kb3QobikgLSBlUGx1c09uZSAqIHZpLmRvdChuKSArIHdqLmRvdChyanhuKSAtIHdpLmRvdChyaXhuKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjdXJyZW50IHJlbGF0aXZlIHZlbG9jaXR5IGluIHRoZSBjb250YWN0IHBvaW50LgogICAgICovCgoKICAgIGdldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWwoKSB7CiAgICAgIGNvbnN0IHZpID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfdmk7CiAgICAgIGNvbnN0IHZqID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfdmo7CiAgICAgIGNvbnN0IHhpID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGk7CiAgICAgIGNvbnN0IHhqID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGo7CiAgICAgIGNvbnN0IHJlbFZlbCA9IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3JlbFZlbDsKICAgICAgdGhpcy5iaS5wb3NpdGlvbi52YWRkKHRoaXMucmksIHhpKTsKICAgICAgdGhpcy5iai5wb3NpdGlvbi52YWRkKHRoaXMucmosIHhqKTsKICAgICAgdGhpcy5iaS5nZXRWZWxvY2l0eUF0V29ybGRQb2ludCh4aSwgdmkpOwogICAgICB0aGlzLmJqLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHhqLCB2aik7CiAgICAgIHZpLnZzdWIodmosIHJlbFZlbCk7CiAgICAgIHJldHVybiB0aGlzLm5pLmRvdChyZWxWZWwpOwogICAgfQoKICB9CgogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9jb21wdXRlQl90ZW1wMSA9IG5ldyBWZWMzKCk7IC8vIFRlbXAgdmVjdG9ycwoKICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDIgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9jb21wdXRlQl90ZW1wMyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfdmkgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3ZqID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGogPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3JlbFZlbCA9IG5ldyBWZWMzKCk7CiAgLyoqCiAgICogQ29ubmVjdHMgdHdvIGJvZGllcyBhdCBnaXZlbiBvZmZzZXQgcG9pbnRzLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGJvZHlBID0gbmV3IEJvZHkoeyBtYXNzOiAxIH0pCiAgICogICAgIGNvbnN0IGJvZHlCID0gbmV3IEJvZHkoeyBtYXNzOiAxIH0pCiAgICogICAgIGJvZHlBLnBvc2l0aW9uLnNldCgtMSwgMCwgMCkKICAgKiAgICAgYm9keUIucG9zaXRpb24uc2V0KDEsIDAsIDApCiAgICogICAgIGJvZHlBLmFkZFNoYXBlKHNoYXBlQSkKICAgKiAgICAgYm9keUIuYWRkU2hhcGUoc2hhcGVCKQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJvZHlBKQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJvZHlCKQogICAqICAgICBjb25zdCBsb2NhbFBpdm90QSA9IG5ldyBWZWMzKDEsIDAsIDApCiAgICogICAgIGNvbnN0IGxvY2FsUGl2b3RCID0gbmV3IFZlYzMoLTEsIDAsIDApCiAgICogICAgIGNvbnN0IGNvbnN0cmFpbnQgPSBuZXcgUG9pbnRUb1BvaW50Q29uc3RyYWludChib2R5QSwgbG9jYWxQaXZvdEEsIGJvZHlCLCBsb2NhbFBpdm90QikKICAgKiAgICAgd29ybGQuYWRkQ29uc3RyYWludChjb25zdHJhaW50KQogICAqLwoKICBjbGFzcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IGV4dGVuZHMgQ29uc3RyYWludCB7CiAgICAvKioKICAgICAqIFBpdm90LCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFBpdm90LCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUIuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBwaXZvdEEgVGhlIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyBvZiBib2R5QSB3aGljaCBib2R5QSBpcyBjb25zdHJhaW5lZCB0by4KICAgICAqIEBwYXJhbSBib2R5QiBCb2R5IHRoYXQgd2lsbCBiZSBjb25zdHJhaW5lZCBpbiBhIHNpbWlsYXIgd2F5IHRvIHRoZSBzYW1lIHBvaW50IGFzIGJvZHlBLiBXZSB3aWxsIHRoZXJlZm9yZSBnZXQgYSBsaW5rIGJldHdlZW4gYm9keUEgYW5kIGJvZHlCLiBJZiBub3Qgc3BlY2lmaWVkLCBib2R5QSB3aWxsIGJlIGNvbnN0cmFpbmVkIHRvIGEgc3RhdGljIHBvaW50LgogICAgICogQHBhcmFtIHBpdm90QiBUaGUgcG9pbnQgcmVsYXRpdmUgdG8gdGhlIGNlbnRlciBvZiBtYXNzIG9mIGJvZHlCIHdoaWNoIGJvZHlCIGlzIGNvbnN0cmFpbmVkIHRvLgogICAgICogQHBhcmFtIG1heEZvcmNlIFRoZSBtYXhpbXVtIGZvcmNlIHRoYXQgc2hvdWxkIGJlIGFwcGxpZWQgdG8gY29uc3RyYWluIHRoZSBib2RpZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBwaXZvdEEsIGJvZHlCLCBwaXZvdEIsIG1heEZvcmNlKSB7CiAgICAgIGlmIChwaXZvdEEgPT09IHZvaWQgMCkgewogICAgICAgIHBpdm90QSA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGlmIChwaXZvdEIgPT09IHZvaWQgMCkgewogICAgICAgIHBpdm90QiA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5Qik7CiAgICAgIHRoaXMucGl2b3RBID0gdm9pZCAwOwogICAgICB0aGlzLnBpdm90QiA9IHZvaWQgMDsKICAgICAgdGhpcy5lcXVhdGlvblggPSB2b2lkIDA7CiAgICAgIHRoaXMuZXF1YXRpb25ZID0gdm9pZCAwOwogICAgICB0aGlzLmVxdWF0aW9uWiA9IHZvaWQgMDsKICAgICAgdGhpcy5waXZvdEEgPSBwaXZvdEEuY2xvbmUoKTsKICAgICAgdGhpcy5waXZvdEIgPSBwaXZvdEIuY2xvbmUoKTsKICAgICAgY29uc3QgeCA9IHRoaXMuZXF1YXRpb25YID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOwogICAgICBjb25zdCB5ID0gdGhpcy5lcXVhdGlvblkgPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIGNvbnN0IHogPSB0aGlzLmVxdWF0aW9uWiA9IG5ldyBDb250YWN0RXF1YXRpb24oYm9keUEsIGJvZHlCKTsgLy8gRXF1YXRpb25zIHRvIGJlIGZlZCB0byB0aGUgc29sdmVyCgogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKHgsIHksIHopOyAvLyBNYWtlIHRoZSBlcXVhdGlvbnMgYmlkaXJlY3Rpb25hbAoKICAgICAgeC5taW5Gb3JjZSA9IHkubWluRm9yY2UgPSB6Lm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgICB4Lm1heEZvcmNlID0geS5tYXhGb3JjZSA9IHoubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgICAgeC5uaS5zZXQoMSwgMCwgMCk7CiAgICAgIHkubmkuc2V0KDAsIDEsIDApOwogICAgICB6Lm5pLnNldCgwLCAwLCAxKTsKICAgIH0KCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCB4ID0gdGhpcy5lcXVhdGlvblg7CiAgICAgIGNvbnN0IHkgPSB0aGlzLmVxdWF0aW9uWTsKICAgICAgY29uc3QgeiA9IHRoaXMuZXF1YXRpb25aOyAvLyBSb3RhdGUgdGhlIHBpdm90cyB0byB3b3JsZCBzcGFjZQoKICAgICAgYm9keUEucXVhdGVybmlvbi52bXVsdCh0aGlzLnBpdm90QSwgeC5yaSk7CiAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQodGhpcy5waXZvdEIsIHgucmopOwogICAgICB5LnJpLmNvcHkoeC5yaSk7CiAgICAgIHkucmouY29weSh4LnJqKTsKICAgICAgei5yaS5jb3B5KHgucmkpOwogICAgICB6LnJqLmNvcHkoeC5yaik7CiAgICB9CgogIH0KICAvKioKICAgKiBDb25lIGVxdWF0aW9uLiBXb3JrcyB0byBrZWVwIHRoZSBnaXZlbiBib2R5IHdvcmxkIHZlY3RvcnMgYWxpZ25lZCwgb3IgdGlsdGVkIHdpdGhpbiBhIGdpdmVuIGFuZ2xlIGZyb20gZWFjaCBvdGhlci4KICAgKi8KCgogIGNsYXNzIENvbmVFcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8qKgogICAgICogTG9jYWwgYXhpcyBpbiBBCiAgICAgKi8KCiAgICAvKioKICAgICAqIExvY2FsIGF4aXMgaW4gQgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgImNvbmUgYW5nbGUiIHRvIGtlZXAKICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IG1heEZvcmNlID0gdHlwZW9mIG9wdGlvbnMubWF4Rm9yY2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhGb3JjZSA6IDFlNjsKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAtbWF4Rm9yY2UsIG1heEZvcmNlKTsKICAgICAgdGhpcy5heGlzQSA9IHZvaWQgMDsKICAgICAgdGhpcy5heGlzQiA9IHZvaWQgMDsKICAgICAgdGhpcy5hbmdsZSA9IHZvaWQgMDsKICAgICAgdGhpcy5heGlzQSA9IG9wdGlvbnMuYXhpc0EgPyBvcHRpb25zLmF4aXNBLmNsb25lKCkgOiBuZXcgVmVjMygxLCAwLCAwKTsKICAgICAgdGhpcy5heGlzQiA9IG9wdGlvbnMuYXhpc0IgPyBvcHRpb25zLmF4aXNCLmNsb25lKCkgOiBuZXcgVmVjMygwLCAxLCAwKTsKICAgICAgdGhpcy5hbmdsZSA9IHR5cGVvZiBvcHRpb25zLmFuZ2xlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuYW5nbGUgOiAwOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgY29uc3QgbmkgPSB0aGlzLmF4aXNBOwogICAgICBjb25zdCBuaiA9IHRoaXMuYXhpc0I7CiAgICAgIGNvbnN0IG5peG5qID0gdG1wVmVjMSQyOwogICAgICBjb25zdCBuanhuaSA9IHRtcFZlYzIkMjsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIG5pLmNyb3NzKG5qLCBuaXhuaik7CiAgICAgIG5qLmNyb3NzKG5pLCBuanhuaSk7IC8vIFRoZSBhbmdsZSBiZXR3ZWVuIHR3byB2ZWN0b3IgaXM6CiAgICAgIC8vIGNvcyh0aGV0YSkgPSBhICogYiAvIChsZW5ndGgoYSkgKiBsZW5ndGgoYikgPSB7IGxlbihhKSA9IGxlbihiKSA9IDEgfSA9IGEgKiBiCiAgICAgIC8vIGcgPSBhICogYgogICAgICAvLyBnZG90ID0gKGIgeCBhKSAqIHdpICsgKGEgeCBiKSAqIHdqCiAgICAgIC8vIEcgPSBbMCBieGEgMCBheGJdCiAgICAgIC8vIFcgPSBbdmkgd2kgdmogd2pdCgogICAgICBHQS5yb3RhdGlvbmFsLmNvcHkobmp4bmkpOwogICAgICBHQi5yb3RhdGlvbmFsLmNvcHkobml4bmopOwogICAgICBjb25zdCBnID0gTWF0aC5jb3ModGhpcy5hbmdsZSkgLSBuaS5kb3QobmopOwogICAgICBjb25zdCBHVyA9IHRoaXMuY29tcHV0ZUdXKCk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIGNvbnN0IEIgPSAtZyAqIGEgLSBHVyAqIGIgLSBoICogR2lNZjsKICAgICAgcmV0dXJuIEI7CiAgICB9CgogIH0KCiAgY29uc3QgdG1wVmVjMSQyID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWMyJDIgPSBuZXcgVmVjMygpOwogIC8qKgogICAqIFJvdGF0aW9uYWwgY29uc3RyYWludC4gV29ya3MgdG8ga2VlcCB0aGUgbG9jYWwgdmVjdG9ycyBvcnRob2dvbmFsIHRvIGVhY2ggb3RoZXIgaW4gd29ybGQgc3BhY2UuCiAgICovCgogIGNsYXNzIFJvdGF0aW9uYWxFcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIG1heEFuZ2xlCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSB2b2lkIDA7CiAgICAgIHRoaXMuYXhpc0IgPSB2b2lkIDA7CiAgICAgIHRoaXMubWF4QW5nbGUgPSB2b2lkIDA7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMubWF4QW5nbGUgPSBNYXRoLlBJIC8gMjsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMTsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDE7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBnID0gbmkgKiBuagogICAgICAvLyBnZG90ID0gKG5qIHggbmkpICogd2kgKyAobmkgeCBuaikgKiB3agogICAgICAvLyBHID0gWzAgbmp4bmkgMCBuaXhual0KICAgICAgLy8gVyA9IFt2aSB3aSB2aiB3al0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShuanhuaSk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShuaXhuaik7CiAgICAgIGNvbnN0IGcgPSBNYXRoLmNvcyh0aGlzLm1heEFuZ2xlKSAtIG5pLmRvdChuaik7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQoKICBjb25zdCB0bXBWZWMxJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzIkMSA9IG5ldyBWZWMzKCk7CiAgLyoqCiAgICogQSBDb25lIFR3aXN0IGNvbnN0cmFpbnQsIHVzZWZ1bCBmb3IgcmFnZG9sbHMuCiAgICovCgogIGNsYXNzIENvbmVUd2lzdENvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogVGhlIGF4aXMgZGlyZWN0aW9uIGZvciB0aGUgY29uc3RyYWludCBvZiB0aGUgYm9keSBBLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYXhpcyBkaXJlY3Rpb24gZm9yIHRoZSBjb25zdHJhaW50IG9mIHRoZSBib2R5IEIuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBhcGVydHVyZSBhbmdsZSBvZiB0aGUgY29uZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHR3aXN0IGFuZ2xlIG9mIHRoZSBqb2ludC4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IG1heEZvcmNlID0gdHlwZW9mIG9wdGlvbnMubWF4Rm9yY2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhGb3JjZSA6IDFlNjsgLy8gU2V0IHBpdm90IHBvaW50IGluIGJldHdlZW4KCiAgICAgIGNvbnN0IHBpdm90QSA9IG9wdGlvbnMucGl2b3RBID8gb3B0aW9ucy5waXZvdEEuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBpdm90QiA9IG9wdGlvbnMucGl2b3RCID8gb3B0aW9ucy5waXZvdEIuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHN1cGVyKGJvZHlBLCBwaXZvdEEsIGJvZHlCLCBwaXZvdEIsIG1heEZvcmNlKTsKICAgICAgdGhpcy5heGlzQSA9IHZvaWQgMDsKICAgICAgdGhpcy5heGlzQiA9IHZvaWQgMDsKICAgICAgdGhpcy5hbmdsZSA9IHZvaWQgMDsKICAgICAgdGhpcy50d2lzdEFuZ2xlID0gdm9pZCAwOwogICAgICB0aGlzLmNvbmVFcXVhdGlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy50d2lzdEVxdWF0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gISFvcHRpb25zLmNvbGxpZGVDb25uZWN0ZWQ7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgICAgY29uc3QgYyA9IHRoaXMuY29uZUVxdWF0aW9uID0gbmV3IENvbmVFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCB0ID0gdGhpcy50d2lzdEVxdWF0aW9uID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLnR3aXN0QW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy50d2lzdEFuZ2xlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMudHdpc3RBbmdsZSA6IDA7IC8vIE1ha2UgdGhlIGNvbmUgZXF1YXRpb24gcHVzaCB0aGUgYm9kaWVzIHRvd2FyZCB0aGUgY29uZSBheGlzLCBub3Qgb3V0d2FyZAoKICAgICAgYy5tYXhGb3JjZSA9IDA7CiAgICAgIGMubWluRm9yY2UgPSAtbWF4Rm9yY2U7IC8vIE1ha2UgdGhlIHR3aXN0IGVxdWF0aW9uIGFkZCB0b3JxdWUgdG93YXJkIHRoZSBpbml0aWFsIHBvc2l0aW9uCgogICAgICB0Lm1heEZvcmNlID0gMDsKICAgICAgdC5taW5Gb3JjZSA9IC1tYXhGb3JjZTsKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChjLCB0KTsKICAgIH0KCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBjb25lID0gdGhpcy5jb25lRXF1YXRpb247CiAgICAgIGNvbnN0IHR3aXN0ID0gdGhpcy50d2lzdEVxdWF0aW9uOwogICAgICBzdXBlci51cGRhdGUoKTsgLy8gVXBkYXRlIHRoZSBheGVzIHRvIHRoZSBjb25lIGNvbnN0cmFpbnQKCiAgICAgIGJvZHlBLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLmF4aXNBLCBjb25lLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMuYXhpc0IsIGNvbmUuYXhpc0IpOyAvLyBVcGRhdGUgdGhlIHdvcmxkIGF4ZXMgaW4gdGhlIHR3aXN0IGNvbnN0cmFpbnQKCiAgICAgIHRoaXMuYXhpc0EudGFuZ2VudHModHdpc3QuYXhpc0EsIHR3aXN0LmF4aXNBKTsKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNBLCB0d2lzdC5heGlzQSk7CiAgICAgIHRoaXMuYXhpc0IudGFuZ2VudHModHdpc3QuYXhpc0IsIHR3aXN0LmF4aXNCKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNCLCB0d2lzdC5heGlzQik7CiAgICAgIGNvbmUuYW5nbGUgPSB0aGlzLmFuZ2xlOwogICAgICB0d2lzdC5tYXhBbmdsZSA9IHRoaXMudHdpc3RBbmdsZTsKICAgIH0KCiAgfQogIC8qKgogICAqIENvbnN0cmFpbnMgdHdvIGJvZGllcyB0byBiZSBhdCBhIGNvbnN0YW50IGRpc3RhbmNlIGZyb20gZWFjaCBvdGhlcnMgY2VudGVyIG9mIG1hc3MuCiAgICovCgoKICBjbGFzcyBEaXN0YW5jZUNvbnN0cmFpbnQgZXh0ZW5kcyBDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogVGhlIGRpc3RhbmNlIHRvIGtlZXAuIElmIHVuZGVmaW5lZCwgaXQgd2lsbCBiZSBzZXQgdG8gdGhlIGN1cnJlbnQgZGlzdGFuY2UgYmV0d2VlbiBib2R5QSBhbmQgYm9keUIKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRpc3RhbmNlIFRoZSBkaXN0YW5jZSB0byBrZWVwLiBJZiB1bmRlZmluZWQsIGl0IHdpbGwgYmUgc2V0IHRvIHRoZSBjdXJyZW50IGRpc3RhbmNlIGJldHdlZW4gYm9keUEgYW5kIGJvZHlCLgogICAgICogQHBhcmFtIG1heEZvcmNlIFRoZSBtYXhpbXVtIGZvcmNlIHRoYXQgc2hvdWxkIGJlIGFwcGxpZWQgdG8gY29uc3RyYWluIHRoZSBib2RpZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgZGlzdGFuY2UsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5Qik7CiAgICAgIHRoaXMuZGlzdGFuY2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuZGlzdGFuY2VFcXVhdGlvbiA9IHZvaWQgMDsKCiAgICAgIGlmICh0eXBlb2YgZGlzdGFuY2UgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgZGlzdGFuY2UgPSBib2R5QS5wb3NpdGlvbi5kaXN0YW5jZVRvKGJvZHlCLnBvc2l0aW9uKTsKICAgICAgfQoKICAgICAgdGhpcy5kaXN0YW5jZSA9IGRpc3RhbmNlOwogICAgICBjb25zdCBlcSA9IHRoaXMuZGlzdGFuY2VFcXVhdGlvbiA9IG5ldyBDb250YWN0RXF1YXRpb24oYm9keUEsIGJvZHlCKTsKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChlcSk7IC8vIE1ha2UgaXQgYmlkaXJlY3Rpb25hbAoKICAgICAgZXEubWluRm9yY2UgPSAtbWF4Rm9yY2U7CiAgICAgIGVxLm1heEZvcmNlID0gbWF4Rm9yY2U7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZQogICAgICovCgoKICAgIHVwZGF0ZSgpIHsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIGNvbnN0IGVxID0gdGhpcy5kaXN0YW5jZUVxdWF0aW9uOwogICAgICBjb25zdCBoYWxmRGlzdCA9IHRoaXMuZGlzdGFuY2UgKiAwLjU7CiAgICAgIGNvbnN0IG5vcm1hbCA9IGVxLm5pOwogICAgICBib2R5Qi5wb3NpdGlvbi52c3ViKGJvZHlBLnBvc2l0aW9uLCBub3JtYWwpOwogICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgIG5vcm1hbC5zY2FsZShoYWxmRGlzdCwgZXEucmkpOwogICAgICBub3JtYWwuc2NhbGUoLWhhbGZEaXN0LCBlcS5yaik7CiAgICB9CgogIH0KICAvKioKICAgKiBMb2NrIGNvbnN0cmFpbnQuIFdpbGwgcmVtb3ZlIGFsbCBkZWdyZWVzIG9mIGZyZWVkb20gYmV0d2VlbiB0aGUgYm9kaWVzLgogICAqLwoKCiAgY2xhc3MgTG9ja0NvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7IC8vIFNldCBwaXZvdCBwb2ludCBpbiBiZXR3ZWVuCgogICAgICBjb25zdCBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoYWxmV2F5ID0gbmV3IFZlYzMoKTsKICAgICAgYm9keUEucG9zaXRpb24udmFkZChib2R5Qi5wb3NpdGlvbiwgaGFsZldheSk7CiAgICAgIGhhbGZXYXkuc2NhbGUoMC41LCBoYWxmV2F5KTsKICAgICAgYm9keUIucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RCKTsKICAgICAgYm9keUEucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RBKTsgLy8gVGhlIHBvaW50LXRvLXBvaW50IGNvbnN0cmFpbnQgd2lsbCBrZWVwIGEgcG9pbnQgc2hhcmVkIGJldHdlZW4gdGhlIGJvZGllcwoKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOyAvLyBTdG9yZSBpbml0aWFsIHJvdGF0aW9uIG9mIHRoZSBib2RpZXMgYXMgdW5pdCB2ZWN0b3JzIGluIHRoZSBsb2NhbCBib2R5IHNwYWNlcwoKICAgICAgdGhpcy54QSA9IHZvaWQgMDsKICAgICAgdGhpcy54QiA9IHZvaWQgMDsKICAgICAgdGhpcy55QSA9IHZvaWQgMDsKICAgICAgdGhpcy55QiA9IHZvaWQgMDsKICAgICAgdGhpcy56QSA9IHZvaWQgMDsKICAgICAgdGhpcy56QiA9IHZvaWQgMDsKICAgICAgdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xID0gdm9pZCAwOwogICAgICB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjIgPSB2b2lkIDA7CiAgICAgIHRoaXMucm90YXRpb25hbEVxdWF0aW9uMyA9IHZvaWQgMDsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLnhBID0gYm9keUEudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9YKTsKICAgICAgdGhpcy54QiA9IGJvZHlCLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWCk7CiAgICAgIHRoaXMueUEgPSBib2R5QS52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1kpOwogICAgICB0aGlzLnlCID0gYm9keUIudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9ZKTsKICAgICAgdGhpcy56QSA9IGJvZHlBLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWik7CiAgICAgIHRoaXMuekIgPSBib2R5Qi52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1opOyAvLyAuLi5hbmQgdGhlIGZvbGxvd2luZyByb3RhdGlvbmFsIGVxdWF0aW9ucyB3aWxsIGtlZXAgYWxsIHJvdGF0aW9uYWwgRE9GJ3MgaW4gcGxhY2UKCiAgICAgIGNvbnN0IHIxID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCByMiA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMiA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgY29uc3QgcjMgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjMgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2gocjEsIHIyLCByMyk7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZQogICAgICovCgoKICAgIHVwZGF0ZSgpIHsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbjsKICAgICAgY29uc3QgcjEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjE7CiAgICAgIGNvbnN0IHIyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yOwogICAgICBjb25zdCByMyA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMzsKICAgICAgc3VwZXIudXBkYXRlKCk7IC8vIFRoZXNlIHZlY3RvciBwYWlycyBtdXN0IGJlIG9ydGhvZ29uYWwKCiAgICAgIGJvZHlBLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLnhBLCByMS5heGlzQSk7CiAgICAgIGJvZHlCLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLnlCLCByMS5heGlzQik7CiAgICAgIGJvZHlBLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLnlBLCByMi5heGlzQSk7CiAgICAgIGJvZHlCLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLnpCLCByMi5heGlzQik7CiAgICAgIGJvZHlBLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLnpBLCByMy5heGlzQSk7CiAgICAgIGJvZHlCLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLnhCLCByMy5heGlzQik7CiAgICB9CgogIH0KICAvKioKICAgKiBSb3RhdGlvbmFsIG1vdG9yIGNvbnN0cmFpbnQuIFRyaWVzIHRvIGtlZXAgdGhlIHJlbGF0aXZlIGFuZ3VsYXIgdmVsb2NpdHkgb2YgdGhlIGJvZGllcyB0byBhIGdpdmVuIHZhbHVlLgogICAqLwoKCiAgY2xhc3MgUm90YXRpb25hbE1vdG9yRXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqIFdvcmxkIG9yaWVudGVkIHJvdGF0aW9uYWwgYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBNb3RvciB2ZWxvY2l0eS4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBtYXhGb3JjZSkgewogICAgICBpZiAobWF4Rm9yY2UgPT09IHZvaWQgMCkgewogICAgICAgIG1heEZvcmNlID0gMWU2OwogICAgICB9CgogICAgICBzdXBlcihib2R5QSwgYm9keUIsIC1tYXhGb3JjZSwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gdm9pZCAwOwogICAgICB0aGlzLmF4aXNCID0gdm9pZCAwOwogICAgICB0aGlzLnRhcmdldFZlbG9jaXR5ID0gdm9pZCAwOwogICAgICB0aGlzLmF4aXNBID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5heGlzQiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMudGFyZ2V0VmVsb2NpdHkgPSAwOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICB0aGlzLmJpOwogICAgICB0aGlzLmJqOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IGF4aXNCID0gdGhpcy5heGlzQjsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOyAvLyBnID0gMAogICAgICAvLyBnZG90ID0gYXhpc0EgKiB3aSAtIGF4aXNCICogd2oKICAgICAgLy8gZ2RvdCA9IEcgKiBXID0gRyAqIFt2aSB3aSB2aiB3al0KICAgICAgLy8gPT4KICAgICAgLy8gRyA9IFswIGF4aXNBIDAgLWF4aXNCXQoKICAgICAgR0Eucm90YXRpb25hbC5jb3B5KGF4aXNBKTsKICAgICAgYXhpc0IubmVnYXRlKEdCLnJvdGF0aW9uYWwpOwogICAgICBjb25zdCBHVyA9IHRoaXMuY29tcHV0ZUdXKCkgLSB0aGlzLnRhcmdldFZlbG9jaXR5OwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLUdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIC8qKgogICAqIEhpbmdlIGNvbnN0cmFpbnQuIFRoaW5rIG9mIGl0IGFzIGEgZG9vciBoaW5nZS4gSXQgdHJpZXMgdG8ga2VlcCB0aGUgZG9vciBpbiB0aGUgY29ycmVjdCBwbGFjZSBhbmQgd2l0aCB0aGUgY29ycmVjdCBvcmllbnRhdGlvbi4KICAgKi8KCgogIGNsYXNzIEhpbmdlQ29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBSb3RhdGlvbiBheGlzLCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIGF4aXMsIGRlZmluZWQgbG9jYWxseSBpbiBib2R5Qi4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IG1heEZvcmNlID0gdHlwZW9mIG9wdGlvbnMubWF4Rm9yY2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhGb3JjZSA6IDFlNjsKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gdm9pZCAwOwogICAgICB0aGlzLmF4aXNCID0gdm9pZCAwOwogICAgICB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjEgPSB2b2lkIDA7CiAgICAgIHRoaXMucm90YXRpb25hbEVxdWF0aW9uMiA9IHZvaWQgMDsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uID0gdm9pZCAwOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNBLm5vcm1hbGl6ZSgpOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNCLm5vcm1hbGl6ZSgpOwogICAgICB0aGlzLmNvbGxpZGVDb25uZWN0ZWQgPSAhIW9wdGlvbnMuY29sbGlkZUNvbm5lY3RlZDsKICAgICAgY29uc3Qgcm90YXRpb25hbDEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjEgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHJvdGF0aW9uYWwyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbiA9IG5ldyBSb3RhdGlvbmFsTW90b3JFcXVhdGlvbihib2R5QSwgYm9keUIsIG1heEZvcmNlKTsKICAgICAgbW90b3IuZW5hYmxlZCA9IGZhbHNlOyAvLyBOb3QgZW5hYmxlZCBieSBkZWZhdWx0CiAgICAgIC8vIEVxdWF0aW9ucyB0byBiZSBmZWQgdG8gdGhlIHNvbHZlcgoKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChyb3RhdGlvbmFsMSwgcm90YXRpb25hbDIsIG1vdG9yKTsKICAgIH0KICAgIC8qKgogICAgICogZW5hYmxlTW90b3IKICAgICAqLwoKCiAgICBlbmFibGVNb3RvcigpIHsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLmVuYWJsZWQgPSB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBkaXNhYmxlTW90b3IKICAgICAqLwoKCiAgICBkaXNhYmxlTW90b3IoKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi5lbmFibGVkID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHNldE1vdG9yU3BlZWQKICAgICAqLwoKCiAgICBzZXRNb3RvclNwZWVkKHNwZWVkKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi50YXJnZXRWZWxvY2l0eSA9IHNwZWVkOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRNb3Rvck1heEZvcmNlCiAgICAgKi8KCgogICAgc2V0TW90b3JNYXhGb3JjZShtYXhGb3JjZSkgewogICAgICB0aGlzLm1vdG9yRXF1YXRpb24ubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbjsKICAgICAgY29uc3QgcjEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjE7CiAgICAgIGNvbnN0IHIyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yOwogICAgICBjb25zdCB3b3JsZEF4aXNBID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMxOwogICAgICBjb25zdCB3b3JsZEF4aXNCID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMyOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IGF4aXNCID0gdGhpcy5heGlzQjsKICAgICAgc3VwZXIudXBkYXRlKCk7IC8vIEdldCB3b3JsZCBheGVzCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KGF4aXNBLCB3b3JsZEF4aXNBKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdChheGlzQiwgd29ybGRBeGlzQik7CiAgICAgIHdvcmxkQXhpc0EudGFuZ2VudHMocjEuYXhpc0EsIHIyLmF4aXNBKTsKICAgICAgcjEuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKICAgICAgcjIuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKCiAgICAgIGlmICh0aGlzLm1vdG9yRXF1YXRpb24uZW5hYmxlZCkgewogICAgICAgIGJvZHlBLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQSwgbW90b3IuYXhpc0EpOwogICAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQiwgbW90b3IuYXhpc0IpOwogICAgICB9CiAgICB9CgogIH0KCiAgY29uc3QgSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBIaW5nZUNvbnN0cmFpbnRfdXBkYXRlX3RtcFZlYzIgPSBuZXcgVmVjMygpOwogIC8qKgogICAqIENvbnN0cmFpbnMgdGhlIHNsaXBwaW5nIGluIGEgY29udGFjdCBhbG9uZyBhIHRhbmdlbnQKICAgKi8KCiAgY2xhc3MgRnJpY3Rpb25FcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8vIFRhbmdlbnQKCiAgICAvKioKICAgICAqIEBwYXJhbSBzbGlwRm9yY2Ugc2hvdWxkIGJlICstRl9mcmljdGlvbiA9ICstbXUgKiBGX25vcm1hbCA9ICstbXUgKiBtICogZwogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIHNsaXBGb3JjZSkgewogICAgICBzdXBlcihib2R5QSwgYm9keUIsIC1zbGlwRm9yY2UsIHNsaXBGb3JjZSk7CiAgICAgIHRoaXMucmkgPSB2b2lkIDA7CiAgICAgIHRoaXMucmogPSB2b2lkIDA7CiAgICAgIHRoaXMudCA9IHZvaWQgMDsKICAgICAgdGhpcy5yaSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmogPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnQgPSBuZXcgVmVjMygpOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICB0aGlzLmJpOwogICAgICB0aGlzLmJqOwogICAgICBjb25zdCByaSA9IHRoaXMucmk7CiAgICAgIGNvbnN0IHJqID0gdGhpcy5yajsKICAgICAgY29uc3Qgcml4dCA9IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeHQgPSBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyOwogICAgICBjb25zdCB0ID0gdGhpcy50OyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIHJpLmNyb3NzKHQsIHJpeHQpOwogICAgICByai5jcm9zcyh0LCByanh0KTsgLy8gRyA9IFstdCAtcml4dCB0IHJqeHRdCiAgICAgIC8vIEFuZCByZW1lbWJlciwgdGhpcyBpcyBhIHB1cmUgdmVsb2NpdHkgY29uc3RyYWludCwgZyBpcyBhbHdheXMgemVybyEKCiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgdC5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeHQubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkodCk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanh0KTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLUdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQoKICBjb25zdCBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAxID0gbmV3IFZlYzMoKTsKICBjb25zdCBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyID0gbmV3IFZlYzMoKTsKICAvKioKICAgKiBEZWZpbmVzIHdoYXQgaGFwcGVucyB3aGVuIHR3byBtYXRlcmlhbHMgbWVldC4KICAgKiBAdG9kbyBSZWZhY3RvciBtYXRlcmlhbHMgdG8gbWF0ZXJpYWxBIGFuZCBtYXRlcmlhbEIKICAgKi8KCiAgY2xhc3MgQ29udGFjdE1hdGVyaWFsIHsKICAgIC8qKgogICAgICogSWRlbnRpZmllciBvZiB0aGlzIG1hdGVyaWFsLgogICAgICovCgogICAgLyoqCiAgICAgKiBQYXJ0aWNpcGF0aW5nIG1hdGVyaWFscy4KICAgICAqLwoKICAgIC8qKgogICAgICogRnJpY3Rpb24gY29lZmZpY2llbnQuCiAgICAgKiBAZGVmYXVsdCAwLjMKICAgICAqLwoKICAgIC8qKgogICAgICogUmVzdGl0dXRpb24gY29lZmZpY2llbnQuCiAgICAgKiBAZGVmYXVsdCAwLjMKICAgICAqLwoKICAgIC8qKgogICAgICogU3RpZmZuZXNzIG9mIHRoZSBwcm9kdWNlZCBjb250YWN0IGVxdWF0aW9ucy4KICAgICAqIEBkZWZhdWx0IDFlNwogICAgICovCgogICAgLyoqCiAgICAgKiBSZWxheGF0aW9uIHRpbWUgb2YgdGhlIHByb2R1Y2VkIGNvbnRhY3QgZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMwogICAgICovCgogICAgLyoqCiAgICAgKiBTdGlmZm5lc3Mgb2YgdGhlIHByb2R1Y2VkIGZyaWN0aW9uIGVxdWF0aW9ucy4KICAgICAqIEBkZWZhdWx0IDFlNwogICAgICovCgogICAgLyoqCiAgICAgKiBSZWxheGF0aW9uIHRpbWUgb2YgdGhlIHByb2R1Y2VkIGZyaWN0aW9uIGVxdWF0aW9ucwogICAgICogQGRlZmF1bHQgMwogICAgICovCiAgICBjb25zdHJ1Y3RvcihtMSwgbTIsIG9wdGlvbnMpIHsKICAgICAgdGhpcy5pZCA9IHZvaWQgMDsKICAgICAgdGhpcy5tYXRlcmlhbHMgPSB2b2lkIDA7CiAgICAgIHRoaXMuZnJpY3Rpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMuY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzID0gdm9pZCAwOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcyA9IHZvaWQgMDsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiA9IHZvaWQgMDsKICAgICAgb3B0aW9ucyA9IFV0aWxzLmRlZmF1bHRzKG9wdGlvbnMsIHsKICAgICAgICBmcmljdGlvbjogMC4zLAogICAgICAgIHJlc3RpdHV0aW9uOiAwLjMsCiAgICAgICAgY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzOiAxZTcsCiAgICAgICAgY29udGFjdEVxdWF0aW9uUmVsYXhhdGlvbjogMywKICAgICAgICBmcmljdGlvbkVxdWF0aW9uU3RpZmZuZXNzOiAxZTcsCiAgICAgICAgZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb246IDMKICAgICAgfSk7CiAgICAgIHRoaXMuaWQgPSBDb250YWN0TWF0ZXJpYWwuaWRDb3VudGVyKys7CiAgICAgIHRoaXMubWF0ZXJpYWxzID0gW20xLCBtMl07CiAgICAgIHRoaXMuZnJpY3Rpb24gPSBvcHRpb25zLmZyaWN0aW9uOwogICAgICB0aGlzLnJlc3RpdHV0aW9uID0gb3B0aW9ucy5yZXN0aXR1dGlvbjsKICAgICAgdGhpcy5jb250YWN0RXF1YXRpb25TdGlmZm5lc3MgPSBvcHRpb25zLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzczsKICAgICAgdGhpcy5jb250YWN0RXF1YXRpb25SZWxheGF0aW9uID0gb3B0aW9ucy5jb250YWN0RXF1YXRpb25SZWxheGF0aW9uOwogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MgPSBvcHRpb25zLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3M7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24gPSBvcHRpb25zLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uOwogICAgfQoKICB9CgogIENvbnRhY3RNYXRlcmlhbC5pZENvdW50ZXIgPSAwOwogIC8qKgogICAqIERlZmluZXMgYSBwaHlzaWNzIG1hdGVyaWFsLgogICAqLwoKICBjbGFzcyBNYXRlcmlhbCB7CiAgICAvKioKICAgICAqIE1hdGVyaWFsIG5hbWUuCiAgICAgKiBJZiBvcHRpb25zIGlzIGEgc3RyaW5nLCBuYW1lIHdpbGwgYmUgc2V0IHRvIHRoYXQgc3RyaW5nLgogICAgICogQHRvZG8gRGVwcmVjYXRlIHRoaXMKICAgICAqLwoKICAgIC8qKiBNYXRlcmlhbCBpZC4gKi8KCiAgICAvKioKICAgICAqIEZyaWN0aW9uIGZvciB0aGlzIG1hdGVyaWFsLgogICAgICogSWYgbm9uLW5lZ2F0aXZlLCBpdCB3aWxsIGJlIHVzZWQgaW5zdGVhZCBvZiB0aGUgZnJpY3Rpb24gZ2l2ZW4gYnkgQ29udGFjdE1hdGVyaWFscy4gSWYgdGhlcmUncyBubyBtYXRjaGluZyBDb250YWN0TWF0ZXJpYWwsIHRoZSB2YWx1ZSBmcm9tIGBkZWZhdWx0Q29udGFjdE1hdGVyaWFsYCBpbiB0aGUgV29ybGQgd2lsbCBiZSB1c2VkLgogICAgICovCgogICAgLyoqCiAgICAgKiBSZXN0aXR1dGlvbiBmb3IgdGhpcyBtYXRlcmlhbC4KICAgICAqIElmIG5vbi1uZWdhdGl2ZSwgaXQgd2lsbCBiZSB1c2VkIGluc3RlYWQgb2YgdGhlIHJlc3RpdHV0aW9uIGdpdmVuIGJ5IENvbnRhY3RNYXRlcmlhbHMuIElmIHRoZXJlJ3Mgbm8gbWF0Y2hpbmcgQ29udGFjdE1hdGVyaWFsLCB0aGUgdmFsdWUgZnJvbSBgZGVmYXVsdENvbnRhY3RNYXRlcmlhbGAgaW4gdGhlIFdvcmxkIHdpbGwgYmUgdXNlZC4KICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLm5hbWUgPSB2b2lkIDA7CiAgICAgIHRoaXMuaWQgPSB2b2lkIDA7CiAgICAgIHRoaXMuZnJpY3Rpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSB2b2lkIDA7CiAgICAgIGxldCBuYW1lID0gJyc7IC8vIEJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IGZpeAoKICAgICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSAnc3RyaW5nJykgewogICAgICAgIC8vY29uc29sZS53YXJuKGBQYXNzaW5nIGEgc3RyaW5nIHRvIE1hdGVyaWFsT3B0aW9ucyBpcyBkZXByZWNhdGVkLCBhbmQgaGFzIG5vIGVmZmVjdGApCiAgICAgICAgbmFtZSA9IG9wdGlvbnM7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgICB0aGlzLmlkID0gTWF0ZXJpYWwuaWRDb3VudGVyKys7CiAgICAgIHRoaXMuZnJpY3Rpb24gPSB0eXBlb2Ygb3B0aW9ucy5mcmljdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmZyaWN0aW9uIDogLTE7CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSB0eXBlb2Ygb3B0aW9ucy5yZXN0aXR1dGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnJlc3RpdHV0aW9uIDogLTE7CiAgICB9CgogIH0KCiAgTWF0ZXJpYWwuaWRDb3VudGVyID0gMDsKICAvKioKICAgKiBBIHNwcmluZywgY29ubmVjdGluZyB0d28gYm9kaWVzLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IHNwcmluZyA9IG5ldyBTcHJpbmcoYm94Qm9keSwgc3BoZXJlQm9keSwgewogICAqICAgICAgIHJlc3RMZW5ndGg6IDAsCiAgICogICAgICAgc3RpZmZuZXNzOiA1MCwKICAgKiAgICAgICBkYW1waW5nOiAxLAogICAqICAgICB9KQogICAqCiAgICogICAgIC8vIENvbXB1dGUgdGhlIGZvcmNlIGFmdGVyIGVhY2ggc3RlcAogICAqICAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwb3N0U3RlcCcsIChldmVudCkgPT4gewogICAqICAgICAgIHNwcmluZy5hcHBseUZvcmNlKCkKICAgKiAgICAgfSkKICAgKi8KCiAgY2xhc3MgU3ByaW5nIHsKICAgIC8qKgogICAgICogUmVzdCBsZW5ndGggb2YgdGhlIHNwcmluZy4gQSBudW1iZXIgPiAwLgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBTdGlmZm5lc3Mgb2YgdGhlIHNwcmluZy4gQSBudW1iZXIgPj0gMC4KICAgICAqIEBkZWZhdWx0IDEwMAogICAgICovCgogICAgLyoqCiAgICAgKiBEYW1waW5nIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID49IDAuCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIEZpcnN0IGNvbm5lY3RlZCBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBTZWNvbmQgY29ubmVjdGVkIGJvZHkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFuY2hvciBmb3IgYm9keUEgaW4gbG9jYWwgYm9keUEgY29vcmRpbmF0ZXMuCiAgICAgKiBXaGVyZSB0byBob29rIHRoZSBzcHJpbmcgdG8gYm9keSBBLCBpbiBsb2NhbCBib2R5IGNvb3JkaW5hdGVzLgogICAgICogQGRlZmF1bHQgbmV3IFZlYzMoKQogICAgICovCgogICAgLyoqCiAgICAgKiBBbmNob3IgZm9yIGJvZHlCIGluIGxvY2FsIGJvZHlCIGNvb3JkaW5hdGVzLgogICAgICogV2hlcmUgdG8gaG9vayB0aGUgc3ByaW5nIHRvIGJvZHkgQiwgaW4gbG9jYWwgYm9keSBjb29yZGluYXRlcy4KICAgICAqIEBkZWZhdWx0IG5ldyBWZWMzKCkKICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMucmVzdExlbmd0aCA9IHZvaWQgMDsKICAgICAgdGhpcy5zdGlmZm5lc3MgPSB2b2lkIDA7CiAgICAgIHRoaXMuZGFtcGluZyA9IHZvaWQgMDsKICAgICAgdGhpcy5ib2R5QSA9IHZvaWQgMDsKICAgICAgdGhpcy5ib2R5QiA9IHZvaWQgMDsKICAgICAgdGhpcy5sb2NhbEFuY2hvckEgPSB2b2lkIDA7CiAgICAgIHRoaXMubG9jYWxBbmNob3JCID0gdm9pZCAwOwogICAgICB0aGlzLnJlc3RMZW5ndGggPSB0eXBlb2Ygb3B0aW9ucy5yZXN0TGVuZ3RoID09PSAnbnVtYmVyJyA/IG9wdGlvbnMucmVzdExlbmd0aCA6IDE7CiAgICAgIHRoaXMuc3RpZmZuZXNzID0gb3B0aW9ucy5zdGlmZm5lc3MgfHwgMTAwOwogICAgICB0aGlzLmRhbXBpbmcgPSBvcHRpb25zLmRhbXBpbmcgfHwgMTsKICAgICAgdGhpcy5ib2R5QSA9IGJvZHlBOwogICAgICB0aGlzLmJvZHlCID0gYm9keUI7CiAgICAgIHRoaXMubG9jYWxBbmNob3JBID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5sb2NhbEFuY2hvckIgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG9jYWxBbmNob3JBKSB7CiAgICAgICAgdGhpcy5sb2NhbEFuY2hvckEuY29weShvcHRpb25zLmxvY2FsQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmxvY2FsQW5jaG9yQikgewogICAgICAgIHRoaXMubG9jYWxBbmNob3JCLmNvcHkob3B0aW9ucy5sb2NhbEFuY2hvckIpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy53b3JsZEFuY2hvckEpIHsKICAgICAgICB0aGlzLnNldFdvcmxkQW5jaG9yQShvcHRpb25zLndvcmxkQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLndvcmxkQW5jaG9yQikgewogICAgICAgIHRoaXMuc2V0V29ybGRBbmNob3JCKG9wdGlvbnMud29ybGRBbmNob3JCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEEsIHVzaW5nIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICovCgoKICAgIHNldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpIHsKICAgICAgdGhpcy5ib2R5QS5wb2ludFRvTG9jYWxGcmFtZSh3b3JsZEFuY2hvckEsIHRoaXMubG9jYWxBbmNob3JBKTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBhbmNob3IgcG9pbnQgb24gYm9keSBCLCB1c2luZyB3b3JsZCBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBzZXRXb3JsZEFuY2hvckIod29ybGRBbmNob3JCKSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb0xvY2FsRnJhbWUod29ybGRBbmNob3JCLCB0aGlzLmxvY2FsQW5jaG9yQik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQSwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckEocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUEucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckEsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQiwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckIocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRoZSBzcHJpbmcgZm9yY2UgdG8gdGhlIGNvbm5lY3RlZCBib2RpZXMuCiAgICAgKi8KCgogICAgYXBwbHlGb3JjZSgpIHsKICAgICAgY29uc3QgayA9IHRoaXMuc3RpZmZuZXNzOwogICAgICBjb25zdCBkID0gdGhpcy5kYW1waW5nOwogICAgICBjb25zdCBsID0gdGhpcy5yZXN0TGVuZ3RoOwogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgciA9IGFwcGx5Rm9yY2VfcjsKICAgICAgY29uc3Qgcl91bml0ID0gYXBwbHlGb3JjZV9yX3VuaXQ7CiAgICAgIGNvbnN0IHUgPSBhcHBseUZvcmNlX3U7CiAgICAgIGNvbnN0IGYgPSBhcHBseUZvcmNlX2Y7CiAgICAgIGNvbnN0IHRtcCA9IGFwcGx5Rm9yY2VfdG1wOwogICAgICBjb25zdCB3b3JsZEFuY2hvckEgPSBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQTsKICAgICAgY29uc3Qgd29ybGRBbmNob3JCID0gYXBwbHlGb3JjZV93b3JsZEFuY2hvckI7CiAgICAgIGNvbnN0IHJpID0gYXBwbHlGb3JjZV9yaTsKICAgICAgY29uc3QgcmogPSBhcHBseUZvcmNlX3JqOwogICAgICBjb25zdCByaV94X2YgPSBhcHBseUZvcmNlX3JpX3hfZjsKICAgICAgY29uc3QgcmpfeF9mID0gYXBwbHlGb3JjZV9yal94X2Y7IC8vIEdldCB3b3JsZCBhbmNob3JzCgogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpOwogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQih3b3JsZEFuY2hvckIpOyAvLyBHZXQgb2Zmc2V0IHBvaW50cwoKICAgICAgd29ybGRBbmNob3JBLnZzdWIoYm9keUEucG9zaXRpb24sIHJpKTsKICAgICAgd29ybGRBbmNob3JCLnZzdWIoYm9keUIucG9zaXRpb24sIHJqKTsgLy8gQ29tcHV0ZSBkaXN0YW5jZSB2ZWN0b3IgYmV0d2VlbiB3b3JsZCBhbmNob3IgcG9pbnRzCgogICAgICB3b3JsZEFuY2hvckIudnN1Yih3b3JsZEFuY2hvckEsIHIpOwogICAgICBjb25zdCBybGVuID0gci5sZW5ndGgoKTsKICAgICAgcl91bml0LmNvcHkocik7CiAgICAgIHJfdW5pdC5ub3JtYWxpemUoKTsgLy8gQ29tcHV0ZSByZWxhdGl2ZSB2ZWxvY2l0eSBvZiB0aGUgYW5jaG9yIHBvaW50cywgdQoKICAgICAgYm9keUIudmVsb2NpdHkudnN1Yihib2R5QS52ZWxvY2l0eSwgdSk7IC8vIEFkZCByb3RhdGlvbmFsIHZlbG9jaXR5CgogICAgICBib2R5Qi5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmosIHRtcCk7CiAgICAgIHUudmFkZCh0bXAsIHUpOwogICAgICBib2R5QS5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmksIHRtcCk7CiAgICAgIHUudnN1Yih0bXAsIHUpOyAvLyBGID0gLSBrICogKCB4IC0gTCApIC0gRCAqICggdSApCgogICAgICByX3VuaXQuc2NhbGUoLWsgKiAocmxlbiAtIGwpIC0gZCAqIHUuZG90KHJfdW5pdCksIGYpOyAvLyBBZGQgZm9yY2VzIHRvIGJvZGllcwoKICAgICAgYm9keUEuZm9yY2UudnN1YihmLCBib2R5QS5mb3JjZSk7CiAgICAgIGJvZHlCLmZvcmNlLnZhZGQoZiwgYm9keUIuZm9yY2UpOyAvLyBBbmd1bGFyIGZvcmNlCgogICAgICByaS5jcm9zcyhmLCByaV94X2YpOwogICAgICByai5jcm9zcyhmLCByal94X2YpOwogICAgICBib2R5QS50b3JxdWUudnN1YihyaV94X2YsIGJvZHlBLnRvcnF1ZSk7CiAgICAgIGJvZHlCLnRvcnF1ZS52YWRkKHJqX3hfZiwgYm9keUIudG9ycXVlKTsKICAgIH0KCiAgfQoKICBjb25zdCBhcHBseUZvcmNlX3IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2Vfcl91bml0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3UgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfZiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV93b3JsZEFuY2hvckEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2Vfd29ybGRBbmNob3JCID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JpID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JqID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JpX3hfZiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9yal94X2YgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfdG1wID0gbmV3IFZlYzMoKTsKICAvKioKICAgKiBXaGVlbEluZm8KICAgKi8KCiAgY2xhc3MgV2hlZWxJbmZvIHsKICAgIC8qKgogICAgICogTWF4IHRyYXZlbCBkaXN0YW5jZSBvZiB0aGUgc3VzcGVuc2lvbiwgaW4gbWV0ZXJzLgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBTcGVlZCB0byBhcHBseSB0byB0aGUgd2hlZWwgcm90YXRpb24gd2hlbiB0aGUgd2hlZWwgaXMgc2xpZGluZy4KICAgICAqIEBkZWZhdWx0IC0wLjEKICAgICAqLwoKICAgIC8qKgogICAgICogSWYgdGhlIGN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgc2hvdWxkIGJlIHVzZWQuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBzbGlkaW5nCiAgICAgKi8KCiAgICAvKioKICAgICAqIENvbm5lY3Rpb24gcG9pbnQsIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgY2hhc3NpcyBib2R5IGZyYW1lLgogICAgICovCgogICAgLyoqCiAgICAgKiBjaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogZGlyZWN0aW9uTG9jYWwKICAgICAqLwoKICAgIC8qKgogICAgICogZGlyZWN0aW9uV29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogYXhsZUxvY2FsCiAgICAgKi8KCiAgICAvKioKICAgICAqIGF4bGVXb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uUmVzdExlbmd0aAogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uTWF4TGVuZ3RoCiAgICAgKiBAZGVmYXVsdCAyCiAgICAgKi8KCiAgICAvKioKICAgICAqIHJhZGl1cwogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uU3RpZmZuZXNzCiAgICAgKiBAZGVmYXVsdCAxMDAKICAgICAqLwoKICAgIC8qKgogICAgICogZGFtcGluZ0NvbXByZXNzaW9uCiAgICAgKiBAZGVmYXVsdCAxMAogICAgICovCgogICAgLyoqCiAgICAgKiBkYW1waW5nUmVsYXhhdGlvbgogICAgICogQGRlZmF1bHQgMTAKICAgICAqLwoKICAgIC8qKgogICAgICogZnJpY3Rpb25TbGlwCiAgICAgKiBAZGVmYXVsdCAxMC41CiAgICAgKi8KCiAgICAvKiogZm9yd2FyZEFjY2VsZXJhdGlvbiAqLwoKICAgIC8qKiBzaWRlQWNjZWxlcmF0aW9uICovCgogICAgLyoqCiAgICAgKiBzdGVlcmluZwogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBSb3RhdGlvbiB2YWx1ZSwgaW4gcmFkaWFucy4KICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogZGVsdGFSb3RhdGlvbgogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiByb2xsSW5mbHVlbmNlCiAgICAgKiBAZGVmYXVsdCAwLjAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIG1heFN1c3BlbnNpb25Gb3JjZQogICAgICovCgogICAgLyoqCiAgICAgKiBlbmdpbmVGb3JjZQogICAgICovCgogICAgLyoqCiAgICAgKiBicmFrZQogICAgICovCgogICAgLyoqCiAgICAgKiBpc0Zyb250V2hlZWwKICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5CiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25Gb3JjZQogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBzbGlwSW5mbwogICAgICovCgogICAgLyoqCiAgICAgKiBza2lkSW5mbwogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uTGVuZ3RoCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNpZGVJbXB1bHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGZvcndhcmRJbXB1bHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSByZXN1bHQgZnJvbSByYXljYXN0aW5nLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVlbCB3b3JsZCB0cmFuc2Zvcm0uCiAgICAgKi8KCiAgICAvKioKICAgICAqIGlzSW5Db250YWN0CiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5tYXhTdXNwZW5zaW9uVHJhdmVsID0gdm9pZCAwOwogICAgICB0aGlzLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgPSB2b2lkIDA7CiAgICAgIHRoaXMudXNlQ3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCA9IHZvaWQgMDsKICAgICAgdGhpcy5zbGlkaW5nID0gdm9pZCAwOwogICAgICB0aGlzLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCA9IHZvaWQgMDsKICAgICAgdGhpcy5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQgPSB2b2lkIDA7CiAgICAgIHRoaXMuZGlyZWN0aW9uTG9jYWwgPSB2b2lkIDA7CiAgICAgIHRoaXMuZGlyZWN0aW9uV29ybGQgPSB2b2lkIDA7CiAgICAgIHRoaXMuYXhsZUxvY2FsID0gdm9pZCAwOwogICAgICB0aGlzLmF4bGVXb3JsZCA9IHZvaWQgMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uUmVzdExlbmd0aCA9IHZvaWQgMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uTWF4TGVuZ3RoID0gdm9pZCAwOwogICAgICB0aGlzLnJhZGl1cyA9IHZvaWQgMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uU3RpZmZuZXNzID0gdm9pZCAwOwogICAgICB0aGlzLmRhbXBpbmdDb21wcmVzc2lvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5kYW1waW5nUmVsYXhhdGlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5mcmljdGlvblNsaXAgPSB2b2lkIDA7CiAgICAgIHRoaXMuZm9yd2FyZEFjY2VsZXJhdGlvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5zaWRlQWNjZWxlcmF0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLnN0ZWVyaW5nID0gdm9pZCAwOwogICAgICB0aGlzLnJvdGF0aW9uID0gdm9pZCAwOwogICAgICB0aGlzLmRlbHRhUm90YXRpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMucm9sbEluZmx1ZW5jZSA9IHZvaWQgMDsKICAgICAgdGhpcy5tYXhTdXNwZW5zaW9uRm9yY2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuZW5naW5lRm9yY2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuYnJha2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuaXNGcm9udFdoZWVsID0gdm9pZCAwOwogICAgICB0aGlzLmNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbiA9IHZvaWQgMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IHZvaWQgMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uRm9yY2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuc2xpcEluZm8gPSB2b2lkIDA7CiAgICAgIHRoaXMuc2tpZEluZm8gPSB2b2lkIDA7CiAgICAgIHRoaXMuc3VzcGVuc2lvbkxlbmd0aCA9IHZvaWQgMDsKICAgICAgdGhpcy5zaWRlSW1wdWxzZSA9IHZvaWQgMDsKICAgICAgdGhpcy5mb3J3YXJkSW1wdWxzZSA9IHZvaWQgMDsKICAgICAgdGhpcy5yYXljYXN0UmVzdWx0ID0gdm9pZCAwOwogICAgICB0aGlzLndvcmxkVHJhbnNmb3JtID0gdm9pZCAwOwogICAgICB0aGlzLmlzSW5Db250YWN0ID0gdm9pZCAwOwogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbDogbmV3IFZlYzMoKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uTG9jYWw6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uV29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgYXhsZUxvY2FsOiBuZXcgVmVjMygpLAogICAgICAgIGF4bGVXb3JsZDogbmV3IFZlYzMoKSwKICAgICAgICBzdXNwZW5zaW9uUmVzdExlbmd0aDogMSwKICAgICAgICBzdXNwZW5zaW9uTWF4TGVuZ3RoOiAyLAogICAgICAgIHJhZGl1czogMSwKICAgICAgICBzdXNwZW5zaW9uU3RpZmZuZXNzOiAxMDAsCiAgICAgICAgZGFtcGluZ0NvbXByZXNzaW9uOiAxMCwKICAgICAgICBkYW1waW5nUmVsYXhhdGlvbjogMTAsCiAgICAgICAgZnJpY3Rpb25TbGlwOiAxMC41LAogICAgICAgIGZvcndhcmRBY2NlbGVyYXRpb246IDEsCiAgICAgICAgc2lkZUFjY2VsZXJhdGlvbjogMSwKICAgICAgICBzdGVlcmluZzogMCwKICAgICAgICByb3RhdGlvbjogMCwKICAgICAgICBkZWx0YVJvdGF0aW9uOiAwLAogICAgICAgIHJvbGxJbmZsdWVuY2U6IDAuMDEsCiAgICAgICAgbWF4U3VzcGVuc2lvbkZvcmNlOiBOdW1iZXIuTUFYX1ZBTFVFLAogICAgICAgIGlzRnJvbnRXaGVlbDogdHJ1ZSwKICAgICAgICBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb246IDEsCiAgICAgICAgc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHk6IDAsCiAgICAgICAgc3VzcGVuc2lvbkZvcmNlOiAwLAogICAgICAgIHNsaXBJbmZvOiAwLAogICAgICAgIHNraWRJbmZvOiAwLAogICAgICAgIHN1c3BlbnNpb25MZW5ndGg6IDAsCiAgICAgICAgbWF4U3VzcGVuc2lvblRyYXZlbDogMSwKICAgICAgICB1c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiBmYWxzZSwKICAgICAgICBjdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiAtMC4xCiAgICAgIH0pOwogICAgICB0aGlzLm1heFN1c3BlbnNpb25UcmF2ZWwgPSBvcHRpb25zLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgIHRoaXMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCA9IG9wdGlvbnMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDsKICAgICAgdGhpcy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkID0gb3B0aW9ucy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOwogICAgICB0aGlzLnNsaWRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5jaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwgPSBvcHRpb25zLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbC5jbG9uZSgpOwogICAgICB0aGlzLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCA9IG9wdGlvbnMuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uTG9jYWwgPSBvcHRpb25zLmRpcmVjdGlvbkxvY2FsLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uV29ybGQgPSBvcHRpb25zLmRpcmVjdGlvbldvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuYXhsZUxvY2FsID0gb3B0aW9ucy5heGxlTG9jYWwuY2xvbmUoKTsKICAgICAgdGhpcy5heGxlV29ybGQgPSBvcHRpb25zLmF4bGVXb3JsZC5jbG9uZSgpOwogICAgICB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgdGhpcy5zdXNwZW5zaW9uTWF4TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uTWF4TGVuZ3RoOwogICAgICB0aGlzLnJhZGl1cyA9IG9wdGlvbnMucmFkaXVzOwogICAgICB0aGlzLnN1c3BlbnNpb25TdGlmZm5lc3MgPSBvcHRpb25zLnN1c3BlbnNpb25TdGlmZm5lc3M7CiAgICAgIHRoaXMuZGFtcGluZ0NvbXByZXNzaW9uID0gb3B0aW9ucy5kYW1waW5nQ29tcHJlc3Npb247CiAgICAgIHRoaXMuZGFtcGluZ1JlbGF4YXRpb24gPSBvcHRpb25zLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICB0aGlzLmZyaWN0aW9uU2xpcCA9IG9wdGlvbnMuZnJpY3Rpb25TbGlwOwogICAgICB0aGlzLmZvcndhcmRBY2NlbGVyYXRpb24gPSBvcHRpb25zLmZvcndhcmRBY2NlbGVyYXRpb247CiAgICAgIHRoaXMuc2lkZUFjY2VsZXJhdGlvbiA9IG9wdGlvbnMuc2lkZUFjY2VsZXJhdGlvbjsKICAgICAgdGhpcy5zdGVlcmluZyA9IDA7CiAgICAgIHRoaXMucm90YXRpb24gPSAwOwogICAgICB0aGlzLmRlbHRhUm90YXRpb24gPSAwOwogICAgICB0aGlzLnJvbGxJbmZsdWVuY2UgPSBvcHRpb25zLnJvbGxJbmZsdWVuY2U7CiAgICAgIHRoaXMubWF4U3VzcGVuc2lvbkZvcmNlID0gb3B0aW9ucy5tYXhTdXNwZW5zaW9uRm9yY2U7CiAgICAgIHRoaXMuZW5naW5lRm9yY2UgPSAwOwogICAgICB0aGlzLmJyYWtlID0gMDsKICAgICAgdGhpcy5pc0Zyb250V2hlZWwgPSBvcHRpb25zLmlzRnJvbnRXaGVlbDsKICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxOwogICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICB0aGlzLnNsaXBJbmZvID0gMDsKICAgICAgdGhpcy5za2lkSW5mbyA9IDA7CiAgICAgIHRoaXMuc3VzcGVuc2lvbkxlbmd0aCA9IDA7CiAgICAgIHRoaXMuc2lkZUltcHVsc2UgPSAwOwogICAgICB0aGlzLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgdGhpcy5yYXljYXN0UmVzdWx0ID0gbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy53b3JsZFRyYW5zZm9ybSA9IG5ldyBUcmFuc2Zvcm0oKTsKICAgICAgdGhpcy5pc0luQ29udGFjdCA9IGZhbHNlOwogICAgfQoKICAgIHVwZGF0ZVdoZWVsKGNoYXNzaXMpIHsKICAgICAgY29uc3QgcmF5Y2FzdFJlc3VsdCA9IHRoaXMucmF5Y2FzdFJlc3VsdDsKCiAgICAgIGlmICh0aGlzLmlzSW5Db250YWN0KSB7CiAgICAgICAgY29uc3QgcHJvamVjdCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHJheWNhc3RSZXN1bHQuZGlyZWN0aW9uV29ybGQpOwogICAgICAgIHJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXMucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY2hhc3Npcy5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChyZWxwb3MsIGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKICAgICAgICBjb25zdCBwcm9qVmVsID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZC5kb3QoY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQpOwoKICAgICAgICBpZiAocHJvamVjdCA+PSAtMC4xKSB7CiAgICAgICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjAgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gcHJvamVjdDsKICAgICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSBwcm9qVmVsICogaW52OwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIE5vdCBpbiBjb250YWN0IDogcG9zaXRpb24gd2hlZWwgaW4gYSBuaWNlIChyZXN0IGxlbmd0aCkgcG9zaXRpb24KICAgICAgICByYXljYXN0UmVzdWx0LnN1c3BlbnNpb25MZW5ndGggPSB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoOwogICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSAwLjA7CiAgICAgICAgcmF5Y2FzdFJlc3VsdC5kaXJlY3Rpb25Xb3JsZC5zY2FsZSgtMSwgcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KICAgIH0KCiAgfQoKICBjb25zdCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVscG9zID0gbmV3IFZlYzMoKTsKICAvKioKICAgKiBWZWhpY2xlIGhlbHBlciBjbGFzcyB0aGF0IGNhc3RzIHJheXMgZnJvbSB0aGUgd2hlZWwgcG9zaXRpb25zIHRvd2FyZHMgdGhlIGdyb3VuZCBhbmQgYXBwbGllcyBmb3JjZXMuCiAgICovCgogIGNsYXNzIFJheWNhc3RWZWhpY2xlIHsKICAgIC8qKiBUaGUgY2FyIGNoYXNzaXMgYm9keS4gKi8KCiAgICAvKiogVGhlIHdoZWVscy4gKi8KCiAgICAvKiogV2lsbCBiZSBzZXQgdG8gdHJ1ZSBpZiB0aGUgY2FyIGlzIHNsaWRpbmcuICovCgogICAgLyoqIEluZGV4IG9mIHRoZSByaWdodCBheGlzLiB4PTAsIHk9MSwgej0yICovCgogICAgLyoqIEluZGV4IG9mIHRoZSBmb3J3YXJkIGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIHVwIGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogVGhlIGNvbnN0cmFpbnRzLiAqLwoKICAgIC8qKiBPcHRpb25hbCBwcmUtc3RlcCBjYWxsYmFjay4gKi8KCiAgICAvKiogTnVtYmVyIG9mIHdoZWVscyBvbiB0aGUgZ3JvdW5kLiAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICB0aGlzLmNoYXNzaXNCb2R5ID0gdm9pZCAwOwogICAgICB0aGlzLndoZWVsSW5mb3MgPSB2b2lkIDA7CiAgICAgIHRoaXMuc2xpZGluZyA9IHZvaWQgMDsKICAgICAgdGhpcy53b3JsZCA9IHZvaWQgMDsKICAgICAgdGhpcy5pbmRleFJpZ2h0QXhpcyA9IHZvaWQgMDsKICAgICAgdGhpcy5pbmRleEZvcndhcmRBeGlzID0gdm9pZCAwOwogICAgICB0aGlzLmluZGV4VXBBeGlzID0gdm9pZCAwOwogICAgICB0aGlzLmNvbnN0cmFpbnRzID0gdm9pZCAwOwogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9IHZvaWQgMDsKICAgICAgdGhpcy5jdXJyZW50VmVoaWNsZVNwZWVkS21Ib3VyID0gdm9pZCAwOwogICAgICB0aGlzLm51bVdoZWVsc09uR3JvdW5kID0gdm9pZCAwOwogICAgICB0aGlzLmNoYXNzaXNCb2R5ID0gb3B0aW9ucy5jaGFzc2lzQm9keTsKICAgICAgdGhpcy53aGVlbEluZm9zID0gW107CiAgICAgIHRoaXMuc2xpZGluZyA9IGZhbHNlOwogICAgICB0aGlzLndvcmxkID0gbnVsbDsKICAgICAgdGhpcy5pbmRleFJpZ2h0QXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4UmlnaHRBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhSaWdodEF4aXMgOiAyOwogICAgICB0aGlzLmluZGV4Rm9yd2FyZEF4aXMgPSB0eXBlb2Ygb3B0aW9ucy5pbmRleEZvcndhcmRBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhGb3J3YXJkQXhpcyA6IDA7CiAgICAgIHRoaXMuaW5kZXhVcEF4aXMgPSB0eXBlb2Ygb3B0aW9ucy5pbmRleFVwQXhpcyAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmluZGV4VXBBeGlzIDogMTsKICAgICAgdGhpcy5jb25zdHJhaW50cyA9IFtdOwoKICAgICAgdGhpcy5wcmVTdGVwQ2FsbGJhY2sgPSAoKSA9PiB7fTsKCiAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciA9IDA7CiAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQgPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSB3aGVlbC4gRm9yIGluZm9ybWF0aW9uIGFib3V0IHRoZSBvcHRpb25zLCBzZWUgYFdoZWVsSW5mb2AuCiAgICAgKi8KCgogICAgYWRkV2hlZWwob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBpbmZvID0gbmV3IFdoZWVsSW5mbyhvcHRpb25zKTsKICAgICAgY29uc3QgaW5kZXggPSB0aGlzLndoZWVsSW5mb3MubGVuZ3RoOwogICAgICB0aGlzLndoZWVsSW5mb3MucHVzaChpbmZvKTsKICAgICAgcmV0dXJuIGluZGV4OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHN0ZWVyaW5nIHZhbHVlIG9mIGEgd2hlZWwuCiAgICAgKi8KCgogICAgc2V0U3RlZXJpbmdWYWx1ZSh2YWx1ZSwgd2hlZWxJbmRleCkgewogICAgICBjb25zdCB3aGVlbCA9IHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XTsKICAgICAgd2hlZWwuc3RlZXJpbmcgPSB2YWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSB3aGVlbCBmb3JjZSB0byBhcHBseSBvbiBvbmUgb2YgdGhlIHdoZWVscyBlYWNoIHRpbWUgc3RlcAogICAgICovCgoKICAgIGFwcGx5RW5naW5lRm9yY2UodmFsdWUsIHdoZWVsSW5kZXgpIHsKICAgICAgdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdLmVuZ2luZUZvcmNlID0gdmFsdWU7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgYnJha2luZyBmb3JjZSBvZiBhIHdoZWVsCiAgICAgKi8KCgogICAgc2V0QnJha2UoYnJha2UsIHdoZWVsSW5kZXgpIHsKICAgICAgdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdLmJyYWtlID0gYnJha2U7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCB0aGUgdmVoaWNsZSBpbmNsdWRpbmcgaXRzIGNvbnN0cmFpbnRzIHRvIHRoZSB3b3JsZC4KICAgICAqLwoKCiAgICBhZGRUb1dvcmxkKHdvcmxkKSB7CiAgICAgIHdvcmxkLmFkZEJvZHkodGhpcy5jaGFzc2lzQm9keSk7CiAgICAgIGNvbnN0IHRoYXQgPSB0aGlzOwoKICAgICAgdGhpcy5wcmVTdGVwQ2FsbGJhY2sgPSAoKSA9PiB7CiAgICAgICAgdGhhdC51cGRhdGVWZWhpY2xlKHdvcmxkLmR0KTsKICAgICAgfTsKCiAgICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCB0aGlzLnByZVN0ZXBDYWxsYmFjayk7CiAgICAgIHRoaXMud29ybGQgPSB3b3JsZDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IG9uZSBvZiB0aGUgd2hlZWwgYXhsZXMsIHdvcmxkLW9yaWVudGVkLgogICAgICovCgoKICAgIGdldFZlaGljbGVBeGlzV29ybGQoYXhpc0luZGV4LCByZXN1bHQpIHsKICAgICAgcmVzdWx0LnNldChheGlzSW5kZXggPT09IDAgPyAxIDogMCwgYXhpc0luZGV4ID09PSAxID8gMSA6IDAsIGF4aXNJbmRleCA9PT0gMiA/IDEgOiAwKTsKICAgICAgdGhpcy5jaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUocmVzdWx0LCByZXN1bHQpOwogICAgfQoKICAgIHVwZGF0ZVZlaGljbGUodGltZVN0ZXApIHsKICAgICAgY29uc3Qgd2hlZWxJbmZvcyA9IHRoaXMud2hlZWxJbmZvczsKICAgICAgY29uc3QgbnVtV2hlZWxzID0gd2hlZWxJbmZvcy5sZW5ndGg7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtKGkpOwogICAgICB9CgogICAgICB0aGlzLmN1cnJlbnRWZWhpY2xlU3BlZWRLbUhvdXIgPSAzLjYgKiBjaGFzc2lzQm9keS52ZWxvY2l0eS5sZW5ndGgoKTsKICAgICAgY29uc3QgZm9yd2FyZFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5nZXRWZWhpY2xlQXhpc1dvcmxkKHRoaXMuaW5kZXhGb3J3YXJkQXhpcywgZm9yd2FyZFdvcmxkKTsKCiAgICAgIGlmIChmb3J3YXJkV29ybGQuZG90KGNoYXNzaXNCb2R5LnZlbG9jaXR5KSA8IDApIHsKICAgICAgICB0aGlzLmN1cnJlbnRWZWhpY2xlU3BlZWRLbUhvdXIgKj0gLTE7CiAgICAgIH0gLy8gc2ltdWxhdGUgc3VzcGVuc2lvbgoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICB0aGlzLmNhc3RSYXkod2hlZWxJbmZvc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlU3VzcGVuc2lvbih0aW1lU3RlcCk7CiAgICAgIGNvbnN0IGltcHVsc2UgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCByZWxwb3MgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIC8vYXBwbHkgc3VzcGVuc2lvbiBmb3JjZQogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBsZXQgc3VzcGVuc2lvbkZvcmNlID0gd2hlZWwuc3VzcGVuc2lvbkZvcmNlOwoKICAgICAgICBpZiAoc3VzcGVuc2lvbkZvcmNlID4gd2hlZWwubWF4U3VzcGVuc2lvbkZvcmNlKSB7CiAgICAgICAgICBzdXNwZW5zaW9uRm9yY2UgPSB3aGVlbC5tYXhTdXNwZW5zaW9uRm9yY2U7CiAgICAgICAgfQoKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLnNjYWxlKHN1c3BlbnNpb25Gb3JjZSAqIHRpbWVTdGVwLCBpbXB1bHNlKTsKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQudnN1YihjaGFzc2lzQm9keS5wb3NpdGlvbiwgcmVscG9zKTsKICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2UoaW1wdWxzZSwgcmVscG9zKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVGcmljdGlvbih0aW1lU3RlcCk7CiAgICAgIGNvbnN0IGhpdE5vcm1hbFdvcmxkU2NhbGVkV2l0aFByb2ogPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBmd2QgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCB2ZWwgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsgLy9jb25zdCByZWxwb3MgPSBuZXcgVmVjMygpOwogICAgICAgIC8vd2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLnZzdWIoY2hhc3Npc0JvZHkucG9zaXRpb24sIHJlbHBvcyk7CgogICAgICAgIGNoYXNzaXNCb2R5LmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCwgdmVsKTsgLy8gSGFjayB0byBnZXQgdGhlIHJvdGF0aW9uIGluIHRoZSBjb3JyZWN0IGRpcmVjdGlvbgoKICAgICAgICBsZXQgbSA9IDE7CgogICAgICAgIHN3aXRjaCAodGhpcy5pbmRleFVwQXhpcykgewogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICBtID0gLTE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgaWYgKHdoZWVsLmlzSW5Db250YWN0KSB7CiAgICAgICAgICB0aGlzLmdldFZlaGljbGVBeGlzV29ybGQodGhpcy5pbmRleEZvcndhcmRBeGlzLCBmd2QpOwogICAgICAgICAgY29uc3QgcHJvaiA9IGZ3ZC5kb3Qod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLnNjYWxlKHByb2osIGhpdE5vcm1hbFdvcmxkU2NhbGVkV2l0aFByb2opOwogICAgICAgICAgZndkLnZzdWIoaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaiwgZndkKTsKICAgICAgICAgIGNvbnN0IHByb2oyID0gZndkLmRvdCh2ZWwpOwogICAgICAgICAgd2hlZWwuZGVsdGFSb3RhdGlvbiA9IG0gKiBwcm9qMiAqIHRpbWVTdGVwIC8gd2hlZWwucmFkaXVzOwogICAgICAgIH0KCiAgICAgICAgaWYgKCh3aGVlbC5zbGlkaW5nIHx8ICF3aGVlbC5pc0luQ29udGFjdCkgJiYgd2hlZWwuZW5naW5lRm9yY2UgIT09IDAgJiYgd2hlZWwudXNlQ3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCkgewogICAgICAgICAgLy8gQXBwbHkgY3VzdG9tIHJvdGF0aW9uIHdoZW4gYWNjZWxlcmF0aW5nIGFuZCBzbGlkaW5nCiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gKHdoZWVsLmVuZ2luZUZvcmNlID4gMCA/IDEgOiAtMSkgKiB3aGVlbC5jdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkICogdGltZVN0ZXA7CiAgICAgICAgfSAvLyBMb2NrIHdoZWVscwoKCiAgICAgICAgaWYgKE1hdGguYWJzKHdoZWVsLmJyYWtlKSA+IE1hdGguYWJzKHdoZWVsLmVuZ2luZUZvcmNlKSkgewogICAgICAgICAgd2hlZWwuZGVsdGFSb3RhdGlvbiA9IDA7CiAgICAgICAgfQoKICAgICAgICB3aGVlbC5yb3RhdGlvbiArPSB3aGVlbC5kZWx0YVJvdGF0aW9uOyAvLyBVc2UgdGhlIG9sZCB2YWx1ZQoKICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uICo9IDAuOTk7IC8vIGRhbXBpbmcgb2Ygcm90YXRpb24gd2hlbiBub3QgaW4gY29udGFjdAogICAgICB9CiAgICB9CgogICAgdXBkYXRlU3VzcGVuc2lvbihkZWx0YVRpbWUpIHsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwogICAgICBjb25zdCBjaGFzc2lzTWFzcyA9IGNoYXNzaXNCb2R5Lm1hc3M7CiAgICAgIGNvbnN0IHdoZWVsSW5mb3MgPSB0aGlzLndoZWVsSW5mb3M7CiAgICAgIGNvbnN0IG51bVdoZWVscyA9IHdoZWVsSW5mb3MubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgd19pdCA9IDA7IHdfaXQgPCBudW1XaGVlbHM7IHdfaXQrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1t3X2l0XTsKCiAgICAgICAgaWYgKHdoZWVsLmlzSW5Db250YWN0KSB7CiAgICAgICAgICBsZXQgZm9yY2U7IC8vIFNwcmluZwoKICAgICAgICAgIGNvbnN0IHN1c3BfbGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvblJlc3RMZW5ndGg7CiAgICAgICAgICBjb25zdCBjdXJyZW50X2xlbmd0aCA9IHdoZWVsLnN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgICBjb25zdCBsZW5ndGhfZGlmZiA9IHN1c3BfbGVuZ3RoIC0gY3VycmVudF9sZW5ndGg7CiAgICAgICAgICBmb3JjZSA9IHdoZWVsLnN1c3BlbnNpb25TdGlmZm5lc3MgKiBsZW5ndGhfZGlmZiAqIHdoZWVsLmNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbjsgLy8gRGFtcGVyCgogICAgICAgICAgY29uc3QgcHJvamVjdGVkX3JlbF92ZWwgPSB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eTsKICAgICAgICAgIGxldCBzdXNwX2RhbXBpbmc7CgogICAgICAgICAgaWYgKHByb2plY3RlZF9yZWxfdmVsIDwgMCkgewogICAgICAgICAgICBzdXNwX2RhbXBpbmcgPSB3aGVlbC5kYW1waW5nQ29tcHJlc3Npb247CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdXNwX2RhbXBpbmcgPSB3aGVlbC5kYW1waW5nUmVsYXhhdGlvbjsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3JjZSAtPSBzdXNwX2RhbXBpbmcgKiBwcm9qZWN0ZWRfcmVsX3ZlbDsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25Gb3JjZSA9IGZvcmNlICogY2hhc3Npc01hc3M7CgogICAgICAgICAgaWYgKHdoZWVsLnN1c3BlbnNpb25Gb3JjZSA8IDApIHsKICAgICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gMDsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gMDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSB2ZWhpY2xlIGluY2x1ZGluZyBpdHMgY29uc3RyYWludHMgZnJvbSB0aGUgd29ybGQuCiAgICAgKi8KCgogICAgcmVtb3ZlRnJvbVdvcmxkKHdvcmxkKSB7CiAgICAgIHRoaXMuY29uc3RyYWludHM7CiAgICAgIHdvcmxkLnJlbW92ZUJvZHkodGhpcy5jaGFzc2lzQm9keSk7CiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCB0aGlzLnByZVN0ZXBDYWxsYmFjayk7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgfQoKICAgIGNhc3RSYXkod2hlZWwpIHsKICAgICAgY29uc3QgcmF5dmVjdG9yID0gY2FzdFJheV9yYXl2ZWN0b3I7CiAgICAgIGNvbnN0IHRhcmdldCA9IGNhc3RSYXlfdGFyZ2V0OwogICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtV29ybGQod2hlZWwpOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGxldCBkZXB0aCA9IC0xOwogICAgICBjb25zdCByYXlsZW4gPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIHdoZWVsLnJhZGl1czsKICAgICAgd2hlZWwuZGlyZWN0aW9uV29ybGQuc2NhbGUocmF5bGVuLCByYXl2ZWN0b3IpOwogICAgICBjb25zdCBzb3VyY2UgPSB3aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQ7CiAgICAgIHNvdXJjZS52YWRkKHJheXZlY3RvciwgdGFyZ2V0KTsKICAgICAgY29uc3QgcmF5Y2FzdFJlc3VsdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQ7CiAgICAgIHJheWNhc3RSZXN1bHQucmVzZXQoKTsgLy8gVHVybiBvZmYgcmF5IGNvbGxpc2lvbiB3aXRoIHRoZSBjaGFzc2lzIHRlbXBvcmFyaWx5CgogICAgICBjb25zdCBvbGRTdGF0ZSA9IGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlOwogICAgICBjaGFzc2lzQm9keS5jb2xsaXNpb25SZXNwb25zZSA9IGZhbHNlOyAvLyBDYXN0IHJheSBhZ2FpbnN0IHdvcmxkCgogICAgICB0aGlzLndvcmxkLnJheVRlc3Qoc291cmNlLCB0YXJnZXQsIHJheWNhc3RSZXN1bHQpOwogICAgICBjaGFzc2lzQm9keS5jb2xsaXNpb25SZXNwb25zZSA9IG9sZFN0YXRlOwogICAgICBjb25zdCBvYmplY3QgPSByYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuZ3JvdW5kT2JqZWN0ID0gMDsKCiAgICAgIGlmIChvYmplY3QpIHsKICAgICAgICBkZXB0aCA9IHJheWNhc3RSZXN1bHQuZGlzdGFuY2U7CiAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQ7CiAgICAgICAgd2hlZWwuaXNJbkNvbnRhY3QgPSB0cnVlOwogICAgICAgIGNvbnN0IGhpdERpc3RhbmNlID0gcmF5Y2FzdFJlc3VsdC5kaXN0YW5jZTsKICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gaGl0RGlzdGFuY2UgLSB3aGVlbC5yYWRpdXM7IC8vIGNsYW1wIG9uIG1heCBzdXNwZW5zaW9uIHRyYXZlbAoKICAgICAgICBjb25zdCBtaW5TdXNwZW5zaW9uTGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvblJlc3RMZW5ndGggLSB3aGVlbC5tYXhTdXNwZW5zaW9uVHJhdmVsOwogICAgICAgIGNvbnN0IG1heFN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIHdoZWVsLm1heFN1c3BlbnNpb25UcmF2ZWw7CgogICAgICAgIGlmICh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoIDwgbWluU3VzcGVuc2lvbkxlbmd0aCkgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA9IG1pblN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA+IG1heFN1c3BlbnNpb25MZW5ndGgpIHsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSBtYXhTdXNwZW5zaW9uTGVuZ3RoOwogICAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5yZXNldCgpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgZGVub21pbmF0b3IgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLmRvdCh3aGVlbC5kaXJlY3Rpb25Xb3JsZCk7CiAgICAgICAgY29uc3QgY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQgPSBuZXcgVmVjMygpOwogICAgICAgIGNoYXNzaXNCb2R5LmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQpOwogICAgICAgIGNvbnN0IHByb2pWZWwgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLmRvdChjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCk7CgogICAgICAgIGlmIChkZW5vbWluYXRvciA+PSAtMC4xKSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IDA7CiAgICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxIC8gMC4xOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBpbnYgPSAtMSAvIGRlbm9taW5hdG9yOwogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSBwcm9qVmVsICogaW52OwogICAgICAgICAgd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gaW52OwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvL3B1dCB3aGVlbCBpbmZvIGFzIGluIHJlc3QgcG9zaXRpb24KICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvblJlc3RMZW5ndGggKyAwICogd2hlZWwubWF4U3VzcGVuc2lvblRyYXZlbDsKICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IDAuMDsKICAgICAgICB3aGVlbC5kaXJlY3Rpb25Xb3JsZC5zY2FsZSgtMSwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gMS4wOwogICAgICB9CgogICAgICByZXR1cm4gZGVwdGg7CiAgICB9CgogICAgdXBkYXRlV2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbCkgewogICAgICB3aGVlbC5pc0luQ29udGFjdCA9IGZhbHNlOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNoYXNzaXNCb2R5LnBvaW50VG9Xb3JsZEZyYW1lKHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCwgd2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkKTsKICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHdoZWVsLmRpcmVjdGlvbkxvY2FsLCB3aGVlbC5kaXJlY3Rpb25Xb3JsZCk7CiAgICAgIGNoYXNzaXNCb2R5LnZlY3RvclRvV29ybGRGcmFtZSh3aGVlbC5heGxlTG9jYWwsIHdoZWVsLmF4bGVXb3JsZCk7CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSBvbmUgb2YgdGhlIHdoZWVsIHRyYW5zZm9ybS4KICAgICAqIE5vdGUgd2hlbiByZW5kZXJpbmcgd2hlZWxzOiBkdXJpbmcgZWFjaCBzdGVwLCB3aGVlbCB0cmFuc2Zvcm1zIGFyZSB1cGRhdGVkIEJFRk9SRSB0aGUgY2hhc3NpczsgaWUuIHRoZWlyIHBvc2l0aW9uIGJlY29tZXMgaW52YWxpZCBhZnRlciB0aGUgc3RlcC4gVGh1cyB3aGVuIHlvdSByZW5kZXIgd2hlZWxzLCB5b3UgbXVzdCB1cGRhdGUgd2hlZWwgdHJhbnNmb3JtcyBiZWZvcmUgcmVuZGVyaW5nIHRoZW0uIFNlZSByYXljYXN0VmVoaWNsZSBkZW1vIGZvciBhbiBleGFtcGxlLgogICAgICogQHBhcmFtIHdoZWVsSW5kZXggVGhlIHdoZWVsIGluZGV4IHRvIHVwZGF0ZS4KICAgICAqLwoKCiAgICB1cGRhdGVXaGVlbFRyYW5zZm9ybSh3aGVlbEluZGV4KSB7CiAgICAgIGNvbnN0IHVwID0gdG1wVmVjNDsKICAgICAgY29uc3QgcmlnaHQgPSB0bXBWZWM1OwogICAgICBjb25zdCBmd2QgPSB0bXBWZWM2OwogICAgICBjb25zdCB3aGVlbCA9IHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XTsKICAgICAgdGhpcy51cGRhdGVXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsKTsKICAgICAgd2hlZWwuZGlyZWN0aW9uTG9jYWwuc2NhbGUoLTEsIHVwKTsKICAgICAgcmlnaHQuY29weSh3aGVlbC5heGxlTG9jYWwpOwogICAgICB1cC5jcm9zcyhyaWdodCwgZndkKTsKICAgICAgZndkLm5vcm1hbGl6ZSgpOwogICAgICByaWdodC5ub3JtYWxpemUoKTsgLy8gUm90YXRlIGFyb3VuZCBzdGVlcmluZyBvdmVyIHRoZSB3aGVlbEF4bGUKCiAgICAgIGNvbnN0IHN0ZWVyaW5nID0gd2hlZWwuc3RlZXJpbmc7CiAgICAgIGNvbnN0IHN0ZWVyaW5nT3JuID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgc3RlZXJpbmdPcm4uc2V0RnJvbUF4aXNBbmdsZSh1cCwgc3RlZXJpbmcpOwogICAgICBjb25zdCByb3RhdGluZ09ybiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHJvdGF0aW5nT3JuLnNldEZyb21BeGlzQW5nbGUocmlnaHQsIHdoZWVsLnJvdGF0aW9uKTsgLy8gV29ybGQgcm90YXRpb24gb2YgdGhlIHdoZWVsCgogICAgICBjb25zdCBxID0gd2hlZWwud29ybGRUcmFuc2Zvcm0ucXVhdGVybmlvbjsKICAgICAgdGhpcy5jaGFzc2lzQm9keS5xdWF0ZXJuaW9uLm11bHQoc3RlZXJpbmdPcm4sIHEpOwogICAgICBxLm11bHQocm90YXRpbmdPcm4sIHEpOwogICAgICBxLm5vcm1hbGl6ZSgpOyAvLyB3b3JsZCBwb3NpdGlvbiBvZiB0aGUgd2hlZWwKCiAgICAgIGNvbnN0IHAgPSB3aGVlbC53b3JsZFRyYW5zZm9ybS5wb3NpdGlvbjsKICAgICAgcC5jb3B5KHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgcC5zY2FsZSh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoLCBwKTsKICAgICAgcC52YWRkKHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCwgcCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgd29ybGQgdHJhbnNmb3JtIG9mIG9uZSBvZiB0aGUgd2hlZWxzCiAgICAgKi8KCgogICAgZ2V0V2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbEluZGV4KSB7CiAgICAgIHJldHVybiB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0ud29ybGRUcmFuc2Zvcm07CiAgICB9CgogICAgdXBkYXRlRnJpY3Rpb24odGltZVN0ZXApIHsKICAgICAgY29uc3Qgc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qID0gdXBkYXRlRnJpY3Rpb25fc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qOyAvL2NhbGN1bGF0ZSB0aGUgaW1wdWxzZSwgc28gdGhhdCB0aGUgd2hlZWxzIGRvbid0IG1vdmUgc2lkZXdhcmRzCgogICAgICBjb25zdCB3aGVlbEluZm9zID0gdGhpcy53aGVlbEluZm9zOwogICAgICBjb25zdCBudW1XaGVlbHMgPSB3aGVlbEluZm9zLmxlbmd0aDsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwogICAgICBjb25zdCBmb3J3YXJkV1MgPSB1cGRhdGVGcmljdGlvbl9mb3J3YXJkV1M7CiAgICAgIGNvbnN0IGF4bGUgPSB1cGRhdGVGcmljdGlvbl9heGxlOwogICAgICB0aGlzLm51bVdoZWVsc09uR3JvdW5kID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICB0aGlzLm51bVdoZWVsc09uR3JvdW5kKys7CiAgICAgICAgfQoKICAgICAgICB3aGVlbC5zaWRlSW1wdWxzZSA9IDA7CiAgICAgICAgd2hlZWwuZm9yd2FyZEltcHVsc2UgPSAwOwoKICAgICAgICBpZiAoIWZvcndhcmRXU1tpXSkgewogICAgICAgICAgZm9yd2FyZFdTW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CgogICAgICAgIGlmICghYXhsZVtpXSkgewogICAgICAgICAgYXhsZVtpXSA9IG5ldyBWZWMzKCk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGNvbnN0IGdyb3VuZE9iamVjdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuYm9keTsKCiAgICAgICAgaWYgKGdyb3VuZE9iamVjdCkgewogICAgICAgICAgY29uc3QgYXhsZWkgPSBheGxlW2ldOwogICAgICAgICAgY29uc3Qgd2hlZWxUcmFucyA9IHRoaXMuZ2V0V2hlZWxUcmFuc2Zvcm1Xb3JsZChpKTsgLy8gR2V0IHdvcmxkIGF4bGUKCiAgICAgICAgICB3aGVlbFRyYW5zLnZlY3RvclRvV29ybGRGcmFtZShkaXJlY3Rpb25zW3RoaXMuaW5kZXhSaWdodEF4aXNdLCBheGxlaSk7CiAgICAgICAgICBjb25zdCBzdXJmTm9ybWFsV1MgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkOwogICAgICAgICAgY29uc3QgcHJvaiA9IGF4bGVpLmRvdChzdXJmTm9ybWFsV1MpOwogICAgICAgICAgc3VyZk5vcm1hbFdTLnNjYWxlKHByb2osIHN1cmZOb3JtYWxXU19zY2FsZWRfcHJvaik7CiAgICAgICAgICBheGxlaS52c3ViKHN1cmZOb3JtYWxXU19zY2FsZWRfcHJvaiwgYXhsZWkpOwogICAgICAgICAgYXhsZWkubm9ybWFsaXplKCk7CiAgICAgICAgICBzdXJmTm9ybWFsV1MuY3Jvc3MoYXhsZWksIGZvcndhcmRXU1tpXSk7CiAgICAgICAgICBmb3J3YXJkV1NbaV0ubm9ybWFsaXplKCk7CiAgICAgICAgICB3aGVlbC5zaWRlSW1wdWxzZSA9IHJlc29sdmVTaW5nbGVCaWxhdGVyYWwoY2hhc3Npc0JvZHksIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgZ3JvdW5kT2JqZWN0LCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQsIGF4bGVpKTsKICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlICo9IHNpZGVGcmljdGlvblN0aWZmbmVzczI7CiAgICAgICAgfQogICAgICB9CgogICAgICBjb25zdCBzaWRlRmFjdG9yID0gMTsKICAgICAgY29uc3QgZndkRmFjdG9yID0gMC41OwogICAgICB0aGlzLnNsaWRpbmcgPSBmYWxzZTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwogICAgICAgIGxldCByb2xsaW5nRnJpY3Rpb24gPSAwOwogICAgICAgIHdoZWVsLnNsaXBJbmZvID0gMTsKCiAgICAgICAgaWYgKGdyb3VuZE9iamVjdCkgewogICAgICAgICAgY29uc3QgZGVmYXVsdFJvbGxpbmdGcmljdGlvbkltcHVsc2UgPSAwOwogICAgICAgICAgY29uc3QgbWF4SW1wdWxzZSA9IHdoZWVsLmJyYWtlID8gd2hlZWwuYnJha2UgOiBkZWZhdWx0Um9sbGluZ0ZyaWN0aW9uSW1wdWxzZTsgLy8gYnRXaGVlbENvbnRhY3RQb2ludCBjb250YWN0UHQoY2hhc3Npc0JvZHksZ3JvdW5kT2JqZWN0LHdoZWVsSW5mcmF5Y2FzdEluZm8uaGl0UG9pbnRXb3JsZCxmb3J3YXJkV1Nbd2hlZWxdLG1heEltcHVsc2UpOwogICAgICAgICAgLy8gcm9sbGluZ0ZyaWN0aW9uID0gY2FsY1JvbGxpbmdGcmljdGlvbihjb250YWN0UHQpOwoKICAgICAgICAgIHJvbGxpbmdGcmljdGlvbiA9IGNhbGNSb2xsaW5nRnJpY3Rpb24oY2hhc3Npc0JvZHksIGdyb3VuZE9iamVjdCwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBmb3J3YXJkV1NbaV0sIG1heEltcHVsc2UpOwogICAgICAgICAgcm9sbGluZ0ZyaWN0aW9uICs9IHdoZWVsLmVuZ2luZUZvcmNlICogdGltZVN0ZXA7IC8vIHJvbGxpbmdGcmljdGlvbiA9IDA7CgogICAgICAgICAgY29uc3QgZmFjdG9yID0gbWF4SW1wdWxzZSAvIHJvbGxpbmdGcmljdGlvbjsKICAgICAgICAgIHdoZWVsLnNsaXBJbmZvICo9IGZhY3RvcjsKICAgICAgICB9IC8vc3dpdGNoIGJldHdlZW4gYWN0aXZlIHJvbGxpbmcgKHRocm90dGxlKSwgYnJha2luZyBhbmQgbm9uLWFjdGl2ZSByb2xsaW5nIGZyaWN0aW9uIChudGhyb3R0bGUvYnJlYWspCgoKICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSA9IDA7CiAgICAgICAgd2hlZWwuc2tpZEluZm8gPSAxOwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICB3aGVlbC5za2lkSW5mbyA9IDE7CiAgICAgICAgICBjb25zdCBtYXhpbXAgPSB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgKiB0aW1lU3RlcCAqIHdoZWVsLmZyaWN0aW9uU2xpcDsKICAgICAgICAgIGNvbnN0IG1heGltcFNpZGUgPSBtYXhpbXA7CiAgICAgICAgICBjb25zdCBtYXhpbXBTcXVhcmVkID0gbWF4aW1wICogbWF4aW1wU2lkZTsKICAgICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlID0gcm9sbGluZ0ZyaWN0aW9uOyAvL3doZWVsSW5mby5lbmdpbmVGb3JjZSogdGltZVN0ZXA7CgogICAgICAgICAgY29uc3QgeCA9IHdoZWVsLmZvcndhcmRJbXB1bHNlICogZndkRmFjdG9yIC8gd2hlZWwuZm9yd2FyZEFjY2VsZXJhdGlvbjsKICAgICAgICAgIGNvbnN0IHkgPSB3aGVlbC5zaWRlSW1wdWxzZSAqIHNpZGVGYWN0b3IgLyB3aGVlbC5zaWRlQWNjZWxlcmF0aW9uOwogICAgICAgICAgY29uc3QgaW1wdWxzZVNxdWFyZWQgPSB4ICogeCArIHkgKiB5OwogICAgICAgICAgd2hlZWwuc2xpZGluZyA9IGZhbHNlOwoKICAgICAgICAgIGlmIChpbXB1bHNlU3F1YXJlZCA+IG1heGltcFNxdWFyZWQpIHsKICAgICAgICAgICAgdGhpcy5zbGlkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgd2hlZWwuc2xpZGluZyA9IHRydWU7CiAgICAgICAgICAgIGNvbnN0IGZhY3RvciA9IG1heGltcCAvIE1hdGguc3FydChpbXB1bHNlU3F1YXJlZCk7CiAgICAgICAgICAgIHdoZWVsLnNraWRJbmZvICo9IGZhY3RvcjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsaWRpbmcpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CgogICAgICAgICAgaWYgKHdoZWVsLnNpZGVJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICAgIGlmICh3aGVlbC5za2lkSW5mbyA8IDEpIHsKICAgICAgICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSAqPSB3aGVlbC5za2lkSW5mbzsKICAgICAgICAgICAgICB3aGVlbC5zaWRlSW1wdWxzZSAqPSB3aGVlbC5za2lkSW5mbzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBhcHBseSB0aGUgaW1wdWxzZXMKCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGNvbnN0IHJlbF9wb3MgPSBuZXcgVmVjMygpOwogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXNCb2R5LnBvc2l0aW9uLCByZWxfcG9zKTsgLy8gY2Fubm9ucyBhcHBseWltcHVsc2UgaXMgdXNpbmcgd29ybGQgY29vcmQgZm9yIHRoZSBwb3NpdGlvbgogICAgICAgIC8vcmVsX3Bvcy5jb3B5KHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCk7CgogICAgICAgIGlmICh3aGVlbC5mb3J3YXJkSW1wdWxzZSAhPT0gMCkgewogICAgICAgICAgY29uc3QgaW1wdWxzZSA9IG5ldyBWZWMzKCk7CiAgICAgICAgICBmb3J3YXJkV1NbaV0uc2NhbGUod2hlZWwuZm9yd2FyZEltcHVsc2UsIGltcHVsc2UpOwogICAgICAgICAgY2hhc3Npc0JvZHkuYXBwbHlJbXB1bHNlKGltcHVsc2UsIHJlbF9wb3MpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHdoZWVsLnNpZGVJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgICAgICBjb25zdCByZWxfcG9zMiA9IG5ldyBWZWMzKCk7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQudnN1Yihncm91bmRPYmplY3QucG9zaXRpb24sIHJlbF9wb3MyKTsgLy9yZWxfcG9zMi5jb3B5KHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCk7CgogICAgICAgICAgY29uc3Qgc2lkZUltcCA9IG5ldyBWZWMzKCk7CiAgICAgICAgICBheGxlW2ldLnNjYWxlKHdoZWVsLnNpZGVJbXB1bHNlLCBzaWRlSW1wKTsgLy8gU2NhbGUgdGhlIHJlbGF0aXZlIHBvc2l0aW9uIGluIHRoZSB1cCBkaXJlY3Rpb24gd2l0aCByb2xsSW5mbHVlbmNlLgogICAgICAgICAgLy8gSWYgcm9sbEluZmx1ZW5jZSBpcyAxLCB0aGUgaW1wdWxzZSB3aWxsIGJlIGFwcGxpZWQgb24gdGhlIGhpdFBvaW50IChlYXN5IHRvIHJvbGwgb3ZlciksIGlmIGl0IGlzIHplcm8gaXQgd2lsbCBiZSBhcHBsaWVkIGluIHRoZSBzYW1lIHBsYW5lIGFzIHRoZSBjZW50ZXIgb2YgbWFzcyAobm90IGVhc3kgdG8gcm9sbCBvdmVyKS4KCiAgICAgICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb0xvY2FsRnJhbWUocmVsX3BvcywgcmVsX3Bvcyk7CiAgICAgICAgICByZWxfcG9zWyd4eXonW3RoaXMuaW5kZXhVcEF4aXNdXSAqPSB3aGVlbC5yb2xsSW5mbHVlbmNlOwogICAgICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHJlbF9wb3MsIHJlbF9wb3MpOwogICAgICAgICAgY2hhc3Npc0JvZHkuYXBwbHlJbXB1bHNlKHNpZGVJbXAsIHJlbF9wb3MpOyAvL2FwcGx5IGZyaWN0aW9uIGltcHVsc2Ugb24gdGhlIGdyb3VuZAoKICAgICAgICAgIHNpZGVJbXAuc2NhbGUoLTEsIHNpZGVJbXApOwogICAgICAgICAgZ3JvdW5kT2JqZWN0LmFwcGx5SW1wdWxzZShzaWRlSW1wLCByZWxfcG9zMik7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogIH0KCiAgY29uc3QgdG1wVmVjNCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjNSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjNiA9IG5ldyBWZWMzKCk7CiAgbmV3IFJheSgpOwogIGNvbnN0IGNhc3RSYXlfcmF5dmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYXN0UmF5X3RhcmdldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZGlyZWN0aW9ucyA9IFtuZXcgVmVjMygxLCAwLCAwKSwgbmV3IFZlYzMoMCwgMSwgMCksIG5ldyBWZWMzKDAsIDAsIDEpXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSBuZXcgVmVjMygpOwogIGNvbnN0IHVwZGF0ZUZyaWN0aW9uX2F4bGUgPSBbXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9mb3J3YXJkV1MgPSBbXTsKICBjb25zdCBzaWRlRnJpY3Rpb25TdGlmZm5lc3MyID0gMTsKICBjb25zdCBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBjYWxjUm9sbGluZ0ZyaWN0aW9uKGJvZHkwLCBib2R5MSwgZnJpY3Rpb25Qb3NXb3JsZCwgZnJpY3Rpb25EaXJlY3Rpb25Xb3JsZCwgbWF4SW1wdWxzZSkgewogICAgbGV0IGoxID0gMDsKICAgIGNvbnN0IGNvbnRhY3RQb3NXb3JsZCA9IGZyaWN0aW9uUG9zV29ybGQ7IC8vIGNvbnN0IHJlbF9wb3MxID0gbmV3IFZlYzMoKTsKICAgIC8vIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKCiAgICBjb25zdCB2ZWwxID0gY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwxOwogICAgY29uc3QgdmVsMiA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMjsKICAgIGNvbnN0IHZlbCA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsOyAvLyBjb250YWN0UG9zV29ybGQudnN1Yihib2R5MC5wb3NpdGlvbiwgcmVsX3BvczEpOwogICAgLy8gY29udGFjdFBvc1dvcmxkLnZzdWIoYm9keTEucG9zaXRpb24sIHJlbF9wb3MyKTsKCiAgICBib2R5MC5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChjb250YWN0UG9zV29ybGQsIHZlbDEpOwogICAgYm9keTEuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoY29udGFjdFBvc1dvcmxkLCB2ZWwyKTsKICAgIHZlbDEudnN1Yih2ZWwyLCB2ZWwpOwogICAgY29uc3QgdnJlbCA9IGZyaWN0aW9uRGlyZWN0aW9uV29ybGQuZG90KHZlbCk7CiAgICBjb25zdCBkZW5vbTAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yKGJvZHkwLCBmcmljdGlvblBvc1dvcmxkLCBmcmljdGlvbkRpcmVjdGlvbldvcmxkKTsKICAgIGNvbnN0IGRlbm9tMSA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3IoYm9keTEsIGZyaWN0aW9uUG9zV29ybGQsIGZyaWN0aW9uRGlyZWN0aW9uV29ybGQpOwogICAgY29uc3QgcmVsYXhhdGlvbiA9IDE7CiAgICBjb25zdCBqYWNEaWFnQUJJbnYgPSByZWxheGF0aW9uIC8gKGRlbm9tMCArIGRlbm9tMSk7IC8vIGNhbGN1bGF0ZSBqIHRoYXQgbW92ZXMgdXMgdG8gemVybyByZWxhdGl2ZSB2ZWxvY2l0eQoKICAgIGoxID0gLXZyZWwgKiBqYWNEaWFnQUJJbnY7CgogICAgaWYgKG1heEltcHVsc2UgPCBqMSkgewogICAgICBqMSA9IG1heEltcHVsc2U7CiAgICB9CgogICAgaWYgKGoxIDwgLW1heEltcHVsc2UpIHsKICAgICAgajEgPSAtbWF4SW1wdWxzZTsKICAgIH0KCiAgICByZXR1cm4gajE7CiAgfQoKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3ZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcihib2R5LCBwb3MsIG5vcm1hbCkgewogICAgY29uc3QgcjAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwOwogICAgY29uc3QgYzAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwOwogICAgY29uc3QgdmVjID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl92ZWM7CiAgICBjb25zdCBtID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tOwogICAgcG9zLnZzdWIoYm9keS5wb3NpdGlvbiwgcjApOwogICAgcjAuY3Jvc3Mobm9ybWFsLCBjMCk7CiAgICBib2R5LmludkluZXJ0aWFXb3JsZC52bXVsdChjMCwgbSk7CiAgICBtLmNyb3NzKHIwLCB2ZWMpOwogICAgcmV0dXJuIGJvZHkuaW52TWFzcyArIG5vcm1hbC5kb3QodmVjKTsKICB9CgogIGNvbnN0IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwyID0gbmV3IFZlYzMoKTsKICBjb25zdCByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbCA9IG5ldyBWZWMzKCk7IC8vIGJpbGF0ZXJhbCBjb25zdHJhaW50IGJldHdlZW4gdHdvIGR5bmFtaWMgb2JqZWN0cwoKICBmdW5jdGlvbiByZXNvbHZlU2luZ2xlQmlsYXRlcmFsKGJvZHkxLCBwb3MxLCBib2R5MiwgcG9zMiwgbm9ybWFsKSB7CiAgICBjb25zdCBub3JtYWxMZW5TcXIgPSBub3JtYWwubGVuZ3RoU3F1YXJlZCgpOwoKICAgIGlmIChub3JtYWxMZW5TcXIgPiAxLjEpIHsKICAgICAgcmV0dXJuIDA7IC8vIG5vIGltcHVsc2UKICAgIH0gLy8gY29uc3QgcmVsX3BvczEgPSBuZXcgVmVjMygpOwogICAgLy8gY29uc3QgcmVsX3BvczIgPSBuZXcgVmVjMygpOwogICAgLy8gcG9zMS52c3ViKGJvZHkxLnBvc2l0aW9uLCByZWxfcG9zMSk7CiAgICAvLyBwb3MyLnZzdWIoYm9keTIucG9zaXRpb24sIHJlbF9wb3MyKTsKCgogICAgY29uc3QgdmVsMSA9IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMTsKICAgIGNvbnN0IHZlbDIgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDI7CiAgICBjb25zdCB2ZWwgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDsKICAgIGJvZHkxLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHBvczEsIHZlbDEpOwogICAgYm9keTIuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQocG9zMiwgdmVsMik7CiAgICB2ZWwxLnZzdWIodmVsMiwgdmVsKTsKICAgIGNvbnN0IHJlbF92ZWwgPSBub3JtYWwuZG90KHZlbCk7CiAgICBjb25zdCBjb250YWN0RGFtcGluZyA9IDAuMjsKICAgIGNvbnN0IG1hc3NUZXJtID0gMSAvIChib2R5MS5pbnZNYXNzICsgYm9keTIuaW52TWFzcyk7CiAgICBjb25zdCBpbXB1bHNlID0gLWNvbnRhY3REYW1waW5nICogcmVsX3ZlbCAqIG1hc3NUZXJtOwogICAgcmV0dXJuIGltcHVsc2U7CiAgfQogIC8qKgogICAqIFNwaGVyaWNhbCBzaGFwZQogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IHJhZGl1cyA9IDEKICAgKiAgICAgY29uc3Qgc3BoZXJlU2hhcGUgPSBuZXcgQ0FOTk9OLlNwaGVyZShyYWRpdXMpCiAgICogICAgIGNvbnN0IHNwaGVyZUJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogc3BoZXJlU2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShzcGhlcmVCb2R5KQogICAqLwoKCiAgY2xhc3MgU3BoZXJlIGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBUaGUgcmFkaXVzIG9mIHRoZSBzcGhlcmUuCiAgICAgKi8KCiAgICAvKioKICAgICAqCiAgICAgKiBAcGFyYW0gcmFkaXVzIFRoZSByYWRpdXMgb2YgdGhlIHNwaGVyZSwgYSBub24tbmVnYXRpdmUgbnVtYmVyLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihyYWRpdXMpIHsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLlNQSEVSRQogICAgICB9KTsKICAgICAgdGhpcy5yYWRpdXMgPSB2b2lkIDA7CiAgICAgIHRoaXMucmFkaXVzID0gcmFkaXVzICE9PSB1bmRlZmluZWQgPyByYWRpdXMgOiAxLjA7CgogICAgICBpZiAodGhpcy5yYWRpdXMgPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgc3BoZXJlIHJhZGl1cyBjYW5ub3QgYmUgbmVnYXRpdmUuJyk7CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgIH0KICAgIC8qKiBjYWxjdWxhdGVMb2NhbEluZXJ0aWEgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBJID0gMi4wICogbWFzcyAqIHRoaXMucmFkaXVzICogdGhpcy5yYWRpdXMgLyA1LjA7CiAgICAgIHRhcmdldC54ID0gSTsKICAgICAgdGFyZ2V0LnkgPSBJOwogICAgICB0YXJnZXQueiA9IEk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKiogdm9sdW1lICovCgoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuIDQuMCAqIE1hdGguUEkgKiBNYXRoLnBvdyh0aGlzLnJhZGl1cywgMykgLyAzLjA7CiAgICB9CgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSB0aGlzLnJhZGl1czsKICAgIH0KCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICBjb25zdCByID0gdGhpcy5yYWRpdXM7CiAgICAgIGNvbnN0IGF4ZXMgPSBbJ3gnLCAneScsICd6J107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGF4ZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBheCA9IGF4ZXNbaV07CiAgICAgICAgbWluW2F4XSA9IHBvc1theF0gLSByOwogICAgICAgIG1heFtheF0gPSBwb3NbYXhdICsgcjsKICAgICAgfQogICAgfQoKICB9CgogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgbmV3IFZlYzMoKTsgLy8gVGVtcCB2ZWN0b3JzIGZvciBjYWxjdWxhdGlvbgoKICBuZXcgVmVjMygpOyAvLyBSZWxhdGl2ZSB2ZWxvY2l0eQoKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgLyoqCiAgICogQ3lsaW5kZXIgY2xhc3MuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcmFkaXVzVG9wID0gMC41CiAgICogICAgIGNvbnN0IHJhZGl1c0JvdHRvbSA9IDAuNQogICAqICAgICBjb25zdCBoZWlnaHQgPSAyCiAgICogICAgIGNvbnN0IG51bVNlZ21lbnRzID0gMTIKICAgKiAgICAgY29uc3QgY3lsaW5kZXJTaGFwZSA9IG5ldyBDQU5OT04uQ3lsaW5kZXIocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpCiAgICogICAgIGNvbnN0IGN5bGluZGVyQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBjeWxpbmRlclNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoY3lsaW5kZXJCb2R5KQogICAqLwoKICBjbGFzcyBDeWxpbmRlciBleHRlbmRzIENvbnZleFBvbHloZWRyb24gewogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgbnVtYmVyIG9mIHNlZ21lbnRzIHRvIGJ1aWxkIHRoZSBjeWxpbmRlciBvdXQgb2YuICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcmFkaXVzVG9wIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gcmFkaXVzQm90dG9tIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIG51bVNlZ21lbnRzIFRoZSBudW1iZXIgb2Ygc2VnbWVudHMgdG8gYnVpbGQgdGhlIGN5bGluZGVyIG91dCBvZi4KICAgICAqLwogICAgY29uc3RydWN0b3IocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpIHsKICAgICAgaWYgKHJhZGl1c1RvcCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzVG9wID0gMTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzQm90dG9tID0gMTsKICAgICAgfQoKICAgICAgaWYgKGhlaWdodCA9PT0gdm9pZCAwKSB7CiAgICAgICAgaGVpZ2h0ID0gMTsKICAgICAgfQoKICAgICAgaWYgKG51bVNlZ21lbnRzID09PSB2b2lkIDApIHsKICAgICAgICBudW1TZWdtZW50cyA9IDg7CiAgICAgIH0KCiAgICAgIGlmIChyYWRpdXNUb3AgPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY3lsaW5kZXIgcmFkaXVzVG9wIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBjeWxpbmRlciByYWRpdXNCb3R0b20gY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICBjb25zdCBOID0gbnVtU2VnbWVudHM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGF4ZXMgPSBbXTsKICAgICAgY29uc3QgZmFjZXMgPSBbXTsKICAgICAgY29uc3QgYm90dG9tZmFjZSA9IFtdOwogICAgICBjb25zdCB0b3BmYWNlID0gW107CiAgICAgIGNvbnN0IGNvcyA9IE1hdGguY29zOwogICAgICBjb25zdCBzaW4gPSBNYXRoLnNpbjsgLy8gRmlyc3QgYm90dG9tIHBvaW50CgogICAgICB2ZXJ0aWNlcy5wdXNoKG5ldyBWZWMzKC1yYWRpdXNCb3R0b20gKiBzaW4oMCksIC1oZWlnaHQgKiAwLjUsIHJhZGl1c0JvdHRvbSAqIGNvcygwKSkpOwogICAgICBib3R0b21mYWNlLnB1c2goMCk7IC8vIEZpcnN0IHRvcCBwb2ludAoKICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzVG9wICogc2luKDApLCBoZWlnaHQgKiAwLjUsIHJhZGl1c1RvcCAqIGNvcygwKSkpOwogICAgICB0b3BmYWNlLnB1c2goMSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHRoZXRhID0gMiAqIE1hdGguUEkgLyBOICogKGkgKyAxKTsKICAgICAgICBjb25zdCB0aGV0YU4gPSAyICogTWF0aC5QSSAvIE4gKiAoaSArIDAuNSk7CgogICAgICAgIGlmIChpIDwgTiAtIDEpIHsKICAgICAgICAgIC8vIEJvdHRvbQogICAgICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzQm90dG9tICogc2luKHRoZXRhKSwgLWhlaWdodCAqIDAuNSwgcmFkaXVzQm90dG9tICogY29zKHRoZXRhKSkpOwogICAgICAgICAgYm90dG9tZmFjZS5wdXNoKDIgKiBpICsgMik7IC8vIFRvcAoKICAgICAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c1RvcCAqIHNpbih0aGV0YSksIGhlaWdodCAqIDAuNSwgcmFkaXVzVG9wICogY29zKHRoZXRhKSkpOwogICAgICAgICAgdG9wZmFjZS5wdXNoKDIgKiBpICsgMyk7IC8vIEZhY2UKCiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAyICogaSArIDMsIDIgKiBpICsgMl0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAxLCAwXSk7IC8vIENvbm5lY3QKICAgICAgICB9IC8vIEF4aXM6IHdlIGNhbiBjdXQgb2ZmIGhhbGYgb2YgdGhlbSBpZiB3ZSBoYXZlIGV2ZW4gbnVtYmVyIG9mIHNlZ21lbnRzCgoKICAgICAgICBpZiAoTiAlIDIgPT09IDEgfHwgaSA8IE4gLyAyKSB7CiAgICAgICAgICBheGVzLnB1c2gobmV3IFZlYzMoLXNpbih0aGV0YU4pLCAwLCBjb3ModGhldGFOKSkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZmFjZXMucHVzaChib3R0b21mYWNlKTsKICAgICAgYXhlcy5wdXNoKG5ldyBWZWMzKDAsIDEsIDApKTsgLy8gUmVvcmRlciB0b3AgZmFjZQoKICAgICAgY29uc3QgdGVtcCA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3BmYWNlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGVtcC5wdXNoKHRvcGZhY2VbdG9wZmFjZS5sZW5ndGggLSBpIC0gMV0pOwogICAgICB9CgogICAgICBmYWNlcy5wdXNoKHRlbXApOwogICAgICBzdXBlcih7CiAgICAgICAgdmVydGljZXMsCiAgICAgICAgZmFjZXMsCiAgICAgICAgYXhlcwogICAgICB9KTsKICAgICAgdGhpcy5yYWRpdXNUb3AgPSB2b2lkIDA7CiAgICAgIHRoaXMucmFkaXVzQm90dG9tID0gdm9pZCAwOwogICAgICB0aGlzLmhlaWdodCA9IHZvaWQgMDsKICAgICAgdGhpcy5udW1TZWdtZW50cyA9IHZvaWQgMDsKICAgICAgdGhpcy50eXBlID0gU2hhcGUudHlwZXMuQ1lMSU5ERVI7CiAgICAgIHRoaXMucmFkaXVzVG9wID0gcmFkaXVzVG9wOwogICAgICB0aGlzLnJhZGl1c0JvdHRvbSA9IHJhZGl1c0JvdHRvbTsKICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgIHRoaXMubnVtU2VnbWVudHMgPSBudW1TZWdtZW50czsKICAgIH0KCiAgfQogIC8qKgogICAqIFBhcnRpY2xlIHNoYXBlLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IHBhcnRpY2xlU2hhcGUgPSBuZXcgQ0FOTk9OLlBhcnRpY2xlKCkKICAgKiAgICAgY29uc3QgcGFydGljbGVCb2R5ID0gbmV3IENBTk5PTi5Cb2R5KHsgbWFzczogMSwgc2hhcGU6IHBhcnRpY2xlU2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShwYXJ0aWNsZUJvZHkpCiAgICovCgoKICBjbGFzcyBQYXJ0aWNsZSBleHRlbmRzIFNoYXBlIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuUEFSVElDTEUKICAgICAgfSk7CiAgICB9CiAgICAvKioKICAgICAqIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYQogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNldCgwLCAwLCAwKTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiAwOwogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gMDsKICAgIH0KCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvLyBHZXQgZWFjaCBheGlzIG1heAogICAgICBtaW4uY29weShwb3MpOwogICAgICBtYXguY29weShwb3MpOwogICAgfQoKICB9CiAgLyoqCiAgICogQSBwbGFuZSwgZmFjaW5nIGluIHRoZSBaIGRpcmVjdGlvbi4gVGhlIHBsYW5lIGhhcyBpdHMgc3VyZmFjZSBhdCB6PTAgYW5kIGV2ZXJ5dGhpbmcgYmVsb3cgej0wIGlzIGFzc3VtZWQgdG8gYmUgc29saWQgcGxhbmUuIFRvIG1ha2UgdGhlIHBsYW5lIGZhY2UgaW4gc29tZSBvdGhlciBkaXJlY3Rpb24gdGhhbiB6LCB5b3UgbXVzdCBwdXQgaXQgaW5zaWRlIGEgQm9keSBhbmQgcm90YXRlIHRoYXQgYm9keS4gU2VlIHRoZSBkZW1vcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwbGFuZVNoYXBlID0gbmV3IENBTk5PTi5QbGFuZSgpCiAgICogICAgIGNvbnN0IHBsYW5lQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDAsIHNoYXBlOiAgcGxhbmVTaGFwZSB9KQogICAqICAgICBwbGFuZUJvZHkucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIoLU1hdGguUEkgLyAyLCAwLCAwKSAvLyBtYWtlIGl0IGZhY2UgdXAKICAgKiAgICAgd29ybGQuYWRkQm9keShwbGFuZUJvZHkpCiAgICovCgoKICBjbGFzcyBQbGFuZSBleHRlbmRzIFNoYXBlIHsKICAgIC8qKiB3b3JsZE5vcm1hbCAqLwoKICAgIC8qKiB3b3JsZE5vcm1hbE5lZWRzVXBkYXRlICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLlBMQU5FCiAgICAgIH0pOyAvLyBXb3JsZCBvcmllbnRlZCBub3JtYWwKCiAgICAgIHRoaXMud29ybGROb3JtYWwgPSB2b2lkIDA7CiAgICAgIHRoaXMud29ybGROb3JtYWxOZWVkc1VwZGF0ZSA9IHZvaWQgMDsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IHZvaWQgMDsKICAgICAgdGhpcy53b3JsZE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMud29ybGROb3JtYWxOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBOdW1iZXIuTUFYX1ZBTFVFOwogICAgfQogICAgLyoqIGNvbXB1dGVXb3JsZE5vcm1hbCAqLwoKCiAgICBjb21wdXRlV29ybGROb3JtYWwocXVhdCkgewogICAgICBjb25zdCBuID0gdGhpcy53b3JsZE5vcm1hbDsKICAgICAgbi5zZXQoMCwgMCwgMSk7CiAgICAgIHF1YXQudm11bHQobiwgbik7CiAgICAgIHRoaXMud29ybGROb3JtYWxOZWVkc1VwZGF0ZSA9IGZhbHNlOwogICAgfQoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiAoLy8gVGhlIHBsYW5lIGlzIGluZmluaXRlLi4uCiAgICAgICAgTnVtYmVyLk1BWF9WQUxVRQogICAgICApOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIC8vIFRoZSBwbGFuZSBBQUJCIGlzIGluZmluaXRlLCBleGNlcHQgaWYgdGhlIG5vcm1hbCBpcyBwb2ludGluZyBhbG9uZyBhbnkgYXhpcwogICAgICB0ZW1wTm9ybWFsLnNldCgwLCAwLCAxKTsgLy8gRGVmYXVsdCBwbGFuZSBub3JtYWwgaXMgegoKICAgICAgcXVhdC52bXVsdCh0ZW1wTm9ybWFsLCB0ZW1wTm9ybWFsKTsKICAgICAgY29uc3QgbWF4VmFsID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgbWluLnNldCgtbWF4VmFsLCAtbWF4VmFsLCAtbWF4VmFsKTsKICAgICAgbWF4LnNldChtYXhWYWwsIG1heFZhbCwgbWF4VmFsKTsKCiAgICAgIGlmICh0ZW1wTm9ybWFsLnggPT09IDEpIHsKICAgICAgICBtYXgueCA9IHBvcy54OwogICAgICB9IGVsc2UgaWYgKHRlbXBOb3JtYWwueCA9PT0gLTEpIHsKICAgICAgICBtaW4ueCA9IHBvcy54OwogICAgICB9CgogICAgICBpZiAodGVtcE5vcm1hbC55ID09PSAxKSB7CiAgICAgICAgbWF4LnkgPSBwb3MueTsKICAgICAgfSBlbHNlIGlmICh0ZW1wTm9ybWFsLnkgPT09IC0xKSB7CiAgICAgICAgbWluLnkgPSBwb3MueTsKICAgICAgfQoKICAgICAgaWYgKHRlbXBOb3JtYWwueiA9PT0gMSkgewogICAgICAgIG1heC56ID0gcG9zLno7CiAgICAgIH0gZWxzZSBpZiAodGVtcE5vcm1hbC56ID09PSAtMSkgewogICAgICAgIG1pbi56ID0gcG9zLno7CiAgICAgIH0KICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE51bWJlci5NQVhfVkFMVUU7CiAgICB9CgogIH0KCiAgY29uc3QgdGVtcE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgLyoqCiAgICogSGVpZ2h0ZmllbGQgc2hhcGUgY2xhc3MuIEhlaWdodCBkYXRhIGlzIGdpdmVuIGFzIGFuIGFycmF5LiBUaGVzZSBkYXRhIHBvaW50cyBhcmUgc3ByZWFkIG91dCBldmVubHkgd2l0aCBhIGdpdmVuIGRpc3RhbmNlLgogICAqIEB0b2RvIFNob3VsZCBiZSBwb3NzaWJsZSB0byB1c2UgYWxvbmcgYWxsIGF4ZXMsIG5vdCBqdXN0IHkKICAgKiBAdG9kbyBzaG91bGQgYmUgcG9zc2libGUgdG8gc2NhbGUgYWxvbmcgYWxsIGF4ZXMKICAgKiBAdG9kbyBSZWZhY3RvciBlbGVtZW50U2l6ZSB0byBlbGVtZW50U2l6ZVggYW5kIGVsZW1lbnRTaXplWQogICAqCiAgICogQGV4YW1wbGUKICAgKiAgICAgLy8gR2VuZXJhdGUgc29tZSBoZWlnaHQgZGF0YSAoeS12YWx1ZXMpLgogICAqICAgICBjb25zdCBkYXRhID0gW10KICAgKiAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDAwOyBpKyspIHsKICAgKiAgICAgICAgIGNvbnN0IHkgPSAwLjUgKiBNYXRoLmNvcygwLjIgKiBpKQogICAqICAgICAgICAgZGF0YS5wdXNoKHkpCiAgICogICAgIH0KICAgKgogICAqICAgICAvLyBDcmVhdGUgdGhlIGhlaWdodGZpZWxkIHNoYXBlCiAgICogICAgIGNvbnN0IGhlaWdodGZpZWxkU2hhcGUgPSBuZXcgQ0FOTk9OLkhlaWdodGZpZWxkKGRhdGEsIHsKICAgKiAgICAgICAgIGVsZW1lbnRTaXplOiAxIC8vIERpc3RhbmNlIGJldHdlZW4gdGhlIGRhdGEgcG9pbnRzIGluIFggYW5kIFkgZGlyZWN0aW9ucwogICAqICAgICB9KQogICAqICAgICBjb25zdCBoZWlnaHRmaWVsZEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBzaGFwZTogaGVpZ2h0ZmllbGRTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGhlaWdodGZpZWxkQm9keSkKICAgKi8KCiAgY2xhc3MgSGVpZ2h0ZmllbGQgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIEFuIGFycmF5IG9mIG51bWJlcnMsIG9yIGhlaWdodCB2YWx1ZXMsIHRoYXQgYXJlIHNwcmVhZCBvdXQgYWxvbmcgdGhlIHggYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogTWF4IHZhbHVlIG9mIHRoZSBkYXRhIHBvaW50cyBpbiB0aGUgZGF0YSBhcnJheS4KICAgICAqLwoKICAgIC8qKgogICAgICogTWluaW11bSB2YWx1ZSBvZiB0aGUgZGF0YSBwb2ludHMgaW4gdGhlIGRhdGEgYXJyYXkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkIHNwYWNpbmcgYmV0d2VlbiB0aGUgZGF0YSBwb2ludHMgaW4gWCBhbmQgWSBkaXJlY3Rpb24uCiAgICAgKiBAdG9kbyBlbGVtZW50U2l6ZVggYW5kIFkKICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogQGRlZmF1bHQgdHJ1ZQogICAgICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gZGF0YSBBbiBhcnJheSBvZiBudW1iZXJzLCBvciBoZWlnaHQgdmFsdWVzLCB0aGF0IGFyZSBzcHJlYWQgb3V0IGFsb25nIHRoZSB4IGF4aXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGRhdGEsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgb3B0aW9ucyA9IFV0aWxzLmRlZmF1bHRzKG9wdGlvbnMsIHsKICAgICAgICBtYXhWYWx1ZTogbnVsbCwKICAgICAgICBtaW5WYWx1ZTogbnVsbCwKICAgICAgICBlbGVtZW50U2l6ZTogMQogICAgICB9KTsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxECiAgICAgIH0pOwogICAgICB0aGlzLmRhdGEgPSB2b2lkIDA7CiAgICAgIHRoaXMubWF4VmFsdWUgPSB2b2lkIDA7CiAgICAgIHRoaXMubWluVmFsdWUgPSB2b2lkIDA7CiAgICAgIHRoaXMuZWxlbWVudFNpemUgPSB2b2lkIDA7CiAgICAgIHRoaXMuY2FjaGVFbmFibGVkID0gdm9pZCAwOwogICAgICB0aGlzLnBpbGxhckNvbnZleCA9IHZvaWQgMDsKICAgICAgdGhpcy5waWxsYXJPZmZzZXQgPSB2b2lkIDA7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnMgPSB2b2lkIDA7CiAgICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgICAgIHRoaXMubWF4VmFsdWUgPSBvcHRpb25zLm1heFZhbHVlOwogICAgICB0aGlzLm1pblZhbHVlID0gb3B0aW9ucy5taW5WYWx1ZTsKICAgICAgdGhpcy5lbGVtZW50U2l6ZSA9IG9wdGlvbnMuZWxlbWVudFNpemU7CgogICAgICBpZiAob3B0aW9ucy5taW5WYWx1ZSA9PT0gbnVsbCkgewogICAgICAgIHRoaXMudXBkYXRlTWluVmFsdWUoKTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMubWF4VmFsdWUgPT09IG51bGwpIHsKICAgICAgICB0aGlzLnVwZGF0ZU1heFZhbHVlKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuY2FjaGVFbmFibGVkID0gdHJ1ZTsKICAgICAgdGhpcy5waWxsYXJDb252ZXggPSBuZXcgQ29udmV4UG9seWhlZHJvbigpOwogICAgICB0aGlzLnBpbGxhck9mZnNldCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsgLy8gImlfal9pc1VwcGVyIiA9PiB7IGNvbnZleDogLi4uLCBvZmZzZXQ6IC4uLiB9CiAgICAgIC8vIGZvciBleGFtcGxlOgogICAgICAvLyBfY2FjaGVkUGlsbGFyc1siMF8yXzEiXQoKICAgICAgdGhpcy5fY2FjaGVkUGlsbGFycyA9IHt9OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxsIHdoZW5ldmVyIHlvdSBjaGFuZ2UgdGhlIGRhdGEgYXJyYXkuCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICB0aGlzLl9jYWNoZWRQaWxsYXJzID0ge307CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYG1pblZhbHVlYCBwcm9wZXJ0eQogICAgICovCgoKICAgIHVwZGF0ZU1pblZhbHVlKCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgbWluVmFsdWUgPSBkYXRhWzBdWzBdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IGRhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gZGF0YVtpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgY29uc3QgdiA9IGRhdGFbaV1bal07CgogICAgICAgICAgaWYgKHYgPCBtaW5WYWx1ZSkgewogICAgICAgICAgICBtaW5WYWx1ZSA9IHY7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLm1pblZhbHVlID0gbWluVmFsdWU7CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYG1heFZhbHVlYCBwcm9wZXJ0eQogICAgICovCgoKICAgIHVwZGF0ZU1heFZhbHVlKCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgbWF4VmFsdWUgPSBkYXRhWzBdWzBdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IGRhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gZGF0YVtpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgY29uc3QgdiA9IGRhdGFbaV1bal07CgogICAgICAgICAgaWYgKHYgPiBtYXhWYWx1ZSkgewogICAgICAgICAgICBtYXhWYWx1ZSA9IHY7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLm1heFZhbHVlID0gbWF4VmFsdWU7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgaGVpZ2h0IHZhbHVlIGF0IGFuIGluZGV4LiBEb24ndCBmb3JnZXQgdG8gdXBkYXRlIG1heFZhbHVlIGFuZCBtaW5WYWx1ZSBhZnRlciB5b3UncmUgZG9uZS4KICAgICAqLwoKCiAgICBzZXRIZWlnaHRWYWx1ZUF0SW5kZXgoeGksIHlpLCB2YWx1ZSkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBkYXRhW3hpXVt5aV0gPSB2YWx1ZTsgLy8gSW52YWxpZGF0ZSBjYWNoZQoKICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZmFsc2UpOwoKICAgICAgaWYgKHhpID4gMCkgewogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSAtIDEsIHlpLCB0cnVlKTsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGkgLSAxLCB5aSwgZmFsc2UpOwogICAgICB9CgogICAgICBpZiAoeWkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSAtIDEsIHRydWUpOwogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWkgLSAxLCBmYWxzZSk7CiAgICAgIH0KCiAgICAgIGlmICh5aSA+IDAgJiYgeGkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpIC0gMSwgeWkgLSAxLCB0cnVlKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgbWF4L21pbiBpbiBhIHJlY3RhbmdsZSBpbiB0aGUgbWF0cml4IGRhdGEKICAgICAqIEBwYXJhbSByZXN1bHQgQW4gYXJyYXkgdG8gc3RvcmUgdGhlIHJlc3VsdHMgaW4uCiAgICAgKiBAcmV0dXJuIFRoZSByZXN1bHQgYXJyYXksIGlmIGl0IHdhcyBwYXNzZWQgaW4uIE1pbmltdW0gd2lsbCBiZSBhdCBwb3NpdGlvbiAwIGFuZCBtYXggYXQgMS4KICAgICAqLwoKCiAgICBnZXRSZWN0TWluTWF4KGlNaW5YLCBpTWluWSwgaU1heFgsIGlNYXhZLCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gW107CiAgICAgIH0KCiAgICAgIC8vIEdldCBtYXggYW5kIG1pbiBvZiB0aGUgZGF0YQogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOyAvLyBTZXQgZmlyc3QgdmFsdWUKCiAgICAgIGxldCBtYXggPSB0aGlzLm1pblZhbHVlOwoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDw9IGlNYXhYOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gaU1pblk7IGogPD0gaU1heFk7IGorKykgewogICAgICAgICAgY29uc3QgaGVpZ2h0ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAoaGVpZ2h0ID4gbWF4KSB7CiAgICAgICAgICAgIG1heCA9IGhlaWdodDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJlc3VsdFswXSA9IHRoaXMubWluVmFsdWU7CiAgICAgIHJlc3VsdFsxXSA9IG1heDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBpbmRleCBvZiBhIGxvY2FsIHBvc2l0aW9uIG9uIHRoZSBoZWlnaHRmaWVsZC4gVGhlIGluZGV4ZXMgaW5kaWNhdGUgdGhlIHJlY3RhbmdsZXMsIHNvIGlmIHlvdXIgdGVycmFpbiBpcyBtYWRlIG9mIE4geCBOIGhlaWdodCBkYXRhIHBvaW50cywgeW91IHdpbGwgaGF2ZSByZWN0YW5nbGUgaW5kZXhlcyByYW5naW5nIGZyb20gMCB0byBOLTEuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFR3by1lbGVtZW50IGFycmF5CiAgICAgKiBAcGFyYW0gY2xhbXAgSWYgdGhlIHBvc2l0aW9uIHNob3VsZCBiZSBjbGFtcGVkIHRvIHRoZSBoZWlnaHRmaWVsZCBlZGdlLgogICAgICovCgoKICAgIGdldEluZGV4T2ZQb3NpdGlvbih4LCB5LCByZXN1bHQsIGNsYW1wKSB7CiAgICAgIC8vIEdldCB0aGUgaW5kZXggb2YgdGhlIGRhdGEgcG9pbnRzIHRvIHRlc3QgYWdhaW5zdAogICAgICBjb25zdCB3ID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgbGV0IHhpID0gTWF0aC5mbG9vcih4IC8gdyk7CiAgICAgIGxldCB5aSA9IE1hdGguZmxvb3IoeSAvIHcpOwogICAgICByZXN1bHRbMF0gPSB4aTsKICAgICAgcmVzdWx0WzFdID0geWk7CgogICAgICBpZiAoY2xhbXApIHsKICAgICAgICAvLyBDbGFtcCBpbmRleCB0byBlZGdlcwogICAgICAgIGlmICh4aSA8IDApIHsKICAgICAgICAgIHhpID0gMDsKICAgICAgICB9CgogICAgICAgIGlmICh5aSA8IDApIHsKICAgICAgICAgIHlpID0gMDsKICAgICAgICB9CgogICAgICAgIGlmICh4aSA+PSBkYXRhLmxlbmd0aCAtIDEpIHsKICAgICAgICAgIHhpID0gZGF0YS5sZW5ndGggLSAxOwogICAgICAgIH0KCiAgICAgICAgaWYgKHlpID49IGRhdGFbMF0ubGVuZ3RoIC0gMSkgewogICAgICAgICAgeWkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgICAgfQogICAgICB9IC8vIEJhaWwgb3V0IGlmIHdlIGFyZSBvdXQgb2YgdGhlIHRlcnJhaW4KCgogICAgICBpZiAoeGkgPCAwIHx8IHlpIDwgMCB8fCB4aSA+PSBkYXRhLmxlbmd0aCAtIDEgfHwgeWkgPj0gZGF0YVswXS5sZW5ndGggLSAxKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBnZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYykgewogICAgICBjb25zdCBpZHggPSBnZXRIZWlnaHRBdF9pZHg7CiAgICAgIHRoaXMuZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIGlkeCwgZWRnZUNsYW1wKTsKICAgICAgbGV0IHhpID0gaWR4WzBdOwogICAgICBsZXQgeWkgPSBpZHhbMV07CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CgogICAgICBpZiAoZWRnZUNsYW1wKSB7CiAgICAgICAgeGkgPSBNYXRoLm1pbihkYXRhLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHhpKSk7CiAgICAgICAgeWkgPSBNYXRoLm1pbihkYXRhWzBdLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHlpKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgbG93ZXJEaXN0MiA9ICh4IC8gZWxlbWVudFNpemUgLSB4aSkgKiogMiArICh5IC8gZWxlbWVudFNpemUgLSB5aSkgKiogMjsKICAgICAgY29uc3QgdXBwZXJEaXN0MiA9ICh4IC8gZWxlbWVudFNpemUgLSAoeGkgKyAxKSkgKiogMiArICh5IC8gZWxlbWVudFNpemUgLSAoeWkgKyAxKSkgKiogMjsKICAgICAgY29uc3QgdXBwZXIgPSBsb3dlckRpc3QyID4gdXBwZXJEaXN0MjsKICAgICAgdGhpcy5nZXRUcmlhbmdsZSh4aSwgeWksIHVwcGVyLCBhLCBiLCBjKTsKICAgICAgcmV0dXJuIHVwcGVyOwogICAgfQoKICAgIGdldE5vcm1hbEF0KHgsIHksIGVkZ2VDbGFtcCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IGEgPSBnZXROb3JtYWxBdF9hOwogICAgICBjb25zdCBiID0gZ2V0Tm9ybWFsQXRfYjsKICAgICAgY29uc3QgYyA9IGdldE5vcm1hbEF0X2M7CiAgICAgIGNvbnN0IGUwID0gZ2V0Tm9ybWFsQXRfZTA7CiAgICAgIGNvbnN0IGUxID0gZ2V0Tm9ybWFsQXRfZTE7CiAgICAgIHRoaXMuZ2V0VHJpYW5nbGVBdCh4LCB5LCBlZGdlQ2xhbXAsIGEsIGIsIGMpOwogICAgICBiLnZzdWIoYSwgZTApOwogICAgICBjLnZzdWIoYSwgZTEpOwogICAgICBlMC5jcm9zcyhlMSwgcmVzdWx0KTsKICAgICAgcmVzdWx0Lm5vcm1hbGl6ZSgpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYW4gQUFCQiBvZiBhIHNxdWFyZSBpbiB0aGUgaGVpZ2h0ZmllbGQKICAgICAqIEBwYXJhbSB4aQogICAgICogQHBhcmFtIHlpCiAgICAgKiBAcGFyYW0gcmVzdWx0CiAgICAgKi8KCgogICAgZ2V0QWFiYkF0SW5kZXgoeGksIHlpLCBfcmVmKSB7CiAgICAgIGxldCB7CiAgICAgICAgbG93ZXJCb3VuZCwKICAgICAgICB1cHBlckJvdW5kCiAgICAgIH0gPSBfcmVmOwogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBlbGVtZW50U2l6ZSA9IHRoaXMuZWxlbWVudFNpemU7CiAgICAgIGxvd2VyQm91bmQuc2V0KHhpICogZWxlbWVudFNpemUsIHlpICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpXSk7CiAgICAgIHVwcGVyQm91bmQuc2V0KCh4aSArIDEpICogZWxlbWVudFNpemUsICh5aSArIDEpICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aSArIDFdKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBoZWlnaHQgaW4gdGhlIGhlaWdodGZpZWxkIGF0IGEgZ2l2ZW4gcG9zaXRpb24KICAgICAqLwoKCiAgICBnZXRIZWlnaHRBdCh4LCB5LCBlZGdlQ2xhbXApIHsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgYSA9IGdldEhlaWdodEF0X2E7CiAgICAgIGNvbnN0IGIgPSBnZXRIZWlnaHRBdF9iOwogICAgICBjb25zdCBjID0gZ2V0SGVpZ2h0QXRfYzsKICAgICAgY29uc3QgaWR4ID0gZ2V0SGVpZ2h0QXRfaWR4OwogICAgICB0aGlzLmdldEluZGV4T2ZQb3NpdGlvbih4LCB5LCBpZHgsIGVkZ2VDbGFtcCk7CiAgICAgIGxldCB4aSA9IGlkeFswXTsKICAgICAgbGV0IHlpID0gaWR4WzFdOwoKICAgICAgaWYgKGVkZ2VDbGFtcCkgewogICAgICAgIHhpID0gTWF0aC5taW4oZGF0YS5sZW5ndGggLSAyLCBNYXRoLm1heCgwLCB4aSkpOwogICAgICAgIHlpID0gTWF0aC5taW4oZGF0YVswXS5sZW5ndGggLSAyLCBNYXRoLm1heCgwLCB5aSkpOwogICAgICB9CgogICAgICBjb25zdCB1cHBlciA9IHRoaXMuZ2V0VHJpYW5nbGVBdCh4LCB5LCBlZGdlQ2xhbXAsIGEsIGIsIGMpOwogICAgICBiYXJ5Y2VudHJpY1dlaWdodHMoeCwgeSwgYS54LCBhLnksIGIueCwgYi55LCBjLngsIGMueSwgZ2V0SGVpZ2h0QXRfd2VpZ2h0cyk7CiAgICAgIGNvbnN0IHcgPSBnZXRIZWlnaHRBdF93ZWlnaHRzOwoKICAgICAgaWYgKHVwcGVyKSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgcmV0dXJuIGRhdGFbeGkgKyAxXVt5aSArIDFdICogdy54ICsgZGF0YVt4aV1beWkgKyAxXSAqIHcueSArIGRhdGFbeGkgKyAxXVt5aV0gKiB3Lno7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgcmV0dXJuIGRhdGFbeGldW3lpXSAqIHcueCArIGRhdGFbeGkgKyAxXVt5aV0gKiB3LnkgKyBkYXRhW3hpXVt5aSArIDFdICogdy56OwogICAgICB9CiAgICB9CgogICAgZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpIHsKICAgICAgcmV0dXJuIHhpICsgIl8iICsgeWkgKyAiXyIgKyAoZ2V0VXBwZXJUcmlhbmdsZSA/IDEgOiAwKTsKICAgIH0KCiAgICBnZXRDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpIHsKICAgICAgcmV0dXJuIHRoaXMuX2NhY2hlZFBpbGxhcnNbdGhpcy5nZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSldOwogICAgfQoKICAgIHNldENhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSwgY29udmV4LCBvZmZzZXQpIHsKICAgICAgdGhpcy5fY2FjaGVkUGlsbGFyc1t0aGlzLmdldENhY2hlQ29udmV4VHJpYW5nbGVQaWxsYXJLZXkoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKV0gPSB7CiAgICAgICAgY29udmV4LAogICAgICAgIG9mZnNldAogICAgICB9OwogICAgfQoKICAgIGNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgIGRlbGV0ZSB0aGlzLl9jYWNoZWRQaWxsYXJzW3RoaXMuZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpXTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgdHJpYW5nbGUgZnJvbSB0aGUgaGVpZ2h0ZmllbGQKICAgICAqLwoKCiAgICBnZXRUcmlhbmdsZSh4aSwgeWksIHVwcGVyLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKCiAgICAgIGlmICh1cHBlcikgewogICAgICAgIC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwogICAgICAgIGEuc2V0KCh4aSArIDEpICogZWxlbWVudFNpemUsICh5aSArIDEpICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aSArIDFdKTsKICAgICAgICBiLnNldCh4aSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdKTsKICAgICAgICBjLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCB5aSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWldKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICBhLnNldCh4aSAqIGVsZW1lbnRTaXplLCB5aSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aV0pOwogICAgICAgIGIuc2V0KCh4aSArIDEpICogZWxlbWVudFNpemUsIHlpICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0pOwogICAgICAgIGMuc2V0KHhpICogZWxlbWVudFNpemUsICh5aSArIDEpICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpICsgMV0pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHRyaWFuZ2xlIGluIHRoZSB0ZXJyYWluIGluIHRoZSBmb3JtIG9mIGEgdHJpYW5ndWxhciBjb252ZXggc2hhcGUuCiAgICAgKi8KCgogICAgZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgIGxldCByZXN1bHQgPSB0aGlzLnBpbGxhckNvbnZleDsKICAgICAgbGV0IG9mZnNldFJlc3VsdCA9IHRoaXMucGlsbGFyT2Zmc2V0OwoKICAgICAgaWYgKHRoaXMuY2FjaGVFbmFibGVkKSB7CiAgICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZ2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKTsKCiAgICAgICAgaWYgKGRhdGEpIHsKICAgICAgICAgIHRoaXMucGlsbGFyQ29udmV4ID0gZGF0YS5jb252ZXg7CiAgICAgICAgICB0aGlzLnBpbGxhck9mZnNldCA9IGRhdGEub2Zmc2V0OwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgcmVzdWx0ID0gbmV3IENvbnZleFBvbHloZWRyb24oKTsKICAgICAgICBvZmZzZXRSZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICAgIHRoaXMucGlsbGFyQ29udmV4ID0gcmVzdWx0OwogICAgICAgIHRoaXMucGlsbGFyT2Zmc2V0ID0gb2Zmc2V0UmVzdWx0OwogICAgICB9CgogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBlbGVtZW50U2l6ZSA9IHRoaXMuZWxlbWVudFNpemU7CiAgICAgIGNvbnN0IGZhY2VzID0gcmVzdWx0LmZhY2VzOyAvLyBSZXVzZSB2ZXJ0cyBpZiBwb3NzaWJsZQoKICAgICAgcmVzdWx0LnZlcnRpY2VzLmxlbmd0aCA9IDY7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDY7IGkrKykgewogICAgICAgIGlmICghcmVzdWx0LnZlcnRpY2VzW2ldKSB7CiAgICAgICAgICByZXN1bHQudmVydGljZXNbaV0gPSBuZXcgVmVjMygpOwogICAgICAgIH0KICAgICAgfSAvLyBSZXVzZSBmYWNlcyBpZiBwb3NzaWJsZQoKCiAgICAgIGZhY2VzLmxlbmd0aCA9IDU7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDU7IGkrKykgewogICAgICAgIGlmICghZmFjZXNbaV0pIHsKICAgICAgICAgIGZhY2VzW2ldID0gW107CiAgICAgICAgfQogICAgICB9CgogICAgICBjb25zdCB2ZXJ0cyA9IHJlc3VsdC52ZXJ0aWNlczsKICAgICAgY29uc3QgaCA9IChNYXRoLm1pbihkYXRhW3hpXVt5aV0sIGRhdGFbeGkgKyAxXVt5aV0sIGRhdGFbeGldW3lpICsgMV0sIGRhdGFbeGkgKyAxXVt5aSArIDFdKSAtIHRoaXMubWluVmFsdWUpIC8gMiArIHRoaXMubWluVmFsdWU7CgogICAgICBpZiAoIWdldFVwcGVyVHJpYW5nbGUpIHsKICAgICAgICAvLyBDZW50ZXIgb2YgdGhlIHRyaWFuZ2xlIHBpbGxhciAtIGFsbCBwb2x5Z29ucyBhcmUgZ2l2ZW4gcmVsYXRpdmUgdG8gdGhpcyBvbmUKICAgICAgICBvZmZzZXRSZXN1bHQuc2V0KCh4aSArIDAuMjUpICogZWxlbWVudFNpemUsIC8vIHNvcnQgb2YgY2VudGVyIG9mIGEgdHJpYW5nbGUKICAgICAgICAoeWkgKyAwLjI1KSAqIGVsZW1lbnRTaXplLCBoIC8vIHZlcnRpY2FsIGNlbnRlcgogICAgICAgICk7IC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1swXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldIC0gaCk7CiAgICAgICAgdmVydHNbMV0uc2V0KDAuNzUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpXSAtIGgpOwogICAgICAgIHZlcnRzWzJdLnNldCgtMC4yNSAqIGVsZW1lbnRTaXplLCAwLjc1ICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpICsgMV0gLSBoKTsgLy8gYm90dG9tIHRyaWFuZ2xlIHZlcnRzCgogICAgICAgIHZlcnRzWzNdLnNldCgtMC4yNSAqIGVsZW1lbnRTaXplLCAtMC4yNSAqIGVsZW1lbnRTaXplLCAtTWF0aC5hYnMoaCkgLSAxKTsKICAgICAgICB2ZXJ0c1s0XS5zZXQoMC43NSAqIGVsZW1lbnRTaXplLCAtMC4yNSAqIGVsZW1lbnRTaXplLCAtTWF0aC5hYnMoaCkgLSAxKTsKICAgICAgICB2ZXJ0c1s1XS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgMC43NSAqIGVsZW1lbnRTaXplLCAtTWF0aC5hYnMoaCkgLSAxKTsgLy8gdG9wIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzBdWzBdID0gMDsKICAgICAgICBmYWNlc1swXVsxXSA9IDE7CiAgICAgICAgZmFjZXNbMF1bMl0gPSAyOyAvLyBib3R0b20gdHJpYW5nbGUKCiAgICAgICAgZmFjZXNbMV1bMF0gPSA1OwogICAgICAgIGZhY2VzWzFdWzFdID0gNDsKICAgICAgICBmYWNlc1sxXVsyXSA9IDM7IC8vIC14IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzJdWzBdID0gMDsKICAgICAgICBmYWNlc1syXVsxXSA9IDI7CiAgICAgICAgZmFjZXNbMl1bMl0gPSA1OwogICAgICAgIGZhY2VzWzJdWzNdID0gMzsgLy8gLXkgZmFjaW5nIHF1YWQKCiAgICAgICAgZmFjZXNbM11bMF0gPSAxOwogICAgICAgIGZhY2VzWzNdWzFdID0gMDsKICAgICAgICBmYWNlc1szXVsyXSA9IDM7CiAgICAgICAgZmFjZXNbM11bM10gPSA0OyAvLyAreHkgZmFjaW5nIHF1YWQKCiAgICAgICAgZmFjZXNbNF1bMF0gPSA0OwogICAgICAgIGZhY2VzWzRdWzFdID0gNTsKICAgICAgICBmYWNlc1s0XVsyXSA9IDI7CiAgICAgICAgZmFjZXNbNF1bM10gPSAxOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIENlbnRlciBvZiB0aGUgdHJpYW5nbGUgcGlsbGFyIC0gYWxsIHBvbHlnb25zIGFyZSBnaXZlbiByZWxhdGl2ZSB0byB0aGlzIG9uZQogICAgICAgIG9mZnNldFJlc3VsdC5zZXQoKHhpICsgMC43NSkgKiBlbGVtZW50U2l6ZSwgLy8gc29ydCBvZiBjZW50ZXIgb2YgYSB0cmlhbmdsZQogICAgICAgICh5aSArIDAuNzUpICogZWxlbWVudFNpemUsIGggLy8gdmVydGljYWwgY2VudGVyCiAgICAgICAgKTsgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCgogICAgICAgIHZlcnRzWzBdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpICsgMV0gLSBoKTsKICAgICAgICB2ZXJ0c1sxXS5zZXQoLTAuNzUgKiBlbGVtZW50U2l6ZSwgMC4yNSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdIC0gaCk7CiAgICAgICAgdmVydHNbMl0uc2V0KDAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuNzUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpXSAtIGgpOyAvLyBib3R0b20gdHJpYW5nbGUgdmVydHMKCiAgICAgICAgdmVydHNbM10uc2V0KDAuMjUgKiBlbGVtZW50U2l6ZSwgMC4yNSAqIGVsZW1lbnRTaXplLCAtTWF0aC5hYnMoaCkgLSAxKTsKICAgICAgICB2ZXJ0c1s0XS5zZXQoLTAuNzUgKiBlbGVtZW50U2l6ZSwgMC4yNSAqIGVsZW1lbnRTaXplLCAtTWF0aC5hYnMoaCkgLSAxKTsKICAgICAgICB2ZXJ0c1s1XS5zZXQoMC4yNSAqIGVsZW1lbnRTaXplLCAtMC43NSAqIGVsZW1lbnRTaXplLCAtTWF0aC5hYnMoaCkgLSAxKTsgLy8gVG9wIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzBdWzBdID0gMDsKICAgICAgICBmYWNlc1swXVsxXSA9IDE7CiAgICAgICAgZmFjZXNbMF1bMl0gPSAyOyAvLyBib3R0b20gdHJpYW5nbGUKCiAgICAgICAgZmFjZXNbMV1bMF0gPSA1OwogICAgICAgIGZhY2VzWzFdWzFdID0gNDsKICAgICAgICBmYWNlc1sxXVsyXSA9IDM7IC8vICt4IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzJdWzBdID0gMjsKICAgICAgICBmYWNlc1syXVsxXSA9IDU7CiAgICAgICAgZmFjZXNbMl1bMl0gPSAzOwogICAgICAgIGZhY2VzWzJdWzNdID0gMDsgLy8gK3kgZmFjaW5nIHF1YWQKCiAgICAgICAgZmFjZXNbM11bMF0gPSAzOwogICAgICAgIGZhY2VzWzNdWzFdID0gNDsKICAgICAgICBmYWNlc1szXVsyXSA9IDE7CiAgICAgICAgZmFjZXNbM11bM10gPSAwOyAvLyAteHkgZmFjaW5nIHF1YWQKCiAgICAgICAgZmFjZXNbNF1bMF0gPSAxOwogICAgICAgIGZhY2VzWzRdWzFdID0gNDsKICAgICAgICBmYWNlc1s0XVsyXSA9IDU7CiAgICAgICAgZmFjZXNbNF1bM10gPSAyOwogICAgICB9CgogICAgICByZXN1bHQuY29tcHV0ZU5vcm1hbHMoKTsKICAgICAgcmVzdWx0LmNvbXB1dGVFZGdlcygpOwogICAgICByZXN1bHQudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgICAgdGhpcy5zZXRDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUsIHJlc3VsdCwgb2Zmc2V0UmVzdWx0KTsKICAgIH0KCiAgICBjYWxjdWxhdGVMb2NhbEluZXJ0aWEobWFzcywgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRhcmdldC5zZXQoMCwgMCwgMCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gKC8vIFRoZSB0ZXJyYWluIGlzIGluZmluaXRlCiAgICAgICAgTnVtYmVyLk1BWF9WQUxVRQogICAgICApOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIC8qKiBAVE9ETyBkbyBpdCBwcm9wZXJseSAqLwogICAgICBtaW4uc2V0KC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSwgLU51bWJlci5NQVhfVkFMVUUpOwogICAgICBtYXguc2V0KE51bWJlci5NQVhfVkFMVUUsIE51bWJlci5NQVhfVkFMVUUsIE51bWJlci5NQVhfVkFMVUUpOwogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICAvLyBVc2UgdGhlIGJvdW5kaW5nIGJveCBvZiB0aGUgbWluL21heCB2YWx1ZXMKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgcyA9IHRoaXMuZWxlbWVudFNpemU7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBuZXcgVmVjMyhkYXRhLmxlbmd0aCAqIHMsIGRhdGFbMF0ubGVuZ3RoICogcywgTWF0aC5tYXgoTWF0aC5hYnModGhpcy5tYXhWYWx1ZSksIE1hdGguYWJzKHRoaXMubWluVmFsdWUpKSkubGVuZ3RoKCk7CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgdGhlIGhlaWdodCB2YWx1ZXMgZnJvbSBhbiBpbWFnZS4gQ3VycmVudGx5IG9ubHkgc3VwcG9ydGVkIGluIGJyb3dzZXIuCiAgICAgKi8KCgogICAgc2V0SGVpZ2h0c0Zyb21JbWFnZShpbWFnZSwgc2NhbGUpIHsKICAgICAgY29uc3QgewogICAgICAgIHgsCiAgICAgICAgeiwKICAgICAgICB5CiAgICAgIH0gPSBzY2FsZTsKICAgICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgIGNhbnZhcy53aWR0aCA9IGltYWdlLndpZHRoOwogICAgICBjYW52YXMuaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0OwogICAgICBjb25zdCBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgICAgIGNvbnRleHQuZHJhd0ltYWdlKGltYWdlLCAwLCAwKTsKICAgICAgY29uc3QgaW1hZ2VEYXRhID0gY29udGV4dC5nZXRJbWFnZURhdGEoMCwgMCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCk7CiAgICAgIGNvbnN0IG1hdHJpeCA9IHRoaXMuZGF0YTsKICAgICAgbWF0cml4Lmxlbmd0aCA9IDA7CiAgICAgIHRoaXMuZWxlbWVudFNpemUgPSBNYXRoLmFicyh4KSAvIGltYWdlRGF0YS53aWR0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW1hZ2VEYXRhLmhlaWdodDsgaSsrKSB7CiAgICAgICAgY29uc3Qgcm93ID0gW107CgogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgaW1hZ2VEYXRhLndpZHRoOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGEgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDRdOwogICAgICAgICAgY29uc3QgYiA9IGltYWdlRGF0YS5kYXRhWyhpICogaW1hZ2VEYXRhLmhlaWdodCArIGopICogNCArIDFdOwogICAgICAgICAgY29uc3QgYyA9IGltYWdlRGF0YS5kYXRhWyhpICogaW1hZ2VEYXRhLmhlaWdodCArIGopICogNCArIDJdOwogICAgICAgICAgY29uc3QgaGVpZ2h0ID0gKGEgKyBiICsgYykgLyA0IC8gMjU1ICogejsKCiAgICAgICAgICBpZiAoeCA8IDApIHsKICAgICAgICAgICAgcm93LnB1c2goaGVpZ2h0KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJvdy51bnNoaWZ0KGhlaWdodCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoeSA8IDApIHsKICAgICAgICAgIG1hdHJpeC51bnNoaWZ0KHJvdyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1hdHJpeC5wdXNoKHJvdyk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZU1heFZhbHVlKCk7CiAgICAgIHRoaXMudXBkYXRlTWluVmFsdWUoKTsKICAgICAgdGhpcy51cGRhdGUoKTsKICAgIH0KCiAgfQoKICBjb25zdCBnZXRIZWlnaHRBdF9pZHggPSBbXTsKICBjb25zdCBnZXRIZWlnaHRBdF93ZWlnaHRzID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9lMCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfZTEgPSBuZXcgVmVjMygpOyAvLyBmcm9tIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0JhcnljZW50cmljX2Nvb3JkaW5hdGVfc3lzdGVtCgogIGZ1bmN0aW9uIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBheCwgYXksIGJ4LCBieSwgY3gsIGN5LCByZXN1bHQpIHsKICAgIHJlc3VsdC54ID0gKChieSAtIGN5KSAqICh4IC0gY3gpICsgKGN4IC0gYngpICogKHkgLSBjeSkpIC8gKChieSAtIGN5KSAqIChheCAtIGN4KSArIChjeCAtIGJ4KSAqIChheSAtIGN5KSk7CiAgICByZXN1bHQueSA9ICgoY3kgLSBheSkgKiAoeCAtIGN4KSArIChheCAtIGN4KSAqICh5IC0gY3kpKSAvICgoYnkgLSBjeSkgKiAoYXggLSBjeCkgKyAoY3ggLSBieCkgKiAoYXkgLSBjeSkpOwogICAgcmVzdWx0LnogPSAxIC0gcmVzdWx0LnggLSByZXN1bHQueTsKICB9CiAgLyoqCiAgICogT2N0cmVlTm9kZQogICAqLwoKCiAgY2xhc3MgT2N0cmVlTm9kZSB7CiAgICAvKiogVGhlIHJvb3Qgbm9kZSAqLwoKICAgIC8qKiBCb3VuZGFyeSBvZiB0aGlzIG5vZGUgKi8KCiAgICAvKiogQ29udGFpbmVkIGRhdGEgYXQgdGhlIGN1cnJlbnQgbm9kZSBsZXZlbCAqLwoKICAgIC8qKiBDaGlsZHJlbiB0byB0aGlzIG5vZGUgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5yb290ID0gdm9pZCAwOwogICAgICB0aGlzLmFhYmIgPSB2b2lkIDA7CiAgICAgIHRoaXMuZGF0YSA9IHZvaWQgMDsKICAgICAgdGhpcy5jaGlsZHJlbiA9IHZvaWQgMDsKICAgICAgdGhpcy5yb290ID0gb3B0aW9ucy5yb290IHx8IG51bGw7CiAgICAgIHRoaXMuYWFiYiA9IG9wdGlvbnMuYWFiYiA/IG9wdGlvbnMuYWFiYi5jbG9uZSgpIDogbmV3IEFBQkIoKTsKICAgICAgdGhpcy5kYXRhID0gW107CiAgICAgIHRoaXMuY2hpbGRyZW4gPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogcmVzZXQKICAgICAqLwoKCiAgICByZXNldCgpIHsKICAgICAgdGhpcy5jaGlsZHJlbi5sZW5ndGggPSB0aGlzLmRhdGEubGVuZ3RoID0gMDsKICAgIH0KICAgIC8qKgogICAgICogSW5zZXJ0IGRhdGEgaW50byB0aGlzIG5vZGUKICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBzdWNjZXNzZnVsLCBvdGhlcndpc2UgZmFsc2UKICAgICAqLwoKCiAgICBpbnNlcnQoYWFiYiwgZWxlbWVudERhdGEsIGxldmVsKSB7CiAgICAgIGlmIChsZXZlbCA9PT0gdm9pZCAwKSB7CiAgICAgICAgbGV2ZWwgPSAwOwogICAgICB9CgogICAgICBjb25zdCBub2RlRGF0YSA9IHRoaXMuZGF0YTsgLy8gSWdub3JlIG9iamVjdHMgdGhhdCBkbyBub3QgYmVsb25nIGluIHRoaXMgbm9kZQoKICAgICAgaWYgKCF0aGlzLmFhYmIuY29udGFpbnMoYWFiYikpIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIG9iamVjdCBjYW5ub3QgYmUgYWRkZWQKICAgICAgfQoKICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwogICAgICBjb25zdCBtYXhEZXB0aCA9IHRoaXMubWF4RGVwdGggfHwgdGhpcy5yb290Lm1heERlcHRoOwoKICAgICAgaWYgKGxldmVsIDwgbWF4RGVwdGgpIHsKICAgICAgICAvLyBTdWJkaXZpZGUgaWYgdGhlcmUgYXJlIG5vIGNoaWxkcmVuIHlldAogICAgICAgIGxldCBzdWJkaXZpZGVkID0gZmFsc2U7CgogICAgICAgIGlmICghY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLnN1YmRpdmlkZSgpOwogICAgICAgICAgc3ViZGl2aWRlZCA9IHRydWU7CiAgICAgICAgfSAvLyBhZGQgdG8gd2hpY2hldmVyIG5vZGUgd2lsbCBhY2NlcHQgaXQKCgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSA4OyBpKyspIHsKICAgICAgICAgIGlmIChjaGlsZHJlbltpXS5pbnNlcnQoYWFiYiwgZWxlbWVudERhdGEsIGxldmVsICsgMSkpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoc3ViZGl2aWRlZCkgewogICAgICAgICAgLy8gTm8gY2hpbGRyZW4gYWNjZXB0ZWQhIE1pZ2h0IGFzIHdlbGwganVzdCByZW1vdmUgZW0gc2luY2UgdGhleSBjb250YWluIG5vbmUKICAgICAgICAgIGNoaWxkcmVuLmxlbmd0aCA9IDA7CiAgICAgICAgfQogICAgICB9IC8vIFRvbyBkZWVwLCBvciBjaGlsZHJlbiBkaWRudCB3YW50IGl0LiBhZGQgaXQgaW4gY3VycmVudCBub2RlCgoKICAgICAgbm9kZURhdGEucHVzaChlbGVtZW50RGF0YSk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBDcmVhdGUgOCBlcXVhbGx5IHNpemVkIGNoaWxkcmVuIG5vZGVzIGFuZCBwdXQgdGhlbSBpbiB0aGUgYGNoaWxkcmVuYCBhcnJheS4KICAgICAqLwoKCiAgICBzdWJkaXZpZGUoKSB7CiAgICAgIGNvbnN0IGFhYmIgPSB0aGlzLmFhYmI7CiAgICAgIGNvbnN0IGwgPSBhYWJiLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSBhYWJiLnVwcGVyQm91bmQ7CiAgICAgIGNvbnN0IGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjsKICAgICAgY2hpbGRyZW4ucHVzaChuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMCwgMCkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDEsIDAsIDApCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAxLCAwKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMSwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDEsIDEpCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygwLCAwLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMCwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDEsIDApCiAgICAgICAgfSkKICAgICAgfSkpOwogICAgICB1LnZzdWIobCwgaGFsZkRpYWdvbmFsKTsKICAgICAgaGFsZkRpYWdvbmFsLnNjYWxlKDAuNSwgaGFsZkRpYWdvbmFsKTsKICAgICAgY29uc3Qgcm9vdCA9IHRoaXMucm9vdCB8fCB0aGlzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNoaWxkID0gY2hpbGRyZW5baV07IC8vIFNldCBjdXJyZW50IG5vZGUgYXMgcm9vdAoKICAgICAgICBjaGlsZC5yb290ID0gcm9vdDsgLy8gQ29tcHV0ZSBib3VuZHMKCiAgICAgICAgY29uc3QgbG93ZXJCb3VuZCA9IGNoaWxkLmFhYmIubG93ZXJCb3VuZDsKICAgICAgICBsb3dlckJvdW5kLnggKj0gaGFsZkRpYWdvbmFsLng7CiAgICAgICAgbG93ZXJCb3VuZC55ICo9IGhhbGZEaWFnb25hbC55OwogICAgICAgIGxvd2VyQm91bmQueiAqPSBoYWxmRGlhZ29uYWwuejsKICAgICAgICBsb3dlckJvdW5kLnZhZGQobCwgbG93ZXJCb3VuZCk7IC8vIFVwcGVyIGJvdW5kIGlzIGFsd2F5cyBsb3dlciBib3VuZCArIGhhbGZEaWFnb25hbAoKICAgICAgICBsb3dlckJvdW5kLnZhZGQoaGFsZkRpYWdvbmFsLCBjaGlsZC5hYWJiLnVwcGVyQm91bmQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbGwgZGF0YSwgcG90ZW50aWFsbHkgd2l0aGluIGFuIEFBQkIKICAgICAqIEByZXR1cm4gVGhlICJyZXN1bHQiIG9iamVjdAogICAgICovCgoKICAgIGFhYmJRdWVyeShhYWJiLCByZXN1bHQpIHsKICAgICAgdGhpcy5kYXRhOyAvLyBhYm9ydCBpZiB0aGUgcmFuZ2UgZG9lcyBub3QgaW50ZXJzZWN0IHRoaXMgbm9kZQogICAgICAvLyBpZiAoIXRoaXMuYWFiYi5vdmVybGFwcyhhYWJiKSl7CiAgICAgIC8vICAgICByZXR1cm4gcmVzdWx0OwogICAgICAvLyB9CiAgICAgIC8vIEFkZCBvYmplY3RzIGF0IHRoaXMgbGV2ZWwKICAgICAgLy8gQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkocmVzdWx0LCBub2RlRGF0YSk7CiAgICAgIC8vIEFkZCBjaGlsZCBkYXRhCiAgICAgIC8vIEB0b2RvIHVud3JhcCByZWN1cnNpb24gaW50byBhIHF1ZXVlIC8gbG9vcCwgdGhhdCdzIGZhc3RlciBpbiBKUwoKICAgICAgdGhpcy5jaGlsZHJlbjsgLy8gZm9yIChsZXQgaSA9IDAsIE4gPSB0aGlzLmNoaWxkcmVuLmxlbmd0aDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgIC8vICAgICBjaGlsZHJlbltpXS5hYWJiUXVlcnkoYWFiYiwgcmVzdWx0KTsKICAgICAgLy8gfQoKICAgICAgY29uc3QgcXVldWUgPSBbdGhpc107CgogICAgICB3aGlsZSAocXVldWUubGVuZ3RoKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IHF1ZXVlLnBvcCgpOwoKICAgICAgICBpZiAobm9kZS5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShyZXN1bHQsIG5vZGUuZGF0YSk7CiAgICAgICAgfQoKICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShxdWV1ZSwgbm9kZS5jaGlsZHJlbik7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbGwgZGF0YSwgcG90ZW50aWFsbHkgaW50ZXJzZWN0ZWQgYnkgYSByYXkuCiAgICAgKiBAcmV0dXJuIFRoZSAicmVzdWx0IiBvYmplY3QKICAgICAqLwoKCiAgICByYXlRdWVyeShyYXksIHRyZWVUcmFuc2Zvcm0sIHJlc3VsdCkgewogICAgICAvLyBVc2UgYWFiYiBxdWVyeSBmb3Igbm93LgoKICAgICAgLyoqIEB0b2RvIGltcGxlbWVudCByZWFsIHJheSBxdWVyeSB3aGljaCBuZWVkcyBsZXNzIGxvb2t1cHMgKi8KICAgICAgcmF5LmdldEFBQkIodG1wQUFCQik7CiAgICAgIHRtcEFBQkIudG9Mb2NhbEZyYW1lKHRyZWVUcmFuc2Zvcm0sIHRtcEFBQkIpOwogICAgICB0aGlzLmFhYmJRdWVyeSh0bXBBQUJCLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiByZW1vdmVFbXB0eU5vZGVzCiAgICAgKi8KCgogICAgcmVtb3ZlRW1wdHlOb2RlcygpIHsKICAgICAgZm9yIChsZXQgaSA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICB0aGlzLmNoaWxkcmVuW2ldLnJlbW92ZUVtcHR5Tm9kZXMoKTsKCiAgICAgICAgaWYgKCF0aGlzLmNoaWxkcmVuW2ldLmNoaWxkcmVuLmxlbmd0aCAmJiAhdGhpcy5jaGlsZHJlbltpXS5kYXRhLmxlbmd0aCkgewogICAgICAgICAgdGhpcy5jaGlsZHJlbi5zcGxpY2UoaSwgMSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogIH0KICAvKioKICAgKiBPY3RyZWUKICAgKi8KCgogIGNsYXNzIE9jdHJlZSBleHRlbmRzIE9jdHJlZU5vZGUgewogICAgLyoqCiAgICAgKiBNYXhpbXVtIHN1YmRpdmlzaW9uIGRlcHRoCiAgICAgKiBAZGVmYXVsdCA4CiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBhYWJiIFRoZSB0b3RhbCBBQUJCIG9mIHRoZSB0cmVlCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGFhYmIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgc3VwZXIoewogICAgICAgIHJvb3Q6IG51bGwsCiAgICAgICAgYWFiYgogICAgICB9KTsKICAgICAgdGhpcy5tYXhEZXB0aCA9IHZvaWQgMDsKICAgICAgdGhpcy5tYXhEZXB0aCA9IHR5cGVvZiBvcHRpb25zLm1heERlcHRoICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4RGVwdGggOiA4OwogICAgfQoKICB9CgogIGNvbnN0IGhhbGZEaWFnb25hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wQUFCQiA9IG5ldyBBQUJCKCk7CiAgLyoqCiAgICogVHJpbWVzaC4KICAgKiBAZXhhbXBsZQogICAqICAgICAvLyBIb3cgdG8gbWFrZSBhIG1lc2ggd2l0aCBhIHNpbmdsZSB0cmlhbmdsZQogICAqICAgICBjb25zdCB2ZXJ0aWNlcyA9IFsKICAgKiAgICAgICAgIDAsIDAsIDAsIC8vIHZlcnRleCAwCiAgICogICAgICAgICAxLCAwLCAwLCAvLyB2ZXJ0ZXggMQogICAqICAgICAgICAgMCwgMSwgMCAgLy8gdmVydGV4IDIKICAgKiAgICAgXQogICAqICAgICBjb25zdCBpbmRpY2VzID0gWwogICAqICAgICAgICAgMCwgMSwgMiAgLy8gdHJpYW5nbGUgMAogICAqICAgICBdCiAgICogICAgIGNvbnN0IHRyaW1lc2hTaGFwZSA9IG5ldyBDQU5OT04uVHJpbWVzaCh2ZXJ0aWNlcywgaW5kaWNlcykKICAgKi8KCiAgY2xhc3MgVHJpbWVzaCBleHRlbmRzIFNoYXBlIHsKICAgIC8qKgogICAgICogdmVydGljZXMKICAgICAqLwoKICAgIC8qKgogICAgICogQXJyYXkgb2YgaW50ZWdlcnMsIGluZGljYXRpbmcgd2hpY2ggdmVydGljZXMgZWFjaCB0cmlhbmdsZSBjb25zaXN0cyBvZi4gVGhlIGxlbmd0aCBvZiB0aGlzIGFycmF5IGlzIHRodXMgMyB0aW1lcyB0aGUgbnVtYmVyIG9mIHRyaWFuZ2xlcy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIG5vcm1hbHMgZGF0YS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGxvY2FsIEFBQkIgb2YgdGhlIG1lc2guCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlZmVyZW5jZXMgdG8gdmVydGV4IHBhaXJzLCBtYWtpbmcgdXAgYWxsIHVuaXF1ZSBlZGdlcyBpbiB0aGUgdHJpbWVzaC4KICAgICAqLwoKICAgIC8qKgogICAgICogTG9jYWwgc2NhbGluZyBvZiB0aGUgbWVzaC4gVXNlIC5zZXRTY2FsZSgpIHRvIHNldCBpdC4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGluZGV4ZWQgdHJpYW5nbGVzLiBVc2UgLnVwZGF0ZVRyZWUoKSB0byB1cGRhdGUgaXQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKHZlcnRpY2VzLCBpbmRpY2VzKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5UUklNRVNICiAgICAgIH0pOwogICAgICB0aGlzLnZlcnRpY2VzID0gdm9pZCAwOwogICAgICB0aGlzLmluZGljZXMgPSB2b2lkIDA7CiAgICAgIHRoaXMubm9ybWFscyA9IHZvaWQgMDsKICAgICAgdGhpcy5hYWJiID0gdm9pZCAwOwogICAgICB0aGlzLmVkZ2VzID0gdm9pZCAwOwogICAgICB0aGlzLnNjYWxlID0gdm9pZCAwOwogICAgICB0aGlzLnRyZWUgPSB2b2lkIDA7CiAgICAgIHRoaXMudmVydGljZXMgPSBuZXcgRmxvYXQzMkFycmF5KHZlcnRpY2VzKTsKICAgICAgdGhpcy5pbmRpY2VzID0gbmV3IEludDE2QXJyYXkoaW5kaWNlcyk7CiAgICAgIHRoaXMubm9ybWFscyA9IG5ldyBGbG9hdDMyQXJyYXkoaW5kaWNlcy5sZW5ndGgpOwogICAgICB0aGlzLmFhYmIgPSBuZXcgQUFCQigpOwogICAgICB0aGlzLmVkZ2VzID0gbnVsbDsKICAgICAgdGhpcy5zY2FsZSA9IG5ldyBWZWMzKDEsIDEsIDEpOwogICAgICB0aGlzLnRyZWUgPSBuZXcgT2N0cmVlKCk7CiAgICAgIHRoaXMudXBkYXRlRWRnZXMoKTsKICAgICAgdGhpcy51cGRhdGVOb3JtYWxzKCk7CiAgICAgIHRoaXMudXBkYXRlQUFCQigpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgIHRoaXMudXBkYXRlVHJlZSgpOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGVUcmVlCiAgICAgKi8KCgogICAgdXBkYXRlVHJlZSgpIHsKICAgICAgY29uc3QgdHJlZSA9IHRoaXMudHJlZTsKICAgICAgdHJlZS5yZXNldCgpOwogICAgICB0cmVlLmFhYmIuY29weSh0aGlzLmFhYmIpOwogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7IC8vIFRoZSBsb2NhbCBtZXNoIEFBQkIgaXMgc2NhbGVkLCBidXQgdGhlIG9jdHJlZSBBQUJCIHNob3VsZCBiZSB1bnNjYWxlZAoKICAgICAgdHJlZS5hYWJiLmxvd2VyQm91bmQueCAqPSAxIC8gc2NhbGUueDsKICAgICAgdHJlZS5hYWJiLmxvd2VyQm91bmQueSAqPSAxIC8gc2NhbGUueTsKICAgICAgdHJlZS5hYWJiLmxvd2VyQm91bmQueiAqPSAxIC8gc2NhbGUuejsKICAgICAgdHJlZS5hYWJiLnVwcGVyQm91bmQueCAqPSAxIC8gc2NhbGUueDsKICAgICAgdHJlZS5hYWJiLnVwcGVyQm91bmQueSAqPSAxIC8gc2NhbGUueTsKICAgICAgdHJlZS5hYWJiLnVwcGVyQm91bmQueiAqPSAxIC8gc2NhbGUuejsgLy8gSW5zZXJ0IGFsbCB0cmlhbmdsZXMKCiAgICAgIGNvbnN0IHRyaWFuZ2xlQUFCQiA9IG5ldyBBQUJCKCk7CiAgICAgIGNvbnN0IGEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBiID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBvaW50cyA9IFthLCBiLCBjXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgICAgIC8vdGhpcy5nZXRUcmlhbmdsZVZlcnRpY2VzKGksIGEsIGIsIGMpOwogICAgICAgIC8vIEdldCB1bnNjYWxlZCB0cmlhbmdsZSB2ZXJ0cwogICAgICAgIGNvbnN0IGkzID0gaSAqIDM7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpM10sIGEpOwoKICAgICAgICB0aGlzLl9nZXRVbnNjYWxlZFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAxXSwgYik7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDJdLCBjKTsKCiAgICAgICAgdHJpYW5nbGVBQUJCLnNldEZyb21Qb2ludHMocG9pbnRzKTsKICAgICAgICB0cmVlLmluc2VydCh0cmlhbmdsZUFBQkIsIGkpOwogICAgICB9CgogICAgICB0cmVlLnJlbW92ZUVtcHR5Tm9kZXMoKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRyaWFuZ2xlcyBpbiBhIGxvY2FsIEFBQkIgZnJvbSB0aGUgdHJpbWVzaC4KICAgICAqIEBwYXJhbSByZXN1bHQgQW4gYXJyYXkgb2YgaW50ZWdlcnMsIHJlZmVyZW5jaW5nIHRoZSBxdWVyaWVkIHRyaWFuZ2xlcy4KICAgICAqLwoKCiAgICBnZXRUcmlhbmdsZXNJbkFBQkIoYWFiYiwgcmVzdWx0KSB7CiAgICAgIHVuc2NhbGVkQUFCQi5jb3B5KGFhYmIpOyAvLyBTY2FsZSBpdCB0byBsb2NhbAoKICAgICAgY29uc3Qgc2NhbGUgPSB0aGlzLnNjYWxlOwogICAgICBjb25zdCBpc3ggPSBzY2FsZS54OwogICAgICBjb25zdCBpc3kgPSBzY2FsZS55OwogICAgICBjb25zdCBpc3ogPSBzY2FsZS56OwogICAgICBjb25zdCBsID0gdW5zY2FsZWRBQUJCLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB1bnNjYWxlZEFBQkIudXBwZXJCb3VuZDsKICAgICAgbC54IC89IGlzeDsKICAgICAgbC55IC89IGlzeTsKICAgICAgbC56IC89IGlzejsKICAgICAgdS54IC89IGlzeDsKICAgICAgdS55IC89IGlzeTsKICAgICAgdS56IC89IGlzejsKICAgICAgcmV0dXJuIHRoaXMudHJlZS5hYWJiUXVlcnkodW5zY2FsZWRBQUJCLCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRTY2FsZQogICAgICovCgoKICAgIHNldFNjYWxlKHNjYWxlKSB7CiAgICAgIGNvbnN0IHdhc1VuaWZvcm0gPSB0aGlzLnNjYWxlLnggPT09IHRoaXMuc2NhbGUueSAmJiB0aGlzLnNjYWxlLnkgPT09IHRoaXMuc2NhbGUuejsKICAgICAgY29uc3QgaXNVbmlmb3JtID0gc2NhbGUueCA9PT0gc2NhbGUueSAmJiBzY2FsZS55ID09PSBzY2FsZS56OwoKICAgICAgaWYgKCEod2FzVW5pZm9ybSAmJiBpc1VuaWZvcm0pKSB7CiAgICAgICAgLy8gTm9uLXVuaWZvcm0gc2NhbGluZy4gTmVlZCB0byB1cGRhdGUgbm9ybWFscy4KICAgICAgICB0aGlzLnVwZGF0ZU5vcm1hbHMoKTsKICAgICAgfQoKICAgICAgdGhpcy5zY2FsZS5jb3B5KHNjYWxlKTsKICAgICAgdGhpcy51cGRhdGVBQUJCKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuIFdpbGwgc2F2ZSBpbiB0aGUgYC5ub3JtYWxzYCBhcnJheS4KICAgICAqLwoKCiAgICB1cGRhdGVOb3JtYWxzKCkgewogICAgICBjb25zdCBuID0gY29tcHV0ZU5vcm1hbHNfbjsgLy8gR2VuZXJhdGUgbm9ybWFscwoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMubm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuaW5kaWNlc1tpM107CiAgICAgICAgY29uc3QgYiA9IHRoaXMuaW5kaWNlc1tpMyArIDFdOwogICAgICAgIGNvbnN0IGMgPSB0aGlzLmluZGljZXNbaTMgKyAyXTsKICAgICAgICB0aGlzLmdldFZlcnRleChhLCB2YSk7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoYiwgdmIpOwogICAgICAgIHRoaXMuZ2V0VmVydGV4KGMsIHZjKTsKICAgICAgICBUcmltZXNoLmNvbXB1dGVOb3JtYWwodmIsIHZhLCB2Yywgbik7CiAgICAgICAgbm9ybWFsc1tpM10gPSBuLng7CiAgICAgICAgbm9ybWFsc1tpMyArIDFdID0gbi55OwogICAgICAgIG5vcm1hbHNbaTMgKyAyXSA9IG4uejsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGAuZWRnZXNgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlRWRnZXMoKSB7CiAgICAgIGNvbnN0IGVkZ2VzID0ge307CgogICAgICBjb25zdCBhZGQgPSAoYSwgYikgPT4gewogICAgICAgIGNvbnN0IGtleSA9IGEgPCBiID8gYSArICJfIiArIGIgOiBiICsgIl8iICsgYTsKICAgICAgICBlZGdlc1trZXldID0gdHJ1ZTsKICAgICAgfTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuaW5kaWNlc1tpM107CiAgICAgICAgY29uc3QgYiA9IHRoaXMuaW5kaWNlc1tpMyArIDFdOwogICAgICAgIGNvbnN0IGMgPSB0aGlzLmluZGljZXNbaTMgKyAyXTsKICAgICAgICBhZGQoYSwgYik7CiAgICAgICAgYWRkKGIsIGMpOwogICAgICAgIGFkZChjLCBhKTsKICAgICAgfQoKICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGVkZ2VzKTsKICAgICAgdGhpcy5lZGdlcyA9IG5ldyBJbnQxNkFycmF5KGtleXMubGVuZ3RoICogMik7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBpbmRpY2VzID0ga2V5c1tpXS5zcGxpdCgnXycpOwogICAgICAgIHRoaXMuZWRnZXNbMiAqIGldID0gcGFyc2VJbnQoaW5kaWNlc1swXSwgMTApOwogICAgICAgIHRoaXMuZWRnZXNbMiAqIGkgKyAxXSA9IHBhcnNlSW50KGluZGljZXNbMV0sIDEwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYW4gZWRnZSB2ZXJ0ZXgKICAgICAqIEBwYXJhbSBmaXJzdE9yU2Vjb25kIDAgb3IgMSwgZGVwZW5kaW5nIG9uIHdoaWNoIG9uZSBvZiB0aGUgdmVydGljZXMgeW91IG5lZWQuCiAgICAgKiBAcGFyYW0gdmVydGV4U3RvcmUgV2hlcmUgdG8gc3RvcmUgdGhlIHJlc3VsdAogICAgICovCgoKICAgIGdldEVkZ2VWZXJ0ZXgoZWRnZUluZGV4LCBmaXJzdE9yU2Vjb25kLCB2ZXJ0ZXhTdG9yZSkgewogICAgICBjb25zdCB2ZXJ0ZXhJbmRleCA9IHRoaXMuZWRnZXNbZWRnZUluZGV4ICogMiArIChmaXJzdE9yU2Vjb25kID8gMSA6IDApXTsKICAgICAgdGhpcy5nZXRWZXJ0ZXgodmVydGV4SW5kZXgsIHZlcnRleFN0b3JlKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgdmVjdG9yIGFsb25nIGFuIGVkZ2UuCiAgICAgKi8KCgogICAgZ2V0RWRnZVZlY3RvcihlZGdlSW5kZXgsIHZlY3RvclN0b3JlKSB7CiAgICAgIGNvbnN0IHZhID0gZ2V0RWRnZVZlY3Rvcl92YTsKICAgICAgY29uc3QgdmIgPSBnZXRFZGdlVmVjdG9yX3ZiOwogICAgICB0aGlzLmdldEVkZ2VWZXJ0ZXgoZWRnZUluZGV4LCAwLCB2YSk7CiAgICAgIHRoaXMuZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIDEsIHZiKTsKICAgICAgdmIudnN1Yih2YSwgdmVjdG9yU3RvcmUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgZmFjZSBub3JtYWwgZ2l2ZW4gMyB2ZXJ0aWNlcwogICAgICovCgoKICAgIHN0YXRpYyBjb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCkgewogICAgICB2Yi52c3ViKHZhLCBhYik7CiAgICAgIHZjLnZzdWIodmIsIGNiKTsKICAgICAgY2IuY3Jvc3MoYWIsIHRhcmdldCk7CgogICAgICBpZiAoIXRhcmdldC5pc1plcm8oKSkgewogICAgICAgIHRhcmdldC5ub3JtYWxpemUoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdmVydGV4IGkuCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0VmVydGV4KGksIG91dCkgewogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7CgogICAgICB0aGlzLl9nZXRVbnNjYWxlZFZlcnRleChpLCBvdXQpOwoKICAgICAgb3V0LnggKj0gc2NhbGUueDsKICAgICAgb3V0LnkgKj0gc2NhbGUueTsKICAgICAgb3V0LnogKj0gc2NhbGUuejsKICAgICAgcmV0dXJuIG91dDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHJhdyB2ZXJ0ZXggaQogICAgICogQHJldHVybiBUaGUgIm91dCIgdmVjdG9yIG9iamVjdAogICAgICovCgoKICAgIF9nZXRVbnNjYWxlZFZlcnRleChpLCBvdXQpIHsKICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICByZXR1cm4gb3V0LnNldCh2ZXJ0aWNlc1tpM10sIHZlcnRpY2VzW2kzICsgMV0sIHZlcnRpY2VzW2kzICsgMl0pOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB2ZXJ0ZXggZnJvbSB0aGUgdHJpbWVzaCx0cmFuc2Zvcm1lZCBieSB0aGUgZ2l2ZW4gcG9zaXRpb24gYW5kIHF1YXRlcm5pb24uCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0V29ybGRWZXJ0ZXgoaSwgcG9zLCBxdWF0LCBvdXQpIHsKICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgb3V0KTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHBvcywgcXVhdCwgb3V0LCBvdXQpOwogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHRocmVlIHZlcnRpY2VzIGZvciB0cmlhbmdsZSBpLgogICAgICovCgoKICAgIGdldFRyaWFuZ2xlVmVydGljZXMoaSwgYSwgYiwgYykgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTNdLCBhKTsKICAgICAgdGhpcy5nZXRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzICsgMV0sIGIpOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAyXSwgYyk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIG5vcm1hbCBvZiB0cmlhbmdsZSBpLgogICAgICogQHJldHVybiBUaGUgInRhcmdldCIgdmVjdG9yIG9iamVjdAogICAgICovCgoKICAgIGdldE5vcm1hbChpLCB0YXJnZXQpIHsKICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgcmV0dXJuIHRhcmdldC5zZXQodGhpcy5ub3JtYWxzW2kzXSwgdGhpcy5ub3JtYWxzW2kzICsgMV0sIHRoaXMubm9ybWFsc1tpMyArIDJdKTsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBUaGUgInRhcmdldCIgdmVjdG9yIG9iamVjdAogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgLy8gQXBwcm94aW1hdGUgd2l0aCBib3ggaW5lcnRpYQogICAgICAvLyBFeGFjdCBpbmVydGlhIGNhbGN1bGF0aW9uIGlzIG92ZXJraWxsLCBidXQgc2VlIGh0dHA6Ly9nZW9tZXRyaWN0b29scy5jb20vRG9jdW1lbnRhdGlvbi9Qb2x5aGVkcmFsTWFzc1Byb3BlcnRpZXMucGRmIGZvciB0aGUgY29ycmVjdCB3YXkgdG8gZG8gaXQKICAgICAgdGhpcy5jb21wdXRlTG9jYWxBQUJCKGNsaV9hYWJiKTsKICAgICAgY29uc3QgeCA9IGNsaV9hYWJiLnVwcGVyQm91bmQueCAtIGNsaV9hYWJiLmxvd2VyQm91bmQueDsKICAgICAgY29uc3QgeSA9IGNsaV9hYWJiLnVwcGVyQm91bmQueSAtIGNsaV9hYWJiLmxvd2VyQm91bmQueTsKICAgICAgY29uc3QgeiA9IGNsaV9hYWJiLnVwcGVyQm91bmQueiAtIGNsaV9hYWJiLmxvd2VyQm91bmQuejsKICAgICAgcmV0dXJuIHRhcmdldC5zZXQoMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHkgKiAyICogeSArIDIgKiB6ICogMiAqIHopLCAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeCAqIDIgKiB4ICsgMiAqIHogKiAyICogeiksIDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB5ICogMiAqIHkgKyAyICogeCAqIDIgKiB4KSk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIGxvY2FsIEFBQkIgZm9yIHRoZSB0cmltZXNoCiAgICAgKi8KCgogICAgY29tcHV0ZUxvY2FsQUFCQihhYWJiKSB7CiAgICAgIGNvbnN0IGwgPSBhYWJiLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSBhYWJiLnVwcGVyQm91bmQ7CiAgICAgIGNvbnN0IG4gPSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsKICAgICAgdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3QgdiA9IGNvbXB1dGVMb2NhbEFBQkJfd29ybGRWZXJ0OwogICAgICB0aGlzLmdldFZlcnRleCgwLCB2KTsKICAgICAgbC5jb3B5KHYpOwogICAgICB1LmNvcHkodik7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gbjsgaSsrKSB7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgdik7CgogICAgICAgIGlmICh2LnggPCBsLngpIHsKICAgICAgICAgIGwueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IHUueCkgewogICAgICAgICAgdS54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGwueSkgewogICAgICAgICAgbC55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gdS55KSB7CiAgICAgICAgICB1LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgbC56KSB7CiAgICAgICAgICBsLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiB1LnopIHsKICAgICAgICAgIHUueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgLmFhYmJgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlQUFCQigpIHsKICAgICAgdGhpcy5jb21wdXRlTG9jYWxBQUJCKHRoaXMuYWFiYik7CiAgICB9CiAgICAvKioKICAgICAqIFdpbGwgdXBkYXRlIHRoZSBgLmJvdW5kaW5nU3BoZXJlUmFkaXVzYCBwcm9wZXJ0eQogICAgICovCgoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICAvLyBBc3N1bWUgcG9pbnRzIGFyZSBkaXN0cmlidXRlZCB3aXRoIGxvY2FsICgwLDAsMCkgYXMgY2VudGVyCiAgICAgIGxldCBtYXgyID0gMDsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCB2ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOID0gdmVydGljZXMubGVuZ3RoIC8gMzsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgdik7CiAgICAgICAgY29uc3Qgbm9ybTIgPSB2Lmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLyoKICAgICAgICAgIGNvbnN0IG4gPSB0aGlzLnZlcnRpY2VzLmxlbmd0aCAvIDMsCiAgICAgICAgICAgICAgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICAgICAgY29uc3QgbWlueCxtaW55LG1pbnosbWF4eCxtYXh5LG1heHo7CiAgICAgICAgICAgY29uc3QgdiA9IHRlbXBXb3JsZFZlcnRleDsKICAgICAgICAgIGZvcihsZXQgaT0wOyBpPG47IGkrKyl7CiAgICAgICAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgdik7CiAgICAgICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICAgICAgICBwb3MudmFkZCh2LCB2KTsKICAgICAgICAgICAgICBpZiAodi54IDwgbWlueCB8fCBtaW54PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICAgICAgICB9IGVsc2UgaWYodi54ID4gbWF4eCB8fCBtYXh4PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgIGlmICh2LnkgPCBtaW55IHx8IG1pbnk9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtaW55ID0gdi55OwogICAgICAgICAgICAgIH0gZWxzZSBpZih2LnkgPiBtYXh5IHx8IG1heHk9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtYXh5ID0gdi55OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgaWYgKHYueiA8IG1pbnogfHwgbWluej09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1pbnogPSB2Lno7CiAgICAgICAgICAgICAgfSBlbHNlIGlmKHYueiA+IG1heHogfHwgbWF4ej09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1heHogPSB2Lno7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgbWluLnNldChtaW54LG1pbnksbWlueik7CiAgICAgICAgICBtYXguc2V0KG1heHgsbWF4eSxtYXh6KTsKICAgICAgICAgICovCiAgICAgIC8vIEZhc3RlciBhcHByb3hpbWF0aW9uIHVzaW5nIGxvY2FsIEFBQkIKICAgICAgY29uc3QgZnJhbWUgPSBjYWxjdWxhdGVXb3JsZEFBQkJfZnJhbWU7CiAgICAgIGNvbnN0IHJlc3VsdCA9IGNhbGN1bGF0ZVdvcmxkQUFCQl9hYWJiOwogICAgICBmcmFtZS5wb3NpdGlvbiA9IHBvczsKICAgICAgZnJhbWUucXVhdGVybmlvbiA9IHF1YXQ7CiAgICAgIHRoaXMuYWFiYi50b1dvcmxkRnJhbWUoZnJhbWUsIHJlc3VsdCk7CiAgICAgIG1pbi5jb3B5KHJlc3VsdC5sb3dlckJvdW5kKTsKICAgICAgbWF4LmNvcHkocmVzdWx0LnVwcGVyQm91bmQpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYXBwcm94aW1hdGUgdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIENyZWF0ZSBhIFRyaW1lc2ggaW5zdGFuY2UsIHNoYXBlZCBhcyBhIHRvcnVzLgogICAgICovCgoKICAgIHN0YXRpYyBjcmVhdGVUb3J1cyhyYWRpdXMsIHR1YmUsIHJhZGlhbFNlZ21lbnRzLCB0dWJ1bGFyU2VnbWVudHMsIGFyYykgewogICAgICBpZiAocmFkaXVzID09PSB2b2lkIDApIHsKICAgICAgICByYWRpdXMgPSAxOwogICAgICB9CgogICAgICBpZiAodHViZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgdHViZSA9IDAuNTsKICAgICAgfQoKICAgICAgaWYgKHJhZGlhbFNlZ21lbnRzID09PSB2b2lkIDApIHsKICAgICAgICByYWRpYWxTZWdtZW50cyA9IDg7CiAgICAgIH0KCiAgICAgIGlmICh0dWJ1bGFyU2VnbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIHR1YnVsYXJTZWdtZW50cyA9IDY7CiAgICAgIH0KCiAgICAgIGlmIChhcmMgPT09IHZvaWQgMCkgewogICAgICAgIGFyYyA9IE1hdGguUEkgKiAyOwogICAgICB9CgogICAgICBjb25zdCB2ZXJ0aWNlcyA9IFtdOwogICAgICBjb25zdCBpbmRpY2VzID0gW107CgogICAgICBmb3IgKGxldCBqID0gMDsgaiA8PSByYWRpYWxTZWdtZW50czsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHUgPSBpIC8gdHVidWxhclNlZ21lbnRzICogYXJjOwogICAgICAgICAgY29uc3QgdiA9IGogLyByYWRpYWxTZWdtZW50cyAqIE1hdGguUEkgKiAyOwogICAgICAgICAgY29uc3QgeCA9IChyYWRpdXMgKyB0dWJlICogTWF0aC5jb3ModikpICogTWF0aC5jb3ModSk7CiAgICAgICAgICBjb25zdCB5ID0gKHJhZGl1cyArIHR1YmUgKiBNYXRoLmNvcyh2KSkgKiBNYXRoLnNpbih1KTsKICAgICAgICAgIGNvbnN0IHogPSB0dWJlICogTWF0aC5zaW4odik7CiAgICAgICAgICB2ZXJ0aWNlcy5wdXNoKHgsIHksIHopOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZm9yIChsZXQgaiA9IDE7IGogPD0gcmFkaWFsU2VnbWVudHM7IGorKykgewogICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHR1YnVsYXJTZWdtZW50czsgaSsrKSB7CiAgICAgICAgICBjb25zdCBhID0gKHR1YnVsYXJTZWdtZW50cyArIDEpICogaiArIGkgLSAxOwogICAgICAgICAgY29uc3QgYiA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIChqIC0gMSkgKyBpIC0gMTsKICAgICAgICAgIGNvbnN0IGMgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiAoaiAtIDEpICsgaTsKICAgICAgICAgIGNvbnN0IGQgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiBqICsgaTsKICAgICAgICAgIGluZGljZXMucHVzaChhLCBiLCBkKTsKICAgICAgICAgIGluZGljZXMucHVzaChiLCBjLCBkKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBuZXcgVHJpbWVzaCh2ZXJ0aWNlcywgaW5kaWNlcyk7CiAgICB9CgogIH0KCiAgY29uc3QgY29tcHV0ZU5vcm1hbHNfbiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdW5zY2FsZWRBQUJCID0gbmV3IEFBQkIoKTsKICBjb25zdCBnZXRFZGdlVmVjdG9yX3ZhID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRFZGdlVmVjdG9yX3ZiID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYWIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHZhID0gbmV3IFZlYzMoKTsKICBjb25zdCB2YiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdmMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNsaV9hYWJiID0gbmV3IEFBQkIoKTsKICBjb25zdCBjb21wdXRlTG9jYWxBQUJCX3dvcmxkVmVydCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2FsY3VsYXRlV29ybGRBQUJCX2ZyYW1lID0gbmV3IFRyYW5zZm9ybSgpOwogIGNvbnN0IGNhbGN1bGF0ZVdvcmxkQUFCQl9hYWJiID0gbmV3IEFBQkIoKTsKICAvKioKICAgKiBDb25zdHJhaW50IGVxdWF0aW9uIHNvbHZlciBiYXNlIGNsYXNzLgogICAqLwoKICBjbGFzcyBTb2x2ZXIgewogICAgLyoqCiAgICAgKiBBbGwgZXF1YXRpb25zIHRvIGJlIHNvbHZlZAogICAgICovCgogICAgLyoqCiAgICAgKiBAdG9kbyByZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5lcXVhdGlvbnMgPSB2b2lkIDA7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICB9CiAgICAvKioKICAgICAqIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBzdWJjbGFzc2VzIQogICAgICogQHRvZG8gdXNlIGFic3RyYWN0CiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICByZXR1cm4gKC8vIFNob3VsZCByZXR1cm4gdGhlIG51bWJlciBvZiBpdGVyYXRpb25zIGRvbmUhCiAgICAgICAgMAogICAgICApOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICBhZGRFcXVhdGlvbihlcSkgewogICAgICBpZiAoZXEuZW5hYmxlZCAmJiAhZXEuYmkuaXNUcmlnZ2VyICYmICFlcS5iai5pc1RyaWdnZXIpIHsKICAgICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKGVxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICByZW1vdmVFcXVhdGlvbihlcSkgewogICAgICBjb25zdCBlcXMgPSB0aGlzLmVxdWF0aW9uczsKICAgICAgY29uc3QgaSA9IGVxcy5pbmRleE9mKGVxKTsKCiAgICAgIGlmIChpICE9PSAtMSkgewogICAgICAgIGVxcy5zcGxpY2UoaSwgMSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQWRkIGFsbCBlcXVhdGlvbnMKICAgICAqLwoKCiAgICByZW1vdmVBbGxFcXVhdGlvbnMoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICB9CgogIH0KICAvKioKICAgKiBDb25zdHJhaW50IGVxdWF0aW9uIEdhdXNzLVNlaWRlbCBzb2x2ZXIuCiAgICogQHRvZG8gVGhlIHNwb29rIHBhcmFtZXRlcnMgc2hvdWxkIGJlIHNwZWNpZmllZCBmb3IgZWFjaCBjb25zdHJhaW50LCBub3QgZ2xvYmFsbHkuCiAgICogQHNlZSBodHRwczovL3d3dzguY3MudW11LnNlL2t1cnNlci81RFYwNTgvVlQwOS9sZWN0dXJlcy9zcG9va25vdGVzLnBkZgogICAqLwoKCiAgY2xhc3MgR1NTb2x2ZXIgZXh0ZW5kcyBTb2x2ZXIgewogICAgLyoqCiAgICAgKiBUaGUgbnVtYmVyIG9mIHNvbHZlciBpdGVyYXRpb25zIGRldGVybWluZXMgcXVhbGl0eSBvZiB0aGUgY29uc3RyYWludHMgaW4gdGhlIHdvcmxkLgogICAgICogVGhlIG1vcmUgaXRlcmF0aW9ucywgdGhlIG1vcmUgY29ycmVjdCBzaW11bGF0aW9uLiBNb3JlIGl0ZXJhdGlvbnMgbmVlZCBtb3JlIGNvbXB1dGF0aW9ucyB0aG91Z2guIElmIHlvdSBoYXZlIGEgbGFyZ2UgZ3Jhdml0eSBmb3JjZSBpbiB5b3VyIHdvcmxkLCB5b3Ugd2lsbCBuZWVkIG1vcmUgaXRlcmF0aW9ucy4KICAgICAqLwoKICAgIC8qKgogICAgICogV2hlbiB0b2xlcmFuY2UgaXMgcmVhY2hlZCwgdGhlIHN5c3RlbSBpcyBhc3N1bWVkIHRvIGJlIGNvbnZlcmdlZC4KICAgICAqLwoKICAgIC8qKgogICAgICogQHRvZG8gcmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuaXRlcmF0aW9ucyA9IHZvaWQgMDsKICAgICAgdGhpcy50b2xlcmFuY2UgPSB2b2lkIDA7CiAgICAgIHRoaXMuaXRlcmF0aW9ucyA9IDEwOwogICAgICB0aGlzLnRvbGVyYW5jZSA9IDFlLTc7CiAgICB9CiAgICAvKioKICAgICAqIFNvbHZlCiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICBsZXQgaXRlciA9IDA7CiAgICAgIGNvbnN0IG1heEl0ZXIgPSB0aGlzLml0ZXJhdGlvbnM7CiAgICAgIGNvbnN0IHRvbFNxdWFyZWQgPSB0aGlzLnRvbGVyYW5jZSAqIHRoaXMudG9sZXJhbmNlOwogICAgICBjb25zdCBlcXVhdGlvbnMgPSB0aGlzLmVxdWF0aW9uczsKICAgICAgY29uc3QgTmVxID0gZXF1YXRpb25zLmxlbmd0aDsKICAgICAgY29uc3QgYm9kaWVzID0gd29ybGQuYm9kaWVzOwogICAgICBjb25zdCBOYm9kaWVzID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgaCA9IGR0OwogICAgICBsZXQgQjsKICAgICAgbGV0IGludkM7CiAgICAgIGxldCBkZWx0YWxhbWJkYTsKICAgICAgbGV0IGRlbHRhbGFtYmRhVG90OwogICAgICBsZXQgR1dsYW1iZGE7CiAgICAgIGxldCBsYW1iZGFqOyAvLyBVcGRhdGUgc29sdmUgbWFzcwoKICAgICAgaWYgKE5lcSAhPT0gMCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOYm9kaWVzOyBpKyspIHsKICAgICAgICAgIGJvZGllc1tpXS51cGRhdGVTb2x2ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICAgICAgfQogICAgICB9IC8vIFRoaW5ncyB0aGF0IGRvIG5vdCBjaGFuZ2UgZHVyaW5nIGl0ZXJhdGlvbiBjYW4gYmUgY29tcHV0ZWQgb25jZQoKCiAgICAgIGNvbnN0IGludkNzID0gR1NTb2x2ZXJfc29sdmVfaW52Q3M7CiAgICAgIGNvbnN0IEJzID0gR1NTb2x2ZXJfc29sdmVfQnM7CiAgICAgIGNvbnN0IGxhbWJkYSA9IEdTU29sdmVyX3NvbHZlX2xhbWJkYTsKICAgICAgaW52Q3MubGVuZ3RoID0gTmVxOwogICAgICBCcy5sZW5ndGggPSBOZXE7CiAgICAgIGxhbWJkYS5sZW5ndGggPSBOZXE7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmVxOyBpKyspIHsKICAgICAgICBjb25zdCBjID0gZXF1YXRpb25zW2ldOwogICAgICAgIGxhbWJkYVtpXSA9IDAuMDsKICAgICAgICBCc1tpXSA9IGMuY29tcHV0ZUIoaCk7CiAgICAgICAgaW52Q3NbaV0gPSAxLjAgLyBjLmNvbXB1dGVDKCk7CiAgICAgIH0KCiAgICAgIGlmIChOZXEgIT09IDApIHsKICAgICAgICAvLyBSZXNldCB2bGFtYmRhCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICAgIGNvbnN0IHZsYW1iZGEgPSBiLnZsYW1iZGE7CiAgICAgICAgICBjb25zdCB3bGFtYmRhID0gYi53bGFtYmRhOwogICAgICAgICAgdmxhbWJkYS5zZXQoMCwgMCwgMCk7CiAgICAgICAgICB3bGFtYmRhLnNldCgwLCAwLCAwKTsKICAgICAgICB9IC8vIEl0ZXJhdGUgb3ZlciBlcXVhdGlvbnMKCgogICAgICAgIGZvciAoaXRlciA9IDA7IGl0ZXIgIT09IG1heEl0ZXI7IGl0ZXIrKykgewogICAgICAgICAgLy8gQWNjdW11bGF0ZSB0aGUgdG90YWwgZXJyb3IgZm9yIGVhY2ggaXRlcmF0aW9uLgogICAgICAgICAgZGVsdGFsYW1iZGFUb3QgPSAwLjA7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IE5lcTsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IGMgPSBlcXVhdGlvbnNbal07IC8vIENvbXB1dGUgaXRlcmF0aW9uCgogICAgICAgICAgICBCID0gQnNbal07CiAgICAgICAgICAgIGludkMgPSBpbnZDc1tqXTsKICAgICAgICAgICAgbGFtYmRhaiA9IGxhbWJkYVtqXTsKICAgICAgICAgICAgR1dsYW1iZGEgPSBjLmNvbXB1dGVHV2xhbWJkYSgpOwogICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGludkMgKiAoQiAtIEdXbGFtYmRhIC0gYy5lcHMgKiBsYW1iZGFqKTsgLy8gQ2xhbXAgaWYgd2UgYXJlIG5vdCB3aXRoaW4gdGhlIG1pbi9tYXggaW50ZXJ2YWwKCiAgICAgICAgICAgIGlmIChsYW1iZGFqICsgZGVsdGFsYW1iZGEgPCBjLm1pbkZvcmNlKSB7CiAgICAgICAgICAgICAgZGVsdGFsYW1iZGEgPSBjLm1pbkZvcmNlIC0gbGFtYmRhajsKICAgICAgICAgICAgfSBlbHNlIGlmIChsYW1iZGFqICsgZGVsdGFsYW1iZGEgPiBjLm1heEZvcmNlKSB7CiAgICAgICAgICAgICAgZGVsdGFsYW1iZGEgPSBjLm1heEZvcmNlIC0gbGFtYmRhajsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGFtYmRhW2pdICs9IGRlbHRhbGFtYmRhOwogICAgICAgICAgICBkZWx0YWxhbWJkYVRvdCArPSBkZWx0YWxhbWJkYSA+IDAuMCA/IGRlbHRhbGFtYmRhIDogLWRlbHRhbGFtYmRhOyAvLyBhYnMoZGVsdGFsYW1iZGEpCgogICAgICAgICAgICBjLmFkZFRvV2xhbWJkYShkZWx0YWxhbWJkYSk7CiAgICAgICAgICB9IC8vIElmIHRoZSB0b3RhbCBlcnJvciBpcyBzbWFsbCBlbm91Z2ggLSBzdG9wIGl0ZXJhdGUKCgogICAgICAgICAgaWYgKGRlbHRhbGFtYmRhVG90ICogZGVsdGFsYW1iZGFUb3QgPCB0b2xTcXVhcmVkKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0gLy8gQWRkIHJlc3VsdCB0byB2ZWxvY2l0eQoKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICAgIGNvbnN0IHYgPSBiLnZlbG9jaXR5OwogICAgICAgICAgY29uc3QgdyA9IGIuYW5ndWxhclZlbG9jaXR5OwogICAgICAgICAgYi52bGFtYmRhLnZtdWwoYi5saW5lYXJGYWN0b3IsIGIudmxhbWJkYSk7CiAgICAgICAgICB2LnZhZGQoYi52bGFtYmRhLCB2KTsKICAgICAgICAgIGIud2xhbWJkYS52bXVsKGIuYW5ndWxhckZhY3RvciwgYi53bGFtYmRhKTsKICAgICAgICAgIHcudmFkZChiLndsYW1iZGEsIHcpOwogICAgICAgIH0gLy8gU2V0IHRoZSBgLm11bHRpcGxpZXJgIHByb3BlcnR5IG9mIGVhY2ggZXF1YXRpb24KCgogICAgICAgIGxldCBsID0gZXF1YXRpb25zLmxlbmd0aDsKICAgICAgICBjb25zdCBpbnZEdCA9IDEgLyBoOwoKICAgICAgICB3aGlsZSAobC0tKSB7CiAgICAgICAgICBlcXVhdGlvbnNbbF0ubXVsdGlwbGllciA9IGxhbWJkYVtsXSAqIGludkR0OwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGl0ZXI7CiAgICB9CgogIH0gLy8gSnVzdCB0ZW1wb3JhcnkgbnVtYmVyIGhvbGRlcnMgdGhhdCB3ZSB3YW50IHRvIHJldXNlIGVhY2ggaXRlcmF0aW9uLgoKCiAgY29uc3QgR1NTb2x2ZXJfc29sdmVfbGFtYmRhID0gW107CiAgY29uc3QgR1NTb2x2ZXJfc29sdmVfaW52Q3MgPSBbXTsKICBjb25zdCBHU1NvbHZlcl9zb2x2ZV9CcyA9IFtdOwogIC8qKgogICAqIFNwbGl0cyB0aGUgZXF1YXRpb25zIGludG8gaXNsYW5kcyBhbmQgc29sdmVzIHRoZW0gaW5kZXBlbmRlbnRseS4gQ2FuIGltcHJvdmUgcGVyZm9ybWFuY2UuCiAgICovCgogIGNsYXNzIFNwbGl0U29sdmVyIGV4dGVuZHMgU29sdmVyIHsKICAgIC8qKgogICAgICogVGhlIG51bWJlciBvZiBzb2x2ZXIgaXRlcmF0aW9ucyBkZXRlcm1pbmVzIHF1YWxpdHkgb2YgdGhlIGNvbnN0cmFpbnRzIGluIHRoZSB3b3JsZC4gVGhlIG1vcmUgaXRlcmF0aW9ucywgdGhlIG1vcmUgY29ycmVjdCBzaW11bGF0aW9uLiBNb3JlIGl0ZXJhdGlvbnMgbmVlZCBtb3JlIGNvbXB1dGF0aW9ucyB0aG91Z2guIElmIHlvdSBoYXZlIGEgbGFyZ2UgZ3Jhdml0eSBmb3JjZSBpbiB5b3VyIHdvcmxkLCB5b3Ugd2lsbCBuZWVkIG1vcmUgaXRlcmF0aW9ucy4KICAgICAqLwoKICAgIC8qKgogICAgICogV2hlbiB0b2xlcmFuY2UgaXMgcmVhY2hlZCwgdGhlIHN5c3RlbSBpcyBhc3N1bWVkIHRvIGJlIGNvbnZlcmdlZC4KICAgICAqLwoKICAgIC8qKiBzdWJzb2x2ZXIgKi8KICAgIGNvbnN0cnVjdG9yKHN1YnNvbHZlcikgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLml0ZXJhdGlvbnMgPSB2b2lkIDA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gdm9pZCAwOwogICAgICB0aGlzLnN1YnNvbHZlciA9IHZvaWQgMDsKICAgICAgdGhpcy5ub2RlcyA9IHZvaWQgMDsKICAgICAgdGhpcy5ub2RlUG9vbCA9IHZvaWQgMDsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgICAgdGhpcy5zdWJzb2x2ZXIgPSBzdWJzb2x2ZXI7CiAgICAgIHRoaXMubm9kZXMgPSBbXTsKICAgICAgdGhpcy5ub2RlUG9vbCA9IFtdOyAvLyBDcmVhdGUgbmVlZGVkIG5vZGVzLCByZXVzZSBpZiBwb3NzaWJsZQoKICAgICAgd2hpbGUgKHRoaXMubm9kZVBvb2wubGVuZ3RoIDwgMTI4KSB7CiAgICAgICAgdGhpcy5ub2RlUG9vbC5wdXNoKHRoaXMuY3JlYXRlTm9kZSgpKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjcmVhdGVOb2RlCiAgICAgKi8KCgogICAgY3JlYXRlTm9kZSgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBib2R5OiBudWxsLAogICAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgICBlcXM6IFtdLAogICAgICAgIHZpc2l0ZWQ6IGZhbHNlCiAgICAgIH07CiAgICB9CiAgICAvKioKICAgICAqIFNvbHZlIHRoZSBzdWJzeXN0ZW1zCiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICBjb25zdCBub2RlcyA9IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzOwogICAgICBjb25zdCBub2RlUG9vbCA9IHRoaXMubm9kZVBvb2w7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgZXF1YXRpb25zID0gdGhpcy5lcXVhdGlvbnM7CiAgICAgIGNvbnN0IE5lcSA9IGVxdWF0aW9ucy5sZW5ndGg7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBzdWJzb2x2ZXIgPSB0aGlzLnN1YnNvbHZlcjsgLy8gQ3JlYXRlIG5lZWRlZCBub2RlcywgcmV1c2UgaWYgcG9zc2libGUKCiAgICAgIHdoaWxlIChub2RlUG9vbC5sZW5ndGggPCBOYm9kaWVzKSB7CiAgICAgICAgbm9kZVBvb2wucHVzaCh0aGlzLmNyZWF0ZU5vZGUoKSk7CiAgICAgIH0KCiAgICAgIG5vZGVzLmxlbmd0aCA9IE5ib2RpZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE5ib2RpZXM7IGkrKykgewogICAgICAgIG5vZGVzW2ldID0gbm9kZVBvb2xbaV07CiAgICAgIH0gLy8gUmVzZXQgbm9kZSB2YWx1ZXMKCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwogICAgICAgIG5vZGUuYm9keSA9IGJvZGllc1tpXTsKICAgICAgICBub2RlLmNoaWxkcmVuLmxlbmd0aCA9IDA7CiAgICAgICAgbm9kZS5lcXMubGVuZ3RoID0gMDsKICAgICAgICBub2RlLnZpc2l0ZWQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IE5lcTsgaysrKSB7CiAgICAgICAgY29uc3QgZXEgPSBlcXVhdGlvbnNba107CiAgICAgICAgY29uc3QgaSA9IGJvZGllcy5pbmRleE9mKGVxLmJpKTsKICAgICAgICBjb25zdCBqID0gYm9kaWVzLmluZGV4T2YoZXEuYmopOwogICAgICAgIGNvbnN0IG5pID0gbm9kZXNbaV07CiAgICAgICAgY29uc3QgbmogPSBub2Rlc1tqXTsKICAgICAgICBuaS5jaGlsZHJlbi5wdXNoKG5qKTsKICAgICAgICBuaS5lcXMucHVzaChlcSk7CiAgICAgICAgbmouY2hpbGRyZW4ucHVzaChuaSk7CiAgICAgICAgbmouZXFzLnB1c2goZXEpOwogICAgICB9CgogICAgICBsZXQgY2hpbGQ7CiAgICAgIGxldCBuID0gMDsKICAgICAgbGV0IGVxcyA9IFNwbGl0U29sdmVyX3NvbHZlX2VxczsKICAgICAgc3Vic29sdmVyLnRvbGVyYW5jZSA9IHRoaXMudG9sZXJhbmNlOwogICAgICBzdWJzb2x2ZXIuaXRlcmF0aW9ucyA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgZHVtbXlXb3JsZCA9IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQ7CgogICAgICB3aGlsZSAoY2hpbGQgPSBnZXRVbnZpc2l0ZWROb2RlKG5vZGVzKSkgewogICAgICAgIGVxcy5sZW5ndGggPSAwOwogICAgICAgIGR1bW15V29ybGQuYm9kaWVzLmxlbmd0aCA9IDA7CiAgICAgICAgYmZzKGNoaWxkLCB2aXNpdEZ1bmMsIGR1bW15V29ybGQuYm9kaWVzLCBlcXMpOwogICAgICAgIGNvbnN0IE5lcXMgPSBlcXMubGVuZ3RoOwogICAgICAgIGVxcyA9IGVxcy5zb3J0KHNvcnRCeUlkKTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5lcXM7IGkrKykgewogICAgICAgICAgc3Vic29sdmVyLmFkZEVxdWF0aW9uKGVxc1tpXSk7CiAgICAgICAgfQoKICAgICAgICBzdWJzb2x2ZXIuc29sdmUoZHQsIGR1bW15V29ybGQpOwogICAgICAgIHN1YnNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsKICAgICAgICBuKys7CiAgICAgIH0KCiAgICAgIHJldHVybiBuOwogICAgfQoKICB9IC8vIFJldHVybnMgdGhlIG51bWJlciBvZiBzdWJzeXN0ZW1zCgoKICBjb25zdCBTcGxpdFNvbHZlcl9zb2x2ZV9ub2RlcyA9IFtdOyAvLyBBbGwgYWxsb2NhdGVkIG5vZGUgb2JqZWN0cwoKICBjb25zdCBTcGxpdFNvbHZlcl9zb2x2ZV9lcXMgPSBbXTsgLy8gVGVtcCBhcnJheQoKICBjb25zdCBTcGxpdFNvbHZlcl9zb2x2ZV9kdW1teVdvcmxkID0gewogICAgYm9kaWVzOiBbXQogIH07IC8vIFRlbXAgb2JqZWN0CgogIGNvbnN0IFNUQVRJQyA9IEJvZHkuU1RBVElDOwoKICBmdW5jdGlvbiBnZXRVbnZpc2l0ZWROb2RlKG5vZGVzKSB7CiAgICBjb25zdCBObm9kZXMgPSBub2Rlcy5sZW5ndGg7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ub2RlczsgaSsrKSB7CiAgICAgIGNvbnN0IG5vZGUgPSBub2Rlc1tpXTsKCiAgICAgIGlmICghbm9kZS52aXNpdGVkICYmICEobm9kZS5ib2R5LnR5cGUgJiBTVEFUSUMpKSB7CiAgICAgICAgcmV0dXJuIG5vZGU7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICBjb25zdCBxdWV1ZSA9IFtdOwoKICBmdW5jdGlvbiBiZnMocm9vdCwgdmlzaXRGdW5jLCBiZHMsIGVxcykgewogICAgcXVldWUucHVzaChyb290KTsKICAgIHJvb3QudmlzaXRlZCA9IHRydWU7CiAgICB2aXNpdEZ1bmMocm9vdCwgYmRzLCBlcXMpOwoKICAgIHdoaWxlIChxdWV1ZS5sZW5ndGgpIHsKICAgICAgY29uc3Qgbm9kZSA9IHF1ZXVlLnBvcCgpOyAvLyBMb29wIG92ZXIgdW52aXNpdGVkIGNoaWxkIG5vZGVzCgogICAgICBsZXQgY2hpbGQ7CgogICAgICB3aGlsZSAoY2hpbGQgPSBnZXRVbnZpc2l0ZWROb2RlKG5vZGUuY2hpbGRyZW4pKSB7CiAgICAgICAgY2hpbGQudmlzaXRlZCA9IHRydWU7CiAgICAgICAgdmlzaXRGdW5jKGNoaWxkLCBiZHMsIGVxcyk7CiAgICAgICAgcXVldWUucHVzaChjaGlsZCk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHZpc2l0RnVuYyhub2RlLCBiZHMsIGVxcykgewogICAgYmRzLnB1c2gobm9kZS5ib2R5KTsKICAgIGNvbnN0IE5lcXMgPSBub2RlLmVxcy5sZW5ndGg7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5lcXM7IGkrKykgewogICAgICBjb25zdCBlcSA9IG5vZGUuZXFzW2ldOwoKICAgICAgaWYgKCFlcXMuaW5jbHVkZXMoZXEpKSB7CiAgICAgICAgZXFzLnB1c2goZXEpOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBzb3J0QnlJZChhLCBiKSB7CiAgICByZXR1cm4gYi5pZCAtIGEuaWQ7CiAgfQogIC8qKgogICAqIEZvciBwb29saW5nIG9iamVjdHMgdGhhdCBjYW4gYmUgcmV1c2VkLgogICAqLwoKCiAgY2xhc3MgUG9vbCB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5vYmplY3RzID0gW107CiAgICAgIHRoaXMudHlwZSA9IE9iamVjdDsKICAgIH0KICAgIC8qKgogICAgICogUmVsZWFzZSBhbiBvYmplY3QgYWZ0ZXIgdXNlCiAgICAgKi8KCgogICAgcmVsZWFzZSgpIHsKICAgICAgY29uc3QgTmFyZ3MgPSBhcmd1bWVudHMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5hcmdzOyBpKyspIHsKICAgICAgICB0aGlzLm9iamVjdHMucHVzaChpIDwgMCB8fCBhcmd1bWVudHMubGVuZ3RoIDw9IGkgPyB1bmRlZmluZWQgOiBhcmd1bWVudHNbaV0pOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIG9iamVjdAogICAgICovCgoKICAgIGdldCgpIHsKICAgICAgaWYgKHRoaXMub2JqZWN0cy5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RPYmplY3QoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGhpcy5vYmplY3RzLnBvcCgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhbiBvYmplY3QuIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBlYWNoIHN1YmNsYXNzLgogICAgICovCgoKICAgIGNvbnN0cnVjdE9iamVjdCgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb25zdHJ1Y3RPYmplY3QoKSBub3QgaW1wbGVtZW50ZWQgaW4gdGhpcyBQb29sIHN1YmNsYXNzIHlldCEnKTsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBTZWxmLCBmb3IgY2hhaW5pbmcKICAgICAqLwoKCiAgICByZXNpemUoc2l6ZSkgewogICAgICBjb25zdCBvYmplY3RzID0gdGhpcy5vYmplY3RzOwoKICAgICAgd2hpbGUgKG9iamVjdHMubGVuZ3RoID4gc2l6ZSkgewogICAgICAgIG9iamVjdHMucG9wKCk7CiAgICAgIH0KCiAgICAgIHdoaWxlIChvYmplY3RzLmxlbmd0aCA8IHNpemUpIHsKICAgICAgICBvYmplY3RzLnB1c2godGhpcy5jb25zdHJ1Y3RPYmplY3QoKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICB9CiAgLyoqCiAgICogVmVjM1Bvb2wKICAgKi8KCgogIGNsYXNzIFZlYzNQb29sIGV4dGVuZHMgUG9vbCB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTsKICAgICAgdGhpcy50eXBlID0gVmVjMzsKICAgIH0KICAgIC8qKgogICAgICogQ29uc3RydWN0IGEgdmVjdG9yCiAgICAgKi8KCgogICAgY29uc3RydWN0T2JqZWN0KCkgewogICAgICByZXR1cm4gbmV3IFZlYzMoKTsKICAgIH0KCiAgfQoKICBsZXQgX0NPTExJU0lPTl9UWVBFUyRzcGhlLCBfQ09MTElTSU9OX1RZUEVTJHNwaGUyLCBfQ09MTElTSU9OX1RZUEVTJGJveEIsIF9DT0xMSVNJT05fVFlQRVMkc3BoZTMsIF9DT0xMSVNJT05fVFlQRVMkcGxhbiwgX0NPTExJU0lPTl9UWVBFUyRjb252LCBfQ09MTElTSU9OX1RZUEVTJHNwaGU0LCBfQ09MTElTSU9OX1RZUEVTJHBsYW4yLCBfQ09MTElTSU9OX1RZUEVTJGJveEMsIF9DT0xMSVNJT05fVFlQRVMkc3BoZTUsIF9DT0xMSVNJT05fVFlQRVMkYm94SCwgX0NPTExJU0lPTl9UWVBFUyRjb252MiwgX0NPTExJU0lPTl9UWVBFUyRzcGhlNiwgX0NPTExJU0lPTl9UWVBFUyRwbGFuMywgX0NPTExJU0lPTl9UWVBFUyRib3hQLCBfQ09MTElTSU9OX1RZUEVTJGNvbnYzLCBfQ09MTElTSU9OX1RZUEVTJGN5bGksIF9DT0xMSVNJT05fVFlQRVMkc3BoZTcsIF9DT0xMSVNJT05fVFlQRVMkcGxhbjQsIF9DT0xMSVNJT05fVFlQRVMkYm94QzIsIF9DT0xMSVNJT05fVFlQRVMkY29udjQsIF9DT0xMSVNJT05fVFlQRVMkaGVpZywgX0NPTExJU0lPTl9UWVBFUyRwYXJ0LCBfQ09MTElTSU9OX1RZUEVTJHNwaGU4LCBfQ09MTElTSU9OX1RZUEVTJHBsYW41OyAvLyBOYW1pbmcgcnVsZTogYmFzZWQgb2YgdGhlIG9yZGVyIGluIFNIQVBFX1RZUEVTLAogIC8vIHRoZSBmaXJzdCBwYXJ0IG9mIHRoZSBtZXRob2QgaXMgZm9ybWVkIGJ5IHRoZQogIC8vIHNoYXBlIHR5cGUgdGhhdCBjb21lcyBiZWZvcmUsIGluIHRoZSBzZWNvbmQgcGFydAogIC8vIHRoZXJlIGlzIHRoZSBzaGFwZSB0eXBlIHRoYXQgY29tZXMgYWZ0ZXIgaW4gdGhlIFNIQVBFX1RZUEVTIGxpc3QKCgogIGNvbnN0IENPTExJU0lPTl9UWVBFUyA9IHsKICAgIHNwaGVyZVNwaGVyZTogU2hhcGUudHlwZXMuU1BIRVJFLAogICAgc3BoZXJlUGxhbmU6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLlBMQU5FLAogICAgYm94Qm94OiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5CT1gsCiAgICBzcGhlcmVCb3g6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIHBsYW5lQm94OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIGNvbnZleENvbnZleDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHNwaGVyZUNvbnZleDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHBsYW5lQ29udmV4OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBib3hDb252ZXg6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBzcGhlcmVIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBib3hIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBjb252ZXhIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgc3BoZXJlUGFydGljbGU6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuU1BIRVJFLAogICAgcGxhbmVQYXJ0aWNsZTogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGJveFBhcnRpY2xlOiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGNvbnZleFBhcnRpY2xlOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBjeWxpbmRlckN5bGluZGVyOiBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHNwaGVyZUN5bGluZGVyOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBsYW5lQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBMQU5FIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBib3hDeWxpbmRlcjogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBjb252ZXhDeWxpbmRlcjogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcjogU2hhcGUudHlwZXMuSEVJR0hURklFTEQgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBhcnRpY2xlQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBzcGhlcmVUcmltZXNoOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5UUklNRVNILAogICAgcGxhbmVUcmltZXNoOiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLlRSSU1FU0gKICB9OwogIF9DT0xMSVNJT05fVFlQRVMkc3BoZSA9IENPTExJU0lPTl9UWVBFUy5zcGhlcmVTcGhlcmU7CiAgX0NPTExJU0lPTl9UWVBFUyRzcGhlMiA9IENPTExJU0lPTl9UWVBFUy5zcGhlcmVQbGFuZTsKICBfQ09MTElTSU9OX1RZUEVTJGJveEIgPSBDT0xMSVNJT05fVFlQRVMuYm94Qm94OwogIF9DT0xMSVNJT05fVFlQRVMkc3BoZTMgPSBDT0xMSVNJT05fVFlQRVMuc3BoZXJlQm94OwogIF9DT0xMSVNJT05fVFlQRVMkcGxhbiA9IENPTExJU0lPTl9UWVBFUy5wbGFuZUJveDsKICBfQ09MTElTSU9OX1RZUEVTJGNvbnYgPSBDT0xMSVNJT05fVFlQRVMuY29udmV4Q29udmV4OwogIF9DT0xMSVNJT05fVFlQRVMkc3BoZTQgPSBDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ29udmV4OwogIF9DT0xMSVNJT05fVFlQRVMkcGxhbjIgPSBDT0xMSVNJT05fVFlQRVMucGxhbmVDb252ZXg7CiAgX0NPTExJU0lPTl9UWVBFUyRib3hDID0gQ09MTElTSU9OX1RZUEVTLmJveENvbnZleDsKICBfQ09MTElTSU9OX1RZUEVTJHNwaGU1ID0gQ09MTElTSU9OX1RZUEVTLnNwaGVyZUhlaWdodGZpZWxkOwogIF9DT0xMSVNJT05fVFlQRVMkYm94SCA9IENPTExJU0lPTl9UWVBFUy5ib3hIZWlnaHRmaWVsZDsKICBfQ09MTElTSU9OX1RZUEVTJGNvbnYyID0gQ09MTElTSU9OX1RZUEVTLmNvbnZleEhlaWdodGZpZWxkOwogIF9DT0xMSVNJT05fVFlQRVMkc3BoZTYgPSBDT0xMSVNJT05fVFlQRVMuc3BoZXJlUGFydGljbGU7CiAgX0NPTExJU0lPTl9UWVBFUyRwbGFuMyA9IENPTExJU0lPTl9UWVBFUy5wbGFuZVBhcnRpY2xlOwogIF9DT0xMSVNJT05fVFlQRVMkYm94UCA9IENPTExJU0lPTl9UWVBFUy5ib3hQYXJ0aWNsZTsKICBfQ09MTElTSU9OX1RZUEVTJGNvbnYzID0gQ09MTElTSU9OX1RZUEVTLmNvbnZleFBhcnRpY2xlOwogIF9DT0xMSVNJT05fVFlQRVMkY3lsaSA9IENPTExJU0lPTl9UWVBFUy5jeWxpbmRlckN5bGluZGVyOwogIF9DT0xMSVNJT05fVFlQRVMkc3BoZTcgPSBDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ3lsaW5kZXI7CiAgX0NPTExJU0lPTl9UWVBFUyRwbGFuNCA9IENPTExJU0lPTl9UWVBFUy5wbGFuZUN5bGluZGVyOwogIF9DT0xMSVNJT05fVFlQRVMkYm94QzIgPSBDT0xMSVNJT05fVFlQRVMuYm94Q3lsaW5kZXI7CiAgX0NPTExJU0lPTl9UWVBFUyRjb252NCA9IENPTExJU0lPTl9UWVBFUy5jb252ZXhDeWxpbmRlcjsKICBfQ09MTElTSU9OX1RZUEVTJGhlaWcgPSBDT0xMSVNJT05fVFlQRVMuaGVpZ2h0ZmllbGRDeWxpbmRlcjsKICBfQ09MTElTSU9OX1RZUEVTJHBhcnQgPSBDT0xMSVNJT05fVFlQRVMucGFydGljbGVDeWxpbmRlcjsKICBfQ09MTElTSU9OX1RZUEVTJHNwaGU4ID0gQ09MTElTSU9OX1RZUEVTLnNwaGVyZVRyaW1lc2g7CiAgX0NPTExJU0lPTl9UWVBFUyRwbGFuNSA9IENPTExJU0lPTl9UWVBFUy5wbGFuZVRyaW1lc2g7CiAgLyoqCiAgICogSGVscGVyIGNsYXNzIGZvciB0aGUgV29ybGQuIEdlbmVyYXRlcyBDb250YWN0RXF1YXRpb25zLgogICAqIEB0b2RvIFNwaGVyZS1Db252ZXhQb2x5aGVkcm9uIGNvbnRhY3RzCiAgICogQHRvZG8gQ29udGFjdCByZWR1Y3Rpb24KICAgKiBAdG9kbyBzaG91bGQgbW92ZSBtZXRob2RzIHRvIHByb3RvdHlwZQogICAqLwoKICBjbGFzcyBOYXJyb3dwaGFzZSB7CiAgICAvKioKICAgICAqIEludGVybmFsIHN0b3JhZ2Ugb2YgcG9vbGVkIGNvbnRhY3QgcG9pbnRzLgogICAgICovCgogICAgLyoqCiAgICAgKiBQb29sZWQgdmVjdG9ycy4KICAgICAqLwogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJHNwaGVdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVTcGhlcmU7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJHNwaGUyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlUGxhbmU7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJGJveEJdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hCb3g7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJHNwaGUzXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQm94OwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRwbGFuXSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVCb3g7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJGNvbnZdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJHNwaGU0XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQ29udmV4OwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRwbGFuMl0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQ29udmV4OwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRib3hDXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRzcGhlNV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZUhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRib3hIXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94SGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJGNvbnYyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4SGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJHNwaGU2XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJHBsYW4zXSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVQYXJ0aWNsZTsKICAgIH0KCiAgICBnZXQgW19DT0xMSVNJT05fVFlQRVMkYm94UF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveFBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRjb252M10oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleFBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRjeWxpXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRzcGhlN10oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZUNvbnZleDsKICAgIH0KCiAgICBnZXQgW19DT0xMSVNJT05fVFlQRVMkcGxhbjRdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZUNvbnZleDsKICAgIH0KCiAgICBnZXQgW19DT0xMSVNJT05fVFlQRVMkYm94QzJdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJGNvbnY0XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbX0NPTExJU0lPTl9UWVBFUyRoZWlnXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuaGVpZ2h0ZmllbGRDeWxpbmRlcjsKICAgIH0KCiAgICBnZXQgW19DT0xMSVNJT05fVFlQRVMkcGFydF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBhcnRpY2xlQ3lsaW5kZXI7CiAgICB9CgogICAgZ2V0IFtfQ09MTElTSU9OX1RZUEVTJHNwaGU4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlVHJpbWVzaDsKICAgIH0KCiAgICBnZXQgW19DT0xMSVNJT05fVFlQRVMkcGxhbjVdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZVRyaW1lc2g7CiAgICB9IC8vIGdldCBbQ09MTElTSU9OX1RZUEVTLmNvbnZleFRyaW1lc2hdKCkgewogICAgLy8gICByZXR1cm4gdGhpcy5jb252ZXhUcmltZXNoCiAgICAvLyB9CgoKICAgIGNvbnN0cnVjdG9yKHdvcmxkKSB7CiAgICAgIHRoaXMuY29udGFjdFBvaW50UG9vbCA9IHZvaWQgMDsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUG9vbCA9IHZvaWQgMDsKICAgICAgdGhpcy5yZXN1bHQgPSB2b2lkIDA7CiAgICAgIHRoaXMuZnJpY3Rpb25SZXN1bHQgPSB2b2lkIDA7CiAgICAgIHRoaXMudjNwb29sID0gdm9pZCAwOwogICAgICB0aGlzLndvcmxkID0gdm9pZCAwOwogICAgICB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWwgPSB2b2lkIDA7CiAgICAgIHRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24gPSB2b2lkIDA7CiAgICAgIHRoaXMuY29udGFjdFBvaW50UG9vbCA9IFtdOwogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25Qb29sID0gW107CiAgICAgIHRoaXMucmVzdWx0ID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25SZXN1bHQgPSBbXTsKICAgICAgdGhpcy52M3Bvb2wgPSBuZXcgVmVjM1Bvb2woKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgICB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWwgPSB3b3JsZC5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICB0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgYSBjb250YWN0IG9iamVjdCwgYnkgdXNpbmcgdGhlIGludGVybmFsIHBvb2wgb3IgY3JlYXRpbmcgYSBuZXcgb25lLgogICAgICovCgoKICAgIGNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgb3ZlcnJpZGVTaGFwZUEsIG92ZXJyaWRlU2hhcGVCKSB7CiAgICAgIGxldCBjOwoKICAgICAgaWYgKHRoaXMuY29udGFjdFBvaW50UG9vbC5sZW5ndGgpIHsKICAgICAgICBjID0gdGhpcy5jb250YWN0UG9pbnRQb29sLnBvcCgpOwogICAgICAgIGMuYmkgPSBiaTsKICAgICAgICBjLmJqID0gYmo7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYyA9IG5ldyBDb250YWN0RXF1YXRpb24oYmksIGJqKTsKICAgICAgfQoKICAgICAgYy5lbmFibGVkID0gYmkuY29sbGlzaW9uUmVzcG9uc2UgJiYgYmouY29sbGlzaW9uUmVzcG9uc2UgJiYgc2kuY29sbGlzaW9uUmVzcG9uc2UgJiYgc2ouY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIGNvbnN0IGNtID0gdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsOwogICAgICBjLnJlc3RpdHV0aW9uID0gY20ucmVzdGl0dXRpb247CiAgICAgIGMuc2V0U3Bvb2tQYXJhbXMoY20uY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzLCBjbS5jb250YWN0RXF1YXRpb25SZWxheGF0aW9uLCB0aGlzLndvcmxkLmR0KTsKICAgICAgY29uc3QgbWF0QSA9IHNpLm1hdGVyaWFsIHx8IGJpLm1hdGVyaWFsOwogICAgICBjb25zdCBtYXRCID0gc2oubWF0ZXJpYWwgfHwgYmoubWF0ZXJpYWw7CgogICAgICBpZiAobWF0QSAmJiBtYXRCICYmIG1hdEEucmVzdGl0dXRpb24gPj0gMCAmJiBtYXRCLnJlc3RpdHV0aW9uID49IDApIHsKICAgICAgICBjLnJlc3RpdHV0aW9uID0gbWF0QS5yZXN0aXR1dGlvbiAqIG1hdEIucmVzdGl0dXRpb247CiAgICAgIH0KCiAgICAgIGMuc2kgPSBvdmVycmlkZVNoYXBlQSB8fCBzaTsKICAgICAgYy5zaiA9IG92ZXJyaWRlU2hhcGVCIHx8IHNqOwogICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBjcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KGNvbnRhY3RFcXVhdGlvbiwgb3V0QXJyYXkpIHsKICAgICAgY29uc3QgYm9keUEgPSBjb250YWN0RXF1YXRpb24uYmk7CiAgICAgIGNvbnN0IGJvZHlCID0gY29udGFjdEVxdWF0aW9uLmJqOwogICAgICBjb25zdCBzaGFwZUEgPSBjb250YWN0RXF1YXRpb24uc2k7CiAgICAgIGNvbnN0IHNoYXBlQiA9IGNvbnRhY3RFcXVhdGlvbi5zajsKICAgICAgY29uc3Qgd29ybGQgPSB0aGlzLndvcmxkOwogICAgICBjb25zdCBjbSA9IHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbDsgLy8gSWYgZnJpY3Rpb24gb3IgcmVzdGl0dXRpb24gd2VyZSBzcGVjaWZpZWQgaW4gdGhlIG1hdGVyaWFsLCB1c2UgdGhlbQoKICAgICAgbGV0IGZyaWN0aW9uID0gY20uZnJpY3Rpb247CiAgICAgIGNvbnN0IG1hdEEgPSBzaGFwZUEubWF0ZXJpYWwgfHwgYm9keUEubWF0ZXJpYWw7CiAgICAgIGNvbnN0IG1hdEIgPSBzaGFwZUIubWF0ZXJpYWwgfHwgYm9keUIubWF0ZXJpYWw7CgogICAgICBpZiAobWF0QSAmJiBtYXRCICYmIG1hdEEuZnJpY3Rpb24gPj0gMCAmJiBtYXRCLmZyaWN0aW9uID49IDApIHsKICAgICAgICBmcmljdGlvbiA9IG1hdEEuZnJpY3Rpb24gKiBtYXRCLmZyaWN0aW9uOwogICAgICB9CgogICAgICBpZiAoZnJpY3Rpb24gPiAwKSB7CiAgICAgICAgLy8gQ3JlYXRlIDIgdGFuZ2VudCBlcXVhdGlvbnMKICAgICAgICBjb25zdCBtdWcgPSBmcmljdGlvbiAqIHdvcmxkLmdyYXZpdHkubGVuZ3RoKCk7CiAgICAgICAgbGV0IHJlZHVjZWRNYXNzID0gYm9keUEuaW52TWFzcyArIGJvZHlCLmludk1hc3M7CgogICAgICAgIGlmIChyZWR1Y2VkTWFzcyA+IDApIHsKICAgICAgICAgIHJlZHVjZWRNYXNzID0gMSAvIHJlZHVjZWRNYXNzOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgcG9vbCA9IHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2w7CiAgICAgICAgY29uc3QgYzEgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihib2R5QSwgYm9keUIsIG11ZyAqIHJlZHVjZWRNYXNzKTsKICAgICAgICBjb25zdCBjMiA9IHBvb2wubGVuZ3RoID8gcG9vbC5wb3AoKSA6IG5ldyBGcmljdGlvbkVxdWF0aW9uKGJvZHlBLCBib2R5QiwgbXVnICogcmVkdWNlZE1hc3MpOwogICAgICAgIGMxLmJpID0gYzIuYmkgPSBib2R5QTsKICAgICAgICBjMS5iaiA9IGMyLmJqID0gYm9keUI7CiAgICAgICAgYzEubWluRm9yY2UgPSBjMi5taW5Gb3JjZSA9IC1tdWcgKiByZWR1Y2VkTWFzczsKICAgICAgICBjMS5tYXhGb3JjZSA9IGMyLm1heEZvcmNlID0gbXVnICogcmVkdWNlZE1hc3M7IC8vIENvcHkgb3ZlciB0aGUgcmVsYXRpdmUgdmVjdG9ycwoKICAgICAgICBjMS5yaS5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaSk7CiAgICAgICAgYzEucmouY29weShjb250YWN0RXF1YXRpb24ucmopOwogICAgICAgIGMyLnJpLmNvcHkoY29udGFjdEVxdWF0aW9uLnJpKTsKICAgICAgICBjMi5yai5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaik7IC8vIENvbnN0cnVjdCB0YW5nZW50cwoKICAgICAgICBjb250YWN0RXF1YXRpb24ubmkudGFuZ2VudHMoYzEudCwgYzIudCk7IC8vIFNldCBzcG9vayBwYXJhbXMKCiAgICAgICAgYzEuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIHdvcmxkLmR0KTsKICAgICAgICBjMi5zZXRTcG9va1BhcmFtcyhjbS5mcmljdGlvbkVxdWF0aW9uU3RpZmZuZXNzLCBjbS5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiwgd29ybGQuZHQpOwogICAgICAgIGMxLmVuYWJsZWQgPSBjMi5lbmFibGVkID0gY29udGFjdEVxdWF0aW9uLmVuYWJsZWQ7CiAgICAgICAgb3V0QXJyYXkucHVzaChjMSwgYzIpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIFRha2UgdGhlIGF2ZXJhZ2UgTiBsYXRlc3QgY29udGFjdCBwb2ludCBvbiB0aGUgcGxhbmUuCiAgICAgKi8KCgogICAgY3JlYXRlRnJpY3Rpb25Gcm9tQXZlcmFnZShudW1Db250YWN0cykgewogICAgICAvLyBUaGUgbGFzdCBjb250YWN0RXF1YXRpb24KICAgICAgbGV0IGMgPSB0aGlzLnJlc3VsdFt0aGlzLnJlc3VsdC5sZW5ndGggLSAxXTsgLy8gQ3JlYXRlIHRoZSByZXN1bHQ6IHR3byAiYXZlcmFnZSIgZnJpY3Rpb24gZXF1YXRpb25zCgogICAgICBpZiAoIXRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChjLCB0aGlzLmZyaWN0aW9uUmVzdWx0KSB8fCBudW1Db250YWN0cyA9PT0gMSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgZjEgPSB0aGlzLmZyaWN0aW9uUmVzdWx0W3RoaXMuZnJpY3Rpb25SZXN1bHQubGVuZ3RoIC0gMl07CiAgICAgIGNvbnN0IGYyID0gdGhpcy5mcmljdGlvblJlc3VsdFt0aGlzLmZyaWN0aW9uUmVzdWx0Lmxlbmd0aCAtIDFdOwogICAgICBhdmVyYWdlTm9ybWFsLnNldFplcm8oKTsKICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEuc2V0WmVybygpOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi5zZXRaZXJvKCk7CiAgICAgIGNvbnN0IGJvZHlBID0gYy5iaTsKICAgICAgYy5iajsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBudW1Db250YWN0czsgaSsrKSB7CiAgICAgICAgYyA9IHRoaXMucmVzdWx0W3RoaXMucmVzdWx0Lmxlbmd0aCAtIDEgLSBpXTsKCiAgICAgICAgaWYgKGMuYmkgIT09IGJvZHlBKSB7CiAgICAgICAgICBhdmVyYWdlTm9ybWFsLnZhZGQoYy5uaSwgYXZlcmFnZU5vcm1hbCk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS52YWRkKGMucmksIGF2ZXJhZ2VDb250YWN0UG9pbnRBKTsKICAgICAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRCLnZhZGQoYy5yaiwgYXZlcmFnZUNvbnRhY3RQb2ludEIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhdmVyYWdlTm9ybWFsLnZzdWIoYy5uaSwgYXZlcmFnZU5vcm1hbCk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS52YWRkKGMucmosIGF2ZXJhZ2VDb250YWN0UG9pbnRBKTsKICAgICAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRCLnZhZGQoYy5yaSwgYXZlcmFnZUNvbnRhY3RQb2ludEIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgaW52TnVtQ29udGFjdHMgPSAxIC8gbnVtQ29udGFjdHM7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRBLnNjYWxlKGludk51bUNvbnRhY3RzLCBmMS5yaSk7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRCLnNjYWxlKGludk51bUNvbnRhY3RzLCBmMS5yaik7CiAgICAgIGYyLnJpLmNvcHkoZjEucmkpOyAvLyBTaG91bGQgYmUgdGhlIHNhbWUKCiAgICAgIGYyLnJqLmNvcHkoZjEucmopOwogICAgICBhdmVyYWdlTm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICBhdmVyYWdlTm9ybWFsLnRhbmdlbnRzKGYxLnQsIGYyLnQpOyAvLyByZXR1cm4gZXE7CiAgICB9CiAgICAvKioKICAgICAqIEdlbmVyYXRlIGFsbCBjb250YWN0cyBiZXR3ZWVuIGEgbGlzdCBvZiBib2R5IHBhaXJzCiAgICAgKiBAcGFyYW0gcDEgQXJyYXkgb2YgYm9keSBpbmRpY2VzCiAgICAgKiBAcGFyYW0gcDIgQXJyYXkgb2YgYm9keSBpbmRpY2VzCiAgICAgKiBAcGFyYW0gcmVzdWx0IEFycmF5IHRvIHN0b3JlIGdlbmVyYXRlZCBjb250YWN0cwogICAgICogQHBhcmFtIG9sZGNvbnRhY3RzIE9wdGlvbmFsLiBBcnJheSBvZiByZXVzYWJsZSBjb250YWN0IG9iamVjdHMKICAgICAqLwoKCiAgICBnZXRDb250YWN0cyhwMSwgcDIsIHdvcmxkLCByZXN1bHQsIG9sZGNvbnRhY3RzLCBmcmljdGlvblJlc3VsdCwgZnJpY3Rpb25Qb29sKSB7CiAgICAgIC8vIFNhdmUgb2xkIGNvbnRhY3Qgb2JqZWN0cwogICAgICB0aGlzLmNvbnRhY3RQb2ludFBvb2wgPSBvbGRjb250YWN0czsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUG9vbCA9IGZyaWN0aW9uUG9vbDsKICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgIHRoaXMuZnJpY3Rpb25SZXN1bHQgPSBmcmljdGlvblJlc3VsdDsKICAgICAgY29uc3QgcWkgPSB0bXBRdWF0MTsKICAgICAgY29uc3QgcWogPSB0bXBRdWF0MjsKICAgICAgY29uc3QgeGkgPSB0bXBWZWMxOwogICAgICBjb25zdCB4aiA9IHRtcFZlYzI7CgogICAgICBmb3IgKGxldCBrID0gMCwgTiA9IHAxLmxlbmd0aDsgayAhPT0gTjsgaysrKSB7CiAgICAgICAgLy8gR2V0IGN1cnJlbnQgY29sbGlzaW9uIGJvZGllcwogICAgICAgIGNvbnN0IGJpID0gcDFba107CiAgICAgICAgY29uc3QgYmogPSBwMltrXTsgLy8gR2V0IGNvbnRhY3QgbWF0ZXJpYWwKCiAgICAgICAgbGV0IGJvZHlDb250YWN0TWF0ZXJpYWwgPSBudWxsOwoKICAgICAgICBpZiAoYmkubWF0ZXJpYWwgJiYgYmoubWF0ZXJpYWwpIHsKICAgICAgICAgIGJvZHlDb250YWN0TWF0ZXJpYWwgPSB3b3JsZC5nZXRDb250YWN0TWF0ZXJpYWwoYmkubWF0ZXJpYWwsIGJqLm1hdGVyaWFsKSB8fCBudWxsOwogICAgICAgIH0KCiAgICAgICAgY29uc3QganVzdFRlc3QgPSBiaS50eXBlICYgQm9keS5LSU5FTUFUSUMgJiYgYmoudHlwZSAmIEJvZHkuU1RBVElDIHx8IGJpLnR5cGUgJiBCb2R5LlNUQVRJQyAmJiBiai50eXBlICYgQm9keS5LSU5FTUFUSUMgfHwgYmkudHlwZSAmIEJvZHkuS0lORU1BVElDICYmIGJqLnR5cGUgJiBCb2R5LktJTkVNQVRJQzsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBiaS5zaGFwZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGJpLnF1YXRlcm5pb24ubXVsdChiaS5zaGFwZU9yaWVudGF0aW9uc1tpXSwgcWkpOwogICAgICAgICAgYmkucXVhdGVybmlvbi52bXVsdChiaS5zaGFwZU9mZnNldHNbaV0sIHhpKTsKICAgICAgICAgIHhpLnZhZGQoYmkucG9zaXRpb24sIHhpKTsKICAgICAgICAgIGNvbnN0IHNpID0gYmkuc2hhcGVzW2ldOwoKICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgYmouc2hhcGVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIC8vIENvbXB1dGUgd29ybGQgdHJhbnNmb3JtIG9mIHNoYXBlcwogICAgICAgICAgICBiai5xdWF0ZXJuaW9uLm11bHQoYmouc2hhcGVPcmllbnRhdGlvbnNbal0sIHFqKTsKICAgICAgICAgICAgYmoucXVhdGVybmlvbi52bXVsdChiai5zaGFwZU9mZnNldHNbal0sIHhqKTsKICAgICAgICAgICAgeGoudmFkZChiai5wb3NpdGlvbiwgeGopOwogICAgICAgICAgICBjb25zdCBzaiA9IGJqLnNoYXBlc1tqXTsKCiAgICAgICAgICAgIGlmICghKHNpLmNvbGxpc2lvbkZpbHRlck1hc2sgJiBzai5jb2xsaXNpb25GaWx0ZXJHcm91cCAmJiBzai5jb2xsaXNpb25GaWx0ZXJNYXNrICYgc2kuY29sbGlzaW9uRmlsdGVyR3JvdXApKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh4aS5kaXN0YW5jZVRvKHhqKSA+IHNpLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2ouYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfSAvLyBHZXQgY29sbGlzaW9uIG1hdGVyaWFsCgoKICAgICAgICAgICAgbGV0IHNoYXBlQ29udGFjdE1hdGVyaWFsID0gbnVsbDsKCiAgICAgICAgICAgIGlmIChzaS5tYXRlcmlhbCAmJiBzai5tYXRlcmlhbCkgewogICAgICAgICAgICAgIHNoYXBlQ29udGFjdE1hdGVyaWFsID0gd29ybGQuZ2V0Q29udGFjdE1hdGVyaWFsKHNpLm1hdGVyaWFsLCBzai5tYXRlcmlhbCkgfHwgbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsID0gc2hhcGVDb250YWN0TWF0ZXJpYWwgfHwgYm9keUNvbnRhY3RNYXRlcmlhbCB8fCB3b3JsZC5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOyAvLyBHZXQgY29udGFjdHMKCiAgICAgICAgICAgIGNvbnN0IHJlc29sdmVySW5kZXggPSBzaS50eXBlIHwgc2oudHlwZTsKICAgICAgICAgICAgY29uc3QgcmVzb2x2ZXIgPSB0aGlzW3Jlc29sdmVySW5kZXhdOwoKICAgICAgICAgICAgaWYgKHJlc29sdmVyKSB7CiAgICAgICAgICAgICAgbGV0IHJldHZhbCA9IGZhbHNlOyAvLyBUTyBETzogaW52ZXN0aWdhdGUgd2h5IHNwaGVyZVBhcnRpY2xlIGFuZCBjb252ZXhQYXJ0aWNsZQogICAgICAgICAgICAgIC8vIHJlc29sdmVycyBleHBlY3Qgc2kgYW5kIHNqIHNoYXBlcyB0byBiZSBpbiByZXZlcnNlIG9yZGVyCiAgICAgICAgICAgICAgLy8gKGkuZS4gbGFyZ2VyIGludGVnZXIgdmFsdWUgdHlwZSBmaXJzdCBpbnN0ZWFkIG9mIHNtYWxsZXIgZmlyc3QpCgogICAgICAgICAgICAgIGlmIChzaS50eXBlIDwgc2oudHlwZSkgewogICAgICAgICAgICAgICAgcmV0dmFsID0gcmVzb2x2ZXIuY2FsbCh0aGlzLCBzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHNpLCBzaiwganVzdFRlc3QpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR2YWwgPSByZXNvbHZlci5jYWxsKHRoaXMsIHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAocmV0dmFsICYmIGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICAvLyBSZWdpc3RlciBvdmVybGFwCiAgICAgICAgICAgICAgICB3b3JsZC5zaGFwZU92ZXJsYXBLZWVwZXIuc2V0KHNpLmlkLCBzai5pZCk7CiAgICAgICAgICAgICAgICB3b3JsZC5ib2R5T3ZlcmxhcEtlZXBlci5zZXQoYmkuaWQsIGJqLmlkKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzcGhlcmVTcGhlcmUoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgcmV0dXJuIHhpLmRpc3RhbmNlU3F1YXJlZCh4aikgPCAoc2kucmFkaXVzICsgc2oucmFkaXVzKSAqKiAyOwogICAgICB9IC8vIFdlIHdpbGwgaGF2ZSBvbmx5IG9uZSBjb250YWN0IGluIHRoaXMgY2FzZQoKCiAgICAgIGNvbnN0IGNvbnRhY3RFcSA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7IC8vIENvbnRhY3Qgbm9ybWFsCgogICAgICB4ai52c3ViKHhpLCBjb250YWN0RXEubmkpOwogICAgICBjb250YWN0RXEubmkubm9ybWFsaXplKCk7IC8vIENvbnRhY3QgcG9pbnQgbG9jYXRpb25zCgogICAgICBjb250YWN0RXEucmkuY29weShjb250YWN0RXEubmkpOwogICAgICBjb250YWN0RXEucmouY29weShjb250YWN0RXEubmkpOwogICAgICBjb250YWN0RXEucmkuc2NhbGUoc2kucmFkaXVzLCBjb250YWN0RXEucmkpOwogICAgICBjb250YWN0RXEucmouc2NhbGUoLXNqLnJhZGl1cywgY29udGFjdEVxLnJqKTsKICAgICAgY29udGFjdEVxLnJpLnZhZGQoeGksIGNvbnRhY3RFcS5yaSk7CiAgICAgIGNvbnRhY3RFcS5yaS52c3ViKGJpLnBvc2l0aW9uLCBjb250YWN0RXEucmkpOwogICAgICBjb250YWN0RXEucmoudmFkZCh4aiwgY29udGFjdEVxLnJqKTsKICAgICAgY29udGFjdEVxLnJqLnZzdWIoYmoucG9zaXRpb24sIGNvbnRhY3RFcS5yaik7CiAgICAgIHRoaXMucmVzdWx0LnB1c2goY29udGFjdEVxKTsKICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KGNvbnRhY3RFcSwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICB9CgogICAgc3BoZXJlUGxhbmUoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgLy8gV2Ugd2lsbCBoYXZlIG9uZSBjb250YWN0IGluIHRoaXMgY2FzZQogICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsgLy8gQ29udGFjdCBub3JtYWwKCiAgICAgIHIubmkuc2V0KDAsIDAsIDEpOwogICAgICBxai52bXVsdChyLm5pLCByLm5pKTsKICAgICAgci5uaS5uZWdhdGUoci5uaSk7IC8vIGJvZHkgaSBpcyB0aGUgc3BoZXJlLCBmbGlwIG5vcm1hbAoKICAgICAgci5uaS5ub3JtYWxpemUoKTsgLy8gTmVlZGVkPwogICAgICAvLyBWZWN0b3IgZnJvbSBzcGhlcmUgY2VudGVyIHRvIGNvbnRhY3QgcG9pbnQKCiAgICAgIHIubmkuc2NhbGUoc2kucmFkaXVzLCByLnJpKTsgLy8gUHJvamVjdCBkb3duIHNwaGVyZSBvbiBwbGFuZQoKICAgICAgeGkudnN1Yih4aiwgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlKTsKICAgICAgci5uaS5zY2FsZShyLm5pLmRvdChwb2ludF9vbl9wbGFuZV90b19zcGhlcmUpLCBwbGFuZV90b19zcGhlcmVfb3J0aG8pOwogICAgICBwb2ludF9vbl9wbGFuZV90b19zcGhlcmUudnN1YihwbGFuZV90b19zcGhlcmVfb3J0aG8sIHIucmopOyAvLyBUaGUgc3BoZXJlIHBvc2l0aW9uIHByb2plY3RlZCB0byBwbGFuZQoKICAgICAgaWYgKC1wb2ludF9vbl9wbGFuZV90b19zcGhlcmUuZG90KHIubmkpIDw9IHNpLnJhZGl1cykgewogICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSAvLyBNYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSBib2R5CgoKICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgY29uc3QgcmogPSByLnJqOwogICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgfQogICAgfQoKICAgIGJveEJveChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzaS5tYXRlcmlhbDsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2oubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzai5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4KHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBzcGhlcmVCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgdjNwb29sID0gdGhpcy52M3Bvb2w7IC8vIHdlIHJlZmVyIHRvIHRoZSBib3ggYXMgYm9keSBqCgogICAgICBjb25zdCBzaWRlcyA9IHNwaGVyZUJveF9zaWRlczsKICAgICAgeGkudnN1Yih4aiwgYm94X3RvX3NwaGVyZSk7CiAgICAgIHNqLmdldFNpZGVOb3JtYWxzKHNpZGVzLCBxaik7CiAgICAgIGNvbnN0IFIgPSBzaS5yYWRpdXM7CiAgICAgIGxldCBmb3VuZCA9IGZhbHNlOyAvLyBTdG9yZSB0aGUgcmVzdWx0aW5nIHNpZGUgcGVuZXRyYXRpb24gaW5mbwoKICAgICAgY29uc3Qgc2lkZV9ucyA9IHNwaGVyZUJveF9zaWRlX25zOwogICAgICBjb25zdCBzaWRlX25zMSA9IHNwaGVyZUJveF9zaWRlX25zMTsKICAgICAgY29uc3Qgc2lkZV9uczIgPSBzcGhlcmVCb3hfc2lkZV9uczI7CiAgICAgIGxldCBzaWRlX2ggPSBudWxsOwogICAgICBsZXQgc2lkZV9wZW5ldHJhdGlvbnMgPSAwOwogICAgICBsZXQgc2lkZV9kb3QxID0gMDsKICAgICAgbGV0IHNpZGVfZG90MiA9IDA7CiAgICAgIGxldCBzaWRlX2Rpc3RhbmNlID0gbnVsbDsKCiAgICAgIGZvciAobGV0IGlkeCA9IDAsIG5zaWRlcyA9IHNpZGVzLmxlbmd0aDsgaWR4ICE9PSBuc2lkZXMgJiYgZm91bmQgPT09IGZhbHNlOyBpZHgrKykgewogICAgICAgIC8vIEdldCB0aGUgcGxhbmUgc2lkZSBub3JtYWwgKG5zKQogICAgICAgIGNvbnN0IG5zID0gc3BoZXJlQm94X25zOwogICAgICAgIG5zLmNvcHkoc2lkZXNbaWR4XSk7CiAgICAgICAgY29uc3QgaCA9IG5zLmxlbmd0aCgpOwogICAgICAgIG5zLm5vcm1hbGl6ZSgpOyAvLyBUaGUgbm9ybWFsL2Rpc3RhbmNlIGRvdCBwcm9kdWN0IHRlbGxzIHdoaWNoIHNpZGUgb2YgdGhlIHBsYW5lIHdlIGFyZQoKICAgICAgICBjb25zdCBkb3QgPSBib3hfdG9fc3BoZXJlLmRvdChucyk7CgogICAgICAgIGlmIChkb3QgPCBoICsgUiAmJiBkb3QgPiAwKSB7CiAgICAgICAgICAvLyBJbnRlcnNlY3RzIHBsYW5lLiBOb3cgY2hlY2sgdGhlIG90aGVyIHR3byBkaW1lbnNpb25zCiAgICAgICAgICBjb25zdCBuczEgPSBzcGhlcmVCb3hfbnMxOwogICAgICAgICAgY29uc3QgbnMyID0gc3BoZXJlQm94X25zMjsKICAgICAgICAgIG5zMS5jb3B5KHNpZGVzWyhpZHggKyAxKSAlIDNdKTsKICAgICAgICAgIG5zMi5jb3B5KHNpZGVzWyhpZHggKyAyKSAlIDNdKTsKICAgICAgICAgIGNvbnN0IGgxID0gbnMxLmxlbmd0aCgpOwogICAgICAgICAgY29uc3QgaDIgPSBuczIubGVuZ3RoKCk7CiAgICAgICAgICBuczEubm9ybWFsaXplKCk7CiAgICAgICAgICBuczIubm9ybWFsaXplKCk7CiAgICAgICAgICBjb25zdCBkb3QxID0gYm94X3RvX3NwaGVyZS5kb3QobnMxKTsKICAgICAgICAgIGNvbnN0IGRvdDIgPSBib3hfdG9fc3BoZXJlLmRvdChuczIpOwoKICAgICAgICAgIGlmIChkb3QxIDwgaDEgJiYgZG90MSA+IC1oMSAmJiBkb3QyIDwgaDIgJiYgZG90MiA+IC1oMikgewogICAgICAgICAgICBjb25zdCBkaXN0ID0gTWF0aC5hYnMoZG90IC0gaCAtIFIpOwoKICAgICAgICAgICAgaWYgKHNpZGVfZGlzdGFuY2UgPT09IG51bGwgfHwgZGlzdCA8IHNpZGVfZGlzdGFuY2UpIHsKICAgICAgICAgICAgICBzaWRlX2Rpc3RhbmNlID0gZGlzdDsKICAgICAgICAgICAgICBzaWRlX2RvdDEgPSBkb3QxOwogICAgICAgICAgICAgIHNpZGVfZG90MiA9IGRvdDI7CiAgICAgICAgICAgICAgc2lkZV9oID0gaDsKICAgICAgICAgICAgICBzaWRlX25zLmNvcHkobnMpOwogICAgICAgICAgICAgIHNpZGVfbnMxLmNvcHkobnMxKTsKICAgICAgICAgICAgICBzaWRlX25zMi5jb3B5KG5zMik7CiAgICAgICAgICAgICAgc2lkZV9wZW5ldHJhdGlvbnMrKzsKCiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChzaWRlX3BlbmV0cmF0aW9ucykgewogICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICBzaWRlX25zLnNjYWxlKC1SLCByLnJpKTsgLy8gU3BoZXJlIHIKCiAgICAgICAgci5uaS5jb3B5KHNpZGVfbnMpOwogICAgICAgIHIubmkubmVnYXRlKHIubmkpOyAvLyBOb3JtYWwgc2hvdWxkIGJlIG91dCBvZiBzcGhlcmUKCiAgICAgICAgc2lkZV9ucy5zY2FsZShzaWRlX2gsIHNpZGVfbnMpOwogICAgICAgIHNpZGVfbnMxLnNjYWxlKHNpZGVfZG90MSwgc2lkZV9uczEpOwogICAgICAgIHNpZGVfbnMudmFkZChzaWRlX25zMSwgc2lkZV9ucyk7CiAgICAgICAgc2lkZV9uczIuc2NhbGUoc2lkZV9kb3QyLCBzaWRlX25zMik7CiAgICAgICAgc2lkZV9ucy52YWRkKHNpZGVfbnMyLCByLnJqKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgfSAvLyBDaGVjayBjb3JuZXJzCgoKICAgICAgbGV0IHJqID0gdjNwb29sLmdldCgpOwogICAgICBjb25zdCBzcGhlcmVfdG9fY29ybmVyID0gc3BoZXJlQm94X3NwaGVyZV90b19jb3JuZXI7CgogICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gMiAmJiAhZm91bmQ7IGorKykgewogICAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSAyICYmICFmb3VuZDsgaysrKSB7CiAgICAgICAgICBmb3IgKGxldCBsID0gMDsgbCAhPT0gMiAmJiAhZm91bmQ7IGwrKykgewogICAgICAgICAgICByai5zZXQoMCwgMCwgMCk7CgogICAgICAgICAgICBpZiAoaikgewogICAgICAgICAgICAgIHJqLnZhZGQoc2lkZXNbMF0sIHJqKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByai52c3ViKHNpZGVzWzBdLCByaik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChrKSB7CiAgICAgICAgICAgICAgcmoudmFkZChzaWRlc1sxXSwgcmopOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJqLnZzdWIoc2lkZXNbMV0sIHJqKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGwpIHsKICAgICAgICAgICAgICByai52YWRkKHNpZGVzWzJdLCByaik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmoudnN1YihzaWRlc1syXSwgcmopOwogICAgICAgICAgICB9IC8vIFdvcmxkIHBvc2l0aW9uIG9mIGNvcm5lcgoKCiAgICAgICAgICAgIHhqLnZhZGQocmosIHNwaGVyZV90b19jb3JuZXIpOwogICAgICAgICAgICBzcGhlcmVfdG9fY29ybmVyLnZzdWIoeGksIHNwaGVyZV90b19jb3JuZXIpOwoKICAgICAgICAgICAgaWYgKHNwaGVyZV90b19jb3JuZXIubGVuZ3RoU3F1YXJlZCgpIDwgUiAqIFIpIHsKICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgICAgIHIucmkuY29weShzcGhlcmVfdG9fY29ybmVyKTsKICAgICAgICAgICAgICByLnJpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHIubmkuY29weShyLnJpKTsKICAgICAgICAgICAgICByLnJpLnNjYWxlKFIsIHIucmkpOwogICAgICAgICAgICAgIHIucmouY29weShyaik7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgICAgci5yaS52c3ViKGJpLnBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHYzcG9vbC5yZWxlYXNlKHJqKTsKICAgICAgcmogPSBudWxsOyAvLyBDaGVjayBlZGdlcwoKICAgICAgY29uc3QgZWRnZVRhbmdlbnQgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IGVkZ2VDZW50ZXIgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IHIgPSB2M3Bvb2wuZ2V0KCk7IC8vIHIgPSBlZGdlIGNlbnRlciB0byBzcGhlcmUgY2VudGVyCgogICAgICBjb25zdCBvcnRob2dvbmFsID0gdjNwb29sLmdldCgpOwogICAgICBjb25zdCBkaXN0ID0gdjNwb29sLmdldCgpOwogICAgICBjb25zdCBOc2lkZXMgPSBzaWRlcy5sZW5ndGg7CgogICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gTnNpZGVzICYmICFmb3VuZDsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IE5zaWRlcyAmJiAhZm91bmQ7IGsrKykgewogICAgICAgICAgaWYgKGogJSAzICE9PSBrICUgMykgewogICAgICAgICAgICAvLyBHZXQgZWRnZSB0YW5nZW50CiAgICAgICAgICAgIHNpZGVzW2tdLmNyb3NzKHNpZGVzW2pdLCBlZGdlVGFuZ2VudCk7CiAgICAgICAgICAgIGVkZ2VUYW5nZW50Lm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBzaWRlc1tqXS52YWRkKHNpZGVzW2tdLCBlZGdlQ2VudGVyKTsKICAgICAgICAgICAgci5jb3B5KHhpKTsKICAgICAgICAgICAgci52c3ViKGVkZ2VDZW50ZXIsIHIpOwogICAgICAgICAgICByLnZzdWIoeGosIHIpOwogICAgICAgICAgICBjb25zdCBvcnRob25vcm0gPSByLmRvdChlZGdlVGFuZ2VudCk7IC8vIGRpc3RhbmNlIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIGNlbnRlciBpbiB0aGUgdGFuZ2VudCBkaXJlY3Rpb24KCiAgICAgICAgICAgIGVkZ2VUYW5nZW50LnNjYWxlKG9ydGhvbm9ybSwgb3J0aG9nb25hbCk7IC8vIFZlY3RvciBmcm9tIGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBjZW50ZXIgaW4gdGhlIHRhbmdlbnQgZGlyZWN0aW9uCiAgICAgICAgICAgIC8vIEZpbmQgdGhlIHRoaXJkIHNpZGUgb3J0aG9nb25hbCB0byB0aGlzIG9uZQoKICAgICAgICAgICAgbGV0IGwgPSAwOwoKICAgICAgICAgICAgd2hpbGUgKGwgPT09IGogJSAzIHx8IGwgPT09IGsgJSAzKSB7CiAgICAgICAgICAgICAgbCsrOwogICAgICAgICAgICB9IC8vIHZlYyBmcm9tIGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBwcm9qZWN0ZWQgdG8gdGhlIHBsYW5lIG9ydGhvZ29uYWwgdG8gdGhlIGVkZ2UgdGFuZ2VudAoKCiAgICAgICAgICAgIGRpc3QuY29weSh4aSk7CiAgICAgICAgICAgIGRpc3QudnN1YihvcnRob2dvbmFsLCBkaXN0KTsKICAgICAgICAgICAgZGlzdC52c3ViKGVkZ2VDZW50ZXIsIGRpc3QpOwogICAgICAgICAgICBkaXN0LnZzdWIoeGosIGRpc3QpOyAvLyBEaXN0YW5jZXMgaW4gdGFuZ2VudCBkaXJlY3Rpb24gYW5kIGRpc3RhbmNlIGluIHRoZSBwbGFuZSBvcnRob2dvbmFsIHRvIGl0CgogICAgICAgICAgICBjb25zdCB0ZGlzdCA9IE1hdGguYWJzKG9ydGhvbm9ybSk7CiAgICAgICAgICAgIGNvbnN0IG5kaXN0ID0gZGlzdC5sZW5ndGgoKTsKCiAgICAgICAgICAgIGlmICh0ZGlzdCA8IHNpZGVzW2xdLmxlbmd0aCgpICYmIG5kaXN0IDwgUikgewogICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgY29uc3QgcmVzID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgICBlZGdlQ2VudGVyLnZhZGQob3J0aG9nb25hbCwgcmVzLnJqKTsgLy8gYm94IHJqCgogICAgICAgICAgICAgIHJlcy5yai5jb3B5KHJlcy5yaik7CiAgICAgICAgICAgICAgZGlzdC5uZWdhdGUocmVzLm5pKTsKICAgICAgICAgICAgICByZXMubmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgcmVzLnJpLmNvcHkocmVzLnJqKTsKICAgICAgICAgICAgICByZXMucmkudmFkZCh4aiwgcmVzLnJpKTsKICAgICAgICAgICAgICByZXMucmkudnN1Yih4aSwgcmVzLnJpKTsKICAgICAgICAgICAgICByZXMucmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgcmVzLnJpLnNjYWxlKFIsIHJlcy5yaSk7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgICAgIHJlcy5yaS52YWRkKHhpLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS52c3ViKGJpLnBvc2l0aW9uLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yai52YWRkKHhqLCByZXMucmopOwogICAgICAgICAgICAgIHJlcy5yai52c3ViKGJqLnBvc2l0aW9uLCByZXMucmopOwogICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocmVzKTsKICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QocmVzLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdjNwb29sLnJlbGVhc2UoZWRnZVRhbmdlbnQsIGVkZ2VDZW50ZXIsIHIsIG9ydGhvZ29uYWwsIGRpc3QpOwogICAgfQoKICAgIHBsYW5lQm94KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNqLm1hdGVyaWFsOwogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzai5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmlkID0gc2ouaWQ7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQ29udmV4KHNpLCBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHNpLCBzaiwganVzdFRlc3QpOwogICAgfQoKICAgIGNvbnZleENvbnZleChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCwgZmFjZUxpc3RBLCBmYWNlTGlzdEIpIHsKICAgICAgY29uc3Qgc2VwQXhpcyA9IGNvbnZleENvbnZleF9zZXBBeGlzOwoKICAgICAgaWYgKHhpLmRpc3RhbmNlVG8oeGopID4gc2kuYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzai5ib3VuZGluZ1NwaGVyZVJhZGl1cykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHNpLmZpbmRTZXBhcmF0aW5nQXhpcyhzaiwgeGksIHFpLCB4aiwgcWosIHNlcEF4aXMsIGZhY2VMaXN0QSwgZmFjZUxpc3RCKSkgewogICAgICAgIGNvbnN0IHJlcyA9IFtdOwogICAgICAgIGNvbnN0IHEgPSBjb252ZXhDb252ZXhfcTsKICAgICAgICBzaS5jbGlwQWdhaW5zdEh1bGwoeGksIHFpLCBzaiwgeGosIHFqLCBzZXBBeGlzLCAtMTAwLCAxMDAsIHJlcyk7CiAgICAgICAgbGV0IG51bUNvbnRhY3RzID0gMDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IHJlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgY29uc3QgcmkgPSByLnJpOwogICAgICAgICAgY29uc3QgcmogPSByLnJqOwogICAgICAgICAgc2VwQXhpcy5uZWdhdGUoci5uaSk7CiAgICAgICAgICByZXNbal0ubm9ybWFsLm5lZ2F0ZShxKTsKICAgICAgICAgIHEuc2NhbGUocmVzW2pdLmRlcHRoLCBxKTsKICAgICAgICAgIHJlc1tqXS5wb2ludC52YWRkKHEsIHJpKTsKICAgICAgICAgIHJqLmNvcHkocmVzW2pdLnBvaW50KTsgLy8gQ29udGFjdCBwb2ludHMgYXJlIGluIHdvcmxkIGNvb3JkaW5hdGVzLiBUcmFuc2Zvcm0gYmFjayB0byByZWxhdGl2ZQoKICAgICAgICAgIHJpLnZzdWIoeGksIHJpKTsKICAgICAgICAgIHJqLnZzdWIoeGosIHJqKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICByaS52YWRkKHhpLCByaSk7CiAgICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAgICAgICByai52YWRkKHhqLCByaik7CiAgICAgICAgICByai52c3ViKGJqLnBvc2l0aW9uLCByaik7CiAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgbnVtQ29udGFjdHMrKzsKCiAgICAgICAgICBpZiAoIXRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24pIHsKICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24gJiYgbnVtQ29udGFjdHMpIHsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25Gcm9tQXZlcmFnZShudW1Db250YWN0cyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc3BoZXJlQ29udmV4KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IHYzcG9vbCA9IHRoaXMudjNwb29sOwogICAgICB4aS52c3ViKHhqLCBjb252ZXhfdG9fc3BoZXJlKTsKICAgICAgY29uc3Qgbm9ybWFscyA9IHNqLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBmYWNlcyA9IHNqLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0cyA9IHNqLnZlcnRpY2VzOwogICAgICBjb25zdCBSID0gc2kucmFkaXVzOyAvLyAgICAgcmV0dXJuOwogICAgICAvLyB9CgogICAgICBsZXQgZm91bmQgPSBmYWxzZTsgLy8gQ2hlY2sgY29ybmVycwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IHZlcnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IHZlcnRzW2ldOyAvLyBXb3JsZCBwb3NpdGlvbiBvZiBjb3JuZXIKCiAgICAgICAgY29uc3Qgd29ybGRDb3JuZXIgPSBzcGhlcmVDb252ZXhfd29ybGRDb3JuZXI7CiAgICAgICAgcWoudm11bHQodiwgd29ybGRDb3JuZXIpOwogICAgICAgIHhqLnZhZGQod29ybGRDb3JuZXIsIHdvcmxkQ29ybmVyKTsKICAgICAgICBjb25zdCBzcGhlcmVfdG9fY29ybmVyID0gc3BoZXJlQ29udmV4X3NwaGVyZVRvQ29ybmVyOwogICAgICAgIHdvcmxkQ29ybmVyLnZzdWIoeGksIHNwaGVyZV90b19jb3JuZXIpOwoKICAgICAgICBpZiAoc3BoZXJlX3RvX2Nvcm5lci5sZW5ndGhTcXVhcmVkKCkgPCBSICogUikgewogICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgci5yaS5jb3B5KHNwaGVyZV90b19jb3JuZXIpOwogICAgICAgICAgci5yaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHIubmkuY29weShyLnJpKTsKICAgICAgICAgIHIucmkuc2NhbGUoUiwgci5yaSk7CiAgICAgICAgICB3b3JsZENvcm5lci52c3ViKHhqLCByLnJqKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfSAvLyBDaGVjayBzaWRlIChwbGFuZSkgaW50ZXJzZWN0aW9ucwoKCiAgICAgIGZvciAobGV0IGkgPSAwLCBuZmFjZXMgPSBmYWNlcy5sZW5ndGg7IGkgIT09IG5mYWNlcyAmJiBmb3VuZCA9PT0gZmFsc2U7IGkrKykgewogICAgICAgIGNvbnN0IG5vcm1hbCA9IG5vcm1hbHNbaV07CiAgICAgICAgY29uc3QgZmFjZSA9IGZhY2VzW2ldOyAvLyBHZXQgd29ybGQtdHJhbnNmb3JtZWQgbm9ybWFsIG9mIHRoZSBmYWNlCgogICAgICAgIGNvbnN0IHdvcmxkTm9ybWFsID0gc3BoZXJlQ29udmV4X3dvcmxkTm9ybWFsOwogICAgICAgIHFqLnZtdWx0KG5vcm1hbCwgd29ybGROb3JtYWwpOyAvLyBHZXQgYSB3b3JsZCB2ZXJ0ZXggZnJvbSB0aGUgZmFjZQoKICAgICAgICBjb25zdCB3b3JsZFBvaW50ID0gc3BoZXJlQ29udmV4X3dvcmxkUG9pbnQ7CiAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVswXV0sIHdvcmxkUG9pbnQpOwogICAgICAgIHdvcmxkUG9pbnQudmFkZCh4aiwgd29ybGRQb2ludCk7IC8vIEdldCBhIHBvaW50IG9uIHRoZSBzcGhlcmUsIGNsb3Nlc3QgdG8gdGhlIGZhY2Ugbm9ybWFsCgogICAgICAgIGNvbnN0IHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSA9IHNwaGVyZUNvbnZleF93b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmU7CiAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLVIsIHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSk7CiAgICAgICAgeGkudmFkZCh3b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUsIHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSk7IC8vIFZlY3RvciBmcm9tIGEgZmFjZSBwb2ludCB0byB0aGUgY2xvc2VzdCBwb2ludCBvbiB0aGUgc3BoZXJlCgogICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjID0gc3BoZXJlQ29udmV4X3BlbmV0cmF0aW9uVmVjOwogICAgICAgIHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZS52c3ViKHdvcmxkUG9pbnQsIHBlbmV0cmF0aW9uVmVjKTsgLy8gVGhlIHBlbmV0cmF0aW9uLiBOZWdhdGl2ZSB2YWx1ZSBtZWFucyBvdmVybGFwLgoKICAgICAgICBjb25zdCBwZW5ldHJhdGlvbiA9IHBlbmV0cmF0aW9uVmVjLmRvdCh3b3JsZE5vcm1hbCk7CiAgICAgICAgY29uc3Qgd29ybGRQb2ludFRvU3BoZXJlID0gc3BoZXJlQ29udmV4X3NwaGVyZVRvV29ybGRQb2ludDsKICAgICAgICB4aS52c3ViKHdvcmxkUG9pbnQsIHdvcmxkUG9pbnRUb1NwaGVyZSk7CgogICAgICAgIGlmIChwZW5ldHJhdGlvbiA8IDAgJiYgd29ybGRQb2ludFRvU3BoZXJlLmRvdCh3b3JsZE5vcm1hbCkgPiAwKSB7CiAgICAgICAgICAvLyBJbnRlcnNlY3RzIHBsYW5lLiBOb3cgY2hlY2sgaWYgdGhlIHNwaGVyZSBpcyBpbnNpZGUgdGhlIGZhY2UgcG9seWdvbgogICAgICAgICAgY29uc3QgZmFjZVZlcnRzID0gW107IC8vIEZhY2UgdmVydGljZXMsIGluIHdvcmxkIGNvb3JkcwoKICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOdmVydHMgPSBmYWNlLmxlbmd0aDsgaiAhPT0gTnZlcnRzOyBqKyspIHsKICAgICAgICAgICAgY29uc3Qgd29ybGRWZXJ0ZXggPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgIHFqLnZtdWx0KHZlcnRzW2ZhY2Vbal1dLCB3b3JsZFZlcnRleCk7CiAgICAgICAgICAgIHhqLnZhZGQod29ybGRWZXJ0ZXgsIHdvcmxkVmVydGV4KTsKICAgICAgICAgICAgZmFjZVZlcnRzLnB1c2god29ybGRWZXJ0ZXgpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChwb2ludEluUG9seWdvbihmYWNlVmVydHMsIHdvcmxkTm9ybWFsLCB4aSkpIHsKICAgICAgICAgICAgLy8gSXMgdGhlIHNwaGVyZSBjZW50ZXIgaW4gdGhlIGZhY2UgcG9seWdvbj8KICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgIHdvcmxkTm9ybWFsLnNjYWxlKC1SLCByLnJpKTsgLy8gQ29udGFjdCBvZmZzZXQsIGZyb20gc3BoZXJlIGNlbnRlciB0byBjb250YWN0CgogICAgICAgICAgICB3b3JsZE5vcm1hbC5uZWdhdGUoci5uaSk7IC8vIE5vcm1hbCBwb2ludGluZyBvdXQgb2Ygc3BoZXJlCgogICAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvblZlYzIgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgIHdvcmxkTm9ybWFsLnNjYWxlKC1wZW5ldHJhdGlvbiwgcGVuZXRyYXRpb25WZWMyKTsKICAgICAgICAgICAgY29uc3QgcGVuZXRyYXRpb25TcGhlcmVQb2ludCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLVIsIHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQpOyAvL3hpLnZzdWIoeGopLnZhZGQocGVuZXRyYXRpb25TcGhlcmVQb2ludCkudmFkZChwZW5ldHJhdGlvblZlYzIgLCByLnJqKTsKCiAgICAgICAgICAgIHhpLnZzdWIoeGosIHIucmopOwogICAgICAgICAgICByLnJqLnZhZGQocGVuZXRyYXRpb25TcGhlcmVQb2ludCwgci5yaik7CiAgICAgICAgICAgIHIucmoudmFkZChwZW5ldHJhdGlvblZlYzIsIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShwZW5ldHJhdGlvblZlYzIpOwogICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShwZW5ldHJhdGlvblNwaGVyZVBvaW50KTsKICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOyAvLyBSZWxlYXNlIHdvcmxkIHZlcnRpY2VzCgogICAgICAgICAgICBmb3IgKGxldCBqID0gMCwgTmZhY2V2ZXJ0cyA9IGZhY2VWZXJ0cy5sZW5ndGg7IGogIT09IE5mYWNldmVydHM7IGorKykgewogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKGZhY2VWZXJ0c1tqXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybjsgLy8gV2Ugb25seSBleHBlY3QgKm9uZSogZmFjZSBjb250YWN0CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBFZGdlPwogICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gZmFjZS5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgIC8vIEdldCB0d28gd29ybGQgdHJhbnNmb3JtZWQgdmVydGljZXMKICAgICAgICAgICAgICBjb25zdCB2MSA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgICBjb25zdCB2MiA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWyhqICsgMSkgJSBmYWNlLmxlbmd0aF1dLCB2MSk7CiAgICAgICAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVsoaiArIDIpICUgZmFjZS5sZW5ndGhdXSwgdjIpOwogICAgICAgICAgICAgIHhqLnZhZGQodjEsIHYxKTsKICAgICAgICAgICAgICB4ai52YWRkKHYyLCB2Mik7IC8vIENvbnN0cnVjdCBlZGdlIHZlY3RvcgoKICAgICAgICAgICAgICBjb25zdCBlZGdlID0gc3BoZXJlQ29udmV4X2VkZ2U7CiAgICAgICAgICAgICAgdjIudnN1Yih2MSwgZWRnZSk7IC8vIENvbnN0cnVjdCB0aGUgc2FtZSB2ZWN0b3IsIGJ1dCBub3JtYWxpemVkCgogICAgICAgICAgICAgIGNvbnN0IGVkZ2VVbml0ID0gc3BoZXJlQ29udmV4X2VkZ2VVbml0OwogICAgICAgICAgICAgIGVkZ2UudW5pdChlZGdlVW5pdCk7IC8vIHAgaXMgeGkgcHJvamVjdGVkIG9udG8gdGhlIGVkZ2UKCiAgICAgICAgICAgICAgY29uc3QgcCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgICBjb25zdCB2MV90b194aSA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgICB4aS52c3ViKHYxLCB2MV90b194aSk7CiAgICAgICAgICAgICAgY29uc3QgZG90ID0gdjFfdG9feGkuZG90KGVkZ2VVbml0KTsKICAgICAgICAgICAgICBlZGdlVW5pdC5zY2FsZShkb3QsIHApOwogICAgICAgICAgICAgIHAudmFkZCh2MSwgcCk7IC8vIENvbXB1dGUgYSB2ZWN0b3IgZnJvbSBwIHRvIHRoZSBjZW50ZXIgb2YgdGhlIHNwaGVyZQoKICAgICAgICAgICAgICBjb25zdCB4aV90b19wID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHAudnN1Yih4aSwgeGlfdG9fcCk7IC8vIENvbGxpc2lvbiBpZiB0aGUgZWRnZS1zcGhlcmUgZGlzdGFuY2UgaXMgbGVzcyB0aGFuIHRoZSByYWRpdXMKICAgICAgICAgICAgICAvLyBBTkQgaWYgcCBpcyBpbiBiZXR3ZWVuIHYxIGFuZCB2MgoKICAgICAgICAgICAgICBpZiAoZG90ID4gMCAmJiBkb3QgKiBkb3QgPCBlZGdlLmxlbmd0aFNxdWFyZWQoKSAmJiB4aV90b19wLmxlbmd0aFNxdWFyZWQoKSA8IFIgKiBSKSB7CiAgICAgICAgICAgICAgICAvLyBDb2xsaXNpb24gaWYgdGhlIGVkZ2Utc3BoZXJlIGRpc3RhbmNlIGlzIGxlc3MgdGhhbiB0aGUgcmFkaXVzCiAgICAgICAgICAgICAgICAvLyBFZGdlIGNvbnRhY3QhCiAgICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgICAgICBwLnZzdWIoeGosIHIucmopOwogICAgICAgICAgICAgICAgcC52c3ViKHhpLCByLm5pKTsKICAgICAgICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICByLm5pLnNjYWxlKFIsIHIucmkpOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgICAgICAgICAgci5yaS52c3ViKGJpLnBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMCwgTmZhY2V2ZXJ0cyA9IGZhY2VWZXJ0cy5sZW5ndGg7IGogIT09IE5mYWNldmVydHM7IGorKykgewogICAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShmYWNlVmVydHNbal0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYyKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHApOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoeGlfdG9fcCk7CiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2MV90b194aSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2MSk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjIpOwogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHApOwogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHhpX3RvX3ApOwogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxX3RvX3hpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSAvLyBSZWxlYXNlIHdvcmxkIHZlcnRpY2VzCgoKICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKGZhY2VWZXJ0c1tqXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgcGxhbmVDb252ZXgocGxhbmVTaGFwZSwgY29udmV4U2hhcGUsIHBsYW5lUG9zaXRpb24sIGNvbnZleFBvc2l0aW9uLCBwbGFuZVF1YXQsIGNvbnZleFF1YXQsIHBsYW5lQm9keSwgY29udmV4Qm9keSwgc2ksIHNqLCBqdXN0VGVzdCkgewogICAgICAvLyBTaW1wbHkgcmV0dXJuIHRoZSBwb2ludHMgYmVoaW5kIHRoZSBwbGFuZS4KICAgICAgY29uc3Qgd29ybGRWZXJ0ZXggPSBwbGFuZUNvbnZleF92OwogICAgICBjb25zdCB3b3JsZE5vcm1hbCA9IHBsYW5lQ29udmV4X25vcm1hbDsKICAgICAgd29ybGROb3JtYWwuc2V0KDAsIDAsIDEpOwogICAgICBwbGFuZVF1YXQudm11bHQod29ybGROb3JtYWwsIHdvcmxkTm9ybWFsKTsgLy8gVHVybiBub3JtYWwgYWNjb3JkaW5nIHRvIHBsYW5lIG9yaWVudGF0aW9uCgogICAgICBsZXQgbnVtQ29udGFjdHMgPSAwOwogICAgICBjb25zdCByZWxwb3MgPSBwbGFuZUNvbnZleF9yZWxwb3M7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gY29udmV4U2hhcGUudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBHZXQgd29ybGQgY29udmV4IHZlcnRleAogICAgICAgIHdvcmxkVmVydGV4LmNvcHkoY29udmV4U2hhcGUudmVydGljZXNbaV0pOwogICAgICAgIGNvbnZleFF1YXQudm11bHQod29ybGRWZXJ0ZXgsIHdvcmxkVmVydGV4KTsKICAgICAgICBjb252ZXhQb3NpdGlvbi52YWRkKHdvcmxkVmVydGV4LCB3b3JsZFZlcnRleCk7CiAgICAgICAgd29ybGRWZXJ0ZXgudnN1YihwbGFuZVBvc2l0aW9uLCByZWxwb3MpOwogICAgICAgIGNvbnN0IGRvdCA9IHdvcmxkTm9ybWFsLmRvdChyZWxwb3MpOwoKICAgICAgICBpZiAoZG90IDw9IDAuMCkgewogICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihwbGFuZUJvZHksIGNvbnZleEJvZHksIHBsYW5lU2hhcGUsIGNvbnZleFNoYXBlLCBzaSwgc2opOyAvLyBHZXQgdmVydGV4IHBvc2l0aW9uIHByb2plY3RlZCBvbiBwbGFuZQoKICAgICAgICAgIGNvbnN0IHByb2plY3RlZCA9IHBsYW5lQ29udmV4X3Byb2plY3RlZDsKICAgICAgICAgIHdvcmxkTm9ybWFsLnNjYWxlKHdvcmxkTm9ybWFsLmRvdChyZWxwb3MpLCBwcm9qZWN0ZWQpOwogICAgICAgICAgd29ybGRWZXJ0ZXgudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7CiAgICAgICAgICBwcm9qZWN0ZWQudnN1YihwbGFuZVBvc2l0aW9uLCByLnJpKTsgLy8gRnJvbSBwbGFuZSB0byB2ZXJ0ZXggcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgICAgci5uaS5jb3B5KHdvcmxkTm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbCBvdXQgZnJvbSBwbGFuZQogICAgICAgICAgLy8gcmogaXMgbm93IGp1c3QgdGhlIHZlY3RvciBmcm9tIHRoZSBjb252ZXggY2VudGVyIHRvIHRoZSB2ZXJ0ZXgKCiAgICAgICAgICB3b3JsZFZlcnRleC52c3ViKGNvbnZleFBvc2l0aW9uLCByLnJqKTsgLy8gTWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgYm9keQoKICAgICAgICAgIHIucmkudmFkZChwbGFuZVBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgIHIucmkudnN1YihwbGFuZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yai52YWRkKGNvbnZleFBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgIHIucmoudnN1Yihjb252ZXhCb2R5LnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICBudW1Db250YWN0cysrOwoKICAgICAgICAgIGlmICghdGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbikgewogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAodGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbiAmJiBudW1Db250YWN0cykgewogICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25Gcm9tQXZlcmFnZShudW1Db250YWN0cyk7CiAgICAgIH0KICAgIH0KCiAgICBib3hDb252ZXgoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXgoc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlSGVpZ2h0ZmllbGQoc3BoZXJlU2hhcGUsIGhmU2hhcGUsIHNwaGVyZVBvcywgaGZQb3MsIHNwaGVyZVF1YXQsIGhmUXVhdCwgc3BoZXJlQm9keSwgaGZCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgZGF0YSA9IGhmU2hhcGUuZGF0YTsKICAgICAgY29uc3QgcmFkaXVzID0gc3BoZXJlU2hhcGUucmFkaXVzOwogICAgICBjb25zdCB3ID0gaGZTaGFwZS5lbGVtZW50U2l6ZTsKICAgICAgY29uc3Qgd29ybGRQaWxsYXJPZmZzZXQgPSBzcGhlcmVIZWlnaHRmaWVsZF90bXAyOyAvLyBHZXQgc3BoZXJlIHBvc2l0aW9uIHRvIGhlaWdodGZpZWxkIGxvY2FsIQoKICAgICAgY29uc3QgbG9jYWxTcGhlcmVQb3MgPSBzcGhlcmVIZWlnaHRmaWVsZF90bXAxOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUoaGZQb3MsIGhmUXVhdCwgc3BoZXJlUG9zLCBsb2NhbFNwaGVyZVBvcyk7IC8vIEdldCB0aGUgaW5kZXggb2YgdGhlIGRhdGEgcG9pbnRzIHRvIHRlc3QgYWdhaW5zdAoKICAgICAgbGV0IGlNaW5YID0gTWF0aC5mbG9vcigobG9jYWxTcGhlcmVQb3MueCAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WCA9IE1hdGguY2VpbCgobG9jYWxTcGhlcmVQb3MueCArIHJhZGl1cykgLyB3KSArIDE7CiAgICAgIGxldCBpTWluWSA9IE1hdGguZmxvb3IoKGxvY2FsU3BoZXJlUG9zLnkgLSByYWRpdXMpIC8gdykgLSAxOwogICAgICBsZXQgaU1heFkgPSBNYXRoLmNlaWwoKGxvY2FsU3BoZXJlUG9zLnkgKyByYWRpdXMpIC8gdykgKyAxOyAvLyBCYWlsIG91dCBpZiB3ZSBhcmUgb3V0IG9mIHRoZSB0ZXJyYWluCgogICAgICBpZiAoaU1heFggPCAwIHx8IGlNYXhZIDwgMCB8fCBpTWluWCA+IGRhdGEubGVuZ3RoIHx8IGlNaW5ZID4gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gQ2xhbXAgaW5kZXggdG8gZWRnZXMKCgogICAgICBpZiAoaU1pblggPCAwKSB7CiAgICAgICAgaU1pblggPSAwOwogICAgICB9CgogICAgICBpZiAoaU1heFggPCAwKSB7CiAgICAgICAgaU1heFggPSAwOwogICAgICB9CgogICAgICBpZiAoaU1pblkgPCAwKSB7CiAgICAgICAgaU1pblkgPSAwOwogICAgICB9CgogICAgICBpZiAoaU1heFkgPCAwKSB7CiAgICAgICAgaU1heFkgPSAwOwogICAgICB9CgogICAgICBpZiAoaU1pblggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWluWCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhYID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgaU1heFggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNYXhZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1pblkgPj0gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICBpTWluWSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgY29uc3QgbWluTWF4ID0gW107CiAgICAgIGhmU2hhcGUuZ2V0UmVjdE1pbk1heChpTWluWCwgaU1pblksIGlNYXhYLCBpTWF4WSwgbWluTWF4KTsKICAgICAgY29uc3QgbWluID0gbWluTWF4WzBdOwogICAgICBjb25zdCBtYXggPSBtaW5NYXhbMV07IC8vIEJhaWwgb3V0IGlmIHdlIGNhbid0IHRvdWNoIHRoZSBib3VuZGluZyBoZWlnaHQgYm94CgogICAgICBpZiAobG9jYWxTcGhlcmVQb3MueiAtIHJhZGl1cyA+IG1heCB8fCBsb2NhbFNwaGVyZVBvcy56ICsgcmFkaXVzIDwgbWluKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdDsKCiAgICAgIGZvciAobGV0IGkgPSBpTWluWDsgaSA8IGlNYXhYOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gaU1pblk7IGogPCBpTWF4WTsgaisrKSB7CiAgICAgICAgICBjb25zdCBudW1Db250YWN0c0JlZm9yZSA9IHJlc3VsdC5sZW5ndGg7CiAgICAgICAgICBsZXQgaW50ZXJzZWN0aW5nID0gZmFsc2U7IC8vIExvd2VyIHRyaWFuZ2xlCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCBmYWxzZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUoaGZQb3MsIGhmUXVhdCwgaGZTaGFwZS5waWxsYXJPZmZzZXQsIHdvcmxkUGlsbGFyT2Zmc2V0KTsKCiAgICAgICAgICBpZiAoc3BoZXJlUG9zLmRpc3RhbmNlVG8od29ybGRQaWxsYXJPZmZzZXQpIDwgaGZTaGFwZS5waWxsYXJDb252ZXguYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzcGhlcmVTaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1cykgewogICAgICAgICAgICBpbnRlcnNlY3RpbmcgPSB0aGlzLnNwaGVyZUNvbnZleChzcGhlcmVTaGFwZSwgaGZTaGFwZS5waWxsYXJDb252ZXgsIHNwaGVyZVBvcywgd29ybGRQaWxsYXJPZmZzZXQsIHNwaGVyZVF1YXQsIGhmUXVhdCwgc3BoZXJlQm9keSwgaGZCb2R5LCBzcGhlcmVTaGFwZSwgaGZTaGFwZSwganVzdFRlc3QpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChqdXN0VGVzdCAmJiBpbnRlcnNlY3RpbmcpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9IC8vIFVwcGVyIHRyaWFuZ2xlCgoKICAgICAgICAgIGhmU2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgdHJ1ZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUoaGZQb3MsIGhmUXVhdCwgaGZTaGFwZS5waWxsYXJPZmZzZXQsIHdvcmxkUGlsbGFyT2Zmc2V0KTsKCiAgICAgICAgICBpZiAoc3BoZXJlUG9zLmRpc3RhbmNlVG8od29ybGRQaWxsYXJPZmZzZXQpIDwgaGZTaGFwZS5waWxsYXJDb252ZXguYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzcGhlcmVTaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1cykgewogICAgICAgICAgICBpbnRlcnNlY3RpbmcgPSB0aGlzLnNwaGVyZUNvbnZleChzcGhlcmVTaGFwZSwgaGZTaGFwZS5waWxsYXJDb252ZXgsIHNwaGVyZVBvcywgd29ybGRQaWxsYXJPZmZzZXQsIHNwaGVyZVF1YXQsIGhmUXVhdCwgc3BoZXJlQm9keSwgaGZCb2R5LCBzcGhlcmVTaGFwZSwgaGZTaGFwZSwganVzdFRlc3QpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChqdXN0VGVzdCAmJiBpbnRlcnNlY3RpbmcpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgbnVtQ29udGFjdHMgPSByZXN1bHQubGVuZ3RoIC0gbnVtQ29udGFjdHNCZWZvcmU7CgogICAgICAgICAgaWYgKG51bUNvbnRhY3RzID4gMikgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICAvKgogICAgICAgICAgICAvLyBTa2lwIGFsbCBidXQgMQogICAgICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IG51bUNvbnRhY3RzIC0gMTsgaysrKSB7CiAgICAgICAgICAgICAgICByZXN1bHQucG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICovCgogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGJveEhlaWdodGZpZWxkKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNpLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4SGVpZ2h0ZmllbGQoc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgY29udmV4SGVpZ2h0ZmllbGQoY29udmV4U2hhcGUsIGhmU2hhcGUsIGNvbnZleFBvcywgaGZQb3MsIGNvbnZleFF1YXQsIGhmUXVhdCwgY29udmV4Qm9keSwgaGZCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgZGF0YSA9IGhmU2hhcGUuZGF0YTsKICAgICAgY29uc3QgdyA9IGhmU2hhcGUuZWxlbWVudFNpemU7CiAgICAgIGNvbnN0IHJhZGl1cyA9IGNvbnZleFNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzOwogICAgICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IGNvbnZleEhlaWdodGZpZWxkX3RtcDI7CiAgICAgIGNvbnN0IGZhY2VMaXN0ID0gY29udmV4SGVpZ2h0ZmllbGRfZmFjZUxpc3Q7IC8vIEdldCBzcGhlcmUgcG9zaXRpb24gdG8gaGVpZ2h0ZmllbGQgbG9jYWwhCgogICAgICBjb25zdCBsb2NhbENvbnZleFBvcyA9IGNvbnZleEhlaWdodGZpZWxkX3RtcDE7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShoZlBvcywgaGZRdWF0LCBjb252ZXhQb3MsIGxvY2FsQ29udmV4UG9zKTsgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CgogICAgICBsZXQgaU1pblggPSBNYXRoLmZsb29yKChsb2NhbENvbnZleFBvcy54IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhYID0gTWF0aC5jZWlsKChsb2NhbENvbnZleFBvcy54ICsgcmFkaXVzKSAvIHcpICsgMTsKICAgICAgbGV0IGlNaW5ZID0gTWF0aC5mbG9vcigobG9jYWxDb252ZXhQb3MueSAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WSA9IE1hdGguY2VpbCgobG9jYWxDb252ZXhQb3MueSArIHJhZGl1cykgLyB3KSArIDE7IC8vIEJhaWwgb3V0IGlmIHdlIGFyZSBvdXQgb2YgdGhlIHRlcnJhaW4KCiAgICAgIGlmIChpTWF4WCA8IDAgfHwgaU1heFkgPCAwIHx8IGlNaW5YID4gZGF0YS5sZW5ndGggfHwgaU1pblkgPiBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBDbGFtcCBpbmRleCB0byBlZGdlcwoKCiAgICAgIGlmIChpTWluWCA8IDApIHsKICAgICAgICBpTWluWCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA8IDApIHsKICAgICAgICBpTWF4WCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA8IDApIHsKICAgICAgICBpTWluWSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA8IDApIHsKICAgICAgICBpTWF4WSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNaW5YID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWF4WCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1heFkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNaW5ZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBjb25zdCBtaW5NYXggPSBbXTsKICAgICAgaGZTaGFwZS5nZXRSZWN0TWluTWF4KGlNaW5YLCBpTWluWSwgaU1heFgsIGlNYXhZLCBtaW5NYXgpOwogICAgICBjb25zdCBtaW4gPSBtaW5NYXhbMF07CiAgICAgIGNvbnN0IG1heCA9IG1pbk1heFsxXTsgLy8gQmFpbCBvdXQgaWYgd2UncmUgY2FudCB0b3VjaCB0aGUgYm91bmRpbmcgaGVpZ2h0IGJveAoKICAgICAgaWYgKGxvY2FsQ29udmV4UG9zLnogLSByYWRpdXMgPiBtYXggfHwgbG9jYWxDb252ZXhQb3MueiArIHJhZGl1cyA8IG1pbikgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDwgaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8IGlNYXhZOyBqKyspIHsKICAgICAgICAgIGxldCBpbnRlcnNlY3RpbmcgPSBmYWxzZTsgLy8gTG93ZXIgdHJpYW5nbGUKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChjb252ZXhQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIGNvbnZleFNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuY29udmV4Q29udmV4KGNvbnZleFNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgY29udmV4UG9zLCB3b3JsZFBpbGxhck9mZnNldCwgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIG51bGwsIG51bGwsIGp1c3RUZXN0LCBmYWNlTGlzdCwgbnVsbCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCB0cnVlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChjb252ZXhQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIGNvbnZleFNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuY29udmV4Q29udmV4KGNvbnZleFNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgY29udmV4UG9zLCB3b3JsZFBpbGxhck9mZnNldCwgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIG51bGwsIG51bGwsIGp1c3RUZXN0LCBmYWNlTGlzdCwgbnVsbCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzcGhlcmVQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICAvLyBUaGUgbm9ybWFsIGlzIHRoZSB1bml0IHZlY3RvciBmcm9tIHNwaGVyZSBjZW50ZXIgdG8gcGFydGljbGUgY2VudGVyCiAgICAgIGNvbnN0IG5vcm1hbCA9IHBhcnRpY2xlU3BoZXJlX25vcm1hbDsKICAgICAgbm9ybWFsLnNldCgwLCAwLCAxKTsKICAgICAgeGkudnN1Yih4aiwgbm9ybWFsKTsKICAgICAgY29uc3QgbGVuZ3RoU3F1YXJlZCA9IG5vcm1hbC5sZW5ndGhTcXVhcmVkKCk7CgogICAgICBpZiAobGVuZ3RoU3F1YXJlZCA8PSBzai5yYWRpdXMgKiBzai5yYWRpdXMpIHsKICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICAgIHIucmouY29weShub3JtYWwpOwogICAgICAgIHIucmouc2NhbGUoc2oucmFkaXVzLCByLnJqKTsKICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwKCiAgICAgICAgci5uaS5uZWdhdGUoci5uaSk7CiAgICAgICAgci5yaS5zZXQoMCwgMCwgMCk7IC8vIENlbnRlciBvZiBwYXJ0aWNsZQoKICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgfQogICAgfQoKICAgIHBsYW5lUGFydGljbGUoc2osIHNpLCB4aiwgeGksIHFqLCBxaSwgYmosIGJpLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3Qgbm9ybWFsID0gcGFydGljbGVQbGFuZV9ub3JtYWw7CiAgICAgIG5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIGJqLnF1YXRlcm5pb24udm11bHQobm9ybWFsLCBub3JtYWwpOyAvLyBUdXJuIG5vcm1hbCBhY2NvcmRpbmcgdG8gcGxhbmUgb3JpZW50YXRpb24KCiAgICAgIGNvbnN0IHJlbHBvcyA9IHBhcnRpY2xlUGxhbmVfcmVscG9zOwogICAgICB4aS52c3ViKGJqLnBvc2l0aW9uLCByZWxwb3MpOwogICAgICBjb25zdCBkb3QgPSBub3JtYWwuZG90KHJlbHBvcyk7CgogICAgICBpZiAoZG90IDw9IDAuMCkgewogICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbAoKICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgICAgICByLnJpLnNldCgwLCAwLCAwKTsgLy8gQ2VudGVyIG9mIHBhcnRpY2xlCiAgICAgICAgLy8gR2V0IHBhcnRpY2xlIHBvc2l0aW9uIHByb2plY3RlZCBvbiBwbGFuZQoKICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBwYXJ0aWNsZVBsYW5lX3Byb2plY3RlZDsKICAgICAgICBub3JtYWwuc2NhbGUobm9ybWFsLmRvdCh4aSksIHByb2plY3RlZCk7CiAgICAgICAgeGkudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7IC8vcHJvamVjdGVkLnZhZGQoYmoucG9zaXRpb24scHJvamVjdGVkKTsKICAgICAgICAvLyByaiBpcyBub3cgdGhlIHByb2plY3RlZCB3b3JsZCBwb3NpdGlvbiBtaW51cyBwbGFuZSBwb3NpdGlvbgoKICAgICAgICByLnJqLmNvcHkocHJvamVjdGVkKTsKICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgfQogICAgfQoKICAgIGJveFBhcnRpY2xlKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNpLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4UGFydGljbGUoc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgY29udmV4UGFydGljbGUoc2osIHNpLCB4aiwgeGksIHFqLCBxaSwgYmosIGJpLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgbGV0IHBlbmV0cmF0ZWRGYWNlSW5kZXggPSAtMTsKICAgICAgY29uc3QgcGVuZXRyYXRlZEZhY2VOb3JtYWwgPSBjb252ZXhQYXJ0aWNsZV9wZW5ldHJhdGVkRmFjZU5vcm1hbDsKICAgICAgY29uc3Qgd29ybGRQZW5ldHJhdGlvblZlYyA9IGNvbnZleFBhcnRpY2xlX3dvcmxkUGVuZXRyYXRpb25WZWM7CiAgICAgIGxldCBtaW5QZW5ldHJhdGlvbiA9IG51bGw7CiAgICAgIGNvbnN0IGxvY2FsID0gY29udmV4UGFydGljbGVfbG9jYWw7CiAgICAgIGxvY2FsLmNvcHkoeGkpOwogICAgICBsb2NhbC52c3ViKHhqLCBsb2NhbCk7IC8vIENvbnZlcnQgcG9zaXRpb24gdG8gcmVsYXRpdmUgdGhlIGNvbnZleCBvcmlnaW4KCiAgICAgIHFqLmNvbmp1Z2F0ZShjcWopOwogICAgICBjcWoudm11bHQobG9jYWwsIGxvY2FsKTsKCiAgICAgIGlmIChzai5wb2ludElzSW5zaWRlKGxvY2FsKSkgewogICAgICAgIGlmIChzai53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIHNqLmNvbXB1dGVXb3JsZFZlcnRpY2VzKHhqLCBxaik7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2oud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlKSB7CiAgICAgICAgICBzai5jb21wdXRlV29ybGRGYWNlTm9ybWFscyhxaik7CiAgICAgICAgfSAvLyBGb3IgZWFjaCB3b3JsZCBwb2x5Z29uIGluIHRoZSBwb2x5aGVkcmEKCgogICAgICAgIGZvciAobGV0IGkgPSAwLCBuZmFjZXMgPSBzai5mYWNlcy5sZW5ndGg7IGkgIT09IG5mYWNlczsgaSsrKSB7CiAgICAgICAgICAvLyBDb25zdHJ1Y3Qgd29ybGQgZmFjZSB2ZXJ0aWNlcwogICAgICAgICAgY29uc3QgdmVydHMgPSBbc2oud29ybGRWZXJ0aWNlc1tzai5mYWNlc1tpXVswXV1dOwogICAgICAgICAgY29uc3Qgbm9ybWFsID0gc2oud29ybGRGYWNlTm9ybWFsc1tpXTsgLy8gQ2hlY2sgaG93IG11Y2ggdGhlIHBhcnRpY2xlIHBlbmV0cmF0ZXMgdGhlIHBvbHlnb24gcGxhbmUuCgogICAgICAgICAgeGkudnN1Yih2ZXJ0c1swXSwgY29udmV4UGFydGljbGVfdmVydGV4VG9QYXJ0aWNsZSk7CiAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvbiA9IC1ub3JtYWwuZG90KGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUpOwoKICAgICAgICAgIGlmIChtaW5QZW5ldHJhdGlvbiA9PT0gbnVsbCB8fCBNYXRoLmFicyhwZW5ldHJhdGlvbikgPCBNYXRoLmFicyhtaW5QZW5ldHJhdGlvbikpIHsKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1pblBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb247CiAgICAgICAgICAgIHBlbmV0cmF0ZWRGYWNlSW5kZXggPSBpOwogICAgICAgICAgICBwZW5ldHJhdGVkRmFjZU5vcm1hbC5jb3B5KG5vcm1hbCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAocGVuZXRyYXRlZEZhY2VJbmRleCAhPT0gLTEpIHsKICAgICAgICAgIC8vIFNldHVwIGNvbnRhY3QKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwuc2NhbGUobWluUGVuZXRyYXRpb24sIHdvcmxkUGVuZXRyYXRpb25WZWMpOyAvLyByaiBpcyB0aGUgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIHRvIHRoZSBmYWNlCgogICAgICAgICAgd29ybGRQZW5ldHJhdGlvblZlYy52YWRkKHhpLCB3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIHdvcmxkUGVuZXRyYXRpb25WZWMudnN1Yih4aiwgd29ybGRQZW5ldHJhdGlvblZlYyk7CiAgICAgICAgICByLnJqLmNvcHkod29ybGRQZW5ldHJhdGlvblZlYyk7IC8vY29uc3QgcHJvamVjdGVkVG9GYWNlID0geGkudnN1Yih4aikudmFkZCh3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIC8vcHJvamVjdGVkVG9GYWNlLmNvcHkoci5yaik7CiAgICAgICAgICAvL3FqLnZtdWx0KHIucmosci5yaik7CgogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwubmVnYXRlKHIubmkpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKCiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgcmkudmFkZCh4aSwgcmkpOwogICAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgICAgICAgcmoudnN1Yihiai5wb3NpdGlvbiwgcmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS53YXJuKCdQb2ludCBmb3VuZCBpbnNpZGUgY29udmV4LCBidXQgZGlkIG5vdCBmaW5kIHBlbmV0cmF0aW5nIGZhY2UhJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcihoZlNoYXBlLCBjb252ZXhTaGFwZSwgaGZQb3MsIGNvbnZleFBvcywgaGZRdWF0LCBjb252ZXhRdWF0LCBoZkJvZHksIGNvbnZleEJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgcGFydGljbGVDeWxpbmRlcihzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlVHJpbWVzaChzcGhlcmVTaGFwZSwgdHJpbWVzaFNoYXBlLCBzcGhlcmVQb3MsIHRyaW1lc2hQb3MsIHNwaGVyZVF1YXQsIHRyaW1lc2hRdWF0LCBzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IGVkZ2VWZXJ0ZXhBID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QTsKICAgICAgY29uc3QgZWRnZVZlcnRleEIgPSBzcGhlcmVUcmltZXNoX2VkZ2VWZXJ0ZXhCOwogICAgICBjb25zdCBlZGdlVmVjdG9yID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yOwogICAgICBjb25zdCBlZGdlVmVjdG9yVW5pdCA9IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvclVuaXQ7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlUG9zID0gc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZVBvczsKICAgICAgY29uc3QgdG1wID0gc3BoZXJlVHJpbWVzaF90bXA7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlQUFCQiA9IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVBQUJCOwogICAgICBjb25zdCB2MiA9IHNwaGVyZVRyaW1lc2hfdjI7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHNwaGVyZVRyaW1lc2hfcmVscG9zOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBzcGhlcmVUcmltZXNoX3RyaWFuZ2xlczsgLy8gQ29udmVydCBzcGhlcmUgcG9zaXRpb24gdG8gbG9jYWwgaW4gdGhlIHRyaW1lc2gKCiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgc3BoZXJlUG9zLCBsb2NhbFNwaGVyZVBvcyk7IC8vIEdldCB0aGUgYWFiYiBvZiB0aGUgc3BoZXJlIGxvY2FsbHkgaW4gdGhlIHRyaW1lc2gKCiAgICAgIGNvbnN0IHNwaGVyZVJhZGl1cyA9IHNwaGVyZVNoYXBlLnJhZGl1czsKICAgICAgbG9jYWxTcGhlcmVBQUJCLmxvd2VyQm91bmQuc2V0KGxvY2FsU3BoZXJlUG9zLnggLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnkgLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnogLSBzcGhlcmVSYWRpdXMpOwogICAgICBsb2NhbFNwaGVyZUFBQkIudXBwZXJCb3VuZC5zZXQobG9jYWxTcGhlcmVQb3MueCArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueSArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueiArIHNwaGVyZVJhZGl1cyk7CiAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZXNJbkFBQkIobG9jYWxTcGhlcmVBQUJCLCB0cmlhbmdsZXMpOyAvL2ZvciAobGV0IGkgPSAwOyBpIDwgdHJpbWVzaFNoYXBlLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB0cmlhbmdsZXMucHVzaChpKTsgLy8gQWxsCiAgICAgIC8vIFZlcnRpY2VzCgogICAgICBjb25zdCB2ID0gc3BoZXJlVHJpbWVzaF92OwogICAgICBjb25zdCByYWRpdXNTcXVhcmVkID0gc3BoZXJlU2hhcGUucmFkaXVzICogc3BoZXJlU2hhcGUucmFkaXVzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmlhbmdsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgdHJpbWVzaFNoYXBlLmdldFZlcnRleCh0cmltZXNoU2hhcGUuaW5kaWNlc1t0cmlhbmdsZXNbaV0gKiAzICsgal0sIHYpOyAvLyBDaGVjayB2ZXJ0ZXggb3ZlcmxhcCBpbiBzcGhlcmUKCiAgICAgICAgICB2LnZzdWIobG9jYWxTcGhlcmVQb3MsIHJlbHBvcyk7CgogICAgICAgICAgaWYgKHJlbHBvcy5sZW5ndGhTcXVhcmVkKCkgPD0gcmFkaXVzU3F1YXJlZCkgewogICAgICAgICAgICAvLyBTYWZlIHVwCiAgICAgICAgICAgIHYyLmNvcHkodik7CiAgICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOwogICAgICAgICAgICB2LnZzdWIoc3BoZXJlUG9zLCByZWxwb3MpOwoKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oc3BoZXJlQm9keSwgdHJpbWVzaEJvZHksIHNwaGVyZVNoYXBlLCB0cmltZXNoU2hhcGUsIHJzaSwgcnNqKTsKICAgICAgICAgICAgci5uaS5jb3B5KHJlbHBvcyk7CiAgICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIHJpIGlzIHRoZSB2ZWN0b3IgZnJvbSBzcGhlcmUgY2VudGVyIHRvIHRoZSBzcGhlcmUgc3VyZmFjZQoKICAgICAgICAgICAgci5yaS5jb3B5KHIubmkpOwogICAgICAgICAgICByLnJpLnNjYWxlKHNwaGVyZVNoYXBlLnJhZGl1cywgci5yaSk7CiAgICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHIucmouY29weSh2KTsKICAgICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIGFsbCBlZGdlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpYW5nbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIHRyaW1lc2hTaGFwZS5nZXRWZXJ0ZXgodHJpbWVzaFNoYXBlLmluZGljZXNbdHJpYW5nbGVzW2ldICogMyArIGpdLCBlZGdlVmVydGV4QSk7CiAgICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KHRyaW1lc2hTaGFwZS5pbmRpY2VzW3RyaWFuZ2xlc1tpXSAqIDMgKyAoaiArIDEpICUgM10sIGVkZ2VWZXJ0ZXhCKTsKICAgICAgICAgIGVkZ2VWZXJ0ZXhCLnZzdWIoZWRnZVZlcnRleEEsIGVkZ2VWZWN0b3IpOyAvLyBQcm9qZWN0IHNwaGVyZSBwb3NpdGlvbiB0byB0aGUgZWRnZQoKICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEIsIHRtcCk7CiAgICAgICAgICBjb25zdCBwb3NpdGlvbkFsb25nRWRnZUIgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwogICAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1YihlZGdlVmVydGV4QSwgdG1wKTsKICAgICAgICAgIGxldCBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwoKICAgICAgICAgIGlmIChwb3NpdGlvbkFsb25nRWRnZUEgPiAwICYmIHBvc2l0aW9uQWxvbmdFZGdlQiA8IDApIHsKICAgICAgICAgICAgLy8gTm93IGNoZWNrIHRoZSBvcnRob2dvbmFsIGRpc3RhbmNlIGZyb20gZWRnZSB0byBzcGhlcmUgY2VudGVyCiAgICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEEsIHRtcCk7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0LmNvcHkoZWRnZVZlY3Rvcik7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0Lm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3JVbml0KTsKICAgICAgICAgICAgZWRnZVZlY3RvclVuaXQuc2NhbGUocG9zaXRpb25BbG9uZ0VkZ2VBLCB0bXApOwogICAgICAgICAgICB0bXAudmFkZChlZGdlVmVydGV4QSwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIGNlbnRlciBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gdGhlIGVkZ2UsIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgdHJpbWVzaCBmcmFtZQoKICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgICAgIGlmIChkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgICAgIHRtcC52c3ViKGxvY2FsU3BoZXJlUG9zLCByLm5pKTsKICAgICAgICAgICAgICByLm5pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZhZGQoc3BoZXJlUG9zLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICAgICAgdG1wLnZzdWIodHJpbWVzaEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIubmksIHIubmkpOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRyaWFuZ2xlIGZhY2VzCgoKICAgICAgY29uc3QgdmEgPSBzcGhlcmVUcmltZXNoX3ZhOwogICAgICBjb25zdCB2YiA9IHNwaGVyZVRyaW1lc2hfdmI7CiAgICAgIGNvbnN0IHZjID0gc3BoZXJlVHJpbWVzaF92YzsKICAgICAgY29uc3Qgbm9ybWFsID0gc3BoZXJlVHJpbWVzaF9ub3JtYWw7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IHRyaWFuZ2xlcy5sZW5ndGg7IGkgIT09IE47IGkrKykgewogICAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZVZlcnRpY2VzKHRyaWFuZ2xlc1tpXSwgdmEsIHZiLCB2Yyk7CiAgICAgICAgdHJpbWVzaFNoYXBlLmdldE5vcm1hbCh0cmlhbmdsZXNbaV0sIG5vcm1hbCk7CiAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1Yih2YSwgdG1wKTsKICAgICAgICBsZXQgZGlzdCA9IHRtcC5kb3Qobm9ybWFsKTsKICAgICAgICBub3JtYWwuc2NhbGUoZGlzdCwgdG1wKTsKICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKHRtcCwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIHBvc2l0aW9uIHByb2plY3RlZCB0byB0aGUgdHJpYW5nbGUgcGxhbmUKCiAgICAgICAgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgaWYgKFJheS5wb2ludEluVHJpYW5nbGUodG1wLCB2YSwgdmIsIHZjKSAmJiBkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgbGV0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgdG1wLnZzdWIobG9jYWxTcGhlcmVQb3MsIHIubmkpOwogICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHNwaGVyZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICB0bXAudnN1Yih0cmltZXNoQm9keS5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHRyaW1lc2hRdWF0LCByLm5pLCByLm5pKTsKICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRyaWFuZ2xlcy5sZW5ndGggPSAwOwogICAgfQoKICAgIHBsYW5lVHJpbWVzaChwbGFuZVNoYXBlLCB0cmltZXNoU2hhcGUsIHBsYW5lUG9zLCB0cmltZXNoUG9zLCBwbGFuZVF1YXQsIHRyaW1lc2hRdWF0LCBwbGFuZUJvZHksIHRyaW1lc2hCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgLy8gTWFrZSBjb250YWN0cyEKICAgICAgY29uc3QgdiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IG5vcm1hbCA9IHBsYW5lVHJpbWVzaF9ub3JtYWw7CiAgICAgIG5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmltZXNoU2hhcGUudmVydGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy8gR2V0IHdvcmxkIHZlcnRleCBmcm9tIHRyaW1lc2gKICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KGksIHYpOyAvLyBTYWZlIHVwCgogICAgICAgIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICAgICAgICB2Mi5jb3B5KHYpOwogICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOyAvLyBDaGVjayBwbGFuZSBzaWRlCgogICAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lVHJpbWVzaF9yZWxwb3M7CiAgICAgICAgdi52c3ViKHBsYW5lUG9zLCByZWxwb3MpOwogICAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgICAgaWYgKGRvdCA8PSAwLjApIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24ocGxhbmVCb2R5LCB0cmltZXNoQm9keSwgcGxhbmVTaGFwZSwgdHJpbWVzaFNoYXBlLCByc2ksIHJzaik7CiAgICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbAogICAgICAgICAgLy8gR2V0IHZlcnRleCBwb3NpdGlvbiBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBwbGFuZVRyaW1lc2hfcHJvamVjdGVkOwogICAgICAgICAgbm9ybWFsLnNjYWxlKHJlbHBvcy5kb3Qobm9ybWFsKSwgcHJvamVjdGVkKTsKICAgICAgICAgIHYudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7IC8vIHJpIGlzIHRoZSBwcm9qZWN0ZWQgd29ybGQgcG9zaXRpb24gbWludXMgcGxhbmUgcG9zaXRpb24KCiAgICAgICAgICByLnJpLmNvcHkocHJvamVjdGVkKTsKICAgICAgICAgIHIucmkudnN1YihwbGFuZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yai5jb3B5KHYpOwogICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gLy8gY29udmV4VHJpbWVzaCgKICAgIC8vICAgc2k6IENvbnZleFBvbHloZWRyb24sIHNqOiBUcmltZXNoLCB4aTogVmVjMywgeGo6IFZlYzMsIHFpOiBRdWF0ZXJuaW9uLCBxajogUXVhdGVybmlvbiwKICAgIC8vICAgYmk6IEJvZHksIGJqOiBCb2R5LCByc2k/OiBTaGFwZSB8IG51bGwsIHJzaj86IFNoYXBlIHwgbnVsbCwKICAgIC8vICAgZmFjZUxpc3RBPzogbnVtYmVyW10gfCBudWxsLCBmYWNlTGlzdEI/OiBudW1iZXJbXSB8IG51bGwsCiAgICAvLyApIHsKICAgIC8vICAgY29uc3Qgc2VwQXhpcyA9IGNvbnZleENvbnZleF9zZXBBeGlzOwogICAgLy8gICBpZih4aS5kaXN0YW5jZVRvKHhqKSA+IHNpLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2ouYm91bmRpbmdTcGhlcmVSYWRpdXMpewogICAgLy8gICAgICAgcmV0dXJuOwogICAgLy8gICB9CiAgICAvLyAgIC8vIENvbnN0cnVjdCBhIHRlbXAgaHVsbCBmb3IgZWFjaCB0cmlhbmdsZQogICAgLy8gICBjb25zdCBodWxsQiA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAvLyAgIGh1bGxCLmZhY2VzID0gW1swLDEsMl1dOwogICAgLy8gICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgICAvLyAgIGNvbnN0IHZiID0gbmV3IFZlYzMoKTsKICAgIC8vICAgY29uc3QgdmMgPSBuZXcgVmVjMygpOwogICAgLy8gICBodWxsQi52ZXJ0aWNlcyA9IFsKICAgIC8vICAgICAgIHZhLAogICAgLy8gICAgICAgdmIsCiAgICAvLyAgICAgICB2YwogICAgLy8gICBdOwogICAgLy8gICBmb3IgKGxldCBpID0gMDsgaSA8IHNqLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAvLyAgICAgICBjb25zdCB0cmlhbmdsZU5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgICAvLyAgICAgICBzai5nZXROb3JtYWwoaSwgdHJpYW5nbGVOb3JtYWwpOwogICAgLy8gICAgICAgaHVsbEIuZmFjZU5vcm1hbHMgPSBbdHJpYW5nbGVOb3JtYWxdOwogICAgLy8gICAgICAgc2ouZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCB2YSwgdmIsIHZjKTsKICAgIC8vICAgICAgIGxldCBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICBpZighZCl7CiAgICAvLyAgICAgICAgICAgdHJpYW5nbGVOb3JtYWwuc2NhbGUoLTEsIHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICAgICAgaWYoIWQpewogICAgLy8gICAgICAgICAgICAgICBjb250aW51ZTsKICAgIC8vICAgICAgICAgICB9CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgICBjb25zdCByZXM6IENvbnZleFBvbHloZWRyb25Db250YWN0UG9pbnRbXSA9IFtdOwogICAgLy8gICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgLy8gICAgICAgc2kuY2xpcEFnYWluc3RIdWxsKHhpLHFpLGh1bGxCLHhqLHFqLHRyaWFuZ2xlTm9ybWFsLC0xMDAsMTAwLHJlcyk7CiAgICAvLyAgICAgICBmb3IobGV0IGogPSAwOyBqICE9PSByZXMubGVuZ3RoOyBqKyspewogICAgLy8gICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSxiaixzaSxzaixyc2kscnNqKSwKICAgIC8vICAgICAgICAgICAgICAgcmkgPSByLnJpLAogICAgLy8gICAgICAgICAgICAgICByaiA9IHIucmo7CiAgICAvLyAgICAgICAgICAgci5uaS5jb3B5KHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgIC8vICAgICAgICAgICByZXNbal0ubm9ybWFsLm5lZ2F0ZShxKTsKICAgIC8vICAgICAgICAgICBxLm11bHQocmVzW2pdLmRlcHRoLCBxKTsKICAgIC8vICAgICAgICAgICByZXNbal0ucG9pbnQudmFkZChxLCByaSk7CiAgICAvLyAgICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOwogICAgLy8gICAgICAgICAgIC8vIENvbnRhY3QgcG9pbnRzIGFyZSBpbiB3b3JsZCBjb29yZGluYXRlcy4gVHJhbnNmb3JtIGJhY2sgdG8gcmVsYXRpdmUKICAgIC8vICAgICAgICAgICByaS52c3ViKHhpLHJpKTsKICAgIC8vICAgICAgICAgICByai52c3ViKHhqLHJqKTsKICAgIC8vICAgICAgICAgICAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwogICAgLy8gICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgIC8vICAgICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAvLyAgICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgLy8gICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgIC8vICAgICAgICAgICByZXN1bHQucHVzaChyKTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgfQogICAgLy8gfQoKCiAgfQoKICBjb25zdCBhdmVyYWdlTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBhdmVyYWdlQ29udGFjdFBvaW50QSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXZlcmFnZUNvbnRhY3RQb2ludEIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFF1YXQxID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCB0bXBRdWF0MiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3JlbHBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3YgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdjIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfZWRnZVZlcnRleEEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfZWRnZVZlcnRleEIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvciA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yVW5pdCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZVBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF90bXAgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdmEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdmIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdmMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVBQUJCID0gbmV3IEFBQkIoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3RyaWFuZ2xlcyA9IFtdOwogIGNvbnN0IHBvaW50X29uX3BsYW5lX3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVfdG9fc3BoZXJlX29ydGhvID0gbmV3IFZlYzMoKTsgLy8gU2VlIGh0dHA6Ly9idWxsZXRwaHlzaWNzLmNvbS9CdWxsZXQvQnVsbGV0RnVsbC9TcGhlcmVUcmlhbmdsZURldGVjdG9yXzhjcHBfc291cmNlLmh0bWwKCiAgY29uc3QgcG9pbnRJblBvbHlnb25fZWRnZSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcG9pbnRJblBvbHlnb25fZWRnZV94X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcG9pbnRJblBvbHlnb25fdnRwID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gcG9pbnRJblBvbHlnb24odmVydHMsIG5vcm1hbCwgcCkgewogICAgbGV0IHBvc2l0aXZlUmVzdWx0ID0gbnVsbDsKICAgIGNvbnN0IE4gPSB2ZXJ0cy5sZW5ndGg7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICBjb25zdCB2ID0gdmVydHNbaV07IC8vIEdldCBlZGdlIHRvIHRoZSBuZXh0IHZlcnRleAoKICAgICAgY29uc3QgZWRnZSA9IHBvaW50SW5Qb2x5Z29uX2VkZ2U7CiAgICAgIHZlcnRzWyhpICsgMSkgJSBOXS52c3ViKHYsIGVkZ2UpOyAvLyBHZXQgY3Jvc3MgcHJvZHVjdCBiZXR3ZWVuIHBvbHlnb24gbm9ybWFsIGFuZCB0aGUgZWRnZQoKICAgICAgY29uc3QgZWRnZV94X25vcm1hbCA9IHBvaW50SW5Qb2x5Z29uX2VkZ2VfeF9ub3JtYWw7IC8vY29uc3QgZWRnZV94X25vcm1hbCA9IG5ldyBWZWMzKCk7CgogICAgICBlZGdlLmNyb3NzKG5vcm1hbCwgZWRnZV94X25vcm1hbCk7IC8vIEdldCB2ZWN0b3IgYmV0d2VlbiBwb2ludCBhbmQgY3VycmVudCB2ZXJ0ZXgKCiAgICAgIGNvbnN0IHZlcnRleF90b19wID0gcG9pbnRJblBvbHlnb25fdnRwOwogICAgICBwLnZzdWIodiwgdmVydGV4X3RvX3ApOyAvLyBUaGlzIGRvdCBwcm9kdWN0IGRldGVybWluZXMgd2hpY2ggc2lkZSBvZiB0aGUgZWRnZSB0aGUgcG9pbnQgaXMKCiAgICAgIGNvbnN0IHIgPSBlZGdlX3hfbm9ybWFsLmRvdCh2ZXJ0ZXhfdG9fcCk7IC8vIElmIGFsbCBzdWNoIGRvdCBwcm9kdWN0cyBoYXZlIHNhbWUgc2lnbiwgd2UgYXJlIGluc2lkZSB0aGUgcG9seWdvbi4KCiAgICAgIGlmIChwb3NpdGl2ZVJlc3VsdCA9PT0gbnVsbCB8fCByID4gMCAmJiBwb3NpdGl2ZVJlc3VsdCA9PT0gdHJ1ZSB8fCByIDw9IDAgJiYgcG9zaXRpdmVSZXN1bHQgPT09IGZhbHNlKSB7CiAgICAgICAgaWYgKHBvc2l0aXZlUmVzdWx0ID09PSBudWxsKSB7CiAgICAgICAgICBwb3NpdGl2ZVJlc3VsdCA9IHIgPiAwOwogICAgICAgIH0KCiAgICAgICAgY29udGludWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBFbmNvdW50ZXJlZCBzb21lIG90aGVyIHNpZ24uIEV4aXQuCiAgICAgIH0KICAgIH0gLy8gSWYgd2UgZ290IGhlcmUsIGFsbCBkb3QgcHJvZHVjdHMgd2VyZSBvZiB0aGUgc2FtZSBzaWduLgoKCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGNvbnN0IGJveF90b19zcGhlcmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9ucyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X25zMSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X25zMiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X3NpZGVzID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwogIGNvbnN0IHNwaGVyZUJveF9zcGhlcmVfdG9fY29ybmVyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZV9ucyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X3NpZGVfbnMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZV9uczIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleF90b19zcGhlcmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9lZGdlID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfZWRnZVVuaXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9zcGhlcmVUb0Nvcm5lciA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3dvcmxkQ29ybmVyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGROb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZFBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfcGVuZXRyYXRpb25WZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9zcGhlcmVUb1dvcmxkUG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X3YgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVDb252ZXhfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZUNvbnZleF9wcm9qZWN0ZWQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleENvbnZleF9zZXBBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhDb252ZXhfcSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVQbGFuZV9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBhcnRpY2xlUGxhbmVfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwYXJ0aWNsZVBsYW5lX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVTcGhlcmVfbm9ybWFsID0gbmV3IFZlYzMoKTsgLy8gV0lQCgogIGNvbnN0IGNxaiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfbG9jYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3BlbmV0cmF0ZWRGYWNlTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhQYXJ0aWNsZV92ZXJ0ZXhUb1BhcnRpY2xlID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhQYXJ0aWNsZV93b3JsZFBlbmV0cmF0aW9uVmVjID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhIZWlnaHRmaWVsZF90bXAxID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhIZWlnaHRmaWVsZF90bXAyID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhIZWlnaHRmaWVsZF9mYWNlTGlzdCA9IFswXTsKICBjb25zdCBzcGhlcmVIZWlnaHRmaWVsZF90bXAxID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVIZWlnaHRmaWVsZF90bXAyID0gbmV3IFZlYzMoKTsKCiAgY2xhc3MgT3ZlcmxhcEtlZXBlciB7CiAgICAvKioKICAgICAqIEB0b2RvIFJlbW92ZSB1c2VsZXNzIGNvbnN0cnVjdG9yCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLmN1cnJlbnQgPSB2b2lkIDA7CiAgICAgIHRoaXMucHJldmlvdXMgPSB2b2lkIDA7CiAgICAgIHRoaXMuY3VycmVudCA9IFtdOwogICAgICB0aGlzLnByZXZpb3VzID0gW107CiAgICB9CiAgICAvKioKICAgICAqIGdldEtleQogICAgICovCgoKICAgIGdldEtleShpLCBqKSB7CiAgICAgIGlmIChqIDwgaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gaSA8PCAxNiB8IGo7CiAgICB9CiAgICAvKioKICAgICAqIHNldAogICAgICovCgoKICAgIHNldChpLCBqKSB7CiAgICAgIC8vIEluc2VydGlvbiBzb3J0LiBUaGlzIHdheSB0aGUgZGlmZiB3aWxsIGhhdmUgbGluZWFyIGNvbXBsZXhpdHkuCiAgICAgIGNvbnN0IGtleSA9IHRoaXMuZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwogICAgICBsZXQgaW5kZXggPSAwOwoKICAgICAgd2hpbGUgKGtleSA+IGN1cnJlbnRbaW5kZXhdKSB7CiAgICAgICAgaW5kZXgrKzsKICAgICAgfQoKICAgICAgaWYgKGtleSA9PT0gY3VycmVudFtpbmRleF0pIHsKICAgICAgICByZXR1cm47IC8vIFBhaXIgd2FzIGFscmVhZHkgYWRkZWQKICAgICAgfQoKICAgICAgZm9yIChsZXQgaiA9IGN1cnJlbnQubGVuZ3RoIC0gMTsgaiA+PSBpbmRleDsgai0tKSB7CiAgICAgICAgY3VycmVudFtqICsgMV0gPSBjdXJyZW50W2pdOwogICAgICB9CgogICAgICBjdXJyZW50W2luZGV4XSA9IGtleTsKICAgIH0KICAgIC8qKgogICAgICogdGljawogICAgICovCgoKICAgIHRpY2soKSB7CiAgICAgIGNvbnN0IHRtcCA9IHRoaXMuY3VycmVudDsKICAgICAgdGhpcy5jdXJyZW50ID0gdGhpcy5wcmV2aW91czsKICAgICAgdGhpcy5wcmV2aW91cyA9IHRtcDsKICAgICAgdGhpcy5jdXJyZW50Lmxlbmd0aCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIGdldERpZmYKICAgICAqLwoKCiAgICBnZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuY3VycmVudDsKICAgICAgY29uc3QgYiA9IHRoaXMucHJldmlvdXM7CiAgICAgIGNvbnN0IGFsID0gYS5sZW5ndGg7CiAgICAgIGNvbnN0IGJsID0gYi5sZW5ndGg7CiAgICAgIGxldCBqID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWw7IGkrKykgewogICAgICAgIGxldCBmb3VuZCA9IGZhbHNlOwogICAgICAgIGNvbnN0IGtleUEgPSBhW2ldOwoKICAgICAgICB3aGlsZSAoa2V5QSA+IGJbal0pIHsKICAgICAgICAgIGorKzsKICAgICAgICB9CgogICAgICAgIGZvdW5kID0ga2V5QSA9PT0gYltqXTsKCiAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgdW5wYWNrQW5kUHVzaChhZGRpdGlvbnMsIGtleUEpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaiA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJsOyBpKyspIHsKICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKICAgICAgICBjb25zdCBrZXlCID0gYltpXTsKCiAgICAgICAgd2hpbGUgKGtleUIgPiBhW2pdKSB7CiAgICAgICAgICBqKys7CiAgICAgICAgfQoKICAgICAgICBmb3VuZCA9IGFbal0gPT09IGtleUI7CgogICAgICAgIGlmICghZm91bmQpIHsKICAgICAgICAgIHVucGFja0FuZFB1c2gocmVtb3ZhbHMsIGtleUIpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICB9CgogIGZ1bmN0aW9uIHVucGFja0FuZFB1c2goYXJyYXksIGtleSkgewogICAgYXJyYXkucHVzaCgoa2V5ICYgMHhmZmZmMDAwMCkgPj4gMTYsIGtleSAmIDB4MDAwMGZmZmYpOwogIH0KICAvKioKICAgKiBUdXBsZURpY3Rpb25hcnkKICAgKi8KCgogIGNsYXNzIFR1cGxlRGljdGlvbmFyeSB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5kYXRhID0gewogICAgICAgIGtleXM6IFtdCiAgICAgIH07CiAgICB9CiAgICAvKiogZ2V0ICovCgoKICAgIGdldChpLCBqKSB7CiAgICAgIGlmIChpID4gaikgewogICAgICAgIC8vIHN3YXAKICAgICAgICBjb25zdCB0ZW1wID0gajsKICAgICAgICBqID0gaTsKICAgICAgICBpID0gdGVtcDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMuZGF0YVtpICsgIi0iICsgal07CiAgICB9CiAgICAvKiogc2V0ICovCgoKICAgIHNldChpLCBqLCB2YWx1ZSkgewogICAgICBpZiAoaSA+IGopIHsKICAgICAgICBjb25zdCB0ZW1wID0gajsKICAgICAgICBqID0gaTsKICAgICAgICBpID0gdGVtcDsKICAgICAgfQoKICAgICAgY29uc3Qga2V5ID0gaSArICItIiArIGo7IC8vIENoZWNrIGlmIGtleSBhbHJlYWR5IGV4aXN0cwoKICAgICAgaWYgKCF0aGlzLmdldChpLCBqKSkgewogICAgICAgIHRoaXMuZGF0YS5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgdGhpcy5kYXRhW2tleV0gPSB2YWx1ZTsKICAgIH0KICAgIC8qKiByZXNldCAqLwoKCiAgICByZXNldCgpIHsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3Qga2V5cyA9IGRhdGEua2V5czsKCiAgICAgIHdoaWxlIChrZXlzLmxlbmd0aCA+IDApIHsKICAgICAgICBjb25zdCBrZXkgPSBrZXlzLnBvcCgpOwogICAgICAgIGRlbGV0ZSBkYXRhW2tleV07CiAgICAgIH0KICAgIH0KCiAgfQogIC8qKgogICAqIFRoZSBwaHlzaWNzIHdvcmxkCiAgICovCgoKICBjbGFzcyBXb3JsZCBleHRlbmRzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQ3VycmVudGx5IC8gbGFzdCB1c2VkIHRpbWVzdGVwLiBJcyBzZXQgdG8gLTEgaWYgbm90IGF2YWlsYWJsZS4gVGhpcyB2YWx1ZSBpcyB1cGRhdGVkIGJlZm9yZSBlYWNoIGludGVybmFsIHN0ZXAsIHdoaWNoIG1lYW5zIHRoYXQgaXQgaXMgImZyZXNoIiBpbnNpZGUgZXZlbnQgY2FsbGJhY2tzLgogICAgICovCgogICAgLyoqCiAgICAgKiBNYWtlcyBib2RpZXMgZ28gdG8gc2xlZXAgd2hlbiB0aGV5J3ZlIGJlZW4gaW5hY3RpdmUuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgdGhlIGN1cnJlbnQgY29udGFjdHMgKGluc3RhbmNlcyBvZiBDb250YWN0RXF1YXRpb24pIGluIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogSG93IG9mdGVuIHRvIG5vcm1hbGl6ZSBxdWF0ZXJuaW9ucy4gU2V0IHRvIDAgZm9yIGV2ZXJ5IHN0ZXAsIDEgZm9yIGV2ZXJ5IHNlY29uZCBldGMuLiBBIGxhcmdlciB2YWx1ZSBpbmNyZWFzZXMgcGVyZm9ybWFuY2UuIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBhIHNtYWxsZXIgdmFsdWUgKHplcm8gdG8gYmUgc3VyZSBub3RoaW5nIGNhbiBnbyB3cm9uZykuCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byB0cnVlIHRvIHVzZSBmYXN0IHF1YXRlcm5pb24gbm9ybWFsaXphdGlvbi4gSXQgaXMgb2Z0ZW4gZW5vdWdoIGFjY3VyYXRlIHRvIHVzZS4KICAgICAqIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBmYWxzZS4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSB3YWxsLWNsb2NrIHRpbWUgc2luY2Ugc2ltdWxhdGlvbiBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogTnVtYmVyIG9mIHRpbWVzdGVwcyB0YWtlbiBzaW5jZSBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGVmYXVsdCBhbmQgbGFzdCB0aW1lc3RlcCBzaXplcy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGdyYXZpdHkgb2YgdGhlIHdvcmxkLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYnJvYWRwaGFzZSBhbGdvcml0aG0gdG8gdXNlLgogICAgICogQGRlZmF1bHQgTmFpdmVCcm9hZHBoYXNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCBib2RpZXMgaW4gdGhpcyB3b3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBUcnVlIGlmIGFueSBib2RpZXMgYXJlIG5vdCBzbGVlcGluZywgZmFsc2UgaWYgZXZlcnkgYm9keSBpcyBzbGVlcGluZy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHNvbHZlciBhbGdvcml0aG0gdG8gdXNlLgogICAgICogQGRlZmF1bHQgR1NTb2x2ZXIKICAgICAqLwoKICAgIC8qKgogICAgICogY29sbGlzaW9uTWF0cml4CiAgICAgKi8KCiAgICAvKioKICAgICAqIENvbGxpc2lvbk1hdHJpeCBmcm9tIHRoZSBwcmV2aW91cyBzdGVwLgogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgYWRkZWQgbWF0ZXJpYWxzLgogICAgICogQGRlcHJlY2F0ZWQKICAgICAqIEB0b2RvIFJlbW92ZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgYWRkZWQgY29udGFjdG1hdGVyaWFscy4KICAgICAqLwoKICAgIC8qKgogICAgICogVXNlZCB0byBsb29rIHVwIGEgQ29udGFjdE1hdGVyaWFsIGdpdmVuIHR3byBpbnN0YW5jZXMgb2YgTWF0ZXJpYWwuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBkZWZhdWx0IG1hdGVyaWFsIG9mIHRoZSBib2RpZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoaXMgY29udGFjdCBtYXRlcmlhbCBpcyB1c2VkIGlmIG5vIHN1aXRhYmxlIGNvbnRhY3RtYXRlcmlhbCBpcyBmb3VuZCBmb3IgYSBjb250YWN0LgogICAgICovCgogICAgLyoqCiAgICAgKiBUaW1lIGFjY3VtdWxhdG9yIGZvciBpbnRlcnBvbGF0aW9uLgogICAgICogQHNlZSBodHRwczovL2dhZmZlcm9uZ2FtZXMuY29tL2dhbWUtcGh5c2ljcy9maXgteW91ci10aW1lc3RlcC8KICAgICAqLwoKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciBhIGJvZHkgaGFzIGJlZW4gYWRkZWQgdG8gdGhlIHdvcmxkLgogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgYm9keSBoYXMgYmVlbiByZW1vdmVkIGZyb20gdGhlIHdvcmxkLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuZHQgPSB2b2lkIDA7CiAgICAgIHRoaXMuYWxsb3dTbGVlcCA9IHZvaWQgMDsKICAgICAgdGhpcy5jb250YWN0cyA9IHZvaWQgMDsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9ucyA9IHZvaWQgMDsKICAgICAgdGhpcy5xdWF0Tm9ybWFsaXplU2tpcCA9IHZvaWQgMDsKICAgICAgdGhpcy5xdWF0Tm9ybWFsaXplRmFzdCA9IHZvaWQgMDsKICAgICAgdGhpcy50aW1lID0gdm9pZCAwOwogICAgICB0aGlzLnN0ZXBudW1iZXIgPSB2b2lkIDA7CiAgICAgIHRoaXMuZGVmYXVsdF9kdCA9IHZvaWQgMDsKICAgICAgdGhpcy5uZXh0SWQgPSB2b2lkIDA7CiAgICAgIHRoaXMuZ3Jhdml0eSA9IHZvaWQgMDsKICAgICAgdGhpcy5icm9hZHBoYXNlID0gdm9pZCAwOwogICAgICB0aGlzLmJvZGllcyA9IHZvaWQgMDsKICAgICAgdGhpcy5oYXNBY3RpdmVCb2RpZXMgPSB2b2lkIDA7CiAgICAgIHRoaXMuc29sdmVyID0gdm9pZCAwOwogICAgICB0aGlzLmNvbnN0cmFpbnRzID0gdm9pZCAwOwogICAgICB0aGlzLm5hcnJvd3BoYXNlID0gdm9pZCAwOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeCA9IHZvaWQgMDsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91cyA9IHZvaWQgMDsKICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlciA9IHZvaWQgMDsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIgPSB2b2lkIDA7CiAgICAgIHRoaXMubWF0ZXJpYWxzID0gdm9pZCAwOwogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMgPSB2b2lkIDA7CiAgICAgIHRoaXMuY29udGFjdE1hdGVyaWFsVGFibGUgPSB2b2lkIDA7CiAgICAgIHRoaXMuZGVmYXVsdE1hdGVyaWFsID0gdm9pZCAwOwogICAgICB0aGlzLmRlZmF1bHRDb250YWN0TWF0ZXJpYWwgPSB2b2lkIDA7CiAgICAgIHRoaXMuZG9Qcm9maWxpbmcgPSB2b2lkIDA7CiAgICAgIHRoaXMucHJvZmlsZSA9IHZvaWQgMDsKICAgICAgdGhpcy5hY2N1bXVsYXRvciA9IHZvaWQgMDsKICAgICAgdGhpcy5zdWJzeXN0ZW1zID0gdm9pZCAwOwogICAgICB0aGlzLmFkZEJvZHlFdmVudCA9IHZvaWQgMDsKICAgICAgdGhpcy5yZW1vdmVCb2R5RXZlbnQgPSB2b2lkIDA7CiAgICAgIHRoaXMuaWRUb0JvZHlNYXAgPSB2b2lkIDA7CiAgICAgIHRoaXMuZHQgPSAtMTsKICAgICAgdGhpcy5hbGxvd1NsZWVwID0gISFvcHRpb25zLmFsbG93U2xlZXA7CiAgICAgIHRoaXMuY29udGFjdHMgPSBbXTsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9ucyA9IFtdOwogICAgICB0aGlzLnF1YXROb3JtYWxpemVTa2lwID0gb3B0aW9ucy5xdWF0Tm9ybWFsaXplU2tpcCAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5xdWF0Tm9ybWFsaXplU2tpcCA6IDA7CiAgICAgIHRoaXMucXVhdE5vcm1hbGl6ZUZhc3QgPSBvcHRpb25zLnF1YXROb3JtYWxpemVGYXN0ICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLnF1YXROb3JtYWxpemVGYXN0IDogZmFsc2U7CiAgICAgIHRoaXMudGltZSA9IDAuMDsKICAgICAgdGhpcy5zdGVwbnVtYmVyID0gMDsKICAgICAgdGhpcy5kZWZhdWx0X2R0ID0gMSAvIDYwOwogICAgICB0aGlzLm5leHRJZCA9IDA7CiAgICAgIHRoaXMuZ3Jhdml0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5ncmF2aXR5KSB7CiAgICAgICAgdGhpcy5ncmF2aXR5LmNvcHkob3B0aW9ucy5ncmF2aXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5icm9hZHBoYXNlID0gb3B0aW9ucy5icm9hZHBoYXNlICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmJyb2FkcGhhc2UgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICAgIHRoaXMuYm9kaWVzID0gW107CiAgICAgIHRoaXMuaGFzQWN0aXZlQm9kaWVzID0gZmFsc2U7CiAgICAgIHRoaXMuc29sdmVyID0gb3B0aW9ucy5zb2x2ZXIgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuc29sdmVyIDogbmV3IEdTU29sdmVyKCk7CiAgICAgIHRoaXMuY29uc3RyYWludHMgPSBbXTsKICAgICAgdGhpcy5uYXJyb3dwaGFzZSA9IG5ldyBOYXJyb3dwaGFzZSh0aGlzKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSBuZXcgQXJyYXlDb2xsaXNpb25NYXRyaXgoKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91cyA9IG5ldyBBcnJheUNvbGxpc2lvbk1hdHJpeCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyID0gbmV3IE92ZXJsYXBLZWVwZXIoKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIgPSBuZXcgT3ZlcmxhcEtlZXBlcigpOwogICAgICB0aGlzLm1hdGVyaWFscyA9IFtdOwogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMgPSBbXTsKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZSA9IG5ldyBUdXBsZURpY3Rpb25hcnkoKTsKICAgICAgdGhpcy5kZWZhdWx0TWF0ZXJpYWwgPSBuZXcgTWF0ZXJpYWwoJ2RlZmF1bHQnKTsKICAgICAgdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbCh0aGlzLmRlZmF1bHRNYXRlcmlhbCwgdGhpcy5kZWZhdWx0TWF0ZXJpYWwsIHsKICAgICAgICBmcmljdGlvbjogMC4zLAogICAgICAgIHJlc3RpdHV0aW9uOiAwLjAKICAgICAgfSk7CiAgICAgIHRoaXMuZG9Qcm9maWxpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5wcm9maWxlID0gewogICAgICAgIHNvbHZlOiAwLAogICAgICAgIG1ha2VDb250YWN0Q29uc3RyYWludHM6IDAsCiAgICAgICAgYnJvYWRwaGFzZTogMCwKICAgICAgICBpbnRlZ3JhdGU6IDAsCiAgICAgICAgbmFycm93cGhhc2U6IDAKICAgICAgfTsKICAgICAgdGhpcy5hY2N1bXVsYXRvciA9IDA7CiAgICAgIHRoaXMuc3Vic3lzdGVtcyA9IFtdOwogICAgICB0aGlzLmFkZEJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAnYWRkQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAncmVtb3ZlQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwID0ge307CiAgICAgIHRoaXMuYnJvYWRwaGFzZS5zZXRXb3JsZCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb250YWN0IG1hdGVyaWFsIGJldHdlZW4gbWF0ZXJpYWxzIG0xIGFuZCBtMgogICAgICogQHJldHVybiBUaGUgY29udGFjdCBtYXRlcmlhbCBpZiBpdCB3YXMgZm91bmQuCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdE1hdGVyaWFsKG0xLCBtMikgewogICAgICByZXR1cm4gdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5nZXQobTEuaWQsIG0yLmlkKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IG51bWJlciBvZiBvYmplY3RzIGluIHRoZSB3b3JsZC4KICAgICAqIEBkZXByZWNhdGVkCiAgICAgKi8KCgogICAgbnVtT2JqZWN0cygpIHsKICAgICAgcmV0dXJuIHRoaXMuYm9kaWVzLmxlbmd0aDsKICAgIH0KICAgIC8qKgogICAgICogU3RvcmUgb2xkIGNvbGxpc2lvbiBzdGF0ZSBpbmZvCiAgICAgKi8KCgogICAgY29sbGlzaW9uTWF0cml4VGljaygpIHsKICAgICAgY29uc3QgdGVtcCA9IHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXM7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXMgPSB0aGlzLmNvbGxpc2lvbk1hdHJpeDsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSB0ZW1wOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5yZXNldCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyLnRpY2soKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIudGljaygpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSBjb25zdHJhaW50IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIGFkZENvbnN0cmFpbnQoYykgewogICAgICB0aGlzLmNvbnN0cmFpbnRzLnB1c2goYyk7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZXMgYSBjb25zdHJhaW50CiAgICAgKi8KCgogICAgcmVtb3ZlQ29uc3RyYWludChjKSB7CiAgICAgIGNvbnN0IGlkeCA9IHRoaXMuY29uc3RyYWludHMuaW5kZXhPZihjKTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5jb25zdHJhaW50cy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXljYXN0IHRlc3QKICAgICAqIEBkZXByZWNhdGVkIFVzZSAucmF5Y2FzdEFsbCwgLnJheWNhc3RDbG9zZXN0IG9yIC5yYXljYXN0QW55IGluc3RlYWQuCiAgICAgKi8KCgogICAgcmF5VGVzdChmcm9tLCB0bywgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBSYXljYXN0UmVzdWx0KSB7CiAgICAgICAgLy8gRG8gcmF5Y2FzdENsb3Nlc3QKICAgICAgICB0aGlzLnJheWNhc3RDbG9zZXN0KGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBEbyByYXljYXN0QWxsCiAgICAgICAgdGhpcy5yYXljYXN0QWxsKGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCBhZ2FpbnN0IGFsbCBib2RpZXMuIFRoZSBwcm92aWRlZCBjYWxsYmFjayB3aWxsIGJlIGV4ZWN1dGVkIGZvciBlYWNoIGhpdCB3aXRoIGEgUmF5Y2FzdFJlc3VsdCBhcyBzaW5nbGUgYXJndW1lbnQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0QWxsKGZyb20sIHRvLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQUxMOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMuY2FsbGJhY2sgPSBjYWxsYmFjazsKICAgICAgcmV0dXJuIHRtcFJheS5pbnRlcnNlY3RXb3JsZCh0aGlzLCBvcHRpb25zKTsKICAgIH0KICAgIC8qKgogICAgICogUmF5IGNhc3QsIGFuZCBzdG9wIGF0IHRoZSBmaXJzdCByZXN1bHQuIE5vdGUgdGhhdCB0aGUgb3JkZXIgaXMgcmFuZG9tIC0gYnV0IHRoZSBtZXRob2QgaXMgZmFzdC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBhbnkgYm9keSB3YXMgaGl0LgogICAgICovCgoKICAgIHJheWNhc3RBbnkoZnJvbSwgdG8sIG9wdGlvbnMsIHJlc3VsdCkgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQU5ZOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCwgYW5kIHJldHVybiBpbmZvcm1hdGlvbiBvZiB0aGUgY2xvc2VzdCBoaXQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0Q2xvc2VzdChmcm9tLCB0bywgb3B0aW9ucywgcmVzdWx0KSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMubW9kZSA9IFJheS5DTE9TRVNUOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSByaWdpZCBib2R5IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICogQHRvZG8gSWYgdGhlIHNpbXVsYXRpb24gaGFzIG5vdCB5ZXQgc3RhcnRlZCwgd2h5IHJlY3JldGUgYW5kIGNvcHkgYXJyYXlzIGZvciBlYWNoIGJvZHk/IEFjY3VtdWxhdGUgaW4gZHluYW1pYyBhcnJheXMgaW4gdGhpcyBjYXNlLgogICAgICogQHRvZG8gQWRkaW5nIGFuIGFycmF5IG9mIGJvZGllcyBzaG91bGQgYmUgcG9zc2libGUuIFRoaXMgd291bGQgc2F2ZSBzb21lIGxvb3BzIHRvbwogICAgICovCgoKICAgIGFkZEJvZHkoYm9keSkgewogICAgICBpZiAodGhpcy5ib2RpZXMuaW5jbHVkZXMoYm9keSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGJvZHkuaW5kZXggPSB0aGlzLmJvZGllcy5sZW5ndGg7CiAgICAgIHRoaXMuYm9kaWVzLnB1c2goYm9keSk7CiAgICAgIGJvZHkud29ybGQgPSB0aGlzOwogICAgICBib2R5LmluaXRQb3NpdGlvbi5jb3B5KGJvZHkucG9zaXRpb24pOwogICAgICBib2R5LmluaXRWZWxvY2l0eS5jb3B5KGJvZHkudmVsb2NpdHkpOwogICAgICBib2R5LnRpbWVMYXN0U2xlZXB5ID0gdGhpcy50aW1lOwoKICAgICAgaWYgKGJvZHkgaW5zdGFuY2VvZiBCb2R5KSB7CiAgICAgICAgYm9keS5pbml0QW5ndWxhclZlbG9jaXR5LmNvcHkoYm9keS5hbmd1bGFyVmVsb2NpdHkpOwogICAgICAgIGJvZHkuaW5pdFF1YXRlcm5pb24uY29weShib2R5LnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXROdW1PYmplY3RzKHRoaXMuYm9kaWVzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWRkQm9keUV2ZW50LmJvZHkgPSBib2R5OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwW2JvZHkuaWRdID0gYm9keTsKICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KHRoaXMuYWRkQm9keUV2ZW50KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGEgcmlnaWQgYm9keSBmcm9tIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIHJlbW92ZUJvZHkoYm9keSkgewogICAgICBib2R5LndvcmxkID0gbnVsbDsKICAgICAgY29uc3QgbiA9IHRoaXMuYm9kaWVzLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYm9kaWVzOwogICAgICBjb25zdCBpZHggPSBib2RpZXMuaW5kZXhPZihib2R5KTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgYm9kaWVzLnNwbGljZShpZHgsIDEpOyAvLyBUb2RvOiBzaG91bGQgdXNlIGEgZ2FyYmFnZSBmcmVlIG1ldGhvZAogICAgICAgIC8vIFJlY29tcHV0ZSBpbmRleAoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBib2RpZXNbaV0uaW5kZXggPSBpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXguc2V0TnVtT2JqZWN0cyhuKTsKICAgICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudC5ib2R5ID0gYm9keTsKICAgICAgICBkZWxldGUgdGhpcy5pZFRvQm9keU1hcFtib2R5LmlkXTsKICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQodGhpcy5yZW1vdmVCb2R5RXZlbnQpOwogICAgICB9CiAgICB9CgogICAgZ2V0Qm9keUJ5SWQoaWQpIHsKICAgICAgcmV0dXJuIHRoaXMuaWRUb0JvZHlNYXBbaWRdOwogICAgfQogICAgLyoqCiAgICAgKiBAdG9kbyBNYWtlIGEgZmFzdGVyIG1hcAogICAgICovCgoKICAgIGdldFNoYXBlQnlJZChpZCkgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGVzID0gYm9kaWVzW2ldLnNoYXBlczsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaGFwZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2pdOwoKICAgICAgICAgIGlmIChzaGFwZS5pZCA9PT0gaWQpIHsKICAgICAgICAgICAgcmV0dXJuIHNoYXBlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAvKioKICAgICAqIEFkZHMgYSBtYXRlcmlhbCB0byB0aGUgV29ybGQuCiAgICAgKiBAZGVwcmVjYXRlZAogICAgICogQHRvZG8gUmVtb3ZlCiAgICAgKi8KCgogICAgYWRkTWF0ZXJpYWwobSkgewogICAgICB0aGlzLm1hdGVyaWFscy5wdXNoKG0pOwogICAgfQogICAgLyoqCiAgICAgKiBBZGRzIGEgY29udGFjdCBtYXRlcmlhbCB0byB0aGUgV29ybGQKICAgICAqLwoKCiAgICBhZGRDb250YWN0TWF0ZXJpYWwoY21hdCkgewogICAgICAvLyBBZGQgY29udGFjdCBtYXRlcmlhbAogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMucHVzaChjbWF0KTsgLy8gQWRkIGN1cnJlbnQgY29udGFjdCBtYXRlcmlhbCB0byB0aGUgbWF0ZXJpYWwgdGFibGUKCiAgICAgIHRoaXMuY29udGFjdE1hdGVyaWFsVGFibGUuc2V0KGNtYXQubWF0ZXJpYWxzWzBdLmlkLCBjbWF0Lm1hdGVyaWFsc1sxXS5pZCwgY21hdCk7CiAgICB9CiAgICAvKioKICAgICAqIFN0ZXAgdGhlIHBoeXNpY3Mgd29ybGQgZm9yd2FyZCBpbiB0aW1lLgogICAgICoKICAgICAqIFRoZXJlIGFyZSB0d28gbW9kZXMuIFRoZSBzaW1wbGUgbW9kZSBpcyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uLiBJbiB0aGlzIGNhc2UgeW91IG9ubHkgdXNlIHRoZSBmaXJzdCBhcmd1bWVudC4gVGhlIHNlY29uZCBjYXNlIHVzZXMgaW50ZXJwb2xhdGlvbi4gSW4gdGhhdCB5b3UgYWxzbyBwcm92aWRlIHRoZSB0aW1lIHNpbmNlIHRoZSBmdW5jdGlvbiB3YXMgbGFzdCB1c2VkLCBhcyB3ZWxsIGFzIHRoZSBtYXhpbXVtIGZpeGVkIHRpbWVzdGVwcyB0byB0YWtlLgogICAgICoKICAgICAqIEBwYXJhbSBkdCBUaGUgZml4ZWQgdGltZSBzdGVwIHNpemUgdG8gdXNlLgogICAgICogQHBhcmFtIHRpbWVTaW5jZUxhc3RDYWxsZWQgVGhlIHRpbWUgZWxhcHNlZCBzaW5jZSB0aGUgZnVuY3Rpb24gd2FzIGxhc3QgY2FsbGVkLgogICAgICogQHBhcmFtIG1heFN1YlN0ZXBzIE1heGltdW0gbnVtYmVyIG9mIGZpeGVkIHN0ZXBzIHRvIHRha2UgcGVyIGZ1bmN0aW9uIGNhbGwuCiAgICAgKiBAc2VlIGh0dHBzOi8vd2ViLmFyY2hpdmUub3JnL3dlYi8yMDE4MDQyNjE1NDUzMS9odHRwOi8vYnVsbGV0cGh5c2ljcy5vcmcvbWVkaWF3aWtpLTEuNS44L2luZGV4LnBocC9TdGVwcGluZ19UaGVfV29ybGQjV2hhdF9kb190aGVfcGFyYW1ldGVyc190b19idER5bmFtaWNzV29ybGQ6OnN0ZXBTaW11bGF0aW9uX21lYW4uM0YKICAgICAqIEBleGFtcGxlCiAgICAgKiAgICAgLy8gZml4ZWQgdGltZXN0ZXBwaW5nIHdpdGhvdXQgaW50ZXJwb2xhdGlvbgogICAgICogICAgIHdvcmxkLnN0ZXAoMSAvIDYwKQogICAgICovCgoKICAgIHN0ZXAoZHQsIHRpbWVTaW5jZUxhc3RDYWxsZWQsIG1heFN1YlN0ZXBzKSB7CiAgICAgIGlmIChtYXhTdWJTdGVwcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4U3ViU3RlcHMgPSAxMDsKICAgICAgfQoKICAgICAgaWYgKHRpbWVTaW5jZUxhc3RDYWxsZWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgIC8vIEZpeGVkLCBzaW1wbGUgc3RlcHBpbmcKICAgICAgICB0aGlzLmludGVybmFsU3RlcChkdCk7IC8vIEluY3JlbWVudCB0aW1lCgogICAgICAgIHRoaXMudGltZSArPSBkdDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFjY3VtdWxhdG9yICs9IHRpbWVTaW5jZUxhc3RDYWxsZWQ7CiAgICAgICAgY29uc3QgdDAgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgICBsZXQgc3Vic3RlcHMgPSAwOwoKICAgICAgICB3aGlsZSAodGhpcy5hY2N1bXVsYXRvciA+PSBkdCAmJiBzdWJzdGVwcyA8IG1heFN1YlN0ZXBzKSB7CiAgICAgICAgICAvLyBEbyBmaXhlZCBzdGVwcyB0byBjYXRjaCB1cAogICAgICAgICAgdGhpcy5pbnRlcm5hbFN0ZXAoZHQpOwogICAgICAgICAgdGhpcy5hY2N1bXVsYXRvciAtPSBkdDsKICAgICAgICAgIHN1YnN0ZXBzKys7CgogICAgICAgICAgaWYgKHBlcmZvcm1hbmNlLm5vdygpIC0gdDAgPiBkdCAqIDEwMDApIHsKICAgICAgICAgICAgLy8gVGhlIGZyYW1lcmF0ZSBpcyBub3QgaW50ZXJhY3RpdmUgYW55bW9yZS4KICAgICAgICAgICAgLy8gV2UgYXJlIGJlbG93IHRoZSB0YXJnZXQgZnJhbWVyYXRlLgogICAgICAgICAgICAvLyBCZXR0ZXIgYmFpbCBvdXQuCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0gLy8gUmVtb3ZlIHRoZSBleGNlc3MgYWNjdW11bGF0b3IsIHNpbmNlIHdlIG1heSBub3QKICAgICAgICAvLyBoYXZlIGhhZCBlbm91Z2ggc3Vic3RlcHMgYXZhaWxhYmxlIHRvIGNhdGNoIHVwCgoKICAgICAgICB0aGlzLmFjY3VtdWxhdG9yID0gdGhpcy5hY2N1bXVsYXRvciAlIGR0OwogICAgICAgIGNvbnN0IHQgPSB0aGlzLmFjY3VtdWxhdG9yIC8gZHQ7CgogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSB0aGlzLmJvZGllcy5sZW5ndGg7IGorKykgewogICAgICAgICAgY29uc3QgYiA9IHRoaXMuYm9kaWVzW2pdOwogICAgICAgICAgYi5wcmV2aW91c1Bvc2l0aW9uLmxlcnAoYi5wb3NpdGlvbiwgdCwgYi5pbnRlcnBvbGF0ZWRQb3NpdGlvbik7CiAgICAgICAgICBiLnByZXZpb3VzUXVhdGVybmlvbi5zbGVycChiLnF1YXRlcm5pb24sIHQsIGIuaW50ZXJwb2xhdGVkUXVhdGVybmlvbik7CiAgICAgICAgICBiLnByZXZpb3VzUXVhdGVybmlvbi5ub3JtYWxpemUoKTsKICAgICAgICB9CgogICAgICAgIHRoaXMudGltZSArPSB0aW1lU2luY2VMYXN0Q2FsbGVkOwogICAgICB9CiAgICB9CgogICAgaW50ZXJuYWxTdGVwKGR0KSB7CiAgICAgIHRoaXMuZHQgPSBkdDsKICAgICAgY29uc3QgY29udGFjdHMgPSB0aGlzLmNvbnRhY3RzOwogICAgICBjb25zdCBwMSA9IFdvcmxkX3N0ZXBfcDE7CiAgICAgIGNvbnN0IHAyID0gV29ybGRfc3RlcF9wMjsKICAgICAgY29uc3QgTiA9IHRoaXMubnVtT2JqZWN0cygpOwogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKICAgICAgY29uc3Qgc29sdmVyID0gdGhpcy5zb2x2ZXI7CiAgICAgIGNvbnN0IGdyYXZpdHkgPSB0aGlzLmdyYXZpdHk7CiAgICAgIGNvbnN0IGRvUHJvZmlsaW5nID0gdGhpcy5kb1Byb2ZpbGluZzsKICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMucHJvZmlsZTsKICAgICAgY29uc3QgRFlOQU1JQyA9IEJvZHkuRFlOQU1JQzsKICAgICAgbGV0IHByb2ZpbGluZ1N0YXJ0ID0gLUluZmluaXR5OwogICAgICBjb25zdCBjb25zdHJhaW50cyA9IHRoaXMuY29uc3RyYWludHM7CiAgICAgIGNvbnN0IGZyaWN0aW9uRXF1YXRpb25Qb29sID0gV29ybGRfc3RlcF9mcmljdGlvbkVxdWF0aW9uUG9vbDsKICAgICAgZ3Jhdml0eS5sZW5ndGgoKTsKICAgICAgY29uc3QgZ3ggPSBncmF2aXR5Lng7CiAgICAgIGNvbnN0IGd5ID0gZ3Jhdml0eS55OwogICAgICBjb25zdCBneiA9IGdyYXZpdHkuejsKICAgICAgbGV0IGkgPSAwOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgfSAvLyBBZGQgZ3Jhdml0eSB0byBhbGwgb2JqZWN0cwoKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYmkudHlwZSA9PT0gRFlOQU1JQykgewogICAgICAgICAgLy8gT25seSBmb3IgZHluYW1pYyBib2RpZXMKICAgICAgICAgIGNvbnN0IGYgPSBiaS5mb3JjZTsKICAgICAgICAgIGNvbnN0IG0gPSBiaS5tYXNzOwogICAgICAgICAgZi54ICs9IG0gKiBneDsKICAgICAgICAgIGYueSArPSBtICogZ3k7CiAgICAgICAgICBmLnogKz0gbSAqIGd6OwogICAgICAgIH0KICAgICAgfSAvLyBVcGRhdGUgc3Vic3lzdGVtcwoKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOc3Vic3lzdGVtcyA9IHRoaXMuc3Vic3lzdGVtcy5sZW5ndGg7IGkgIT09IE5zdWJzeXN0ZW1zOyBpKyspIHsKICAgICAgICB0aGlzLnN1YnN5c3RlbXNbaV0udXBkYXRlKCk7CiAgICAgIH0gLy8gQ29sbGlzaW9uIGRldGVjdGlvbgoKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIHAxLmxlbmd0aCA9IDA7IC8vIENsZWFuIHVwIHBhaXIgYXJyYXlzIGZyb20gbGFzdCBzdGVwCgogICAgICBwMi5sZW5ndGggPSAwOwogICAgICB0aGlzLmJyb2FkcGhhc2UuY29sbGlzaW9uUGFpcnModGhpcywgcDEsIHAyKTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUuYnJvYWRwaGFzZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGNvbnN0cmFpbmVkIHBhaXJzIHdpdGggY29sbGlkZUNvbm5lY3RlZCA9PSBmYWxzZQoKCiAgICAgIGxldCBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKCiAgICAgICAgaWYgKCFjLmNvbGxpZGVDb25uZWN0ZWQpIHsKICAgICAgICAgIGZvciAobGV0IGogPSBwMS5sZW5ndGggLSAxOyBqID49IDA7IGogLT0gMSkgewogICAgICAgICAgICBpZiAoYy5ib2R5QSA9PT0gcDFbal0gJiYgYy5ib2R5QiA9PT0gcDJbal0gfHwgYy5ib2R5QiA9PT0gcDFbal0gJiYgYy5ib2R5QSA9PT0gcDJbal0pIHsKICAgICAgICAgICAgICBwMS5zcGxpY2UoaiwgMSk7CiAgICAgICAgICAgICAgcDIuc3BsaWNlKGosIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeFRpY2soKTsgLy8gR2VuZXJhdGUgY29udGFjdHMKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG9sZGNvbnRhY3RzID0gV29ybGRfc3RlcF9vbGRDb250YWN0czsKICAgICAgY29uc3QgTm9sZENvbnRhY3RzID0gY29udGFjdHMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZENvbnRhY3RzOyBpKyspIHsKICAgICAgICBvbGRjb250YWN0cy5wdXNoKGNvbnRhY3RzW2ldKTsKICAgICAgfQoKICAgICAgY29udGFjdHMubGVuZ3RoID0gMDsgLy8gVHJhbnNmZXIgRnJpY3Rpb25FcXVhdGlvbiBmcm9tIGN1cnJlbnQgbGlzdCB0byB0aGUgcG9vbCBmb3IgcmV1c2UKCiAgICAgIGNvbnN0IE5vbGRGcmljdGlvbkVxdWF0aW9ucyA9IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZEZyaWN0aW9uRXF1YXRpb25zOyBpKyspIHsKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUG9vbC5wdXNoKHRoaXMuZnJpY3Rpb25FcXVhdGlvbnNbaV0pOwogICAgICB9CgogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMubmFycm93cGhhc2UuZ2V0Q29udGFjdHMocDEsIHAyLCB0aGlzLCBjb250YWN0cywgb2xkY29udGFjdHMsIC8vIFRvIGJlIHJldXNlZAogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLCBmcmljdGlvbkVxdWF0aW9uUG9vbCk7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLm5hcnJvd3BoYXNlID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgfSAvLyBMb29wIG92ZXIgYWxsIGNvbGxpc2lvbnMKCgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIEFkZCBhbGwgZnJpY3Rpb24gZXFzCgoKICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBzb2x2ZXIuYWRkRXF1YXRpb24odGhpcy5mcmljdGlvbkVxdWF0aW9uc1tpXSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5jb250YWN0cyA9IGNvbnRhY3RzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSBuY29udGFjdHM7IGsrKykgewogICAgICAgIC8vIEN1cnJlbnQgY29udGFjdAogICAgICAgIGNvbnN0IGMgPSBjb250YWN0c1trXTsgLy8gR2V0IGN1cnJlbnQgY29sbGlzaW9uIGluZGVjZXMKCiAgICAgICAgY29uc3QgYmkgPSBjLmJpOwogICAgICAgIGNvbnN0IGJqID0gYy5iajsKICAgICAgICBjb25zdCBzaSA9IGMuc2k7CiAgICAgICAgY29uc3Qgc2ogPSBjLnNqOyAvLyBHZXQgY29sbGlzaW9uIHByb3BlcnRpZXMKCiAgICAgICAgbGV0IGNtOwoKICAgICAgICBpZiAoYmkubWF0ZXJpYWwgJiYgYmoubWF0ZXJpYWwpIHsKICAgICAgICAgIGNtID0gdGhpcy5nZXRDb250YWN0TWF0ZXJpYWwoYmkubWF0ZXJpYWwsIGJqLm1hdGVyaWFsKSB8fCB0aGlzLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNtID0gdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICAgIH0gLy8gYy5lbmFibGVkID0gYmkuY29sbGlzaW9uUmVzcG9uc2UgJiYgYmouY29sbGlzaW9uUmVzcG9uc2UgJiYgc2kuY29sbGlzaW9uUmVzcG9uc2UgJiYgc2ouY29sbGlzaW9uUmVzcG9uc2U7CgoKICAgICAgICBjbS5mcmljdGlvbjsgLy8gYy5yZXN0aXR1dGlvbiA9IGNtLnJlc3RpdHV0aW9uOwogICAgICAgIC8vIElmIGZyaWN0aW9uIG9yIHJlc3RpdHV0aW9uIHdlcmUgc3BlY2lmaWVkIGluIHRoZSBtYXRlcmlhbCwgdXNlIHRoZW0KCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBpZiAoYmkubWF0ZXJpYWwuZnJpY3Rpb24gPj0gMCAmJiBiai5tYXRlcmlhbC5mcmljdGlvbiA+PSAwKSB7CiAgICAgICAgICAgIGJpLm1hdGVyaWFsLmZyaWN0aW9uICogYmoubWF0ZXJpYWwuZnJpY3Rpb247CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGJpLm1hdGVyaWFsLnJlc3RpdHV0aW9uID49IDAgJiYgYmoubWF0ZXJpYWwucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgICAgICBjLnJlc3RpdHV0aW9uID0gYmkubWF0ZXJpYWwucmVzdGl0dXRpb24gKiBiai5tYXRlcmlhbC5yZXN0aXR1dGlvbjsKICAgICAgICAgIH0KICAgICAgICB9IC8vIGMuc2V0U3Bvb2tQYXJhbXMoCiAgICAgICAgLy8gICAgICAgICAgIGNtLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcywKICAgICAgICAvLyAgICAgICAgICAgY20uY29udGFjdEVxdWF0aW9uUmVsYXhhdGlvbiwKICAgICAgICAvLyAgICAgICAgICAgZHQKICAgICAgICAvLyAgICAgICApOwoKCiAgICAgICAgc29sdmVyLmFkZEVxdWF0aW9uKGMpOyAvLyAvLyBBZGQgZnJpY3Rpb24gY29uc3RyYWludCBlcXVhdGlvbgogICAgICAgIC8vIGlmKG11ID4gMCl7CiAgICAgICAgLy8gCS8vIENyZWF0ZSAyIHRhbmdlbnQgZXF1YXRpb25zCiAgICAgICAgLy8gCWNvbnN0IG11ZyA9IG11ICogZ25vcm07CiAgICAgICAgLy8gCWNvbnN0IHJlZHVjZWRNYXNzID0gKGJpLmludk1hc3MgKyBiai5pbnZNYXNzKTsKICAgICAgICAvLyAJaWYocmVkdWNlZE1hc3MgPiAwKXsKICAgICAgICAvLyAJCXJlZHVjZWRNYXNzID0gMS9yZWR1Y2VkTWFzczsKICAgICAgICAvLyAJfQogICAgICAgIC8vIAljb25zdCBwb29sID0gZnJpY3Rpb25FcXVhdGlvblBvb2w7CiAgICAgICAgLy8gCWNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYmksYmosbXVnKnJlZHVjZWRNYXNzKTsKICAgICAgICAvLyAJY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihiaSxiaixtdWcqcmVkdWNlZE1hc3MpOwogICAgICAgIC8vIAl0aGlzLmZyaWN0aW9uRXF1YXRpb25zLnB1c2goYzEsIGMyKTsKICAgICAgICAvLyAJYzEuYmkgPSBjMi5iaSA9IGJpOwogICAgICAgIC8vIAljMS5iaiA9IGMyLmJqID0gYmo7CiAgICAgICAgLy8gCWMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAljMS5tYXhGb3JjZSA9IGMyLm1heEZvcmNlID0gbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAkvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKICAgICAgICAvLyAJYzEucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzEucmouY29weShjLnJqKTsKICAgICAgICAvLyAJYzIucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzIucmouY29weShjLnJqKTsKICAgICAgICAvLyAJLy8gQ29uc3RydWN0IHRhbmdlbnRzCiAgICAgICAgLy8gCWMubmkudGFuZ2VudHMoYzEudCwgYzIudCk7CiAgICAgICAgLy8gICAgICAgICAgIC8vIFNldCBzcG9vayBwYXJhbXMKICAgICAgICAvLyAgICAgICAgICAgYzEuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzEuZW5hYmxlZCA9IGMyLmVuYWJsZWQgPSBjLmVuYWJsZWQ7CiAgICAgICAgLy8gCS8vIEFkZCBlcXVhdGlvbnMgdG8gc29sdmVyCiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMSk7CiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMik7CiAgICAgICAgLy8gfQoKICAgICAgICBpZiAoYmkuYWxsb3dTbGVlcCAmJiBiaS50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmkuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiai5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJqLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRCID0gYmoudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmouYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQiA9IGJqLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRCID49IHNwZWVkTGltaXRTcXVhcmVkQiAqIDIpIHsKICAgICAgICAgICAgYmkud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoYmouYWxsb3dTbGVlcCAmJiBiai50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmouc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiaS5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJpLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRBID0gYmkudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmkuYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQSA9IGJpLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRBID49IHNwZWVkTGltaXRTcXVhcmVkQSAqIDIpIHsKICAgICAgICAgICAgYmoud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBOb3cgd2Uga25vdyB0aGF0IGkgYW5kIGogYXJlIGluIGNvbnRhY3QuIFNldCBjb2xsaXNpb24gbWF0cml4IHN0YXRlCgoKICAgICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXQoYmksIGJqLCB0cnVlKTsKCiAgICAgICAgaWYgKCF0aGlzLmNvbGxpc2lvbk1hdHJpeFByZXZpb3VzLmdldChiaSwgYmopKSB7CiAgICAgICAgICAvLyBGaXJzdCBjb250YWN0IQogICAgICAgICAgLy8gV2UgcmV1c2UgdGhlIGNvbGxpZGVFdmVudCBvYmplY3QsIG90aGVyd2lzZSB3ZSB3aWxsIGVuZCB1cCBjcmVhdGluZyBuZXcgb2JqZWN0cyBmb3IgZWFjaCBuZXcgY29udGFjdCwgZXZlbiBpZiB0aGVyZSdzIG5vIGV2ZW50IGxpc3RlbmVyIGF0dGFjaGVkLgogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuYm9keSA9IGJqOwogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuY29udGFjdCA9IGM7CiAgICAgICAgICBiaS5kaXNwYXRjaEV2ZW50KFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50KTsKICAgICAgICAgIFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50LmJvZHkgPSBiaTsKICAgICAgICAgIGJqLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5zZXQoYmkuaWQsIGJqLmlkKTsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5zZXQoc2kuaWQsIHNqLmlkKTsKICAgICAgfQoKICAgICAgdGhpcy5lbWl0Q29udGFjdEV2ZW50cygpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5tYWtlQ29udGFjdENvbnN0cmFpbnRzID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIFdha2UgdXAgYm9kaWVzCgoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CgogICAgICAgIGlmIChiaS53YWtlVXBBZnRlck5hcnJvd3BoYXNlKSB7CiAgICAgICAgICBiaS53YWtlVXAoKTsKICAgICAgICAgIGJpLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIHVzZXItYWRkZWQgY29uc3RyYWludHMKCgogICAgICBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKICAgICAgICBjLnVwZGF0ZSgpOwoKICAgICAgICBmb3IgKGxldCBqID0gMCwgTmVxID0gYy5lcXVhdGlvbnMubGVuZ3RoOyBqICE9PSBOZXE7IGorKykgewogICAgICAgICAgY29uc3QgZXEgPSBjLmVxdWF0aW9uc1tqXTsKICAgICAgICAgIHNvbHZlci5hZGRFcXVhdGlvbihlcSk7CiAgICAgICAgfQogICAgICB9IC8vIFNvbHZlIHRoZSBjb25zdHJhaW5lZCBzeXN0ZW0KCgogICAgICBzb2x2ZXIuc29sdmUoZHQsIHRoaXMpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5zb2x2ZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGFsbCBjb250YWN0cyBmcm9tIHNvbHZlcgoKCiAgICAgIHNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsgLy8gQXBwbHkgZGFtcGluZywgc2VlIGh0dHA6Ly9jb2RlLmdvb2dsZS5jb20vcC9idWxsZXQvaXNzdWVzL2RldGFpbD9pZD03NCBmb3IgZGV0YWlscwoKICAgICAgY29uc3QgcG93ID0gTWF0aC5wb3c7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgaWYgKGJpLnR5cGUgJiBEWU5BTUlDKSB7CiAgICAgICAgICAvLyBPbmx5IGZvciBkeW5hbWljIGJvZGllcwogICAgICAgICAgY29uc3QgbGQgPSBwb3coMS4wIC0gYmkubGluZWFyRGFtcGluZywgZHQpOwogICAgICAgICAgY29uc3QgdiA9IGJpLnZlbG9jaXR5OwogICAgICAgICAgdi5zY2FsZShsZCwgdik7CiAgICAgICAgICBjb25zdCBhdiA9IGJpLmFuZ3VsYXJWZWxvY2l0eTsKCiAgICAgICAgICBpZiAoYXYpIHsKICAgICAgICAgICAgY29uc3QgYWQgPSBwb3coMS4wIC0gYmkuYW5ndWxhckRhbXBpbmcsIGR0KTsKICAgICAgICAgICAgYXYuc2NhbGUoYWQsIGF2KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChXb3JsZF9zdGVwX3ByZVN0ZXBFdmVudCk7IC8vIEludm9rZSBwcmUtc3RlcCBjYWxsYmFja3MKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYmkucHJlU3RlcCkgewogICAgICAgICAgYmkucHJlU3RlcC5jYWxsKGJpKTsKICAgICAgICB9CiAgICAgIH0gLy8gTGVhcCBmcm9nCiAgICAgIC8vIHZuZXcgPSB2ICsgaCpmL20KICAgICAgLy8geG5ldyA9IHggKyBoKnZuZXcKCgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9CgogICAgICBjb25zdCBzdGVwbnVtYmVyID0gdGhpcy5zdGVwbnVtYmVyOwogICAgICBjb25zdCBxdWF0Tm9ybWFsaXplID0gc3RlcG51bWJlciAlICh0aGlzLnF1YXROb3JtYWxpemVTa2lwICsgMSkgPT09IDA7CiAgICAgIGNvbnN0IHF1YXROb3JtYWxpemVGYXN0ID0gdGhpcy5xdWF0Tm9ybWFsaXplRmFzdDsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGJvZGllc1tpXS5pbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KTsKICAgICAgfQoKICAgICAgdGhpcy5jbGVhckZvcmNlcygpOwogICAgICB0aGlzLmJyb2FkcGhhc2UuZGlydHkgPSB0cnVlOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5pbnRlZ3JhdGUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICB9IC8vIFVwZGF0ZSBzdGVwIG51bWJlcgoKCiAgICAgIHRoaXMuc3RlcG51bWJlciArPSAxOwogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50KTsgLy8gSW52b2tlIHBvc3Qtc3RlcCBjYWxsYmFja3MKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwogICAgICAgIGNvbnN0IHBvc3RTdGVwID0gYmkucG9zdFN0ZXA7CgogICAgICAgIGlmIChwb3N0U3RlcCkgewogICAgICAgICAgcG9zdFN0ZXAuY2FsbChiaSk7CiAgICAgICAgfQogICAgICB9IC8vIFNsZWVwaW5nIHVwZGF0ZQoKCiAgICAgIGxldCBoYXNBY3RpdmVCb2RpZXMgPSB0cnVlOwoKICAgICAgaWYgKHRoaXMuYWxsb3dTbGVlcCkgewogICAgICAgIGhhc0FjdGl2ZUJvZGllcyA9IGZhbHNlOwoKICAgICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwogICAgICAgICAgYmkuc2xlZXBUaWNrKHRoaXMudGltZSk7CgogICAgICAgICAgaWYgKGJpLnNsZWVwU3RhdGUgIT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICAgICAgaGFzQWN0aXZlQm9kaWVzID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuaGFzQWN0aXZlQm9kaWVzID0gaGFzQWN0aXZlQm9kaWVzOwogICAgfQoKICAgIGVtaXRDb250YWN0RXZlbnRzKCkgewogICAgICBjb25zdCBoYXNCZWdpbkNvbnRhY3QgPSB0aGlzLmhhc0FueUV2ZW50TGlzdGVuZXIoJ2JlZ2luQ29udGFjdCcpOwogICAgICBjb25zdCBoYXNFbmRDb250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdlbmRDb250YWN0Jyk7CgogICAgICBpZiAoaGFzQmVnaW5Db250YWN0IHx8IGhhc0VuZENvbnRhY3QpIHsKICAgICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyLmdldERpZmYoYWRkaXRpb25zLCByZW1vdmFscyk7CiAgICAgIH0KCiAgICAgIGlmIChoYXNCZWdpbkNvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGFkZGl0aW9ucy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGJlZ2luQ29udGFjdEV2ZW50LmJvZHlBID0gdGhpcy5nZXRCb2R5QnlJZChhZGRpdGlvbnNbaV0pOwogICAgICAgICAgYmVnaW5Db250YWN0RXZlbnQuYm9keUIgPSB0aGlzLmdldEJvZHlCeUlkKGFkZGl0aW9uc1tpICsgMV0pOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KGJlZ2luQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGJlZ2luQ29udGFjdEV2ZW50LmJvZHlBID0gYmVnaW5Db250YWN0RXZlbnQuYm9keUIgPSBudWxsOwogICAgICB9CgogICAgICBpZiAoaGFzRW5kQ29udGFjdCkgewogICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gcmVtb3ZhbHMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICBlbmRDb250YWN0RXZlbnQuYm9keUEgPSB0aGlzLmdldEJvZHlCeUlkKHJlbW92YWxzW2ldKTsKICAgICAgICAgIGVuZENvbnRhY3RFdmVudC5ib2R5QiA9IHRoaXMuZ2V0Qm9keUJ5SWQocmVtb3ZhbHNbaSArIDFdKTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChlbmRDb250YWN0RXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgZW5kQ29udGFjdEV2ZW50LmJvZHlBID0gZW5kQ29udGFjdEV2ZW50LmJvZHlCID0gbnVsbDsKICAgICAgfQoKICAgICAgYWRkaXRpb25zLmxlbmd0aCA9IHJlbW92YWxzLmxlbmd0aCA9IDA7CiAgICAgIGNvbnN0IGhhc0JlZ2luU2hhcGVDb250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdiZWdpblNoYXBlQ29udGFjdCcpOwogICAgICBjb25zdCBoYXNFbmRTaGFwZUNvbnRhY3QgPSB0aGlzLmhhc0FueUV2ZW50TGlzdGVuZXIoJ2VuZFNoYXBlQ29udGFjdCcpOwoKICAgICAgaWYgKGhhc0JlZ2luU2hhcGVDb250YWN0IHx8IGhhc0VuZFNoYXBlQ29udGFjdCkgewogICAgICAgIHRoaXMuc2hhcGVPdmVybGFwS2VlcGVyLmdldERpZmYoYWRkaXRpb25zLCByZW1vdmFscyk7CiAgICAgIH0KCiAgICAgIGlmIChoYXNCZWdpblNoYXBlQ29udGFjdCkgewogICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gYWRkaXRpb25zLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgY29uc3Qgc2hhcGVBID0gdGhpcy5nZXRTaGFwZUJ5SWQoYWRkaXRpb25zW2ldKTsKICAgICAgICAgIGNvbnN0IHNoYXBlQiA9IHRoaXMuZ2V0U2hhcGVCeUlkKGFkZGl0aW9uc1tpICsgMV0pOwogICAgICAgICAgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBzaGFwZUE7CiAgICAgICAgICBiZWdpblNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQiA9IHNoYXBlQjsKICAgICAgICAgIGlmIChzaGFwZUEpIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuYm9keUEgPSBzaGFwZUEuYm9keTsKICAgICAgICAgIGlmIChzaGFwZUIpIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuYm9keUIgPSBzaGFwZUIuYm9keTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChiZWdpblNoYXBlQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuYm9keUEgPSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQiA9IG51bGw7CiAgICAgIH0KCiAgICAgIGlmIChoYXNFbmRTaGFwZUNvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHJlbW92YWxzLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgY29uc3Qgc2hhcGVBID0gdGhpcy5nZXRTaGFwZUJ5SWQocmVtb3ZhbHNbaV0pOwogICAgICAgICAgY29uc3Qgc2hhcGVCID0gdGhpcy5nZXRTaGFwZUJ5SWQocmVtb3ZhbHNbaSArIDFdKTsKICAgICAgICAgIGVuZFNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQSA9IHNoYXBlQTsKICAgICAgICAgIGVuZFNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQiA9IHNoYXBlQjsKICAgICAgICAgIGlmIChzaGFwZUEpIGVuZFNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gc2hhcGVBLmJvZHk7CiAgICAgICAgICBpZiAoc2hhcGVCKSBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QiA9IHNoYXBlQi5ib2R5OwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KGVuZFNoYXBlQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGVuZFNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gZW5kU2hhcGVDb250YWN0RXZlbnQuYm9keUIgPSBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBudWxsOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgYWxsIGJvZHkgZm9yY2VzIGluIHRoZSB3b3JsZCB0byB6ZXJvLgogICAgICovCgoKICAgIGNsZWFyRm9yY2VzKCkgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKICAgICAgY29uc3QgTiA9IGJvZGllcy5sZW5ndGg7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICBiLmZvcmNlOwogICAgICAgIGIudG9ycXVlOwogICAgICAgIGIuZm9yY2Uuc2V0KDAsIDAsIDApOwogICAgICAgIGIudG9ycXVlLnNldCgwLCAwLCAwKTsKICAgICAgfQogICAgfQoKICB9IC8vIFRlbXAgc3R1ZmYKCgogIG5ldyBBQUJCKCk7CiAgY29uc3QgdG1wUmF5ID0gbmV3IFJheSgpOyAvLyBwZXJmb3JtYW5jZS5ub3coKSBmYWxsYmFjayBvbiBEYXRlLm5vdygpCgogIGNvbnN0IHBlcmZvcm1hbmNlID0gZ2xvYmFsVGhpcy5wZXJmb3JtYW5jZSB8fCB7fTsKCiAgaWYgKCFwZXJmb3JtYW5jZS5ub3cpIHsKICAgIGxldCBub3dPZmZzZXQgPSBEYXRlLm5vdygpOwoKICAgIGlmIChwZXJmb3JtYW5jZS50aW1pbmcgJiYgcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydCkgewogICAgICBub3dPZmZzZXQgPSBwZXJmb3JtYW5jZS50aW1pbmcubmF2aWdhdGlvblN0YXJ0OwogICAgfQoKICAgIHBlcmZvcm1hbmNlLm5vdyA9ICgpID0+IERhdGUubm93KCkgLSBub3dPZmZzZXQ7CiAgfSAvLyBSZXVzYWJsZSBldmVudCBvYmplY3RzIHRvIHNhdmUgbWVtb3J5LgoKCiAgY29uc3QgV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3Bvc3RTdGVwJwogIH07IC8vIERpc3BhdGNoZWQgYmVmb3JlIHRoZSB3b3JsZCBzdGVwcyBmb3J3YXJkIGluIHRpbWUuCgogIGNvbnN0IFdvcmxkX3N0ZXBfcHJlU3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3ByZVN0ZXAnCiAgfTsKICBjb25zdCBXb3JsZF9zdGVwX2NvbGxpZGVFdmVudCA9IHsKICAgIHR5cGU6IEJvZHkuQ09MTElERV9FVkVOVF9OQU1FLAogICAgYm9keTogbnVsbCwKICAgIGNvbnRhY3Q6IG51bGwKICB9OyAvLyBQb29scyBmb3IgdW51c2VkIG9iamVjdHMKCiAgY29uc3QgV29ybGRfc3RlcF9vbGRDb250YWN0cyA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsgLy8gUmV1c2FibGUgYXJyYXlzIGZvciBjb2xsaXNpb24gcGFpcnMKCiAgY29uc3QgV29ybGRfc3RlcF9wMSA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfcDIgPSBbXTsgLy8gU3R1ZmYgZm9yIGVtaXRDb250YWN0RXZlbnRzCgogIGNvbnN0IGFkZGl0aW9ucyA9IFtdOwogIGNvbnN0IHJlbW92YWxzID0gW107CiAgY29uc3QgYmVnaW5Db250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5Db250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGVuZENvbnRhY3RFdmVudCA9IHsKICAgIHR5cGU6ICdlbmRDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGJlZ2luU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5TaGFwZUNvbnRhY3QnLAogICAgYm9keUE6IG51bGwsCiAgICBib2R5QjogbnVsbCwKICAgIHNoYXBlQTogbnVsbCwKICAgIHNoYXBlQjogbnVsbAogIH07CiAgY29uc3QgZW5kU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnZW5kU2hhcGVDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwsCiAgICBzaGFwZUE6IG51bGwsCiAgICBzaGFwZUI6IG51bGwKICB9OwoKICBjb25zdCBhZGRDb250YWN0TWF0ZXJpYWwgPSAod29ybGQsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmLCB1dWlkKSA9PiB7CiAgICBsZXQgW21hdGVyaWFsQSwgbWF0ZXJpYWxCLCBvcHRpb25zXSA9IF9yZWY7CiAgICBjb25zdCBtYXRBID0gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWxBKTsKICAgIGNvbnN0IG1hdEIgPSBjcmVhdGVNYXRlcmlhbChtYXRlcmlhbEIpOwogICAgY29uc3QgY29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbChtYXRBLCBtYXRCLCBvcHRpb25zKTsKICAgIGNvbnRhY3RNYXRlcmlhbC51dWlkID0gdXVpZDsKICAgIHdvcmxkLmFkZENvbnRhY3RNYXRlcmlhbChjb250YWN0TWF0ZXJpYWwpOwogIH07CiAgY29uc3QgcmVtb3ZlQ29udGFjdE1hdGVyaWFsID0gKHdvcmxkLCBjbVVVSUQpID0+IHsKICAgIGNvbnN0IGluZGV4ID0gd29ybGQuY29udGFjdG1hdGVyaWFscy5maW5kSW5kZXgoX3JlZjIgPT4gewogICAgICBsZXQgewogICAgICAgIHV1aWQKICAgICAgfSA9IF9yZWYyOwogICAgICByZXR1cm4gdXVpZCA9PT0gY21VVUlEOwogICAgfSk7CiAgICBjb25zdCBbewogICAgICBpZDogaQogICAgfSwgewogICAgICBpZDogagogICAgfV0gPSB3b3JsZC5jb250YWN0bWF0ZXJpYWxzW2luZGV4XS5tYXRlcmlhbHM7CiAgICB3b3JsZC5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpbmRleCwgMSk7CiAgICBkZWxldGUgd29ybGQuY29udGFjdE1hdGVyaWFsVGFibGUuZGF0YVtpIDwgaiA/IGAke2l9LSR7an1gIDogYCR7an0tJHtpfWBdOwogIH07CgogIGxldCBtYXRlcmlhbElkID0gMDsKICBjb25zdCBjcmVhdGVNYXRlcmlhbEZhY3RvcnkgPSBtYXRlcmlhbHMgPT4gZnVuY3Rpb24gKG5hbWVPck9wdGlvbnMpIHsKICAgIGlmIChuYW1lT3JPcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgbmFtZU9yT3B0aW9ucyA9IHt9OwogICAgfQoKICAgIGNvbnN0IG1hdGVyaWFsT3B0aW9ucyA9IHR5cGVvZiBuYW1lT3JPcHRpb25zID09PSAnc3RyaW5nJyA/IHsKICAgICAgbmFtZTogbmFtZU9yT3B0aW9ucwogICAgfSA6IHsKICAgICAgbmFtZTogU3ltYm9sLmZvcihgTWF0ZXJpYWwke21hdGVyaWFsSWQrK31gKSwKICAgICAgLi4ubmFtZU9yT3B0aW9ucwogICAgfTsKICAgIGNvbnN0IHsKICAgICAgbmFtZQogICAgfSA9IG1hdGVyaWFsT3B0aW9uczsKICAgIG1hdGVyaWFsc1tuYW1lXSA9IG1hdGVyaWFsc1tuYW1lXSB8fCBuZXcgTWF0ZXJpYWwobWF0ZXJpYWxPcHRpb25zKTsKICAgIHJldHVybiBtYXRlcmlhbHNbbmFtZV07CiAgfTsKCiAgLyoqCiAgICogQHR5cGVkZWYgeyBpbXBvcnQoJ2Nhbm5vbi1lcycpLk1hdGVyaWFsT3B0aW9ucyB9IE1hdGVyaWFsT3B0aW9ucwogICAqLwoKICBjb25zdCBtYWtlVmVjMyA9IF9yZWYgPT4gewogICAgbGV0IFt4LCB5LCB6XSA9IF9yZWY7CiAgICByZXR1cm4gbmV3IFZlYzMoeCwgeSwgeik7CiAgfTsKCiAgY29uc3QgcHJlcGFyZVNwaGVyZSA9IGFyZ3MgPT4gQXJyYXkuaXNBcnJheShhcmdzKSA/IGFyZ3MgOiBbYXJnc107CgogIGNvbnN0IHByZXBhcmVDb252ZXhQb2x5aGVkcm9uID0gX3JlZjIgPT4gewogICAgbGV0IFt2LCBmYWNlcywgbiwgYSwgYm91bmRpbmdTcGhlcmVSYWRpdXNdID0gX3JlZjI7CiAgICByZXR1cm4gW3sKICAgICAgYXhlczogYSA/IGEubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZCwKICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMsCiAgICAgIGZhY2VzLAogICAgICBub3JtYWxzOiBuID8gbi5tYXAobWFrZVZlYzMpIDogdW5kZWZpbmVkLAogICAgICB2ZXJ0aWNlczogdiA/IHYubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZAogICAgfV07CiAgfTsKCiAgZnVuY3Rpb24gY3JlYXRlU2hhcGUodHlwZSwgYXJncykgewogICAgc3dpdGNoICh0eXBlKSB7CiAgICAgIGNhc2UgJ0JveCc6CiAgICAgICAgcmV0dXJuIG5ldyBCb3gobmV3IFZlYzMoLi4uYXJncy5tYXAodiA9PiB2IC8gMikpKTsKICAgICAgLy8gZXh0ZW50cyA9PiBoYWxmRXh0ZW50cwoKICAgICAgY2FzZSAnQ29udmV4UG9seWhlZHJvbic6CiAgICAgICAgcmV0dXJuIG5ldyBDb252ZXhQb2x5aGVkcm9uKC4uLnByZXBhcmVDb252ZXhQb2x5aGVkcm9uKGFyZ3MpKTsKCiAgICAgIGNhc2UgJ0N5bGluZGVyJzoKICAgICAgICByZXR1cm4gbmV3IEN5bGluZGVyKC4uLmFyZ3MpOwogICAgICAvLyBbIHJhZGl1c1RvcCwgcmFkaXVzQm90dG9tLCBoZWlnaHQsIG51bVNlZ21lbnRzIF0gPSBhcmdzCgogICAgICBjYXNlICdIZWlnaHRmaWVsZCc6CiAgICAgICAgcmV0dXJuIG5ldyBIZWlnaHRmaWVsZCguLi5hcmdzKTsKICAgICAgLy8gWyBBcnJheSBkYXRhLCBvcHRpb25zOiB7bWluVmFsdWUsIG1heFZhbHVlLCBlbGVtZW50U2l6ZX0gIF0gPSBhcmdzCgogICAgICBjYXNlICdQYXJ0aWNsZSc6CiAgICAgICAgcmV0dXJuIG5ldyBQYXJ0aWNsZSgpOwogICAgICAvLyBubyBhcmdzCgogICAgICBjYXNlICdQbGFuZSc6CiAgICAgICAgcmV0dXJuIG5ldyBQbGFuZSgpOwogICAgICAvLyBubyBhcmdzLCBpbmZpbml0ZSB4IGFuZCB5CgogICAgICBjYXNlICdTcGhlcmUnOgogICAgICAgIHJldHVybiBuZXcgU3BoZXJlKC4uLnByZXBhcmVTcGhlcmUoYXJncykpOwogICAgICAvLyByYWRpdXMgPSBhcmdzCgogICAgICBjYXNlICdUcmltZXNoJzoKICAgICAgICByZXR1cm4gbmV3IFRyaW1lc2goLi4uYXJncyk7CiAgICAgIC8vIFt2ZXJ0aWNlcywgaW5kaWNlc10gPSBhcmdzCiAgICB9CiAgfQogIC8qKgogICAqIEBmdW5jdGlvbgogICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zCiAgICogQHBhcmFtIHtzdHJpbmd9IG9wdGlvbnMudXVpZAogICAqIEBwYXJhbSB7Qm9keVByb3BzfSBvcHRpb25zLnByb3BzCiAgICogQHBhcmFtIHtCb2R5U2hhcGVUeXBlfSBvcHRpb25zLnR5cGUKICAgKiBAcGFyYW0geyhtYXRlcmlhbE9wdGlvbnM6IE1hdGVyaWFsT3B0aW9ucykgPT4gTWF0ZXJpYWwgPX0gb3B0aW9ucy5jcmVhdGVNYXRlcmlhbAogICAqIEByZXR1cm5zIHtCb2R5fQogICAqLwoKCiAgY29uc3QgcHJvcHNUb0JvZHkgPSBvcHRpb25zID0+IHsKICAgIGNvbnN0IHsKICAgICAgdXVpZCwKICAgICAgcHJvcHMsCiAgICAgIHR5cGUsCiAgICAgIGNyZWF0ZU1hdGVyaWFsID0gbWF0ZXJpYWxPcHRpb25zID0+IG5ldyBNYXRlcmlhbChtYXRlcmlhbE9wdGlvbnMpCiAgICB9ID0gb3B0aW9uczsKICAgIGNvbnN0IHsKICAgICAgYW5ndWxhckZhY3RvciA9IFsxLCAxLCAxXSwKICAgICAgYW5ndWxhclZlbG9jaXR5ID0gWzAsIDAsIDBdLAogICAgICBhcmdzID0gW10sCiAgICAgIGNvbGxpc2lvblJlc3BvbnNlLAogICAgICBsaW5lYXJGYWN0b3IgPSBbMSwgMSwgMV0sCiAgICAgIG1hc3MsCiAgICAgIG1hdGVyaWFsLAogICAgICBvbkNvbGxpZGUsCiAgICAgIHBvc2l0aW9uID0gWzAsIDAsIDBdLAogICAgICByb3RhdGlvbiA9IFswLCAwLCAwXSwKICAgICAgc2hhcGVzLAogICAgICB0eXBlOiBib2R5VHlwZSwKICAgICAgdmVsb2NpdHkgPSBbMCwgMCwgMF0sCiAgICAgIC4uLmV4dHJhCiAgICB9ID0gcHJvcHM7CiAgICBjb25zdCBib2R5ID0gbmV3IEJvZHkoeyAuLi5leHRyYSwKICAgICAgbWFzczogYm9keVR5cGUgPT09ICdTdGF0aWMnID8gMCA6IG1hc3MsCiAgICAgIG1hdGVyaWFsOiBtYXRlcmlhbCA/IGNyZWF0ZU1hdGVyaWFsKG1hdGVyaWFsKSA6IHVuZGVmaW5lZCwKICAgICAgdHlwZTogYm9keVR5cGUgPyBCb2R5W2JvZHlUeXBlLnRvVXBwZXJDYXNlKCldIDogdW5kZWZpbmVkCiAgICB9KTsKICAgIGJvZHkudXVpZCA9IHV1aWQ7CgogICAgaWYgKGNvbGxpc2lvblJlc3BvbnNlICE9PSB1bmRlZmluZWQpIHsKICAgICAgYm9keS5jb2xsaXNpb25SZXNwb25zZSA9IGNvbGxpc2lvblJlc3BvbnNlOwogICAgfQoKICAgIGlmICh0eXBlID09PSAnQ29tcG91bmQnKSB7CiAgICAgIHNoYXBlcy5mb3JFYWNoKF9yZWYzID0+IHsKICAgICAgICBsZXQgewogICAgICAgICAgdHlwZSwKICAgICAgICAgIGFyZ3MsCiAgICAgICAgICBwb3NpdGlvbiwKICAgICAgICAgIHJvdGF0aW9uLAogICAgICAgICAgbWF0ZXJpYWwsCiAgICAgICAgICAuLi5leHRyYQogICAgICAgIH0gPSBfcmVmMzsKICAgICAgICBjb25zdCBzaGFwZUJvZHkgPSBib2R5LmFkZFNoYXBlKGNyZWF0ZVNoYXBlKHR5cGUsIGFyZ3MpLCBwb3NpdGlvbiA/IG5ldyBWZWMzKC4uLnBvc2l0aW9uKSA6IHVuZGVmaW5lZCwgcm90YXRpb24gPyBuZXcgUXVhdGVybmlvbigpLnNldEZyb21FdWxlciguLi5yb3RhdGlvbikgOiB1bmRlZmluZWQpOwogICAgICAgIGlmIChtYXRlcmlhbCkgc2hhcGVCb2R5Lm1hdGVyaWFsID0gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWwpOwogICAgICAgIE9iamVjdC5hc3NpZ24oc2hhcGVCb2R5LCBleHRyYSk7CiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgYm9keS5hZGRTaGFwZShjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSk7CiAgICB9CgogICAgYm9keS5wb3NpdGlvbi5zZXQocG9zaXRpb25bMF0sIHBvc2l0aW9uWzFdLCBwb3NpdGlvblsyXSk7CiAgICBib2R5LnF1YXRlcm5pb24uc2V0RnJvbUV1bGVyKHJvdGF0aW9uWzBdLCByb3RhdGlvblsxXSwgcm90YXRpb25bMl0pOwogICAgYm9keS52ZWxvY2l0eS5zZXQodmVsb2NpdHlbMF0sIHZlbG9jaXR5WzFdLCB2ZWxvY2l0eVsyXSk7CiAgICBib2R5LmFuZ3VsYXJWZWxvY2l0eS5zZXQoYW5ndWxhclZlbG9jaXR5WzBdLCBhbmd1bGFyVmVsb2NpdHlbMV0sIGFuZ3VsYXJWZWxvY2l0eVsyXSk7CiAgICBib2R5LmxpbmVhckZhY3Rvci5zZXQobGluZWFyRmFjdG9yWzBdLCBsaW5lYXJGYWN0b3JbMV0sIGxpbmVhckZhY3RvclsyXSk7CiAgICBib2R5LmFuZ3VsYXJGYWN0b3Iuc2V0KGFuZ3VsYXJGYWN0b3JbMF0sIGFuZ3VsYXJGYWN0b3JbMV0sIGFuZ3VsYXJGYWN0b3JbMl0pOwogICAgcmV0dXJuIGJvZHk7CiAgfTsKCiAgdmFyIHByb3BzVG9Cb2R5JDEgPSBwcm9wc1RvQm9keTsKCiAgY29uc3QgYWRkQm9kaWVzID0gKHN0YXRlLCBjcmVhdGVNYXRlcmlhbCwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHMsCiAgICAgIHR5cGUsCiAgICAgIHV1aWQKICAgIH0gPSBfcmVmOwoKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdXVpZC5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCBib2R5ID0gcHJvcHNUb0JvZHkkMSh7CiAgICAgICAgY3JlYXRlTWF0ZXJpYWwsCiAgICAgICAgcHJvcHM6IHByb3BzW2ldLAogICAgICAgIHR5cGUsCiAgICAgICAgdXVpZDogdXVpZFtpXQogICAgICB9KTsKICAgICAgc3RhdGUud29ybGQuYWRkQm9keShib2R5KTsKICAgICAgaWYgKHByb3BzW2ldLm9uQ29sbGlkZSkgYm9keS5hZGRFdmVudExpc3RlbmVyKCdjb2xsaWRlJywgX3JlZjIgPT4gewogICAgICAgIGxldCB7CiAgICAgICAgICB0eXBlLAogICAgICAgICAgYm9keSwKICAgICAgICAgIHRhcmdldCwKICAgICAgICAgIGNvbnRhY3QKICAgICAgICB9ID0gX3JlZjI7CiAgICAgICAgY29uc3QgewogICAgICAgICAgbmksCiAgICAgICAgICByaSwKICAgICAgICAgIHJqLAogICAgICAgICAgYmksCiAgICAgICAgICBiaiwKICAgICAgICAgIGlkCiAgICAgICAgfSA9IGNvbnRhY3Q7CiAgICAgICAgY29uc3QgY29udGFjdFBvaW50ID0gYmkucG9zaXRpb24udmFkZChyaSk7CiAgICAgICAgY29uc3QgY29udGFjdE5vcm1hbCA9IGJpID09PSBib2R5ID8gbmkgOiBuaS5zY2FsZSgtMSk7CiAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgICAgICBib2R5OiBib2R5LnV1aWQsCiAgICAgICAgICBjb2xsaXNpb25GaWx0ZXJzOiB7CiAgICAgICAgICAgIGJvZHlGaWx0ZXJHcm91cDogYm9keS5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgICAgYm9keUZpbHRlck1hc2s6IGJvZHkuY29sbGlzaW9uRmlsdGVyTWFzaywKICAgICAgICAgICAgdGFyZ2V0RmlsdGVyR3JvdXA6IHRhcmdldC5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgICAgdGFyZ2V0RmlsdGVyTWFzazogdGFyZ2V0LmNvbGxpc2lvbkZpbHRlck1hc2sKICAgICAgICAgIH0sCiAgICAgICAgICBjb250YWN0OiB7CiAgICAgICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETzogdXNlIGlkIGluc3RlYWQgb2YgdXVpZAogICAgICAgICAgICBiaTogYmkudXVpZCwKICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiB1c2UgaWQgaW5zdGVhZCBvZiB1dWlkCiAgICAgICAgICAgIGJqOiBiai51dWlkLAogICAgICAgICAgICAvLyBOb3JtYWwgb2YgdGhlIGNvbnRhY3QsIHJlbGF0aXZlIHRvIHRoZSBjb2xsaWRpbmcgYm9keQogICAgICAgICAgICBjb250YWN0Tm9ybWFsOiBjb250YWN0Tm9ybWFsLnRvQXJyYXkoKSwKICAgICAgICAgICAgLy8gV29ybGQgcG9zaXRpb24gb2YgdGhlIGNvbnRhY3QKICAgICAgICAgICAgY29udGFjdFBvaW50OiBjb250YWN0UG9pbnQudG9BcnJheSgpLAogICAgICAgICAgICBpZCwKICAgICAgICAgICAgaW1wYWN0VmVsb2NpdHk6IGNvbnRhY3QuZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbCgpLAogICAgICAgICAgICBuaTogbmkudG9BcnJheSgpLAogICAgICAgICAgICByaTogcmkudG9BcnJheSgpLAogICAgICAgICAgICByajogcmoudG9BcnJheSgpCiAgICAgICAgICB9LAogICAgICAgICAgb3A6ICdldmVudCcsCiAgICAgICAgICB0YXJnZXQ6IHRhcmdldC51dWlkLAogICAgICAgICAgdHlwZQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9OwoKICBjb25zdCB0cmlwbGV0VG9WZWMzID0gdCA9PiB0ID8gbmV3IFZlYzMoLi4udCkgOiB1bmRlZmluZWQ7CgogIGNvbnN0IGFkZENvbnN0cmFpbnQgPSAoc3RhdGUsIF9yZWYpID0+IHsKICAgIGxldCB7CiAgICAgIHByb3BzOiBbYm9keUEsIGJvZHlCLCB7CiAgICAgICAgYW5nbGUsCiAgICAgICAgYXhpc0EsCiAgICAgICAgYXhpc0IsCiAgICAgICAgY29sbGlkZUNvbm5lY3RlZCwKICAgICAgICBkaXN0YW5jZSwKICAgICAgICBtYXhGb3JjZSwKICAgICAgICBtYXhNdWx0aXBsaWVyLAogICAgICAgIHBpdm90QSwKICAgICAgICBwaXZvdEIsCiAgICAgICAgdHdpc3RBbmdsZSwKICAgICAgICB3YWtlVXBCb2RpZXMKICAgICAgfV0sCiAgICAgIHR5cGUsCiAgICAgIHV1aWQKICAgIH0gPSBfcmVmOwogICAgbGV0IGNvbnN0cmFpbnQ7CgogICAgc3dpdGNoICh0eXBlKSB7CiAgICAgIGNhc2UgJ1BvaW50VG9Qb2ludCc6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBQb2ludFRvUG9pbnRDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHRyaXBsZXRUb1ZlYzMocGl2b3RBKSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgdHJpcGxldFRvVmVjMyhwaXZvdEIpLCBtYXhGb3JjZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdDb25lVHdpc3QnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgQ29uZVR3aXN0Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBhbmdsZSwKICAgICAgICAgIGF4aXNBOiB0cmlwbGV0VG9WZWMzKGF4aXNBKSwKICAgICAgICAgIGF4aXNCOiB0cmlwbGV0VG9WZWMzKGF4aXNCKSwKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICBtYXhGb3JjZSwKICAgICAgICAgIHBpdm90QTogdHJpcGxldFRvVmVjMyhwaXZvdEEpLAogICAgICAgICAgcGl2b3RCOiB0cmlwbGV0VG9WZWMzKHBpdm90QiksCiAgICAgICAgICB0d2lzdEFuZ2xlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdIaW5nZSc6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBIaW5nZUNvbnN0cmFpbnQoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgewogICAgICAgICAgYXhpc0E6IHRyaXBsZXRUb1ZlYzMoYXhpc0EpLAogICAgICAgICAgYXhpc0I6IHRyaXBsZXRUb1ZlYzMoYXhpc0IpLAogICAgICAgICAgY29sbGlkZUNvbm5lY3RlZCwKICAgICAgICAgIG1heEZvcmNlLAogICAgICAgICAgcGl2b3RBOiB0cmlwbGV0VG9WZWMzKHBpdm90QSksCiAgICAgICAgICBwaXZvdEI6IHRyaXBsZXRUb1ZlYzMocGl2b3RCKQogICAgICAgIH0pOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnRGlzdGFuY2UnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgRGlzdGFuY2VDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIGRpc3RhbmNlLCBtYXhGb3JjZSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdMb2NrJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IExvY2tDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIG1heEZvcmNlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CgogICAgICBkZWZhdWx0OgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgICAgd2FrZVVwQm9kaWVzCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICB9CgogICAgY29uc3RyYWludC51dWlkID0gdXVpZDsKICAgIHN0YXRlLndvcmxkLmFkZENvbnN0cmFpbnQoY29uc3RyYWludCk7CgogICAgaWYgKG1heE11bHRpcGxpZXIgIT09IHVuZGVmaW5lZCkgewogICAgICBjb25zdCBwb3N0U3RlcENvbnN0cmFpbnQgPSAoKSA9PiB7CiAgICAgICAgLy8gVGhlIG11bHRpcGxpZXIgaXMgcHJvcG9ydGlvbmFsIHRvIGhvdyBtdWNoIGZvcmNlIGlzIGFkZGVkIHRvIHRoZSBib2RpZXMgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgICAgLy8gSWYgdGhpcyBleGNlZWRzIGEgbGltaXQgdGhlIGNvbnN0cmFpbnQgaXMgZGlzYWJsZWQuCiAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IE1hdGguYWJzKGNvbnN0cmFpbnQuZXF1YXRpb25zWzBdLm11bHRpcGxpZXIpOwoKICAgICAgICBpZiAobXVsdGlwbGllciA+IG1heE11bHRpcGxpZXIpIHsKICAgICAgICAgIGNvbnN0cmFpbnQuZGlzYWJsZSgpOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIHN0YXRlLmNvbnN0cmFpbnRzW3V1aWRdID0gcG9zdFN0ZXBDb25zdHJhaW50OwogICAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwb3N0U3RlcCcsIHN0YXRlLmNvbnN0cmFpbnRzW3V1aWRdKTsKICAgIH0KICB9OwoKICBmdW5jdGlvbiB0b1VwcGVyY2FzZShzdHIpIHsKICAgIHJldHVybiBzdHIudG9VcHBlckNhc2UoKTsKICB9CgogIGNvbnN0IGFkZFJheSA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IHsKICAgICAgICBmcm9tLAogICAgICAgIG1vZGUsCiAgICAgICAgdG8sCiAgICAgICAgLi4ucmF5T3B0aW9ucwogICAgICB9LAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHJheSA9IG5ldyBSYXkodHJpcGxldFRvVmVjMyhmcm9tKSwgdHJpcGxldFRvVmVjMyh0bykpOwogICAgY29uc3Qgb3B0aW9ucyA9IHsKICAgICAgbW9kZTogUkFZX01PREVTW3RvVXBwZXJjYXNlKG1vZGUpXSwKICAgICAgcmVzdWx0OiBuZXcgUmF5Y2FzdFJlc3VsdCgpLAogICAgICAuLi5yYXlPcHRpb25zCiAgICB9OwoKICAgIHN0YXRlLnJheXNbdXVpZF0gPSAoKSA9PiB7CiAgICAgIHJheS5pbnRlcnNlY3RXb3JsZChzdGF0ZS53b3JsZCwgb3B0aW9ucyk7CiAgICAgIGlmICghb3B0aW9ucy5yZXN1bHQgfHwgIW9wdGlvbnMucmVzdWx0LmJvZHkpIHJldHVybjsKICAgICAgY29uc3QgewogICAgICAgIGJvZHksCiAgICAgICAgc2hhcGUsCiAgICAgICAgcmF5RnJvbVdvcmxkLAogICAgICAgIHJheVRvV29ybGQsCiAgICAgICAgaGl0Tm9ybWFsV29ybGQsCiAgICAgICAgaGl0UG9pbnRXb3JsZCwKICAgICAgICAuLi5yZXN0CiAgICAgIH0gPSBvcHRpb25zLnJlc3VsdDsKICAgICAgY29uc3QgYm9keVVVSUQgPSBib2R5LnV1aWQ7CiAgICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICAgIGJvZHk6IGJvZHlVVUlEIHx8IG51bGwsCiAgICAgICAgaGl0Tm9ybWFsV29ybGQ6IGhpdE5vcm1hbFdvcmxkLnRvQXJyYXkoKSwKICAgICAgICBoaXRQb2ludFdvcmxkOiBoaXRQb2ludFdvcmxkLnRvQXJyYXkoKSwKICAgICAgICBvcDogJ2V2ZW50JywKICAgICAgICByYXk6IHsKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlckdyb3VwOiByYXkuY29sbGlzaW9uRmlsdGVyR3JvdXAsCiAgICAgICAgICBjb2xsaXNpb25GaWx0ZXJNYXNrOiByYXkuY29sbGlzaW9uRmlsdGVyTWFzaywKICAgICAgICAgIGRpcmVjdGlvbjogcmF5LmRpcmVjdGlvbi50b0FycmF5KCksCiAgICAgICAgICBmcm9tLAogICAgICAgICAgdG8sCiAgICAgICAgICB1dWlkCiAgICAgICAgfSwKICAgICAgICByYXlGcm9tV29ybGQ6IHJheUZyb21Xb3JsZC50b0FycmF5KCksCiAgICAgICAgcmF5VG9Xb3JsZDogcmF5VG9Xb3JsZC50b0FycmF5KCksCiAgICAgICAgc2hhcGU6IHNoYXBlID8geyAuLi5zaGFwZSwKICAgICAgICAgIGJvZHk6IGJvZHlVVUlECiAgICAgICAgfSA6IG51bGwsCiAgICAgICAgdHlwZTogJ3JheWhpdCcsCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH07CgogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHN0YXRlLnJheXNbdXVpZF0pOwogIH07CgogIGNvbnN0IGFkZFJheWNhc3RWZWhpY2xlID0gKHN0YXRlLCBkYXRhKSA9PiB7CiAgICBjb25zdCBbY2hhc3Npc0JvZHksIHdoZWVscywgd2hlZWxJbmZvcywgaW5kZXhGb3J3YXJkQXhpcywgaW5kZXhSaWdodEF4aXMsIGluZGV4VXBBeGlzXSA9IGRhdGEucHJvcHM7CiAgICBjb25zdCB2ZWhpY2xlID0gbmV3IFJheWNhc3RWZWhpY2xlKHsKICAgICAgY2hhc3Npc0JvZHk6IHN0YXRlLmJvZGllc1tjaGFzc2lzQm9keV0sCiAgICAgIGluZGV4Rm9yd2FyZEF4aXMsCiAgICAgIGluZGV4UmlnaHRBeGlzLAogICAgICBpbmRleFVwQXhpcwogICAgfSk7CiAgICB2ZWhpY2xlLndvcmxkID0gc3RhdGUud29ybGQ7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3aGVlbEluZm9zLmxlbmd0aDsgaSsrKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBheGxlTG9jYWwsCiAgICAgICAgY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsLAogICAgICAgIGRpcmVjdGlvbkxvY2FsLAogICAgICAgIC4uLnJlc3QKICAgICAgfSA9IHdoZWVsSW5mb3NbaV07CiAgICAgIHZlaGljbGUuYWRkV2hlZWwoewogICAgICAgIGF4bGVMb2NhbDogdHJpcGxldFRvVmVjMyhheGxlTG9jYWwpLAogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbDogdHJpcGxldFRvVmVjMyhjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwpLAogICAgICAgIGRpcmVjdGlvbkxvY2FsOiB0cmlwbGV0VG9WZWMzKGRpcmVjdGlvbkxvY2FsKSwKICAgICAgICAuLi5yZXN0CiAgICAgIH0pOwogICAgfQoKICAgIGNvbnN0IHByZVN0ZXAgPSAoKSA9PiB7CiAgICAgIHZlaGljbGUudXBkYXRlVmVoaWNsZShzdGF0ZS53b3JsZC5kdCk7CiAgICB9OwoKICAgIGNvbnN0IHBvc3RTdGVwID0gKCkgPT4gewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZlaGljbGUud2hlZWxJbmZvcy5sZW5ndGg7IGkrKykgewogICAgICAgIHZlaGljbGUudXBkYXRlV2hlZWxUcmFuc2Zvcm0oaSk7CiAgICAgICAgY29uc3QgdCA9IHZlaGljbGUud2hlZWxJbmZvc1tpXS53b3JsZFRyYW5zZm9ybTsKICAgICAgICBjb25zdCB3aGVlbEJvZHkgPSBzdGF0ZS5ib2RpZXNbd2hlZWxzW2ldXTsKICAgICAgICB3aGVlbEJvZHkucG9zaXRpb24uY29weSh0LnBvc2l0aW9uKTsKICAgICAgICB3aGVlbEJvZHkucXVhdGVybmlvbi5jb3B5KHQucXVhdGVybmlvbik7CiAgICAgIH0KICAgIH07CgogICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXSA9IHsKICAgICAgcG9zdFN0ZXAsCiAgICAgIHByZVN0ZXAsCiAgICAgIHZlaGljbGUKICAgIH07CiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwcmVTdGVwJywgcHJlU3RlcCk7CiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwb3N0U3RlcCcsIHBvc3RTdGVwKTsKICB9OwoKICBjb25zdCBhZGRTcHJpbmcgPSAoc3RhdGUsIF9yZWYpID0+IHsKICAgIGxldCB7CiAgICAgIHByb3BzOiBbYm9keUEsIGJvZHlCLCB7CiAgICAgICAgZGFtcGluZywKICAgICAgICBsb2NhbEFuY2hvckEsCiAgICAgICAgbG9jYWxBbmNob3JCLAogICAgICAgIHJlc3RMZW5ndGgsCiAgICAgICAgc3RpZmZuZXNzLAogICAgICAgIHdvcmxkQW5jaG9yQSwKICAgICAgICB3b3JsZEFuY2hvckIKICAgICAgfV0sCiAgICAgIHV1aWQKICAgIH0gPSBfcmVmOwogICAgY29uc3Qgc3ByaW5nID0gbmV3IFNwcmluZyhzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgIGRhbXBpbmcsCiAgICAgIGxvY2FsQW5jaG9yQTogdHJpcGxldFRvVmVjMyhsb2NhbEFuY2hvckEpLAogICAgICBsb2NhbEFuY2hvckI6IHRyaXBsZXRUb1ZlYzMobG9jYWxBbmNob3JCKSwKICAgICAgcmVzdExlbmd0aCwKICAgICAgc3RpZmZuZXNzLAogICAgICB3b3JsZEFuY2hvckE6IHRyaXBsZXRUb1ZlYzMod29ybGRBbmNob3JBKSwKICAgICAgd29ybGRBbmNob3JCOiB0cmlwbGV0VG9WZWMzKHdvcmxkQW5jaG9yQikKICAgIH0pOwogICAgc3ByaW5nLnV1aWQgPSB1dWlkOwoKICAgIGNvbnN0IHBvc3RTdGVwU3ByaW5nID0gKCkgPT4gc3ByaW5nLmFwcGx5Rm9yY2UoKTsKCiAgICBzdGF0ZS5zcHJpbmdzW3V1aWRdID0gcG9zdFN0ZXBTcHJpbmc7CiAgICBzdGF0ZS5zcHJpbmdJbnN0YW5jZXNbdXVpZF0gPSBzcHJpbmc7IC8vIENvbXB1dGUgdGhlIGZvcmNlIGFmdGVyIGVhY2ggc3RlcAoKICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1t1dWlkXSk7CiAgfTsKCiAgZnVuY3Rpb24gZW1pdEJlZ2luQ29udGFjdChfcmVmKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmOwogICAgaWYgKCFib2R5QSB8fCAhYm9keUIpIHJldHVybjsKICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICBib2R5QTogYm9keUEudXVpZCwKICAgICAgYm9keUI6IGJvZHlCLnV1aWQsCiAgICAgIG9wOiAnZXZlbnQnLAogICAgICB0eXBlOiAnY29sbGlkZUJlZ2luJwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBlbWl0RW5kQ29udGFjdChfcmVmMikgewogICAgbGV0IHsKICAgICAgYm9keUEsCiAgICAgIGJvZHlCCiAgICB9ID0gX3JlZjI7CiAgICBpZiAoIWJvZHlBIHx8ICFib2R5QikgcmV0dXJuOwogICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgIGJvZHlBOiBib2R5QS51dWlkLAogICAgICBib2R5QjogYm9keUIudXVpZCwKICAgICAgb3A6ICdldmVudCcsCiAgICAgIHR5cGU6ICdjb2xsaWRlRW5kJwogICAgfSk7CiAgfQoKICBjb25zdCBpbml0ID0gKHN0YXRlLCBfcmVmMykgPT4gewogICAgbGV0IHsKICAgICAgYWxsb3dTbGVlcCwKICAgICAgYXhpc0luZGV4ID0gMCwKICAgICAgYnJvYWRwaGFzZSwKICAgICAgZGVmYXVsdENvbnRhY3RNYXRlcmlhbCwKICAgICAgZ3Jhdml0eSwKICAgICAgaXRlcmF0aW9ucywKICAgICAgcXVhdE5vcm1hbGl6ZUZhc3QsCiAgICAgIHF1YXROb3JtYWxpemVTa2lwLAogICAgICBzb2x2ZXIsCiAgICAgIHRvbGVyYW5jZQogICAgfSA9IF9yZWYzOwogICAgc3RhdGUud29ybGQuYWxsb3dTbGVlcCA9IGFsbG93U2xlZXA7CiAgICBzdGF0ZS53b3JsZC5ncmF2aXR5LnNldChncmF2aXR5WzBdLCBncmF2aXR5WzFdLCBncmF2aXR5WzJdKTsKICAgIHN0YXRlLndvcmxkLnF1YXROb3JtYWxpemVGYXN0ID0gcXVhdE5vcm1hbGl6ZUZhc3Q7CiAgICBzdGF0ZS53b3JsZC5xdWF0Tm9ybWFsaXplU2tpcCA9IHF1YXROb3JtYWxpemVTa2lwOwoKICAgIGlmIChzb2x2ZXIgPT09ICdTcGxpdCcpIHsKICAgICAgc3RhdGUud29ybGQuc29sdmVyID0gbmV3IFNwbGl0U29sdmVyKG5ldyBHU1NvbHZlcigpKTsKICAgIH0KCiAgICBpZiAoc3RhdGUud29ybGQuc29sdmVyIGluc3RhbmNlb2YgR1NTb2x2ZXIpIHsKICAgICAgc3RhdGUud29ybGQuc29sdmVyLnRvbGVyYW5jZSA9IHRvbGVyYW5jZTsKICAgICAgc3RhdGUud29ybGQuc29sdmVyLml0ZXJhdGlvbnMgPSBpdGVyYXRpb25zOwogICAgfQoKICAgIHN0YXRlLndvcmxkLmJyb2FkcGhhc2UgPSBicm9hZHBoYXNlID09PSAnU0FQJyA/IG5ldyBTQVBCcm9hZHBoYXNlKHN0YXRlLndvcmxkKSA6IG5ldyBOYWl2ZUJyb2FkcGhhc2UoKTsKCiAgICBpZiAoc3RhdGUud29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgc3RhdGUud29ybGQuYnJvYWRwaGFzZS5heGlzSW5kZXggPSBheGlzSW5kZXg7CiAgICB9CgogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcignYmVnaW5Db250YWN0JywgZW1pdEJlZ2luQ29udGFjdCk7CiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdlbmRDb250YWN0JywgZW1pdEVuZENvbnRhY3QpOwogICAgT2JqZWN0LmFzc2lnbihzdGF0ZS53b3JsZC5kZWZhdWx0Q29udGFjdE1hdGVyaWFsLCBkZWZhdWx0Q29udGFjdE1hdGVyaWFsKTsKICB9OwoKICBjb25zdCBpc1FvclYgPSB2ID0+IHYgaW5zdGFuY2VvZiBRdWF0ZXJuaW9uIHx8IHYgaW5zdGFuY2VvZiBWZWMzOwoKICBjb25zdCBzdGVwID0gKHN0YXRlLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwb3NpdGlvbnMsCiAgICAgIHByb3BzOiB7CiAgICAgICAgbWF4U3ViU3RlcHMsCiAgICAgICAgc3RlcFNpemUsCiAgICAgICAgdGltZVNpbmNlTGFzdENhbGxlZAogICAgICB9LAogICAgICBxdWF0ZXJuaW9ucwogICAgfSA9IF9yZWY7CiAgICBzdGF0ZS53b3JsZC5zdGVwKHN0ZXBTaXplLCB0aW1lU2luY2VMYXN0Q2FsbGVkLCBtYXhTdWJTdGVwcyk7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdGF0ZS53b3JsZC5ib2RpZXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgY29uc3QgcCA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5wb3NpdGlvbjsKICAgICAgY29uc3QgcSA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5xdWF0ZXJuaW9uOwogICAgICBwb3NpdGlvbnNbMyAqIGkgKyAwXSA9IHAueDsKICAgICAgcG9zaXRpb25zWzMgKiBpICsgMV0gPSBwLnk7CiAgICAgIHBvc2l0aW9uc1szICogaSArIDJdID0gcC56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDBdID0gcS54OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDFdID0gcS55OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDJdID0gcS56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDNdID0gcS53OwogICAgfQoKICAgIGNvbnN0IG9ic2VydmF0aW9ucyA9IFtdOwoKICAgIGZvciAoY29uc3QgaWQgb2YgT2JqZWN0LmtleXMoc3RhdGUuc3Vic2NyaXB0aW9ucykpIHsKICAgICAgY29uc3QgW3V1aWQsIHR5cGUsIHRhcmdldCA9ICdib2RpZXMnXSA9IHN0YXRlLnN1YnNjcmlwdGlvbnNbaWRdOwogICAgICBjb25zdCB7CiAgICAgICAgYm9kaWVzLAogICAgICAgIHZlaGljbGVzCiAgICAgIH0gPSBzdGF0ZTsKICAgICAgY29uc3QgdmFsdWUgPSB0YXJnZXQgPT09ICd2ZWhpY2xlcycgPyAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IERpZmZlcmVudGlhdGUgdGhlc2UgInR5cGVzIgogICAgICB2ZWhpY2xlc1t1dWlkXS52ZWhpY2xlW3R5cGVdIDogLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgYm9kaWVzW3V1aWRdW3R5cGVdOwogICAgICBjb25zdCBzZXJpYWxpemFibGVWYWx1ZSA9IGlzUW9yVih2YWx1ZSkgPyB2YWx1ZS50b0FycmF5KCkgOiB2YWx1ZTsKICAgICAgb2JzZXJ2YXRpb25zLnB1c2goW051bWJlcihpZCksIHNlcmlhbGl6YWJsZVZhbHVlLCAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IERpZmZlcmVudGlhdGUgdGhlc2UgInR5cGVzIgogICAgICB0eXBlXSk7CiAgICB9CgogICAgY29uc3QgbWVzc2FnZSA9IHsKICAgICAgYWN0aXZlOiBzdGF0ZS53b3JsZC5oYXNBY3RpdmVCb2RpZXMsCiAgICAgIG9ic2VydmF0aW9ucywKICAgICAgb3A6ICdmcmFtZScsCiAgICAgIHBvc2l0aW9ucywKICAgICAgcXVhdGVybmlvbnMKICAgIH07CgogICAgaWYgKHN0YXRlLmJvZGllc05lZWRTeW5jaW5nKSB7CiAgICAgIG1lc3NhZ2UuYm9kaWVzID0gc3RhdGUud29ybGQuYm9kaWVzLnJlZHVjZSgoYm9kaWVzLCBib2R5KSA9PiB7CiAgICAgICAgaWYgKGJvZHkudXVpZCkgYm9kaWVzLnB1c2goYm9keS51dWlkKTsKICAgICAgICByZXR1cm4gYm9kaWVzOwogICAgICB9LCBbXSk7CiAgICAgIHN0YXRlLmJvZGllc05lZWRTeW5jaW5nID0gZmFsc2U7CiAgICB9CgogICAgc2VsZi5wb3N0TWVzc2FnZShtZXNzYWdlLCBbcG9zaXRpb25zLmJ1ZmZlciwgcXVhdGVybmlvbnMuYnVmZmVyXSk7CiAgfTsKCiAgY29uc3Qgc3RhdGUgPSB7CiAgICBib2RpZXM6IHt9LAogICAgYm9kaWVzTmVlZFN5bmNpbmc6IGZhbHNlLAogICAgY29uc3RyYWludHM6IHt9LAogICAgbWF0ZXJpYWxzOiB7fSwKICAgIHJheXM6IHt9LAogICAgc3ByaW5nSW5zdGFuY2VzOiB7fSwKICAgIHNwcmluZ3M6IHt9LAogICAgc3Vic2NyaXB0aW9uczoge30sCiAgICB2ZWhpY2xlczoge30sCiAgICB3b3JsZDogbmV3IFdvcmxkKCkKICB9OwoKICAvLy8gPHJlZmVyZW5jZSBuby1kZWZhdWx0LWxpYj0idHJ1ZSIvPgoKICBjb25zdCBpc0hpbmdlQ29uc3RyYWludCA9IGMgPT4gYyBpbnN0YW5jZW9mIEhpbmdlQ29uc3RyYWludDsKCiAgZnVuY3Rpb24gc3luY0JvZGllcygpIHsKICAgIHN0YXRlLmJvZGllc05lZWRTeW5jaW5nID0gdHJ1ZTsKICAgIHN0YXRlLmJvZGllcyA9IHN0YXRlLndvcmxkLmJvZGllcy5yZWR1Y2UoKGJvZGllcywgYm9keSkgPT4gKHsgLi4uYm9kaWVzLAogICAgICBbYm9keS51dWlkXTogYm9keQogICAgfSksIHt9KTsKICB9CgogIGNvbnN0IGJyb2FkcGhhc2VzID0gewogICAgTmFpdmVCcm9hZHBoYXNlLAogICAgU0FQQnJvYWRwaGFzZQogIH07CiAgY29uc3QgY3JlYXRlTWF0ZXJpYWwgPSBjcmVhdGVNYXRlcmlhbEZhY3Rvcnkoc3RhdGUubWF0ZXJpYWxzKTsKCiAgc2VsZi5vbm1lc3NhZ2UgPSBfcmVmID0+IHsKICAgIGxldCB7CiAgICAgIGRhdGEKICAgIH0gPSBfcmVmOwoKICAgIHN3aXRjaCAoZGF0YS5vcCkgewogICAgICBjYXNlICdpbml0JzoKICAgICAgICB7CiAgICAgICAgICBpbml0KHN0YXRlLCBkYXRhLnByb3BzKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3N0ZXAnOgogICAgICAgIHsKICAgICAgICAgIHN0ZXAoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnYWRkQm9kaWVzJzoKICAgICAgICB7CiAgICAgICAgICBhZGRCb2RpZXMoc3RhdGUsIGNyZWF0ZU1hdGVyaWFsLCBkYXRhKTsKICAgICAgICAgIHN5bmNCb2RpZXMoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3JlbW92ZUJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLnV1aWQubGVuZ3RoOyBpKyspIHN0YXRlLndvcmxkLnJlbW92ZUJvZHkoc3RhdGUuYm9kaWVzW2RhdGEudXVpZFtpXV0pOwoKICAgICAgICAgIHN5bmNCb2RpZXMoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3N1YnNjcmliZSc6CiAgICAgICAgewogICAgICAgICAgY29uc3QgewogICAgICAgICAgICBpZCwKICAgICAgICAgICAgdGFyZ2V0LAogICAgICAgICAgICB0eXBlCiAgICAgICAgICB9ID0gZGF0YS5wcm9wczsKICAgICAgICAgIHN0YXRlLnN1YnNjcmlwdGlvbnNbaWRdID0gW2RhdGEudXVpZCwgdHlwZSwgdGFyZ2V0XTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3Vuc3Vic2NyaWJlJzoKICAgICAgICB7CiAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1tkYXRhLnByb3BzXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3NldFBvc2l0aW9uJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5wb3NpdGlvbi5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRRdWF0ZXJuaW9uJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5xdWF0ZXJuaW9uLnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdLCBkYXRhLnByb3BzWzNdKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldFJvdGF0aW9uJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlcihkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldFZlbG9jaXR5JzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS52ZWxvY2l0eS5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRBbmd1bGFyVmVsb2NpdHknOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJWZWxvY2l0eS5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRMaW5lYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmxpbmVhckZhY3Rvci5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRBbmd1bGFyRmFjdG9yJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hbmd1bGFyRmFjdG9yLnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldE1hc3MnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLm1hc3MgPSBkYXRhLnByb3BzOwogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnVwZGF0ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRNYXRlcmlhbCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ubWF0ZXJpYWwgPSBkYXRhLnByb3BzID8gY3JlYXRlTWF0ZXJpYWwoZGF0YS5wcm9wcykgOiBudWxsOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0TGluZWFyRGFtcGluZyc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ubGluZWFyRGFtcGluZyA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRBbmd1bGFyRGFtcGluZyc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYW5ndWxhckRhbXBpbmcgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0QWxsb3dTbGVlcCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYWxsb3dTbGVlcCA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRTbGVlcFNwZWVkTGltaXQnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnNsZWVwU3BlZWRMaW1pdCA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRTbGVlcFRpbWVMaW1pdCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uc2xlZXBUaW1lTGltaXQgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyR3JvdXAnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldENvbGxpc2lvbkZpbHRlck1hc2snOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmNvbGxpc2lvbkZpbHRlck1hc2sgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uUmVzcG9uc2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmNvbGxpc2lvblJlc3BvbnNlID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldEZpeGVkUm90YXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmZpeGVkUm90YXRpb24gPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0SXNUcmlnZ2VyJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5pc1RyaWdnZXIgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0R3Jhdml0eSc6CiAgICAgICAgc3RhdGUud29ybGQuZ3Jhdml0eS5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRUb2xlcmFuY2UnOgogICAgICAgIGlmIChzdGF0ZS53b3JsZC5zb2x2ZXIgaW5zdGFuY2VvZiBHU1NvbHZlcikgewogICAgICAgICAgc3RhdGUud29ybGQuc29sdmVyLnRvbGVyYW5jZSA9IGRhdGEucHJvcHM7CiAgICAgICAgfQoKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldEl0ZXJhdGlvbnMnOgogICAgICAgIGlmIChzdGF0ZS53b3JsZC5zb2x2ZXIgaW5zdGFuY2VvZiBHU1NvbHZlcikgewogICAgICAgICAgc3RhdGUud29ybGQuc29sdmVyLml0ZXJhdGlvbnMgPSBkYXRhLnByb3BzOwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRCcm9hZHBoYXNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5icm9hZHBoYXNlID0gbmV3IChicm9hZHBoYXNlc1tgJHtkYXRhLnByb3BzfUJyb2FkcGhhc2VgXSB8fCBOYWl2ZUJyb2FkcGhhc2UpKHN0YXRlLndvcmxkKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldEF4aXNJbmRleCc6CiAgICAgICAgaWYgKHN0YXRlLndvcmxkLmJyb2FkcGhhc2UgaW5zdGFuY2VvZiBTQVBCcm9hZHBoYXNlKSB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5icm9hZHBoYXNlLmF4aXNJbmRleCA9IGRhdGEucHJvcHMgPT09IHVuZGVmaW5lZCB8fCBkYXRhLnByb3BzID09PSBudWxsID8gMCA6IGRhdGEucHJvcHM7CiAgICAgICAgfQoKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2FwcGx5Rm9yY2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5Rm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2FwcGx5SW1wdWxzZSc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYXBwbHlJbXB1bHNlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5kYXRhLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdhcHBseUxvY2FsRm9yY2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5TG9jYWxGb3JjZShuZXcgVmVjMyguLi5kYXRhLnByb3BzWzBdKSwgbmV3IFZlYzMoLi4uZGF0YS5wcm9wc1sxXSkpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnYXBwbHlMb2NhbEltcHVsc2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5TG9jYWxJbXB1bHNlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5kYXRhLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdhcHBseVRvcnF1ZSc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYXBwbHlUb3JxdWUobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSkpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnYWRkQ29uc3RyYWludCc6CiAgICAgICAgewogICAgICAgICAgYWRkQ29uc3RyYWludChzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdyZW1vdmVDb25zdHJhaW50JzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoX3JlZjIgPT4gewogICAgICAgICAgbGV0IHsKICAgICAgICAgICAgdXVpZAogICAgICAgICAgfSA9IF9yZWYyOwogICAgICAgICAgcmV0dXJuIHV1aWQgPT09IGRhdGEudXVpZDsKICAgICAgICB9KS5tYXAoYyA9PiBzdGF0ZS53b3JsZC5yZW1vdmVDb25zdHJhaW50KGMpKTsKCiAgICAgICAgaWYgKHN0YXRlLmNvbnN0cmFpbnRzW2RhdGEudXVpZF0pIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuY29uc3RyYWludHNbZGF0YS51dWlkXSk7CiAgICAgICAgICBkZWxldGUgc3RhdGUuY29uc3RyYWludHNbZGF0YS51dWlkXTsKICAgICAgICB9CgogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZW5hYmxlKCkpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnZGlzYWJsZUNvbnN0cmFpbnQnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5tYXAoYyA9PiBjLmRpc2FibGUoKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdlbmFibGVDb25zdHJhaW50TW90b3InOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5maWx0ZXIoaXNIaW5nZUNvbnN0cmFpbnQpLm1hcChjID0+IGMuZW5hYmxlTW90b3IoKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmRpc2FibGVNb3RvcigpKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldENvbnN0cmFpbnRNb3RvclNwZWVkJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLnNldE1vdG9yU3BlZWQoZGF0YS5wcm9wcykpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0Q29uc3RyYWludE1vdG9yTWF4Rm9yY2UnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5maWx0ZXIoaXNIaW5nZUNvbnN0cmFpbnQpLm1hcChjID0+IGMuc2V0TW90b3JNYXhGb3JjZShkYXRhLnByb3BzKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdhZGRTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIGFkZFNwcmluZyhzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdzZXRTcHJpbmdTdGlmZm5lc3MnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1tkYXRhLnV1aWRdLnN0aWZmbmVzcyA9IGRhdGEucHJvcHM7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdzZXRTcHJpbmdSZXN0TGVuZ3RoJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS5zcHJpbmdJbnN0YW5jZXNbZGF0YS51dWlkXS5yZXN0TGVuZ3RoID0gZGF0YS5wcm9wczsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3NldFNwcmluZ0RhbXBpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1tkYXRhLnV1aWRdLmRhbXBpbmcgPSBkYXRhLnByb3BzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAncmVtb3ZlU3ByaW5nJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5yZW1vdmVFdmVudExpc3RlbmVyKCdwb3N0U3RlcCcsIHN0YXRlLnNwcmluZ3NbZGF0YS51dWlkXSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdhZGRSYXknOgogICAgICAgIHsKICAgICAgICAgIGFkZFJheShzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdyZW1vdmVSYXknOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS5yYXlzW2RhdGEudXVpZF0pOwogICAgICAgICAgZGVsZXRlIHN0YXRlLnJheXNbZGF0YS51dWlkXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ2FkZFJheWNhc3RWZWhpY2xlJzoKICAgICAgICB7CiAgICAgICAgICBhZGRSYXljYXN0VmVoaWNsZShzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdyZW1vdmVSYXljYXN0VmVoaWNsZSc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0ucHJlU3RlcCk7CiAgICAgICAgICBzdGF0ZS53b3JsZC5yZW1vdmVFdmVudExpc3RlbmVyKCdwb3N0U3RlcCcsIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0ucG9zdFN0ZXApOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLndvcmxkID0gbnVsbDsKICAgICAgICAgIGRlbGV0ZSBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc2V0UmF5Y2FzdFZlaGljbGVTdGVlcmluZ1ZhbHVlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbdmFsdWUsIHdoZWVsSW5kZXhdID0gZGF0YS5wcm9wczsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS5zZXRTdGVlcmluZ1ZhbHVlKHZhbHVlLCB3aGVlbEluZGV4KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ2FwcGx5UmF5Y2FzdFZlaGljbGVFbmdpbmVGb3JjZSc6CiAgICAgICAgewogICAgICAgICAgY29uc3QgW3ZhbHVlLCB3aGVlbEluZGV4XSA9IGRhdGEucHJvcHM7CiAgICAgICAgICBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnZlaGljbGUuYXBwbHlFbmdpbmVGb3JjZSh2YWx1ZSwgd2hlZWxJbmRleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZUJyYWtlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbYnJha2UsIHdoZWVsSW5kZXhdID0gZGF0YS5wcm9wczsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS5zZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdhZGRDb250YWN0TWF0ZXJpYWwnOgogICAgICAgIHsKICAgICAgICAgIGFkZENvbnRhY3RNYXRlcmlhbChzdGF0ZS53b3JsZCwgY3JlYXRlTWF0ZXJpYWwsIGRhdGEucHJvcHMsIGRhdGEudXVpZCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdyZW1vdmVDb250YWN0TWF0ZXJpYWwnOgogICAgICAgIHsKICAgICAgICAgIHJlbW92ZUNvbnRhY3RNYXRlcmlhbChzdGF0ZS53b3JsZCwgZGF0YS51dWlkKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3dha2VVcCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ud2FrZVVwKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdzbGVlcCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uc2xlZXAoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIH0KICB9OwoKfSkoKTsKCg==",h=null,A=!1,u?I(d,h,A):function(e,t,n){var i;return function(o){return i=i||C(e,t,n),new Worker(i,o)}}(d,h,A));class m extends(s()){get axisIndex(){return this.config.axisIndex}set axisIndex(e){this.config.axisIndex=e,this.worker.postMessage({op:"setAxisIndex",props:e})}get broadphase(){return this.config.broadphase}set broadphase(e){this.config.broadphase=e,this.worker.postMessage({op:"setBroadphase",props:e})}get gravity(){return this.config.gravity}set gravity(e){this.config.gravity=e,this.worker.postMessage({op:"setGravity",props:e})}get iterations(){return this.config.iterations}set iterations(e){this.config.iterations=e,this.worker.postMessage({op:"setIterations",props:e})}get tolerance(){return this.config.tolerance}set tolerance(e){this.config.tolerance=e,this.worker.postMessage({op:"setTolerance",props:e})}constructor(e){let{allowSleep:t=!1,axisIndex:n=0,broadphase:i="Naive",defaultContactMaterial:o={contactEquationStiffness:1e6},gravity:r=[0,-9.81,0],iterations:a=5,quatNormalizeFast:s=!1,quatNormalizeSkip:g=0,size:l=1e3,solver:c="GS",tolerance:I=.001}=e;super(),this.worker=new p,this.config={allowSleep:t,axisIndex:n,broadphase:i,defaultContactMaterial:o,gravity:r,iterations:a,quatNormalizeFast:s,quatNormalizeSkip:g,size:l,solver:c,tolerance:I},this.buffers={positions:new Float32Array(3*l),quaternions:new Float32Array(4*l)},this.worker.onmessage=e=>{if("frame"===e.data.op)return this.buffers.positions=e.data.positions,this.buffers.quaternions=e.data.quaternions,void this.emit(e.data.op,e.data);this.emit(e.data.type,e.data)}}addBodies(e){let{props:t,type:n,uuid:i}=e;this.worker.postMessage({op:"addBodies",props:t,type:n,uuid:i})}addConstraint(e){let{props:[t,n,i],type:o,uuid:r}=e;this.worker.postMessage({op:"addConstraint",props:[t,n,i],type:o,uuid:r})}addContactMaterial(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"addContactMaterial",props:t,uuid:n})}addRay(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"addRay",props:t,uuid:n})}addRaycastVehicle(e){let{props:[t,n,i,o,r,a],uuid:s}=e;this.worker.postMessage({op:"addRaycastVehicle",props:[t,n,i,o,r,a],uuid:s})}addSpring(e){let{props:[t,n,i],uuid:o}=e;this.worker.postMessage({op:"addSpring",props:[t,n,i],uuid:o})}applyForce(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"applyForce",props:t,uuid:n})}applyImpulse(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"applyImpulse",props:t,uuid:n})}applyLocalForce(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"applyLocalForce",props:t,uuid:n})}applyLocalImpulse(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"applyLocalImpulse",props:t,uuid:n})}applyRaycastVehicleEngineForce(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"applyRaycastVehicleEngineForce",props:t,uuid:n})}applyTorque(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"applyTorque",props:t,uuid:n})}disableConstraint(e){let{uuid:t}=e;this.worker.postMessage({op:"disableConstraint",uuid:t})}disableConstraintMotor(e){let{uuid:t}=e;this.worker.postMessage({op:"disableConstraintMotor",uuid:t})}enableConstraint(e){let{uuid:t}=e;this.worker.postMessage({op:"enableConstraint",uuid:t})}enableConstraintMotor(e){let{uuid:t}=e;this.worker.postMessage({op:"enableConstraintMotor",uuid:t})}init(){const{allowSleep:e,axisIndex:t,broadphase:n,defaultContactMaterial:i,gravity:o,iterations:r,quatNormalizeFast:a,quatNormalizeSkip:s,solver:g,tolerance:l}=this.config;this.worker.postMessage({op:"init",props:{allowSleep:e,axisIndex:t,broadphase:n,defaultContactMaterial:i,gravity:o,iterations:r,quatNormalizeFast:a,quatNormalizeSkip:s,solver:g,tolerance:l}})}removeBodies(e){let{uuid:t}=e;this.worker.postMessage({op:"removeBodies",uuid:t})}removeConstraint(e){let{uuid:t}=e;this.worker.postMessage({op:"removeConstraint",uuid:t})}removeContactMaterial(e){let{uuid:t}=e;this.worker.postMessage({op:"removeContactMaterial",uuid:t})}removeRay(e){let{uuid:t}=e;this.worker.postMessage({op:"removeRay",uuid:t})}removeRaycastVehicle(e){let{uuid:t}=e;this.worker.postMessage({op:"removeRaycastVehicle",uuid:t})}removeSpring(e){let{uuid:t}=e;this.worker.postMessage({op:"removeSpring",uuid:t})}setAllowSleep(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setAllowSleep",props:t,uuid:n})}setAngularDamping(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setAngularDamping",props:t,uuid:n})}setAngularFactor(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setAngularFactor",props:t,uuid:n})}setAngularVelocity(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setAngularVelocity",props:t,uuid:n})}setCollisionFilterGroup(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setCollisionFilterGroup",props:t,uuid:n})}setCollisionFilterMask(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setCollisionFilterMask",props:t,uuid:n})}setCollisionResponse(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setCollisionResponse",props:t,uuid:n})}setConstraintMotorMaxForce(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setConstraintMotorMaxForce",props:t,uuid:n})}setConstraintMotorSpeed(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setConstraintMotorSpeed",props:t,uuid:n})}setFixedRotation(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setFixedRotation",props:t,uuid:n})}setIsTrigger(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setIsTrigger",props:t,uuid:n})}setLinearDamping(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setLinearDamping",props:t,uuid:n})}setLinearFactor(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setLinearFactor",props:t,uuid:n})}setMass(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setMass",props:t,uuid:n})}setMaterial(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setMaterial",props:t,uuid:n})}setPosition(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setPosition",props:t,uuid:n})}setQuaternion(e){let{props:[t,n,i,o],uuid:r}=e;this.worker.postMessage({op:"setQuaternion",props:[t,n,i,o],uuid:r})}setRaycastVehicleBrake(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setRaycastVehicleBrake",props:t,uuid:n})}setRaycastVehicleSteeringValue(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setRaycastVehicleSteeringValue",props:t,uuid:n})}setRotation(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setRotation",props:t,uuid:n})}setSleepSpeedLimit(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setSleepSpeedLimit",props:t,uuid:n})}setSleepTimeLimit(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setSleepTimeLimit",props:t,uuid:n})}setSpringDamping(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setSpringDamping",props:t,uuid:n})}setSpringRestLength(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setSpringRestLength",props:t,uuid:n})}setSpringStiffness(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setSpringStiffness",props:t,uuid:n})}setUserData(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setUserData",props:t,uuid:n})}setVelocity(e){let{props:t,uuid:n}=e;this.worker.postMessage({op:"setVelocity",props:t,uuid:n})}sleep(e){let{uuid:t}=e;this.worker.postMessage({op:"sleep",uuid:t})}step(e){const{buffers:{positions:t,quaternions:n}}=this;(t.byteLength||n.byteLength)&&this.worker.postMessage({op:"step",positions:t,props:e,quaternions:n},[t.buffer,n.buffer])}subscribe(e){let{props:{id:t,target:n,type:i},uuid:o}=e;this.worker.postMessage({op:"subscribe",props:{id:t,target:n,type:i},uuid:o})}terminate(){this.worker.terminate()}unsubscribe(e){let{props:t}=e;this.worker.postMessage({op:"unsubscribe",props:t})}wakeUp(e){let{uuid:t}=e;this.worker.postMessage({op:"wakeUp",uuid:t})}}const b=(0,i.createContext)({}),f=(0,i.createContext)(null);const y=new r.Vector3,G=new r.Vector3(1,1,1),v=new r.Quaternion,B=new r.Matrix4;function Z(e,t,n,i){return void 0!==e?(B.compose(y.fromArray(t,3*e),v.fromArray(n,4*e),i?i.scale:G),i&&(i.matrixAutoUpdate=!1,i.matrix.copy(B)),B):B.identity()}const w=e=>{let{allowSleep:t=!1,axisIndex:n=0,broadphase:a="Naive",children:s,defaultContactMaterial:l={contactEquationStiffness:1e6},gravity:c=[0,-9.81,0],isPaused:I=!1,iterations:C=5,maxSubSteps:u=10,quatNormalizeFast:d=!1,quatNormalizeSkip:h=0,shouldInvalidate:A=!0,size:p=1e3,solver:f="GS",stepSize:y=1/60,tolerance:G=.001}=e;const{invalidate:v}=(0,o.yk)(),[B]=(0,i.useState)((()=>new m({allowSleep:t,axisIndex:n,broadphase:a,defaultContactMaterial:l,gravity:c,iterations:C,quatNormalizeFast:d,quatNormalizeSkip:h,size:p,solver:f,tolerance:G}))),[w]=(0,i.useState)({}),[W]=(0,i.useState)({}),[S]=(0,i.useState)({}),R=(0,i.useRef)({});let x=0;const V=(0,i.useCallback)(((e,t)=>{I||(x+=t,B.step({maxSubSteps:u,stepSize:y,timeSinceLastCalled:x}),x=0)}),[I,u,y]),X=e=>{var t;let{body:n,contact:{bi:i,bj:o,...r},target:a,...s}=e;const g=null==(t=W[a])?void 0:t.collide;g&&g({body:w[n],contact:{bi:w[i],bj:w[o],...r},target:w[a],...s})},H=e=>{var t,n;let{bodyA:i,bodyB:o}=e;const r=null==(t=W[i])?void 0:t.collideBegin;r&&r({body:w[o],op:"event",target:w[i],type:"collideBegin"});const a=null==(n=W[o])?void 0:n.collideBegin;a&&a({body:w[i],op:"event",target:w[o],type:"collideBegin"})},Y=e=>{var t,n;let{bodyA:i,bodyB:o}=e;const r=null==(t=W[i])?void 0:t.collideEnd;r&&r({body:w[o],op:"event",target:w[i],type:"collideEnd"});const a=null==(n=W[o])?void 0:n.collideEnd;a&&a({body:w[i],op:"event",target:w[o],type:"collideEnd"})},K=e=>{let{active:t,bodies:n=[],observations:i,positions:o,quaternions:a}=e;for(let r=0;r<n.length;r++)R.current[n[r]]=r;if(i.forEach((e=>{let[t,n,i]=e;const o=(S[t]||{})[i];o&&o(n)})),t){for(const e of Object.values(w))if(e instanceof r.InstancedMesh)for(let t=0;t<e.count;t++){const n=R.current[`${e.uuid}/${t}`];void 0!==n&&e.setMatrixAt(t,Z(n,o,a)),e.instanceMatrix.needsUpdate=!0}else Z(R.current[e.uuid],o,a,e);A&&v()}},N=e=>{var t;let{body:n,ray:{uuid:i,...o},...r}=e;const a=null==(t=W[i])?void 0:t.rayhit;a&&a({body:n?w[n]:null,ray:{uuid:i,...o},...r})};(0,o.j$)(V),(0,i.useLayoutEffect)((()=>(B.init(),B.on("collide",X),B.on("collideBegin",H),B.on("collideEnd",Y),B.on("frame",K),B.on("rayhit",N),()=>{B.terminate(),B.removeAllListeners()})),[]),function(e){let{axisIndex:t,broadphase:n,gravity:o,iterations:r,tolerance:a,worker:s}=e;(0,i.useEffect)((()=>{s.axisIndex=t}),[t]),(0,i.useEffect)((()=>{s.broadphase=n}),[n]),(0,i.useEffect)((()=>{s.gravity=o}),[o]),(0,i.useEffect)((()=>{s.iterations=r}),[r]),(0,i.useEffect)((()=>{s.tolerance=a}),[a])}({axisIndex:n,broadphase:a,gravity:c,iterations:C,tolerance:G,worker:B});const M=(0,i.useMemo)((()=>({bodies:R,events:W,refs:w,subscriptions:S,worker:B})),[R,W,w,S,B]);return(0,g.jsx)(b.Provider,{value:M,children:s})};class W{constructor(e){void 0===e&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=void 0,this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){void 0===e&&(e=new R);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){void 0===t&&(t=new R);const n=this.elements,i=e.x,o=e.y,r=e.z;return t.x=n[0]*i+n[1]*o+n[2]*r,t.y=n[3]*i+n[4]*o+n[5]*r,t.z=n[6]*i+n[7]*o+n[8]*r,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){void 0===t&&(t=new W);const n=this.elements,i=e.elements,o=t.elements,r=n[0],a=n[1],s=n[2],g=n[3],l=n[4],c=n[5],I=n[6],C=n[7],u=n[8],d=i[0],h=i[1],A=i[2],p=i[3],m=i[4],b=i[5],f=i[6],y=i[7],G=i[8];return o[0]=r*d+a*p+s*f,o[1]=r*h+a*m+s*y,o[2]=r*A+a*b+s*G,o[3]=g*d+l*p+c*f,o[4]=g*h+l*m+c*y,o[5]=g*A+l*b+c*G,o[6]=I*d+C*p+u*f,o[7]=I*h+C*m+u*y,o[8]=I*A+C*b+u*G,t}scale(e,t){void 0===t&&(t=new W);const n=this.elements,i=t.elements;for(let o=0;3!==o;o++)i[3*o+0]=e.x*n[3*o+0],i[3*o+1]=e.y*n[3*o+1],i[3*o+2]=e.z*n[3*o+2];return t}solve(e,t){void 0===t&&(t=new R);const n=[];let i,o;for(i=0;i<12;i++)n.push(0);for(i=0;i<3;i++)for(o=0;o<3;o++)n[i+4*o]=this.elements[i+3*o];n[3]=e.x,n[7]=e.y,n[11]=e.z;let r=3;const a=r;let s;let g;do{if(i=a-r,0===n[i+4*i])for(o=i+1;o<a;o++)if(0!==n[i+4*o]){s=4;do{g=4-s,n[g+4*i]+=n[g+4*o]}while(--s);break}if(0!==n[i+4*i])for(o=i+1;o<a;o++){const e=n[i+4*o]/n[i+4*i];s=4;do{g=4-s,n[g+4*o]=g<=i?0:n[g+4*o]-n[g+4*i]*e}while(--s)}}while(--r);if(t.z=n[11]/n[10],t.y=(n[7]-n[6]*t.z)/n[5],t.x=(n[3]-n[2]*t.z-n[1]*t.y)/n[0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw"Could not solve equation! Got x=["+t.toString()+"], b=["+e.toString()+"], A=["+this.toString()+"]";return t}e(e,t,n){if(void 0===n)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";for(let t=0;t<9;t++)e+=this.elements[t]+",";return e}reverse(e){void 0===e&&(e=new W);const t=S;let n,i;for(n=0;n<3;n++)for(i=0;i<3;i++)t[n+6*i]=this.elements[n+3*i];t[3]=1,t[9]=0,t[15]=0,t[4]=0,t[10]=1,t[16]=0,t[5]=0,t[11]=0,t[17]=1;let o=3;const r=o;let a;let s;do{if(n=r-o,0===t[n+6*n])for(i=n+1;i<r;i++)if(0!==t[n+6*i]){a=6;do{s=6-a,t[s+6*n]+=t[s+6*i]}while(--a);break}if(0!==t[n+6*n])for(i=n+1;i<r;i++){const e=t[n+6*i]/t[n+6*n];a=6;do{s=6-a,t[s+6*i]=s<=n?0:t[s+6*i]-t[s+6*n]*e}while(--a)}}while(--o);n=2;do{i=n-1;do{const e=t[n+6*i]/t[n+6*n];a=6;do{s=6-a,t[s+6*i]=t[s+6*i]-t[s+6*n]*e}while(--a)}while(i--)}while(--n);n=2;do{const e=1/t[n+6*n];a=6;do{s=6-a,t[s+6*n]=t[s+6*n]*e}while(--a)}while(n--);n=2;do{i=2;do{if(s=t[3+i+6*n],isNaN(s)||s===1/0)throw"Could not reverse! A=["+this.toString()+"]";e.e(n,i,s)}while(i--)}while(n--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,i=e.z,o=e.w,r=t+t,a=n+n,s=i+i,g=t*r,l=t*a,c=t*s,I=n*a,C=n*s,u=i*s,d=o*r,h=o*a,A=o*s,p=this.elements;return p[0]=1-(I+u),p[1]=l-A,p[2]=c+h,p[3]=l+A,p[4]=1-(g+u),p[5]=C-d,p[6]=c-h,p[7]=C+d,p[8]=1-(g+I),this}transpose(e){void 0===e&&(e=new W);const t=this.elements,n=e.elements;let i;return n[0]=t[0],n[4]=t[4],n[8]=t[8],i=t[1],n[1]=t[3],n[3]=i,i=t[2],n[2]=t[6],n[6]=i,i=t[5],n[5]=t[7],n[7]=i,e}}const S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class R{constructor(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),this.x=void 0,this.y=void 0,this.z=void 0,this.x=e,this.y=t,this.z=n}cross(e,t){void 0===t&&(t=new R);const n=e.x,i=e.y,o=e.z,r=this.x,a=this.y,s=this.z;return t.x=a*o-s*i,t.y=s*n-r*o,t.z=r*i-a*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(!t)return new R(this.x+e.x,this.y+e.y,this.z+e.z);t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z}vsub(e,t){if(!t)return new R(this.x-e.x,this.y-e.y,this.z-e.z);t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z}crossmat(){return new W([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,i=Math.sqrt(e*e+t*t+n*n);if(i>0){const e=1/i;this.x*=e,this.y*=e,this.z*=e}else this.x=0,this.y=0,this.z=0;return i}unit(e){void 0===e&&(e=new R);const t=this.x,n=this.y,i=this.z;let o=Math.sqrt(t*t+n*n+i*i);return o>0?(o=1/o,e.x=t*o,e.y=n*o,e.z=i*o):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,i=this.z,o=e.x,r=e.y,a=e.z;return Math.sqrt((o-t)*(o-t)+(r-n)*(r-n)+(a-i)*(a-i))}distanceSquared(e){const t=this.x,n=this.y,i=this.z,o=e.x,r=e.y,a=e.z;return(o-t)*(o-t)+(r-n)*(r-n)+(a-i)*(a-i)}scale(e,t){void 0===t&&(t=new R);const n=this.x,i=this.y,o=this.z;return t.x=e*n,t.y=e*i,t.z=e*o,t}vmul(e,t){return void 0===t&&(t=new R),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n){return void 0===n&&(n=new R),n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return 0===this.x&&0===this.y&&0===this.z}negate(e){return void 0===e&&(e=new R),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const i=x,o=1/n;i.set(this.x*o,this.y*o,this.z*o);const r=V;Math.abs(i.x)<.9?(r.set(1,0,0),i.cross(r,e)):(r.set(0,1,0),i.cross(r,e)),i.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return this.x+","+this.y+","+this.z}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const i=this.x,o=this.y,r=this.z;n.x=i+(e.x-i)*t,n.y=o+(e.y-o)*t,n.z=r+(e.z-r)*t}almostEquals(e,t){return void 0===t&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return void 0===e&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(X),X.almostEquals(e,t)}clone(){return new R(this.x,this.y,this.z)}}R.ZERO=void 0,R.UNIT_X=void 0,R.UNIT_Y=void 0,R.UNIT_Z=void 0,R.ZERO=new R(0,0,0),R.UNIT_X=new R(1,0,0),R.UNIT_Y=new R(0,1,0),R.UNIT_Z=new R(0,0,1);const x=new R,V=new R,X=new R;class H{constructor(e){void 0===e&&(e={}),this.lowerBound=void 0,this.upperBound=void 0,this.lowerBound=new R,this.upperBound=new R,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,i){const o=this.lowerBound,r=this.upperBound,a=n;o.copy(e[0]),a&&a.vmult(o,o),r.copy(o);for(let s=1;s<e.length;s++){let t=e[s];a&&(a.vmult(t,Y),t=Y),t.x>r.x&&(r.x=t.x),t.x<o.x&&(o.x=t.x),t.y>r.y&&(r.y=t.y),t.y<o.y&&(o.y=t.y),t.z>r.z&&(r.z=t.z),t.z<o.z&&(o.z=t.z)}return t&&(t.vadd(o,o),t.vadd(r,r)),i&&(o.x-=i,o.y-=i,o.z-=i,r.x+=i,r.y+=i,r.z+=i),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return(new H).copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,o=e.upperBound,r=i.x<=n.x&&n.x<=o.x||t.x<=o.x&&o.x<=n.x,a=i.y<=n.y&&n.y<=o.y||t.y<=o.y&&o.y<=n.y,s=i.z<=n.z&&n.z<=o.z||t.z<=o.z&&o.z<=n.z;return r&&a&&s}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,o=e.upperBound;return t.x<=i.x&&n.x>=o.x&&t.y<=i.y&&n.y>=o.y&&t.z<=i.z&&n.z>=o.z}getCorners(e,t,n,i,o,r,a,s){const g=this.lowerBound,l=this.upperBound;e.copy(g),t.set(l.x,g.y,g.z),n.set(l.x,l.y,g.z),i.set(g.x,l.y,l.z),o.set(l.x,g.y,l.z),r.set(g.x,l.y,g.z),a.set(g.x,g.y,l.z),s.copy(l)}toLocalFrame(e,t){const n=K,i=n[0],o=n[1],r=n[2],a=n[3],s=n[4],g=n[5],l=n[6],c=n[7];this.getCorners(i,o,r,a,s,g,l,c);for(let I=0;8!==I;I++){const t=n[I];e.pointToLocal(t,t)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=K,i=n[0],o=n[1],r=n[2],a=n[3],s=n[4],g=n[5],l=n[6],c=n[7];this.getCorners(i,o,r,a,s,g,l,c);for(let I=0;8!==I;I++){const t=n[I];e.pointToWorld(t,t)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,i=1/t.x,o=1/t.y,r=1/t.z,a=(this.lowerBound.x-n.x)*i,s=(this.upperBound.x-n.x)*i,g=(this.lowerBound.y-n.y)*o,l=(this.upperBound.y-n.y)*o,c=(this.lowerBound.z-n.z)*r,I=(this.upperBound.z-n.z)*r,C=Math.max(Math.max(Math.min(a,s),Math.min(g,l)),Math.min(c,I)),u=Math.min(Math.min(Math.max(a,s),Math.max(g,l)),Math.max(c,I));return!(u<0)&&!(C>u)}}const Y=new R,K=[new R,new R,new R,new R,new R,new R,new R,new R];class N{constructor(){this._listeners=void 0}addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;return void 0===n[e]&&(n[e]=[]),n[e].includes(t)||n[e].push(t),this}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return!(void 0===n[e]||!n[e].includes(t))}hasAnyEventListener(e){if(void 0===this._listeners)return!1;return void 0!==this._listeners[e]}removeEventListener(e,t){if(void 0===this._listeners)return this;const n=this._listeners;if(void 0===n[e])return this;const i=n[e].indexOf(t);return-1!==i&&n[e].splice(i,1),this}dispatchEvent(e){if(void 0===this._listeners)return this;const t=this._listeners[e.type];if(void 0!==t){e.target=this;for(let n=0,i=t.length;n<i;n++)t[n].call(this,e)}return this}}class M{constructor(e,t,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===i&&(i=1),this.x=void 0,this.y=void 0,this.z=void 0,this.w=void 0,this.x=e,this.y=t,this.z=n,this.w=i}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}toString(){return this.x+","+this.y+","+this.z+","+this.w}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(.5*t);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(.5*t),this}toAxisAngle(e){void 0===e&&(e=new R),this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const t=F,n=k;e.tangents(t,n),this.setFromAxisAngle(t,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){void 0===t&&(t=new M);const n=this.x,i=this.y,o=this.z,r=this.w,a=e.x,s=e.y,g=e.z,l=e.w;return t.x=n*l+r*a+i*g-o*s,t.y=i*l+r*s+o*a-n*g,t.z=o*l+r*g+n*s-i*a,t.w=r*l-n*a-i*s-o*g,t}inverse(e){void 0===e&&(e=new M);const t=this.x,n=this.y,i=this.z,o=this.w;this.conjugate(e);const r=1/(t*t+n*n+i*i+o*o);return e.x*=r,e.y*=r,e.z*=r,e.w*=r,e}conjugate(e){return void 0===e&&(e=new M),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){void 0===t&&(t=new R);const n=e.x,i=e.y,o=e.z,r=this.x,a=this.y,s=this.z,g=this.w,l=g*n+a*o-s*i,c=g*i+s*n-r*o,I=g*o+r*i-a*n,C=-r*n-a*i-s*o;return t.x=l*g+C*-r+c*-s-I*-a,t.y=c*g+C*-a+I*-r-l*-s,t.z=I*g+C*-s+l*-a-c*-r,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){let n,i,o;void 0===t&&(t="YZX");const r=this.x,a=this.y,s=this.z,g=this.w;if("YZX"!==t)throw new Error("Euler order "+t+" not supported yet.");{const e=r*a+s*g;if(e>.499&&(n=2*Math.atan2(r,g),i=Math.PI/2,o=0),e<-.499&&(n=-2*Math.atan2(r,g),i=-Math.PI/2,o=0),void 0===n){const t=r*r,l=a*a,c=s*s;n=Math.atan2(2*a*g-2*r*s,1-2*l-2*c),i=Math.asin(2*e),o=Math.atan2(2*r*g-2*a*s,1-2*t-2*c)}}e.y=n,e.z=i,e.x=o}setFromEuler(e,t,n,i){void 0===i&&(i="XYZ");const o=Math.cos(e/2),r=Math.cos(t/2),a=Math.cos(n/2),s=Math.sin(e/2),g=Math.sin(t/2),l=Math.sin(n/2);return"XYZ"===i?(this.x=s*r*a+o*g*l,this.y=o*g*a-s*r*l,this.z=o*r*l+s*g*a,this.w=o*r*a-s*g*l):"YXZ"===i?(this.x=s*r*a+o*g*l,this.y=o*g*a-s*r*l,this.z=o*r*l-s*g*a,this.w=o*r*a+s*g*l):"ZXY"===i?(this.x=s*r*a-o*g*l,this.y=o*g*a+s*r*l,this.z=o*r*l+s*g*a,this.w=o*r*a-s*g*l):"ZYX"===i?(this.x=s*r*a-o*g*l,this.y=o*g*a+s*r*l,this.z=o*r*l-s*g*a,this.w=o*r*a+s*g*l):"YZX"===i?(this.x=s*r*a+o*g*l,this.y=o*g*a+s*r*l,this.z=o*r*l-s*g*a,this.w=o*r*a-s*g*l):"XZY"===i&&(this.x=s*r*a-o*g*l,this.y=o*g*a-s*r*l,this.z=o*r*l+s*g*a,this.w=o*r*a+s*g*l),this}clone(){return new M(this.x,this.y,this.z,this.w)}slerp(e,t,n){void 0===n&&(n=new M);const i=this.x,o=this.y,r=this.z,a=this.w;let s,g,l,c,I,C=e.x,u=e.y,d=e.z,h=e.w;return g=i*C+o*u+r*d+a*h,g<0&&(g=-g,C=-C,u=-u,d=-d,h=-h),1-g>1e-6?(s=Math.acos(g),l=Math.sin(s),c=Math.sin((1-t)*s)/l,I=Math.sin(t*s)/l):(c=1-t,I=t),n.x=c*i+I*C,n.y=c*o+I*u,n.z=c*r+I*d,n.w=c*a+I*h,n}integrate(e,t,n,i){void 0===i&&(i=new M);const o=e.x*n.x,r=e.y*n.y,a=e.z*n.z,s=this.x,g=this.y,l=this.z,c=this.w,I=.5*t;return i.x+=I*(o*c+r*l-a*g),i.y+=I*(r*c+a*s-o*l),i.z+=I*(a*c+o*g-r*s),i.w+=I*(-o*s-r*g-a*l),i}}const F=new R,k=new R;class z{constructor(e){void 0===e&&(e={}),this.id=void 0,this.type=void 0,this.boundingSphereRadius=void 0,this.collisionResponse=void 0,this.collisionFilterGroup=void 0,this.collisionFilterMask=void 0,this.material=void 0,this.body=void 0,this.id=z.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=!e.collisionResponse||e.collisionResponse,this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:1,this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type}volume(){throw"volume() not implemented for shape type "+this.type}calculateLocalInertia(e,t){throw"calculateLocalInertia() not implemented for shape type "+this.type}calculateWorldAABB(e,t,n,i){throw"calculateWorldAABB() not implemented for shape type "+this.type}}z.idCounter=0,z.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class L{constructor(e){void 0===e&&(e={}),this.position=void 0,this.quaternion=void 0,this.position=new R,this.quaternion=new M,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return L.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return L.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return void 0===t&&(t=new R),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,i){return void 0===i&&(i=new R),n.vsub(e,i),t.conjugate(T),T.vmult(i,i),i}static pointToWorldFrame(e,t,n,i){return void 0===i&&(i=new R),t.vmult(n,i),i.vadd(e,i),i}static vectorToWorldFrame(e,t,n){return void 0===n&&(n=new R),e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,i){return void 0===i&&(i=new R),t.w*=-1,t.vmult(n,i),t.w*=-1,i}}const T=new M;class E extends z{constructor(e){void 0===e&&(e={});const{vertices:t=[],faces:n=[],normals:i=[],axes:o,boundingSphereRadius:r}=e;super({type:z.types.CONVEXPOLYHEDRON}),this.vertices=void 0,this.faces=void 0,this.faceNormals=void 0,this.worldVertices=void 0,this.worldVerticesNeedsUpdate=void 0,this.worldFaceNormals=void 0,this.worldFaceNormalsNeedsUpdate=void 0,this.uniqueAxes=void 0,this.uniqueEdges=void 0,this.vertices=t,this.faces=n,this.faceNormals=i,0===this.faceNormals.length&&this.computeNormals(),r?this.boundingSphereRadius=r:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=o?o.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const e=this.faces,t=this.vertices,n=this.uniqueEdges;n.length=0;const i=new R;for(let o=0;o!==e.length;o++){const r=e[o],a=r.length;for(let e=0;e!==a;e++){const o=(e+1)%a;t[r[e]].vsub(t[r[o]],i),i.normalize();let s=!1;for(let e=0;e!==n.length;e++)if(n[e].almostEquals(i)||n[e].almostEquals(i)){s=!0;break}s||n.push(i.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let e=0;e<this.faces.length;e++){for(let i=0;i<this.faces[e].length;i++)if(!this.vertices[this.faces[e][i]])throw new Error("Vertex "+this.faces[e][i]+" not found!");const t=this.faceNormals[e]||new R;this.getFaceNormal(e,t),t.negate(t),this.faceNormals[e]=t;const n=this.vertices[this.faces[e][0]];if(t.dot(n)<0){console.error(".faceNormals["+e+"] = Vec3("+t.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(let t=0;t<this.faces[e].length;t++)console.warn(".vertices["+this.faces[e][t]+"] = Vec3("+this.vertices[this.faces[e][t]].toString()+")")}}}getFaceNormal(e,t){const n=this.faces[e],i=this.vertices[n[0]],o=this.vertices[n[1]],r=this.vertices[n[2]];E.computeNormal(i,o,r,t)}static computeNormal(e,t,n,i){const o=new R,r=new R;t.vsub(e,r),n.vsub(t,o),o.cross(r,i),i.isZero()||i.normalize()}clipAgainstHull(e,t,n,i,o,r,a,s,g){const l=new R;let c=-1,I=-Number.MAX_VALUE;for(let u=0;u<n.faces.length;u++){l.copy(n.faceNormals[u]),o.vmult(l,l);const e=l.dot(r);e>I&&(I=e,c=u)}const C=[];for(let u=0;u<n.faces[c].length;u++){const e=n.vertices[n.faces[c][u]],t=new R;t.copy(e),o.vmult(t,t),i.vadd(t,t),C.push(t)}c>=0&&this.clipFaceAgainstHull(r,e,t,C,a,s,g)}findSeparatingAxis(e,t,n,i,o,r,a,s){const g=new R,l=new R,c=new R,I=new R,C=new R,u=new R;let d=Number.MAX_VALUE;const h=this;if(h.uniqueAxes)for(let A=0;A!==h.uniqueAxes.length;A++){n.vmult(h.uniqueAxes[A],g);const a=h.testSepAxis(g,e,t,n,i,o);if(!1===a)return!1;a<d&&(d=a,r.copy(g))}else{const s=a?a.length:h.faces.length;for(let l=0;l<s;l++){const s=a?a[l]:l;g.copy(h.faceNormals[s]),n.vmult(g,g);const c=h.testSepAxis(g,e,t,n,i,o);if(!1===c)return!1;c<d&&(d=c,r.copy(g))}}if(e.uniqueAxes)for(let A=0;A!==e.uniqueAxes.length;A++){o.vmult(e.uniqueAxes[A],l);const a=h.testSepAxis(l,e,t,n,i,o);if(!1===a)return!1;a<d&&(d=a,r.copy(l))}else{const a=s?s.length:e.faces.length;for(let g=0;g<a;g++){const a=s?s[g]:g;l.copy(e.faceNormals[a]),o.vmult(l,l);const c=h.testSepAxis(l,e,t,n,i,o);if(!1===c)return!1;c<d&&(d=c,r.copy(l))}}for(let A=0;A!==h.uniqueEdges.length;A++){n.vmult(h.uniqueEdges[A],I);for(let a=0;a!==e.uniqueEdges.length;a++)if(o.vmult(e.uniqueEdges[a],C),I.cross(C,u),!u.almostZero()){u.normalize();const a=h.testSepAxis(u,e,t,n,i,o);if(!1===a)return!1;a<d&&(d=a,r.copy(u))}}return i.vsub(t,c),c.dot(r)>0&&r.negate(r),!0}testSepAxis(e,t,n,i,o,r){E.project(this,e,n,i,J),E.project(t,e,o,r,U);const a=J[0],s=J[1],g=U[0],l=U[1];if(a<l||g<s)return!1;const c=a-l,I=g-s;return c<I?c:I}calculateLocalInertia(e,t){const n=new R,i=new R;this.computeLocalAABB(i,n);const o=n.x-i.x,r=n.y-i.y,a=n.z-i.z;t.x=1/12*e*(2*r*2*r+2*a*2*a),t.y=1/12*e*(2*o*2*o+2*a*2*a),t.z=1/12*e*(2*r*2*r+2*o*2*o)}getPlaneConstantOfFace(e){const t=this.faces[e],n=this.faceNormals[e],i=this.vertices[t[0]];return-n.dot(i)}clipFaceAgainstHull(e,t,n,i,o,r,a){const s=new R,g=new R,l=new R,c=new R,I=new R,C=new R,u=new R,d=new R,h=this,A=i,p=[];let m=-1,b=Number.MAX_VALUE;for(let B=0;B<h.faces.length;B++){s.copy(h.faceNormals[B]),n.vmult(s,s);const t=s.dot(e);t<b&&(b=t,m=B)}if(m<0)return;const f=h.faces[m];f.connectedFaces=[];for(let B=0;B<h.faces.length;B++)for(let e=0;e<h.faces[B].length;e++)-1!==f.indexOf(h.faces[B][e])&&B!==m&&-1===f.connectedFaces.indexOf(B)&&f.connectedFaces.push(B);const y=f.length;for(let B=0;B<y;B++){const e=h.vertices[f[B]],i=h.vertices[f[(B+1)%y]];e.vsub(i,g),l.copy(g),n.vmult(l,l),t.vadd(l,l),c.copy(this.faceNormals[m]),n.vmult(c,c),t.vadd(c,c),l.cross(c,I),I.negate(I),C.copy(e),n.vmult(C,C),t.vadd(C,C);const o=f.connectedFaces[B];u.copy(this.faceNormals[o]);const r=this.getPlaneConstantOfFace(o);d.copy(u),n.vmult(d,d);const a=r-d.dot(t);for(this.clipFaceAgainstPlane(A,p,d,a);A.length;)A.shift();for(;p.length;)A.push(p.shift())}u.copy(this.faceNormals[m]);const G=this.getPlaneConstantOfFace(m);d.copy(u),n.vmult(d,d);const v=G-d.dot(t);for(let B=0;B<A.length;B++){let e=d.dot(A[B])+v;if(e<=o&&(console.log("clamped: depth="+e+" to minDist="+o),e=o),e<=r){const t=A[B];if(e<=1e-6){const n={point:t,normal:d,depth:e};a.push(n)}}}}clipFaceAgainstPlane(e,t,n,i){let o,r;const a=e.length;if(a<2)return t;let s=e[e.length-1],g=e[0];o=n.dot(s)+i;for(let l=0;l<a;l++){if(g=e[l],r=n.dot(g)+i,o<0)if(r<0){const e=new R;e.copy(g),t.push(e)}else{const e=new R;s.lerp(g,o/(o-r),e),t.push(e)}else if(r<0){const e=new R;s.lerp(g,o/(o-r),e),t.push(e),t.push(g)}s=g,o=r}return t}computeWorldVertices(e,t){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new R);const n=this.vertices,i=this.worldVertices;for(let o=0;o!==this.vertices.length;o++)t.vmult(n[o],i[o]),e.vadd(i[o],i[o]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(e,t){const n=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let i=0;i<this.vertices.length;i++){const o=n[i];o.x<e.x?e.x=o.x:o.x>t.x&&(t.x=o.x),o.y<e.y?e.y=o.y:o.y>t.y&&(t.y=o.y),o.z<e.z?e.z=o.z:o.z>t.z&&(t.z=o.z)}}computeWorldFaceNormals(e){const t=this.faceNormals.length;for(;this.worldFaceNormals.length<t;)this.worldFaceNormals.push(new R);const n=this.faceNormals,i=this.worldFaceNormals;for(let o=0;o!==t;o++)e.vmult(n[o],i[o]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let e=0;const t=this.vertices;for(let n=0;n!==t.length;n++){const i=t[n].lengthSquared();i>e&&(e=i)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,t,n,i){const o=this.vertices;let r,a,s,g,l,c,I=new R;for(let C=0;C<o.length;C++){I.copy(o[C]),t.vmult(I,I),e.vadd(I,I);const n=I;(void 0===r||n.x<r)&&(r=n.x),(void 0===g||n.x>g)&&(g=n.x),(void 0===a||n.y<a)&&(a=n.y),(void 0===l||n.y>l)&&(l=n.y),(void 0===s||n.z<s)&&(s=n.z),(void 0===c||n.z>c)&&(c=n.z)}n.set(r,a,s),i.set(g,l,c)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(e){void 0===e&&(e=new R);const t=this.vertices;for(let n=0;n<t.length;n++)e.vadd(t[n],e);return e.scale(1/t.length,e),e}transformAllPoints(e,t){const n=this.vertices.length,i=this.vertices;if(t){for(let e=0;e<n;e++){const n=i[e];t.vmult(n,n)}for(let e=0;e<this.faceNormals.length;e++){const n=this.faceNormals[e];t.vmult(n,n)}}if(e)for(let o=0;o<n;o++){const t=i[o];t.vadd(e,t)}}pointIsInside(e){const t=this.vertices,n=this.faces,i=this.faceNormals,o=new R;this.getAveragePointLocal(o);for(let r=0;r<this.faces.length;r++){let a=i[r];const s=t[n[r][0]],g=new R;e.vsub(s,g);const l=a.dot(g),c=new R;o.vsub(s,c);const I=a.dot(c);if(l<0&&I>0||l>0&&I<0)return!1}return-1}static project(e,t,n,i,o){const r=e.vertices.length,a=D;let s=0,g=0;const l=P,c=e.vertices;l.setZero(),L.vectorToLocalFrame(n,i,t,a),L.pointToLocalFrame(n,i,l,l);const I=l.dot(a);g=s=c[0].dot(a);for(let C=1;C<r;C++){const e=c[C].dot(a);e>s&&(s=e),e<g&&(g=e)}if(g-=I,s-=I,g>s){const e=g;g=s,s=e}o[0]=s,o[1]=g}}const J=[],U=[],D=new R,P=new R;class Q extends z{constructor(e){super({type:z.types.BOX}),this.halfExtents=void 0,this.convexPolyhedronRepresentation=void 0,this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const e=this.halfExtents.x,t=this.halfExtents.y,n=this.halfExtents.z,i=R,o=[new i(-e,-t,-n),new i(e,-t,-n),new i(e,t,-n),new i(-e,t,-n),new i(-e,-t,n),new i(e,-t,n),new i(e,t,n),new i(-e,t,n)],r=[new i(0,0,1),new i(0,1,0),new i(1,0,0)],a=new E({vertices:o,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:r});this.convexPolyhedronRepresentation=a,a.material=this.material}calculateLocalInertia(e,t){return void 0===t&&(t=new R),Q.calculateInertia(this.halfExtents,e,t),t}static calculateInertia(e,t,n){const i=e;n.x=1/12*t*(2*i.y*2*i.y+2*i.z*2*i.z),n.y=1/12*t*(2*i.x*2*i.x+2*i.z*2*i.z),n.z=1/12*t*(2*i.y*2*i.y+2*i.x*2*i.x)}getSideNormals(e,t){const n=e,i=this.halfExtents;if(n[0].set(i.x,0,0),n[1].set(0,i.y,0),n[2].set(0,0,i.z),n[3].set(-i.x,0,0),n[4].set(0,-i.y,0),n[5].set(0,0,-i.z),void 0!==t)for(let o=0;o!==n.length;o++)t.vmult(n[o],n[o]);return n}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(e,t,n){const i=this.halfExtents,o=[[i.x,i.y,i.z],[-i.x,i.y,i.z],[-i.x,-i.y,i.z],[-i.x,-i.y,-i.z],[i.x,-i.y,-i.z],[i.x,i.y,-i.z],[-i.x,i.y,-i.z],[i.x,-i.y,i.z]];for(let r=0;r<o.length;r++)_.set(o[r][0],o[r][1],o[r][2]),t.vmult(_,_),e.vadd(_,_),n(_.x,_.y,_.z)}calculateWorldAABB(e,t,n,i){const o=this.halfExtents;j[0].set(o.x,o.y,o.z),j[1].set(-o.x,o.y,o.z),j[2].set(-o.x,-o.y,o.z),j[3].set(-o.x,-o.y,-o.z),j[4].set(o.x,-o.y,-o.z),j[5].set(o.x,o.y,-o.z),j[6].set(-o.x,o.y,-o.z),j[7].set(o.x,-o.y,o.z);const r=j[0];t.vmult(r,r),e.vadd(r,r),i.copy(r),n.copy(r);for(let a=1;a<8;a++){const o=j[a];t.vmult(o,o),e.vadd(o,o);const r=o.x,s=o.y,g=o.z;r>i.x&&(i.x=r),s>i.y&&(i.y=s),g>i.z&&(i.z=g),r<n.x&&(n.x=r),s<n.y&&(n.y=s),g<n.z&&(n.z=g)}}}const _=new R,j=[new R,new R,new R,new R,new R,new R,new R,new R],O=1,q=2,$=4,ee=0,te=1,ne=2;class ie extends N{constructor(e){void 0===e&&(e={}),super(),this.id=void 0,this.index=void 0,this.world=void 0,this.preStep=void 0,this.postStep=void 0,this.vlambda=void 0,this.collisionFilterGroup=void 0,this.collisionFilterMask=void 0,this.collisionResponse=void 0,this.position=void 0,this.previousPosition=void 0,this.interpolatedPosition=void 0,this.initPosition=void 0,this.velocity=void 0,this.initVelocity=void 0,this.force=void 0,this.mass=void 0,this.invMass=void 0,this.material=void 0,this.linearDamping=void 0,this.type=void 0,this.allowSleep=void 0,this.sleepState=void 0,this.sleepSpeedLimit=void 0,this.sleepTimeLimit=void 0,this.timeLastSleepy=void 0,this.wakeUpAfterNarrowphase=void 0,this.torque=void 0,this.quaternion=void 0,this.initQuaternion=void 0,this.previousQuaternion=void 0,this.interpolatedQuaternion=void 0,this.angularVelocity=void 0,this.initAngularVelocity=void 0,this.shapes=void 0,this.shapeOffsets=void 0,this.shapeOrientations=void 0,this.inertia=void 0,this.invInertia=void 0,this.invInertiaWorld=void 0,this.invMassSolve=void 0,this.invInertiaSolve=void 0,this.invInertiaWorldSolve=void 0,this.fixedRotation=void 0,this.angularDamping=void 0,this.linearFactor=void 0,this.angularFactor=void 0,this.aabb=void 0,this.aabbNeedsUpdate=void 0,this.boundingRadius=void 0,this.wlambda=void 0,this.isTrigger=void 0,this.id=ie.idCounter++,this.index=-1,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new R,this.collisionFilterGroup="number"===typeof e.collisionFilterGroup?e.collisionFilterGroup:1,this.collisionFilterMask="number"===typeof e.collisionFilterMask?e.collisionFilterMask:-1,this.collisionResponse="boolean"!==typeof e.collisionResponse||e.collisionResponse,this.position=new R,this.previousPosition=new R,this.interpolatedPosition=new R,this.initPosition=new R,e.position&&(this.position.copy(e.position),this.previousPosition.copy(e.position),this.interpolatedPosition.copy(e.position),this.initPosition.copy(e.position)),this.velocity=new R,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new R,this.force=new R;const t="number"===typeof e.mass?e.mass:0;this.mass=t,this.invMass=t>0?1/t:0,this.material=e.material||null,this.linearDamping="number"===typeof e.linearDamping?e.linearDamping:.01,this.type=t<=0?ie.STATIC:ie.DYNAMIC,typeof e.type===typeof ie.STATIC&&(this.type=e.type),this.allowSleep="undefined"===typeof e.allowSleep||e.allowSleep,this.sleepState=ie.AWAKE,this.sleepSpeedLimit="undefined"!==typeof e.sleepSpeedLimit?e.sleepSpeedLimit:.1,this.sleepTimeLimit="undefined"!==typeof e.sleepTimeLimit?e.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new R,this.quaternion=new M,this.initQuaternion=new M,this.previousQuaternion=new M,this.interpolatedQuaternion=new M,e.quaternion&&(this.quaternion.copy(e.quaternion),this.initQuaternion.copy(e.quaternion),this.previousQuaternion.copy(e.quaternion),this.interpolatedQuaternion.copy(e.quaternion)),this.angularVelocity=new R,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new R,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new R,this.invInertia=new R,this.invInertiaWorld=new W,this.invMassSolve=0,this.invInertiaSolve=new R,this.invInertiaWorldSolve=new W,this.fixedRotation="undefined"!==typeof e.fixedRotation&&e.fixedRotation,this.angularDamping="undefined"!==typeof e.angularDamping?e.angularDamping:.01,this.linearFactor=new R(1,1,1),e.linearFactor&&this.linearFactor.copy(e.linearFactor),this.angularFactor=new R(1,1,1),e.angularFactor&&this.angularFactor.copy(e.angularFactor),this.aabb=new H,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new R,this.isTrigger=Boolean(e.isTrigger),e.shape&&this.addShape(e.shape),this.updateMassProperties()}wakeUp(){const e=this.sleepState;this.sleepState=ie.AWAKE,this.wakeUpAfterNarrowphase=!1,e===ie.SLEEPING&&this.dispatchEvent(ie.wakeupEvent)}sleep(){this.sleepState=ie.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(e){if(this.allowSleep){const t=this.sleepState,n=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),i=this.sleepSpeedLimit**2;t===ie.AWAKE&&n<i?(this.sleepState=ie.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(ie.sleepyEvent)):t===ie.SLEEPY&&n>i?this.wakeUp():t===ie.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(ie.sleepEvent))}}updateSolveMassProperties(){this.sleepState===ie.SLEEPING||this.type===ie.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(e,t){return void 0===t&&(t=new R),e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}vectorToLocalFrame(e,t){return void 0===t&&(t=new R),this.quaternion.conjugate().vmult(e,t),t}pointToWorldFrame(e,t){return void 0===t&&(t=new R),this.quaternion.vmult(e,t),t.vadd(this.position,t),t}vectorToWorldFrame(e,t){return void 0===t&&(t=new R),this.quaternion.vmult(e,t),t}addShape(e,t,n){const i=new R,o=new M;return t&&i.copy(t),n&&o.copy(n),this.shapes.push(e),this.shapeOffsets.push(i),this.shapeOrientations.push(o),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}removeShape(e){const t=this.shapes.indexOf(e);return-1===t?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeOrientations.splice(t,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null,this)}updateBoundingRadius(){const e=this.shapes,t=this.shapeOffsets,n=e.length;let i=0;for(let o=0;o!==n;o++){const n=e[o];n.updateBoundingSphereRadius();const r=t[o].length(),a=n.boundingSphereRadius;r+a>i&&(i=r+a)}this.boundingRadius=i}updateAABB(){const e=this.shapes,t=this.shapeOffsets,n=this.shapeOrientations,i=e.length,o=oe,r=re,a=this.quaternion,s=this.aabb,g=ae;for(let l=0;l!==i;l++){const i=e[l];a.vmult(t[l],o),o.vadd(this.position,o),a.mult(n[l],r),i.calculateWorldAABB(o,r,g.lowerBound,g.upperBound),0===l?s.copy(g):s.extend(g)}this.aabbNeedsUpdate=!1}updateInertiaWorld(e){const t=this.invInertia;if(t.x!==t.y||t.y!==t.z||e){const e=se,n=ge;e.setRotationFromQuaternion(this.quaternion),e.transpose(n),e.scale(t,e),e.mmult(n,this.invInertiaWorld)}else;}applyForce(e,t){if(void 0===t&&(t=new R),this.type!==ie.DYNAMIC)return;this.sleepState===ie.SLEEPING&&this.wakeUp();const n=le;t.cross(e,n),this.force.vadd(e,this.force),this.torque.vadd(n,this.torque)}applyLocalForce(e,t){if(void 0===t&&(t=new R),this.type!==ie.DYNAMIC)return;const n=ce,i=Ie;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,i),this.applyForce(n,i)}applyTorque(e){this.type===ie.DYNAMIC&&(this.sleepState===ie.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}applyImpulse(e,t){if(void 0===t&&(t=new R),this.type!==ie.DYNAMIC)return;this.sleepState===ie.SLEEPING&&this.wakeUp();const n=t,i=Ce;i.copy(e),i.scale(this.invMass,i),this.velocity.vadd(i,this.velocity);const o=ue;n.cross(e,o),this.invInertiaWorld.vmult(o,o),this.angularVelocity.vadd(o,this.angularVelocity)}applyLocalImpulse(e,t){if(void 0===t&&(t=new R),this.type!==ie.DYNAMIC)return;const n=de,i=he;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,i),this.applyImpulse(n,i)}updateMassProperties(){const e=Ae;this.invMass=this.mass>0?1/this.mass:0;const t=this.inertia,n=this.fixedRotation;this.updateAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),Q.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!n?1/t.x:0,t.y>0&&!n?1/t.y:0,t.z>0&&!n?1/t.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(e,t){const n=new R;return e.vsub(this.position,n),this.angularVelocity.cross(n,t),this.velocity.vadd(t,t),t}integrate(e,t,n){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),this.type!==ie.DYNAMIC&&this.type!==ie.KINEMATIC||this.sleepState===ie.SLEEPING)return;const i=this.velocity,o=this.angularVelocity,r=this.position,a=this.force,s=this.torque,g=this.quaternion,l=this.invMass,c=this.invInertiaWorld,I=this.linearFactor,C=l*e;i.x+=a.x*C*I.x,i.y+=a.y*C*I.y,i.z+=a.z*C*I.z;const u=c.elements,d=this.angularFactor,h=s.x*d.x,A=s.y*d.y,p=s.z*d.z;o.x+=e*(u[0]*h+u[1]*A+u[2]*p),o.y+=e*(u[3]*h+u[4]*A+u[5]*p),o.z+=e*(u[6]*h+u[7]*A+u[8]*p),r.x+=i.x*e,r.y+=i.y*e,r.z+=i.z*e,g.integrate(this.angularVelocity,e,this.angularFactor,g),t&&(n?g.normalizeFast():g.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}ie.idCounter=0,ie.COLLIDE_EVENT_NAME="collide",ie.DYNAMIC=O,ie.STATIC=q,ie.KINEMATIC=$,ie.AWAKE=ee,ie.SLEEPY=te,ie.SLEEPING=ne,ie.wakeupEvent={type:"wakeup"},ie.sleepyEvent={type:"sleepy"},ie.sleepEvent={type:"sleep"};const oe=new R,re=new M,ae=new H,se=new W,ge=new W,le=new R,ce=new R,Ie=new R,Ce=new R,ue=new R,de=new R,he=new R,Ae=new R;new R,new R;class pe{constructor(){this.rayFromWorld=void 0,this.rayToWorld=void 0,this.hitNormalWorld=void 0,this.hitPointWorld=void 0,this.hasHit=void 0,this.shape=void 0,this.body=void 0,this.hitFaceIndex=void 0,this.distance=void 0,this.shouldStop=void 0,this.rayFromWorld=new R,this.rayToWorld=new R,this.hitNormalWorld=new R,this.hitPointWorld=new R,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,i,o,r,a){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(i),this.shape=o,this.body=r,this.distance=a}}let me,be,fe,ye,Ge,ve,Be;const Ze=1,we=2,We=4;me=z.types.SPHERE,be=z.types.PLANE,fe=z.types.BOX,ye=z.types.CYLINDER,Ge=z.types.CONVEXPOLYHEDRON,ve=z.types.HEIGHTFIELD,Be=z.types.TRIMESH;class Se{get[me](){return this._intersectSphere}get[be](){return this._intersectPlane}get[fe](){return this._intersectBox}get[ye](){return this._intersectConvex}get[Ge](){return this._intersectConvex}get[ve](){return this._intersectHeightfield}get[Be](){return this._intersectTrimesh}constructor(e,t){void 0===e&&(e=new R),void 0===t&&(t=new R),this.from=void 0,this.to=void 0,this.direction=void 0,this.precision=void 0,this.checkCollisionResponse=void 0,this.skipBackfaces=void 0,this.collisionFilterMask=void 0,this.collisionFilterGroup=void 0,this.mode=void 0,this.result=void 0,this.hasHit=void 0,this.callback=void 0,this.from=e.clone(),this.to=t.clone(),this.direction=new R,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Se.ANY,this.result=new pe,this.hasHit=!1,this.callback=e=>{}}intersectWorld(e,t){return this.mode=t.mode||Se.ANY,this.result=t.result||new pe,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask="undefined"!==typeof t.collisionFilterMask?t.collisionFilterMask:-1,this.collisionFilterGroup="undefined"!==typeof t.collisionFilterGroup?t.collisionFilterGroup:-1,this.checkCollisionResponse="undefined"===typeof t.checkCollisionResponse||t.checkCollisionResponse,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(Re),xe.length=0,e.broadphase.aabbQuery(e,Re,xe),this.intersectBodies(xe),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse)return;if(0===(this.collisionFilterGroup&e.collisionFilterMask)||0===(e.collisionFilterGroup&this.collisionFilterMask))return;const i=He,o=Ye;for(let r=0,a=e.shapes.length;r<a;r++){const t=e.shapes[r];if((!n||t.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[r],o),e.quaternion.vmult(e.shapeOffsets[r],i),i.vadd(e.position,i),this.intersectShape(t,o,i,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let n=0,i=e.length;!this.result.shouldStop&&n<i;n++)this.intersectBody(e[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,i){const o=function(e,t,n){n.vsub(e,tt);const i=tt.dot(t);t.scale(i,nt),nt.vadd(e,nt);const o=n.distanceTo(nt);return o}(this.from,this.direction,n);if(o>e.boundingSphereRadius)return;const r=this[e.type];r&&r.call(this,e,t,n,i,e)}_intersectBox(e,t,n,i,o){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,i,o)}_intersectPlane(e,t,n,i,o){const r=this.from,a=this.to,s=this.direction,g=new R(0,0,1);t.vmult(g,g);const l=new R;r.vsub(n,l);const c=l.dot(g);a.vsub(n,l);if(c*l.dot(g)>0)return;if(r.distanceTo(a)<c)return;const I=g.dot(s);if(Math.abs(I)<this.precision)return;const C=new R,u=new R,d=new R;r.vsub(n,C);const h=-g.dot(C)/I;s.scale(h,u),r.vadd(u,d),this.reportIntersection(g,d,o,i,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,i=this.to,o=this.from;t.x=Math.min(i.x,o.x),t.y=Math.min(i.y,o.y),t.z=Math.min(i.z,o.z),n.x=Math.max(i.x,o.x),n.y=Math.max(i.y,o.y),n.z=Math.max(i.z,o.z)}_intersectHeightfield(e,t,n,i,o){e.data,e.elementSize;const r=Le;r.from.copy(this.from),r.to.copy(this.to),L.pointToLocalFrame(n,t,r.from,r.from),L.pointToLocalFrame(n,t,r.to,r.to),r.updateDirection();const a=Te;let s,g,l,c;s=g=0,l=c=e.data.length-1;const I=new H;r.getAABB(I),e.getIndexOfPosition(I.lowerBound.x,I.lowerBound.y,a,!0),s=Math.max(s,a[0]),g=Math.max(g,a[1]),e.getIndexOfPosition(I.upperBound.x,I.upperBound.y,a,!0),l=Math.min(l,a[0]+1),c=Math.min(c,a[1]+1);for(let C=s;C<l;C++)for(let a=g;a<c;a++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(C,a,I),I.overlapsRay(r)){if(e.getConvexTrianglePillar(C,a,!1),L.pointToWorldFrame(n,t,e.pillarOffset,ze),this._intersectConvex(e.pillarConvex,t,ze,i,o,ke),this.result.shouldStop)return;e.getConvexTrianglePillar(C,a,!0),L.pointToWorldFrame(n,t,e.pillarOffset,ze),this._intersectConvex(e.pillarConvex,t,ze,i,o,ke)}}}_intersectSphere(e,t,n,i,o){const r=this.from,a=this.to,s=e.radius,g=(a.x-r.x)**2+(a.y-r.y)**2+(a.z-r.z)**2,l=2*((a.x-r.x)*(r.x-n.x)+(a.y-r.y)*(r.y-n.y)+(a.z-r.z)*(r.z-n.z)),c=l**2-4*g*((r.x-n.x)**2+(r.y-n.y)**2+(r.z-n.z)**2-s**2),I=Ee,C=Je;if(!(c<0))if(0===c)r.lerp(a,c,I),I.vsub(n,C),C.normalize(),this.reportIntersection(C,I,o,i,-1);else{const e=(-l-Math.sqrt(c))/(2*g),t=(-l+Math.sqrt(c))/(2*g);if(e>=0&&e<=1&&(r.lerp(a,e,I),I.vsub(n,C),C.normalize(),this.reportIntersection(C,I,o,i,-1)),this.result.shouldStop)return;t>=0&&t<=1&&(r.lerp(a,t,I),I.vsub(n,C),C.normalize(),this.reportIntersection(C,I,o,i,-1))}}_intersectConvex(e,t,n,i,o,r){const a=Ue,s=De,g=r&&r.faceList||null,l=e.faces,c=e.vertices,I=e.faceNormals,C=this.direction,u=this.from,d=this.to,h=u.distanceTo(d),A=g?g.length:l.length,p=this.result;for(let m=0;!p.shouldStop&&m<A;m++){const e=g?g[m]:m,r=l[e],d=I[e],A=t,b=n;s.copy(c[r[0]]),A.vmult(s,s),s.vadd(b,s),s.vsub(u,s),A.vmult(d,a);const f=C.dot(a);if(Math.abs(f)<this.precision)continue;const y=a.dot(s)/f;if(!(y<0)){C.scale(y,Ke),Ke.vadd(u,Ke),Ne.copy(c[r[0]]),A.vmult(Ne,Ne),b.vadd(Ne,Ne);for(let t=1;!p.shouldStop&&t<r.length-1;t++){Me.copy(c[r[t]]),Fe.copy(c[r[t+1]]),A.vmult(Me,Me),A.vmult(Fe,Fe),b.vadd(Me,Me),b.vadd(Fe,Fe);const n=Ke.distanceTo(u);!Se.pointInTriangle(Ke,Ne,Me,Fe)&&!Se.pointInTriangle(Ke,Me,Ne,Fe)||n>h||this.reportIntersection(a,Ke,o,i,e)}}}}_intersectTrimesh(e,t,n,i,o,r){const a=Pe,s=$e,g=et,l=De,c=Qe,I=_e,C=je,u=qe,d=Oe,h=e.indices;e.vertices;const A=this.from,p=this.to,m=this.direction;g.position.copy(n),g.quaternion.copy(t),L.vectorToLocalFrame(n,t,m,c),L.pointToLocalFrame(n,t,A,I),L.pointToLocalFrame(n,t,p,C),C.x*=e.scale.x,C.y*=e.scale.y,C.z*=e.scale.z,I.x*=e.scale.x,I.y*=e.scale.y,I.z*=e.scale.z,C.vsub(I,c),c.normalize();const b=I.distanceSquared(C);e.tree.rayQuery(this,g,s);for(let f=0,y=s.length;!this.result.shouldStop&&f!==y;f++){const r=s[f];e.getNormal(r,a),e.getVertex(h[3*r],Ne),Ne.vsub(I,l);const g=c.dot(a),C=a.dot(l)/g;if(C<0)continue;c.scale(C,Ke),Ke.vadd(I,Ke),e.getVertex(h[3*r+1],Me),e.getVertex(h[3*r+2],Fe);const A=Ke.distanceSquared(I);!Se.pointInTriangle(Ke,Me,Ne,Fe)&&!Se.pointInTriangle(Ke,Ne,Me,Fe)||A>b||(L.vectorToWorldFrame(t,a,d),L.pointToWorldFrame(n,t,Ke,u),this.reportIntersection(d,u,o,i,r))}s.length=0}reportIntersection(e,t,n,i,o){const r=this.from,a=this.to,s=r.distanceTo(t),g=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(g.hitFaceIndex="undefined"!==typeof o?o:-1,this.mode){case Se.ALL:this.hasHit=!0,g.set(r,a,e,t,n,i,s),g.hasHit=!0,this.callback(g);break;case Se.CLOSEST:(s<g.distance||!g.hasHit)&&(this.hasHit=!0,g.hasHit=!0,g.set(r,a,e,t,n,i,s));break;case Se.ANY:this.hasHit=!0,g.hasHit=!0,g.set(r,a,e,t,n,i,s),g.shouldStop=!0}}static pointInTriangle(e,t,n,i){i.vsub(t,tt),n.vsub(t,Ve),e.vsub(t,Xe);const o=tt.dot(tt),r=tt.dot(Ve),a=tt.dot(Xe),s=Ve.dot(Ve),g=Ve.dot(Xe);let l,c;return(l=s*a-r*g)>=0&&(c=o*g-r*a)>=0&&l+c<o*s-r*r}}Se.CLOSEST=Ze,Se.ANY=we,Se.ALL=We;const Re=new H,xe=[],Ve=new R,Xe=new R,He=new R,Ye=new M,Ke=new R,Ne=new R,Me=new R,Fe=new R,ke={faceList:[0]},ze=new R,Le=new Se,Te=[],Ee=new R,Je=new R,Ue=new R,De=new R,Pe=new R,Qe=new R,_e=new R,je=new R,Oe=new R,qe=new R;new H;const $e=[],et=new L,tt=new R,nt=new R;new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R;class it{constructor(e){void 0===e&&(e={}),this.name=void 0,this.id=void 0,this.friction=void 0,this.restitution=void 0;let t="";"string"===typeof e&&(t=e,e={}),this.name=t,this.id=it.idCounter++,this.friction="undefined"!==typeof e.friction?e.friction:-1,this.restitution="undefined"!==typeof e.restitution?e.restitution:-1}}it.idCounter=0,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new Se,new R,new R,new R(1,0,0),new R(0,1,0),new R(0,0,1),new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R;new R,new R,new R,new R,new R,new R,new R,new R,new R;new R;new R,new R,new R,new R,new R,new R,new R,new R,new R;new R,new H;new R,new H,new R,new R,new R,new R,new R,new R,new R,new H,new R,new L,new H;z.types.SPHERE,z.types.SPHERE,z.types.PLANE,z.types.BOX,z.types.BOX,z.types.SPHERE,z.types.BOX,z.types.PLANE,z.types.BOX,z.types.CONVEXPOLYHEDRON,z.types.SPHERE,z.types.CONVEXPOLYHEDRON,z.types.PLANE,z.types.CONVEXPOLYHEDRON,z.types.BOX,z.types.CONVEXPOLYHEDRON,z.types.SPHERE,z.types.HEIGHTFIELD,z.types.BOX,z.types.HEIGHTFIELD,z.types.CONVEXPOLYHEDRON,z.types.HEIGHTFIELD,z.types.PARTICLE,z.types.SPHERE,z.types.PLANE,z.types.PARTICLE,z.types.BOX,z.types.PARTICLE,z.types.PARTICLE,z.types.CONVEXPOLYHEDRON,z.types.CYLINDER,z.types.SPHERE,z.types.CYLINDER,z.types.PLANE,z.types.CYLINDER,z.types.BOX,z.types.CYLINDER,z.types.CONVEXPOLYHEDRON,z.types.CYLINDER,z.types.HEIGHTFIELD,z.types.CYLINDER,z.types.PARTICLE,z.types.CYLINDER,z.types.SPHERE,z.types.TRIMESH,z.types.PLANE,z.types.TRIMESH,new R,new R,new R,new R,new R,new M,new M,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new H,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new R,new M,new R,new R,new R,new R,new R,new R,new R,new R,new H,new Se;const ot=globalThis.performance||{};if(!ot.now){let e=Date.now();ot.timing&&ot.timing.navigationStart&&(e=ot.timing.navigationStart),ot.now=()=>Date.now()-e}new r.Vector3,new r.Vector3(1,1,1),new r.Quaternion;const rt=new r.Object3D;function at(e){const t=(0,i.useRef)(null);return e&&"function"!==typeof e?e:t}function st(e){return e.charAt(0).toUpperCase()+e.slice(1)}function gt(e,t){const n=void 0===t?"":`/${t}`;return"function"===typeof e?null:e&&e.current&&`${e.current.uuid}${n}`}const lt=new r.Euler,ct=new r.Quaternion,It=e=>t=>e(lt.setFromQuaternion(ct.fromArray(t)).toArray());let Ct=0;function ut(e,t,n,i,o,r){return void 0===r&&(r="bodies"),a=>{const s=Ct++;n[s]={[i]:a};const g=gt(e,o);return g&&t.subscribe({props:{id:s,target:r,type:i},uuid:g}),()=>{delete n[s],t.unsubscribe({props:s})}}}function dt(e,t){e.userData=t.userData||{},e.position.set(...t.position||[0,0,0]),e.rotation.set(...t.rotation||[0,0,0]),e.updateMatrix()}function ht(e,t,n){let{onCollide:i,onCollideBegin:o,onCollideEnd:r}=t;e[n]={collide:i,collideBegin:o,collideEnd:r}}function At(e,t,n,o,a){void 0===a&&(a=[]);const s=at(o),{worker:g,refs:l,events:c,subscriptions:I}=(0,i.useContext)(b),C=(0,i.useContext)(f);(0,i.useLayoutEffect)((()=>{s.current||(s.current=new r.Object3D);const i=s.current,o=g,a=i instanceof r.InstancedMesh?(i.instanceMatrix.setUsage(r.DynamicDrawUsage),i.count):1,I=i instanceof r.InstancedMesh?new Array(a).fill(0).map(((e,t)=>`${i.uuid}/${t}`)):[i.uuid],u=i instanceof r.InstancedMesh?I.map(((o,r)=>{const a=t(r);return dt(rt,a),i.setMatrixAt(r,rt.matrix),i.instanceMatrix.needsUpdate=!0,l[o]=i,C&&C.add(o,a,e),ht(c,a,o),{...a,args:n(a.args)}})):I.map(((o,r)=>{const a=t(r);return dt(i,a),l[o]=i,C&&C.add(o,a,e),ht(c,a,o),{...a,args:n(a.args)}}));return o.addBodies({props:u.map((e=>{let{onCollide:t,onCollideBegin:n,onCollideEnd:i,...o}=e;return{onCollide:Boolean(t),...o}})),type:e,uuid:I}),()=>{I.forEach((e=>{delete l[e],C&&C.remove(e),delete c[e]})),o.removeBodies({uuid:I})}}),a);const u=(0,i.useMemo)((()=>{const e=(e,t)=>{const n=`set${st(e)}`;return{set:e=>{const i=gt(s,t);i&&g[n]({props:e,uuid:i})},subscribe:ut(s,g,I,e,t)}},t=e=>({copy:t=>{let{w:n,x:i,y:o,z:r}=t;const a=gt(s,e);a&&g.setQuaternion({props:[i,o,r,n],uuid:a})},set:(t,n,i,o)=>{const r=gt(s,e);r&&g.setQuaternion({props:[t,n,i,o],uuid:r})},subscribe:ut(s,g,I,"quaternion",e)}),n=e=>({copy:t=>{let{x:n,y:i,z:o}=t;const r=gt(s,e);r&&g.setRotation({props:[n,i,o],uuid:r})},set:(t,n,i)=>{const o=gt(s,e);o&&g.setRotation({props:[t,n,i],uuid:o})},subscribe:t=>{const n=Ct++,i="quaternion",o=gt(s,e);return I[n]={[i]:It(t)},o&&g.subscribe({props:{id:n,target:"bodies",type:i},uuid:o}),()=>{delete I[n],g.unsubscribe({props:n})}}}),i=(e,t)=>{const n=`set${st(e)}`;return{copy:e=>{let{x:i,y:o,z:r}=e;const a=gt(s,t);a&&g[n]({props:[i,o,r],uuid:a})},set:(e,i,o)=>{const r=gt(s,t);r&&g[n]({props:[e,i,o],uuid:r})},subscribe:ut(s,g,I,e,t)}};function o(o){return{allowSleep:e("allowSleep",o),angularDamping:e("angularDamping",o),angularFactor:i("angularFactor",o),angularVelocity:i("angularVelocity",o),applyForce(e,t){const n=gt(s,o);n&&g.applyForce({props:[e,t],uuid:n})},applyImpulse(e,t){const n=gt(s,o);n&&g.applyImpulse({props:[e,t],uuid:n})},applyLocalForce(e,t){const n=gt(s,o);n&&g.applyLocalForce({props:[e,t],uuid:n})},applyLocalImpulse(e,t){const n=gt(s,o);n&&g.applyLocalImpulse({props:[e,t],uuid:n})},applyTorque(e){const t=gt(s,o);t&&g.applyTorque({props:[e],uuid:t})},collisionFilterGroup:e("collisionFilterGroup",o),collisionFilterMask:e("collisionFilterMask",o),collisionResponse:e("collisionResponse",o),fixedRotation:e("fixedRotation",o),isTrigger:e("isTrigger",o),linearDamping:e("linearDamping",o),linearFactor:i("linearFactor",o),mass:e("mass",o),material:e("material",o),position:i("position",o),quaternion:t(o),rotation:n(o),sleep(){const e=gt(s,o);e&&g.sleep({uuid:e})},sleepSpeedLimit:e("sleepSpeedLimit",o),sleepTimeLimit:e("sleepTimeLimit",o),userData:e("userData",o),velocity:i("velocity",o),wakeUp(){const e=gt(s,o);e&&g.wakeUp({uuid:e})}}}const r={};return{...o(void 0),at:e=>r[e]||(r[e]=o(e))}}),[]);return[s,u]}function pt(e,t,n){return void 0===t&&(t=null),At("Plane",e,(()=>[]),t,n)}function mt(e,t,n){void 0===t&&(t=null);const i=[1,1,1];return At("Box",e,(function(e){return void 0===e&&(e=i),e}),t,n)}const bt=e=>(0,g.jsx)(i.Suspense,{fallback:null,children:(0,g.jsx)(w,{...e})})},295:(e,t,n)=>{"use strict";n.d(t,{Hl:()=>P,j$:()=>j,pn:()=>$,yk:()=>_});var i=n(9408),o=n(5043);function r(e){let t;const n=new Set,i=(e,i)=>{const o="function"===typeof e?e(t):e;if(o!==t){const e=t;t=i?o:Object.assign({},t,o),n.forEach((n=>n(t,e)))}},o=()=>t,r={setState:i,getState:o,subscribe:(e,i,r)=>i||r?function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object.is;console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let a=i(t);function s(){const n=i(t);if(!r(a,n)){const t=a;e(a=n,t)}}return n.add(s),()=>n.delete(s)}(e,i,r):(n.add(e),()=>n.delete(e)),destroy:()=>n.clear()};return t=e(i,o,r),r}const a="undefined"===typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?o.useEffect:o.useLayoutEffect;var s=n(2016),g=n.n(s),l=n(8853),c=n(122),I=n.n(c);const C=[];function u(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];for(const a of t)if(I()(n,a.args)){if(o)return;if(a.error)throw a.error;if(a.response)return a.response;throw a.promise}const r={args:n,promise:e(...n).then((e=>r.response=null==e||e)).catch((e=>r.error=null!=e?e:"unknown error")).then((()=>{i>0&&setTimeout((()=>{const e=t.indexOf(r);-1!==e&&t.splice(e,1)}),i)}))};if(t.push(r),!o)throw r.promise}function d(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(void 0===n||0===n.length)e.splice(0,e.length);else{const t=e.find((e=>I()(n,e.args)));if(t){const n=e.indexOf(t);-1!==n&&e.splice(n,1)}}}function h(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return u(e,C,n,h.lifespan)}h.lifespan=0,h.clear=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return d(C,...t)},h.preload=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];u(e,C,n,h.lifespan,!0)},h.peek=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i;return null==(i=C.find((e=>I()(t,e.args))))?void 0:i.response};const A=function(e){return function(t){e.forEach((function(e){"function"===typeof e?e(t):null!=e&&(e.current=t)}))}};var p=n(4695),m=n.n(p);function b(e){let{debounce:t,scroll:n,polyfill:i,offsetSize:r}=void 0===e?{debounce:0,scroll:!1,offsetSize:!1}:e;const a=i||("undefined"===typeof window?class{}:window.ResizeObserver);if(!a)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,g]=(0,o.useState)({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),l=(0,o.useRef)({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s}),c=t?"number"===typeof t?t:t.scroll:null,I=t?"number"===typeof t?t:t.resize:null,C=(0,o.useRef)(!1);(0,o.useEffect)((()=>(C.current=!0,()=>{C.current=!1})));const[u,d,h]=(0,o.useMemo)((()=>{const e=()=>{if(!l.current.element)return;const{left:e,top:t,width:n,height:i,bottom:o,right:a,x:s,y:c}=l.current.element.getBoundingClientRect(),I={left:e,top:t,width:n,height:i,bottom:o,right:a,x:s,y:c};l.current.element instanceof HTMLElement&&r&&(I.height=l.current.element.offsetHeight,I.width=l.current.element.offsetWidth),Object.freeze(I),C.current&&!G(l.current.lastBounds,I)&&g(l.current.lastBounds=I)};return[e,I?m()(e,I):e,c?m()(e,c):e]}),[g,r,c,I]);function A(){l.current.scrollContainers&&(l.current.scrollContainers.forEach((e=>e.removeEventListener("scroll",h,!0))),l.current.scrollContainers=null),l.current.resizeObserver&&(l.current.resizeObserver.disconnect(),l.current.resizeObserver=null)}function p(){l.current.element&&(l.current.resizeObserver=new a(h),l.current.resizeObserver.observe(l.current.element),n&&l.current.scrollContainers&&l.current.scrollContainers.forEach((e=>e.addEventListener("scroll",h,{capture:!0,passive:!0}))))}var b,y,v;return b=h,y=Boolean(n),(0,o.useEffect)((()=>{if(y){const e=b;return window.addEventListener("scroll",e,{capture:!0,passive:!0}),()=>{window.removeEventListener("scroll",e,!0)}}}),[b,y]),v=d,(0,o.useEffect)((()=>{const e=v;return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[v]),(0,o.useEffect)((()=>{A(),p()}),[n,h,d]),(0,o.useEffect)((()=>A),[]),[e=>{e&&e!==l.current.element&&(A(),l.current.element=e,l.current.scrollContainers=f(e),p())},s,u]}function f(e){const t=[];if(!e||e===document.body)return t;const{overflow:n,overflowX:i,overflowY:o}=window.getComputedStyle(e);return[n,i,o].some((e=>"auto"===e||"scroll"===e))&&t.push(e),[...t,...f(e.parentElement)]}const y=["x","y","top","bottom","left","right","width","height"],G=(e,t)=>y.every((n=>e[n]===t[n]));const v={obj:e=>e===Object(e)&&!v.arr(e)&&"function"!==typeof e,fun:e=>"function"===typeof e,str:e=>"string"===typeof e,num:e=>"number"===typeof e,und:e=>void 0===e,arr:e=>Array.isArray(e),equ(e,t){if(typeof e!==typeof t||!!e!==!!t)return!1;if(v.str(e)||v.num(e)||v.obj(e))return e===t;if(v.arr(e)&&e==t)return!0;let n;for(n in e)if(!(n in t))return!1;for(n in t)if(e[n]!==t[n])return!1;return!v.und(n)||e===t}};function B(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Z(e,t,n,i){const o=n.get(t);o&&(n.delete(t),0===n.size&&(e.delete(i),o.target.releasePointerCapture(i)))}function w(e){const t=new i.Vector3;function n(e){return e.filter((e=>["Move","Over","Enter","Out","Leave"].some((t=>{var n;return null==(n=e.__r3f)?void 0:n.handlers["onPointer"+t]}))))}function o(t){const{internal:n}=e.getState();Array.from(n.hovered.values()).forEach((e=>{if(!t.length||!t.find((t=>t.object===e.object&&t.index===e.index&&t.instanceId===e.instanceId))){const i=e.eventObject.__r3f,o=null==i?void 0:i.handlers;if(n.hovered.delete(B(e)),null!=i&&i.eventCount){const n={...e,intersections:t||[]};null==o.onPointerOut||o.onPointerOut(n),null==o.onPointerLeave||o.onPointerLeave(n)}}}))}function r(e,t){t.forEach((t=>{var n;return null==(n=t.__r3f)||null==n.handlers.onPointerMissed?void 0:n.handlers.onPointerMissed(e)}))}return{handlePointer:i=>{switch(i){case"onPointerLeave":case"onPointerCancel":return()=>o([]);case"onLostPointerCapture":return t=>{const{internal:n}=e.getState();"pointerId"in t&&!n.capturedMap.has(t.pointerId)&&(n.capturedMap.delete(t.pointerId),o([]))}}return a=>{const{onPointerMissed:s,internal:g}=e.getState();!function(t){var n,i,o,r;const a=e.getState(),{raycaster:s,mouse:g,camera:l,size:c}=a,I=null==s.computeOffsets?void 0:s.computeOffsets(t,a),C=null!=(n=null==I?void 0:I.offsetX)?n:t.offsetX,u=null!=(i=null==I?void 0:I.offsetY)?i:t.offsetY,d=null!=(o=null==I?void 0:I.width)?o:c.width,h=null!=(r=null==I?void 0:I.height)?r:c.height;g.set(C/d*2-1,-u/h*2+1),s.setFromCamera(g,l)}(a),g.lastEvent.current=a;const l="onPointerMove"===i,c="onClick"===i||"onContextMenu"===i||"onDoubleClick"===i,I=function(t,n){const{internal:i}=e.getState();if("pointerId"in n&&i.capturedMap.has(n.pointerId))for(let e of i.capturedMap.get(n.pointerId).values())t.push(e.intersection);return t}(function(t){const n=e.getState(),{raycaster:i,internal:o}=n;if(!i.enabled)return[];const r=new Set,a=[],s=t?t(o.interaction):o.interaction;let g=i.intersectObjects(s,!0).filter((e=>{const t=B(e);return!r.has(t)&&(r.add(t),!0)}));i.filter&&(g=i.filter(g,n));for(const e of g){let t=e.object;for(;t;){var l;null!=(l=t.__r3f)&&l.eventCount&&a.push({...e,eventObject:t}),t=t.parent}}return a}(l?n:void 0),a),C=c?function(t){const{internal:n}=e.getState(),i=t.offsetX-n.initialClick[0],o=t.offsetY-n.initialClick[1];return Math.round(Math.sqrt(i*i+o*o))}(a):0;"onPointerDown"===i&&(g.initialClick=[a.offsetX,a.offsetY],g.initialHits=I.map((e=>e.eventObject))),c&&!I.length&&C<=2&&(r(a,g.interaction),s&&s(a)),l&&o(I),function(n,i,r,a){const{raycaster:s,mouse:g,camera:l,internal:c}=e.getState();if(n.length){const e=t.set(g.x,g.y,0).unproject(l),I={stopped:!1};for(const t of n){const C=e=>{var n,i;return null!=(n=null==(i=c.capturedMap.get(e))?void 0:i.has(t.eventObject))&&n},u=e=>{const n={intersection:t,target:i.target};c.capturedMap.has(e)?c.capturedMap.get(e).set(t.eventObject,n):c.capturedMap.set(e,new Map([[t.eventObject,n]])),i.target.setPointerCapture(e)},d=e=>{const n=c.capturedMap.get(e);n&&Z(c.capturedMap,t.eventObject,n,e)};let h={};for(let e in i){let t=i[e];"function"!==typeof t&&(h[e]=t)}let A={...t,...h,spaceX:g.x,spaceY:g.y,intersections:n,stopped:I.stopped,delta:r,unprojectedPoint:e,ray:s.ray,camera:l,stopPropagation:()=>{const e="pointerId"in i&&c.capturedMap.get(i.pointerId);(!e||e.has(t.eventObject))&&(A.stopped=I.stopped=!0,c.hovered.size&&Array.from(c.hovered.values()).find((e=>e.eventObject===t.eventObject)))&&o([...n.slice(0,n.indexOf(t)),t])},target:{hasPointerCapture:C,setPointerCapture:u,releasePointerCapture:d},currentTarget:{hasPointerCapture:C,setPointerCapture:u,releasePointerCapture:d},sourceEvent:i,nativeEvent:i};if(a(A),!0===I.stopped)break}}}(I,a,C,(e=>{const t=e.eventObject,n=t.__r3f,o=null==n?void 0:n.handlers;if(null!=n&&n.eventCount)if(l){if(o.onPointerOver||o.onPointerEnter||o.onPointerOut||o.onPointerLeave){const t=B(e),n=g.hovered.get(t);n?n.stopped&&e.stopPropagation():(g.hovered.set(t,e),null==o.onPointerOver||o.onPointerOver(e),null==o.onPointerEnter||o.onPointerEnter(e))}null==o.onPointerMove||o.onPointerMove(e)}else{const n=o[i];n?c&&!g.initialHits.includes(t)||(r(a,g.interaction.filter((e=>!g.initialHits.includes(e)))),n(e)):c&&g.initialHits.includes(t)&&r(a,g.interaction.filter((e=>!g.initialHits.includes(e))))}}))}}}}const W=e=>e&&!!e.getState,S=(e,t)=>{var n,i;return{root:W(e)?e:null!=(n=null==(i=e.__r3f)?void 0:i.root)?n:t.__r3f.root,container:W(e)?e.getState().scene:e}},R="__default",x={};let V={};function X(e,t){const n=e;return(null!=t&&t.primitive||!n.__r3f)&&(n.__r3f={root:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t}),e}const H=e=>e&&e.isOrthographicCamera;function Y(e){return Array.isArray(e)?Math.min(Math.max(e[0],window.devicePixelRatio),e[1]):e}const K=o.createContext(null),N=(e,t,n,s)=>{const{gl:g,size:l,shadows:c=!1,linear:I=!1,flat:C=!1,vr:u=!1,orthographic:d=!1,frameloop:h="always",dpr:A=1,performance:p,clock:m=new i.Clock,raycaster:b,camera:f,onPointerMissed:y}=s;c&&(g.shadowMap.enabled=!0,"object"===typeof c?Object.assign(g.shadowMap,c):g.shadowMap.type=i.PCFSoftShadowMap),I&&(g.outputEncoding=i.LinearEncoding),C&&(g.toneMapping=i.NoToneMapping),"never"===h&&(m.stop(),m.elapsedTime=0);const G=function(e){const t="function"===typeof e?r(e):e,n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.getState,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object.is;const[,i]=(0,o.useReducer)((e=>e+1),0),r=t.getState(),s=(0,o.useRef)(r),g=(0,o.useRef)(e),l=(0,o.useRef)(n),c=(0,o.useRef)(!1),I=(0,o.useRef)();let C;void 0===I.current&&(I.current=e(r));let u=!1;(s.current!==r||g.current!==e||l.current!==n||c.current)&&(C=e(r),u=!n(I.current,C)),a((()=>{u&&(I.current=C),s.current=r,g.current=e,l.current=n,c.current=!1}));const d=(0,o.useRef)(r);a((()=>{const e=()=>{try{const e=t.getState(),n=g.current(e);l.current(I.current,n)||(s.current=e,I.current=n,i())}catch(e){c.current=!0,i()}},n=t.subscribe(e);return t.getState()!==d.current&&e(),n}),[]);const h=u?C:I.current;return(0,o.useDebugValue)(h),h};return Object.assign(n,t),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const e=[n,t];return{next(){const t=e.length<=0;return{value:e.shift(),done:t}}}},n}(((r,a)=>{const l=new i.Raycaster,{params:c,...G}=b||{};e(l,{enabled:!0,...G,params:{...l.params,...c}});const v=f instanceof i.Camera,B=v?f:d?new i.OrthographicCamera(0,0,0,0,.1,1e3):new i.PerspectiveCamera(75,0,.1,1e3);v||(B.position.z=5,f&&e(B,f),null!=f&&f.rotation||B.lookAt(0,0,0));const Z=Y(A),w=new i.Vector3,W=new i.Vector3,S=new i.Vector3;function R(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a().camera,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a().size;const{width:o,height:r}=n,s=o/r;t instanceof i.Vector3?S.copy(t):S.set(...t);const g=e.getWorldPosition(w).distanceTo(S);if(H(e))return{width:o/e.zoom,height:r/e.zoom,factor:1,distance:g,aspect:s};{const t=e.fov*Math.PI/180,n=2*Math.tan(t/2)*g,i=n*(o/r);return{width:i,height:n,factor:o/i,distance:g,aspect:s}}}let x;const V=e=>r((t=>({performance:{...t.performance,current:e}})));return{gl:g,set:r,get:a,invalidate:()=>t(a()),advance:(e,t)=>n(e,t,a()),linear:I,flat:C,scene:X(new i.Scene),camera:B,controls:null,raycaster:l,clock:m,mouse:new i.Vector2,vr:u,frameloop:h,onPointerMissed:y,performance:{current:1,min:.5,max:1,debounce:200,...p,regress:()=>{const e=a();x&&clearTimeout(x),e.performance.current!==e.performance.min&&V(e.performance.min),x=setTimeout((()=>V(a().performance.max)),e.performance.debounce)}},size:{width:0,height:0},viewport:{initialDpr:Z,dpr:Z,width:0,height:0,aspect:0,distance:0,factor:0,getCurrentViewport:R},setSize:(e,t)=>{const n={width:e,height:t};r((e=>({size:n,viewport:{...e.viewport,...R(B,W,n)}})))},setDpr:e=>r((t=>({viewport:{...t.viewport,dpr:Y(e)}}))),setFrameloop:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"always";return r((()=>({frameloop:e})))},events:{connected:!1},internal:{active:!1,priority:0,frames:0,lastProps:s,lastEvent:o.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return r((n=>{let{internal:i}=n;return{internal:{...i,priority:i.priority+(t>0?1:0),subscribers:[...i.subscribers,{ref:e,priority:t}].sort(((e,t)=>e.priority-t.priority))}}})),()=>{r((n=>{let{internal:i}=n;return{internal:{...i,priority:i.priority-(t>0?1:0),subscribers:i.subscribers.filter((t=>t.ref!==e))}}}))}}}}})),v=G.getState();let B=v.size,Z=v.viewport.dpr;return G.subscribe((()=>{const{camera:e,size:t,viewport:n,internal:o}=G.getState();t===B&&n.dpr===Z||(e.manual||o.lastProps.camera instanceof i.Camera||(H(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld()),g.setPixelRatio(n.dpr),g.setSize(t.width,t.height),B=t,Z=n.dpr)})),l&&v.setSize(l.width,l.height),G.subscribe((e=>t(e))),G};let M,F=[],k=[],z=[];function L(e,t){for(M=0;M<e.length;M++)e[M](t)}function T(e,t){let n=t.clock.getDelta();for("never"===t.frameloop&&"number"===typeof e&&(n=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),M=0;M<t.internal.subscribers.length;M++)t.internal.subscribers[M].ref.current(t,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),"always"===t.frameloop?1:t.internal.frames}function E(e){const{handlePointer:t}=w(e),n={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};return{connected:!1,handlers:Object.keys(n).reduce(((e,n)=>({...e,[n]:t(n)})),{}),connect:t=>{var i;const{set:o,events:r}=e.getState();null==r.disconnect||r.disconnect(),o((e=>({events:{...e.events,connected:t}}))),Object.entries(null!=(i=null==r?void 0:r.handlers)?i:[]).forEach((e=>{let[i,o]=e;const[r,a]=n[i];t.addEventListener(r,o,{passive:a})}))},disconnect:()=>{const{set:t,events:i}=e.getState();var o;i.connected&&(Object.entries(null!=(o=i.handlers)?o:[]).forEach((e=>{let[t,o]=e;if(i&&i.connected instanceof HTMLElement){const[e]=n[t];i.connected.removeEventListener(e,o)}})),t((e=>({events:{...e.events,connected:!1}}))))}}}const J="undefined"!==typeof window?o.useLayoutEffect:o.useEffect;function U(e){let{set:t}=e;return J((()=>(t(new Promise((()=>null))),()=>t(!1))),[]),null}class D extends o.Component{constructor(){super(...arguments),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}D.getDerivedStateFromError=()=>({error:!0});const P=o.forwardRef((function(e,t){let{children:n,fallback:i,tabIndex:r,resize:a,id:s,style:g,className:l,events:c,...I}=e;const C=function(e){const t=o.useRef(e);return o.useLayoutEffect((()=>{t.current=e}),[e]),function(){return null==t.current?void 0:t.current(...arguments)}}(I.onPointerMissed),[u,{width:d,height:h}]=b({scroll:!0,debounce:{scroll:50,resize:0},...a}),p=o.useRef(null),[m,f]=o.useState(!1),[y,G]=o.useState(!1);if(m)throw m;if(y)throw y;return J((()=>{d>0&&h>0&&function(e,t){let{gl:n,size:i,mode:r=te[1],events:a,onCreated:s,...g}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var l,c,I,C,u;i||(i={width:null!=(c=null==(I=t.parentElement)?void 0:I.clientWidth)?c:0,height:null!=(C=null==(u=t.parentElement)?void 0:u.clientHeight)?C:0});let d=ee.get(t),h=null==d?void 0:d.fiber,A=null==d?void 0:d.store,p=null==(l=A)?void 0:l.getState();if(h&&p){void 0===g.dpr||v.equ(p.viewport.dpr,Y(g.dpr))||p.setDpr(g.dpr),p.size.width===i.width&&p.size.height===i.height||p.setSize(i.width,i.height),p.frameloop!==g.frameloop&&p.setFrameloop(g.frameloop);g.linear!==p.internal.lastProps.linear&&(ge(t),h=void 0)}if(!h){const e=ae(n,t);g.vr&&(e.xr.enabled=!0,e.setAnimationLoop((e=>ie(e,!0)))),A=N(re,ne,ie,{gl:e,size:i,...g});const o=A.getState();h=oe.createContainer(A,te.indexOf(r),!1,null),ee.set(t,{fiber:h,store:A}),a&&o.set({events:a(A)})}if(A&&h)return oe.updateContainer(o.createElement(se,{store:A,element:e,onCreated:s,target:t}),h,null,(()=>{})),A;throw"Error creating root!"}(o.createElement(D,{set:G},o.createElement(o.Suspense,{fallback:o.createElement(U,{set:f})},n)),p.current,{...I,size:{width:d,height:h},onPointerMissed:C,events:c||E})}),[d,h,n,C]),J((()=>{const e=p.current;return()=>ge(e)}),[]),o.createElement("div",{ref:u,id:s,className:l,tabIndex:r,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",...g}},o.createElement("canvas",{ref:A([p,t]),style:{display:"block"}},i))}));function Q(){const e=o.useContext(K);if(!e)throw"R3F hooks can only be used within the Canvas component!";return e}function _(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>e,t=arguments.length>1?arguments[1]:void 0;return Q()(e,t)}function j(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=Q().getState().internal.subscribe,i=o.useRef(e);return o.useLayoutEffect((()=>{i.current=e}),[e]),o.useLayoutEffect((()=>n(i,t)),[t,n]),null}function O(e){const t={nodes:{},materials:{}};return e&&e.traverse((e=>{e.name&&(t.nodes[e.name]=e),e.material&&!t.materials[e.material.name]&&(t.materials[e.material.name]=e.material)})),t}function q(e,t){return function(n){const i=new n;e&&e(i);for(var o=arguments.length,r=new Array(o>1?o-1:0),a=1;a<o;a++)r[a-1]=arguments[a];return Promise.all(r.map((e=>new Promise(((n,o)=>i.load(e,(e=>{e.scene&&Object.assign(e,O(e.scene)),n(e)}),t,(t=>o(`Could not load ${e}: ${t.message}`))))))))}}function $(e,t,n,i){const o=Array.isArray(t)?t:[t],r=h(q(n,i),e,...o);return Array.isArray(t)?r:r[0]}$.preload=function(e,t,n){const i=Array.isArray(t)?t:[t];return h.preload(q(n),e,...i)},$.clear=function(e,t){const n=Array.isArray(t)?t:[t];return h.clear(e,...n)};const ee=new Map,te=["legacy","blocking","concurrent"],{invalidate:ne,advance:ie}=function(e){let t,n=!1;function i(o){if(n=!0,t=0,L(F,o),e.forEach((e=>{const n=e.store.getState();n.internal.active&&("always"===n.frameloop||n.internal.frames>0)&&(t+=T(o,n))})),L(k,o),t>0)return requestAnimationFrame(i);L(z,o),n=!1}return{loop:i,invalidate:function t(o){if(!o)return e.forEach((e=>t(e.store.getState())));!o.vr&&o.internal.active&&"never"!==o.frameloop&&(o.internal.frames=Math.min(60,o.internal.frames+1),n||(n=!0,requestAnimationFrame(i)))},advance:function(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0;n&&L(F,t),i?T(t,i):e.forEach((e=>T(t,e.store.getState()))),n&&L(k,t)}}}(ee),{reconciler:oe,applyProps:re}=function(){function e(e,t){let{children:n,key:i,ref:o,...r}=t,{children:a,key:s,ref:g,...l}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},c=arguments.length>3&&void 0!==arguments[3]&&arguments[3];var I;const C=null!=(I=null==e?void 0:e.__r3f)?I:{},u=Object.entries(r),d=[];if(c){const e=Object.keys(l);for(let t=0;t<e.length;t++)r.hasOwnProperty(e[t])||u.unshift([e[t],R+"remove"])}u.forEach((t=>{let[n,i]=t;var o,r,a;if(null!=(o=e.__r3f)&&o.primitive&&"object"===n)return;if(r=i,a=l[n],v.arr(r)&&v.equ(r,a)||r===a)return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(n))return d.push([n,i,!0,[]]);let s=[];n.includes("-")&&(s=n.split("-")),d.push([n,i,!1,s])}));const h={...r};return C.memoizedProps&&C.memoizedProps.args&&(h.args=C.memoizedProps.args),C.memoizedProps&&C.memoizedProps.attach&&(h.attach=C.memoizedProps.attach),{accumulative:c,memoized:h,changes:d}}function t(t,r){var a,s,g;const l=null!=(a=null==t?void 0:t.__r3f)?a:{},c=l.root,I=null!=(s=null==c||null==c.getState?void 0:c.getState())?s:{},{memoized:C,changes:u}=(d=r)&&d.memoized&&d.changes?r:e(t,r);var d;const h=l.eventCount;if(t.__r3f&&(t.__r3f.memoizedProps=C),u.forEach((e=>{let[o,r,a,s]=e;var g;let c=t,u=c[o];if(s.length&&(u=s.reduce(((e,t)=>e[t]),t),!u||!u.set)){const[e,...n]=s.reverse();c=n.reverse().reduce(((e,t)=>e[t]),t),o=e}if(r===R+"remove")if(u&&u.constructor)r=new u.constructor(C.args);else if(c.constructor){const e=new c.constructor(c.__r3f.memoizedProps.args);r=e[u],e.dispose&&e.dispose()}else r=0;const d=(null==I||null==(g=I.gl)?void 0:g.outputEncoding)===i.LinearEncoding;if(a)r?l.handlers[o]=r:delete l.handlers[o],l.eventCount=Object.keys(l.handlers).length;else if(u&&u.set&&(u.copy||u instanceof i.Layers)){if(Array.isArray(r))u.fromArray?u.fromArray(r):u.set(...r);else if(u.copy&&r&&r.constructor&&u.constructor.name===r.constructor.name)u.copy(r);else if(void 0!==r){const e=u instanceof i.Color;!e&&u.setScalar?u.setScalar(r):u instanceof i.Layers&&r instanceof i.Layers?u.mask=r.mask:u.set(r),!d&&e&&u.convertSRGBToLinear()}}else c[o]=r,!d&&c[o]instanceof i.Texture&&(c[o].encoding=i.sRGBEncoding);n(t)})),l.parent&&I.internal&&t.raycast&&h!==l.eventCount){const e=I.internal.interaction.indexOf(t);e>-1&&I.internal.interaction.splice(e,1),l.eventCount&&I.internal.interaction.push(t)}return u.length&&null!=(g=t.__r3f)&&g.parent&&o(t),t}function n(e){var t,n;const i=null==(t=e.__r3f)||null==(n=t.root)||null==n.getState?void 0:n.getState();i&&0===i.internal.frames&&i.invalidate()}function o(e){null==e.onUpdate||e.onUpdate(e)}function r(e,n,o,r,a){let s,{args:g=[],...l}=n,c=`${e[0].toUpperCase()}${e.slice(1)}`;if(!W(o)&&a){const e=t=>t.return?e(t.return):t.stateNode&&t.stateNode.containerInfo;o=e(a)}if(!o||!W(o))throw`No valid root for ${c}!`;if("primitive"===e){if(void 0===l.object)throw"Primitives without 'object' are invalid!";s=X(l.object,{root:o,primitive:!0})}else{const e=V[c]||i[c];if(!e)throw`${c} is not part of the THREE namespace! Did you forget to extend? See: https://github.com/pmndrs/react-three-fiber/blob/master/markdown/api.md#using-3rd-party-objects-declaratively`;if(!Array.isArray(g))throw"The args prop must be an array!";s=X(new e(...g),{root:o,memoizedProps:{args:0===g.length?null:g}})}return"attachFns"in l||(c.endsWith("Geometry")?l={attach:"geometry",...l}:c.endsWith("Material")&&(l={attach:"material",...l})),t(s,l),s}function a(e,t){let i=!1;if(t){if(t.attachArray)v.arr(e[t.attachArray])||(e[t.attachArray]=[]),e[t.attachArray].push(t);else if(t.attachObject)v.obj(e[t.attachObject[0]])||(e[t.attachObject[0]]={}),e[t.attachObject[0]][t.attachObject[1]]=t;else if(t.attach&&!v.fun(t.attach))e[t.attach]=t;else if(v.arr(t.attachFns)){const[n]=t.attachFns;v.str(n)&&v.fun(e[n])?e[n](t):v.fun(n)&&n(t,e)}else t.isObject3D&&e.isObject3D&&(e.add(t),i=!0);i||e.__r3f.objects.push(t),t.__r3f||X(t,{}),t.__r3f.parent=e,o(t),n(t)}}function s(e,t,i){let r=!1;if(t){if(t.attachArray){let n=e[t.attachArray];v.arr(n)||(e[t.attachArray]=[],n=e[t.attachArray]),n.splice(n.indexOf(i),0,t)}else{if(t.attachObject||t.attach&&!v.fun(t.attach))return a(e,t);if(t.isObject3D&&e.isObject3D){t.parent=e,t.dispatchEvent({type:"added"});const n=e.children.filter((e=>e!==t)),o=n.indexOf(i);e.children=[...n.slice(0,o),t,...n.slice(o)],r=!0}}r||e.__r3f.objects.push(t),t.__r3f||X(t,{}),t.__r3f.parent=e,o(t),n(t)}}function c(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e&&[...e].forEach((e=>I(t,e,n)))}function I(e,t,i){if(t){var o,r;if(t.__r3f&&(t.__r3f.parent=null),null!=(o=e.__r3f)&&o.objects&&(e.__r3f.objects=e.__r3f.objects.filter((e=>e!==t))),t.attachArray)e[t.attachArray]=e[t.attachArray].filter((e=>e!==t));else if(t.attachObject)delete e[t.attachObject[0]][t.attachObject[1]];else if(t.attach&&!v.fun(t.attach)&&e[t.attach]===t)e[t.attach]=null;else if(v.arr(t.attachFns)){const[,n]=t.attachFns;v.str(n)&&v.fun(e[n])?e[n](t):v.fun(n)&&n(t,e)}else if(t.isObject3D&&e.isObject3D){var a;e.remove(t),null!=(a=t.__r3f)&&a.root&&function(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter((e=>e!==t)),n.initialHits=n.initialHits.filter((e=>e!==t)),n.hovered.forEach(((e,i)=>{e.eventObject!==t&&e.object!==t||n.hovered.delete(i)})),n.capturedMap.forEach(((e,i)=>{Z(n.capturedMap,t,e,i)}))}(t.__r3f.root,t)}const g=null==(r=t.__r3f)?void 0:r.primitive,I=void 0===i?null!==t.dispose&&!g:i;var s;if(!g)c(null==(s=t.__r3f)?void 0:s.objects,t,I),c(t.children,t,I);t.__r3f&&(delete t.__r3f.root,delete t.__r3f.objects,delete t.__r3f.handlers,delete t.__r3f.memoizedProps,g||delete t.__r3f),I&&t.dispose&&"Scene"!==t.type&&(0,l.unstable_runWithPriority)(l.unstable_IdlePriority,(()=>{try{t.dispose()}catch(e){}})),n(e)}}return{reconciler:g()({now:l.unstable_now,createInstance:r,removeChild:I,appendChild:a,appendInitialChild:a,insertBefore:s,warnsIfNotActing:!0,supportsMutation:!0,isPrimaryRenderer:!1,scheduleTimeout:v.fun(setTimeout)?setTimeout:void 0,cancelTimeout:v.fun(clearTimeout)?clearTimeout:void 0,setTimeout:v.fun(setTimeout)?setTimeout:void 0,clearTimeout:v.fun(clearTimeout)?clearTimeout:void 0,noTimeout:-1,appendChildToContainer:(e,t)=>{const{container:n,root:i}=S(e,t);n.__r3f.root=i,a(n,t)},removeChildFromContainer:(e,t)=>I(S(e,t).container,t),insertInContainerBefore:(e,t,n)=>s(S(e,t).container,t,n),prepareUpdate(t,n,i,o){if(t.__r3f.primitive&&o.object&&o.object!==t)return[!0];{const{args:n=[],children:r,...s}=o,{args:g=[],children:l,...c}=i;if(!Array.isArray(n))throw"The args prop must be an array!";if(n.some(((e,t)=>e!==g[t])))return[!0];const I=e(t,s,c,!0);if(I.changes.length)return[!1,I];if(t.attach&&"function"!==typeof t.attach){const e=t.__r3f.parent;e&&e[t.attach]!==t&&a(e,t)}return null}},commitUpdate(e,n,i,o,s,g){let[l,c]=n;l?function(e,t,n,i){var o;const s=null==(o=e.__r3f)?void 0:o.parent;if(!s)return;const g=r(t,n,e.__r3f.root);"primitive"!==t&&e.children&&(e.children.forEach((e=>a(g,e))),e.children=[]),e.__r3f.objects.forEach((e=>a(g,e))),e.__r3f.objects=[],I(s,e),a(s,g),g.raycast&&g.__r3f.eventCount&&g.__r3f.root.getState().internal.interaction.push(g);[i,i.alternate].forEach((e=>{null!==e&&(e.stateNode=g,e.ref&&("function"===typeof e.ref?e.ref(g):e.ref.current=g))}))}(e,i,s,g):t(e,c)},hideInstance(e){e.isObject3D&&(e.visible=!1,n(e))},unhideInstance(e,t){(e.isObject3D&&null==t.visible||t.visible)&&(e.visible=!0,n(e))},hideTextInstance(){throw new Error("Text is not allowed in the R3F tree.")},getPublicInstance:e=>e,getRootHostContext:e=>x,getChildHostContext:e=>e,createTextInstance(){},finalizeInitialChildren(e){var t;return!!(null!=(t=null==e?void 0:e.__r3f)?t:{}).handlers},commitMount(e){var t;const n=null!=(t=null==e?void 0:e.__r3f)?t:{};e.raycast&&n.handlers&&n.eventCount&&e.__r3f.root.getState().internal.interaction.push(e)},shouldDeprioritizeSubtree:()=>!1,prepareForCommit:()=>null,preparePortalMount(e){X(e)},resetAfterCommit(){},shouldSetTextContent:()=>!1,clearContainer:()=>!1}),applyProps:t}}(),ae=(e,t)=>{const n="function"===typeof e?e(t):e;if(null!=(o=n)&&o.render)return n;var o;const r=new i.WebGLRenderer({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e});return r.outputEncoding=i.sRGBEncoding,r.toneMapping=i.ACESFilmicToneMapping,e&&re(r,e),r};function se(e){let{store:t,element:n,onCreated:i,target:r}=e;return o.useEffect((()=>{const e=t.getState();e.set((e=>({internal:{...e.internal,active:!0}}))),null==e.events.connect||e.events.connect(r),i&&i(e)}),[]),o.createElement(K.Provider,{value:t},n)}function ge(e,t){const n=ee.get(e),i=null==n?void 0:n.fiber;if(i){const o=null==n?void 0:n.store.getState();o&&(o.internal.active=!1),oe.updateContainer(null,i,null,(()=>{o&&setTimeout((()=>{var n,i,r;null==o.events.disconnect||o.events.disconnect(),null==(n=o.gl)||null==(i=n.renderLists)||null==i.dispose||i.dispose(),null==(r=o.gl)||null==r.forceContextLoss||r.forceContextLoss(),function(e){e.dispose&&"Scene"!==e.type&&e.dispose();for(const t in e)null==t.dispose||t.dispose(),delete e[t]}(o),ee.delete(e),t&&t(e)}),500)}))}}oe.act;oe.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:"17.0.2"})},7115:function(e,t,n){e.exports=function(){"use strict";var e="undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:{},t="Expected a function",i=NaN,o="[object Symbol]",r=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,g=/^0o[0-7]+$/i,l=parseInt,c="object"==typeof e&&e&&e.Object===Object&&e,I="object"==typeof self&&self&&self.Object===Object&&self,C=c||I||Function("return this")(),u=Object.prototype.toString,d=Math.max,h=Math.min,A=function(){return C.Date.now()};function p(e,n,i){var o,r,a,s,g,l,c=0,I=!1,C=!1,u=!0;if("function"!=typeof e)throw new TypeError(t);function p(t){var n=o,i=r;return o=r=void 0,c=t,s=e.apply(i,n)}function f(e){var t=e-l;return void 0===l||t>=n||t<0||C&&e-c>=a}function y(){var e=A();if(f(e))return G(e);g=setTimeout(y,function(e){var t=n-(e-l);return C?h(t,a-(e-c)):t}(e))}function G(e){return g=void 0,u&&o?p(e):(o=r=void 0,s)}function v(){var e=A(),t=f(e);if(o=arguments,r=this,l=e,t){if(void 0===g)return function(e){return c=e,g=setTimeout(y,n),I?p(e):s}(l);if(C)return g=setTimeout(y,n),p(l)}return void 0===g&&(g=setTimeout(y,n)),s}return n=b(n)||0,m(i)&&(I=!!i.leading,a=(C="maxWait"in i)?d(b(i.maxWait)||0,n):a,u="trailing"in i?!!i.trailing:u),v.cancel=function(){void 0!==g&&clearTimeout(g),c=0,o=l=r=g=void 0},v.flush=function(){return void 0===g?s:G(A())},v}function m(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function b(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&u.call(e)==o}(e))return i;if(m(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=m(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(r,"");var n=s.test(e);return n||g.test(e)?l(e.slice(2),n?2:8):a.test(e)?i:+e}var f=function(e,n,i){var o=!0,r=!0;if("function"!=typeof e)throw new TypeError(t);return m(i)&&(o="leading"in i?!!i.leading:o,r="trailing"in i?!!i.trailing:r),p(e,n,{leading:o,maxWait:n,trailing:r})},y="Expected a function",G=NaN,v="[object Symbol]",B=/^\s+|\s+$/g,Z=/^[-+]0x[0-9a-f]+$/i,w=/^0b[01]+$/i,W=/^0o[0-7]+$/i,S=parseInt,R="object"==typeof e&&e&&e.Object===Object&&e,x="object"==typeof self&&self&&self.Object===Object&&self,V=R||x||Function("return this")(),X=Object.prototype.toString,H=Math.max,Y=Math.min,K=function(){return V.Date.now()};function N(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function M(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&X.call(e)==v}(e))return G;if(N(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=N(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(B,"");var n=w.test(e);return n||W.test(e)?S(e.slice(2),n?2:8):Z.test(e)?G:+e}var F=function(e,t,n){var i,o,r,a,s,g,l=0,c=!1,I=!1,C=!0;if("function"!=typeof e)throw new TypeError(y);function u(t){var n=i,r=o;return i=o=void 0,l=t,a=e.apply(r,n)}function d(e){var n=e-g;return void 0===g||n>=t||n<0||I&&e-l>=r}function h(){var e=K();if(d(e))return A(e);s=setTimeout(h,function(e){var n=t-(e-g);return I?Y(n,r-(e-l)):n}(e))}function A(e){return s=void 0,C&&i?u(e):(i=o=void 0,a)}function p(){var e=K(),n=d(e);if(i=arguments,o=this,g=e,n){if(void 0===s)return function(e){return l=e,s=setTimeout(h,t),c?u(e):a}(g);if(I)return s=setTimeout(h,t),u(g)}return void 0===s&&(s=setTimeout(h,t)),a}return t=M(t)||0,N(n)&&(c=!!n.leading,r=(I="maxWait"in n)?H(M(n.maxWait)||0,t):r,C="trailing"in n?!!n.trailing:C),p.cancel=function(){void 0!==s&&clearTimeout(s),l=0,i=g=o=s=void 0},p.flush=function(){return void 0===s?a:A(K())},p},k=function(){};function z(e){e&&e.forEach((function(e){var t=Array.prototype.slice.call(e.addedNodes),n=Array.prototype.slice.call(e.removedNodes);if(function e(t){var n=void 0,i=void 0;for(n=0;n<t.length;n+=1){if((i=t[n]).dataset&&i.dataset.aos)return!0;if(i.children&&e(i.children))return!0}return!1}(t.concat(n)))return k()}))}function L(){return window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver}var T={isSupported:function(){return!!L()},ready:function(e,t){var n=window.document,i=new(L())(z);k=t,i.observe(n.documentElement,{childList:!0,subtree:!0,removedNodes:!0})}},E=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},J=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),U=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},D=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i,P=/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i,Q=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i,_=/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i;function j(){return navigator.userAgent||navigator.vendor||window.opera||""}var O=new(function(){function e(){E(this,e)}return J(e,[{key:"phone",value:function(){var e=j();return!(!D.test(e)&&!P.test(e.substr(0,4)))}},{key:"mobile",value:function(){var e=j();return!(!Q.test(e)&&!_.test(e.substr(0,4)))}},{key:"tablet",value:function(){return this.mobile()&&!this.phone()}},{key:"ie11",value:function(){return"-ms-scroll-limit"in document.documentElement.style&&"-ms-ime-align"in document.documentElement.style}}]),e}()),q=function(e,t){var n=void 0;return O.ie11()?(n=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,{detail:t}):n=new CustomEvent(e,{detail:t}),document.dispatchEvent(n)},$=function(e){return e.forEach((function(e,t){return function(e,t){var n=e.options,i=e.position,o=e.node,r=(e.data,function(){e.animated&&(function(e,t){t&&t.forEach((function(t){return e.classList.remove(t)}))}(o,n.animatedClassNames),q("aos:out",o),e.options.id&&q("aos:in:"+e.options.id,o),e.animated=!1)});n.mirror&&t>=i.out&&!n.once?r():t>=i.in?e.animated||(function(e,t){t&&t.forEach((function(t){return e.classList.add(t)}))}(o,n.animatedClassNames),q("aos:in",o),e.options.id&&q("aos:in:"+e.options.id,o),e.animated=!0):e.animated&&!n.once&&r()}(e,window.pageYOffset)}))},ee=function(e){for(var t=0,n=0;e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop);)t+=e.offsetLeft-("BODY"!=e.tagName?e.scrollLeft:0),n+=e.offsetTop-("BODY"!=e.tagName?e.scrollTop:0),e=e.offsetParent;return{top:n,left:t}},te=function(e,t,n){var i=e.getAttribute("data-aos-"+t);if(void 0!==i){if("true"===i)return!0;if("false"===i)return!1}return i||n},ne=function(e,t){return e.forEach((function(e,n){var i=te(e.node,"mirror",t.mirror),o=te(e.node,"once",t.once),r=te(e.node,"id"),a=t.useClassNames&&e.node.getAttribute("data-aos"),s=[t.animatedClassName].concat(a?a.split(" "):[]).filter((function(e){return"string"==typeof e}));t.initClassName&&e.node.classList.add(t.initClassName),e.position={in:function(e,t,n){var i=window.innerHeight,o=te(e,"anchor"),r=te(e,"anchor-placement"),a=Number(te(e,"offset",r?0:t)),s=r||n,g=e;o&&document.querySelectorAll(o)&&(g=document.querySelectorAll(o)[0]);var l=ee(g).top-i;switch(s){case"top-bottom":break;case"center-bottom":l+=g.offsetHeight/2;break;case"bottom-bottom":l+=g.offsetHeight;break;case"top-center":l+=i/2;break;case"center-center":l+=i/2+g.offsetHeight/2;break;case"bottom-center":l+=i/2+g.offsetHeight;break;case"top-top":l+=i;break;case"bottom-top":l+=i+g.offsetHeight;break;case"center-top":l+=i+g.offsetHeight/2}return l+a}(e.node,t.offset,t.anchorPlacement),out:i&&function(e,t){window.innerHeight;var n=te(e,"anchor"),i=te(e,"offset",t),o=e;return n&&document.querySelectorAll(n)&&(o=document.querySelectorAll(n)[0]),ee(o).top+o.offsetHeight-i}(e.node,t.offset)},e.options={once:o,mirror:i,animatedClassNames:s,id:r}})),e},ie=function(){var e=document.querySelectorAll("[data-aos]");return Array.prototype.map.call(e,(function(e){return{node:e}}))},oe=[],re=!1,ae={offset:120,delay:0,easing:"ease",duration:400,disable:!1,once:!1,mirror:!1,anchorPlacement:"top-bottom",startEvent:"DOMContentLoaded",animatedClassName:"aos-animate",initClassName:"aos-init",useClassNames:!1,disableMutationObserver:!1,throttleDelay:99,debounceDelay:50},se=function(){return document.all&&!window.atob},ge=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&(re=!0),re&&(oe=ne(oe,ae),$(oe),window.addEventListener("scroll",f((function(){$(oe,ae.once)}),ae.throttleDelay)))},le=function(){if(oe=ie(),Ie(ae.disable)||se())return ce();ge()},ce=function(){oe.forEach((function(e,t){e.node.removeAttribute("data-aos"),e.node.removeAttribute("data-aos-easing"),e.node.removeAttribute("data-aos-duration"),e.node.removeAttribute("data-aos-delay"),ae.initClassName&&e.node.classList.remove(ae.initClassName),ae.animatedClassName&&e.node.classList.remove(ae.animatedClassName)}))},Ie=function(e){return!0===e||"mobile"===e&&O.mobile()||"phone"===e&&O.phone()||"tablet"===e&&O.tablet()||"function"==typeof e&&!0===e()};return{init:function(e){return ae=U(ae,e),oe=ie(),ae.disableMutationObserver||T.isSupported()||(console.info('\n      aos: MutationObserver is not supported on this browser,\n      code mutations observing has been disabled.\n      You may have to call "refreshHard()" by yourself.\n    '),ae.disableMutationObserver=!0),ae.disableMutationObserver||T.ready("[data-aos]",le),Ie(ae.disable)||se()?ce():(document.querySelector("body").setAttribute("data-aos-easing",ae.easing),document.querySelector("body").setAttribute("data-aos-duration",ae.duration),document.querySelector("body").setAttribute("data-aos-delay",ae.delay),-1===["DOMContentLoaded","load"].indexOf(ae.startEvent)?document.addEventListener(ae.startEvent,(function(){ge(!0)})):window.addEventListener("load",(function(){ge(!0)})),"DOMContentLoaded"===ae.startEvent&&["complete","interactive"].indexOf(document.readyState)>-1&&ge(!0),window.addEventListener("resize",F(ge,ae.debounceDelay,!0)),window.addEventListener("orientationchange",F(ge,ae.debounceDelay,!0)),oe)},refresh:ge,refreshHard:le}}()},4695:e=>{function t(e,t,n){var i,o,r,a,s;function g(){var l=Date.now()-a;l<t&&l>=0?i=setTimeout(g,t-l):(i=null,n||(s=e.apply(r,o),r=o=null))}null==t&&(t=100);var l=function(){r=this,o=arguments,a=Date.now();var l=n&&!i;return i||(i=setTimeout(g,t)),l&&(s=e.apply(r,o),r=o=null),s};return l.clear=function(){i&&(clearTimeout(i),i=null)},l.flush=function(){i&&(s=e.apply(r,o),r=o=null,clearTimeout(i),i=null)},l}t.debounce=t,e.exports=t},7284:e=>{"use strict";var t,n="object"===typeof Reflect?Reflect:null,i=n&&"function"===typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"===typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!==e};function r(){r.init.call(this)}e.exports=r,e.exports.once=function(e,t){return new Promise((function(n,i){function o(n){e.removeListener(t,r),i(n)}function r(){"function"===typeof e.removeListener&&e.removeListener("error",o),n([].slice.call(arguments))}h(e,t,r,{once:!0}),"error"!==t&&function(e,t,n){"function"===typeof e.on&&h(e,"error",t,n)}(e,o,{once:!0})}))},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var a=10;function s(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function g(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function l(e,t,n,i){var o,r,a;if(s(n),void 0===(r=e._events)?(r=e._events=Object.create(null),e._eventsCount=0):(void 0!==r.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),r=e._events),a=r[t]),void 0===a)a=r[t]=n,++e._eventsCount;else if("function"===typeof a?a=r[t]=i?[n,a]:[a,n]:i?a.unshift(n):a.push(n),(o=g(e))>0&&a.length>o&&!a.warned){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,function(e){console&&console.warn&&console.warn(e)}(l)}return e}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function I(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=c.bind(i);return o.listener=n,i.wrapFn=o,o}function C(e,t,n){var i=e._events;if(void 0===i)return[];var o=i[t];return void 0===o?[]:"function"===typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(o):d(o,o.length)}function u(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function d(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function h(e,t,n,i){if("function"===typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!==typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function o(r){i.once&&e.removeEventListener(t,o),n(r)}))}}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!==typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),r.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return g(this)},r.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var o="error"===e,r=this._events;if(void 0!==r)o=o&&void 0===r.error;else if(!o)return!1;if(o){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var g=r[e];if(void 0===g)return!1;if("function"===typeof g)i(g,this,t);else{var l=g.length,c=d(g,l);for(n=0;n<l;++n)i(c[n],this,t)}return!0},r.prototype.addListener=function(e,t){return l(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return l(this,e,t,!0)},r.prototype.once=function(e,t){return s(t),this.on(e,I(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,I(this,e,t)),this},r.prototype.removeListener=function(e,t){var n,i,o,r,a;if(s(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!==typeof n){for(o=-1,r=n.length-1;r>=0;r--)if(n[r]===t||n[r].listener===t){a=n[r].listener,o=r;break}if(o<0)return this;0===o?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,o),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,a||t)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var o,r=Object.keys(n);for(i=0;i<r.length;++i)"removeListener"!==(o=r[i])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},r.prototype.listeners=function(e){return C(this,e,!0)},r.prototype.rawListeners=function(e){return C(this,e,!1)},r.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):u.call(e,t)},r.prototype.listenerCount=u,r.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},122:e=>{"use strict";e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var i,o,r;if(Array.isArray(t)){if((i=t.length)!=n.length)return!1;for(o=i;0!==o--;)if(!e(t[o],n[o]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((i=(r=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(o=i;0!==o--;)if(!Object.prototype.hasOwnProperty.call(n,r[o]))return!1;for(o=i;0!==o--;){var a=r[o];if(!e(t[a],n[a]))return!1}return!0}return t!==t&&n!==n}},219:(e,t,n)=>{"use strict";var i=n(3763),o={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},r={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function g(e){return i.isMemo(e)?a:s[e.$$typeof]||o}s[i.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s[i.Memo]=a;var l=Object.defineProperty,c=Object.getOwnPropertyNames,I=Object.getOwnPropertySymbols,C=Object.getOwnPropertyDescriptor,u=Object.getPrototypeOf,d=Object.prototype;e.exports=function e(t,n,i){if("string"!==typeof n){if(d){var o=u(n);o&&o!==d&&e(t,o,i)}var a=c(n);I&&(a=a.concat(I(n)));for(var s=g(t),h=g(n),A=0;A<a.length;++A){var p=a[A];if(!r[p]&&(!i||!i[p])&&(!h||!h[p])&&(!s||!s[p])){var m=C(n,p);try{l(t,p,m)}catch(b){}}}}return t}},4983:(e,t)=>{"use strict";var n="function"===typeof Symbol&&Symbol.for,i=n?Symbol.for("react.element"):60103,o=n?Symbol.for("react.portal"):60106,r=n?Symbol.for("react.fragment"):60107,a=n?Symbol.for("react.strict_mode"):60108,s=n?Symbol.for("react.profiler"):60114,g=n?Symbol.for("react.provider"):60109,l=n?Symbol.for("react.context"):60110,c=n?Symbol.for("react.async_mode"):60111,I=n?Symbol.for("react.concurrent_mode"):60111,C=n?Symbol.for("react.forward_ref"):60112,u=n?Symbol.for("react.suspense"):60113,d=n?Symbol.for("react.suspense_list"):60120,h=n?Symbol.for("react.memo"):60115,A=n?Symbol.for("react.lazy"):60116,p=n?Symbol.for("react.block"):60121,m=n?Symbol.for("react.fundamental"):60117,b=n?Symbol.for("react.responder"):60118,f=n?Symbol.for("react.scope"):60119;function y(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case i:switch(e=e.type){case c:case I:case r:case s:case a:case u:return e;default:switch(e=e&&e.$$typeof){case l:case C:case A:case h:case g:return e;default:return t}}case o:return t}}}function G(e){return y(e)===I}t.AsyncMode=c,t.ConcurrentMode=I,t.ContextConsumer=l,t.ContextProvider=g,t.Element=i,t.ForwardRef=C,t.Fragment=r,t.Lazy=A,t.Memo=h,t.Portal=o,t.Profiler=s,t.StrictMode=a,t.Suspense=u,t.isAsyncMode=function(e){return G(e)||y(e)===c},t.isConcurrentMode=G,t.isContextConsumer=function(e){return y(e)===l},t.isContextProvider=function(e){return y(e)===g},t.isElement=function(e){return"object"===typeof e&&null!==e&&e.$$typeof===i},t.isForwardRef=function(e){return y(e)===C},t.isFragment=function(e){return y(e)===r},t.isLazy=function(e){return y(e)===A},t.isMemo=function(e){return y(e)===h},t.isPortal=function(e){return y(e)===o},t.isProfiler=function(e){return y(e)===s},t.isStrictMode=function(e){return y(e)===a},t.isSuspense=function(e){return y(e)===u},t.isValidElementType=function(e){return"string"===typeof e||"function"===typeof e||e===r||e===I||e===s||e===a||e===u||e===d||"object"===typeof e&&null!==e&&(e.$$typeof===A||e.$$typeof===h||e.$$typeof===g||e.$$typeof===l||e.$$typeof===C||e.$$typeof===m||e.$$typeof===b||e.$$typeof===f||e.$$typeof===p)},t.typeOf=y},3763:(e,t,n)=>{"use strict";e.exports=n(4983)},2123:e=>{"use strict";var t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(e){i[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(o){return!1}}()?Object.assign:function(e,o){for(var r,a,s=function(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),g=1;g<arguments.length;g++){for(var l in r=Object(arguments[g]))n.call(r,l)&&(s[l]=r[l]);if(t){a=t(r);for(var c=0;c<a.length;c++)i.call(r,a[c])&&(s[a[c]]=r[a[c]])}}return s}},1497:(e,t,n)=>{"use strict";var i=n(3218);function o(){}function r(){}r.resetWarningCache=o,e.exports=function(){function e(e,t,n,o,r,a){if(a!==i){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:r,resetWarningCache:o};return n.PropTypes=n,n}},5173:(e,t,n)=>{e.exports=n(1497)()},3218:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},2730:(e,t,n)=>{"use strict";var i=n(5043),o=n(2123),r=n(8853);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!i)throw Error(a(227));var s=new Set,g={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(g[e]=t,e=0;e<t.length;e++)s.add(t[e])}var I=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),C=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,u=Object.prototype.hasOwnProperty,d={},h={};function A(e,t,n,i,o,r,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=r,this.removeEmptyString=a}var p={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){p[e]=new A(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];p[t]=new A(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){p[e]=new A(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){p[e]=new A(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){p[e]=new A(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){p[e]=new A(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){p[e]=new A(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){p[e]=new A(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){p[e]=new A(e,5,!1,e.toLowerCase(),null,!1,!1)}));var m=/[\-:]([a-z])/g;function b(e){return e[1].toUpperCase()}function f(e,t,n,i){var o=p.hasOwnProperty(t)?p[t]:null;(null!==o?0===o.type:!i&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1])))||(function(e,t,n,i){if(null===t||"undefined"===typeof t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,o,i)&&(n=null),i||null===o?function(e){return!!u.call(h,e)||!u.call(d,e)&&(C.test(e)?h[e]=!0:(d[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):o.mustUseProperty?e[o.propertyName]=null===n?3!==o.type&&"":n:(t=o.attributeName,i=o.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(o=o.type)||4===o&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(m,b);p[t]=new A(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(m,b);p[t]=new A(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(m,b);p[t]=new A(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){p[e]=new A(e,1,!1,e.toLowerCase(),null,!1,!1)})),p.xlinkHref=new A("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){p[e]=new A(e,1,!1,e.toLowerCase(),null,!0,!0)}));var y=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,G=60103,v=60106,B=60107,Z=60108,w=60114,W=60109,S=60110,R=60112,x=60113,V=60120,X=60115,H=60116,Y=60121,K=60128,N=60129,M=60130,F=60131;if("function"===typeof Symbol&&Symbol.for){var k=Symbol.for;G=k("react.element"),v=k("react.portal"),B=k("react.fragment"),Z=k("react.strict_mode"),w=k("react.profiler"),W=k("react.provider"),S=k("react.context"),R=k("react.forward_ref"),x=k("react.suspense"),V=k("react.suspense_list"),X=k("react.memo"),H=k("react.lazy"),Y=k("react.block"),k("react.scope"),K=k("react.opaque.id"),N=k("react.debug_trace_mode"),M=k("react.offscreen"),F=k("react.legacy_hidden")}var z,L="function"===typeof Symbol&&Symbol.iterator;function T(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=L&&e[L]||e["@@iterator"])?e:null}function E(e){if(void 0===z)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);z=t&&t[1]||""}return"\n"+z+e}var J=!1;function U(e,t){if(!e||J)return"";J=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(g){var i=g}Reflect.construct(e,[],t)}else{try{t.call()}catch(g){i=g}e.call(t.prototype)}else{try{throw Error()}catch(g){i=g}e()}}catch(g){if(g&&i&&"string"===typeof g.stack){for(var o=g.stack.split("\n"),r=i.stack.split("\n"),a=o.length-1,s=r.length-1;1<=a&&0<=s&&o[a]!==r[s];)s--;for(;1<=a&&0<=s;a--,s--)if(o[a]!==r[s]){if(1!==a||1!==s)do{if(a--,0>--s||o[a]!==r[s])return"\n"+o[a].replace(" at new "," at ")}while(1<=a&&0<=s);break}}}finally{J=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?E(e):""}function D(e){switch(e.tag){case 5:return E(e.type);case 16:return E("Lazy");case 13:return E("Suspense");case 19:return E("SuspenseList");case 0:case 2:case 15:return e=U(e.type,!1);case 11:return e=U(e.type.render,!1);case 22:return e=U(e.type._render,!1);case 1:return e=U(e.type,!0);default:return""}}function P(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case B:return"Fragment";case v:return"Portal";case w:return"Profiler";case Z:return"StrictMode";case x:return"Suspense";case V:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case S:return(e.displayName||"Context")+".Consumer";case W:return(e._context.displayName||"Context")+".Provider";case R:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case X:return P(e.type);case Y:return P(e._render);case H:t=e._payload,e=e._init;try{return P(e(t))}catch(n){}}return null}function Q(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function _(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function j(e){e._valueTracker||(e._valueTracker=function(e){var t=_(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var o=n.get,r=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(e){i=""+e,r.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function O(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=_(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function q(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function $(e,t){var n=t.checked;return o({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function ee(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=Q(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function te(e,t){null!=(t=t.checked)&&f(e,"checked",t,!1)}function ne(e,t){te(e,t);var n=Q(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?oe(e,t.type,n):t.hasOwnProperty("defaultValue")&&oe(e,t.type,Q(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function ie(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function oe(e,t,n){"number"===t&&q(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}function re(e,t){return e=o({children:void 0},t),(t=function(e){var t="";return i.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function ae(e,t,n,i){if(e=e.options,t){t={};for(var o=0;o<n.length;o++)t["$"+n[o]]=!0;for(n=0;n<e.length;n++)o=t.hasOwnProperty("$"+e[n].value),e[n].selected!==o&&(e[n].selected=o),o&&i&&(e[n].defaultSelected=!0)}else{for(n=""+Q(n),t=null,o=0;o<e.length;o++){if(e[o].value===n)return e[o].selected=!0,void(i&&(e[o].defaultSelected=!0));null!==t||e[o].disabled||(t=e[o])}null!==t&&(t.selected=!0)}}function se(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return o({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ge(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:Q(n)}}function le(e,t){var n=Q(t.value),i=Q(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function ce(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var Ie={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function Ce(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ue(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?Ce(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var de,he,Ae=(he=function(e,t){if(e.namespaceURI!==Ie.svg||"innerHTML"in e)e.innerHTML=t;else{for((de=de||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=de.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction((function(){return he(e,t)}))}:he);function pe(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var me={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},be=["Webkit","ms","Moz","O"];function fe(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||me.hasOwnProperty(e)&&me[e]?(""+t).trim():t+"px"}function ye(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),o=fe(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,o):e[n]=o}}Object.keys(me).forEach((function(e){be.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),me[t]=me[e]}))}));var Ge=o({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ve(e,t){if(t){if(Ge[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function Be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function Ze(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,We=null,Se=null;function Re(e){if(e=no(e)){if("function"!==typeof we)throw Error(a(280));var t=e.stateNode;t&&(t=oo(t),we(e.stateNode,e.type,t))}}function xe(e){We?Se?Se.push(e):Se=[e]:We=e}function Ve(){if(We){var e=We,t=Se;if(Se=We=null,Re(e),t)for(e=0;e<t.length;e++)Re(t[e])}}function Xe(e,t){return e(t)}function He(e,t,n,i,o){return e(t,n,i,o)}function Ye(){}var Ke=Xe,Ne=!1,Me=!1;function Fe(){null===We&&null===Se||(Ye(),Ve())}function ke(e,t){var n=e.stateNode;if(null===n)return null;var i=oo(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var ze=!1;if(I)try{var Le={};Object.defineProperty(Le,"passive",{get:function(){ze=!0}}),window.addEventListener("test",Le,Le),window.removeEventListener("test",Le,Le)}catch(he){ze=!1}function Te(e,t,n,i,o,r,a,s,g){var l=Array.prototype.slice.call(arguments,3);try{t.apply(n,l)}catch(c){this.onError(c)}}var Ee=!1,Je=null,Ue=!1,De=null,Pe={onError:function(e){Ee=!0,Je=e}};function Qe(e,t,n,i,o,r,a,s,g){Ee=!1,Je=null,Te.apply(Pe,arguments)}function _e(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(1026&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function je(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Oe(e){if(_e(e)!==e)throw Error(a(188))}function qe(e){if(e=function(e){var t=e.alternate;if(!t){if(null===(t=_e(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,i=t;;){var o=n.return;if(null===o)break;var r=o.alternate;if(null===r){if(null!==(i=o.return)){n=i;continue}break}if(o.child===r.child){for(r=o.child;r;){if(r===n)return Oe(o),e;if(r===i)return Oe(o),t;r=r.sibling}throw Error(a(188))}if(n.return!==i.return)n=o,i=r;else{for(var s=!1,g=o.child;g;){if(g===n){s=!0,n=o,i=r;break}if(g===i){s=!0,i=o,n=r;break}g=g.sibling}if(!s){for(g=r.child;g;){if(g===n){s=!0,n=r,i=o;break}if(g===i){s=!0,i=r,n=o;break}g=g.sibling}if(!s)throw Error(a(189))}}if(n.alternate!==i)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e),!e)return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function $e(e,t){for(var n=e.alternate;null!==t;){if(t===e||t===n)return!0;t=t.return}return!1}var et,tt,nt,it,ot=!1,rt=[],at=null,st=null,gt=null,lt=new Map,ct=new Map,It=[],Ct="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ut(e,t,n,i,o){return{blockedOn:e,domEventName:t,eventSystemFlags:16|n,nativeEvent:o,targetContainers:[i]}}function dt(e,t){switch(e){case"focusin":case"focusout":at=null;break;case"dragenter":case"dragleave":st=null;break;case"mouseover":case"mouseout":gt=null;break;case"pointerover":case"pointerout":lt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ct.delete(t.pointerId)}}function ht(e,t,n,i,o,r){return null===e||e.nativeEvent!==r?(e=ut(t,n,i,o,r),null!==t&&(null!==(t=no(t))&&tt(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==o&&-1===t.indexOf(o)&&t.push(o),e)}function At(e){var t=to(e.target);if(null!==t){var n=_e(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=je(n)))return e.blockedOn=t,void it(e.lanePriority,(function(){r.unstable_runWithPriority(e.priority,(function(){nt(n)}))}))}else if(3===t&&n.stateNode.hydrate)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function pt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=no(n))&&tt(t),e.blockedOn=n,!1;t.shift()}return!0}function mt(e,t,n){pt(e)&&n.delete(t)}function bt(){for(ot=!1;0<rt.length;){var e=rt[0];if(null!==e.blockedOn){null!==(e=no(e.blockedOn))&&et(e);break}for(var t=e.targetContainers;0<t.length;){var n=qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n){e.blockedOn=n;break}t.shift()}null===e.blockedOn&&rt.shift()}null!==at&&pt(at)&&(at=null),null!==st&&pt(st)&&(st=null),null!==gt&&pt(gt)&&(gt=null),lt.forEach(mt),ct.forEach(mt)}function ft(e,t){e.blockedOn===t&&(e.blockedOn=null,ot||(ot=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,bt)))}function yt(e){function t(t){return ft(t,e)}if(0<rt.length){ft(rt[0],e);for(var n=1;n<rt.length;n++){var i=rt[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==at&&ft(at,e),null!==st&&ft(st,e),null!==gt&&ft(gt,e),lt.forEach(t),ct.forEach(t),n=0;n<It.length;n++)(i=It[n]).blockedOn===e&&(i.blockedOn=null);for(;0<It.length&&null===(n=It[0]).blockedOn;)At(n),null===n.blockedOn&&It.shift()}function Gt(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var vt={animationend:Gt("Animation","AnimationEnd"),animationiteration:Gt("Animation","AnimationIteration"),animationstart:Gt("Animation","AnimationStart"),transitionend:Gt("Transition","TransitionEnd")},Bt={},Zt={};function wt(e){if(Bt[e])return Bt[e];if(!vt[e])return e;var t,n=vt[e];for(t in n)if(n.hasOwnProperty(t)&&t in Zt)return Bt[e]=n[t];return e}I&&(Zt=document.createElement("div").style,"AnimationEvent"in window||(delete vt.animationend.animation,delete vt.animationiteration.animation,delete vt.animationstart.animation),"TransitionEvent"in window||delete vt.transitionend.transition);var Wt=wt("animationend"),St=wt("animationiteration"),Rt=wt("animationstart"),xt=wt("transitionend"),Vt=new Map,Xt=new Map,Ht=["abort","abort",Wt,"animationEnd",St,"animationIteration",Rt,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",xt,"transitionEnd","waiting","waiting"];function Yt(e,t){for(var n=0;n<e.length;n+=2){var i=e[n],o=e[n+1];o="on"+(o[0].toUpperCase()+o.slice(1)),Xt.set(i,t),Vt.set(i,o),l(o,[i])}}(0,r.unstable_now)();var Kt=8;function Nt(e){if(0!==(1&e))return Kt=15,1;if(0!==(2&e))return Kt=14,2;if(0!==(4&e))return Kt=13,4;var t=24&e;return 0!==t?(Kt=12,t):0!==(32&e)?(Kt=11,32):0!==(t=192&e)?(Kt=10,t):0!==(256&e)?(Kt=9,256):0!==(t=3584&e)?(Kt=8,t):0!==(4096&e)?(Kt=7,4096):0!==(t=4186112&e)?(Kt=6,t):0!==(t=62914560&e)?(Kt=5,t):67108864&e?(Kt=4,67108864):0!==(134217728&e)?(Kt=3,134217728):0!==(t=805306368&e)?(Kt=2,t):0!==(1073741824&e)?(Kt=1,1073741824):(Kt=8,e)}function Mt(e,t){var n=e.pendingLanes;if(0===n)return Kt=0;var i=0,o=0,r=e.expiredLanes,a=e.suspendedLanes,s=e.pingedLanes;if(0!==r)i=r,o=Kt=15;else if(0!==(r=134217727&n)){var g=r&~a;0!==g?(i=Nt(g),o=Kt):0!==(s&=r)&&(i=Nt(s),o=Kt)}else 0!==(r=n&~a)?(i=Nt(r),o=Kt):0!==s&&(i=Nt(s),o=Kt);if(0===i)return 0;if(i=n&((0>(i=31-Et(i))?0:1<<i)<<1)-1,0!==t&&t!==i&&0===(t&a)){if(Nt(t),o<=Kt)return t;Kt=o}if(0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)o=1<<(n=31-Et(t)),i|=e[n],t&=~o;return i}function Ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function kt(e,t){switch(e){case 15:return 1;case 14:return 2;case 12:return 0===(e=zt(24&~t))?kt(10,t):e;case 10:return 0===(e=zt(192&~t))?kt(8,t):e;case 8:return 0===(e=zt(3584&~t))&&(0===(e=zt(4186112&~t))&&(e=512)),e;case 2:return 0===(t=zt(805306368&~t))&&(t=268435456),t}throw Error(a(358,e))}function zt(e){return e&-e}function Lt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Tt(e,t,n){e.pendingLanes|=t;var i=t-1;e.suspendedLanes&=i,e.pingedLanes&=i,(e=e.eventTimes)[t=31-Et(t)]=n}var Et=Math.clz32?Math.clz32:function(e){return 0===e?32:31-(Jt(e)/Ut|0)|0},Jt=Math.log,Ut=Math.LN2;var Dt=r.unstable_UserBlockingPriority,Pt=r.unstable_runWithPriority,Qt=!0;function _t(e,t,n,i){Ne||Ye();var o=Ot,r=Ne;Ne=!0;try{He(o,e,t,n,i)}finally{(Ne=r)||Fe()}}function jt(e,t,n,i){Pt(Dt,Ot.bind(null,e,t,n,i))}function Ot(e,t,n,i){var o;if(Qt)if((o=0===(4&t))&&0<rt.length&&-1<Ct.indexOf(e))e=ut(null,e,t,n,i),rt.push(e);else{var r=qt(e,t,n,i);if(null===r)o&&dt(e,i);else{if(o){if(-1<Ct.indexOf(e))return e=ut(r,e,t,n,i),void rt.push(e);if(function(e,t,n,i,o){switch(t){case"focusin":return at=ht(at,e,t,n,i,o),!0;case"dragenter":return st=ht(st,e,t,n,i,o),!0;case"mouseover":return gt=ht(gt,e,t,n,i,o),!0;case"pointerover":var r=o.pointerId;return lt.set(r,ht(lt.get(r)||null,e,t,n,i,o)),!0;case"gotpointercapture":return r=o.pointerId,ct.set(r,ht(ct.get(r)||null,e,t,n,i,o)),!0}return!1}(r,e,t,n,i))return;dt(e,i)}Yi(e,t,i,null,n)}}}function qt(e,t,n,i){var o=Ze(i);if(null!==(o=to(o))){var r=_e(o);if(null===r)o=null;else{var a=r.tag;if(13===a){if(null!==(o=je(r)))return o;o=null}else if(3===a){if(r.stateNode.hydrate)return 3===r.tag?r.stateNode.containerInfo:null;o=null}else r!==o&&(o=null)}}return Yi(e,t,i,o,n),null}var $t=null,en=null,tn=null;function nn(){if(tn)return tn;var e,t,n=en,i=n.length,o="value"in $t?$t.value:$t.textContent,r=o.length;for(e=0;e<i&&n[e]===o[e];e++);var a=i-e;for(t=1;t<=a&&n[i-t]===o[r-t];t++);return tn=o.slice(e,1<t?1-t:void 0)}function on(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function rn(){return!0}function an(){return!1}function sn(e){function t(t,n,i,o,r){for(var a in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=o,this.target=r,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(o):o[a]);return this.isDefaultPrevented=(null!=o.defaultPrevented?o.defaultPrevented:!1===o.returnValue)?rn:an,this.isPropagationStopped=an,this}return o(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=rn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=rn)},persist:function(){},isPersistent:rn}),t}var gn,ln,cn,In={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Cn=sn(In),un=o({},In,{view:0,detail:0}),dn=sn(un),hn=o({},un,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Wn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==cn&&(cn&&"mousemove"===e.type?(gn=e.screenX-cn.screenX,ln=e.screenY-cn.screenY):ln=gn=0,cn=e),gn)},movementY:function(e){return"movementY"in e?e.movementY:ln}}),An=sn(hn),pn=sn(o({},hn,{dataTransfer:0})),mn=sn(o({},un,{relatedTarget:0})),bn=sn(o({},In,{animationName:0,elapsedTime:0,pseudoElement:0})),fn=o({},In,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),yn=sn(fn),Gn=sn(o({},In,{data:0})),vn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Bn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Zn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Zn[e])&&!!t[e]}function Wn(){return wn}var Sn=o({},un,{key:function(e){if(e.key){var t=vn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=on(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Bn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Wn,charCode:function(e){return"keypress"===e.type?on(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?on(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Rn=sn(Sn),xn=sn(o({},hn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Vn=sn(o({},un,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Wn})),Xn=sn(o({},In,{propertyName:0,elapsedTime:0,pseudoElement:0})),Hn=o({},hn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Yn=sn(Hn),Kn=[9,13,27,32],Nn=I&&"CompositionEvent"in window,Mn=null;I&&"documentMode"in document&&(Mn=document.documentMode);var Fn=I&&"TextEvent"in window&&!Mn,kn=I&&(!Nn||Mn&&8<Mn&&11>=Mn),zn=String.fromCharCode(32),Ln=!1;function Tn(e,t){switch(e){case"keyup":return-1!==Kn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function En(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Jn=!1;var Un={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Dn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Un[e.type]:"textarea"===t}function Pn(e,t,n,i){xe(i),0<(t=Ni(t,"onChange")).length&&(n=new Cn("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Qn=null,_n=null;function jn(e){Si(e,0)}function On(e){if(O(io(e)))return e}function qn(e,t){if("change"===e)return t}var $n=!1;if(I){var ei;if(I){var ti="oninput"in document;if(!ti){var ni=document.createElement("div");ni.setAttribute("oninput","return;"),ti="function"===typeof ni.oninput}ei=ti}else ei=!1;$n=ei&&(!document.documentMode||9<document.documentMode)}function ii(){Qn&&(Qn.detachEvent("onpropertychange",oi),_n=Qn=null)}function oi(e){if("value"===e.propertyName&&On(_n)){var t=[];if(Pn(t,_n,e,Ze(e)),e=jn,Ne)e(t);else{Ne=!0;try{Xe(e,t)}finally{Ne=!1,Fe()}}}}function ri(e,t,n){"focusin"===e?(ii(),_n=n,(Qn=t).attachEvent("onpropertychange",oi)):"focusout"===e&&ii()}function ai(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return On(_n)}function si(e,t){if("click"===e)return On(t)}function gi(e,t){if("input"===e||"change"===e)return On(t)}var li="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},ci=Object.prototype.hasOwnProperty;function Ii(e,t){if(li(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++)if(!ci.call(t,n[i])||!li(e[n[i]],t[n[i]]))return!1;return!0}function Ci(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ui(e,t){var n,i=Ci(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=Ci(i)}}function di(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?di(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hi(){for(var e=window,t=q();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=q((e=t.contentWindow).document)}return t}function Ai(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var pi=I&&"documentMode"in document&&11>=document.documentMode,mi=null,bi=null,fi=null,yi=!1;function Gi(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;yi||null==mi||mi!==q(i)||("selectionStart"in(i=mi)&&Ai(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},fi&&Ii(fi,i)||(fi=i,0<(i=Ni(bi,"onSelect")).length&&(t=new Cn("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=mi)))}Yt("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Yt("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Yt(Ht,2);for(var vi="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),Bi=0;Bi<vi.length;Bi++)Xt.set(vi[Bi],0);c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Zi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),wi=new Set("cancel close invalid load scroll toggle".split(" ").concat(Zi));function Wi(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,o,r,s,g,l){if(Qe.apply(this,arguments),Ee){if(!Ee)throw Error(a(198));var c=Je;Ee=!1,Je=null,Ue||(Ue=!0,De=c)}}(i,t,void 0,e),e.currentTarget=null}function Si(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],o=i.event;i=i.listeners;e:{var r=void 0;if(t)for(var a=i.length-1;0<=a;a--){var s=i[a],g=s.instance,l=s.currentTarget;if(s=s.listener,g!==r&&o.isPropagationStopped())break e;Wi(o,s,l),r=g}else for(a=0;a<i.length;a++){if(g=(s=i[a]).instance,l=s.currentTarget,s=s.listener,g!==r&&o.isPropagationStopped())break e;Wi(o,s,l),r=g}}}if(Ue)throw e=De,Ue=!1,De=null,e}function Ri(e,t){var n=ro(t),i=e+"__bubble";n.has(i)||(Hi(t,e,2,!1),n.add(i))}var xi="_reactListening"+Math.random().toString(36).slice(2);function Vi(e){e[xi]||(e[xi]=!0,s.forEach((function(t){wi.has(t)||Xi(t,!1,e,null),Xi(t,!0,e,null)})))}function Xi(e,t,n,i){var o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,r=n;if("selectionchange"===e&&9!==n.nodeType&&(r=n.ownerDocument),null!==i&&!t&&wi.has(e)){if("scroll"!==e)return;o|=2,r=i}var a=ro(r),s=e+"__"+(t?"capture":"bubble");a.has(s)||(t&&(o|=4),Hi(r,e,o,t),a.add(s))}function Hi(e,t,n,i){var o=Xt.get(t);switch(void 0===o?2:o){case 0:o=_t;break;case 1:o=jt;break;default:o=Ot}n=o.bind(null,t,n,e),o=void 0,!ze||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(o=!0),i?void 0!==o?e.addEventListener(t,n,{capture:!0,passive:o}):e.addEventListener(t,n,!0):void 0!==o?e.addEventListener(t,n,{passive:o}):e.addEventListener(t,n,!1)}function Yi(e,t,n,i,o){var r=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var a=i.tag;if(3===a||4===a){var s=i.stateNode.containerInfo;if(s===o||8===s.nodeType&&s.parentNode===o)break;if(4===a)for(a=i.return;null!==a;){var g=a.tag;if((3===g||4===g)&&((g=a.stateNode.containerInfo)===o||8===g.nodeType&&g.parentNode===o))return;a=a.return}for(;null!==s;){if(null===(a=to(s)))return;if(5===(g=a.tag)||6===g){i=r=a;continue e}s=s.parentNode}}i=i.return}!function(e,t,n){if(Me)return e(t,n);Me=!0;try{return Ke(e,t,n)}finally{Me=!1,Fe()}}((function(){var i=r,o=Ze(n),a=[];e:{var s=Vt.get(e);if(void 0!==s){var g=Cn,l=e;switch(e){case"keypress":if(0===on(n))break e;case"keydown":case"keyup":g=Rn;break;case"focusin":l="focus",g=mn;break;case"focusout":l="blur",g=mn;break;case"beforeblur":case"afterblur":g=mn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":g=An;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":g=pn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":g=Vn;break;case Wt:case St:case Rt:g=bn;break;case xt:g=Xn;break;case"scroll":g=dn;break;case"wheel":g=Yn;break;case"copy":case"cut":case"paste":g=yn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":g=xn}var c=0!==(4&t),I=!c&&"scroll"===e,C=c?null!==s?s+"Capture":null:s;c=[];for(var u,d=i;null!==d;){var h=(u=d).stateNode;if(5===u.tag&&null!==h&&(u=h,null!==C&&(null!=(h=ke(d,C))&&c.push(Ki(d,h,u)))),I)break;d=d.return}0<c.length&&(s=new g(s,l,null,n,o),a.push({event:s,listeners:c}))}}if(0===(7&t)){if(g="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||0!==(16&t)||!(l=n.relatedTarget||n.fromElement)||!to(l)&&!l[$i])&&(g||s)&&(s=o.window===o?o:(s=o.ownerDocument)?s.defaultView||s.parentWindow:window,g?(g=i,null!==(l=(l=n.relatedTarget||n.toElement)?to(l):null)&&(l!==(I=_e(l))||5!==l.tag&&6!==l.tag)&&(l=null)):(g=null,l=i),g!==l)){if(c=An,h="onMouseLeave",C="onMouseEnter",d="mouse","pointerout"!==e&&"pointerover"!==e||(c=xn,h="onPointerLeave",C="onPointerEnter",d="pointer"),I=null==g?s:io(g),u=null==l?s:io(l),(s=new c(h,d+"leave",g,n,o)).target=I,s.relatedTarget=u,h=null,to(o)===i&&((c=new c(C,d+"enter",l,n,o)).target=u,c.relatedTarget=I,h=c),I=h,g&&l)e:{for(C=l,d=0,u=c=g;u;u=Mi(u))d++;for(u=0,h=C;h;h=Mi(h))u++;for(;0<d-u;)c=Mi(c),d--;for(;0<u-d;)C=Mi(C),u--;for(;d--;){if(c===C||null!==C&&c===C.alternate)break e;c=Mi(c),C=Mi(C)}c=null}else c=null;null!==g&&Fi(a,s,g,c,!1),null!==l&&null!==I&&Fi(a,I,l,c,!0)}if("select"===(g=(s=i?io(i):window).nodeName&&s.nodeName.toLowerCase())||"input"===g&&"file"===s.type)var A=qn;else if(Dn(s))if($n)A=gi;else{A=ai;var p=ri}else(g=s.nodeName)&&"input"===g.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(A=si);switch(A&&(A=A(e,i))?Pn(a,A,n,o):(p&&p(e,s,i),"focusout"===e&&(p=s._wrapperState)&&p.controlled&&"number"===s.type&&oe(s,"number",s.value)),p=i?io(i):window,e){case"focusin":(Dn(p)||"true"===p.contentEditable)&&(mi=p,bi=i,fi=null);break;case"focusout":fi=bi=mi=null;break;case"mousedown":yi=!0;break;case"contextmenu":case"mouseup":case"dragend":yi=!1,Gi(a,n,o);break;case"selectionchange":if(pi)break;case"keydown":case"keyup":Gi(a,n,o)}var m;if(Nn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Jn?Tn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(kn&&"ko"!==n.locale&&(Jn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Jn&&(m=nn()):(en="value"in($t=o)?$t.value:$t.textContent,Jn=!0)),0<(p=Ni(i,b)).length&&(b=new Gn(b,e,null,n,o),a.push({event:b,listeners:p}),m?b.data=m:null!==(m=En(n))&&(b.data=m))),(m=Fn?function(e,t){switch(e){case"compositionend":return En(t);case"keypress":return 32!==t.which?null:(Ln=!0,zn);case"textInput":return(e=t.data)===zn&&Ln?null:e;default:return null}}(e,n):function(e,t){if(Jn)return"compositionend"===e||!Nn&&Tn(e,t)?(e=nn(),tn=en=$t=null,Jn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return kn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=Ni(i,"onBeforeInput")).length&&(o=new Gn("onBeforeInput","beforeinput",null,n,o),a.push({event:o,listeners:i}),o.data=m))}Si(a,t)}))}function Ki(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Ni(e,t){for(var n=t+"Capture",i=[];null!==e;){var o=e,r=o.stateNode;5===o.tag&&null!==r&&(o=r,null!=(r=ke(e,n))&&i.unshift(Ki(e,r,o)),null!=(r=ke(e,t))&&i.push(Ki(e,r,o))),e=e.return}return i}function Mi(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Fi(e,t,n,i,o){for(var r=t._reactName,a=[];null!==n&&n!==i;){var s=n,g=s.alternate,l=s.stateNode;if(null!==g&&g===i)break;5===s.tag&&null!==l&&(s=l,o?null!=(g=ke(n,r))&&a.unshift(Ki(n,g,s)):o||null!=(g=ke(n,r))&&a.push(Ki(n,g,s))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}function ki(){}var zi=null,Li=null;function Ti(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function Ei(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Ji="function"===typeof setTimeout?setTimeout:void 0,Ui="function"===typeof clearTimeout?clearTimeout:void 0;function Di(e){1===e.nodeType?e.textContent="":9===e.nodeType&&(null!=(e=e.body)&&(e.textContent=""))}function Pi(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function Qi(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var _i=0;var ji=Math.random().toString(36).slice(2),Oi="__reactFiber$"+ji,qi="__reactProps$"+ji,$i="__reactContainer$"+ji,eo="__reactEvents$"+ji;function to(e){var t=e[Oi];if(t)return t;for(var n=e.parentNode;n;){if(t=n[$i]||n[Oi]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=Qi(e);null!==e;){if(n=e[Oi])return n;e=Qi(e)}return t}n=(e=n).parentNode}return null}function no(e){return!(e=e[Oi]||e[$i])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function io(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function oo(e){return e[qi]||null}function ro(e){var t=e[eo];return void 0===t&&(t=e[eo]=new Set),t}var ao=[],so=-1;function go(e){return{current:e}}function lo(e){0>so||(e.current=ao[so],ao[so]=null,so--)}function co(e,t){so++,ao[so]=e.current,e.current=t}var Io={},Co=go(Io),uo=go(!1),ho=Io;function Ao(e,t){var n=e.type.contextTypes;if(!n)return Io;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var o,r={};for(o in n)r[o]=t[o];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=r),r}function po(e){return null!==(e=e.childContextTypes)&&void 0!==e}function mo(){lo(uo),lo(Co)}function bo(e,t,n){if(Co.current!==Io)throw Error(a(168));co(Co,t),co(uo,n)}function fo(e,t,n){var i=e.stateNode;if(e=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in e))throw Error(a(108,P(t)||"Unknown",r));return o({},n,i)}function yo(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Io,ho=Co.current,co(Co,e),co(uo,uo.current),!0}function Go(e,t,n){var i=e.stateNode;if(!i)throw Error(a(169));n?(e=fo(e,t,ho),i.__reactInternalMemoizedMergedChildContext=e,lo(uo),lo(Co),co(Co,e)):lo(uo),co(uo,n)}var vo=null,Bo=null,Zo=r.unstable_runWithPriority,wo=r.unstable_scheduleCallback,Wo=r.unstable_cancelCallback,So=r.unstable_shouldYield,Ro=r.unstable_requestPaint,xo=r.unstable_now,Vo=r.unstable_getCurrentPriorityLevel,Xo=r.unstable_ImmediatePriority,Ho=r.unstable_UserBlockingPriority,Yo=r.unstable_NormalPriority,Ko=r.unstable_LowPriority,No=r.unstable_IdlePriority,Mo={},Fo=void 0!==Ro?Ro:function(){},ko=null,zo=null,Lo=!1,To=xo(),Eo=1e4>To?xo:function(){return xo()-To};function Jo(){switch(Vo()){case Xo:return 99;case Ho:return 98;case Yo:return 97;case Ko:return 96;case No:return 95;default:throw Error(a(332))}}function Uo(e){switch(e){case 99:return Xo;case 98:return Ho;case 97:return Yo;case 96:return Ko;case 95:return No;default:throw Error(a(332))}}function Do(e,t){return e=Uo(e),Zo(e,t)}function Po(e,t,n){return e=Uo(e),wo(e,t,n)}function Qo(){if(null!==zo){var e=zo;zo=null,Wo(e)}_o()}function _o(){if(!Lo&&null!==ko){Lo=!0;var e=0;try{var t=ko;Do(99,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}})),ko=null}catch(n){throw null!==ko&&(ko=ko.slice(e+1)),wo(Xo,Qo),n}finally{Lo=!1}}}var jo=y.ReactCurrentBatchConfig;function Oo(e,t){if(e&&e.defaultProps){for(var n in t=o({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var qo=go(null),$o=null,er=null,tr=null;function nr(){tr=er=$o=null}function ir(e){var t=qo.current;lo(qo),e.type._context._currentValue=t}function or(e,t){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)===t){if(null===n||(n.childLanes&t)===t)break;n.childLanes|=t}else e.childLanes|=t,null!==n&&(n.childLanes|=t);e=e.return}}function rr(e,t){$o=e,tr=er=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Na=!0),e.firstContext=null)}function ar(e,t){if(tr!==e&&!1!==t&&0!==t)if("number"===typeof t&&1073741823!==t||(tr=e,t=1073741823),t={context:e,observedBits:t,next:null},null===er){if(null===$o)throw Error(a(308));er=t,$o.dependencies={lanes:0,firstContext:t,responders:null}}else er=er.next=t;return e._currentValue}var sr=!1;function gr(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function lr(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function cr(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ir(e,t){if(null!==(e=e.updateQueue)){var n=(e=e.shared).pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function Cr(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var o=null,r=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===r?o=r=a:r=r.next=a,n=n.next}while(null!==n);null===r?o=r=t:r=r.next=t}else o=r=t;return n={baseState:i.baseState,firstBaseUpdate:o,lastBaseUpdate:r,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function ur(e,t,n,i){var r=e.updateQueue;sr=!1;var a=r.firstBaseUpdate,s=r.lastBaseUpdate,g=r.shared.pending;if(null!==g){r.shared.pending=null;var l=g,c=l.next;l.next=null,null===s?a=c:s.next=c,s=l;var I=e.alternate;if(null!==I){var C=(I=I.updateQueue).lastBaseUpdate;C!==s&&(null===C?I.firstBaseUpdate=c:C.next=c,I.lastBaseUpdate=l)}}if(null!==a){for(C=r.baseState,s=0,I=c=l=null;;){g=a.lane;var u=a.eventTime;if((i&g)===g){null!==I&&(I=I.next={eventTime:u,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var d=e,h=a;switch(g=t,u=n,h.tag){case 1:if("function"===typeof(d=h.payload)){C=d.call(u,C,g);break e}C=d;break e;case 3:d.flags=-4097&d.flags|64;case 0:if(null===(g="function"===typeof(d=h.payload)?d.call(u,C,g):d)||void 0===g)break e;C=o({},C,g);break e;case 2:sr=!0}}null!==a.callback&&(e.flags|=32,null===(g=r.effects)?r.effects=[a]:g.push(a))}else u={eventTime:u,lane:g,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===I?(c=I=u,l=C):I=I.next=u,s|=g;if(null===(a=a.next)){if(null===(g=r.shared.pending))break;a=g.next,g.next=null,r.lastBaseUpdate=g,r.shared.pending=null}}null===I&&(l=C),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=I,Ls|=s,e.lanes=s,e.memoizedState=C}}function dr(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],o=i.callback;if(null!==o){if(i.callback=null,i=n,"function"!==typeof o)throw Error(a(191,o));o.call(i)}}}var hr=(new i.Component).refs;function Ar(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:o({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var pr={isMounted:function(e){return!!(e=e._reactInternals)&&_e(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=Cg(),o=ug(e),r=cr(i,o);r.payload=t,void 0!==n&&null!==n&&(r.callback=n),Ir(e,r),dg(e,o,i)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=Cg(),o=ug(e),r=cr(i,o);r.tag=1,r.payload=t,void 0!==n&&null!==n&&(r.callback=n),Ir(e,r),dg(e,o,i)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Cg(),i=ug(e),o=cr(n,i);o.tag=2,void 0!==t&&null!==t&&(o.callback=t),Ir(e,o),dg(e,i,n)}};function mr(e,t,n,i,o,r,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,r,a):!t.prototype||!t.prototype.isPureReactComponent||(!Ii(n,i)||!Ii(o,r))}function br(e,t,n){var i=!1,o=Io,r=t.contextType;return"object"===typeof r&&null!==r?r=ar(r):(o=po(t)?ho:Co.current,r=(i=null!==(i=t.contextTypes)&&void 0!==i)?Ao(e,o):Io),t=new t(n,r),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=pr,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=r),t}function fr(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&pr.enqueueReplaceState(t,t.state,null)}function yr(e,t,n,i){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs=hr,gr(e);var r=t.contextType;"object"===typeof r&&null!==r?o.context=ar(r):(r=po(t)?ho:Co.current,o.context=Ao(e,r)),ur(e,n,o,i),o.state=e.memoizedState,"function"===typeof(r=t.getDerivedStateFromProps)&&(Ar(e,t,r,n),o.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof o.getSnapshotBeforeUpdate||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||(t=o.state,"function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),t!==o.state&&pr.enqueueReplaceState(o,o.state,null),ur(e,n,o,i),o.state=e.memoizedState),"function"===typeof o.componentDidMount&&(e.flags|=4)}var Gr=Array.isArray;function vr(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var i=n.stateNode}if(!i)throw Error(a(147,e));var o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=i.refs;t===hr&&(t=i.refs={}),null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function Br(e,t){if("textarea"!==e.type)throw Error(a(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t))}function Zr(e){function t(t,n){if(e){var i=t.lastEffect;null!==i?(i.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.flags=8}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function o(e,t){return(e=Dg(e,t)).index=0,e.sibling=null,e}function r(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags=2,n):i:(t.flags=2,n):n}function s(t){return e&&null===t.alternate&&(t.flags=2),t}function g(e,t,n,i){return null===t||6!==t.tag?((t=jg(n,e.mode,i)).return=e,t):((t=o(t,n)).return=e,t)}function l(e,t,n,i){return null!==t&&t.elementType===n.type?((i=o(t,n.props)).ref=vr(e,t,n),i.return=e,i):((i=Pg(n.type,n.key,n.props,null,e.mode,i)).ref=vr(e,t,n),i.return=e,i)}function c(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Og(n,e.mode,i)).return=e,t):((t=o(t,n.children||[])).return=e,t)}function I(e,t,n,i,r){return null===t||7!==t.tag?((t=Qg(n,e.mode,i,r)).return=e,t):((t=o(t,n)).return=e,t)}function C(e,t,n){if("string"===typeof t||"number"===typeof t)return(t=jg(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case G:return(n=Pg(t.type,t.key,t.props,null,e.mode,n)).ref=vr(e,null,t),n.return=e,n;case v:return(t=Og(t,e.mode,n)).return=e,t}if(Gr(t)||T(t))return(t=Qg(t,e.mode,n,null)).return=e,t;Br(e,t)}return null}function u(e,t,n,i){var o=null!==t?t.key:null;if("string"===typeof n||"number"===typeof n)return null!==o?null:g(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case G:return n.key===o?n.type===B?I(e,t,n.props.children,i,o):l(e,t,n,i):null;case v:return n.key===o?c(e,t,n,i):null}if(Gr(n)||T(n))return null!==o?null:I(e,t,n,i,null);Br(e,n)}return null}function d(e,t,n,i,o){if("string"===typeof i||"number"===typeof i)return g(t,e=e.get(n)||null,""+i,o);if("object"===typeof i&&null!==i){switch(i.$$typeof){case G:return e=e.get(null===i.key?n:i.key)||null,i.type===B?I(t,e,i.props.children,o,i.key):l(t,e,i,o);case v:return c(t,e=e.get(null===i.key?n:i.key)||null,i,o)}if(Gr(i)||T(i))return I(t,e=e.get(n)||null,i,o,null);Br(t,i)}return null}function h(o,a,s,g){for(var l=null,c=null,I=a,h=a=0,A=null;null!==I&&h<s.length;h++){I.index>h?(A=I,I=null):A=I.sibling;var p=u(o,I,s[h],g);if(null===p){null===I&&(I=A);break}e&&I&&null===p.alternate&&t(o,I),a=r(p,a,h),null===c?l=p:c.sibling=p,c=p,I=A}if(h===s.length)return n(o,I),l;if(null===I){for(;h<s.length;h++)null!==(I=C(o,s[h],g))&&(a=r(I,a,h),null===c?l=I:c.sibling=I,c=I);return l}for(I=i(o,I);h<s.length;h++)null!==(A=d(I,o,h,s[h],g))&&(e&&null!==A.alternate&&I.delete(null===A.key?h:A.key),a=r(A,a,h),null===c?l=A:c.sibling=A,c=A);return e&&I.forEach((function(e){return t(o,e)})),l}function A(o,s,g,l){var c=T(g);if("function"!==typeof c)throw Error(a(150));if(null==(g=c.call(g)))throw Error(a(151));for(var I=c=null,h=s,A=s=0,p=null,m=g.next();null!==h&&!m.done;A++,m=g.next()){h.index>A?(p=h,h=null):p=h.sibling;var b=u(o,h,m.value,l);if(null===b){null===h&&(h=p);break}e&&h&&null===b.alternate&&t(o,h),s=r(b,s,A),null===I?c=b:I.sibling=b,I=b,h=p}if(m.done)return n(o,h),c;if(null===h){for(;!m.done;A++,m=g.next())null!==(m=C(o,m.value,l))&&(s=r(m,s,A),null===I?c=m:I.sibling=m,I=m);return c}for(h=i(o,h);!m.done;A++,m=g.next())null!==(m=d(h,o,A,m.value,l))&&(e&&null!==m.alternate&&h.delete(null===m.key?A:m.key),s=r(m,s,A),null===I?c=m:I.sibling=m,I=m);return e&&h.forEach((function(e){return t(o,e)})),c}return function(e,i,r,g){var l="object"===typeof r&&null!==r&&r.type===B&&null===r.key;l&&(r=r.props.children);var c="object"===typeof r&&null!==r;if(c)switch(r.$$typeof){case G:e:{for(c=r.key,l=i;null!==l;){if(l.key===c){if(7===l.tag){if(r.type===B){n(e,l.sibling),(i=o(l,r.props.children)).return=e,e=i;break e}}else if(l.elementType===r.type){n(e,l.sibling),(i=o(l,r.props)).ref=vr(e,l,r),i.return=e,e=i;break e}n(e,l);break}t(e,l),l=l.sibling}r.type===B?((i=Qg(r.props.children,e.mode,g,r.key)).return=e,e=i):((g=Pg(r.type,r.key,r.props,null,e.mode,g)).ref=vr(e,i,r),g.return=e,e=g)}return s(e);case v:e:{for(l=r.key;null!==i;){if(i.key===l){if(4===i.tag&&i.stateNode.containerInfo===r.containerInfo&&i.stateNode.implementation===r.implementation){n(e,i.sibling),(i=o(i,r.children||[])).return=e,e=i;break e}n(e,i);break}t(e,i),i=i.sibling}(i=Og(r,e.mode,g)).return=e,e=i}return s(e)}if("string"===typeof r||"number"===typeof r)return r=""+r,null!==i&&6===i.tag?(n(e,i.sibling),(i=o(i,r)).return=e,e=i):(n(e,i),(i=jg(r,e.mode,g)).return=e,e=i),s(e);if(Gr(r))return h(e,i,r,g);if(T(r))return A(e,i,r,g);if(c&&Br(e,r),"undefined"===typeof r&&!l)switch(e.tag){case 1:case 22:case 0:case 11:case 15:throw Error(a(152,P(e.type)||"Component"))}return n(e,i)}}var wr=Zr(!0),Wr=Zr(!1),Sr={},Rr=go(Sr),xr=go(Sr),Vr=go(Sr);function Xr(e){if(e===Sr)throw Error(a(174));return e}function Hr(e,t){switch(co(Vr,t),co(xr,e),co(Rr,Sr),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ue(null,"");break;default:t=ue(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}lo(Rr),co(Rr,t)}function Yr(){lo(Rr),lo(xr),lo(Vr)}function Kr(e){Xr(Vr.current);var t=Xr(Rr.current),n=ue(t,e.type);t!==n&&(co(xr,e),co(Rr,n))}function Nr(e){xr.current===e&&(lo(Rr),lo(xr))}var Mr=go(0);function Fr(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(64&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var kr=null,zr=null,Lr=!1;function Tr(e,t){var n=Jg(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.flags=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function Er(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);default:return!1}}function Jr(e){if(Lr){var t=zr;if(t){var n=t;if(!Er(e,t)){if(!(t=Pi(n.nextSibling))||!Er(e,t))return e.flags=-1025&e.flags|2,Lr=!1,void(kr=e);Tr(kr,n)}kr=e,zr=Pi(t.firstChild)}else e.flags=-1025&e.flags|2,Lr=!1,kr=e}}function Ur(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;kr=e}function Dr(e){if(e!==kr)return!1;if(!Lr)return Ur(e),Lr=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!Ei(t,e.memoizedProps))for(t=zr;t;)Tr(e,t),t=Pi(t.nextSibling);if(Ur(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){zr=Pi(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}zr=null}}else zr=kr?Pi(e.stateNode.nextSibling):null;return!0}function Pr(){zr=kr=null,Lr=!1}var Qr=[];function _r(){for(var e=0;e<Qr.length;e++)Qr[e]._workInProgressVersionPrimary=null;Qr.length=0}var jr=y.ReactCurrentDispatcher,Or=y.ReactCurrentBatchConfig,qr=0,$r=null,ea=null,ta=null,na=!1,ia=!1;function oa(){throw Error(a(321))}function ra(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!li(e[n],t[n]))return!1;return!0}function aa(e,t,n,i,o,r){if(qr=r,$r=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,jr.current=null===e||null===e.memoizedState?Xa:Ha,e=n(i,o),ia){r=0;do{if(ia=!1,!(25>r))throw Error(a(301));r+=1,ta=ea=null,t.updateQueue=null,jr.current=Ya,e=n(i,o)}while(ia)}if(jr.current=Va,t=null!==ea&&null!==ea.next,qr=0,ta=ea=$r=null,na=!1,t)throw Error(a(300));return e}function sa(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ta?$r.memoizedState=ta=e:ta=ta.next=e,ta}function ga(){if(null===ea){var e=$r.alternate;e=null!==e?e.memoizedState:null}else e=ea.next;var t=null===ta?$r.memoizedState:ta.next;if(null!==t)ta=t,ea=e;else{if(null===e)throw Error(a(310));e={memoizedState:(ea=e).memoizedState,baseState:ea.baseState,baseQueue:ea.baseQueue,queue:ea.queue,next:null},null===ta?$r.memoizedState=ta=e:ta=ta.next=e}return ta}function la(e,t){return"function"===typeof t?t(e):t}function ca(e){var t=ga(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var i=ea,o=i.baseQueue,r=n.pending;if(null!==r){if(null!==o){var s=o.next;o.next=r.next,r.next=s}i.baseQueue=o=r,n.pending=null}if(null!==o){o=o.next,i=i.baseState;var g=s=r=null,l=o;do{var c=l.lane;if((qr&c)===c)null!==g&&(g=g.next={lane:0,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null}),i=l.eagerReducer===e?l.eagerState:e(i,l.action);else{var I={lane:c,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null};null===g?(s=g=I,r=i):g=g.next=I,$r.lanes|=c,Ls|=c}l=l.next}while(null!==l&&l!==o);null===g?r=i:g.next=s,li(i,t.memoizedState)||(Na=!0),t.memoizedState=i,t.baseState=r,t.baseQueue=g,n.lastRenderedState=i}return[t.memoizedState,n.dispatch]}function Ia(e){var t=ga(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var i=n.dispatch,o=n.pending,r=t.memoizedState;if(null!==o){n.pending=null;var s=o=o.next;do{r=e(r,s.action),s=s.next}while(s!==o);li(r,t.memoizedState)||(Na=!0),t.memoizedState=r,null===t.baseQueue&&(t.baseState=r),n.lastRenderedState=r}return[r,i]}function Ca(e,t,n){var i=t._getVersion;i=i(t._source);var o=t._workInProgressVersionPrimary;if(null!==o?e=o===i:(e=e.mutableReadLanes,(e=(qr&e)===e)&&(t._workInProgressVersionPrimary=i,Qr.push(t))),e)return n(t._source);throw Qr.push(t),Error(a(350))}function ua(e,t,n,i){var o=Hs;if(null===o)throw Error(a(349));var r=t._getVersion,s=r(t._source),g=jr.current,l=g.useState((function(){return Ca(o,t,n)})),c=l[1],I=l[0];l=ta;var C=e.memoizedState,u=C.refs,d=u.getSnapshot,h=C.source;C=C.subscribe;var A=$r;return e.memoizedState={refs:u,source:t,subscribe:i},g.useEffect((function(){u.getSnapshot=n,u.setSnapshot=c;var e=r(t._source);if(!li(s,e)){e=n(t._source),li(I,e)||(c(e),e=ug(A),o.mutableReadLanes|=e&o.pendingLanes),e=o.mutableReadLanes,o.entangledLanes|=e;for(var i=o.entanglements,a=e;0<a;){var g=31-Et(a),l=1<<g;i[g]|=e,a&=~l}}}),[n,t,i]),g.useEffect((function(){return i(t._source,(function(){var e=u.getSnapshot,n=u.setSnapshot;try{n(e(t._source));var i=ug(A);o.mutableReadLanes|=i&o.pendingLanes}catch(r){n((function(){throw r}))}}))}),[t,i]),li(d,n)&&li(h,t)&&li(C,i)||((e={pending:null,dispatch:null,lastRenderedReducer:la,lastRenderedState:I}).dispatch=c=xa.bind(null,$r,e),l.queue=e,l.baseQueue=null,I=Ca(o,t,n),l.memoizedState=l.baseState=I),I}function da(e,t,n){return ua(ga(),e,t,n)}function ha(e){var t=sa();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:la,lastRenderedState:e}).dispatch=xa.bind(null,$r,e),[t.memoizedState,e]}function Aa(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=$r.updateQueue)?(t={lastEffect:null},$r.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function pa(e){return e={current:e},sa().memoizedState=e}function ma(){return ga().memoizedState}function ba(e,t,n,i){var o=sa();$r.flags|=e,o.memoizedState=Aa(1|t,n,void 0,void 0===i?null:i)}function fa(e,t,n,i){var o=ga();i=void 0===i?null:i;var r=void 0;if(null!==ea){var a=ea.memoizedState;if(r=a.destroy,null!==i&&ra(i,a.deps))return void Aa(t,n,r,i)}$r.flags|=e,o.memoizedState=Aa(1|t,n,r,i)}function ya(e,t){return ba(516,4,e,t)}function Ga(e,t){return fa(516,4,e,t)}function va(e,t){return fa(4,2,e,t)}function Ba(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Za(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,fa(4,2,Ba.bind(null,t,e),n)}function wa(){}function Wa(e,t){var n=ga();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&ra(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Sa(e,t){var n=ga();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&ra(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Ra(e,t){var n=Jo();Do(98>n?98:n,(function(){e(!0)})),Do(97<n?97:n,(function(){var n=Or.transition;Or.transition=1;try{e(!1),t()}finally{Or.transition=n}}))}function xa(e,t,n){var i=Cg(),o=ug(e),r={lane:o,action:n,eagerReducer:null,eagerState:null,next:null},a=t.pending;if(null===a?r.next=r:(r.next=a.next,a.next=r),t.pending=r,a=e.alternate,e===$r||null!==a&&a===$r)ia=na=!0;else{if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var s=t.lastRenderedState,g=a(s,n);if(r.eagerReducer=a,r.eagerState=g,li(g,s))return}catch(l){}dg(e,o,i)}}var Va={readContext:ar,useCallback:oa,useContext:oa,useEffect:oa,useImperativeHandle:oa,useLayoutEffect:oa,useMemo:oa,useReducer:oa,useRef:oa,useState:oa,useDebugValue:oa,useDeferredValue:oa,useTransition:oa,useMutableSource:oa,useOpaqueIdentifier:oa,unstable_isNewReconciler:!1},Xa={readContext:ar,useCallback:function(e,t){return sa().memoizedState=[e,void 0===t?null:t],e},useContext:ar,useEffect:ya,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,ba(4,2,Ba.bind(null,t,e),n)},useLayoutEffect:function(e,t){return ba(4,2,e,t)},useMemo:function(e,t){var n=sa();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=sa();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e=(e=i.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=xa.bind(null,$r,e),[i.memoizedState,e]},useRef:pa,useState:ha,useDebugValue:wa,useDeferredValue:function(e){var t=ha(e),n=t[0],i=t[1];return ya((function(){var t=Or.transition;Or.transition=1;try{i(e)}finally{Or.transition=t}}),[e]),n},useTransition:function(){var e=ha(!1),t=e[0];return pa(e=Ra.bind(null,e[1])),[e,t]},useMutableSource:function(e,t,n){var i=sa();return i.memoizedState={refs:{getSnapshot:t,setSnapshot:null},source:e,subscribe:n},ua(i,e,t,n)},useOpaqueIdentifier:function(){if(Lr){var e=!1,t=function(e){return{$$typeof:K,toString:e,valueOf:e}}((function(){throw e||(e=!0,n("r:"+(_i++).toString(36))),Error(a(355))})),n=ha(t)[1];return 0===(2&$r.mode)&&($r.flags|=516,Aa(5,(function(){n("r:"+(_i++).toString(36))}),void 0,null)),t}return ha(t="r:"+(_i++).toString(36)),t},unstable_isNewReconciler:!1},Ha={readContext:ar,useCallback:Wa,useContext:ar,useEffect:Ga,useImperativeHandle:Za,useLayoutEffect:va,useMemo:Sa,useReducer:ca,useRef:ma,useState:function(){return ca(la)},useDebugValue:wa,useDeferredValue:function(e){var t=ca(la),n=t[0],i=t[1];return Ga((function(){var t=Or.transition;Or.transition=1;try{i(e)}finally{Or.transition=t}}),[e]),n},useTransition:function(){var e=ca(la)[0];return[ma().current,e]},useMutableSource:da,useOpaqueIdentifier:function(){return ca(la)[0]},unstable_isNewReconciler:!1},Ya={readContext:ar,useCallback:Wa,useContext:ar,useEffect:Ga,useImperativeHandle:Za,useLayoutEffect:va,useMemo:Sa,useReducer:Ia,useRef:ma,useState:function(){return Ia(la)},useDebugValue:wa,useDeferredValue:function(e){var t=Ia(la),n=t[0],i=t[1];return Ga((function(){var t=Or.transition;Or.transition=1;try{i(e)}finally{Or.transition=t}}),[e]),n},useTransition:function(){var e=Ia(la)[0];return[ma().current,e]},useMutableSource:da,useOpaqueIdentifier:function(){return Ia(la)[0]},unstable_isNewReconciler:!1},Ka=y.ReactCurrentOwner,Na=!1;function Ma(e,t,n,i){t.child=null===e?Wr(t,null,n,i):wr(t,e.child,n,i)}function Fa(e,t,n,i,o){n=n.render;var r=t.ref;return rr(t,o),i=aa(e,t,n,i,r,o),null===e||Na?(t.flags|=1,Ma(e,t,i,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~o,rs(e,t,o))}function ka(e,t,n,i,o,r){if(null===e){var a=n.type;return"function"!==typeof a||Ug(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Pg(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,za(e,t,a,i,o,r))}return a=e.child,0===(o&r)&&(o=a.memoizedProps,(n=null!==(n=n.compare)?n:Ii)(o,i)&&e.ref===t.ref)?rs(e,t,r):(t.flags|=1,(e=Dg(a,i)).ref=t.ref,e.return=t,t.child=e)}function za(e,t,n,i,o,r){if(null!==e&&Ii(e.memoizedProps,i)&&e.ref===t.ref){if(Na=!1,0===(r&o))return t.lanes=e.lanes,rs(e,t,r);0!==(16384&e.flags)&&(Na=!0)}return Ea(e,t,n,i,r)}function La(e,t,n){var i=t.pendingProps,o=i.children,r=null!==e?e.memoizedState:null;if("hidden"===i.mode||"unstable-defer-without-hiding"===i.mode)if(0===(4&t.mode))t.memoizedState={baseLanes:0},Gg(t,n);else{if(0===(1073741824&n))return e=null!==r?r.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e},Gg(t,e),null;t.memoizedState={baseLanes:0},Gg(t,null!==r?r.baseLanes:n)}else null!==r?(i=r.baseLanes|n,t.memoizedState=null):i=n,Gg(t,i);return Ma(e,t,o,n),t.child}function Ta(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=128)}function Ea(e,t,n,i,o){var r=po(n)?ho:Co.current;return r=Ao(t,r),rr(t,o),n=aa(e,t,n,i,r,o),null===e||Na?(t.flags|=1,Ma(e,t,n,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~o,rs(e,t,o))}function Ja(e,t,n,i,o){if(po(n)){var r=!0;yo(t)}else r=!1;if(rr(t,o),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),br(t,n,i),yr(t,n,i,o),i=!0;else if(null===e){var a=t.stateNode,s=t.memoizedProps;a.props=s;var g=a.context,l=n.contextType;"object"===typeof l&&null!==l?l=ar(l):l=Ao(t,l=po(n)?ho:Co.current);var c=n.getDerivedStateFromProps,I="function"===typeof c||"function"===typeof a.getSnapshotBeforeUpdate;I||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==i||g!==l)&&fr(t,a,i,l),sr=!1;var C=t.memoizedState;a.state=C,ur(t,i,a,o),g=t.memoizedState,s!==i||C!==g||uo.current||sr?("function"===typeof c&&(Ar(t,n,c,i),g=t.memoizedState),(s=sr||mr(t,n,s,i,C,g,l))?(I||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4)):("function"===typeof a.componentDidMount&&(t.flags|=4),t.memoizedProps=i,t.memoizedState=g),a.props=i,a.state=g,a.context=l,i=s):("function"===typeof a.componentDidMount&&(t.flags|=4),i=!1)}else{a=t.stateNode,lr(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:Oo(t.type,s),a.props=l,I=t.pendingProps,C=a.context,"object"===typeof(g=n.contextType)&&null!==g?g=ar(g):g=Ao(t,g=po(n)?ho:Co.current);var u=n.getDerivedStateFromProps;(c="function"===typeof u||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==I||C!==g)&&fr(t,a,i,g),sr=!1,C=t.memoizedState,a.state=C,ur(t,i,a,o);var d=t.memoizedState;s!==I||C!==d||uo.current||sr?("function"===typeof u&&(Ar(t,n,u,i),d=t.memoizedState),(l=sr||mr(t,n,l,i,C,d,g))?(c||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(i,d,g),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(i,d,g)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=256)):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&C===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&C===e.memoizedState||(t.flags|=256),t.memoizedProps=i,t.memoizedState=d),a.props=i,a.state=d,a.context=g,i=l):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&C===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&C===e.memoizedState||(t.flags|=256),i=!1)}return Ua(e,t,n,i,r,o)}function Ua(e,t,n,i,o,r){Ta(e,t);var a=0!==(64&t.flags);if(!i&&!a)return o&&Go(t,n,!1),rs(e,t,r);i=t.stateNode,Ka.current=t;var s=a&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&a?(t.child=wr(t,e.child,null,r),t.child=wr(t,null,s,r)):Ma(e,t,s,r),t.memoizedState=i.state,o&&Go(t,n,!0),t.child}function Da(e){var t=e.stateNode;t.pendingContext?bo(0,t.pendingContext,t.pendingContext!==t.context):t.context&&bo(0,t.context,!1),Hr(e,t.containerInfo)}var Pa,Qa,_a,ja,Oa={dehydrated:null,retryLane:0};function qa(e,t,n){var i,o=t.pendingProps,r=Mr.current,a=!1;return(i=0!==(64&t.flags))||(i=(null===e||null!==e.memoizedState)&&0!==(2&r)),i?(a=!0,t.flags&=-65):null!==e&&null===e.memoizedState||void 0===o.fallback||!0===o.unstable_avoidThisFallback||(r|=1),co(Mr,1&r),null===e?(void 0!==o.fallback&&Jr(t),e=o.children,r=o.fallback,a?(e=$a(t,e,r,n),t.child.memoizedState={baseLanes:n},t.memoizedState=Oa,e):"number"===typeof o.unstable_expectedLoadTime?(e=$a(t,e,r,n),t.child.memoizedState={baseLanes:n},t.memoizedState=Oa,t.lanes=33554432,e):((n=_g({mode:"visible",children:e},t.mode,n,null)).return=t,t.child=n)):(e.memoizedState,a?(o=ts(e,t,o.children,o.fallback,n),a=t.child,r=e.child.memoizedState,a.memoizedState=null===r?{baseLanes:n}:{baseLanes:r.baseLanes|n},a.childLanes=e.childLanes&~n,t.memoizedState=Oa,o):(n=es(e,t,o.children,n),t.memoizedState=null,n))}function $a(e,t,n,i){var o=e.mode,r=e.child;return t={mode:"hidden",children:t},0===(2&o)&&null!==r?(r.childLanes=0,r.pendingProps=t):r=_g(t,o,0,null),n=Qg(n,o,i,null),r.return=e,n.return=e,r.sibling=n,e.child=r,n}function es(e,t,n,i){var o=e.child;return e=o.sibling,n=Dg(o,{mode:"visible",children:n}),0===(2&t.mode)&&(n.lanes=i),n.return=t,n.sibling=null,null!==e&&(e.nextEffect=null,e.flags=8,t.firstEffect=t.lastEffect=e),t.child=n}function ts(e,t,n,i,o){var r=t.mode,a=e.child;e=a.sibling;var s={mode:"hidden",children:n};return 0===(2&r)&&t.child!==a?((n=t.child).childLanes=0,n.pendingProps=s,null!==(a=n.lastEffect)?(t.firstEffect=n.firstEffect,t.lastEffect=a,a.nextEffect=null):t.firstEffect=t.lastEffect=null):n=Dg(a,s),null!==e?i=Dg(e,i):(i=Qg(i,r,o,null)).flags|=2,i.return=t,n.return=t,n.sibling=i,t.child=n,i}function ns(e,t){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),or(e.return,t)}function is(e,t,n,i,o,r){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:o,lastEffect:r}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=n,a.tailMode=o,a.lastEffect=r)}function os(e,t,n){var i=t.pendingProps,o=i.revealOrder,r=i.tail;if(Ma(e,t,i.children,n),0!==(2&(i=Mr.current)))i=1&i|2,t.flags|=64;else{if(null!==e&&0!==(64&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&ns(e,n);else if(19===e.tag)ns(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(co(Mr,i),0===(2&t.mode))t.memoizedState=null;else switch(o){case"forwards":for(n=t.child,o=null;null!==n;)null!==(e=n.alternate)&&null===Fr(e)&&(o=n),n=n.sibling;null===(n=o)?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),is(t,!1,o,n,r,t.lastEffect);break;case"backwards":for(n=null,o=t.child,t.child=null;null!==o;){if(null!==(e=o.alternate)&&null===Fr(e)){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}is(t,!0,n,null,r,t.lastEffect);break;case"together":is(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function rs(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Ls|=t.lanes,0!==(n&t.childLanes)){if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Dg(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Dg(e,e.pendingProps)).return=t;n.sibling=null}return t.child}return null}function as(e,t){if(!Lr)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function ss(e,t,n){var i=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:case 17:return po(t.type)&&mo(),null;case 3:return Yr(),lo(uo),lo(Co),_r(),(i=t.stateNode).pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(Dr(t)?t.flags|=4:i.hydrate||(t.flags|=256)),Qa(t),null;case 5:Nr(t);var r=Xr(Vr.current);if(n=t.type,null!==e&&null!=t.stateNode)_a(e,t,n,i,r),e.ref!==t.ref&&(t.flags|=128);else{if(!i){if(null===t.stateNode)throw Error(a(166));return null}if(e=Xr(Rr.current),Dr(t)){i=t.stateNode,n=t.type;var s=t.memoizedProps;switch(i[Oi]=t,i[qi]=s,n){case"dialog":Ri("cancel",i),Ri("close",i);break;case"iframe":case"object":case"embed":Ri("load",i);break;case"video":case"audio":for(e=0;e<Zi.length;e++)Ri(Zi[e],i);break;case"source":Ri("error",i);break;case"img":case"image":case"link":Ri("error",i),Ri("load",i);break;case"details":Ri("toggle",i);break;case"input":ee(i,s),Ri("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},Ri("invalid",i);break;case"textarea":ge(i,s),Ri("invalid",i)}for(var l in ve(n,s),e=null,s)s.hasOwnProperty(l)&&(r=s[l],"children"===l?"string"===typeof r?i.textContent!==r&&(e=["children",r]):"number"===typeof r&&i.textContent!==""+r&&(e=["children",""+r]):g.hasOwnProperty(l)&&null!=r&&"onScroll"===l&&Ri("scroll",i));switch(n){case"input":j(i),ie(i,s,!0);break;case"textarea":j(i),ce(i);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(i.onclick=ki)}i=e,t.updateQueue=i,null!==i&&(t.flags|=4)}else{switch(l=9===r.nodeType?r:r.ownerDocument,e===Ie.html&&(e=Ce(n)),e===Ie.html?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=l.createElement(n,{is:i.is}):(e=l.createElement(n),"select"===n&&(l=e,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):e=l.createElementNS(e,n),e[Oi]=t,e[qi]=i,Pa(e,t,!1,!1),t.stateNode=e,l=Be(n,i),n){case"dialog":Ri("cancel",e),Ri("close",e),r=i;break;case"iframe":case"object":case"embed":Ri("load",e),r=i;break;case"video":case"audio":for(r=0;r<Zi.length;r++)Ri(Zi[r],e);r=i;break;case"source":Ri("error",e),r=i;break;case"img":case"image":case"link":Ri("error",e),Ri("load",e),r=i;break;case"details":Ri("toggle",e),r=i;break;case"input":ee(e,i),r=$(e,i),Ri("invalid",e);break;case"option":r=re(e,i);break;case"select":e._wrapperState={wasMultiple:!!i.multiple},r=o({},i,{value:void 0}),Ri("invalid",e);break;case"textarea":ge(e,i),r=se(e,i),Ri("invalid",e);break;default:r=i}ve(n,r);var c=r;for(s in c)if(c.hasOwnProperty(s)){var I=c[s];"style"===s?ye(e,I):"dangerouslySetInnerHTML"===s?null!=(I=I?I.__html:void 0)&&Ae(e,I):"children"===s?"string"===typeof I?("textarea"!==n||""!==I)&&pe(e,I):"number"===typeof I&&pe(e,""+I):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(g.hasOwnProperty(s)?null!=I&&"onScroll"===s&&Ri("scroll",e):null!=I&&f(e,s,I,l))}switch(n){case"input":j(e),ie(e,i,!1);break;case"textarea":j(e),ce(e);break;case"option":null!=i.value&&e.setAttribute("value",""+Q(i.value));break;case"select":e.multiple=!!i.multiple,null!=(s=i.value)?ae(e,!!i.multiple,s,!1):null!=i.defaultValue&&ae(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=ki)}Ti(n,i)&&(t.flags|=4)}null!==t.ref&&(t.flags|=128)}return null;case 6:if(e&&null!=t.stateNode)ja(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(a(166));n=Xr(Vr.current),Xr(Rr.current),Dr(t)?(i=t.stateNode,n=t.memoizedProps,i[Oi]=t,i.nodeValue!==n&&(t.flags|=4)):((i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[Oi]=t,t.stateNode=i)}return null;case 13:return lo(Mr),i=t.memoizedState,0!==(64&t.flags)?(t.lanes=n,t):(i=null!==i,n=!1,null===e?void 0!==t.memoizedProps.fallback&&Dr(t):n=null!==e.memoizedState,i&&!n&&0!==(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!==(1&Mr.current)?0===Fs&&(Fs=3):(0!==Fs&&3!==Fs||(Fs=4),null===Hs||0===(134217727&Ls)&&0===(134217727&Ts)||mg(Hs,Ks))),(i||n)&&(t.flags|=4),null);case 4:return Yr(),Qa(t),null===e&&Vi(t.stateNode.containerInfo),null;case 10:return ir(t),null;case 19:if(lo(Mr),null===(i=t.memoizedState))return null;if(s=0!==(64&t.flags),null===(l=i.rendering))if(s)as(i,!1);else{if(0!==Fs||null!==e&&0!==(64&e.flags))for(e=t.child;null!==e;){if(null!==(l=Fr(e))){for(t.flags|=64,as(i,!1),null!==(s=l.updateQueue)&&(t.updateQueue=s,t.flags|=4),null===i.lastEffect&&(t.firstEffect=null),t.lastEffect=i.lastEffect,i=n,n=t.child;null!==n;)e=i,(s=n).flags&=2,s.nextEffect=null,s.firstEffect=null,s.lastEffect=null,null===(l=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,e=l.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return co(Mr,1&Mr.current|2),t.child}e=e.sibling}null!==i.tail&&Eo()>Ds&&(t.flags|=64,s=!0,as(i,!1),t.lanes=33554432)}else{if(!s)if(null!==(e=Fr(l))){if(t.flags|=64,s=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),as(i,!0),null===i.tail&&"hidden"===i.tailMode&&!l.alternate&&!Lr)return null!==(t=t.lastEffect=i.lastEffect)&&(t.nextEffect=null),null}else 2*Eo()-i.renderingStartTime>Ds&&1073741824!==n&&(t.flags|=64,s=!0,as(i,!1),t.lanes=33554432);i.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=i.last)?n.sibling=l:t.child=l,i.last=l)}return null!==i.tail?(n=i.tail,i.rendering=n,i.tail=n.sibling,i.lastEffect=t.lastEffect,i.renderingStartTime=Eo(),n.sibling=null,t=Mr.current,co(Mr,s?1&t|2:1&t),n):null;case 23:case 24:return vg(),null!==e&&null!==e.memoizedState!==(null!==t.memoizedState)&&"unstable-defer-without-hiding"!==i.mode&&(t.flags|=4),null}throw Error(a(156,t.tag))}function gs(e){switch(e.tag){case 1:po(e.type)&&mo();var t=e.flags;return 4096&t?(e.flags=-4097&t|64,e):null;case 3:if(Yr(),lo(uo),lo(Co),_r(),0!==(64&(t=e.flags)))throw Error(a(285));return e.flags=-4097&t|64,e;case 5:return Nr(e),null;case 13:return lo(Mr),4096&(t=e.flags)?(e.flags=-4097&t|64,e):null;case 19:return lo(Mr),null;case 4:return Yr(),null;case 10:return ir(e),null;case 23:case 24:return vg(),null;default:return null}}function ls(e,t){try{var n="",i=t;do{n+=D(i),i=i.return}while(i);var o=n}catch(r){o="\nError generating stack: "+r.message+"\n"+r.stack}return{value:e,source:t,stack:o}}function cs(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}Pa=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Qa=function(){},_a=function(e,t,n,i){var r=e.memoizedProps;if(r!==i){e=t.stateNode,Xr(Rr.current);var a,s=null;switch(n){case"input":r=$(e,r),i=$(e,i),s=[];break;case"option":r=re(e,r),i=re(e,i),s=[];break;case"select":r=o({},r,{value:void 0}),i=o({},i,{value:void 0}),s=[];break;case"textarea":r=se(e,r),i=se(e,i),s=[];break;default:"function"!==typeof r.onClick&&"function"===typeof i.onClick&&(e.onclick=ki)}for(I in ve(n,i),n=null,r)if(!i.hasOwnProperty(I)&&r.hasOwnProperty(I)&&null!=r[I])if("style"===I){var l=r[I];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==I&&"children"!==I&&"suppressContentEditableWarning"!==I&&"suppressHydrationWarning"!==I&&"autoFocus"!==I&&(g.hasOwnProperty(I)?s||(s=[]):(s=s||[]).push(I,null));for(I in i){var c=i[I];if(l=null!=r?r[I]:void 0,i.hasOwnProperty(I)&&c!==l&&(null!=c||null!=l))if("style"===I)if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(s||(s=[]),s.push(I,n)),n=c;else"dangerouslySetInnerHTML"===I?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(s=s||[]).push(I,c)):"children"===I?"string"!==typeof c&&"number"!==typeof c||(s=s||[]).push(I,""+c):"suppressContentEditableWarning"!==I&&"suppressHydrationWarning"!==I&&(g.hasOwnProperty(I)?(null!=c&&"onScroll"===I&&Ri("scroll",e),s||l===c||(s=[])):"object"===typeof c&&null!==c&&c.$$typeof===K?c.toString():(s=s||[]).push(I,c))}n&&(s=s||[]).push("style",n);var I=s;(t.updateQueue=I)&&(t.flags|=4)}},ja=function(e,t,n,i){n!==i&&(t.flags|=4)};var Is="function"===typeof WeakMap?WeakMap:Map;function Cs(e,t,n){(n=cr(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){js||(js=!0,Os=i),cs(0,t)},n}function us(e,t,n){(n=cr(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var o=t.value;n.payload=function(){return cs(0,t),i(o)}}var r=e.stateNode;return null!==r&&"function"===typeof r.componentDidCatch&&(n.callback=function(){"function"!==typeof i&&(null===qs?qs=new Set([this]):qs.add(this),cs(0,t));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}var ds="function"===typeof WeakSet?WeakSet:Set;function hs(e){var t=e.ref;if(null!==t)if("function"===typeof t)try{t(null)}catch(n){zg(e,n)}else t.current=null}function As(e,t){switch(t.tag){case 0:case 11:case 15:case 22:case 5:case 6:case 4:case 17:return;case 1:if(256&t.flags&&null!==e){var n=e.memoizedProps,i=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:Oo(t.type,n),i),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:return void(256&t.flags&&Di(t.stateNode.containerInfo))}throw Error(a(163))}function ps(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{if(3===(3&e.tag)){var i=e.create;e.destroy=i()}e=e.next}while(e!==t)}if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{var o=e;i=o.next,0!==(4&(o=o.tag))&&0!==(1&o)&&(Mg(n,e),Ng(n,e)),e=i}while(e!==t)}return;case 1:return e=n.stateNode,4&n.flags&&(null===t?e.componentDidMount():(i=n.elementType===n.type?t.memoizedProps:Oo(n.type,t.memoizedProps),e.componentDidUpdate(i,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate))),void(null!==(t=n.updateQueue)&&dr(n,t,e));case 3:if(null!==(t=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 5:case 1:e=n.child.stateNode}dr(n,t,e)}return;case 5:return e=n.stateNode,void(null===t&&4&n.flags&&Ti(n.type,n.memoizedProps)&&e.focus());case 6:case 4:case 12:case 19:case 17:case 20:case 21:case 23:case 24:return;case 13:return void(null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&yt(n)))))}throw Error(a(163))}function ms(e,t){for(var n=e;;){if(5===n.tag){var i=n.stateNode;if(t)"function"===typeof(i=i.style).setProperty?i.setProperty("display","none","important"):i.display="none";else{i=n.stateNode;var o=n.memoizedProps.style;o=void 0!==o&&null!==o&&o.hasOwnProperty("display")?o.display:null,i.style.display=fe("display",o)}}else if(6===n.tag)n.stateNode.nodeValue=t?"":n.memoizedProps;else if((23!==n.tag&&24!==n.tag||null===n.memoizedState||n===e)&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}function bs(e,t){if(Bo&&"function"===typeof Bo.onCommitFiberUnmount)try{Bo.onCommitFiberUnmount(vo,t)}catch(r){}switch(t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var n=e=e.next;do{var i=n,o=i.destroy;if(i=i.tag,void 0!==o)if(0!==(4&i))Mg(t,n);else{i=t;try{o()}catch(r){zg(i,r)}}n=n.next}while(n!==e)}break;case 1:if(hs(t),"function"===typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(r){zg(t,r)}break;case 5:hs(t);break;case 4:Zs(e,t)}}function fs(e){e.alternate=null,e.child=null,e.dependencies=null,e.firstEffect=null,e.lastEffect=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.return=null,e.updateQueue=null}function ys(e){return 5===e.tag||3===e.tag||4===e.tag}function Gs(e){e:{for(var t=e.return;null!==t;){if(ys(t))break e;t=t.return}throw Error(a(160))}var n=t;switch(t=n.stateNode,n.tag){case 5:var i=!1;break;case 3:case 4:t=t.containerInfo,i=!0;break;default:throw Error(a(161))}16&n.flags&&(pe(t,""),n.flags&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||ys(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.flags)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.flags)){n=n.stateNode;break e}}i?vs(e,n,t):Bs(e,n,t)}function vs(e,t,n){var i=e.tag,o=5===i||6===i;if(o)e=o?e.stateNode:e.stateNode.instance,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=ki));else if(4!==i&&null!==(e=e.child))for(vs(e,t,n),e=e.sibling;null!==e;)vs(e,t,n),e=e.sibling}function Bs(e,t,n){var i=e.tag,o=5===i||6===i;if(o)e=o?e.stateNode:e.stateNode.instance,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(Bs(e,t,n),e=e.sibling;null!==e;)Bs(e,t,n),e=e.sibling}function Zs(e,t){for(var n,i,o=t,r=!1;;){if(!r){r=o.return;e:for(;;){if(null===r)throw Error(a(160));switch(n=r.stateNode,r.tag){case 5:i=!1;break e;case 3:case 4:n=n.containerInfo,i=!0;break e}r=r.return}r=!0}if(5===o.tag||6===o.tag){e:for(var s=e,g=o,l=g;;)if(bs(s,l),null!==l.child&&4!==l.tag)l.child.return=l,l=l.child;else{if(l===g)break e;for(;null===l.sibling;){if(null===l.return||l.return===g)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}i?(s=n,g=o.stateNode,8===s.nodeType?s.parentNode.removeChild(g):s.removeChild(g)):n.removeChild(o.stateNode)}else if(4===o.tag){if(null!==o.child){n=o.stateNode.containerInfo,i=!0,o.child.return=o,o=o.child;continue}}else if(bs(e,o),null!==o.child){o.child.return=o,o=o.child;continue}if(o===t)break;for(;null===o.sibling;){if(null===o.return||o.return===t)return;4===(o=o.return).tag&&(r=!1)}o.sibling.return=o.return,o=o.sibling}}function ws(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var i=n=n.next;do{3===(3&i.tag)&&(e=i.destroy,i.destroy=void 0,void 0!==e&&e()),i=i.next}while(i!==n)}return;case 1:case 12:case 17:return;case 5:if(null!=(n=t.stateNode)){i=t.memoizedProps;var o=null!==e?e.memoizedProps:i;e=t.type;var r=t.updateQueue;if(t.updateQueue=null,null!==r){for(n[qi]=i,"input"===e&&"radio"===i.type&&null!=i.name&&te(n,i),Be(e,o),t=Be(e,i),o=0;o<r.length;o+=2){var s=r[o],g=r[o+1];"style"===s?ye(n,g):"dangerouslySetInnerHTML"===s?Ae(n,g):"children"===s?pe(n,g):f(n,s,g,t)}switch(e){case"input":ne(n,i);break;case"textarea":le(n,i);break;case"select":e=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!i.multiple,null!=(r=i.value)?ae(n,!!i.multiple,r,!1):e!==!!i.multiple&&(null!=i.defaultValue?ae(n,!!i.multiple,i.defaultValue,!0):ae(n,!!i.multiple,i.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(a(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((n=t.stateNode).hydrate&&(n.hydrate=!1,yt(n.containerInfo)));case 13:return null!==t.memoizedState&&(Us=Eo(),ms(t.child,!0)),void Ws(t);case 19:return void Ws(t);case 23:case 24:return void ms(t,null!==t.memoizedState)}throw Error(a(163))}function Ws(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new ds),t.forEach((function(t){var i=Tg.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}}function Ss(e,t){return null!==e&&(null===(e=e.memoizedState)||null!==e.dehydrated)&&(null!==(t=t.memoizedState)&&null===t.dehydrated)}var Rs=Math.ceil,xs=y.ReactCurrentDispatcher,Vs=y.ReactCurrentOwner,Xs=0,Hs=null,Ys=null,Ks=0,Ns=0,Ms=go(0),Fs=0,ks=null,zs=0,Ls=0,Ts=0,Es=0,Js=null,Us=0,Ds=1/0;function Ps(){Ds=Eo()+500}var Qs,_s=null,js=!1,Os=null,qs=null,$s=!1,eg=null,tg=90,ng=[],ig=[],og=null,rg=0,ag=null,sg=-1,gg=0,lg=0,cg=null,Ig=!1;function Cg(){return 0!==(48&Xs)?Eo():-1!==sg?sg:sg=Eo()}function ug(e){if(0===(2&(e=e.mode)))return 1;if(0===(4&e))return 99===Jo()?1:2;if(0===gg&&(gg=zs),0!==jo.transition){0!==lg&&(lg=null!==Js?Js.pendingLanes:0),e=gg;var t=4186112&~lg;return 0===(t&=-t)&&(0===(t=(e=4186112&~e)&-e)&&(t=8192)),t}return e=Jo(),0!==(4&Xs)&&98===e?e=kt(12,gg):e=kt(e=function(e){switch(e){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}(e),gg),e}function dg(e,t,n){if(50<rg)throw rg=0,ag=null,Error(a(185));if(null===(e=hg(e,t)))return null;Tt(e,t,n),e===Hs&&(Ts|=t,4===Fs&&mg(e,Ks));var i=Jo();1===t?0!==(8&Xs)&&0===(48&Xs)?bg(e):(Ag(e,n),0===Xs&&(Ps(),Qo())):(0===(4&Xs)||98!==i&&99!==i||(null===og?og=new Set([e]):og.add(e)),Ag(e,n)),Js=e}function hg(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function Ag(e,t){for(var n=e.callbackNode,i=e.suspendedLanes,o=e.pingedLanes,r=e.expirationTimes,s=e.pendingLanes;0<s;){var g=31-Et(s),l=1<<g,c=r[g];if(-1===c){if(0===(l&i)||0!==(l&o)){c=t,Nt(l);var I=Kt;r[g]=10<=I?c+250:6<=I?c+5e3:-1}}else c<=t&&(e.expiredLanes|=l);s&=~l}if(i=Mt(e,e===Hs?Ks:0),t=Kt,0===i)null!==n&&(n!==Mo&&Wo(n),e.callbackNode=null,e.callbackPriority=0);else{if(null!==n){if(e.callbackPriority===t)return;n!==Mo&&Wo(n)}15===t?(n=bg.bind(null,e),null===ko?(ko=[n],zo=wo(Xo,_o)):ko.push(n),n=Mo):14===t?n=Po(99,bg.bind(null,e)):(n=function(e){switch(e){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(a(358,e))}}(t),n=Po(n,pg.bind(null,e))),e.callbackPriority=t,e.callbackNode=n}}function pg(e){if(sg=-1,lg=gg=0,0!==(48&Xs))throw Error(a(327));var t=e.callbackNode;if(Kg()&&e.callbackNode!==t)return null;var n=Mt(e,e===Hs?Ks:0);if(0===n)return null;var i=n,o=Xs;Xs|=16;var r=wg();for(Hs===e&&Ks===i||(Ps(),Bg(e,i));;)try{Rg();break}catch(g){Zg(e,g)}if(nr(),xs.current=r,Xs=o,null!==Ys?i=0:(Hs=null,Ks=0,i=Fs),0!==(zs&Ts))Bg(e,0);else if(0!==i){if(2===i&&(Xs|=64,e.hydrate&&(e.hydrate=!1,Di(e.containerInfo)),0!==(n=Ft(e))&&(i=Wg(e,n))),1===i)throw t=ks,Bg(e,0),mg(e,n),Ag(e,Eo()),t;switch(e.finishedWork=e.current.alternate,e.finishedLanes=n,i){case 0:case 1:throw Error(a(345));case 2:case 5:Xg(e);break;case 3:if(mg(e,n),(62914560&n)===n&&10<(i=Us+500-Eo())){if(0!==Mt(e,0))break;if(((o=e.suspendedLanes)&n)!==n){Cg(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=Ji(Xg.bind(null,e),i);break}Xg(e);break;case 4:if(mg(e,n),(4186112&n)===n)break;for(i=e.eventTimes,o=-1;0<n;){var s=31-Et(n);r=1<<s,(s=i[s])>o&&(o=s),n&=~r}if(n=o,10<(n=(120>(n=Eo()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Rs(n/1960))-n)){e.timeoutHandle=Ji(Xg.bind(null,e),n);break}Xg(e);break;default:throw Error(a(329))}}return Ag(e,Eo()),e.callbackNode===t?pg.bind(null,e):null}function mg(e,t){for(t&=~Es,t&=~Ts,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Et(t),i=1<<n;e[n]=-1,t&=~i}}function bg(e){if(0!==(48&Xs))throw Error(a(327));if(Kg(),e===Hs&&0!==(e.expiredLanes&Ks)){var t=Ks,n=Wg(e,t);0!==(zs&Ts)&&(n=Wg(e,t=Mt(e,t)))}else n=Wg(e,t=Mt(e,0));if(0!==e.tag&&2===n&&(Xs|=64,e.hydrate&&(e.hydrate=!1,Di(e.containerInfo)),0!==(t=Ft(e))&&(n=Wg(e,t))),1===n)throw n=ks,Bg(e,0),mg(e,t),Ag(e,Eo()),n;return e.finishedWork=e.current.alternate,e.finishedLanes=t,Xg(e),Ag(e,Eo()),null}function fg(e,t){var n=Xs;Xs|=1;try{return e(t)}finally{0===(Xs=n)&&(Ps(),Qo())}}function yg(e,t){var n=Xs;Xs&=-2,Xs|=8;try{return e(t)}finally{0===(Xs=n)&&(Ps(),Qo())}}function Gg(e,t){co(Ms,Ns),Ns|=t,zs|=t}function vg(){Ns=Ms.current,lo(Ms)}function Bg(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,Ui(n)),null!==Ys)for(n=Ys.return;null!==n;){var i=n;switch(i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&mo();break;case 3:Yr(),lo(uo),lo(Co),_r();break;case 5:Nr(i);break;case 4:Yr();break;case 13:case 19:lo(Mr);break;case 10:ir(i);break;case 23:case 24:vg()}n=n.return}Hs=e,Ys=Dg(e.current,null),Ks=Ns=zs=t,Fs=0,ks=null,Es=Ts=Ls=0}function Zg(e,t){for(;;){var n=Ys;try{if(nr(),jr.current=Va,na){for(var i=$r.memoizedState;null!==i;){var o=i.queue;null!==o&&(o.pending=null),i=i.next}na=!1}if(qr=0,ta=ea=$r=null,ia=!1,Vs.current=null,null===n||null===n.return){Fs=1,ks=t,Ys=null;break}e:{var r=e,a=n.return,s=n,g=t;if(t=Ks,s.flags|=2048,s.firstEffect=s.lastEffect=null,null!==g&&"object"===typeof g&&"function"===typeof g.then){var l=g;if(0===(2&s.mode)){var c=s.alternate;c?(s.updateQueue=c.updateQueue,s.memoizedState=c.memoizedState,s.lanes=c.lanes):(s.updateQueue=null,s.memoizedState=null)}var I=0!==(1&Mr.current),C=a;do{var u;if(u=13===C.tag){var d=C.memoizedState;if(null!==d)u=null!==d.dehydrated;else{var h=C.memoizedProps;u=void 0!==h.fallback&&(!0!==h.unstable_avoidThisFallback||!I)}}if(u){var A=C.updateQueue;if(null===A){var p=new Set;p.add(l),C.updateQueue=p}else A.add(l);if(0===(2&C.mode)){if(C.flags|=64,s.flags|=16384,s.flags&=-2981,1===s.tag)if(null===s.alternate)s.tag=17;else{var m=cr(-1,1);m.tag=2,Ir(s,m)}s.lanes|=1;break e}g=void 0,s=t;var b=r.pingCache;if(null===b?(b=r.pingCache=new Is,g=new Set,b.set(l,g)):void 0===(g=b.get(l))&&(g=new Set,b.set(l,g)),!g.has(s)){g.add(s);var f=Lg.bind(null,r,l,s);l.then(f,f)}C.flags|=4096,C.lanes=t;break e}C=C.return}while(null!==C);g=Error((P(s.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==Fs&&(Fs=2),g=ls(g,s),C=a;do{switch(C.tag){case 3:r=g,C.flags|=4096,t&=-t,C.lanes|=t,Cr(C,Cs(0,r,t));break e;case 1:r=g;var y=C.type,G=C.stateNode;if(0===(64&C.flags)&&("function"===typeof y.getDerivedStateFromError||null!==G&&"function"===typeof G.componentDidCatch&&(null===qs||!qs.has(G)))){C.flags|=4096,t&=-t,C.lanes|=t,Cr(C,us(C,r,t));break e}}C=C.return}while(null!==C)}Vg(n)}catch(v){t=v,Ys===n&&null!==n&&(Ys=n=n.return);continue}break}}function wg(){var e=xs.current;return xs.current=Va,null===e?Va:e}function Wg(e,t){var n=Xs;Xs|=16;var i=wg();for(Hs===e&&Ks===t||Bg(e,t);;)try{Sg();break}catch(o){Zg(e,o)}if(nr(),Xs=n,xs.current=i,null!==Ys)throw Error(a(261));return Hs=null,Ks=0,Fs}function Sg(){for(;null!==Ys;)xg(Ys)}function Rg(){for(;null!==Ys&&!So();)xg(Ys)}function xg(e){var t=Qs(e.alternate,e,Ns);e.memoizedProps=e.pendingProps,null===t?Vg(e):Ys=t,Vs.current=null}function Vg(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(2048&t.flags)){if(null!==(n=ss(n,t,Ns)))return void(Ys=n);if(24!==(n=t).tag&&23!==n.tag||null===n.memoizedState||0!==(1073741824&Ns)||0===(4&n.mode)){for(var i=0,o=n.child;null!==o;)i|=o.lanes|o.childLanes,o=o.sibling;n.childLanes=i}null!==e&&0===(2048&e.flags)&&(null===e.firstEffect&&(e.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=t.firstEffect),e.lastEffect=t.lastEffect),1<t.flags&&(null!==e.lastEffect?e.lastEffect.nextEffect=t:e.firstEffect=t,e.lastEffect=t))}else{if(null!==(n=gs(t)))return n.flags&=2047,void(Ys=n);null!==e&&(e.firstEffect=e.lastEffect=null,e.flags|=2048)}if(null!==(t=t.sibling))return void(Ys=t);Ys=t=e}while(null!==t);0===Fs&&(Fs=5)}function Xg(e){var t=Jo();return Do(99,Hg.bind(null,e,t)),null}function Hg(e,t){do{Kg()}while(null!==eg);if(0!==(48&Xs))throw Error(a(327));var n=e.finishedWork;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null;var i=n.lanes|n.childLanes,o=i,r=e.pendingLanes&~o;e.pendingLanes=o,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=o,e.mutableReadLanes&=o,e.entangledLanes&=o,o=e.entanglements;for(var s=e.eventTimes,g=e.expirationTimes;0<r;){var l=31-Et(r),c=1<<l;o[l]=0,s[l]=-1,g[l]=-1,r&=~c}if(null!==og&&0===(24&i)&&og.has(e)&&og.delete(e),e===Hs&&(Ys=Hs=null,Ks=0),1<n.flags?null!==n.lastEffect?(n.lastEffect.nextEffect=n,i=n.firstEffect):i=n:i=n.firstEffect,null!==i){if(o=Xs,Xs|=32,Vs.current=null,zi=Qt,Ai(s=hi())){if("selectionStart"in s)g={start:s.selectionStart,end:s.selectionEnd};else e:if(g=(g=s.ownerDocument)&&g.defaultView||window,(c=g.getSelection&&g.getSelection())&&0!==c.rangeCount){g=c.anchorNode,r=c.anchorOffset,l=c.focusNode,c=c.focusOffset;try{g.nodeType,l.nodeType}catch(w){g=null;break e}var I=0,C=-1,u=-1,d=0,h=0,A=s,p=null;t:for(;;){for(var m;A!==g||0!==r&&3!==A.nodeType||(C=I+r),A!==l||0!==c&&3!==A.nodeType||(u=I+c),3===A.nodeType&&(I+=A.nodeValue.length),null!==(m=A.firstChild);)p=A,A=m;for(;;){if(A===s)break t;if(p===g&&++d===r&&(C=I),p===l&&++h===c&&(u=I),null!==(m=A.nextSibling))break;p=(A=p).parentNode}A=m}g=-1===C||-1===u?null:{start:C,end:u}}else g=null;g=g||{start:0,end:0}}else g=null;Li={focusedElem:s,selectionRange:g},Qt=!1,cg=null,Ig=!1,_s=i;do{try{Yg()}catch(w){if(null===_s)throw Error(a(330));zg(_s,w),_s=_s.nextEffect}}while(null!==_s);cg=null,_s=i;do{try{for(s=e;null!==_s;){var b=_s.flags;if(16&b&&pe(_s.stateNode,""),128&b){var f=_s.alternate;if(null!==f){var y=f.ref;null!==y&&("function"===typeof y?y(null):y.current=null)}}switch(1038&b){case 2:Gs(_s),_s.flags&=-3;break;case 6:Gs(_s),_s.flags&=-3,ws(_s.alternate,_s);break;case 1024:_s.flags&=-1025;break;case 1028:_s.flags&=-1025,ws(_s.alternate,_s);break;case 4:ws(_s.alternate,_s);break;case 8:Zs(s,g=_s);var G=g.alternate;fs(g),null!==G&&fs(G)}_s=_s.nextEffect}}catch(w){if(null===_s)throw Error(a(330));zg(_s,w),_s=_s.nextEffect}}while(null!==_s);if(y=Li,f=hi(),b=y.focusedElem,s=y.selectionRange,f!==b&&b&&b.ownerDocument&&di(b.ownerDocument.documentElement,b)){null!==s&&Ai(b)&&(f=s.start,void 0===(y=s.end)&&(y=f),"selectionStart"in b?(b.selectionStart=f,b.selectionEnd=Math.min(y,b.value.length)):(y=(f=b.ownerDocument||document)&&f.defaultView||window).getSelection&&(y=y.getSelection(),g=b.textContent.length,G=Math.min(s.start,g),s=void 0===s.end?G:Math.min(s.end,g),!y.extend&&G>s&&(g=s,s=G,G=g),g=ui(b,G),r=ui(b,s),g&&r&&(1!==y.rangeCount||y.anchorNode!==g.node||y.anchorOffset!==g.offset||y.focusNode!==r.node||y.focusOffset!==r.offset)&&((f=f.createRange()).setStart(g.node,g.offset),y.removeAllRanges(),G>s?(y.addRange(f),y.extend(r.node,r.offset)):(f.setEnd(r.node,r.offset),y.addRange(f))))),f=[];for(y=b;y=y.parentNode;)1===y.nodeType&&f.push({element:y,left:y.scrollLeft,top:y.scrollTop});for("function"===typeof b.focus&&b.focus(),b=0;b<f.length;b++)(y=f[b]).element.scrollLeft=y.left,y.element.scrollTop=y.top}Qt=!!zi,Li=zi=null,e.current=n,_s=i;do{try{for(b=e;null!==_s;){var v=_s.flags;if(36&v&&ps(b,_s.alternate,_s),128&v){f=void 0;var B=_s.ref;if(null!==B){var Z=_s.stateNode;_s.tag,f=Z,"function"===typeof B?B(f):B.current=f}}_s=_s.nextEffect}}catch(w){if(null===_s)throw Error(a(330));zg(_s,w),_s=_s.nextEffect}}while(null!==_s);_s=null,Fo(),Xs=o}else e.current=n;if($s)$s=!1,eg=e,tg=t;else for(_s=i;null!==_s;)t=_s.nextEffect,_s.nextEffect=null,8&_s.flags&&((v=_s).sibling=null,v.stateNode=null),_s=t;if(0===(i=e.pendingLanes)&&(qs=null),1===i?e===ag?rg++:(rg=0,ag=e):rg=0,n=n.stateNode,Bo&&"function"===typeof Bo.onCommitFiberRoot)try{Bo.onCommitFiberRoot(vo,n,void 0,64===(64&n.current.flags))}catch(w){}if(Ag(e,Eo()),js)throw js=!1,e=Os,Os=null,e;return 0!==(8&Xs)||Qo(),null}function Yg(){for(;null!==_s;){var e=_s.alternate;Ig||null===cg||(0!==(8&_s.flags)?$e(_s,cg)&&(Ig=!0):13===_s.tag&&Ss(e,_s)&&$e(_s,cg)&&(Ig=!0));var t=_s.flags;0!==(256&t)&&As(e,_s),0===(512&t)||$s||($s=!0,Po(97,(function(){return Kg(),null}))),_s=_s.nextEffect}}function Kg(){if(90!==tg){var e=97<tg?97:tg;return tg=90,Do(e,Fg)}return!1}function Ng(e,t){ng.push(t,e),$s||($s=!0,Po(97,(function(){return Kg(),null})))}function Mg(e,t){ig.push(t,e),$s||($s=!0,Po(97,(function(){return Kg(),null})))}function Fg(){if(null===eg)return!1;var e=eg;if(eg=null,0!==(48&Xs))throw Error(a(331));var t=Xs;Xs|=32;var n=ig;ig=[];for(var i=0;i<n.length;i+=2){var o=n[i],r=n[i+1],s=o.destroy;if(o.destroy=void 0,"function"===typeof s)try{s()}catch(l){if(null===r)throw Error(a(330));zg(r,l)}}for(n=ng,ng=[],i=0;i<n.length;i+=2){o=n[i],r=n[i+1];try{var g=o.create;o.destroy=g()}catch(l){if(null===r)throw Error(a(330));zg(r,l)}}for(g=e.current.firstEffect;null!==g;)e=g.nextEffect,g.nextEffect=null,8&g.flags&&(g.sibling=null,g.stateNode=null),g=e;return Xs=t,Qo(),!0}function kg(e,t,n){Ir(e,t=Cs(0,t=ls(n,t),1)),t=Cg(),null!==(e=hg(e,1))&&(Tt(e,1,t),Ag(e,t))}function zg(e,t){if(3===e.tag)kg(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){kg(n,e,t);break}if(1===n.tag){var i=n.stateNode;if("function"===typeof n.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===qs||!qs.has(i))){var o=us(n,e=ls(t,e),1);if(Ir(n,o),o=Cg(),null!==(n=hg(n,1)))Tt(n,1,o),Ag(n,o);else if("function"===typeof i.componentDidCatch&&(null===qs||!qs.has(i)))try{i.componentDidCatch(t,e)}catch(r){}break}}n=n.return}}function Lg(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=Cg(),e.pingedLanes|=e.suspendedLanes&n,Hs===e&&(Ks&n)===n&&(4===Fs||3===Fs&&(62914560&Ks)===Ks&&500>Eo()-Us?Bg(e,0):Es|=n),Ag(e,t)}function Tg(e,t){var n=e.stateNode;null!==n&&n.delete(t),0===(t=0)&&(0===(2&(t=e.mode))?t=1:0===(4&t)?t=99===Jo()?1:2:(0===gg&&(gg=zs),0===(t=zt(62914560&~gg))&&(t=4194304))),n=Cg(),null!==(e=hg(e,t))&&(Tt(e,t,n),Ag(e,n))}function Eg(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function Jg(e,t,n,i){return new Eg(e,t,n,i)}function Ug(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Dg(e,t){var n=e.alternate;return null===n?((n=Jg(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Pg(e,t,n,i,o,r){var s=2;if(i=e,"function"===typeof e)Ug(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case B:return Qg(n.children,o,r,t);case N:s=8,o|=16;break;case Z:s=8,o|=1;break;case w:return(e=Jg(12,n,t,8|o)).elementType=w,e.type=w,e.lanes=r,e;case x:return(e=Jg(13,n,t,o)).type=x,e.elementType=x,e.lanes=r,e;case V:return(e=Jg(19,n,t,o)).elementType=V,e.lanes=r,e;case M:return _g(n,o,r,t);case F:return(e=Jg(24,n,t,o)).elementType=F,e.lanes=r,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case W:s=10;break e;case S:s=9;break e;case R:s=11;break e;case X:s=14;break e;case H:s=16,i=null;break e;case Y:s=22;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Jg(s,n,t,o)).elementType=e,t.type=i,t.lanes=r,t}function Qg(e,t,n,i){return(e=Jg(7,e,i,t)).lanes=n,e}function _g(e,t,n,i){return(e=Jg(23,e,i,t)).elementType=M,e.lanes=n,e}function jg(e,t,n){return(e=Jg(6,e,null,t)).lanes=n,e}function Og(e,t,n){return(t=Jg(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function qg(e,t,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Lt(0),this.expirationTimes=Lt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Lt(0),this.mutableSourceEagerHydrationData=null}function $g(e,t,n,i){var o=t.current,r=Cg(),s=ug(o);e:if(n){t:{if(_e(n=n._reactInternals)!==n||1!==n.tag)throw Error(a(170));var g=n;do{switch(g.tag){case 3:g=g.stateNode.context;break t;case 1:if(po(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break t}}g=g.return}while(null!==g);throw Error(a(171))}if(1===n.tag){var l=n.type;if(po(l)){n=fo(n,l,g);break e}}n=g}else n=Io;return null===t.context?t.context=n:t.pendingContext=n,(t=cr(r,s)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),Ir(o,t),dg(o,s,r),s}function el(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function tl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function nl(e,t){tl(e,t),(e=e.alternate)&&tl(e,t)}function il(e,t,n){var i=null!=n&&null!=n.hydrationOptions&&n.hydrationOptions.mutableSources||null;if(n=new qg(e,t,null!=n&&!0===n.hydrate),t=Jg(3,null,null,2===t?7:1===t?3:0),n.current=t,t.stateNode=n,gr(t),e[$i]=n.current,Vi(8===e.nodeType?e.parentNode:e),i)for(e=0;e<i.length;e++){var o=(t=i[e])._getVersion;o=o(t._source),null==n.mutableSourceEagerHydrationData?n.mutableSourceEagerHydrationData=[t,o]:n.mutableSourceEagerHydrationData.push(t,o)}this._internalRoot=n}function ol(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function rl(e,t,n,i,o){var r=n._reactRootContainer;if(r){var a=r._internalRoot;if("function"===typeof o){var s=o;o=function(){var e=el(a);s.call(e)}}$g(t,a,e,o)}else{if(r=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new il(e,0,t?{hydrate:!0}:void 0)}(n,i),a=r._internalRoot,"function"===typeof o){var g=o;o=function(){var e=el(a);g.call(e)}}yg((function(){$g(t,a,e,o)}))}return el(a)}function al(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!ol(t))throw Error(a(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:v,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)}Qs=function(e,t,n){var i=t.lanes;if(null!==e)if(e.memoizedProps!==t.pendingProps||uo.current)Na=!0;else{if(0===(n&i)){switch(Na=!1,t.tag){case 3:Da(t),Pr();break;case 5:Kr(t);break;case 1:po(t.type)&&yo(t);break;case 4:Hr(t,t.stateNode.containerInfo);break;case 10:i=t.memoizedProps.value;var o=t.type._context;co(qo,o._currentValue),o._currentValue=i;break;case 13:if(null!==t.memoizedState)return 0!==(n&t.child.childLanes)?qa(e,t,n):(co(Mr,1&Mr.current),null!==(t=rs(e,t,n))?t.sibling:null);co(Mr,1&Mr.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(64&e.flags)){if(i)return os(e,t,n);t.flags|=64}if(null!==(o=t.memoizedState)&&(o.rendering=null,o.tail=null,o.lastEffect=null),co(Mr,Mr.current),i)break;return null;case 23:case 24:return t.lanes=0,La(e,t,n)}return rs(e,t,n)}Na=0!==(16384&e.flags)}else Na=!1;switch(t.lanes=0,t.tag){case 2:if(i=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,o=Ao(t,Co.current),rr(t,n),o=aa(null,t,i,e,o,n),t.flags|=1,"object"===typeof o&&null!==o&&"function"===typeof o.render&&void 0===o.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,po(i)){var r=!0;yo(t)}else r=!1;t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,gr(t);var s=i.getDerivedStateFromProps;"function"===typeof s&&Ar(t,i,s,e),o.updater=pr,t.stateNode=o,o._reactInternals=t,yr(t,i,e,n),t=Ua(null,t,i,!0,r,n)}else t.tag=0,Ma(null,t,o,n),t=t.child;return t;case 16:o=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,o=(r=o._init)(o._payload),t.type=o,r=t.tag=function(e){if("function"===typeof e)return Ug(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===R)return 11;if(e===X)return 14}return 2}(o),e=Oo(o,e),r){case 0:t=Ea(null,t,o,e,n);break e;case 1:t=Ja(null,t,o,e,n);break e;case 11:t=Fa(null,t,o,e,n);break e;case 14:t=ka(null,t,o,Oo(o.type,e),i,n);break e}throw Error(a(306,o,""))}return t;case 0:return i=t.type,o=t.pendingProps,Ea(e,t,i,o=t.elementType===i?o:Oo(i,o),n);case 1:return i=t.type,o=t.pendingProps,Ja(e,t,i,o=t.elementType===i?o:Oo(i,o),n);case 3:if(Da(t),i=t.updateQueue,null===e||null===i)throw Error(a(282));if(i=t.pendingProps,o=null!==(o=t.memoizedState)?o.element:null,lr(e,t),ur(t,i,null,n),(i=t.memoizedState.element)===o)Pr(),t=rs(e,t,n);else{if((r=(o=t.stateNode).hydrate)&&(zr=Pi(t.stateNode.containerInfo.firstChild),kr=t,r=Lr=!0),r){if(null!=(e=o.mutableSourceEagerHydrationData))for(o=0;o<e.length;o+=2)(r=e[o])._workInProgressVersionPrimary=e[o+1],Qr.push(r);for(n=Wr(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|1024,n=n.sibling}else Ma(e,t,i,n),Pr();t=t.child}return t;case 5:return Kr(t),null===e&&Jr(t),i=t.type,o=t.pendingProps,r=null!==e?e.memoizedProps:null,s=o.children,Ei(i,o)?s=null:null!==r&&Ei(i,r)&&(t.flags|=16),Ta(e,t),Ma(e,t,s,n),t.child;case 6:return null===e&&Jr(t),null;case 13:return qa(e,t,n);case 4:return Hr(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=wr(t,null,i,n):Ma(e,t,i,n),t.child;case 11:return i=t.type,o=t.pendingProps,Fa(e,t,i,o=t.elementType===i?o:Oo(i,o),n);case 7:return Ma(e,t,t.pendingProps,n),t.child;case 8:case 12:return Ma(e,t,t.pendingProps.children,n),t.child;case 10:e:{i=t.type._context,o=t.pendingProps,s=t.memoizedProps,r=o.value;var g=t.type._context;if(co(qo,g._currentValue),g._currentValue=r,null!==s)if(g=s.value,0===(r=li(g,r)?0:0|("function"===typeof i._calculateChangedBits?i._calculateChangedBits(g,r):1073741823))){if(s.children===o.children&&!uo.current){t=rs(e,t,n);break e}}else for(null!==(g=t.child)&&(g.return=t);null!==g;){var l=g.dependencies;if(null!==l){s=g.child;for(var c=l.firstContext;null!==c;){if(c.context===i&&0!==(c.observedBits&r)){1===g.tag&&((c=cr(-1,n&-n)).tag=2,Ir(g,c)),g.lanes|=n,null!==(c=g.alternate)&&(c.lanes|=n),or(g.return,n),l.lanes|=n;break}c=c.next}}else s=10===g.tag&&g.type===t.type?null:g.child;if(null!==s)s.return=g;else for(s=g;null!==s;){if(s===t){s=null;break}if(null!==(g=s.sibling)){g.return=s.return,s=g;break}s=s.return}g=s}Ma(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,i=(r=t.pendingProps).children,rr(t,n),i=i(o=ar(o,r.unstable_observedBits)),t.flags|=1,Ma(e,t,i,n),t.child;case 14:return r=Oo(o=t.type,t.pendingProps),ka(e,t,o,r=Oo(o.type,r),i,n);case 15:return za(e,t,t.type,t.pendingProps,i,n);case 17:return i=t.type,o=t.pendingProps,o=t.elementType===i?o:Oo(i,o),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,po(i)?(e=!0,yo(t)):e=!1,rr(t,n),br(t,i,o),yr(t,i,o,n),Ua(null,t,i,!0,e,n);case 19:return os(e,t,n);case 23:case 24:return La(e,t,n)}throw Error(a(156,t.tag))},il.prototype.render=function(e){$g(e,this._internalRoot,null,null)},il.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;$g(null,e,null,(function(){t[$i]=null}))},et=function(e){13===e.tag&&(dg(e,4,Cg()),nl(e,4))},tt=function(e){13===e.tag&&(dg(e,67108864,Cg()),nl(e,67108864))},nt=function(e){if(13===e.tag){var t=Cg(),n=ug(e);dg(e,n,t),nl(e,n)}},it=function(e,t){return t()},we=function(e,t,n){switch(t){case"input":if(ne(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var o=oo(i);if(!o)throw Error(a(90));O(i),ne(i,o)}}}break;case"textarea":le(e,n);break;case"select":null!=(t=n.value)&&ae(e,!!n.multiple,t,!1)}},Xe=fg,He=function(e,t,n,i,o){var r=Xs;Xs|=4;try{return Do(98,e.bind(null,t,n,i,o))}finally{0===(Xs=r)&&(Ps(),Qo())}},Ye=function(){0===(49&Xs)&&(function(){if(null!==og){var e=og;og=null,e.forEach((function(e){e.expiredLanes|=24&e.pendingLanes,Ag(e,Eo())}))}Qo()}(),Kg())},Ke=function(e,t){var n=Xs;Xs|=2;try{return e(t)}finally{0===(Xs=n)&&(Ps(),Qo())}};var sl={Events:[no,io,oo,xe,Ve,Kg,{current:!1}]},gl={findFiberByHostInstance:to,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},ll={bundleType:gl.bundleType,version:gl.version,rendererPackageName:gl.rendererPackageName,rendererConfig:gl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:y.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=qe(e))?null:e.stateNode},findFiberByHostInstance:gl.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var cl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cl.isDisabled&&cl.supportsFiber)try{vo=cl.inject(ll),Bo=cl}catch(he){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sl,t.createPortal=al,t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw Error(a(268,Object.keys(e)))}return e=null===(e=qe(t))?null:e.stateNode},t.flushSync=function(e,t){var n=Xs;if(0!==(48&n))return e(t);Xs|=1;try{if(e)return Do(99,e.bind(null,t))}finally{Xs=n,Qo()}},t.hydrate=function(e,t,n){if(!ol(t))throw Error(a(200));return rl(null,e,t,!0,n)},t.render=function(e,t,n){if(!ol(t))throw Error(a(200));return rl(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!ol(e))throw Error(a(40));return!!e._reactRootContainer&&(yg((function(){rl(null,null,e,!1,(function(){e._reactRootContainer=null,e[$i]=null}))})),!0)},t.unstable_batchedUpdates=fg,t.unstable_createPortal=function(e,t){return al(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!ol(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return rl(e,t,n,!1,i)},t.version="17.0.2"},7950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(2730)},7251:function(e,t,n){var i,o,r;o=[t,n(75)],i=function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(t);function i(e){return e&&e.__esModule?e:{default:e}}e.default=n.default},void 0===(r="function"===typeof i?i.apply(t,o):i)||(e.exports=r)},75:function(e,t,n){var i,o,r;o=[t,n(5043),n(5173)],i=function(e,t,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setHasSupportToCaptureOption=u;var i=r(t),o=r(n);function r(e){return e&&e.__esModule?e:{default:e}}var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};function s(e,t){var n={};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function I(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var C=!1;function u(e){C=e}try{addEventListener("test",null,Object.defineProperty({},"capture",{get:function(){u(!0)}}))}catch(p){}function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{capture:!0};return C?e:e.capture}function h(e){if("touches"in e){var t=e.touches[0];return{x:t.pageX,y:t.pageY}}return{x:e.screenX,y:e.screenY}}var A=function(e){function t(){var e;g(this,t);for(var n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];var r=c(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i)));return r._handleSwipeStart=r._handleSwipeStart.bind(r),r._handleSwipeMove=r._handleSwipeMove.bind(r),r._handleSwipeEnd=r._handleSwipeEnd.bind(r),r._onMouseDown=r._onMouseDown.bind(r),r._onMouseMove=r._onMouseMove.bind(r),r._onMouseUp=r._onMouseUp.bind(r),r._setSwiperRef=r._setSwiperRef.bind(r),r}return I(t,e),l(t,[{key:"componentDidMount",value:function(){this.swiper&&this.swiper.addEventListener("touchmove",this._handleSwipeMove,d({capture:!0,passive:!1}))}},{key:"componentWillUnmount",value:function(){this.swiper&&this.swiper.removeEventListener("touchmove",this._handleSwipeMove,d({capture:!0,passive:!1}))}},{key:"_onMouseDown",value:function(e){this.props.allowMouseEvents&&(this.mouseDown=!0,document.addEventListener("mouseup",this._onMouseUp),document.addEventListener("mousemove",this._onMouseMove),this._handleSwipeStart(e))}},{key:"_onMouseMove",value:function(e){this.mouseDown&&this._handleSwipeMove(e)}},{key:"_onMouseUp",value:function(e){this.mouseDown=!1,document.removeEventListener("mouseup",this._onMouseUp),document.removeEventListener("mousemove",this._onMouseMove),this._handleSwipeEnd(e)}},{key:"_handleSwipeStart",value:function(e){var t=h(e),n=t.x,i=t.y;this.moveStart={x:n,y:i},this.props.onSwipeStart(e)}},{key:"_handleSwipeMove",value:function(e){if(this.moveStart){var t=h(e),n=t.x,i=t.y,o=n-this.moveStart.x,r=i-this.moveStart.y;this.moving=!0,this.props.onSwipeMove({x:o,y:r},e)&&e.cancelable&&e.preventDefault(),this.movePosition={deltaX:o,deltaY:r}}}},{key:"_handleSwipeEnd",value:function(e){this.props.onSwipeEnd(e);var t=this.props.tolerance;this.moving&&this.movePosition&&(this.movePosition.deltaX<-t?this.props.onSwipeLeft(1,e):this.movePosition.deltaX>t&&this.props.onSwipeRight(1,e),this.movePosition.deltaY<-t?this.props.onSwipeUp(1,e):this.movePosition.deltaY>t&&this.props.onSwipeDown(1,e)),this.moveStart=null,this.moving=!1,this.movePosition=null}},{key:"_setSwiperRef",value:function(e){this.swiper=e,this.props.innerRef(e)}},{key:"render",value:function(){var e=this.props,t=(e.tagName,e.className),n=e.style,o=e.children,r=(e.allowMouseEvents,e.onSwipeUp,e.onSwipeDown,e.onSwipeLeft,e.onSwipeRight,e.onSwipeStart,e.onSwipeMove,e.onSwipeEnd,e.innerRef,e.tolerance,s(e,["tagName","className","style","children","allowMouseEvents","onSwipeUp","onSwipeDown","onSwipeLeft","onSwipeRight","onSwipeStart","onSwipeMove","onSwipeEnd","innerRef","tolerance"]));return i.default.createElement(this.props.tagName,a({ref:this._setSwiperRef,onMouseDown:this._onMouseDown,onTouchStart:this._handleSwipeStart,onTouchEnd:this._handleSwipeEnd,className:t,style:n},r),o)}}]),t}(t.Component);A.displayName="ReactSwipe",A.propTypes={tagName:o.default.string,className:o.default.string,style:o.default.object,children:o.default.node,allowMouseEvents:o.default.bool,onSwipeUp:o.default.func,onSwipeDown:o.default.func,onSwipeLeft:o.default.func,onSwipeRight:o.default.func,onSwipeStart:o.default.func,onSwipeMove:o.default.func,onSwipeEnd:o.default.func,innerRef:o.default.func,tolerance:o.default.number.isRequired},A.defaultProps={tagName:"div",allowMouseEvents:!1,onSwipeUp:function(){},onSwipeDown:function(){},onSwipeLeft:function(){},onSwipeRight:function(){},onSwipeStart:function(){},onSwipeMove:function(){},onSwipeEnd:function(){},innerRef:function(){},tolerance:0},e.default=A},void 0===(r="function"===typeof i?i.apply(t,o):i)||(e.exports=r)},5082:(e,t)=>{"use strict";var n,i=Symbol.for("react.element"),o=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),g=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.server_context"),I=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),u=Symbol.for("react.suspense_list"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),A=Symbol.for("react.offscreen");function p(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case i:switch(e=e.type){case r:case s:case a:case C:case u:return e;default:switch(e=e&&e.$$typeof){case c:case l:case I:case h:case d:case g:return e;default:return t}}case o:return t}}}n=Symbol.for("react.module.reference"),t.ForwardRef=I,t.Memo=d},2086:(e,t,n)=>{"use strict";e.exports=n(5082)},6958:(e,t,n)=>{(e=n.nmd(e)).exports=function(t){var i={},o=n(2123),r=n(5043),a=n(8853);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var g=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=60103,c=60106,I=60107,C=60108,u=60114,d=60109,h=60110,A=60112,p=60113,m=60120,b=60115,f=60116,y=60121,G=60129,v=60130,B=60131;if("function"===typeof Symbol&&Symbol.for){var Z=Symbol.for;l=Z("react.element"),c=Z("react.portal"),I=Z("react.fragment"),C=Z("react.strict_mode"),u=Z("react.profiler"),d=Z("react.provider"),h=Z("react.context"),A=Z("react.forward_ref"),p=Z("react.suspense"),m=Z("react.suspense_list"),b=Z("react.memo"),f=Z("react.lazy"),y=Z("react.block"),Z("react.scope"),G=Z("react.debug_trace_mode"),v=Z("react.offscreen"),B=Z("react.legacy_hidden")}var w="function"===typeof Symbol&&Symbol.iterator;function W(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=w&&e[w]||e["@@iterator"])?e:null}function S(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case I:return"Fragment";case c:return"Portal";case u:return"Profiler";case C:return"StrictMode";case p:return"Suspense";case m:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case h:return(e.displayName||"Context")+".Consumer";case d:return(e._context.displayName||"Context")+".Provider";case A:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case b:return S(e.type);case y:return S(e._render);case f:t=e._payload,e=e._init;try{return S(e(t))}catch(n){}}return null}function R(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(1026&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function x(e){if(R(e)!==e)throw Error(s(188))}function V(e){var t=e.alternate;if(!t){if(null===(t=R(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,i=t;;){var o=n.return;if(null===o)break;var r=o.alternate;if(null===r){if(null!==(i=o.return)){n=i;continue}break}if(o.child===r.child){for(r=o.child;r;){if(r===n)return x(o),e;if(r===i)return x(o),t;r=r.sibling}throw Error(s(188))}if(n.return!==i.return)n=o,i=r;else{for(var a=!1,g=o.child;g;){if(g===n){a=!0,n=o,i=r;break}if(g===i){a=!0,i=o,n=r;break}g=g.sibling}if(!a){for(g=r.child;g;){if(g===n){a=!0,n=r,i=o;break}if(g===i){a=!0,i=r,n=o;break}g=g.sibling}if(!a)throw Error(s(189))}}if(n.alternate!==i)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}function X(e){if(!(e=V(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function H(e,t){for(var n=e.alternate;null!==t;){if(t===e||t===n)return!0;t=t.return}return!1}var Y,K=t.getPublicInstance,N=t.getRootHostContext,M=t.getChildHostContext,F=t.prepareForCommit,k=t.resetAfterCommit,z=t.createInstance,L=t.appendInitialChild,T=t.finalizeInitialChildren,E=t.prepareUpdate,J=t.shouldSetTextContent,U=t.createTextInstance,D=t.scheduleTimeout,P=t.cancelTimeout,Q=t.noTimeout,_=t.isPrimaryRenderer,j=t.supportsMutation,O=t.supportsPersistence,q=t.supportsHydration,$=t.getInstanceFromNode,ee=t.makeOpaqueHydratingObject,te=t.makeClientId,ne=t.beforeActiveInstanceBlur,ie=t.afterActiveInstanceBlur,oe=t.preparePortalMount,re=t.supportsTestSelectors,ae=t.findFiberRoot,se=t.getBoundingRect,ge=t.getTextContent,le=t.isHiddenSubtree,ce=t.matchAccessibilityRole,Ie=t.setFocusIfFocusable,Ce=t.setupIntersectionObserver,ue=t.appendChild,de=t.appendChildToContainer,he=t.commitTextUpdate,Ae=t.commitMount,pe=t.commitUpdate,me=t.insertBefore,be=t.insertInContainerBefore,fe=t.removeChild,ye=t.removeChildFromContainer,Ge=t.resetTextContent,ve=t.hideInstance,Be=t.hideTextInstance,Ze=t.unhideInstance,we=t.unhideTextInstance,We=t.clearContainer,Se=t.cloneInstance,Re=t.createContainerChildSet,xe=t.appendChildToContainerChildSet,Ve=t.finalizeContainerChildren,Xe=t.replaceContainerChildren,He=t.cloneHiddenInstance,Ye=t.cloneHiddenTextInstance,Ke=t.canHydrateInstance,Ne=t.canHydrateTextInstance,Me=t.isSuspenseInstancePending,Fe=t.isSuspenseInstanceFallback,ke=t.getNextHydratableSibling,ze=t.getFirstHydratableChild,Le=t.hydrateInstance,Te=t.hydrateTextInstance,Ee=t.getNextHydratableInstanceAfterSuspenseInstance,Je=t.commitHydratedContainer,Ue=t.commitHydratedSuspenseInstance;function De(e){if(void 0===Y)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Y=t&&t[1]||""}return"\n"+Y+e}var Pe=!1;function Qe(e,t){if(!e||Pe)return"";Pe=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(g){var i=g}Reflect.construct(e,[],t)}else{try{t.call()}catch(g){i=g}e.call(t.prototype)}else{try{throw Error()}catch(g){i=g}e()}}catch(g){if(g&&i&&"string"===typeof g.stack){for(var o=g.stack.split("\n"),r=i.stack.split("\n"),a=o.length-1,s=r.length-1;1<=a&&0<=s&&o[a]!==r[s];)s--;for(;1<=a&&0<=s;a--,s--)if(o[a]!==r[s]){if(1!==a||1!==s)do{if(a--,0>--s||o[a]!==r[s])return"\n"+o[a].replace(" at new "," at ")}while(1<=a&&0<=s);break}}}finally{Pe=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?De(e):""}var _e=[],je=-1;function Oe(e){return{current:e}}function qe(e){0>je||(e.current=_e[je],_e[je]=null,je--)}function $e(e,t){je++,_e[je]=e.current,e.current=t}var et={},tt=Oe(et),nt=Oe(!1),it=et;function ot(e,t){var n=e.type.contextTypes;if(!n)return et;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var o,r={};for(o in n)r[o]=t[o];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=r),r}function rt(e){return null!==(e=e.childContextTypes)&&void 0!==e}function at(){qe(nt),qe(tt)}function st(e,t,n){if(tt.current!==et)throw Error(s(168));$e(tt,t),$e(nt,n)}function gt(e,t,n){var i=e.stateNode;if(e=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var r in i=i.getChildContext())if(!(r in e))throw Error(s(108,S(t)||"Unknown",r));return o({},n,i)}function lt(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||et,it=tt.current,$e(tt,e),$e(nt,nt.current),!0}function ct(e,t,n){var i=e.stateNode;if(!i)throw Error(s(169));n?(e=gt(e,t,it),i.__reactInternalMemoizedMergedChildContext=e,qe(nt),qe(tt),$e(tt,e)):qe(nt),$e(nt,n)}var It=null,Ct=null;(0,a.unstable_now)();var ut=0,dt=8;function ht(e){if(0!==(1&e))return dt=15,1;if(0!==(2&e))return dt=14,2;if(0!==(4&e))return dt=13,4;var t=24&e;return 0!==t?(dt=12,t):0!==(32&e)?(dt=11,32):0!==(t=192&e)?(dt=10,t):0!==(256&e)?(dt=9,256):0!==(t=3584&e)?(dt=8,t):0!==(4096&e)?(dt=7,4096):0!==(t=4186112&e)?(dt=6,t):0!==(t=62914560&e)?(dt=5,t):67108864&e?(dt=4,67108864):0!==(134217728&e)?(dt=3,134217728):0!==(t=805306368&e)?(dt=2,t):0!==(1073741824&e)?(dt=1,1073741824):(dt=8,e)}function At(e,t){var n=e.pendingLanes;if(0===n)return dt=0;var i=0,o=0,r=e.expiredLanes,a=e.suspendedLanes,s=e.pingedLanes;if(0!==r)i=r,o=dt=15;else if(0!==(r=134217727&n)){var g=r&~a;0!==g?(i=ht(g),o=dt):0!==(s&=r)&&(i=ht(s),o=dt)}else 0!==(r=n&~a)?(i=ht(r),o=dt):0!==s&&(i=ht(s),o=dt);if(0===i)return 0;if(i=n&((0>(i=31-Gt(i))?0:1<<i)<<1)-1,0!==t&&t!==i&&0===(t&a)){if(ht(t),o<=dt)return t;dt=o}if(0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)o=1<<(n=31-Gt(t)),i|=e[n],t&=~o;return i}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(e,t){switch(e){case 15:return 1;case 14:return 2;case 12:return 0===(e=bt(24&~t))?mt(10,t):e;case 10:return 0===(e=bt(192&~t))?mt(8,t):e;case 8:return 0===(e=bt(3584&~t))&&(0===(e=bt(4186112&~t))&&(e=512)),e;case 2:return 0===(t=bt(805306368&~t))&&(t=268435456),t}throw Error(s(358,e))}function bt(e){return e&-e}function ft(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function yt(e,t,n){e.pendingLanes|=t;var i=t-1;e.suspendedLanes&=i,e.pingedLanes&=i,(e=e.eventTimes)[t=31-Gt(t)]=n}var Gt=Math.clz32?Math.clz32:function(e){return 0===e?32:31-(vt(e)/Bt|0)|0},vt=Math.log,Bt=Math.LN2;var Zt=a.unstable_runWithPriority,wt=a.unstable_scheduleCallback,Wt=a.unstable_cancelCallback,St=a.unstable_shouldYield,Rt=a.unstable_requestPaint,xt=a.unstable_now,Vt=a.unstable_getCurrentPriorityLevel,Xt=a.unstable_ImmediatePriority,Ht=a.unstable_UserBlockingPriority,Yt=a.unstable_NormalPriority,Kt=a.unstable_LowPriority,Nt=a.unstable_IdlePriority,Mt={},Ft=void 0!==Rt?Rt:function(){},kt=null,zt=null,Lt=!1,Tt=xt(),Et=1e4>Tt?xt:function(){return xt()-Tt};function Jt(){switch(Vt()){case Xt:return 99;case Ht:return 98;case Yt:return 97;case Kt:return 96;case Nt:return 95;default:throw Error(s(332))}}function Ut(e){switch(e){case 99:return Xt;case 98:return Ht;case 97:return Yt;case 96:return Kt;case 95:return Nt;default:throw Error(s(332))}}function Dt(e,t){return e=Ut(e),Zt(e,t)}function Pt(e,t,n){return e=Ut(e),wt(e,t,n)}function Qt(){if(null!==zt){var e=zt;zt=null,Wt(e)}_t()}function _t(){if(!Lt&&null!==kt){Lt=!0;var e=0;try{var t=kt;Dt(99,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}})),kt=null}catch(n){throw null!==kt&&(kt=kt.slice(e+1)),wt(Xt,Qt),n}finally{Lt=!1}}}var jt=g.ReactCurrentBatchConfig;var Ot="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},qt=Object.prototype.hasOwnProperty;function $t(e,t){if(Ot(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++)if(!qt.call(t,n[i])||!Ot(e[n[i]],t[n[i]]))return!1;return!0}function en(e){switch(e.tag){case 5:return De(e.type);case 16:return De("Lazy");case 13:return De("Suspense");case 19:return De("SuspenseList");case 0:case 2:case 15:return e=Qe(e.type,!1);case 11:return e=Qe(e.type.render,!1);case 22:return e=Qe(e.type._render,!1);case 1:return e=Qe(e.type,!0);default:return""}}function tn(e,t){if(e&&e.defaultProps){for(var n in t=o({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var nn=Oe(null),on=null,rn=null,an=null;function sn(){an=rn=on=null}function gn(e,t){e=e.type._context,_?($e(nn,e._currentValue),e._currentValue=t):($e(nn,e._currentValue2),e._currentValue2=t)}function ln(e){var t=nn.current;qe(nn),e=e.type._context,_?e._currentValue=t:e._currentValue2=t}function cn(e,t){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)===t){if(null===n||(n.childLanes&t)===t)break;n.childLanes|=t}else e.childLanes|=t,null!==n&&(n.childLanes|=t);e=e.return}}function In(e,t){on=e,an=rn=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Ti=!0),e.firstContext=null)}function Cn(e,t){if(an!==e&&!1!==t&&0!==t)if("number"===typeof t&&1073741823!==t||(an=e,t=1073741823),t={context:e,observedBits:t,next:null},null===rn){if(null===on)throw Error(s(308));rn=t,on.dependencies={lanes:0,firstContext:t,responders:null}}else rn=rn.next=t;return _?e._currentValue:e._currentValue2}var un=!1;function dn(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function hn(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function An(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function pn(e,t){if(null!==(e=e.updateQueue)){var n=(e=e.shared).pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function mn(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var o=null,r=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===r?o=r=a:r=r.next=a,n=n.next}while(null!==n);null===r?o=r=t:r=r.next=t}else o=r=t;return n={baseState:i.baseState,firstBaseUpdate:o,lastBaseUpdate:r,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function bn(e,t,n,i){var r=e.updateQueue;un=!1;var a=r.firstBaseUpdate,s=r.lastBaseUpdate,g=r.shared.pending;if(null!==g){r.shared.pending=null;var l=g,c=l.next;l.next=null,null===s?a=c:s.next=c,s=l;var I=e.alternate;if(null!==I){var C=(I=I.updateQueue).lastBaseUpdate;C!==s&&(null===C?I.firstBaseUpdate=c:C.next=c,I.lastBaseUpdate=l)}}if(null!==a){for(C=r.baseState,s=0,I=c=l=null;;){g=a.lane;var u=a.eventTime;if((i&g)===g){null!==I&&(I=I.next={eventTime:u,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var d=e,h=a;switch(g=t,u=n,h.tag){case 1:if("function"===typeof(d=h.payload)){C=d.call(u,C,g);break e}C=d;break e;case 3:d.flags=-4097&d.flags|64;case 0:if(null===(g="function"===typeof(d=h.payload)?d.call(u,C,g):d)||void 0===g)break e;C=o({},C,g);break e;case 2:un=!0}}null!==a.callback&&(e.flags|=32,null===(g=r.effects)?r.effects=[a]:g.push(a))}else u={eventTime:u,lane:g,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===I?(c=I=u,l=C):I=I.next=u,s|=g;if(null===(a=a.next)){if(null===(g=r.shared.pending))break;a=g.next,g.next=null,r.lastBaseUpdate=g,r.shared.pending=null}}null===I&&(l=C),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=I,Cr|=s,e.lanes=s,e.memoizedState=C}}function fn(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],o=i.callback;if(null!==o){if(i.callback=null,i=n,"function"!==typeof o)throw Error(s(191,o));o.call(i)}}}var yn=(new r.Component).refs;function Gn(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:o({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var vn={isMounted:function(e){return!!(e=e._reactInternals)&&R(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=Mr(),o=Fr(e),r=An(i,o);r.payload=t,void 0!==n&&null!==n&&(r.callback=n),pn(e,r),kr(e,o,i)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=Mr(),o=Fr(e),r=An(i,o);r.tag=1,r.payload=t,void 0!==n&&null!==n&&(r.callback=n),pn(e,r),kr(e,o,i)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Mr(),i=Fr(e),o=An(n,i);o.tag=2,void 0!==t&&null!==t&&(o.callback=t),pn(e,o),kr(e,i,n)}};function Bn(e,t,n,i,o,r,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,r,a):!t.prototype||!t.prototype.isPureReactComponent||(!$t(n,i)||!$t(o,r))}function Zn(e,t,n){var i=!1,o=et,r=t.contextType;return"object"===typeof r&&null!==r?r=Cn(r):(o=rt(t)?it:tt.current,r=(i=null!==(i=t.contextTypes)&&void 0!==i)?ot(e,o):et),t=new t(n,r),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=vn,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=r),t}function wn(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&vn.enqueueReplaceState(t,t.state,null)}function Wn(e,t,n,i){var o=e.stateNode;o.props=n,o.state=e.memoizedState,o.refs=yn,dn(e);var r=t.contextType;"object"===typeof r&&null!==r?o.context=Cn(r):(r=rt(t)?it:tt.current,o.context=ot(e,r)),bn(e,n,o,i),o.state=e.memoizedState,"function"===typeof(r=t.getDerivedStateFromProps)&&(Gn(e,t,r,n),o.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof o.getSnapshotBeforeUpdate||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||(t=o.state,"function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),t!==o.state&&vn.enqueueReplaceState(o,o.state,null),bn(e,n,o,i),o.state=e.memoizedState),"function"===typeof o.componentDidMount&&(e.flags|=4)}var Sn=Array.isArray;function Rn(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var i=n.stateNode}if(!i)throw Error(s(147,e));var o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=i.refs;t===yn&&(t=i.refs={}),null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(s(284));if(!n._owner)throw Error(s(290,e))}return e}function xn(e,t){if("textarea"!==e.type)throw Error(s(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t))}function Vn(e){function t(t,n){if(e){var i=t.lastEffect;null!==i?(i.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.flags=8}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function o(e,t){return(e=Ba(e,t)).index=0,e.sibling=null,e}function r(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags=2,n):i:(t.flags=2,n):n}function a(t){return e&&null===t.alternate&&(t.flags=2),t}function g(e,t,n,i){return null===t||6!==t.tag?((t=Sa(n,e.mode,i)).return=e,t):((t=o(t,n)).return=e,t)}function C(e,t,n,i){return null!==t&&t.elementType===n.type?((i=o(t,n.props)).ref=Rn(e,t,n),i.return=e,i):((i=Za(n.type,n.key,n.props,null,e.mode,i)).ref=Rn(e,t,n),i.return=e,i)}function u(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Ra(n,e.mode,i)).return=e,t):((t=o(t,n.children||[])).return=e,t)}function d(e,t,n,i,r){return null===t||7!==t.tag?((t=wa(n,e.mode,i,r)).return=e,t):((t=o(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t||"number"===typeof t)return(t=Sa(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case l:return(n=Za(t.type,t.key,t.props,null,e.mode,n)).ref=Rn(e,null,t),n.return=e,n;case c:return(t=Ra(t,e.mode,n)).return=e,t}if(Sn(t)||W(t))return(t=wa(t,e.mode,n,null)).return=e,t;xn(e,t)}return null}function A(e,t,n,i){var o=null!==t?t.key:null;if("string"===typeof n||"number"===typeof n)return null!==o?null:g(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case l:return n.key===o?n.type===I?d(e,t,n.props.children,i,o):C(e,t,n,i):null;case c:return n.key===o?u(e,t,n,i):null}if(Sn(n)||W(n))return null!==o?null:d(e,t,n,i,null);xn(e,n)}return null}function p(e,t,n,i,o){if("string"===typeof i||"number"===typeof i)return g(t,e=e.get(n)||null,""+i,o);if("object"===typeof i&&null!==i){switch(i.$$typeof){case l:return e=e.get(null===i.key?n:i.key)||null,i.type===I?d(t,e,i.props.children,o,i.key):C(t,e,i,o);case c:return u(t,e=e.get(null===i.key?n:i.key)||null,i,o)}if(Sn(i)||W(i))return d(t,e=e.get(n)||null,i,o,null);xn(t,i)}return null}function m(o,a,s,g){for(var l=null,c=null,I=a,C=a=0,u=null;null!==I&&C<s.length;C++){I.index>C?(u=I,I=null):u=I.sibling;var d=A(o,I,s[C],g);if(null===d){null===I&&(I=u);break}e&&I&&null===d.alternate&&t(o,I),a=r(d,a,C),null===c?l=d:c.sibling=d,c=d,I=u}if(C===s.length)return n(o,I),l;if(null===I){for(;C<s.length;C++)null!==(I=h(o,s[C],g))&&(a=r(I,a,C),null===c?l=I:c.sibling=I,c=I);return l}for(I=i(o,I);C<s.length;C++)null!==(u=p(I,o,C,s[C],g))&&(e&&null!==u.alternate&&I.delete(null===u.key?C:u.key),a=r(u,a,C),null===c?l=u:c.sibling=u,c=u);return e&&I.forEach((function(e){return t(o,e)})),l}function b(o,a,g,l){var c=W(g);if("function"!==typeof c)throw Error(s(150));if(null==(g=c.call(g)))throw Error(s(151));for(var I=c=null,C=a,u=a=0,d=null,m=g.next();null!==C&&!m.done;u++,m=g.next()){C.index>u?(d=C,C=null):d=C.sibling;var b=A(o,C,m.value,l);if(null===b){null===C&&(C=d);break}e&&C&&null===b.alternate&&t(o,C),a=r(b,a,u),null===I?c=b:I.sibling=b,I=b,C=d}if(m.done)return n(o,C),c;if(null===C){for(;!m.done;u++,m=g.next())null!==(m=h(o,m.value,l))&&(a=r(m,a,u),null===I?c=m:I.sibling=m,I=m);return c}for(C=i(o,C);!m.done;u++,m=g.next())null!==(m=p(C,o,u,m.value,l))&&(e&&null!==m.alternate&&C.delete(null===m.key?u:m.key),a=r(m,a,u),null===I?c=m:I.sibling=m,I=m);return e&&C.forEach((function(e){return t(o,e)})),c}return function(e,i,r,g){var C="object"===typeof r&&null!==r&&r.type===I&&null===r.key;C&&(r=r.props.children);var u="object"===typeof r&&null!==r;if(u)switch(r.$$typeof){case l:e:{for(u=r.key,C=i;null!==C;){if(C.key===u){if(7===C.tag){if(r.type===I){n(e,C.sibling),(i=o(C,r.props.children)).return=e,e=i;break e}}else if(C.elementType===r.type){n(e,C.sibling),(i=o(C,r.props)).ref=Rn(e,C,r),i.return=e,e=i;break e}n(e,C);break}t(e,C),C=C.sibling}r.type===I?((i=wa(r.props.children,e.mode,g,r.key)).return=e,e=i):((g=Za(r.type,r.key,r.props,null,e.mode,g)).ref=Rn(e,i,r),g.return=e,e=g)}return a(e);case c:e:{for(C=r.key;null!==i;){if(i.key===C){if(4===i.tag&&i.stateNode.containerInfo===r.containerInfo&&i.stateNode.implementation===r.implementation){n(e,i.sibling),(i=o(i,r.children||[])).return=e,e=i;break e}n(e,i);break}t(e,i),i=i.sibling}(i=Ra(r,e.mode,g)).return=e,e=i}return a(e)}if("string"===typeof r||"number"===typeof r)return r=""+r,null!==i&&6===i.tag?(n(e,i.sibling),(i=o(i,r)).return=e,e=i):(n(e,i),(i=Sa(r,e.mode,g)).return=e,e=i),a(e);if(Sn(r))return m(e,i,r,g);if(W(r))return b(e,i,r,g);if(u&&xn(e,r),"undefined"===typeof r&&!C)switch(e.tag){case 1:case 22:case 0:case 11:case 15:throw Error(s(152,S(e.type)||"Component"))}return n(e,i)}}var Xn=Vn(!0),Hn=Vn(!1),Yn={},Kn=Oe(Yn),Nn=Oe(Yn),Mn=Oe(Yn);function Fn(e){if(e===Yn)throw Error(s(174));return e}function kn(e,t){$e(Mn,t),$e(Nn,e),$e(Kn,Yn),e=N(t),qe(Kn),$e(Kn,e)}function zn(){qe(Kn),qe(Nn),qe(Mn)}function Ln(e){var t=Fn(Mn.current),n=Fn(Kn.current);n!==(t=M(n,e.type,t))&&($e(Nn,e),$e(Kn,t))}function Tn(e){Nn.current===e&&(qe(Kn),qe(Nn))}var En=Oe(0);function Jn(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||Me(n)||Fe(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(64&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Un=null,Dn=null,Pn=!1;function Qn(e,t){var n=Ga(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.flags=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function _n(e,t){switch(e.tag){case 5:return null!==(t=Ke(t,e.type,e.pendingProps))&&(e.stateNode=t,!0);case 6:return null!==(t=Ne(t,e.pendingProps))&&(e.stateNode=t,!0);default:return!1}}function jn(e){if(Pn){var t=Dn;if(t){var n=t;if(!_n(e,t)){if(!(t=ke(n))||!_n(e,t))return e.flags=-1025&e.flags|2,Pn=!1,void(Un=e);Qn(Un,n)}Un=e,Dn=ze(t)}else e.flags=-1025&e.flags|2,Pn=!1,Un=e}}function On(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Un=e}function qn(e){if(!q||e!==Un)return!1;if(!Pn)return On(e),Pn=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!J(t,e.memoizedProps))for(t=Dn;t;)Qn(e,t),t=ke(t);if(On(e),13===e.tag){if(!q)throw Error(s(316));if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));Dn=Ee(e)}else Dn=Un?ke(e.stateNode):null;return!0}function $n(){q&&(Dn=Un=null,Pn=!1)}var ei=[];function ti(){for(var e=0;e<ei.length;e++){var t=ei[e];_?t._workInProgressVersionPrimary=null:t._workInProgressVersionSecondary=null}ei.length=0}var ni=g.ReactCurrentDispatcher,ii=g.ReactCurrentBatchConfig,oi=0,ri=null,ai=null,si=null,gi=!1,li=!1;function ci(){throw Error(s(321))}function Ii(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!Ot(e[n],t[n]))return!1;return!0}function Ci(e,t,n,i,o,r){if(oi=r,ri=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ni.current=null===e||null===e.memoizedState?Fi:ki,e=n(i,o),li){r=0;do{if(li=!1,!(25>r))throw Error(s(301));r+=1,si=ai=null,t.updateQueue=null,ni.current=zi,e=n(i,o)}while(li)}if(ni.current=Mi,t=null!==ai&&null!==ai.next,oi=0,si=ai=ri=null,gi=!1,t)throw Error(s(300));return e}function ui(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===si?ri.memoizedState=si=e:si=si.next=e,si}function di(){if(null===ai){var e=ri.alternate;e=null!==e?e.memoizedState:null}else e=ai.next;var t=null===si?ri.memoizedState:si.next;if(null!==t)si=t,ai=e;else{if(null===e)throw Error(s(310));e={memoizedState:(ai=e).memoizedState,baseState:ai.baseState,baseQueue:ai.baseQueue,queue:ai.queue,next:null},null===si?ri.memoizedState=si=e:si=si.next=e}return si}function hi(e,t){return"function"===typeof t?t(e):t}function Ai(e){var t=di(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var i=ai,o=i.baseQueue,r=n.pending;if(null!==r){if(null!==o){var a=o.next;o.next=r.next,r.next=a}i.baseQueue=o=r,n.pending=null}if(null!==o){o=o.next,i=i.baseState;var g=a=r=null,l=o;do{var c=l.lane;if((oi&c)===c)null!==g&&(g=g.next={lane:0,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null}),i=l.eagerReducer===e?l.eagerState:e(i,l.action);else{var I={lane:c,action:l.action,eagerReducer:l.eagerReducer,eagerState:l.eagerState,next:null};null===g?(a=g=I,r=i):g=g.next=I,ri.lanes|=c,Cr|=c}l=l.next}while(null!==l&&l!==o);null===g?r=i:g.next=a,Ot(i,t.memoizedState)||(Ti=!0),t.memoizedState=i,t.baseState=r,t.baseQueue=g,n.lastRenderedState=i}return[t.memoizedState,n.dispatch]}function pi(e){var t=di(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var i=n.dispatch,o=n.pending,r=t.memoizedState;if(null!==o){n.pending=null;var a=o=o.next;do{r=e(r,a.action),a=a.next}while(a!==o);Ot(r,t.memoizedState)||(Ti=!0),t.memoizedState=r,null===t.baseQueue&&(t.baseState=r),n.lastRenderedState=r}return[r,i]}function mi(e,t,n){var i=t._getVersion;i=i(t._source);var o=_?t._workInProgressVersionPrimary:t._workInProgressVersionSecondary;if(null!==o?e=o===i:(e=e.mutableReadLanes,(e=(oi&e)===e)&&(_?t._workInProgressVersionPrimary=i:t._workInProgressVersionSecondary=i,ei.push(t))),e)return n(t._source);throw ei.push(t),Error(s(350))}function bi(e,t,n,i){var o=or;if(null===o)throw Error(s(349));var r=t._getVersion,a=r(t._source),g=ni.current,l=g.useState((function(){return mi(o,t,n)})),c=l[1],I=l[0];l=si;var C=e.memoizedState,u=C.refs,d=u.getSnapshot,h=C.source;C=C.subscribe;var A=ri;return e.memoizedState={refs:u,source:t,subscribe:i},g.useEffect((function(){u.getSnapshot=n,u.setSnapshot=c;var e=r(t._source);if(!Ot(a,e)){e=n(t._source),Ot(I,e)||(c(e),e=Fr(A),o.mutableReadLanes|=e&o.pendingLanes),e=o.mutableReadLanes,o.entangledLanes|=e;for(var i=o.entanglements,s=e;0<s;){var g=31-Gt(s),l=1<<g;i[g]|=e,s&=~l}}}),[n,t,i]),g.useEffect((function(){return i(t._source,(function(){var e=u.getSnapshot,n=u.setSnapshot;try{n(e(t._source));var i=Fr(A);o.mutableReadLanes|=i&o.pendingLanes}catch(r){n((function(){throw r}))}}))}),[t,i]),Ot(d,n)&&Ot(h,t)&&Ot(C,i)||((e={pending:null,dispatch:null,lastRenderedReducer:hi,lastRenderedState:I}).dispatch=c=Ni.bind(null,ri,e),l.queue=e,l.baseQueue=null,I=mi(o,t,n),l.memoizedState=l.baseState=I),I}function fi(e,t,n){return bi(di(),e,t,n)}function yi(e){var t=ui();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:hi,lastRenderedState:e}).dispatch=Ni.bind(null,ri,e),[t.memoizedState,e]}function Gi(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=ri.updateQueue)?(t={lastEffect:null},ri.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function vi(e){return e={current:e},ui().memoizedState=e}function Bi(){return di().memoizedState}function Zi(e,t,n,i){var o=ui();ri.flags|=e,o.memoizedState=Gi(1|t,n,void 0,void 0===i?null:i)}function wi(e,t,n,i){var o=di();i=void 0===i?null:i;var r=void 0;if(null!==ai){var a=ai.memoizedState;if(r=a.destroy,null!==i&&Ii(i,a.deps))return void Gi(t,n,r,i)}ri.flags|=e,o.memoizedState=Gi(1|t,n,r,i)}function Wi(e,t){return Zi(516,4,e,t)}function Si(e,t){return wi(516,4,e,t)}function Ri(e,t){return wi(4,2,e,t)}function xi(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Vi(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,wi(4,2,xi.bind(null,t,e),n)}function Xi(){}function Hi(e,t){var n=di();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&Ii(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Yi(e,t){var n=di();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&Ii(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Ki(e,t){var n=Jt();Dt(98>n?98:n,(function(){e(!0)})),Dt(97<n?97:n,(function(){var n=ii.transition;ii.transition=1;try{e(!1),t()}finally{ii.transition=n}}))}function Ni(e,t,n){var i=Mr(),o=Fr(e),r={lane:o,action:n,eagerReducer:null,eagerState:null,next:null},a=t.pending;if(null===a?r.next=r:(r.next=a.next,a.next=r),t.pending=r,a=e.alternate,e===ri||null!==a&&a===ri)li=gi=!0;else{if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var s=t.lastRenderedState,g=a(s,n);if(r.eagerReducer=a,r.eagerState=g,Ot(g,s))return}catch(l){}kr(e,o,i)}}var Mi={readContext:Cn,useCallback:ci,useContext:ci,useEffect:ci,useImperativeHandle:ci,useLayoutEffect:ci,useMemo:ci,useReducer:ci,useRef:ci,useState:ci,useDebugValue:ci,useDeferredValue:ci,useTransition:ci,useMutableSource:ci,useOpaqueIdentifier:ci,unstable_isNewReconciler:!1},Fi={readContext:Cn,useCallback:function(e,t){return ui().memoizedState=[e,void 0===t?null:t],e},useContext:Cn,useEffect:Wi,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Zi(4,2,xi.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Zi(4,2,e,t)},useMemo:function(e,t){var n=ui();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=ui();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e=(e=i.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=Ni.bind(null,ri,e),[i.memoizedState,e]},useRef:vi,useState:yi,useDebugValue:Xi,useDeferredValue:function(e){var t=yi(e),n=t[0],i=t[1];return Wi((function(){var t=ii.transition;ii.transition=1;try{i(e)}finally{ii.transition=t}}),[e]),n},useTransition:function(){var e=yi(!1),t=e[0];return vi(e=Ki.bind(null,e[1])),[e,t]},useMutableSource:function(e,t,n){var i=ui();return i.memoizedState={refs:{getSnapshot:t,setSnapshot:null},source:e,subscribe:n},bi(i,e,t,n)},useOpaqueIdentifier:function(){if(Pn){var e=!1,t=ee((function(){throw e||(e=!0,n(te())),Error(s(355))})),n=yi(t)[1];return 0===(2&ri.mode)&&(ri.flags|=516,Gi(5,(function(){n(te())}),void 0,null)),t}return yi(t=te()),t},unstable_isNewReconciler:!1},ki={readContext:Cn,useCallback:Hi,useContext:Cn,useEffect:Si,useImperativeHandle:Vi,useLayoutEffect:Ri,useMemo:Yi,useReducer:Ai,useRef:Bi,useState:function(){return Ai(hi)},useDebugValue:Xi,useDeferredValue:function(e){var t=Ai(hi),n=t[0],i=t[1];return Si((function(){var t=ii.transition;ii.transition=1;try{i(e)}finally{ii.transition=t}}),[e]),n},useTransition:function(){var e=Ai(hi)[0];return[Bi().current,e]},useMutableSource:fi,useOpaqueIdentifier:function(){return Ai(hi)[0]},unstable_isNewReconciler:!1},zi={readContext:Cn,useCallback:Hi,useContext:Cn,useEffect:Si,useImperativeHandle:Vi,useLayoutEffect:Ri,useMemo:Yi,useReducer:pi,useRef:Bi,useState:function(){return pi(hi)},useDebugValue:Xi,useDeferredValue:function(e){var t=pi(hi),n=t[0],i=t[1];return Si((function(){var t=ii.transition;ii.transition=1;try{i(e)}finally{ii.transition=t}}),[e]),n},useTransition:function(){var e=pi(hi)[0];return[Bi().current,e]},useMutableSource:fi,useOpaqueIdentifier:function(){return pi(hi)[0]},unstable_isNewReconciler:!1},Li=g.ReactCurrentOwner,Ti=!1;function Ei(e,t,n,i){t.child=null===e?Hn(t,null,n,i):Xn(t,e.child,n,i)}function Ji(e,t,n,i,o){n=n.render;var r=t.ref;return In(t,o),i=Ci(e,t,n,i,r,o),null===e||Ti?(t.flags|=1,Ei(e,t,i,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~o,Io(e,t,o))}function Ui(e,t,n,i,o,r){if(null===e){var a=n.type;return"function"!==typeof a||va(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Za(n.type,null,i,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Di(e,t,a,i,o,r))}return a=e.child,0===(o&r)&&(o=a.memoizedProps,(n=null!==(n=n.compare)?n:$t)(o,i)&&e.ref===t.ref)?Io(e,t,r):(t.flags|=1,(e=Ba(a,i)).ref=t.ref,e.return=t,t.child=e)}function Di(e,t,n,i,o,r){if(null!==e&&$t(e.memoizedProps,i)&&e.ref===t.ref){if(Ti=!1,0===(r&o))return t.lanes=e.lanes,Io(e,t,r);0!==(16384&e.flags)&&(Ti=!0)}return _i(e,t,n,i,r)}function Pi(e,t,n){var i=t.pendingProps,o=i.children,r=null!==e?e.memoizedState:null;if("hidden"===i.mode||"unstable-defer-without-hiding"===i.mode)if(0===(4&t.mode))t.memoizedState={baseLanes:0},Pr(t,n);else{if(0===(1073741824&n))return e=null!==r?r.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e},Pr(t,e),null;t.memoizedState={baseLanes:0},Pr(t,null!==r?r.baseLanes:n)}else null!==r?(i=r.baseLanes|n,t.memoizedState=null):i=n,Pr(t,i);return Ei(e,t,o,n),t.child}function Qi(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=128)}function _i(e,t,n,i,o){var r=rt(n)?it:tt.current;return r=ot(t,r),In(t,o),n=Ci(e,t,n,i,r,o),null===e||Ti?(t.flags|=1,Ei(e,t,n,o),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~o,Io(e,t,o))}function ji(e,t,n,i,o){if(rt(n)){var r=!0;lt(t)}else r=!1;if(In(t,o),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),Zn(t,n,i),Wn(t,n,i,o),i=!0;else if(null===e){var a=t.stateNode,s=t.memoizedProps;a.props=s;var g=a.context,l=n.contextType;"object"===typeof l&&null!==l?l=Cn(l):l=ot(t,l=rt(n)?it:tt.current);var c=n.getDerivedStateFromProps,I="function"===typeof c||"function"===typeof a.getSnapshotBeforeUpdate;I||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==i||g!==l)&&wn(t,a,i,l),un=!1;var C=t.memoizedState;a.state=C,bn(t,i,a,o),g=t.memoizedState,s!==i||C!==g||nt.current||un?("function"===typeof c&&(Gn(t,n,c,i),g=t.memoizedState),(s=un||Bn(t,n,s,i,C,g,l))?(I||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4)):("function"===typeof a.componentDidMount&&(t.flags|=4),t.memoizedProps=i,t.memoizedState=g),a.props=i,a.state=g,a.context=l,i=s):("function"===typeof a.componentDidMount&&(t.flags|=4),i=!1)}else{a=t.stateNode,hn(e,t),s=t.memoizedProps,l=t.type===t.elementType?s:tn(t.type,s),a.props=l,I=t.pendingProps,C=a.context,"object"===typeof(g=n.contextType)&&null!==g?g=Cn(g):g=ot(t,g=rt(n)?it:tt.current);var u=n.getDerivedStateFromProps;(c="function"===typeof u||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==I||C!==g)&&wn(t,a,i,g),un=!1,C=t.memoizedState,a.state=C,bn(t,i,a,o);var d=t.memoizedState;s!==I||C!==d||nt.current||un?("function"===typeof u&&(Gn(t,n,u,i),d=t.memoizedState),(l=un||Bn(t,n,l,i,C,d,g))?(c||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(i,d,g),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(i,d,g)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=256)):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&C===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&C===e.memoizedState||(t.flags|=256),t.memoizedProps=i,t.memoizedState=d),a.props=i,a.state=d,a.context=g,i=l):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&C===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&C===e.memoizedState||(t.flags|=256),i=!1)}return Oi(e,t,n,i,r,o)}function Oi(e,t,n,i,o,r){Qi(e,t);var a=0!==(64&t.flags);if(!i&&!a)return o&&ct(t,n,!1),Io(e,t,r);i=t.stateNode,Li.current=t;var s=a&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&a?(t.child=Xn(t,e.child,null,r),t.child=Xn(t,null,s,r)):Ei(e,t,s,r),t.memoizedState=i.state,o&&ct(t,n,!0),t.child}function qi(e){var t=e.stateNode;t.pendingContext?st(0,t.pendingContext,t.pendingContext!==t.context):t.context&&st(0,t.context,!1),kn(e,t.containerInfo)}var $i,eo,to,no,io={dehydrated:null,retryLane:0};function oo(e,t,n){var i,o=t.pendingProps,r=En.current,a=!1;return(i=0!==(64&t.flags))||(i=(null===e||null!==e.memoizedState)&&0!==(2&r)),i?(a=!0,t.flags&=-65):null!==e&&null===e.memoizedState||void 0===o.fallback||!0===o.unstable_avoidThisFallback||(r|=1),$e(En,1&r),null===e?(void 0!==o.fallback&&jn(t),e=o.children,r=o.fallback,a?(e=ro(t,e,r,n),t.child.memoizedState={baseLanes:n},t.memoizedState=io,e):"number"===typeof o.unstable_expectedLoadTime?(e=ro(t,e,r,n),t.child.memoizedState={baseLanes:n},t.memoizedState=io,t.lanes=33554432,e):((n=Wa({mode:"visible",children:e},t.mode,n,null)).return=t,t.child=n)):(e.memoizedState,a?(o=so(e,t,o.children,o.fallback,n),a=t.child,r=e.child.memoizedState,a.memoizedState=null===r?{baseLanes:n}:{baseLanes:r.baseLanes|n},a.childLanes=e.childLanes&~n,t.memoizedState=io,o):(n=ao(e,t,o.children,n),t.memoizedState=null,n))}function ro(e,t,n,i){var o=e.mode,r=e.child;return t={mode:"hidden",children:t},0===(2&o)&&null!==r?(r.childLanes=0,r.pendingProps=t):r=Wa(t,o,0,null),n=wa(n,o,i,null),r.return=e,n.return=e,r.sibling=n,e.child=r,n}function ao(e,t,n,i){var o=e.child;return e=o.sibling,n=Ba(o,{mode:"visible",children:n}),0===(2&t.mode)&&(n.lanes=i),n.return=t,n.sibling=null,null!==e&&(e.nextEffect=null,e.flags=8,t.firstEffect=t.lastEffect=e),t.child=n}function so(e,t,n,i,o){var r=t.mode,a=e.child;e=a.sibling;var s={mode:"hidden",children:n};return 0===(2&r)&&t.child!==a?((n=t.child).childLanes=0,n.pendingProps=s,null!==(a=n.lastEffect)?(t.firstEffect=n.firstEffect,t.lastEffect=a,a.nextEffect=null):t.firstEffect=t.lastEffect=null):n=Ba(a,s),null!==e?i=Ba(e,i):(i=wa(i,r,o,null)).flags|=2,i.return=t,n.return=t,n.sibling=i,t.child=n,i}function go(e,t){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),cn(e.return,t)}function lo(e,t,n,i,o,r){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:o,lastEffect:r}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=n,a.tailMode=o,a.lastEffect=r)}function co(e,t,n){var i=t.pendingProps,o=i.revealOrder,r=i.tail;if(Ei(e,t,i.children,n),0!==(2&(i=En.current)))i=1&i|2,t.flags|=64;else{if(null!==e&&0!==(64&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&go(e,n);else if(19===e.tag)go(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if($e(En,i),0===(2&t.mode))t.memoizedState=null;else switch(o){case"forwards":for(n=t.child,o=null;null!==n;)null!==(e=n.alternate)&&null===Jn(e)&&(o=n),n=n.sibling;null===(n=o)?(o=t.child,t.child=null):(o=n.sibling,n.sibling=null),lo(t,!1,o,n,r,t.lastEffect);break;case"backwards":for(n=null,o=t.child,t.child=null;null!==o;){if(null!==(e=o.alternate)&&null===Jn(e)){t.child=o;break}e=o.sibling,o.sibling=n,n=o,o=e}lo(t,!0,n,null,r,t.lastEffect);break;case"together":lo(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function Io(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Cr|=t.lanes,0!==(n&t.childLanes)){if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=Ba(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Ba(e,e.pendingProps)).return=t;n.sibling=null}return t.child}return null}function Co(e){e.flags|=4}if(j)$i=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)L(e,n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},eo=function(){},to=function(e,t,n,i,o){if((e=e.memoizedProps)!==i){var r=t.stateNode,a=Fn(Kn.current);n=E(r,n,e,i,o,a),(t.updateQueue=n)&&Co(t)}},no=function(e,t,n,i){n!==i&&Co(t)};else if(O){$i=function(e,t,n,i){for(var o=t.child;null!==o;){if(5===o.tag){var r=o.stateNode;n&&i&&(r=He(r,o.type,o.memoizedProps,o)),L(e,r)}else if(6===o.tag)r=o.stateNode,n&&i&&(r=Ye(r,o.memoizedProps,o)),L(e,r);else if(4!==o.tag){if(13===o.tag&&0!==(4&o.flags)&&(r=null!==o.memoizedState)){var a=o.child;if(null!==a&&(null!==a.child&&(a.child.return=a,$i(e,a,!0,r)),null!==(r=a.sibling))){r.return=o,o=r;continue}}if(null!==o.child){o.child.return=o,o=o.child;continue}}if(o===t)break;for(;null===o.sibling;){if(null===o.return||o.return===t)return;o=o.return}o.sibling.return=o.return,o=o.sibling}};var uo=function(e,t,n,i){for(var o=t.child;null!==o;){if(5===o.tag){var r=o.stateNode;n&&i&&(r=He(r,o.type,o.memoizedProps,o)),xe(e,r)}else if(6===o.tag)r=o.stateNode,n&&i&&(r=Ye(r,o.memoizedProps,o)),xe(e,r);else if(4!==o.tag){if(13===o.tag&&0!==(4&o.flags)&&(r=null!==o.memoizedState)){var a=o.child;if(null!==a&&(null!==a.child&&(a.child.return=a,uo(e,a,!0,r)),null!==(r=a.sibling))){r.return=o,o=r;continue}}if(null!==o.child){o.child.return=o,o=o.child;continue}}if(o===t)break;for(;null===o.sibling;){if(null===o.return||o.return===t)return;o=o.return}o.sibling.return=o.return,o=o.sibling}};eo=function(e){var t=e.stateNode;if(null!==e.firstEffect){var n=t.containerInfo,i=Re(n);uo(i,e,!1,!1),t.pendingChildren=i,Co(e),Ve(n,i)}},to=function(e,t,n,i,o){var r=e.stateNode,a=e.memoizedProps;if((e=null===t.firstEffect)&&a===i)t.stateNode=r;else{var s=t.stateNode,g=Fn(Kn.current),l=null;a!==i&&(l=E(s,n,a,i,o,g)),e&&null===l?t.stateNode=r:(r=Se(r,l,n,a,i,t,e,s),T(r,n,i,o,g)&&Co(t),t.stateNode=r,e?Co(t):$i(r,t,!1,!1))}},no=function(e,t,n,i){n!==i?(e=Fn(Mn.current),n=Fn(Kn.current),t.stateNode=U(i,e,n,t),Co(t)):t.stateNode=e.stateNode}}else eo=function(){},to=function(){},no=function(){};function ho(e,t){if(!Pn)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Ao(e,t,n){var i=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:case 17:return rt(t.type)&&at(),null;case 3:return zn(),qe(nt),qe(tt),ti(),(i=t.stateNode).pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(qn(t)?Co(t):i.hydrate||(t.flags|=256)),eo(t),null;case 5:Tn(t);var o=Fn(Mn.current);if(n=t.type,null!==e&&null!=t.stateNode)to(e,t,n,i,o),e.ref!==t.ref&&(t.flags|=128);else{if(!i){if(null===t.stateNode)throw Error(s(166));return null}if(e=Fn(Kn.current),qn(t)){if(!q)throw Error(s(175));e=Le(t.stateNode,t.type,t.memoizedProps,o,e,t),t.updateQueue=e,null!==e&&Co(t)}else{var r=z(n,i,o,e,t);$i(r,t,!1,!1),t.stateNode=r,T(r,n,i,o,e)&&Co(t)}null!==t.ref&&(t.flags|=128)}return null;case 6:if(e&&null!=t.stateNode)no(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(s(166));if(e=Fn(Mn.current),o=Fn(Kn.current),qn(t)){if(!q)throw Error(s(176));Te(t.stateNode,t.memoizedProps,t)&&Co(t)}else t.stateNode=U(i,e,o,t)}return null;case 13:return qe(En),i=t.memoizedState,0!==(64&t.flags)?(t.lanes=n,t):(i=null!==i,o=!1,null===e?void 0!==t.memoizedProps.fallback&&qn(t):o=null!==e.memoizedState,i&&!o&&0!==(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!==(1&En.current)?0===lr&&(lr=3):(0!==lr&&3!==lr||(lr=4),null===or||0===(134217727&Cr)&&0===(134217727&ur)||Er(or,ar))),O&&i&&(t.flags|=4),j&&(i||o)&&(t.flags|=4),null);case 4:return zn(),eo(t),null===e&&oe(t.stateNode.containerInfo),null;case 10:return ln(t),null;case 19:if(qe(En),null===(i=t.memoizedState))return null;if(o=0!==(64&t.flags),null===(r=i.rendering))if(o)ho(i,!1);else{if(0!==lr||null!==e&&0!==(64&e.flags))for(e=t.child;null!==e;){if(null!==(r=Jn(e))){for(t.flags|=64,ho(i,!1),null!==(e=r.updateQueue)&&(t.updateQueue=e,t.flags|=4),null===i.lastEffect&&(t.firstEffect=null),t.lastEffect=i.lastEffect,e=n,i=t.child;null!==i;)n=e,(o=i).flags&=2,o.nextEffect=null,o.firstEffect=null,o.lastEffect=null,null===(r=o.alternate)?(o.childLanes=0,o.lanes=n,o.child=null,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=r.childLanes,o.lanes=r.lanes,o.child=r.child,o.memoizedProps=r.memoizedProps,o.memoizedState=r.memoizedState,o.updateQueue=r.updateQueue,o.type=r.type,n=r.dependencies,o.dependencies=null===n?null:{lanes:n.lanes,firstContext:n.firstContext}),i=i.sibling;return $e(En,1&En.current|2),t.child}e=e.sibling}null!==i.tail&&Et()>pr&&(t.flags|=64,o=!0,ho(i,!1),t.lanes=33554432)}else{if(!o)if(null!==(e=Jn(r))){if(t.flags|=64,o=!0,null!==(e=e.updateQueue)&&(t.updateQueue=e,t.flags|=4),ho(i,!0),null===i.tail&&"hidden"===i.tailMode&&!r.alternate&&!Pn)return null!==(t=t.lastEffect=i.lastEffect)&&(t.nextEffect=null),null}else 2*Et()-i.renderingStartTime>pr&&1073741824!==n&&(t.flags|=64,o=!0,ho(i,!1),t.lanes=33554432);i.isBackwards?(r.sibling=t.child,t.child=r):(null!==(e=i.last)?e.sibling=r:t.child=r,i.last=r)}return null!==i.tail?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.lastEffect=t.lastEffect,i.renderingStartTime=Et(),e.sibling=null,t=En.current,$e(En,o?1&t|2:1&t),e):null;case 23:case 24:return Qr(),null!==e&&null!==e.memoizedState!==(null!==t.memoizedState)&&"unstable-defer-without-hiding"!==i.mode&&(t.flags|=4),null}throw Error(s(156,t.tag))}function po(e){switch(e.tag){case 1:rt(e.type)&&at();var t=e.flags;return 4096&t?(e.flags=-4097&t|64,e):null;case 3:if(zn(),qe(nt),qe(tt),ti(),0!==(64&(t=e.flags)))throw Error(s(285));return e.flags=-4097&t|64,e;case 5:return Tn(e),null;case 13:return qe(En),4096&(t=e.flags)?(e.flags=-4097&t|64,e):null;case 19:return qe(En),null;case 4:return zn(),null;case 10:return ln(e),null;case 23:case 24:return Qr(),null;default:return null}}function mo(e,t){try{var n="",i=t;do{n+=en(i),i=i.return}while(i);var o=n}catch(r){o="\nError generating stack: "+r.message+"\n"+r.stack}return{value:e,source:t,stack:o}}function bo(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var fo="function"===typeof WeakMap?WeakMap:Map;function yo(e,t,n){(n=An(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){yr||(yr=!0,Gr=i),bo(0,t)},n}function Go(e,t,n){(n=An(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var o=t.value;n.payload=function(){return bo(0,t),i(o)}}var r=e.stateNode;return null!==r&&"function"===typeof r.componentDidCatch&&(n.callback=function(){"function"!==typeof i&&(null===vr?vr=new Set([this]):vr.add(this),bo(0,t));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}var vo="function"===typeof WeakSet?WeakSet:Set;function Bo(e){var t=e.ref;if(null!==t)if("function"===typeof t)try{t(null)}catch(n){Ia(e,n)}else t.current=null}function Zo(e,t){switch(t.tag){case 0:case 11:case 15:case 22:case 5:case 6:case 4:case 17:return;case 1:if(256&t.flags&&null!==e){var n=e.memoizedProps,i=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:tn(t.type,n),i),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:return void(j&&256&t.flags&&We(t.stateNode.containerInfo))}throw Error(s(163))}function wo(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.destroy;n.destroy=void 0,void 0!==i&&i()}n=n.next}while(n!==t)}}function Wo(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{if(3===(3&e.tag)){var i=e.create;e.destroy=i()}e=e.next}while(e!==t)}if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{var o=e;i=o.next,0!==(4&(o=o.tag))&&0!==(1&o)&&(ga(n,e),sa(n,e)),e=i}while(e!==t)}return;case 1:return e=n.stateNode,4&n.flags&&(null===t?e.componentDidMount():(i=n.elementType===n.type?t.memoizedProps:tn(n.type,t.memoizedProps),e.componentDidUpdate(i,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate))),void(null!==(t=n.updateQueue)&&fn(n,t,e));case 3:if(null!==(t=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 5:e=K(n.child.stateNode);break;case 1:e=n.child.stateNode}fn(n,t,e)}return;case 5:return e=n.stateNode,void(null===t&&4&n.flags&&Ae(e,n.type,n.memoizedProps,n));case 6:case 4:case 12:case 19:case 17:case 20:case 21:case 23:case 24:return;case 13:return void(q&&null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&Ue(n)))))}throw Error(s(163))}function So(e,t){if(j)for(var n=e;;){if(5===n.tag){var i=n.stateNode;t?ve(i):Ze(n.stateNode,n.memoizedProps)}else if(6===n.tag)i=n.stateNode,t?Be(i):we(i,n.memoizedProps);else if((23!==n.tag&&24!==n.tag||null===n.memoizedState||n===e)&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}function Ro(e,t){if(Ct&&"function"===typeof Ct.onCommitFiberUnmount)try{Ct.onCommitFiberUnmount(It,t)}catch(r){}switch(t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var n=e=e.next;do{var i=n,o=i.destroy;if(i=i.tag,void 0!==o)if(0!==(4&i))ga(t,n);else{i=t;try{o()}catch(r){Ia(i,r)}}n=n.next}while(n!==e)}break;case 1:if(Bo(t),"function"===typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(r){Ia(t,r)}break;case 5:Bo(t);break;case 4:j?No(e,t):O&&O&&(t=t.stateNode.containerInfo,e=Re(t),Xe(t,e))}}function xo(e,t){for(var n=t;;)if(Ro(e,n),null===n.child||j&&4===n.tag){if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}else n.child.return=n,n=n.child}function Vo(e){e.alternate=null,e.child=null,e.dependencies=null,e.firstEffect=null,e.lastEffect=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.return=null,e.updateQueue=null}function Xo(e){return 5===e.tag||3===e.tag||4===e.tag}function Ho(e){if(j){e:{for(var t=e.return;null!==t;){if(Xo(t))break e;t=t.return}throw Error(s(160))}var n=t;switch(t=n.stateNode,n.tag){case 5:var i=!1;break;case 3:case 4:t=t.containerInfo,i=!0;break;default:throw Error(s(161))}16&n.flags&&(Ge(t),n.flags&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||Xo(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.flags)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.flags)){n=n.stateNode;break e}}i?Yo(e,n,t):Ko(e,n,t)}}function Yo(e,t,n){var i=e.tag,o=5===i||6===i;if(o)e=o?e.stateNode:e.stateNode.instance,t?be(n,e,t):de(n,e);else if(4!==i&&null!==(e=e.child))for(Yo(e,t,n),e=e.sibling;null!==e;)Yo(e,t,n),e=e.sibling}function Ko(e,t,n){var i=e.tag,o=5===i||6===i;if(o)e=o?e.stateNode:e.stateNode.instance,t?me(n,e,t):ue(n,e);else if(4!==i&&null!==(e=e.child))for(Ko(e,t,n),e=e.sibling;null!==e;)Ko(e,t,n),e=e.sibling}function No(e,t){for(var n,i,o=t,r=!1;;){if(!r){r=o.return;e:for(;;){if(null===r)throw Error(s(160));switch(n=r.stateNode,r.tag){case 5:i=!1;break e;case 3:case 4:n=n.containerInfo,i=!0;break e}r=r.return}r=!0}if(5===o.tag||6===o.tag)xo(e,o),i?ye(n,o.stateNode):fe(n,o.stateNode);else if(4===o.tag){if(null!==o.child){n=o.stateNode.containerInfo,i=!0,o.child.return=o,o=o.child;continue}}else if(Ro(e,o),null!==o.child){o.child.return=o,o=o.child;continue}if(o===t)break;for(;null===o.sibling;){if(null===o.return||o.return===t)return;4===(o=o.return).tag&&(r=!1)}o.sibling.return=o.return,o=o.sibling}}function Mo(e,t){if(j){switch(t.tag){case 0:case 11:case 14:case 15:case 22:return void wo(3,t);case 1:case 12:case 17:return;case 5:var n=t.stateNode;if(null!=n){var i=t.memoizedProps;e=null!==e?e.memoizedProps:i;var o=t.type,r=t.updateQueue;t.updateQueue=null,null!==r&&pe(n,r,o,e,i,t)}return;case 6:if(null===t.stateNode)throw Error(s(162));return n=t.memoizedProps,void he(t.stateNode,null!==e?e.memoizedProps:n,n);case 3:return void(q&&(t=t.stateNode,t.hydrate&&(t.hydrate=!1,Je(t.containerInfo))));case 13:return Fo(t),void ko(t);case 19:return void ko(t);case 23:case 24:return void So(t,null!==t.memoizedState)}throw Error(s(163))}switch(t.tag){case 0:case 11:case 14:case 15:case 22:return void wo(3,t);case 12:case 23:case 24:return;case 13:return Fo(t),void ko(t);case 19:return void ko(t);case 3:q&&((n=t.stateNode).hydrate&&(n.hydrate=!1,Je(n.containerInfo)))}e:if(O){switch(t.tag){case 1:case 5:case 6:case 20:break e;case 3:case 4:t=t.stateNode,Xe(t.containerInfo,t.pendingChildren);break e}throw Error(s(163))}}function Fo(e){null!==e.memoizedState&&(Ar=Et(),j&&So(e.child,!0))}function ko(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new vo),t.forEach((function(t){var i=ua.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))}))}}function zo(e,t){return null!==e&&(null===(e=e.memoizedState)||null!==e.dehydrated)&&(null!==(t=t.memoizedState)&&null===t.dehydrated)}var Lo=0,To=1,Eo=2,Jo=3,Uo=4;if("function"===typeof Symbol&&Symbol.for){var Do=Symbol.for;Lo=Do("selector.component"),To=Do("selector.has_pseudo_class"),Eo=Do("selector.role"),Jo=Do("selector.test_id"),Uo=Do("selector.text")}function Po(e){var t=$(e);if(null!=t){if("string"!==typeof t.memoizedProps["data-testname"])throw Error(s(364));return t}if(null===(e=ae(e)))throw Error(s(362));return e.stateNode.current}function Qo(e,t){switch(t.$$typeof){case Lo:if(e.type===t.value)return!0;break;case To:e:{t=t.value,e=[e,0];for(var n=0;n<e.length;){var i=e[n++],o=e[n++],r=t[o];if(5!==i.tag||!le(i)){for(;null!=r&&Qo(i,r);)r=t[++o];if(o===t.length){t=!0;break e}for(i=i.child;null!==i;)e.push(i,o),i=i.sibling}}t=!1}return t;case Eo:if(5===e.tag&&ce(e.stateNode,t.value))return!0;break;case Uo:if((5===e.tag||6===e.tag)&&(null!==(e=ge(e))&&0<=e.indexOf(t.value)))return!0;break;case Jo:if(5===e.tag&&("string"===typeof(e=e.memoizedProps["data-testname"])&&e.toLowerCase()===t.value.toLowerCase()))return!0;break;default:throw Error(s(365,t))}return!1}function _o(e){switch(e.$$typeof){case Lo:return"<"+(S(e.value)||"Unknown")+">";case To:return":has("+(_o(e)||"")+")";case Eo:return'[role="'+e.value+'"]';case Uo:return'"'+e.value+'"';case Jo:return'[data-testname="'+e.value+'"]';default:throw Error(s(365,e))}}function jo(e,t){var n=[];e=[e,0];for(var i=0;i<e.length;){var o=e[i++],r=e[i++],a=t[r];if(5!==o.tag||!le(o)){for(;null!=a&&Qo(o,a);)a=t[++r];if(r===t.length)n.push(o);else for(o=o.child;null!==o;)e.push(o,r),o=o.sibling}}return n}function Oo(e,t){if(!re)throw Error(s(363));e=jo(e=Po(e),t),t=[],e=Array.from(e);for(var n=0;n<e.length;){var i=e[n++];if(5===i.tag)le(i)||t.push(i.stateNode);else for(i=i.child;null!==i;)e.push(i),i=i.sibling}return t}var qo=null;var $o=Math.ceil,er=g.ReactCurrentDispatcher,tr=g.ReactCurrentOwner,nr=g.IsSomeRendererActing,ir=0,or=null,rr=null,ar=0,sr=0,gr=Oe(0),lr=0,cr=null,Ir=0,Cr=0,ur=0,dr=0,hr=null,Ar=0,pr=1/0;function mr(){pr=Et()+500}var br,fr=null,yr=!1,Gr=null,vr=null,Br=!1,Zr=null,wr=90,Wr=[],Sr=[],Rr=null,xr=0,Vr=null,Xr=-1,Hr=0,Yr=0,Kr=null,Nr=!1;function Mr(){return 0!==(48&ir)?Et():-1!==Xr?Xr:Xr=Et()}function Fr(e){if(0===(2&(e=e.mode)))return 1;if(0===(4&e))return 99===Jt()?1:2;if(0===Hr&&(Hr=Ir),0!==jt.transition){0!==Yr&&(Yr=null!==hr?hr.pendingLanes:0),e=Hr;var t=4186112&~Yr;return 0===(t&=-t)&&(0===(t=(e=4186112&~e)&-e)&&(t=8192)),t}return e=Jt(),0!==(4&ir)&&98===e?e=mt(12,Hr):e=mt(e=function(e){switch(e){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}(e),Hr),e}function kr(e,t,n){if(50<xr)throw xr=0,Vr=null,Error(s(185));if(null===(e=zr(e,t)))return null;yt(e,t,n),e===or&&(ur|=t,4===lr&&Er(e,ar));var i=Jt();1===t?0!==(8&ir)&&0===(48&ir)?Jr(e):(Lr(e,n),0===ir&&(mr(),Qt())):(0===(4&ir)||98!==i&&99!==i||(null===Rr?Rr=new Set([e]):Rr.add(e)),Lr(e,n)),hr=e}function zr(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function Lr(e,t){for(var n=e.callbackNode,i=e.suspendedLanes,o=e.pingedLanes,r=e.expirationTimes,a=e.pendingLanes;0<a;){var g=31-Gt(a),l=1<<g,c=r[g];if(-1===c){if(0===(l&i)||0!==(l&o)){c=t,ht(l);var I=dt;r[g]=10<=I?c+250:6<=I?c+5e3:-1}}else c<=t&&(e.expiredLanes|=l);a&=~l}if(i=At(e,e===or?ar:0),t=dt,0===i)null!==n&&(n!==Mt&&Wt(n),e.callbackNode=null,e.callbackPriority=0);else{if(null!==n){if(e.callbackPriority===t)return;n!==Mt&&Wt(n)}15===t?(n=Jr.bind(null,e),null===kt?(kt=[n],zt=wt(Xt,_t)):kt.push(n),n=Mt):14===t?n=Pt(99,Jr.bind(null,e)):(n=function(e){switch(e){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(s(358,e))}}(t),n=Pt(n,Tr.bind(null,e))),e.callbackPriority=t,e.callbackNode=n}}function Tr(e){if(Xr=-1,Yr=Hr=0,0!==(48&ir))throw Error(s(327));var t=e.callbackNode;if(aa()&&e.callbackNode!==t)return null;var n=At(e,e===or?ar:0);if(0===n)return null;var i=n,o=ir;ir|=16;var r=Or();for(or===e&&ar===i||(mr(),_r(e,i));;)try{ea();break}catch(g){jr(e,g)}if(sn(),er.current=r,ir=o,null!==rr?i=0:(or=null,ar=0,i=lr),0!==(Ir&ur))_r(e,0);else if(0!==i){if(2===i&&(ir|=64,e.hydrate&&(e.hydrate=!1,We(e.containerInfo)),0!==(n=pt(e))&&(i=qr(e,n))),1===i)throw t=cr,_r(e,0),Er(e,n),Lr(e,Et()),t;switch(e.finishedWork=e.current.alternate,e.finishedLanes=n,i){case 0:case 1:throw Error(s(345));case 2:case 5:ia(e);break;case 3:if(Er(e,n),(62914560&n)===n&&10<(i=Ar+500-Et())){if(0!==At(e,0))break;if(((o=e.suspendedLanes)&n)!==n){Mr(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=D(ia.bind(null,e),i);break}ia(e);break;case 4:if(Er(e,n),(4186112&n)===n)break;for(i=e.eventTimes,o=-1;0<n;){var a=31-Gt(n);r=1<<a,(a=i[a])>o&&(o=a),n&=~r}if(n=o,10<(n=(120>(n=Et()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*$o(n/1960))-n)){e.timeoutHandle=D(ia.bind(null,e),n);break}ia(e);break;default:throw Error(s(329))}}return Lr(e,Et()),e.callbackNode===t?Tr.bind(null,e):null}function Er(e,t){for(t&=~dr,t&=~ur,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Gt(t),i=1<<n;e[n]=-1,t&=~i}}function Jr(e){if(0!==(48&ir))throw Error(s(327));if(aa(),e===or&&0!==(e.expiredLanes&ar)){var t=ar,n=qr(e,t);0!==(Ir&ur)&&(n=qr(e,t=At(e,t)))}else n=qr(e,t=At(e,0));if(0!==e.tag&&2===n&&(ir|=64,e.hydrate&&(e.hydrate=!1,We(e.containerInfo)),0!==(t=pt(e))&&(n=qr(e,t))),1===n)throw n=cr,_r(e,0),Er(e,t),Lr(e,Et()),n;return e.finishedWork=e.current.alternate,e.finishedLanes=t,ia(e),Lr(e,Et()),null}function Ur(e,t){var n=ir;ir|=1;try{return e(t)}finally{0===(ir=n)&&(mr(),Qt())}}function Dr(e,t){var n=ir;if(0!==(48&n))return e(t);ir|=1;try{if(e)return Dt(99,e.bind(null,t))}finally{ir=n,Qt()}}function Pr(e,t){$e(gr,sr),sr|=t,Ir|=t}function Qr(){sr=gr.current,qe(gr)}function _r(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==Q&&(e.timeoutHandle=Q,P(n)),null!==rr)for(n=rr.return;null!==n;){var i=n;switch(i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&at();break;case 3:zn(),qe(nt),qe(tt),ti();break;case 5:Tn(i);break;case 4:zn();break;case 13:case 19:qe(En);break;case 10:ln(i);break;case 23:case 24:Qr()}n=n.return}or=e,rr=Ba(e.current,null),ar=sr=Ir=t,lr=0,cr=null,dr=ur=Cr=0}function jr(e,t){for(;;){var n=rr;try{if(sn(),ni.current=Mi,gi){for(var i=ri.memoizedState;null!==i;){var o=i.queue;null!==o&&(o.pending=null),i=i.next}gi=!1}if(oi=0,si=ai=ri=null,li=!1,tr.current=null,null===n||null===n.return){lr=1,cr=t,rr=null;break}e:{var r=e,a=n.return,s=n,g=t;if(t=ar,s.flags|=2048,s.firstEffect=s.lastEffect=null,null!==g&&"object"===typeof g&&"function"===typeof g.then){var l=g;if(0===(2&s.mode)){var c=s.alternate;c?(s.updateQueue=c.updateQueue,s.memoizedState=c.memoizedState,s.lanes=c.lanes):(s.updateQueue=null,s.memoizedState=null)}var I=0!==(1&En.current),C=a;do{var u;if(u=13===C.tag){var d=C.memoizedState;if(null!==d)u=null!==d.dehydrated;else{var h=C.memoizedProps;u=void 0!==h.fallback&&(!0!==h.unstable_avoidThisFallback||!I)}}if(u){var A=C.updateQueue;if(null===A){var p=new Set;p.add(l),C.updateQueue=p}else A.add(l);if(0===(2&C.mode)){if(C.flags|=64,s.flags|=16384,s.flags&=-2981,1===s.tag)if(null===s.alternate)s.tag=17;else{var m=An(-1,1);m.tag=2,pn(s,m)}s.lanes|=1;break e}g=void 0,s=t;var b=r.pingCache;if(null===b?(b=r.pingCache=new fo,g=new Set,b.set(l,g)):void 0===(g=b.get(l))&&(g=new Set,b.set(l,g)),!g.has(s)){g.add(s);var f=Ca.bind(null,r,l,s);l.then(f,f)}C.flags|=4096,C.lanes=t;break e}C=C.return}while(null!==C);g=Error((S(s.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==lr&&(lr=2),g=mo(g,s),C=a;do{switch(C.tag){case 3:r=g,C.flags|=4096,t&=-t,C.lanes|=t,mn(C,yo(0,r,t));break e;case 1:r=g;var y=C.type,G=C.stateNode;if(0===(64&C.flags)&&("function"===typeof y.getDerivedStateFromError||null!==G&&"function"===typeof G.componentDidCatch&&(null===vr||!vr.has(G)))){C.flags|=4096,t&=-t,C.lanes|=t,mn(C,Go(C,r,t));break e}}C=C.return}while(null!==C)}na(n)}catch(v){t=v,rr===n&&null!==n&&(rr=n=n.return);continue}break}}function Or(){var e=er.current;return er.current=Mi,null===e?Mi:e}function qr(e,t){var n=ir;ir|=16;var i=Or();for(or===e&&ar===t||_r(e,t);;)try{$r();break}catch(o){jr(e,o)}if(sn(),ir=n,er.current=i,null!==rr)throw Error(s(261));return or=null,ar=0,lr}function $r(){for(;null!==rr;)ta(rr)}function ea(){for(;null!==rr&&!St();)ta(rr)}function ta(e){var t=br(e.alternate,e,sr);e.memoizedProps=e.pendingProps,null===t?na(e):rr=t,tr.current=null}function na(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(2048&t.flags)){if(null!==(n=Ao(n,t,sr)))return void(rr=n);if(24!==(n=t).tag&&23!==n.tag||null===n.memoizedState||0!==(1073741824&sr)||0===(4&n.mode)){for(var i=0,o=n.child;null!==o;)i|=o.lanes|o.childLanes,o=o.sibling;n.childLanes=i}null!==e&&0===(2048&e.flags)&&(null===e.firstEffect&&(e.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=t.firstEffect),e.lastEffect=t.lastEffect),1<t.flags&&(null!==e.lastEffect?e.lastEffect.nextEffect=t:e.firstEffect=t,e.lastEffect=t))}else{if(null!==(n=po(t)))return n.flags&=2047,void(rr=n);null!==e&&(e.firstEffect=e.lastEffect=null,e.flags|=2048)}if(null!==(t=t.sibling))return void(rr=t);rr=t=e}while(null!==t);0===lr&&(lr=5)}function ia(e){var t=Jt();return Dt(99,oa.bind(null,e,t)),null}function oa(e,t){do{aa()}while(null!==Zr);if(0!==(48&ir))throw Error(s(327));var n=e.finishedWork;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(s(177));e.callbackNode=null;var i=n.lanes|n.childLanes,o=i,r=e.pendingLanes&~o;e.pendingLanes=o,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=o,e.mutableReadLanes&=o,e.entangledLanes&=o,o=e.entanglements;for(var a=e.eventTimes,g=e.expirationTimes;0<r;){var l=31-Gt(r),c=1<<l;o[l]=0,a[l]=-1,g[l]=-1,r&=~c}if(null!==Rr&&0===(24&i)&&Rr.has(e)&&Rr.delete(e),e===or&&(rr=or=null,ar=0),1<n.flags?null!==n.lastEffect?(n.lastEffect.nextEffect=n,i=n.firstEffect):i=n:i=n.firstEffect,null!==i){o=ir,ir|=32,tr.current=null,Kr=F(e.containerInfo),Nr=!1,fr=i;do{try{ra()}catch(m){if(null===fr)throw Error(s(330));Ia(fr,m),fr=fr.nextEffect}}while(null!==fr);Kr=null,fr=i;do{try{for(a=e;null!==fr;){var I=fr.flags;if(16&I&&j&&Ge(fr.stateNode),128&I){var C=fr.alternate;if(null!==C){var u=C.ref;null!==u&&("function"===typeof u?u(null):u.current=null)}}switch(1038&I){case 2:Ho(fr),fr.flags&=-3;break;case 6:Ho(fr),fr.flags&=-3,Mo(fr.alternate,fr);break;case 1024:fr.flags&=-1025;break;case 1028:fr.flags&=-1025,Mo(fr.alternate,fr);break;case 4:Mo(fr.alternate,fr);break;case 8:g=a,r=fr,j?No(g,r):xo(g,r);var d=r.alternate;Vo(r),null!==d&&Vo(d)}fr=fr.nextEffect}}catch(m){if(null===fr)throw Error(s(330));Ia(fr,m),fr=fr.nextEffect}}while(null!==fr);Nr&&ie(),k(e.containerInfo),e.current=n,fr=i;do{try{for(I=e;null!==fr;){var h=fr.flags;if(36&h&&Wo(I,fr.alternate,fr),128&h){C=void 0;var A=fr.ref;if(null!==A){var p=fr.stateNode;if(5===fr.tag)C=K(p);else C=p;"function"===typeof A?A(C):A.current=C}}fr=fr.nextEffect}}catch(m){if(null===fr)throw Error(s(330));Ia(fr,m),fr=fr.nextEffect}}while(null!==fr);fr=null,Ft(),ir=o}else e.current=n;if(Br)Br=!1,Zr=e,wr=t;else for(fr=i;null!==fr;)t=fr.nextEffect,fr.nextEffect=null,8&fr.flags&&((h=fr).sibling=null,h.stateNode=null),fr=t;if(0===(i=e.pendingLanes)&&(vr=null),1===i?e===Vr?xr++:(xr=0,Vr=e):xr=0,n=n.stateNode,Ct&&"function"===typeof Ct.onCommitFiberRoot)try{Ct.onCommitFiberRoot(It,n,void 0,64===(64&n.current.flags))}catch(m){}if(Lr(e,Et()),yr)throw yr=!1,e=Gr,Gr=null,e;return 0!==(8&ir)||Qt(),null}function ra(){for(;null!==fr;){var e=fr.alternate;Nr||null===Kr||(0!==(8&fr.flags)?H(fr,Kr)&&(Nr=!0,ne()):13===fr.tag&&zo(e,fr)&&H(fr,Kr)&&(Nr=!0,ne()));var t=fr.flags;0!==(256&t)&&Zo(e,fr),0===(512&t)||Br||(Br=!0,Pt(97,(function(){return aa(),null}))),fr=fr.nextEffect}}function aa(){if(90!==wr){var e=97<wr?97:wr;return wr=90,Dt(e,la)}return!1}function sa(e,t){Wr.push(t,e),Br||(Br=!0,Pt(97,(function(){return aa(),null})))}function ga(e,t){Sr.push(t,e),Br||(Br=!0,Pt(97,(function(){return aa(),null})))}function la(){if(null===Zr)return!1;var e=Zr;if(Zr=null,0!==(48&ir))throw Error(s(331));var t=ir;ir|=32;var n=Sr;Sr=[];for(var i=0;i<n.length;i+=2){var o=n[i],r=n[i+1],a=o.destroy;if(o.destroy=void 0,"function"===typeof a)try{a()}catch(l){if(null===r)throw Error(s(330));Ia(r,l)}}for(n=Wr,Wr=[],i=0;i<n.length;i+=2){o=n[i],r=n[i+1];try{var g=o.create;o.destroy=g()}catch(l){if(null===r)throw Error(s(330));Ia(r,l)}}for(g=e.current.firstEffect;null!==g;)e=g.nextEffect,g.nextEffect=null,8&g.flags&&(g.sibling=null,g.stateNode=null),g=e;return ir=t,Qt(),!0}function ca(e,t,n){pn(e,t=yo(0,t=mo(n,t),1)),t=Mr(),null!==(e=zr(e,1))&&(yt(e,1,t),Lr(e,t))}function Ia(e,t){if(3===e.tag)ca(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){ca(n,e,t);break}if(1===n.tag){var i=n.stateNode;if("function"===typeof n.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===vr||!vr.has(i))){var o=Go(n,e=mo(t,e),1);if(pn(n,o),o=Mr(),null!==(n=zr(n,1)))yt(n,1,o),Lr(n,o);else if("function"===typeof i.componentDidCatch&&(null===vr||!vr.has(i)))try{i.componentDidCatch(t,e)}catch(r){}break}}n=n.return}}function Ca(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=Mr(),e.pingedLanes|=e.suspendedLanes&n,or===e&&(ar&n)===n&&(4===lr||3===lr&&(62914560&ar)===ar&&500>Et()-Ar?_r(e,0):dr|=n),Lr(e,t)}function ua(e,t){var n=e.stateNode;null!==n&&n.delete(t),0===(t=0)&&(0===(2&(t=e.mode))?t=1:0===(4&t)?t=99===Jt()?1:2:(0===Hr&&(Hr=Ir),0===(t=bt(62914560&~Hr))&&(t=4194304))),n=Mr(),null!==(e=zr(e,t))&&(yt(e,t,n),Lr(e,n))}br=function(e,t,n){var i=t.lanes;if(null!==e)if(e.memoizedProps!==t.pendingProps||nt.current)Ti=!0;else{if(0===(n&i)){switch(Ti=!1,t.tag){case 3:qi(t),$n();break;case 5:Ln(t);break;case 1:rt(t.type)&&lt(t);break;case 4:kn(t,t.stateNode.containerInfo);break;case 10:gn(t,t.memoizedProps.value);break;case 13:if(null!==t.memoizedState)return 0!==(n&t.child.childLanes)?oo(e,t,n):($e(En,1&En.current),null!==(t=Io(e,t,n))?t.sibling:null);$e(En,1&En.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(64&e.flags)){if(i)return co(e,t,n);t.flags|=64}var o=t.memoizedState;if(null!==o&&(o.rendering=null,o.tail=null,o.lastEffect=null),$e(En,En.current),i)break;return null;case 23:case 24:return t.lanes=0,Pi(e,t,n)}return Io(e,t,n)}Ti=0!==(16384&e.flags)}else Ti=!1;switch(t.lanes=0,t.tag){case 2:if(i=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,o=ot(t,tt.current),In(t,n),o=Ci(null,t,i,e,o,n),t.flags|=1,"object"===typeof o&&null!==o&&"function"===typeof o.render&&void 0===o.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,rt(i)){var r=!0;lt(t)}else r=!1;t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,dn(t);var a=i.getDerivedStateFromProps;"function"===typeof a&&Gn(t,i,a,e),o.updater=vn,t.stateNode=o,o._reactInternals=t,Wn(t,i,e,n),t=Oi(null,t,i,!0,r,n)}else t.tag=0,Ei(null,t,o,n),t=t.child;return t;case 16:o=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,o=(r=o._init)(o._payload),t.type=o,r=t.tag=function(e){if("function"===typeof e)return va(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===A)return 11;if(e===b)return 14}return 2}(o),e=tn(o,e),r){case 0:t=_i(null,t,o,e,n);break e;case 1:t=ji(null,t,o,e,n);break e;case 11:t=Ji(null,t,o,e,n);break e;case 14:t=Ui(null,t,o,tn(o.type,e),i,n);break e}throw Error(s(306,o,""))}return t;case 0:return i=t.type,o=t.pendingProps,_i(e,t,i,o=t.elementType===i?o:tn(i,o),n);case 1:return i=t.type,o=t.pendingProps,ji(e,t,i,o=t.elementType===i?o:tn(i,o),n);case 3:if(qi(t),i=t.updateQueue,null===e||null===i)throw Error(s(282));if(i=t.pendingProps,o=null!==(o=t.memoizedState)?o.element:null,hn(e,t),bn(t,i,null,n),(i=t.memoizedState.element)===o)$n(),t=Io(e,t,n);else{if((r=(o=t.stateNode).hydrate)&&(q?(Dn=ze(t.stateNode.containerInfo),Un=t,r=Pn=!0):r=!1),r){if(q&&null!=(e=o.mutableSourceEagerHydrationData))for(o=0;o<e.length;o+=2)r=e[o],a=e[o+1],_?r._workInProgressVersionPrimary=a:r._workInProgressVersionSecondary=a,ei.push(r);for(n=Hn(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|1024,n=n.sibling}else Ei(e,t,i,n),$n();t=t.child}return t;case 5:return Ln(t),null===e&&jn(t),i=t.type,o=t.pendingProps,r=null!==e?e.memoizedProps:null,a=o.children,J(i,o)?a=null:null!==r&&J(i,r)&&(t.flags|=16),Qi(e,t),Ei(e,t,a,n),t.child;case 6:return null===e&&jn(t),null;case 13:return oo(e,t,n);case 4:return kn(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=Xn(t,null,i,n):Ei(e,t,i,n),t.child;case 11:return i=t.type,o=t.pendingProps,Ji(e,t,i,o=t.elementType===i?o:tn(i,o),n);case 7:return Ei(e,t,t.pendingProps,n),t.child;case 8:case 12:return Ei(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,o=t.pendingProps,a=t.memoizedProps,gn(t,r=o.value),null!==a){var g=a.value;if(0===(r=Ot(g,r)?0:0|("function"===typeof i._calculateChangedBits?i._calculateChangedBits(g,r):1073741823))){if(a.children===o.children&&!nt.current){t=Io(e,t,n);break e}}else for(null!==(g=t.child)&&(g.return=t);null!==g;){var l=g.dependencies;if(null!==l){a=g.child;for(var c=l.firstContext;null!==c;){if(c.context===i&&0!==(c.observedBits&r)){1===g.tag&&((c=An(-1,n&-n)).tag=2,pn(g,c)),g.lanes|=n,null!==(c=g.alternate)&&(c.lanes|=n),cn(g.return,n),l.lanes|=n;break}c=c.next}}else a=10===g.tag&&g.type===t.type?null:g.child;if(null!==a)a.return=g;else for(a=g;null!==a;){if(a===t){a=null;break}if(null!==(g=a.sibling)){g.return=a.return,a=g;break}a=a.return}g=a}}Ei(e,t,o.children,n),t=t.child}return t;case 9:return o=t.type,i=(r=t.pendingProps).children,In(t,n),i=i(o=Cn(o,r.unstable_observedBits)),t.flags|=1,Ei(e,t,i,n),t.child;case 14:return r=tn(o=t.type,t.pendingProps),Ui(e,t,o,r=tn(o.type,r),i,n);case 15:return Di(e,t,t.type,t.pendingProps,i,n);case 17:return i=t.type,o=t.pendingProps,o=t.elementType===i?o:tn(i,o),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,rt(i)?(e=!0,lt(t)):e=!1,In(t,n),Zn(t,i,o),Wn(t,i,o,n),Oi(null,t,i,!0,e,n);case 19:return co(e,t,n);case 23:case 24:return Pi(e,t,n)}throw Error(s(156,t.tag))};var da={current:!1},ha=a.unstable_flushAllWithoutAsserting,Aa="function"===typeof ha;function pa(){if(void 0!==ha)return ha();for(var e=!1;aa();)e=!0;return e}function ma(t){try{pa(),function(t){if(null===qo)try{var n=("require"+Math.random()).slice(0,7);qo=(e&&e[n]).call(e,"timers").setImmediate}catch(i){qo=function(e){var t=new MessageChannel;t.port1.onmessage=e,t.port2.postMessage(void 0)}}qo(t)}((function(){pa()?ma(t):t()}))}catch(n){t(n)}}var ba=0,fa=!1;function ya(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function Ga(e,t,n,i){return new ya(e,t,n,i)}function va(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Ba(e,t){var n=e.alternate;return null===n?((n=Ga(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Za(e,t,n,i,o,r){var a=2;if(i=e,"function"===typeof e)va(e)&&(a=1);else if("string"===typeof e)a=5;else e:switch(e){case I:return wa(n.children,o,r,t);case G:a=8,o|=16;break;case C:a=8,o|=1;break;case u:return(e=Ga(12,n,t,8|o)).elementType=u,e.type=u,e.lanes=r,e;case p:return(e=Ga(13,n,t,o)).type=p,e.elementType=p,e.lanes=r,e;case m:return(e=Ga(19,n,t,o)).elementType=m,e.lanes=r,e;case v:return Wa(n,o,r,t);case B:return(e=Ga(24,n,t,o)).elementType=B,e.lanes=r,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case d:a=10;break e;case h:a=9;break e;case A:a=11;break e;case b:a=14;break e;case f:a=16,i=null;break e;case y:a=22;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=Ga(a,n,t,o)).elementType=e,t.type=i,t.lanes=r,t}function wa(e,t,n,i){return(e=Ga(7,e,i,t)).lanes=n,e}function Wa(e,t,n,i){return(e=Ga(23,e,i,t)).elementType=v,e.lanes=n,e}function Sa(e,t,n){return(e=Ga(6,e,null,t)).lanes=n,e}function Ra(e,t,n){return(t=Ga(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function xa(e,t,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=Q,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=ft(0),this.expirationTimes=ft(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ft(0),q&&(this.mutableSourceEagerHydrationData=null)}function Va(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw Error(s(268,Object.keys(e)))}return null===(e=X(t))?null:e.stateNode}function Xa(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Ha(e,t){Xa(e,t),(e=e.alternate)&&Xa(e,t)}function Ya(e){return null===(e=X(e))?null:e.stateNode}function Ka(){return null}return i.IsThisRendererActing=da,i.act=function(e){function t(){ba--,nr.current=n,da.current=i}!1===fa&&(fa=!0,console.error("act(...) is not supported in production builds of React, and might not behave as expected.")),ba++;var n=nr.current,i=da.current;nr.current=!0,da.current=!0;try{var o=Ur(e)}catch(r){throw t(),r}if(null!==o&&"object"===typeof o&&"function"===typeof o.then)return{then:function(e,i){o.then((function(){1<ba||!0===Aa&&!0===n?(t(),e()):ma((function(n){t(),n?i(n):e()}))}),(function(e){t(),i(e)}))}};try{1!==ba||!1!==Aa&&!1!==n||pa(),t()}catch(r){throw t(),r}return{then:function(e){e()}}},i.attemptContinuousHydration=function(e){13===e.tag&&(kr(e,67108864,Mr()),Ha(e,67108864))},i.attemptHydrationAtCurrentPriority=function(e){if(13===e.tag){var t=Mr(),n=Fr(e);kr(e,n,t),Ha(e,n)}},i.attemptSynchronousHydration=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.hydrate){var n=ht(t.pendingLanes);t.expiredLanes|=n&t.pendingLanes,Lr(t,Et()),0===(48&ir)&&(mr(),Qt())}break;case 13:var i=Mr();Dr((function(){return kr(e,1,i)})),Ha(e,4)}},i.attemptUserBlockingHydration=function(e){13===e.tag&&(kr(e,4,Mr()),Ha(e,4))},i.batchedEventUpdates=function(e,t){var n=ir;ir|=2;try{return e(t)}finally{0===(ir=n)&&(mr(),Qt())}},i.batchedUpdates=Ur,i.createComponentSelector=function(e){return{$$typeof:Lo,value:e}},i.createContainer=function(e,t,n){return e=new xa(e,t,n),t=Ga(3,null,null,2===t?7:1===t?3:0),e.current=t,t.stateNode=e,dn(t),e},i.createHasPsuedoClassSelector=function(e){return{$$typeof:To,value:e}},i.createPortal=function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:c,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}},i.createRoleSelector=function(e){return{$$typeof:Eo,value:e}},i.createTestNameSelector=function(e){return{$$typeof:Jo,value:e}},i.createTextSelector=function(e){return{$$typeof:Uo,value:e}},i.deferredUpdates=function(e){return Dt(97,e)},i.discreteUpdates=function(e,t,n,i,o){var r=ir;ir|=4;try{return Dt(98,e.bind(null,t,n,i,o))}finally{0===(ir=r)&&(mr(),Qt())}},i.findAllNodes=Oo,i.findBoundingRects=function(e,t){if(!re)throw Error(s(363));t=Oo(e,t),e=[];for(var n=0;n<t.length;n++)e.push(se(t[n]));for(t=e.length-1;0<t;t--)for(var i=(n=e[t]).x,o=i+n.width,r=n.y,a=r+n.height,g=t-1;0<=g;g--)if(t!==g){var l=e[g],c=l.x,I=c+l.width,C=l.y,u=C+l.height;if(i>=c&&r>=C&&o<=I&&a<=u){e.splice(t,1);break}if(!(i!==c||n.width!==l.width||u<r||C>a)){C>r&&(l.height+=C-r,l.y=r),u<a&&(l.height=a-C),e.splice(t,1);break}if(!(r!==C||n.height!==l.height||I<i||c>o)){c>i&&(l.width+=c-i,l.x=i),I<o&&(l.width=o-c),e.splice(t,1);break}}return e},i.findHostInstance=Va,i.findHostInstanceWithNoPortals=function(e){return null===(e=function(e){if(!(e=V(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child&&4!==t.tag)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}(e))?null:20===e.tag?e.stateNode.instance:e.stateNode},i.findHostInstanceWithWarning=function(e){return Va(e)},i.flushControlled=function(e){var t=ir;ir|=1;try{Dt(99,e)}finally{0===(ir=t)&&(mr(),Qt())}},i.flushDiscreteUpdates=function(){0===(49&ir)&&(function(){if(null!==Rr){var e=Rr;Rr=null,e.forEach((function(e){e.expiredLanes|=24&e.pendingLanes,Lr(e,Et())}))}Qt()}(),aa())},i.flushPassiveEffects=aa,i.flushSync=Dr,i.focusWithin=function(e,t){if(!re)throw Error(s(363));for(t=jo(e=Po(e),t),t=Array.from(t),e=0;e<t.length;){var n=t[e++];if(!le(n)){if(5===n.tag&&Ie(n.stateNode))return!0;for(n=n.child;null!==n;)t.push(n),n=n.sibling}}return!1},i.getCurrentUpdateLanePriority=function(){return ut},i.getFindAllNodesFailureDescription=function(e,t){if(!re)throw Error(s(363));var n=0,i=[];e=[Po(e),0];for(var o=0;o<e.length;){var r=e[o++],a=e[o++],g=t[a];if((5!==r.tag||!le(r))&&(Qo(r,g)&&(i.push(_o(g)),++a>n&&(n=a)),a<t.length))for(r=r.child;null!==r;)e.push(r,a),r=r.sibling}if(n<t.length){for(e=[];n<t.length;n++)e.push(_o(t[n]));return"findAllNodes was able to match part of the selector:\n  "+i.join(" > ")+"\n\nNo matching component was found for:\n  "+e.join(" > ")}return null},i.getPublicRootInstance=function(e){return(e=e.current).child?5===e.child.tag?K(e.child.stateNode):e.child.stateNode:null},i.injectIntoDevTools=function(e){if(e={bundleType:e.bundleType,version:e.version,rendererPackageName:e.rendererPackageName,rendererConfig:e.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:g.ReactCurrentDispatcher,findHostInstanceByFiber:Ya,findFiberByHostInstance:e.findFiberByHostInstance||Ka,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null},"undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)e=!1;else{var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!t.isDisabled&&t.supportsFiber)try{It=t.inject(e),Ct=t}catch(n){}e=!0}return e},i.observeVisibleRects=function(e,t,n,i){if(!re)throw Error(s(363));e=Oo(e,t);var o=Ce(e,n,i).disconnect;return{disconnect:function(){o()}}},i.registerMutableSourceForHydration=function(e,t){var n=t._getVersion;n=n(t._source),null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[t,n]:e.mutableSourceEagerHydrationData.push(t,n)},i.runWithPriority=function(e,t){var n=ut;try{return ut=e,t()}finally{ut=n}},i.shouldSuspend=function(){return!1},i.unbatchedUpdates=function(e,t){var n=ir;ir&=-2,ir|=8;try{return e(t)}finally{0===(ir=n)&&(mr(),Qt())}},i.updateContainer=function(e,t,n,i){var o=t.current,r=Mr(),a=Fr(o);e:if(n){t:{if(R(n=n._reactInternals)!==n||1!==n.tag)throw Error(s(170));var g=n;do{switch(g.tag){case 3:g=g.stateNode.context;break t;case 1:if(rt(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break t}}g=g.return}while(null!==g);throw Error(s(171))}if(1===n.tag){var l=n.type;if(rt(l)){n=gt(n,l,g);break e}}n=g}else n=et;return null===t.context?t.context=n:t.pendingContext=n,(t=An(r,a)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),pn(o,t),kr(o,a,r),a},i}},2016:(e,t,n)=>{"use strict";e.exports=n(6958)},178:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(e,t,n){var i=0===e?e:e+t;return"translate3d"+("("+("horizontal"===n?[i,0,0]:[0,i,0]).join(",")+")")}},8226:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fadeAnimationHandler=t.slideStopSwipingHandler=t.slideSwipeAnimationHandler=t.slideAnimationHandler=void 0;var i,o=n(5043),r=(i=n(178))&&i.__esModule?i:{default:i},a=n(564);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}t.slideAnimationHandler=function(e,t){var n={},i=t.selectedItem,s=i,l=o.Children.count(e.children)-1;if(e.infiniteLoop&&(i<0||i>l))return s<0?e.centerMode&&e.centerSlidePercentage&&"horizontal"===e.axis?n.itemListStyle=(0,a.setPosition)(-(l+2)*e.centerSlidePercentage-(100-e.centerSlidePercentage)/2,e.axis):n.itemListStyle=(0,a.setPosition)(100*-(l+2),e.axis):s>l&&(n.itemListStyle=(0,a.setPosition)(0,e.axis)),n;var c=(0,a.getPosition)(i,e),I=(0,r.default)(c,"%",e.axis),C=e.transitionTime+"ms";return n.itemListStyle={WebkitTransform:I,msTransform:I,OTransform:I,transform:I},t.swiping||(n.itemListStyle=g(g({},n.itemListStyle),{},{WebkitTransitionDuration:C,MozTransitionDuration:C,OTransitionDuration:C,transitionDuration:C,msTransitionDuration:C})),n};t.slideSwipeAnimationHandler=function(e,t,n,i){var r={},s="horizontal"===t.axis,g=o.Children.count(t.children),l=(0,a.getPosition)(n.selectedItem,t),c=t.infiniteLoop?(0,a.getPosition)(g-1,t)-100:(0,a.getPosition)(g-1,t),I=s?e.x:e.y,C=I;0===l&&I>0&&(C=0),l===c&&I<0&&(C=0);var u=l+100/(n.itemSize/C),d=Math.abs(I)>t.swipeScrollTolerance;return t.infiniteLoop&&d&&(0===n.selectedItem&&u>-100?u-=100*g:n.selectedItem===g-1&&u<100*-g&&(u+=100*g)),(!t.preventMovementUntilSwipeScrollTolerance||d||n.swipeMovementStarted)&&(n.swipeMovementStarted||i({swipeMovementStarted:!0}),r.itemListStyle=(0,a.setPosition)(u,t.axis)),d&&!n.cancelClick&&i({cancelClick:!0}),r};t.slideStopSwipingHandler=function(e,t){var n=(0,a.getPosition)(t.selectedItem,e);return{itemListStyle:(0,a.setPosition)(n,e.axis)}};t.fadeAnimationHandler=function(e,t){var n=e.transitionTime+"ms",i="ease-in-out",o={position:"absolute",display:"block",zIndex:-2,minHeight:"100%",opacity:0,top:0,right:0,left:0,bottom:0,transitionTimingFunction:i,msTransitionTimingFunction:i,MozTransitionTimingFunction:i,WebkitTransitionTimingFunction:i,OTransitionTimingFunction:i};return t.swiping||(o=g(g({},o),{},{WebkitTransitionDuration:n,MozTransitionDuration:n,OTransitionDuration:n,transitionDuration:n,msTransitionDuration:n})),{slideStyle:o,selectedStyle:g(g({},o),{},{opacity:1,position:"relative"}),prevStyle:g({},o)}}},3481:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==u(e)&&"function"!==typeof e)return{default:e};var t=C();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=i?Object.getOwnPropertyDescriptor(e,o):null;r&&(r.get||r.set)?Object.defineProperty(n,o,r):n[o]=e[o]}n.default=e,t&&t.set(e,n);return n}(n(5043)),o=I(n(7251)),r=I(n(8656)),a=I(n(4169)),s=I(n(5559)),g=I(n(9386)),l=n(564),c=n(8226);function I(e){return e&&e.__esModule?e:{default:e}}function C(){if("function"!==typeof WeakMap)return null;var e=new WeakMap;return C=function(){return e},e}function u(e){return u="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function d(){return d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},d.apply(this,arguments)}function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){G(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function m(e,t){return m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},m(e,t)}function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=y(e);if(t){var o=y(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return function(e,t){if(t&&("object"===u(t)||"function"===typeof t))return t;return f(e)}(this,n)}}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e){return y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},y(e)}function G(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(u,e);var t,n,I,C=b(u);function u(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),G(f(t=C.call(this,e)),"thumbsRef",void 0),G(f(t),"carouselWrapperRef",void 0),G(f(t),"listRef",void 0),G(f(t),"itemsRef",void 0),G(f(t),"timer",void 0),G(f(t),"animationHandler",void 0),G(f(t),"setThumbsRef",(function(e){t.thumbsRef=e})),G(f(t),"setCarouselWrapperRef",(function(e){t.carouselWrapperRef=e})),G(f(t),"setListRef",(function(e){t.listRef=e})),G(f(t),"setItemsRef",(function(e,n){t.itemsRef||(t.itemsRef=[]),t.itemsRef[n]=e})),G(f(t),"autoPlay",(function(){i.Children.count(t.props.children)<=1||(t.clearAutoPlay(),t.props.autoPlay&&(t.timer=setTimeout((function(){t.increment()}),t.props.interval)))})),G(f(t),"clearAutoPlay",(function(){t.timer&&clearTimeout(t.timer)})),G(f(t),"resetAutoPlay",(function(){t.clearAutoPlay(),t.autoPlay()})),G(f(t),"stopOnHover",(function(){t.setState({isMouseEntered:!0},t.clearAutoPlay)})),G(f(t),"startOnLeave",(function(){t.setState({isMouseEntered:!1},t.autoPlay)})),G(f(t),"isFocusWithinTheCarousel",(function(){return!!t.carouselWrapperRef&&!((0,s.default)().activeElement!==t.carouselWrapperRef&&!t.carouselWrapperRef.contains((0,s.default)().activeElement))})),G(f(t),"navigateWithKeyboard",(function(e){if(t.isFocusWithinTheCarousel()){var n="horizontal"===t.props.axis,i=n?37:38;(n?39:40)===e.keyCode?t.increment():i===e.keyCode&&t.decrement()}})),G(f(t),"updateSizes",(function(){if(t.state.initialized&&t.itemsRef&&0!==t.itemsRef.length){var e="horizontal"===t.props.axis,n=t.itemsRef[0];if(n){var i=e?n.clientWidth:n.clientHeight;t.setState({itemSize:i}),t.thumbsRef&&t.thumbsRef.updateSizes()}}})),G(f(t),"setMountState",(function(){t.setState({hasMount:!0}),t.updateSizes()})),G(f(t),"handleClickItem",(function(e,n){0!==i.Children.count(t.props.children)&&(t.state.cancelClick?t.setState({cancelClick:!1}):(t.props.onClickItem(e,n),e!==t.state.selectedItem&&t.setState({selectedItem:e})))})),G(f(t),"handleOnChange",(function(e,n){i.Children.count(t.props.children)<=1||t.props.onChange(e,n)})),G(f(t),"handleClickThumb",(function(e,n){t.props.onClickThumb(e,n),t.moveTo(e)})),G(f(t),"onSwipeStart",(function(e){t.setState({swiping:!0}),t.props.onSwipeStart(e)})),G(f(t),"onSwipeEnd",(function(e){t.setState({swiping:!1,cancelClick:!1,swipeMovementStarted:!1}),t.props.onSwipeEnd(e),t.clearAutoPlay(),t.state.autoPlay&&t.autoPlay()})),G(f(t),"onSwipeMove",(function(e,n){t.props.onSwipeMove(n);var i=t.props.swipeAnimationHandler(e,t.props,t.state,t.setState.bind(f(t)));return t.setState(A({},i)),!!Object.keys(i).length})),G(f(t),"decrement",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;t.moveTo(t.state.selectedItem-("number"===typeof e?e:1))})),G(f(t),"increment",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;t.moveTo(t.state.selectedItem+("number"===typeof e?e:1))})),G(f(t),"moveTo",(function(e){if("number"===typeof e){var n=i.Children.count(t.props.children)-1;e<0&&(e=t.props.infiniteLoop?n:0),e>n&&(e=t.props.infiniteLoop?0:n),t.selectItem({selectedItem:e}),t.state.autoPlay&&!1===t.state.isMouseEntered&&t.resetAutoPlay()}})),G(f(t),"onClickNext",(function(){t.increment(1)})),G(f(t),"onClickPrev",(function(){t.decrement(1)})),G(f(t),"onSwipeForward",(function(){t.increment(1),t.props.emulateTouch&&t.setState({cancelClick:!0})})),G(f(t),"onSwipeBackwards",(function(){t.decrement(1),t.props.emulateTouch&&t.setState({cancelClick:!0})})),G(f(t),"changeItem",(function(e){return function(n){(0,l.isKeyboardEvent)(n)&&"Enter"!==n.key||t.moveTo(e)}})),G(f(t),"selectItem",(function(e){t.setState(A({previousItem:t.state.selectedItem},e),(function(){t.setState(t.animationHandler(t.props,t.state))})),t.handleOnChange(e.selectedItem,i.Children.toArray(t.props.children)[e.selectedItem])})),G(f(t),"getInitialImage",(function(){var e=t.props.selectedItem,n=t.itemsRef&&t.itemsRef[e];return(n&&n.getElementsByTagName("img")||[])[0]})),G(f(t),"getVariableItemHeight",(function(e){var n=t.itemsRef&&t.itemsRef[e];if(t.state.hasMount&&n&&n.children.length){var i=n.children[0].getElementsByTagName("img")||[];if(i.length>0){var o=i[0];if(!o.complete){o.addEventListener("load",(function e(){t.forceUpdate(),o.removeEventListener("load",e)}))}}var r=(i[0]||n.children[0]).clientHeight;return r>0?r:null}return null}));var n={initialized:!1,previousItem:e.selectedItem,selectedItem:e.selectedItem,hasMount:!1,isMouseEntered:!1,autoPlay:e.autoPlay,swiping:!1,swipeMovementStarted:!1,cancelClick:!1,itemSize:1,itemListStyle:{},slideStyle:{},selectedStyle:{},prevStyle:{}};return t.animationHandler="function"===typeof e.animationHandler&&e.animationHandler||"fade"===e.animationHandler&&c.fadeAnimationHandler||c.slideAnimationHandler,t.state=A(A({},n),t.animationHandler(e,n)),t}return t=u,(n=[{key:"componentDidMount",value:function(){this.props.children&&this.setupCarousel()}},{key:"componentDidUpdate",value:function(e,t){e.children||!this.props.children||this.state.initialized||this.setupCarousel(),!e.autoFocus&&this.props.autoFocus&&this.forceFocus(),t.swiping&&!this.state.swiping&&this.setState(A({},this.props.stopSwipingHandler(this.props,this.state))),e.selectedItem===this.props.selectedItem&&e.centerMode===this.props.centerMode||(this.updateSizes(),this.moveTo(this.props.selectedItem)),e.autoPlay!==this.props.autoPlay&&(this.props.autoPlay?this.setupAutoPlay():this.destroyAutoPlay(),this.setState({autoPlay:this.props.autoPlay}))}},{key:"componentWillUnmount",value:function(){this.destroyCarousel()}},{key:"setupCarousel",value:function(){var e=this;this.bindEvents(),this.state.autoPlay&&i.Children.count(this.props.children)>1&&this.setupAutoPlay(),this.props.autoFocus&&this.forceFocus(),this.setState({initialized:!0},(function(){var t=e.getInitialImage();t&&!t.complete?t.addEventListener("load",e.setMountState):e.setMountState()}))}},{key:"destroyCarousel",value:function(){this.state.initialized&&(this.unbindEvents(),this.destroyAutoPlay())}},{key:"setupAutoPlay",value:function(){this.autoPlay();var e=this.carouselWrapperRef;this.props.stopOnHover&&e&&(e.addEventListener("mouseenter",this.stopOnHover),e.addEventListener("mouseleave",this.startOnLeave))}},{key:"destroyAutoPlay",value:function(){this.clearAutoPlay();var e=this.carouselWrapperRef;this.props.stopOnHover&&e&&(e.removeEventListener("mouseenter",this.stopOnHover),e.removeEventListener("mouseleave",this.startOnLeave))}},{key:"bindEvents",value:function(){(0,g.default)().addEventListener("resize",this.updateSizes),(0,g.default)().addEventListener("DOMContentLoaded",this.updateSizes),this.props.useKeyboardArrows&&(0,s.default)().addEventListener("keydown",this.navigateWithKeyboard)}},{key:"unbindEvents",value:function(){(0,g.default)().removeEventListener("resize",this.updateSizes),(0,g.default)().removeEventListener("DOMContentLoaded",this.updateSizes);var e=this.getInitialImage();e&&e.removeEventListener("load",this.setMountState),this.props.useKeyboardArrows&&(0,s.default)().removeEventListener("keydown",this.navigateWithKeyboard)}},{key:"forceFocus",value:function(){var e;null===(e=this.carouselWrapperRef)||void 0===e||e.focus()}},{key:"renderItems",value:function(e){var t=this;return this.props.children?i.Children.map(this.props.children,(function(n,o){var a=o===t.state.selectedItem,s=o===t.state.previousItem,g=a&&t.state.selectedStyle||s&&t.state.prevStyle||t.state.slideStyle||{};t.props.centerMode&&"horizontal"===t.props.axis&&(g=A(A({},g),{},{minWidth:t.props.centerSlidePercentage+"%"})),t.state.swiping&&t.state.swipeMovementStarted&&(g=A(A({},g),{},{pointerEvents:"none"}));var l={ref:function(e){return t.setItemsRef(e,o)},key:"itemKey"+o+(e?"clone":""),className:r.default.ITEM(!0,o===t.state.selectedItem,o===t.state.previousItem),onClick:t.handleClickItem.bind(t,o,n),style:g};return i.default.createElement("li",l,t.props.renderItem(n,{isSelected:o===t.state.selectedItem,isPrevious:o===t.state.previousItem}))})):[]}},{key:"renderControls",value:function(){var e=this,t=this.props,n=t.showIndicators,o=t.labels,r=t.renderIndicator,a=t.children;return n?i.default.createElement("ul",{className:"control-dots"},i.Children.map(a,(function(t,n){return r&&r(e.changeItem(n),n===e.state.selectedItem,n,o.item)}))):null}},{key:"renderStatus",value:function(){return this.props.showStatus?i.default.createElement("p",{className:"carousel-status"},this.props.statusFormatter(this.state.selectedItem+1,i.Children.count(this.props.children))):null}},{key:"renderThumbs",value:function(){return this.props.showThumbs&&this.props.children&&0!==i.Children.count(this.props.children)?i.default.createElement(a.default,{ref:this.setThumbsRef,onSelectItem:this.handleClickThumb,selectedItem:this.state.selectedItem,transitionTime:this.props.transitionTime,thumbWidth:this.props.thumbWidth,labels:this.props.labels,emulateTouch:this.props.emulateTouch},this.props.renderThumbs(this.props.children)):null}},{key:"render",value:function(){var e=this;if(!this.props.children||0===i.Children.count(this.props.children))return null;var t=this.props.swipeable&&i.Children.count(this.props.children)>1,n="horizontal"===this.props.axis,a=this.props.showArrows&&i.Children.count(this.props.children)>1,s=a&&(this.state.selectedItem>0||this.props.infiniteLoop)||!1,g=a&&(this.state.selectedItem<i.Children.count(this.props.children)-1||this.props.infiniteLoop)||!1,l=this.renderItems(!0),c=l.shift(),I=l.pop(),C={className:r.default.SLIDER(!0,this.state.swiping),onSwipeMove:this.onSwipeMove,onSwipeStart:this.onSwipeStart,onSwipeEnd:this.onSwipeEnd,style:this.state.itemListStyle,tolerance:this.props.swipeScrollTolerance},u={};if(n){if(C.onSwipeLeft=this.onSwipeForward,C.onSwipeRight=this.onSwipeBackwards,this.props.dynamicHeight){var h=this.getVariableItemHeight(this.state.selectedItem);u.height=h||"auto"}}else C.onSwipeUp="natural"===this.props.verticalSwipe?this.onSwipeBackwards:this.onSwipeForward,C.onSwipeDown="natural"===this.props.verticalSwipe?this.onSwipeForward:this.onSwipeBackwards,C.style=A(A({},C.style),{},{height:this.state.itemSize}),u.height=this.state.itemSize;return i.default.createElement("div",{"aria-label":this.props.ariaLabel,className:r.default.ROOT(this.props.className),ref:this.setCarouselWrapperRef,tabIndex:this.props.useKeyboardArrows?0:void 0},i.default.createElement("div",{className:r.default.CAROUSEL(!0),style:{width:this.props.width}},this.renderControls(),this.props.renderArrowPrev(this.onClickPrev,s,this.props.labels.leftArrow),i.default.createElement("div",{className:r.default.WRAPPER(!0,this.props.axis),style:u},t?i.default.createElement(o.default,d({tagName:"ul",innerRef:this.setListRef},C,{allowMouseEvents:this.props.emulateTouch}),this.props.infiniteLoop&&I,this.renderItems(),this.props.infiniteLoop&&c):i.default.createElement("ul",{className:r.default.SLIDER(!0,this.state.swiping),ref:function(t){return e.setListRef(t)},style:this.state.itemListStyle||{}},this.props.infiniteLoop&&I,this.renderItems(),this.props.infiniteLoop&&c)),this.props.renderArrowNext(this.onClickNext,g,this.props.labels.rightArrow),this.renderStatus()),this.renderThumbs())}}])&&p(t.prototype,n),I&&p(t,I),u}(i.default.Component);t.default=v,G(v,"displayName","Carousel"),G(v,"defaultProps",{ariaLabel:void 0,axis:"horizontal",centerSlidePercentage:80,interval:3e3,labels:{leftArrow:"previous slide / item",rightArrow:"next slide / item",item:"slide item"},onClickItem:l.noop,onClickThumb:l.noop,onChange:l.noop,onSwipeStart:function(){},onSwipeEnd:function(){},onSwipeMove:function(){return!1},preventMovementUntilSwipeScrollTolerance:!1,renderArrowPrev:function(e,t,n){return i.default.createElement("button",{type:"button","aria-label":n,className:r.default.ARROW_PREV(!t),onClick:e})},renderArrowNext:function(e,t,n){return i.default.createElement("button",{type:"button","aria-label":n,className:r.default.ARROW_NEXT(!t),onClick:e})},renderIndicator:function(e,t,n,o){return i.default.createElement("li",{className:r.default.DOT(t),onClick:e,onKeyDown:e,value:n,key:n,role:"button",tabIndex:0,"aria-label":"".concat(o," ").concat(n+1)})},renderItem:function(e){return e},renderThumbs:function(e){var t=i.Children.map(e,(function(e){var t=e;if("img"!==e.type&&(t=i.Children.toArray(e.props.children).find((function(e){return"img"===e.type}))),t)return t}));return 0===t.filter((function(e){return e})).length?(console.warn("No images found! Can't build the thumb list without images. If you don't need thumbs, set showThumbs={false} in the Carousel. Note that it's not possible to get images rendered inside custom components. More info at https://github.com/leandrowd/react-responsive-carousel/blob/master/TROUBLESHOOTING.md"),[]):t},statusFormatter:l.defaultStatusFormatter,selectedItem:0,showArrows:!0,showIndicators:!0,showStatus:!0,showThumbs:!0,stopOnHover:!0,swipeScrollTolerance:5,swipeable:!0,transitionTime:350,verticalSwipe:"standard",width:"100%",animationHandler:"slide",swipeAnimationHandler:c.slideSwipeAnimationHandler,stopSwipingHandler:c.slideStopSwipingHandler})},3096:()=>{},564:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setPosition=t.getPosition=t.isKeyboardEvent=t.defaultStatusFormatter=t.noop=void 0;var i,o=n(5043),r=(i=n(178))&&i.__esModule?i:{default:i};t.noop=function(){};t.defaultStatusFormatter=function(e,t){return"".concat(e," of ").concat(t)};t.isKeyboardEvent=function(e){return!!e&&e.hasOwnProperty("key")};t.getPosition=function(e,t){if(t.infiniteLoop&&++e,0===e)return 0;var n=o.Children.count(t.children);if(t.centerMode&&"horizontal"===t.axis){var i=-e*t.centerSlidePercentage,r=n-1;return e&&(e!==r||t.infiniteLoop)?i+=(100-t.centerSlidePercentage)/2:e===r&&(i+=100-t.centerSlidePercentage),i}return 100*-e};t.setPosition=function(e,t){var n={};return["WebkitTransform","MozTransform","MsTransform","OTransform","transform","msTransform"].forEach((function(i){n[i]=(0,r.default)(e,"%",t)})),n}},4169:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==I(e)&&"function"!==typeof e)return{default:e};var t=c();if(t&&t.has(e))return t.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var r=i?Object.getOwnPropertyDescriptor(e,o):null;r&&(r.get||r.set)?Object.defineProperty(n,o,r):n[o]=e[o]}n.default=e,t&&t.set(e,n);return n}(n(5043)),o=l(n(8656)),r=n(1256),a=l(n(178)),s=l(n(7251)),g=l(n(9386));function l(e){return e&&e.__esModule?e:{default:e}}function c(){if("function"!==typeof WeakMap)return null;var e=new WeakMap;return c=function(){return e},e}function I(e){return I="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function C(){return C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},C.apply(this,arguments)}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function d(e,t){return d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},d(e,t)}function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=p(e);if(t){var o=p(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return function(e,t){if(t&&("object"===I(t)||"function"===typeof t))return t;return A(e)}(this,n)}}function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var b=function(e){!function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(I,e);var t,n,l,c=h(I);function I(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,I),m(A(t=c.call(this,e)),"itemsWrapperRef",void 0),m(A(t),"itemsListRef",void 0),m(A(t),"thumbsRef",void 0),m(A(t),"setItemsWrapperRef",(function(e){t.itemsWrapperRef=e})),m(A(t),"setItemsListRef",(function(e){t.itemsListRef=e})),m(A(t),"setThumbsRef",(function(e,n){t.thumbsRef||(t.thumbsRef=[]),t.thumbsRef[n]=e})),m(A(t),"updateSizes",(function(){if(t.props.children&&t.itemsWrapperRef&&t.thumbsRef){var e=i.Children.count(t.props.children),n=t.itemsWrapperRef.clientWidth,o=t.props.thumbWidth?t.props.thumbWidth:(0,r.outerWidth)(t.thumbsRef[0]),a=Math.floor(n/o),s=a<e,g=s?e-a:0;t.setState((function(e,n){return{itemSize:o,visibleItems:a,firstItem:s?t.getFirstItem(n.selectedItem):0,lastPosition:g,showArrows:s}}))}})),m(A(t),"handleClickItem",(function(e,n,i){if(!function(e){return e.hasOwnProperty("key")}(i)||"Enter"===i.key){var o=t.props.onSelectItem;"function"===typeof o&&o(e,n)}})),m(A(t),"onSwipeStart",(function(){t.setState({swiping:!0})})),m(A(t),"onSwipeEnd",(function(){t.setState({swiping:!1})})),m(A(t),"onSwipeMove",(function(e){var n=e.x;if(!t.state.itemSize||!t.itemsWrapperRef||!t.state.visibleItems)return!1;var o=i.Children.count(t.props.children),r=-100*t.state.firstItem/t.state.visibleItems;0===r&&n>0&&(n=0),r===100*-Math.max(o-t.state.visibleItems,0)/t.state.visibleItems&&n<0&&(n=0);var s=r+100/(t.itemsWrapperRef.clientWidth/n);return t.itemsListRef&&["WebkitTransform","MozTransform","MsTransform","OTransform","transform","msTransform"].forEach((function(e){t.itemsListRef.style[e]=(0,a.default)(s,"%",t.props.axis)})),!0})),m(A(t),"slideRight",(function(e){t.moveTo(t.state.firstItem-("number"===typeof e?e:1))})),m(A(t),"slideLeft",(function(e){t.moveTo(t.state.firstItem+("number"===typeof e?e:1))})),m(A(t),"moveTo",(function(e){e=(e=e<0?0:e)>=t.state.lastPosition?t.state.lastPosition:e,t.setState({firstItem:e})})),t.state={selectedItem:e.selectedItem,swiping:!1,showArrows:!1,firstItem:0,visibleItems:0,lastPosition:0},t}return t=I,(n=[{key:"componentDidMount",value:function(){this.setupThumbs()}},{key:"componentDidUpdate",value:function(e){this.props.selectedItem!==this.state.selectedItem&&this.setState({selectedItem:this.props.selectedItem,firstItem:this.getFirstItem(this.props.selectedItem)}),this.props.children!==e.children&&this.updateSizes()}},{key:"componentWillUnmount",value:function(){this.destroyThumbs()}},{key:"setupThumbs",value:function(){(0,g.default)().addEventListener("resize",this.updateSizes),(0,g.default)().addEventListener("DOMContentLoaded",this.updateSizes),this.updateSizes()}},{key:"destroyThumbs",value:function(){(0,g.default)().removeEventListener("resize",this.updateSizes),(0,g.default)().removeEventListener("DOMContentLoaded",this.updateSizes)}},{key:"getFirstItem",value:function(e){var t=e;return e>=this.state.lastPosition&&(t=this.state.lastPosition),e<this.state.firstItem+this.state.visibleItems&&(t=this.state.firstItem),e<this.state.firstItem&&(t=e),t}},{key:"renderItems",value:function(){var e=this;return this.props.children.map((function(t,n){var r=o.default.ITEM(!1,n===e.state.selectedItem),a={key:n,ref:function(t){return e.setThumbsRef(t,n)},className:r,onClick:e.handleClickItem.bind(e,n,e.props.children[n]),onKeyDown:e.handleClickItem.bind(e,n,e.props.children[n]),"aria-label":"".concat(e.props.labels.item," ").concat(n+1),style:{width:e.props.thumbWidth}};return i.default.createElement("li",C({},a,{role:"button",tabIndex:0}),t)}))}},{key:"render",value:function(){var e=this;if(!this.props.children)return null;var t,n=i.Children.count(this.props.children)>1,r=this.state.showArrows&&this.state.firstItem>0,g=this.state.showArrows&&this.state.firstItem<this.state.lastPosition,l=-this.state.firstItem*(this.state.itemSize||0),c=(0,a.default)(l,"px",this.props.axis),I=this.props.transitionTime+"ms";return t={WebkitTransform:c,MozTransform:c,MsTransform:c,OTransform:c,transform:c,msTransform:c,WebkitTransitionDuration:I,MozTransitionDuration:I,MsTransitionDuration:I,OTransitionDuration:I,transitionDuration:I,msTransitionDuration:I},i.default.createElement("div",{className:o.default.CAROUSEL(!1)},i.default.createElement("div",{className:o.default.WRAPPER(!1),ref:this.setItemsWrapperRef},i.default.createElement("button",{type:"button",className:o.default.ARROW_PREV(!r),onClick:function(){return e.slideRight()},"aria-label":this.props.labels.leftArrow}),n?i.default.createElement(s.default,{tagName:"ul",className:o.default.SLIDER(!1,this.state.swiping),onSwipeLeft:this.slideLeft,onSwipeRight:this.slideRight,onSwipeMove:this.onSwipeMove,onSwipeStart:this.onSwipeStart,onSwipeEnd:this.onSwipeEnd,style:t,innerRef:this.setItemsListRef,allowMouseEvents:this.props.emulateTouch},this.renderItems()):i.default.createElement("ul",{className:o.default.SLIDER(!1,this.state.swiping),ref:function(t){return e.setItemsListRef(t)},style:t},this.renderItems()),i.default.createElement("button",{type:"button",className:o.default.ARROW_NEXT(!g),onClick:function(){return e.slideLeft()},"aria-label":this.props.labels.rightArrow})))}}])&&u(t.prototype,n),l&&u(t,l),I}(i.Component);t.default=b,m(b,"displayName","Thumbs"),m(b,"defaultProps",{axis:"horizontal",labels:{leftArrow:"previous slide / item",rightArrow:"next slide / item",item:"slide item"},selectedItem:0,thumbWidth:80,transitionTime:350})},8656:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,o=(i=n(8139))&&i.__esModule?i:{default:i};var r={ROOT:function(e){return(0,o.default)(function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({"carousel-root":!0},e||"",!!e))},CAROUSEL:function(e){return(0,o.default)({carousel:!0,"carousel-slider":e})},WRAPPER:function(e,t){return(0,o.default)({"thumbs-wrapper":!e,"slider-wrapper":e,"axis-horizontal":"horizontal"===t,"axis-vertical":"horizontal"!==t})},SLIDER:function(e,t){return(0,o.default)({thumbs:!e,slider:e,animated:!t})},ITEM:function(e,t,n){return(0,o.default)({thumb:!e,slide:e,selected:t,previous:n})},ARROW_PREV:function(e){return(0,o.default)({"control-arrow control-prev":!0,"control-disabled":e})},ARROW_NEXT:function(e){return(0,o.default)({"control-arrow control-next":!0,"control-disabled":e})},DOT:function(e){return(0,o.default)({dot:!0,selected:e})}};t.default=r},1256:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.outerWidth=void 0;t.outerWidth=function(e){var t=e.offsetWidth,n=getComputedStyle(e);return t+=parseInt(n.marginLeft)+parseInt(n.marginRight)}},1577:(e,t,n)=>{"use strict";Object.defineProperty(t,"FN",{enumerable:!0,get:function(){return i.default}});var i=a(n(3481)),o=n(3096),r=a(n(4169));function a(e){return e&&e.__esModule?e:{default:e}}},5559:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(){return document}},9386:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(){return window}},1153:(e,t,n)=>{"use strict";n(2123);var i=n(5043),o=60103;if(t.Fragment=60107,"function"===typeof Symbol&&Symbol.for){var r=Symbol.for;o=r("react.element"),t.Fragment=r("react.fragment")}var a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s=Object.prototype.hasOwnProperty,g={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,n){var i,r={},l=null,c=null;for(i in void 0!==n&&(l=""+n),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(c=t.ref),t)s.call(t,i)&&!g.hasOwnProperty(i)&&(r[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===r[i]&&(r[i]=t[i]);return{$$typeof:o,type:e,key:l,ref:c,props:r,_owner:a.current}}t.jsx=l,t.jsxs=l},4202:(e,t,n)=>{"use strict";var i=n(2123),o=60103,r=60106;t.Fragment=60107,t.StrictMode=60108,t.Profiler=60114;var a=60109,s=60110,g=60112;t.Suspense=60113;var l=60115,c=60116;if("function"===typeof Symbol&&Symbol.for){var I=Symbol.for;o=I("react.element"),r=I("react.portal"),t.Fragment=I("react.fragment"),t.StrictMode=I("react.strict_mode"),t.Profiler=I("react.profiler"),a=I("react.provider"),s=I("react.context"),g=I("react.forward_ref"),t.Suspense=I("react.suspense"),l=I("react.memo"),c=I("react.lazy")}var C="function"===typeof Symbol&&Symbol.iterator;function u(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var d={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},h={};function A(e,t,n){this.props=e,this.context=t,this.refs=h,this.updater=n||d}function p(){}function m(e,t,n){this.props=e,this.context=t,this.refs=h,this.updater=n||d}A.prototype.isReactComponent={},A.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error(u(85));this.updater.enqueueSetState(this,e,t,"setState")},A.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},p.prototype=A.prototype;var b=m.prototype=new p;b.constructor=m,i(b,A.prototype),b.isPureReactComponent=!0;var f={current:null},y=Object.prototype.hasOwnProperty,G={key:!0,ref:!0,__self:!0,__source:!0};function v(e,t,n){var i,r={},a=null,s=null;if(null!=t)for(i in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(a=""+t.key),t)y.call(t,i)&&!G.hasOwnProperty(i)&&(r[i]=t[i]);var g=arguments.length-2;if(1===g)r.children=n;else if(1<g){for(var l=Array(g),c=0;c<g;c++)l[c]=arguments[c+2];r.children=l}if(e&&e.defaultProps)for(i in g=e.defaultProps)void 0===r[i]&&(r[i]=g[i]);return{$$typeof:o,type:e,key:a,ref:s,props:r,_owner:f.current}}function B(e){return"object"===typeof e&&null!==e&&e.$$typeof===o}var Z=/\/+/g;function w(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function W(e,t,n,i,a){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var g=!1;if(null===e)g=!0;else switch(s){case"string":case"number":g=!0;break;case"object":switch(e.$$typeof){case o:case r:g=!0}}if(g)return a=a(g=e),e=""===i?"."+w(g,0):i,Array.isArray(a)?(n="",null!=e&&(n=e.replace(Z,"$&/")+"/"),W(a,t,n,"",(function(e){return e}))):null!=a&&(B(a)&&(a=function(e,t){return{$$typeof:o,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,n+(!a.key||g&&g.key===a.key?"":(""+a.key).replace(Z,"$&/")+"/")+e)),t.push(a)),1;if(g=0,i=""===i?".":i+":",Array.isArray(e))for(var l=0;l<e.length;l++){var c=i+w(s=e[l],l);g+=W(s,t,n,c,a)}else if(c=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=C&&e[C]||e["@@iterator"])?e:null}(e),"function"===typeof c)for(e=c.call(e),l=0;!(s=e.next()).done;)g+=W(s=s.value,t,n,c=i+w(s,l++),a);else if("object"===s)throw t=""+e,Error(u(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t));return g}function S(e,t,n){if(null==e)return e;var i=[],o=0;return W(e,i,"","",(function(e){return t.call(n,e,o++)})),i}function R(e){if(-1===e._status){var t=e._result;t=t(),e._status=0,e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}if(1===e._status)return e._result;throw e._result}var x={current:null};function V(){var e=x.current;if(null===e)throw Error(u(321));return e}var X={ReactCurrentDispatcher:x,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:f,IsSomeRendererActing:{current:!1},assign:i};t.Children={map:S,forEach:function(e,t,n){S(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return S(e,(function(){t++})),t},toArray:function(e){return S(e,(function(e){return e}))||[]},only:function(e){if(!B(e))throw Error(u(143));return e}},t.Component=A,t.PureComponent=m,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=X,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error(u(267,e));var r=i({},e.props),a=e.key,s=e.ref,g=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,g=f.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)y.call(t,c)&&!G.hasOwnProperty(c)&&(r[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)r.children=n;else if(1<c){l=Array(c);for(var I=0;I<c;I++)l[I]=arguments[I+2];r.children=l}return{$$typeof:o,type:e.type,key:a,ref:s,props:r,_owner:g}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:s,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=v,t.createFactory=function(e){var t=v.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:g,render:e}},t.isValidElement=B,t.lazy=function(e){return{$$typeof:c,_payload:{_status:-1,_result:e},_init:R}},t.memo=function(e,t){return{$$typeof:l,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return V().useCallback(e,t)},t.useContext=function(e,t){return V().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return V().useEffect(e,t)},t.useImperativeHandle=function(e,t,n){return V().useImperativeHandle(e,t,n)},t.useLayoutEffect=function(e,t){return V().useLayoutEffect(e,t)},t.useMemo=function(e,t){return V().useMemo(e,t)},t.useReducer=function(e,t,n){return V().useReducer(e,t,n)},t.useRef=function(e){return V().useRef(e)},t.useState=function(e){return V().useState(e)},t.version="17.0.2"},5043:(e,t,n)=>{"use strict";e.exports=n(4202)},579:(e,t,n)=>{"use strict";e.exports=n(1153)},7234:(e,t)=>{"use strict";var n,i,o,r;if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var s=Date,g=s.now();t.unstable_now=function(){return s.now()-g}}if("undefined"===typeof window||"function"!==typeof MessageChannel){var l=null,c=null,I=function(){if(null!==l)try{var e=t.unstable_now();l(!0,e),l=null}catch(n){throw setTimeout(I,0),n}};n=function(e){null!==l?setTimeout(n,0,e):(l=e,setTimeout(I,0))},i=function(e,t){c=setTimeout(e,t)},o=function(){clearTimeout(c)},t.unstable_shouldYield=function(){return!1},r=t.unstable_forceFrameRate=function(){}}else{var C=window.setTimeout,u=window.clearTimeout;if("undefined"!==typeof console){var d=window.cancelAnimationFrame;"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),"function"!==typeof d&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var h=!1,A=null,p=-1,m=5,b=0;t.unstable_shouldYield=function(){return t.unstable_now()>=b},r=function(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):m=0<e?Math.floor(1e3/e):5};var f=new MessageChannel,y=f.port2;f.port1.onmessage=function(){if(null!==A){var e=t.unstable_now();b=e+m;try{A(!0,e)?y.postMessage(null):(h=!1,A=null)}catch(n){throw y.postMessage(null),n}}else h=!1},n=function(e){A=e,h||(h=!0,y.postMessage(null))},i=function(e,n){p=C((function(){e(t.unstable_now())}),n)},o=function(){u(p),p=-1}}function G(e,t){var n=e.length;e.push(t);e:for(;;){var i=n-1>>>1,o=e[i];if(!(void 0!==o&&0<Z(o,t)))break e;e[i]=t,e[n]=o,n=i}}function v(e){return void 0===(e=e[0])?null:e}function B(e){var t=e[0];if(void 0!==t){var n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,o=e.length;i<o;){var r=2*(i+1)-1,a=e[r],s=r+1,g=e[s];if(void 0!==a&&0>Z(a,n))void 0!==g&&0>Z(g,a)?(e[i]=g,e[s]=n,i=s):(e[i]=a,e[r]=n,i=r);else{if(!(void 0!==g&&0>Z(g,n)))break e;e[i]=g,e[s]=n,i=s}}}return t}return null}function Z(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var w=[],W=[],S=1,R=null,x=3,V=!1,X=!1,H=!1;function Y(e){for(var t=v(W);null!==t;){if(null===t.callback)B(W);else{if(!(t.startTime<=e))break;B(W),t.sortIndex=t.expirationTime,G(w,t)}t=v(W)}}function K(e){if(H=!1,Y(e),!X)if(null!==v(w))X=!0,n(N);else{var t=v(W);null!==t&&i(K,t.startTime-e)}}function N(e,n){X=!1,H&&(H=!1,o()),V=!0;var r=x;try{for(Y(n),R=v(w);null!==R&&(!(R.expirationTime>n)||e&&!t.unstable_shouldYield());){var a=R.callback;if("function"===typeof a){R.callback=null,x=R.priorityLevel;var s=a(R.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?R.callback=s:R===v(w)&&B(w),Y(n)}else B(w);R=v(w)}if(null!==R)var g=!0;else{var l=v(W);null!==l&&i(K,l.startTime-n),g=!1}return g}finally{R=null,x=r,V=!1}}var M=r;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){X||V||(X=!0,n(N))},t.unstable_getCurrentPriorityLevel=function(){return x},t.unstable_getFirstCallbackNode=function(){return v(w)},t.unstable_next=function(e){switch(x){case 1:case 2:case 3:var t=3;break;default:t=x}var n=x;x=t;try{return e()}finally{x=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=M,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=x;x=e;try{return t()}finally{x=n}},t.unstable_scheduleCallback=function(e,r,a){var s=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?s+a:s:a=s,e){case 1:var g=-1;break;case 2:g=250;break;case 5:g=1073741823;break;case 4:g=1e4;break;default:g=5e3}return e={id:S++,callback:r,priorityLevel:e,startTime:a,expirationTime:g=a+g,sortIndex:-1},a>s?(e.sortIndex=a,G(W,e),null===v(w)&&e===v(W)&&(H?o():H=!0,i(K,a-s))):(e.sortIndex=g,G(w,e),X||V||(X=!0,n(N))),e},t.unstable_wrapCallback=function(e){var t=x;return function(){var n=x;x=t;try{return e.apply(this,arguments)}finally{x=n}}}},8853:(e,t,n)=>{"use strict";e.exports=n(7234)},4634:e=>{function t(){return e.exports=t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},e.exports.__esModule=!0,e.exports.default=e.exports,t.apply(null,arguments)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},4994:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},4893:e=>{e.exports=function(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(t.includes(i))continue;n[i]=e[i]}return n},e.exports.__esModule=!0,e.exports.default=e.exports},8139:(e,t)=>{var n;!function(){"use strict";var i={}.hasOwnProperty;function o(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=a(e,r(n)))}return e}function r(e){if("string"===typeof e||"number"===typeof e)return e;if("object"!==typeof e)return"";if(Array.isArray(e))return o.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var n in e)i.call(e,n)&&e[n]&&(t=a(t,n));return t}function a(e,t){return t?e?e+" "+t:e+t:e}e.exports?(o.default=o,e.exports=o):void 0===(n=function(){return o}.apply(t,[]))||(e.exports=n)}()},8168:(e,t,n)=>{"use strict";function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},i.apply(null,arguments)}n.d(t,{A:()=>i})},8587:(e,t,n)=>{"use strict";function i(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(t.includes(i))continue;n[i]=e[i]}return n}n.d(t,{A:()=>i})},9408:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ACESFilmicToneMapping:()=>ne,AddEquation:()=>Z,AddOperation:()=>O,AdditiveAnimationBlendMode:()=>Rt,AdditiveBlending:()=>y,AlphaFormat:()=>Ke,AlwaysDepth:()=>T,AlwaysStencilFunc:()=>en,AmbientLight:()=>zI,AmbientLightProbe:()=>iC,AnimationClip:()=>II,AnimationLoader:()=>bI,AnimationMixer:()=>NC,AnimationObjectGroup:()=>YC,AnimationUtils:()=>qc,ArcCurve:()=>Xl,ArrayCamera:()=>tg,ArrowHelper:()=>Zu,Audio:()=>hC,AudioAnalyser:()=>yC,AudioContext:()=>eC,AudioListener:()=>dC,AudioLoader:()=>tC,AxesHelper:()=>wu,AxisHelper:()=>td,BackSide:()=>h,BasicDepthPacking:()=>Kt,BasicShadowMap:()=>c,BinaryTextureLoader:()=>ad,Bone:()=>Lg,BooleanKeyframeTrack:()=>oI,BoundingBoxHelper:()=>nd,Box2:()=>DC,Box3:()=>$n,Box3Helper:()=>fu,BoxBufferGeometry:()=>er,BoxGeometry:()=>er,BoxHelper:()=>bu,BufferAttribute:()=>Ao,BufferGeometry:()=>Yo,BufferGeometryLoader:()=>PI,ByteType:()=>Ze,Cache:()=>uI,Camera:()=>rr,CameraHelper:()=>Au,CanvasRenderer:()=>gd,CanvasTexture:()=>bl,CatmullRomCurve3:()=>Fl,CineonToneMapping:()=>te,CircleBufferGeometry:()=>fl,CircleGeometry:()=>fl,ClampToEdgeWrapping:()=>Ce,Clock:()=>gC,Color:()=>kn,ColorKeyframeTrack:()=>rI,CompressedTexture:()=>ml,CompressedTextureLoader:()=>fI,ConeBufferGeometry:()=>Gl,ConeGeometry:()=>Gl,CubeCamera:()=>gr,CubeReflectionMapping:()=>re,CubeRefractionMapping:()=>ae,CubeTexture:()=>lr,CubeTextureLoader:()=>GI,CubeUVReflectionMapping:()=>le,CubeUVRefractionMapping:()=>ce,CubicBezierCurve:()=>Tl,CubicBezierCurve3:()=>El,CubicInterpolant:()=>eI,CullFaceBack:()=>s,CullFaceFront:()=>g,CullFaceFrontBack:()=>l,CullFaceNone:()=>a,Curve:()=>xl,CurvePath:()=>jl,CustomBlending:()=>B,CustomToneMapping:()=>ie,CylinderBufferGeometry:()=>yl,CylinderGeometry:()=>yl,Cylindrical:()=>JC,DataTexture:()=>Tg,DataTexture2DArray:()=>ia,DataTexture3D:()=>la,DataTextureLoader:()=>vI,DataUtils:()=>xu,DecrementStencilOp:()=>Et,DecrementWrapStencilOp:()=>Ut,DefaultLoadingManager:()=>hI,DepthFormat:()=>ze,DepthStencilFormat:()=>Le,DepthTexture:()=>rg,DirectionalLight:()=>kI,DirectionalLightHelper:()=>uu,DiscreteInterpolant:()=>nI,DodecahedronBufferGeometry:()=>Bl,DodecahedronGeometry:()=>Bl,DoubleSide:()=>A,DstAlphaFactor:()=>N,DstColorFactor:()=>F,DynamicBufferAttribute:()=>Uu,DynamicCopyUsage:()=>ln,DynamicDrawUsage:()=>nn,DynamicReadUsage:()=>an,EdgesGeometry:()=>Rl,EdgesHelper:()=>id,EllipseCurve:()=>Vl,EqualDepth:()=>U,EqualStencilFunc:()=>_t,EquirectangularReflectionMapping:()=>se,EquirectangularRefractionMapping:()=>ge,Euler:()=>Mi,EventDispatcher:()=>dn,ExtrudeBufferGeometry:()=>Wc,ExtrudeGeometry:()=>Wc,FaceColors:()=>Yu,FileLoader:()=>mI,FlatShading:()=>p,Float16BufferAttribute:()=>Bo,Float32Attribute:()=>$u,Float32BufferAttribute:()=>Zo,Float64Attribute:()=>ed,Float64BufferAttribute:()=>wo,FloatType:()=>xe,Fog:()=>Ig,FogExp2:()=>cg,Font:()=>hd,FontLoader:()=>dd,FramebufferTexture:()=>pl,FrontSide:()=>d,Frustum:()=>pr,GLBufferAttribute:()=>kC,GLSL1:()=>In,GLSL3:()=>Cn,GreaterDepth:()=>P,GreaterEqualDepth:()=>D,GreaterEqualStencilFunc:()=>$t,GreaterStencilFunc:()=>Ot,GridHelper:()=>gu,Group:()=>ng,HalfFloatType:()=>Ve,HemisphereLight:()=>wI,HemisphereLightHelper:()=>su,HemisphereLightProbe:()=>nC,IcosahedronBufferGeometry:()=>Rc,IcosahedronGeometry:()=>Rc,ImageBitmapLoader:()=>qI,ImageLoader:()=>yI,ImageUtils:()=>Ln,ImmediateRenderObject:()=>Ad,IncrementStencilOp:()=>Tt,IncrementWrapStencilOp:()=>Jt,InstancedBufferAttribute:()=>Dg,InstancedBufferGeometry:()=>DI,InstancedInterleavedBuffer:()=>FC,InstancedMesh:()=>Og,Int16Attribute:()=>_u,Int16BufferAttribute:()=>fo,Int32Attribute:()=>Ou,Int32BufferAttribute:()=>Go,Int8Attribute:()=>Du,Int8BufferAttribute:()=>po,IntType:()=>Se,InterleavedBuffer:()=>ug,InterleavedBufferAttribute:()=>hg,Interpolant:()=>$c,InterpolateDiscrete:()=>Gt,InterpolateLinear:()=>vt,InterpolateSmooth:()=>Bt,InvertStencilOp:()=>Dt,JSONLoader:()=>ld,KeepStencilOp:()=>zt,KeyframeTrack:()=>iI,LOD:()=>Yg,LatheBufferGeometry:()=>xc,LatheGeometry:()=>xc,Layers:()=>Fi,LensFlare:()=>Id,LessDepth:()=>E,LessEqualDepth:()=>J,LessEqualStencilFunc:()=>jt,LessStencilFunc:()=>Qt,Light:()=>ZI,LightProbe:()=>EI,Line:()=>ol,Line3:()=>_C,LineBasicMaterial:()=>qg,LineCurve:()=>Jl,LineCurve3:()=>Ul,LineDashedMaterial:()=>jc,LineLoop:()=>gl,LinePieces:()=>Xu,LineSegments:()=>sl,LineStrip:()=>Vu,LinearEncoding:()=>Ht,LinearFilter:()=>be,LinearInterpolant:()=>tI,LinearMipMapLinearFilter:()=>ve,LinearMipMapNearestFilter:()=>ye,LinearMipmapLinearFilter:()=>Ge,LinearMipmapNearestFilter:()=>fe,LinearToneMapping:()=>$,Loader:()=>AI,LoaderUtils:()=>UI,LoadingManager:()=>dI,LoopOnce:()=>bt,LoopPingPong:()=>yt,LoopRepeat:()=>ft,LuminanceAlphaFormat:()=>ke,LuminanceFormat:()=>Fe,MOUSE:()=>o,Material:()=>Io,MaterialLoader:()=>JI,Math:()=>wn,MathUtils:()=>wn,Matrix3:()=>Sn,Matrix4:()=>Wi,MaxEquation:()=>R,Mesh:()=>qo,MeshBasicMaterial:()=>Co,MeshDepthMaterial:()=>Ps,MeshDistanceMaterial:()=>Qs,MeshFaceMaterial:()=>Nu,MeshLambertMaterial:()=>Qc,MeshMatcapMaterial:()=>_c,MeshNormalMaterial:()=>Pc,MeshPhongMaterial:()=>Uc,MeshPhysicalMaterial:()=>Jc,MeshStandardMaterial:()=>Ec,MeshToonMaterial:()=>Dc,MinEquation:()=>S,MirroredRepeatWrapping:()=>ue,MixOperation:()=>j,MultiMaterial:()=>Mu,MultiplyBlending:()=>v,MultiplyOperation:()=>_,NearestFilter:()=>de,NearestMipMapLinearFilter:()=>me,NearestMipMapNearestFilter:()=>Ae,NearestMipmapLinearFilter:()=>pe,NearestMipmapNearestFilter:()=>he,NeverDepth:()=>L,NeverStencilFunc:()=>Pt,NoBlending:()=>b,NoColors:()=>Hu,NoToneMapping:()=>q,NormalAnimationBlendMode:()=>St,NormalBlending:()=>f,NotEqualDepth:()=>Q,NotEqualStencilFunc:()=>qt,NumberKeyframeTrack:()=>aI,Object3D:()=>qi,ObjectLoader:()=>QI,ObjectSpaceNormalMap:()=>Ft,OctahedronBufferGeometry:()=>Vc,OctahedronGeometry:()=>Vc,OneFactor:()=>V,OneMinusDstAlphaFactor:()=>M,OneMinusDstColorFactor:()=>k,OneMinusSrcAlphaFactor:()=>K,OneMinusSrcColorFactor:()=>H,OrthographicCamera:()=>xr,PCFShadowMap:()=>I,PCFSoftShadowMap:()=>C,PMREMGenerator:()=>Ur,ParametricGeometry:()=>Cd,Particle:()=>ku,ParticleBasicMaterial:()=>Tu,ParticleSystem:()=>zu,ParticleSystemMaterial:()=>Eu,Path:()=>Ol,PerspectiveCamera:()=>ar,Plane:()=>dr,PlaneBufferGeometry:()=>fr,PlaneGeometry:()=>fr,PlaneHelper:()=>yu,PointCloud:()=>Fu,PointCloudMaterial:()=>Lu,PointLight:()=>MI,PointLightHelper:()=>iu,Points:()=>dl,PointsMaterial:()=>ll,PolarGridHelper:()=>lu,PolyhedronBufferGeometry:()=>vl,PolyhedronGeometry:()=>vl,PositionalAudio:()=>fC,PropertyBinding:()=>HC,PropertyMixer:()=>GC,QuadraticBezierCurve:()=>Dl,QuadraticBezierCurve3:()=>Pl,Quaternion:()=>_n,QuaternionKeyframeTrack:()=>gI,QuaternionLinearInterpolant:()=>sI,REVISION:()=>i,RGBADepthPacking:()=>Nt,RGBAFormat:()=>Me,RGBAIntegerFormat:()=>De,RGBA_ASTC_10x10_Format:()=>ht,RGBA_ASTC_10x5_Format:()=>Ct,RGBA_ASTC_10x6_Format:()=>ut,RGBA_ASTC_10x8_Format:()=>dt,RGBA_ASTC_12x10_Format:()=>At,RGBA_ASTC_12x12_Format:()=>pt,RGBA_ASTC_4x4_Format:()=>ot,RGBA_ASTC_5x4_Format:()=>rt,RGBA_ASTC_5x5_Format:()=>at,RGBA_ASTC_6x5_Format:()=>st,RGBA_ASTC_6x6_Format:()=>gt,RGBA_ASTC_8x5_Format:()=>lt,RGBA_ASTC_8x6_Format:()=>ct,RGBA_ASTC_8x8_Format:()=>It,RGBA_BPTC_Format:()=>mt,RGBA_ETC2_EAC_Format:()=>it,RGBA_PVRTC_2BPPV1_Format:()=>et,RGBA_PVRTC_4BPPV1_Format:()=>$e,RGBA_S3TC_DXT1_Format:()=>Qe,RGBA_S3TC_DXT3_Format:()=>_e,RGBA_S3TC_DXT5_Format:()=>je,RGBFormat:()=>Ne,RGB_ETC1_Format:()=>tt,RGB_ETC2_Format:()=>nt,RGB_PVRTC_2BPPV1_Format:()=>qe,RGB_PVRTC_4BPPV1_Format:()=>Oe,RGB_S3TC_DXT1_Format:()=>Pe,RGFormat:()=>Je,RGIntegerFormat:()=>Ue,RawShaderMaterial:()=>Vr,Ray:()=>wi,Raycaster:()=>zC,RectAreaLight:()=>LI,RedFormat:()=>Te,RedIntegerFormat:()=>Ee,ReinhardToneMapping:()=>ee,RepeatWrapping:()=>Ie,ReplaceStencilOp:()=>Lt,ReverseSubtractEquation:()=>W,RingBufferGeometry:()=>Xc,RingGeometry:()=>Xc,Scene:()=>Cg,SceneUtils:()=>cd,ShaderChunk:()=>yr,ShaderLib:()=>vr,ShaderMaterial:()=>or,ShadowMaterial:()=>Tc,Shape:()=>ql,ShapeBufferGeometry:()=>Hc,ShapeGeometry:()=>Hc,ShapePath:()=>Wu,ShapeUtils:()=>Bc,ShortType:()=>we,Skeleton:()=>Ug,SkeletonHelper:()=>tu,SkinnedMesh:()=>zg,SmoothShading:()=>m,Sphere:()=>mi,SphereBufferGeometry:()=>Yc,SphereGeometry:()=>Yc,Spherical:()=>EC,SphericalHarmonics3:()=>TI,SplineCurve:()=>Ql,SpotLight:()=>XI,SpotLightHelper:()=>OC,Sprite:()=>xg,SpriteMaterial:()=>Ag,SrcAlphaFactor:()=>Y,SrcAlphaSaturateFactor:()=>z,SrcColorFactor:()=>X,StaticCopyUsage:()=>gn,StaticDrawUsage:()=>tn,StaticReadUsage:()=>rn,StereoCamera:()=>sC,StreamCopyUsage:()=>cn,StreamDrawUsage:()=>on,StreamReadUsage:()=>sn,StringKeyframeTrack:()=>lI,SubtractEquation:()=>w,SubtractiveBlending:()=>G,TOUCH:()=>r,TangentSpaceNormalMap:()=>Mt,TetrahedronBufferGeometry:()=>Kc,TetrahedronGeometry:()=>Kc,TextGeometry:()=>ud,Texture:()=>En,TextureLoader:()=>BI,TorusBufferGeometry:()=>Nc,TorusGeometry:()=>Nc,TorusKnotBufferGeometry:()=>Mc,TorusKnotGeometry:()=>Mc,Triangle:()=>lo,TriangleFanDrawMode:()=>Xt,TriangleStripDrawMode:()=>Vt,TrianglesDrawMode:()=>xt,TubeBufferGeometry:()=>Fc,TubeGeometry:()=>Fc,UVMapping:()=>oe,Uint16Attribute:()=>ju,Uint16BufferAttribute:()=>yo,Uint32Attribute:()=>qu,Uint32BufferAttribute:()=>vo,Uint8Attribute:()=>Pu,Uint8BufferAttribute:()=>mo,Uint8ClampedAttribute:()=>Qu,Uint8ClampedBufferAttribute:()=>bo,Uniform:()=>MC,UniformsLib:()=>Gr,UniformsUtils:()=>ir,UnsignedByteType:()=>Be,UnsignedInt248Type:()=>Ye,UnsignedIntType:()=>Re,UnsignedShort4444Type:()=>Xe,UnsignedShort5551Type:()=>He,UnsignedShortType:()=>We,VSMShadowMap:()=>u,Vector2:()=>Wn,Vector3:()=>jn,Vector4:()=>Un,VectorKeyframeTrack:()=>cI,Vertex:()=>Ju,VertexColors:()=>Ku,VideoTexture:()=>Al,WebGL1Renderer:()=>lg,WebGLCubeRenderTarget:()=>cr,WebGLMultipleRenderTargets:()=>Pn,WebGLMultisampleRenderTarget:()=>Qn,WebGLRenderTarget:()=>Dn,WebGLRenderTargetCube:()=>sd,WebGLRenderer:()=>gg,WebGLUtils:()=>eg,WireframeGeometry:()=>kc,WireframeHelper:()=>od,WrapAroundEnding:()=>Wt,XHRLoader:()=>rd,ZeroCurvatureEnding:()=>Zt,ZeroFactor:()=>x,ZeroSlopeEnding:()=>wt,ZeroStencilOp:()=>kt,_SRGBAFormat:()=>un,sRGBEncoding:()=>Yt});const i="137",o={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},r={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},a=0,s=1,g=2,l=3,c=0,I=1,C=2,u=3,d=0,h=1,A=2,p=1,m=2,b=0,f=1,y=2,G=3,v=4,B=5,Z=100,w=101,W=102,S=103,R=104,x=200,V=201,X=202,H=203,Y=204,K=205,N=206,M=207,F=208,k=209,z=210,L=0,T=1,E=2,J=3,U=4,D=5,P=6,Q=7,_=0,j=1,O=2,q=0,$=1,ee=2,te=3,ne=4,ie=5,oe=300,re=301,ae=302,se=303,ge=304,le=306,ce=307,Ie=1e3,Ce=1001,ue=1002,de=1003,he=1004,Ae=1004,pe=1005,me=1005,be=1006,fe=1007,ye=1007,Ge=1008,ve=1008,Be=1009,Ze=1010,we=1011,We=1012,Se=1013,Re=1014,xe=1015,Ve=1016,Xe=1017,He=1018,Ye=1020,Ke=1021,Ne=1022,Me=1023,Fe=1024,ke=1025,ze=1026,Le=1027,Te=1028,Ee=1029,Je=1030,Ue=1031,De=1033,Pe=33776,Qe=33777,_e=33778,je=33779,Oe=35840,qe=35841,$e=35842,et=35843,tt=36196,nt=37492,it=37496,ot=37808,rt=37809,at=37810,st=37811,gt=37812,lt=37813,ct=37814,It=37815,Ct=37816,ut=37817,dt=37818,ht=37819,At=37820,pt=37821,mt=36492,bt=2200,ft=2201,yt=2202,Gt=2300,vt=2301,Bt=2302,Zt=2400,wt=2401,Wt=2402,St=2500,Rt=2501,xt=0,Vt=1,Xt=2,Ht=3e3,Yt=3001,Kt=3200,Nt=3201,Mt=0,Ft=1,kt=0,zt=7680,Lt=7681,Tt=7682,Et=7683,Jt=34055,Ut=34056,Dt=5386,Pt=512,Qt=513,_t=514,jt=515,Ot=516,qt=517,$t=518,en=519,tn=35044,nn=35048,on=35040,rn=35045,an=35049,sn=35041,gn=35046,ln=35050,cn=35042,In="100",Cn="300 es",un=1035;class dn{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}const hn=[];for(let pd=0;pd<256;pd++)hn[pd]=(pd<16?"0":"")+pd.toString(16);let An=1234567;const pn=Math.PI/180,mn=180/Math.PI;function bn(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(hn[255&e]+hn[e>>8&255]+hn[e>>16&255]+hn[e>>24&255]+"-"+hn[255&t]+hn[t>>8&255]+"-"+hn[t>>16&15|64]+hn[t>>24&255]+"-"+hn[63&n|128]+hn[n>>8&255]+"-"+hn[n>>16&255]+hn[n>>24&255]+hn[255&i]+hn[i>>8&255]+hn[i>>16&255]+hn[i>>24&255]).toUpperCase()}function fn(e,t,n){return Math.max(t,Math.min(n,e))}function yn(e,t){return(e%t+t)%t}function Gn(e,t,n){return(1-n)*e+n*t}function vn(e){return 0===(e&e-1)&&0!==e}function Bn(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Zn(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var wn=Object.freeze({__proto__:null,DEG2RAD:pn,RAD2DEG:mn,generateUUID:bn,clamp:fn,euclideanModulo:yn,mapLinear:function(e,t,n,i,o){return i+(e-t)*(o-i)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:Gn,damp:function(e,t,n,i){return Gn(e,t,1-Math.exp(-n*i))},pingpong:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(yn(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(An=e%2147483647),An=16807*An%2147483647,(An-1)/2147483646},degToRad:function(e){return e*pn},radToDeg:function(e){return e*mn},isPowerOfTwo:vn,ceilPowerOfTwo:Bn,floorPowerOfTwo:Zn,setQuaternionFromProperEuler:function(e,t,n,i,o){const r=Math.cos,a=Math.sin,s=r(n/2),g=a(n/2),l=r((t+i)/2),c=a((t+i)/2),I=r((t-i)/2),C=a((t-i)/2),u=r((i-t)/2),d=a((i-t)/2);switch(o){case"XYX":e.set(s*c,g*I,g*C,s*l);break;case"YZY":e.set(g*C,s*c,g*I,s*l);break;case"ZXZ":e.set(g*I,g*C,s*c,s*l);break;case"XZX":e.set(s*c,g*d,g*u,s*l);break;case"YXY":e.set(g*u,s*c,g*d,s*l);break;case"ZYZ":e.set(g*d,g*u,s*c,s*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+o)}}});class Wn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),o=this.x-e.x,r=this.y-e.y;return this.x=o*n-r*i+e.x,this.y=o*i+r*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}Wn.prototype.isVector2=!0;class Sn{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,o,r,a,s,g){const l=this.elements;return l[0]=e,l[1]=i,l[2]=a,l[3]=t,l[4]=o,l[5]=s,l[6]=n,l[7]=r,l[8]=g,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,o=this.elements,r=n[0],a=n[3],s=n[6],g=n[1],l=n[4],c=n[7],I=n[2],C=n[5],u=n[8],d=i[0],h=i[3],A=i[6],p=i[1],m=i[4],b=i[7],f=i[2],y=i[5],G=i[8];return o[0]=r*d+a*p+s*f,o[3]=r*h+a*m+s*y,o[6]=r*A+a*b+s*G,o[1]=g*d+l*p+c*f,o[4]=g*h+l*m+c*y,o[7]=g*A+l*b+c*G,o[2]=I*d+C*p+u*f,o[5]=I*h+C*m+u*y,o[8]=I*A+C*b+u*G,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],o=e[3],r=e[4],a=e[5],s=e[6],g=e[7],l=e[8];return t*r*l-t*a*g-n*o*l+n*a*s+i*o*g-i*r*s}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],o=e[3],r=e[4],a=e[5],s=e[6],g=e[7],l=e[8],c=l*r-a*g,I=a*s-l*o,C=g*o-r*s,u=t*c+n*I+i*C;if(0===u)return this.set(0,0,0,0,0,0,0,0,0);const d=1/u;return e[0]=c*d,e[1]=(i*g-l*n)*d,e[2]=(a*n-i*r)*d,e[3]=I*d,e[4]=(l*t-i*s)*d,e[5]=(i*o-a*t)*d,e[6]=C*d,e[7]=(n*s-g*t)*d,e[8]=(r*t-n*o)*d,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,o,r,a){const s=Math.cos(o),g=Math.sin(o);return this.set(n*s,n*g,-n*(s*r+g*a)+r+e,-i*g,i*s,-i*(-g*r+s*a)+a+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),i=this.elements,o=i[0],r=i[3],a=i[6],s=i[1],g=i[4],l=i[7];return i[0]=t*o+n*s,i[3]=t*r+n*g,i[6]=t*a+n*l,i[1]=-n*o+t*s,i[4]=-n*r+t*g,i[7]=-n*a+t*l,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}function Rn(e){for(let t=e.length-1;t>=0;--t)if(e[t]>65535)return!0;return!1}Sn.prototype.isMatrix3=!0;const xn={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Vn(e,t){return new xn[e](t)}function Xn(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}const Hn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Yn={h:0,s:0,l:0},Kn={h:0,s:0,l:0};function Nn(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function Mn(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Fn(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class kn{constructor(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"===typeof e?this.setHex(e):"string"===typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){if(e=yn(e,1),t=fn(t,0,1),n=fn(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,o=2*n-i;this.r=Nn(o,i,e+1/3),this.g=Nn(o,i,e),this.b=Nn(o,i,e-1/3)}return this}setStyle(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const i=n[1],o=n[2];switch(i){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){const n=parseFloat(e[1])/360,i=parseInt(e[2],10)/100,o=parseInt(e[3],10)/100;return t(e[4]),this.setHSL(n,i,o)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=n[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=Hn[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Mn(e.r),this.g=Mn(e.g),this.b=Mn(e.b),this}copyLinearToSRGB(e){return this.r=Fn(e.r),this.g=Fn(e.g),this.b=Fn(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){const t=this.r,n=this.g,i=this.b,o=Math.max(t,n,i),r=Math.min(t,n,i);let a,s;const g=(r+o)/2;if(r===o)a=0,s=0;else{const e=o-r;switch(s=g<=.5?e/(o+r):e/(2-o-r),o){case t:a=(n-i)/e+(n<i?6:0);break;case n:a=(i-t)/e+2;break;case i:a=(t-n)/e+4}a/=6}return e.h=a,e.s=s,e.l=g,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,n){return this.getHSL(Yn),Yn.h+=e,Yn.s+=t,Yn.l+=n,this.setHSL(Yn.h,Yn.s,Yn.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Yn),e.getHSL(Kn);const n=Gn(Yn.h,Kn.h,t),i=Gn(Yn.s,Kn.s,t),o=Gn(Yn.l,Kn.l,t);return this.setHSL(n,i,o),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}let zn;kn.NAMES=Hn,kn.prototype.isColor=!0,kn.prototype.r=1,kn.prototype.g=1,kn.prototype.b=1;class Ln{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===zn&&(zn=Xn("canvas")),zn.width=e.width,zn.height=e.height;const n=zn.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=zn}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){const t=Xn("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),o=i.data;for(let e=0;e<o.length;e++)o[e]=255*Mn(o[e]/255);return n.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*Mn(t[e]/255)):t[e]=Mn(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Tn=0;class En extends dn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:En.DEFAULT_IMAGE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:En.DEFAULT_MAPPING,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ce,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ce,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:be,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Ge,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Me,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Be,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:Ht;super(),Object.defineProperty(this,"id",{value:Tn++}),this.uuid=bn(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=i,this.magFilter=o,this.minFilter=r,this.anisotropy=g,this.format=a,this.internalFormat=null,this.type=s,this.offset=new Wn(0,0),this.repeat=new Wn(1,1),this.center=new Wn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Sn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=l,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const i=this.image;if(void 0===i.uuid&&(i.uuid=bn()),!t&&void 0===e.images[i.uuid]){let t;if(Array.isArray(i)){t=[];for(let e=0,n=i.length;e<n;e++)i[e].isDataTexture?t.push(Jn(i[e].image)):t.push(Jn(i[e]))}else t=Jn(i);e.images[i.uuid]={uuid:i.uuid,url:t}}n.image=i.uuid}return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==oe)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ie:e.x=e.x-Math.floor(e.x);break;case Ce:e.x=e.x<0?0:1;break;case ue:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case Ie:e.y=e.y-Math.floor(e.y);break;case Ce:e.y=e.y<0?0:1;break;case ue:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&this.version++}}function Jn(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?Ln.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}En.DEFAULT_IMAGE=void 0,En.DEFAULT_MAPPING=oe,En.prototype.isTexture=!0;class Un{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,o=this.w,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i+r[12]*o,this.y=r[1]*t+r[5]*n+r[9]*i+r[13]*o,this.z=r[2]*t+r[6]*n+r[10]*i+r[14]*o,this.w=r[3]*t+r[7]*n+r[11]*i+r[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,o;const r=.01,a=.1,s=e.elements,g=s[0],l=s[4],c=s[8],I=s[1],C=s[5],u=s[9],d=s[2],h=s[6],A=s[10];if(Math.abs(l-I)<r&&Math.abs(c-d)<r&&Math.abs(u-h)<r){if(Math.abs(l+I)<a&&Math.abs(c+d)<a&&Math.abs(u+h)<a&&Math.abs(g+C+A-3)<a)return this.set(1,0,0,0),this;t=Math.PI;const e=(g+1)/2,s=(C+1)/2,p=(A+1)/2,m=(l+I)/4,b=(c+d)/4,f=(u+h)/4;return e>s&&e>p?e<r?(n=0,i=.707106781,o=.707106781):(n=Math.sqrt(e),i=m/n,o=b/n):s>p?s<r?(n=.707106781,i=0,o=.707106781):(i=Math.sqrt(s),n=m/i,o=f/i):p<r?(n=.707106781,i=.707106781,o=0):(o=Math.sqrt(p),n=b/o,i=f/o),this.set(n,i,o,t),this}let p=Math.sqrt((h-u)*(h-u)+(c-d)*(c-d)+(I-l)*(I-l));return Math.abs(p)<.001&&(p=1),this.x=(h-u)/p,this.y=(c-d)/p,this.z=(I-l)/p,this.w=Math.acos((g+C+A-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Un.prototype.isVector4=!0;class Dn extends dn{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.width=e,this.height=t,this.depth=1,this.scissor=new Un(0,0,e,t),this.scissorTest=!1,this.viewport=new Un(0,0,e,t),this.texture=new En(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:be,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image=Object.assign({},e.texture.image),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}Dn.prototype.isWebGLRenderTarget=!0;class Pn extends Dn{constructor(e,t,n){super(e,t);const i=this.texture;this.texture=[];for(let o=0;o<n;o++)this.texture[o]=i.clone()}setSize(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,o=this.texture.length;i<o;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone();return this}}Pn.prototype.isWebGLMultipleRenderTargets=!0;class Qn extends Dn{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(e,t,n),this.samples=4,this.ignoreDepthForMultisampleCopy=void 0===n.ignoreDepth||n.ignoreDepth,this.useRenderToTexture=void 0!==n.useRenderToTexture&&n.useRenderToTexture,this.useRenderbuffer=!1===this.useRenderToTexture}copy(e){return super.copy.call(this,e),this.samples=e.samples,this.useRenderToTexture=e.useRenderToTexture,this.useRenderbuffer=e.useRenderbuffer,this}}Qn.prototype.isWebGLMultisampleRenderTarget=!0;class _n{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._x=e,this._y=t,this._z=n,this._w=i}static slerp(e,t,n,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,i)}static slerpFlat(e,t,n,i,o,r,a){let s=n[i+0],g=n[i+1],l=n[i+2],c=n[i+3];const I=o[r+0],C=o[r+1],u=o[r+2],d=o[r+3];if(0===a)return e[t+0]=s,e[t+1]=g,e[t+2]=l,void(e[t+3]=c);if(1===a)return e[t+0]=I,e[t+1]=C,e[t+2]=u,void(e[t+3]=d);if(c!==d||s!==I||g!==C||l!==u){let e=1-a;const t=s*I+g*C+l*u+c*d,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const o=Math.sqrt(i),r=Math.atan2(o,t*n);e=Math.sin(e*r)/o,a=Math.sin(a*r)/o}const o=a*n;if(s=s*e+I*o,g=g*e+C*o,l=l*e+u*o,c=c*e+d*o,e===1-a){const e=1/Math.sqrt(s*s+g*g+l*l+c*c);s*=e,g*=e,l*=e,c*=e}}e[t]=s,e[t+1]=g,e[t+2]=l,e[t+3]=c}static multiplyQuaternionsFlat(e,t,n,i,o,r){const a=n[i],s=n[i+1],g=n[i+2],l=n[i+3],c=o[r],I=o[r+1],C=o[r+2],u=o[r+3];return e[t]=a*u+l*c+s*C-g*I,e[t+1]=s*u+l*I+g*c-a*C,e[t+2]=g*u+l*C+a*I-s*c,e[t+3]=l*u-a*c-s*I-g*C,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=e._x,i=e._y,o=e._z,r=e._order,a=Math.cos,s=Math.sin,g=a(n/2),l=a(i/2),c=a(o/2),I=s(n/2),C=s(i/2),u=s(o/2);switch(r){case"XYZ":this._x=I*l*c+g*C*u,this._y=g*C*c-I*l*u,this._z=g*l*u+I*C*c,this._w=g*l*c-I*C*u;break;case"YXZ":this._x=I*l*c+g*C*u,this._y=g*C*c-I*l*u,this._z=g*l*u-I*C*c,this._w=g*l*c+I*C*u;break;case"ZXY":this._x=I*l*c-g*C*u,this._y=g*C*c+I*l*u,this._z=g*l*u+I*C*c,this._w=g*l*c-I*C*u;break;case"ZYX":this._x=I*l*c-g*C*u,this._y=g*C*c+I*l*u,this._z=g*l*u-I*C*c,this._w=g*l*c+I*C*u;break;case"YZX":this._x=I*l*c+g*C*u,this._y=g*C*c+I*l*u,this._z=g*l*u-I*C*c,this._w=g*l*c-I*C*u;break;case"XZY":this._x=I*l*c-g*C*u,this._y=g*C*c-I*l*u,this._z=g*l*u+I*C*c,this._w=g*l*c+I*C*u;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],o=t[8],r=t[1],a=t[5],s=t[9],g=t[2],l=t[6],c=t[10],I=n+a+c;if(I>0){const e=.5/Math.sqrt(I+1);this._w=.25/e,this._x=(l-s)*e,this._y=(o-g)*e,this._z=(r-i)*e}else if(n>a&&n>c){const e=2*Math.sqrt(1+n-a-c);this._w=(l-s)/e,this._x=.25*e,this._y=(i+r)/e,this._z=(o+g)/e}else if(a>c){const e=2*Math.sqrt(1+a-n-c);this._w=(o-g)/e,this._x=(i+r)/e,this._y=.25*e,this._z=(s+l)/e}else{const e=2*Math.sqrt(1+c-n-a);this._w=(r-i)/e,this._x=(o+g)/e,this._y=(s+l)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(fn(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,o=e._z,r=e._w,a=t._x,s=t._y,g=t._z,l=t._w;return this._x=n*l+r*a+i*g-o*s,this._y=i*l+r*s+o*a-n*g,this._z=o*l+r*g+n*s-i*a,this._w=r*l-n*a-i*s-o*g,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,o=this._z,r=this._w;let a=r*e._w+n*e._x+i*e._y+o*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=r,this._x=n,this._y=i,this._z=o,this;const s=1-a*a;if(s<=Number.EPSILON){const e=1-t;return this._w=e*r+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*o+t*this._z,this.normalize(),this._onChangeCallback(),this}const g=Math.sqrt(s),l=Math.atan2(g,a),c=Math.sin((1-t)*l)/g,I=Math.sin(t*l)/g;return this._w=r*c+this._w*I,this._x=n*c+this._x*I,this._y=i*c+this._y*I,this._z=o*c+this._z*I,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),o=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(o),n*Math.cos(o),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}_n.prototype.isQuaternion=!0;class jn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(qn.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(qn.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[3]*n+o[6]*i,this.y=o[1]*t+o[4]*n+o[7]*i,this.z=o[2]*t+o[5]*n+o[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,o=e.elements,r=1/(o[3]*t+o[7]*n+o[11]*i+o[15]);return this.x=(o[0]*t+o[4]*n+o[8]*i+o[12])*r,this.y=(o[1]*t+o[5]*n+o[9]*i+o[13])*r,this.z=(o[2]*t+o[6]*n+o[10]*i+o[14])*r,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,o=e.x,r=e.y,a=e.z,s=e.w,g=s*t+r*i-a*n,l=s*n+a*t-o*i,c=s*i+o*n-r*t,I=-o*t-r*n-a*i;return this.x=g*s+I*-o+l*-a-c*-r,this.y=l*s+I*-r+c*-o-g*-a,this.z=c*s+I*-a+g*-r-l*-o,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i,this.y=o[1]*t+o[5]*n+o[9]*i,this.z=o[2]*t+o[6]*n+o[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,o=e.z,r=t.x,a=t.y,s=t.z;return this.x=i*s-o*a,this.y=o*r-n*s,this.z=n*a-i*r,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return On.copy(this).projectOnVector(e),this.sub(On)}reflect(e){return this.sub(On.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(fn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}jn.prototype.isVector3=!0;const On=new jn,qn=new _n;class $n{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new jn(1/0,1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new jn(-1/0,-1/0,-1/0);this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,i=1/0,o=-1/0,r=-1/0,a=-1/0;for(let s=0,g=e.length;s<g;s+=3){const g=e[s],l=e[s+1],c=e[s+2];g<t&&(t=g),l<n&&(n=l),c<i&&(i=c),g>o&&(o=g),l>r&&(r=l),c>a&&(a=c)}return this.min.set(t,n,i),this.max.set(o,r,a),this}setFromBufferAttribute(e){let t=1/0,n=1/0,i=1/0,o=-1/0,r=-1/0,a=-1/0;for(let s=0,g=e.count;s<g;s++){const g=e.getX(s),l=e.getY(s),c=e.getZ(s);g<t&&(t=g),l<n&&(n=l),c<i&&(i=c),g>o&&(o=g),l>r&&(r=l),c>a&&(a=c)}return this.min.set(t,n,i),this.max.set(o,r,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=ti.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n)if(t&&void 0!=n.attributes&&void 0!==n.attributes.position){const t=n.attributes.position;for(let n=0,i=t.count;n<i;n++)ti.fromBufferAttribute(t,n).applyMatrix4(e.matrixWorld),this.expandByPoint(ti)}else null===n.boundingBox&&n.computeBoundingBox(),ni.copy(n.boundingBox),ni.applyMatrix4(e.matrixWorld),this.union(ni);const i=e.children;for(let o=0,r=i.length;o<r;o++)this.expandByObject(i[o],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,ti),ti.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(li),ci.subVectors(this.max,li),ii.subVectors(e.a,li),oi.subVectors(e.b,li),ri.subVectors(e.c,li),ai.subVectors(oi,ii),si.subVectors(ri,oi),gi.subVectors(ii,ri);let t=[0,-ai.z,ai.y,0,-si.z,si.y,0,-gi.z,gi.y,ai.z,0,-ai.x,si.z,0,-si.x,gi.z,0,-gi.x,-ai.y,ai.x,0,-si.y,si.x,0,-gi.y,gi.x,0];return!!ui(t,ii,oi,ri,ci)&&(t=[1,0,0,0,1,0,0,0,1],!!ui(t,ii,oi,ri,ci)&&(Ii.crossVectors(ai,si),t=[Ii.x,Ii.y,Ii.z],ui(t,ii,oi,ri,ci)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return ti.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(ti).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(ei[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ei[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ei[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ei[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ei[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ei[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ei[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ei[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ei)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}$n.prototype.isBox3=!0;const ei=[new jn,new jn,new jn,new jn,new jn,new jn,new jn,new jn],ti=new jn,ni=new $n,ii=new jn,oi=new jn,ri=new jn,ai=new jn,si=new jn,gi=new jn,li=new jn,ci=new jn,Ii=new jn,Ci=new jn;function ui(e,t,n,i,o){for(let r=0,a=e.length-3;r<=a;r+=3){Ci.fromArray(e,r);const a=o.x*Math.abs(Ci.x)+o.y*Math.abs(Ci.y)+o.z*Math.abs(Ci.z),s=t.dot(Ci),g=n.dot(Ci),l=i.dot(Ci);if(Math.max(-Math.max(s,g,l),Math.min(s,g,l))>a)return!1}return!0}const di=new $n,hi=new jn,Ai=new jn,pi=new jn;class mi{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new jn,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):di.setFromPoints(e).getCenter(n);let i=0;for(let o=0,r=e.length;o<r;o++)i=Math.max(i,n.distanceToSquared(e[o]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){pi.subVectors(e,this.center);const t=pi.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.add(pi.multiplyScalar(n/e)),this.radius+=n}return this}union(e){return!0===this.center.equals(e.center)?Ai.set(0,0,1).multiplyScalar(e.radius):Ai.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(hi.copy(e.center).add(Ai)),this.expandByPoint(hi.copy(e.center).sub(Ai)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const bi=new jn,fi=new jn,yi=new jn,Gi=new jn,vi=new jn,Bi=new jn,Zi=new jn;class wi{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new jn,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new jn(0,0,-1);this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,bi)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=bi.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(bi.copy(this.direction).multiplyScalar(t).add(this.origin),bi.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){fi.copy(e).add(t).multiplyScalar(.5),yi.copy(t).sub(e).normalize(),Gi.copy(this.origin).sub(fi);const o=.5*e.distanceTo(t),r=-this.direction.dot(yi),a=Gi.dot(this.direction),s=-Gi.dot(yi),g=Gi.lengthSq(),l=Math.abs(1-r*r);let c,I,C,u;if(l>0)if(c=r*s-a,I=r*a-s,u=o*l,c>=0)if(I>=-u)if(I<=u){const e=1/l;c*=e,I*=e,C=c*(c+r*I+2*a)+I*(r*c+I+2*s)+g}else I=o,c=Math.max(0,-(r*I+a)),C=-c*c+I*(I+2*s)+g;else I=-o,c=Math.max(0,-(r*I+a)),C=-c*c+I*(I+2*s)+g;else I<=-u?(c=Math.max(0,-(-r*o+a)),I=c>0?-o:Math.min(Math.max(-o,-s),o),C=-c*c+I*(I+2*s)+g):I<=u?(c=0,I=Math.min(Math.max(-o,-s),o),C=I*(I+2*s)+g):(c=Math.max(0,-(r*o+a)),I=c>0?o:Math.min(Math.max(-o,-s),o),C=-c*c+I*(I+2*s)+g);else I=r>0?-o:o,c=Math.max(0,-(r*I+a)),C=-c*c+I*(I+2*s)+g;return n&&n.copy(this.direction).multiplyScalar(c).add(this.origin),i&&i.copy(yi).multiplyScalar(I).add(fi),C}intersectSphere(e,t){bi.subVectors(e.center,this.origin);const n=bi.dot(this.direction),i=bi.dot(bi)-n*n,o=e.radius*e.radius;if(i>o)return null;const r=Math.sqrt(o-i),a=n-r,s=n+r;return a<0&&s<0?null:a<0?this.at(s,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,o,r,a,s;const g=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,I=this.origin;return g>=0?(n=(e.min.x-I.x)*g,i=(e.max.x-I.x)*g):(n=(e.max.x-I.x)*g,i=(e.min.x-I.x)*g),l>=0?(o=(e.min.y-I.y)*l,r=(e.max.y-I.y)*l):(o=(e.max.y-I.y)*l,r=(e.min.y-I.y)*l),n>r||o>i?null:((o>n||n!==n)&&(n=o),(r<i||i!==i)&&(i=r),c>=0?(a=(e.min.z-I.z)*c,s=(e.max.z-I.z)*c):(a=(e.max.z-I.z)*c,s=(e.min.z-I.z)*c),n>s||a>i?null:((a>n||n!==n)&&(n=a),(s<i||i!==i)&&(i=s),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,bi)}intersectTriangle(e,t,n,i,o){vi.subVectors(t,e),Bi.subVectors(n,e),Zi.crossVectors(vi,Bi);let r,a=this.direction.dot(Zi);if(a>0){if(i)return null;r=1}else{if(!(a<0))return null;r=-1,a=-a}Gi.subVectors(this.origin,e);const s=r*this.direction.dot(Bi.crossVectors(Gi,Bi));if(s<0)return null;const g=r*this.direction.dot(vi.cross(Gi));if(g<0)return null;if(s+g>a)return null;const l=-r*Gi.dot(Zi);return l<0?null:this.at(l/a,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Wi{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,o,r,a,s,g,l,c,I,C,u,d,h){const A=this.elements;return A[0]=e,A[4]=t,A[8]=n,A[12]=i,A[1]=o,A[5]=r,A[9]=a,A[13]=s,A[2]=g,A[6]=l,A[10]=c,A[14]=I,A[3]=C,A[7]=u,A[11]=d,A[15]=h,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Wi).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/Si.setFromMatrixColumn(e,0).length(),o=1/Si.setFromMatrixColumn(e,1).length(),r=1/Si.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*o,t[5]=n[5]*o,t[6]=n[6]*o,t[7]=0,t[8]=n[8]*r,t[9]=n[9]*r,t[10]=n[10]*r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,n=e.x,i=e.y,o=e.z,r=Math.cos(n),a=Math.sin(n),s=Math.cos(i),g=Math.sin(i),l=Math.cos(o),c=Math.sin(o);if("XYZ"===e.order){const e=r*l,n=r*c,i=a*l,o=a*c;t[0]=s*l,t[4]=-s*c,t[8]=g,t[1]=n+i*g,t[5]=e-o*g,t[9]=-a*s,t[2]=o-e*g,t[6]=i+n*g,t[10]=r*s}else if("YXZ"===e.order){const e=s*l,n=s*c,i=g*l,o=g*c;t[0]=e+o*a,t[4]=i*a-n,t[8]=r*g,t[1]=r*c,t[5]=r*l,t[9]=-a,t[2]=n*a-i,t[6]=o+e*a,t[10]=r*s}else if("ZXY"===e.order){const e=s*l,n=s*c,i=g*l,o=g*c;t[0]=e-o*a,t[4]=-r*c,t[8]=i+n*a,t[1]=n+i*a,t[5]=r*l,t[9]=o-e*a,t[2]=-r*g,t[6]=a,t[10]=r*s}else if("ZYX"===e.order){const e=r*l,n=r*c,i=a*l,o=a*c;t[0]=s*l,t[4]=i*g-n,t[8]=e*g+o,t[1]=s*c,t[5]=o*g+e,t[9]=n*g-i,t[2]=-g,t[6]=a*s,t[10]=r*s}else if("YZX"===e.order){const e=r*s,n=r*g,i=a*s,o=a*g;t[0]=s*l,t[4]=o-e*c,t[8]=i*c+n,t[1]=c,t[5]=r*l,t[9]=-a*l,t[2]=-g*l,t[6]=n*c+i,t[10]=e-o*c}else if("XZY"===e.order){const e=r*s,n=r*g,i=a*s,o=a*g;t[0]=s*l,t[4]=-c,t[8]=g*l,t[1]=e*c+o,t[5]=r*l,t[9]=n*c-i,t[2]=i*c-n,t[6]=a*l,t[10]=o*c+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(xi,e,Vi)}lookAt(e,t,n){const i=this.elements;return Yi.subVectors(e,t),0===Yi.lengthSq()&&(Yi.z=1),Yi.normalize(),Xi.crossVectors(n,Yi),0===Xi.lengthSq()&&(1===Math.abs(n.z)?Yi.x+=1e-4:Yi.z+=1e-4,Yi.normalize(),Xi.crossVectors(n,Yi)),Xi.normalize(),Hi.crossVectors(Yi,Xi),i[0]=Xi.x,i[4]=Hi.x,i[8]=Yi.x,i[1]=Xi.y,i[5]=Hi.y,i[9]=Yi.y,i[2]=Xi.z,i[6]=Hi.z,i[10]=Yi.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,o=this.elements,r=n[0],a=n[4],s=n[8],g=n[12],l=n[1],c=n[5],I=n[9],C=n[13],u=n[2],d=n[6],h=n[10],A=n[14],p=n[3],m=n[7],b=n[11],f=n[15],y=i[0],G=i[4],v=i[8],B=i[12],Z=i[1],w=i[5],W=i[9],S=i[13],R=i[2],x=i[6],V=i[10],X=i[14],H=i[3],Y=i[7],K=i[11],N=i[15];return o[0]=r*y+a*Z+s*R+g*H,o[4]=r*G+a*w+s*x+g*Y,o[8]=r*v+a*W+s*V+g*K,o[12]=r*B+a*S+s*X+g*N,o[1]=l*y+c*Z+I*R+C*H,o[5]=l*G+c*w+I*x+C*Y,o[9]=l*v+c*W+I*V+C*K,o[13]=l*B+c*S+I*X+C*N,o[2]=u*y+d*Z+h*R+A*H,o[6]=u*G+d*w+h*x+A*Y,o[10]=u*v+d*W+h*V+A*K,o[14]=u*B+d*S+h*X+A*N,o[3]=p*y+m*Z+b*R+f*H,o[7]=p*G+m*w+b*x+f*Y,o[11]=p*v+m*W+b*V+f*K,o[15]=p*B+m*S+b*X+f*N,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],o=e[12],r=e[1],a=e[5],s=e[9],g=e[13],l=e[2],c=e[6],I=e[10],C=e[14];return e[3]*(+o*s*c-i*g*c-o*a*I+n*g*I+i*a*C-n*s*C)+e[7]*(+t*s*C-t*g*I+o*r*I-i*r*C+i*g*l-o*s*l)+e[11]*(+t*g*c-t*a*C-o*r*c+n*r*C+o*a*l-n*g*l)+e[15]*(-i*a*l-t*s*c+t*a*I+i*r*c-n*r*I+n*s*l)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],o=e[3],r=e[4],a=e[5],s=e[6],g=e[7],l=e[8],c=e[9],I=e[10],C=e[11],u=e[12],d=e[13],h=e[14],A=e[15],p=c*h*g-d*I*g+d*s*C-a*h*C-c*s*A+a*I*A,m=u*I*g-l*h*g-u*s*C+r*h*C+l*s*A-r*I*A,b=l*d*g-u*c*g+u*a*C-r*d*C-l*a*A+r*c*A,f=u*c*s-l*d*s-u*a*I+r*d*I+l*a*h-r*c*h,y=t*p+n*m+i*b+o*f;if(0===y)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const G=1/y;return e[0]=p*G,e[1]=(d*I*o-c*h*o-d*i*C+n*h*C+c*i*A-n*I*A)*G,e[2]=(a*h*o-d*s*o+d*i*g-n*h*g-a*i*A+n*s*A)*G,e[3]=(c*s*o-a*I*o-c*i*g+n*I*g+a*i*C-n*s*C)*G,e[4]=m*G,e[5]=(l*h*o-u*I*o+u*i*C-t*h*C-l*i*A+t*I*A)*G,e[6]=(u*s*o-r*h*o-u*i*g+t*h*g+r*i*A-t*s*A)*G,e[7]=(r*I*o-l*s*o+l*i*g-t*I*g-r*i*C+t*s*C)*G,e[8]=b*G,e[9]=(u*c*o-l*d*o-u*n*C+t*d*C+l*n*A-t*c*A)*G,e[10]=(r*d*o-u*a*o+u*n*g-t*d*g-r*n*A+t*a*A)*G,e[11]=(l*a*o-r*c*o-l*n*g+t*c*g+r*n*C-t*a*C)*G,e[12]=f*G,e[13]=(l*d*i-u*c*i+u*n*I-t*d*I-l*n*h+t*c*h)*G,e[14]=(u*a*i-r*d*i-u*n*s+t*d*s+r*n*h-t*a*h)*G,e[15]=(r*c*i-l*a*i+l*n*s-t*c*s-r*n*I+t*a*I)*G,this}scale(e){const t=this.elements,n=e.x,i=e.y,o=e.z;return t[0]*=n,t[4]*=i,t[8]*=o,t[1]*=n,t[5]*=i,t[9]*=o,t[2]*=n,t[6]*=i,t[10]*=o,t[3]*=n,t[7]*=i,t[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),o=1-n,r=e.x,a=e.y,s=e.z,g=o*r,l=o*a;return this.set(g*r+n,g*a-i*s,g*s+i*a,0,g*a+i*s,l*a+n,l*s-i*r,0,g*s-i*a,l*s+i*r,o*s*s+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,o,r){return this.set(1,n,o,0,e,1,r,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,o=t._x,r=t._y,a=t._z,s=t._w,g=o+o,l=r+r,c=a+a,I=o*g,C=o*l,u=o*c,d=r*l,h=r*c,A=a*c,p=s*g,m=s*l,b=s*c,f=n.x,y=n.y,G=n.z;return i[0]=(1-(d+A))*f,i[1]=(C+b)*f,i[2]=(u-m)*f,i[3]=0,i[4]=(C-b)*y,i[5]=(1-(I+A))*y,i[6]=(h+p)*y,i[7]=0,i[8]=(u+m)*G,i[9]=(h-p)*G,i[10]=(1-(I+d))*G,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let o=Si.set(i[0],i[1],i[2]).length();const r=Si.set(i[4],i[5],i[6]).length(),a=Si.set(i[8],i[9],i[10]).length();this.determinant()<0&&(o=-o),e.x=i[12],e.y=i[13],e.z=i[14],Ri.copy(this);const s=1/o,g=1/r,l=1/a;return Ri.elements[0]*=s,Ri.elements[1]*=s,Ri.elements[2]*=s,Ri.elements[4]*=g,Ri.elements[5]*=g,Ri.elements[6]*=g,Ri.elements[8]*=l,Ri.elements[9]*=l,Ri.elements[10]*=l,t.setFromRotationMatrix(Ri),n.x=o,n.y=r,n.z=a,this}makePerspective(e,t,n,i,o,r){void 0===r&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements,s=2*o/(t-e),g=2*o/(n-i),l=(t+e)/(t-e),c=(n+i)/(n-i),I=-(r+o)/(r-o),C=-2*r*o/(r-o);return a[0]=s,a[4]=0,a[8]=l,a[12]=0,a[1]=0,a[5]=g,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=I,a[14]=C,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,i,o,r){const a=this.elements,s=1/(t-e),g=1/(n-i),l=1/(r-o),c=(t+e)*s,I=(n+i)*g,C=(r+o)*l;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*g,a[9]=0,a[13]=-I,a[2]=0,a[6]=0,a[10]=-2*l,a[14]=-C,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}Wi.prototype.isMatrix4=!0;const Si=new jn,Ri=new Wi,xi=new jn(0,0,0),Vi=new jn(1,1,1),Xi=new jn,Hi=new jn,Yi=new jn,Ki=new Wi,Ni=new _n;class Mi{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Mi.DefaultOrder;this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=e.elements,o=i[0],r=i[4],a=i[8],s=i[1],g=i[5],l=i[9],c=i[2],I=i[6],C=i[10];switch(t){case"XYZ":this._y=Math.asin(fn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,C),this._z=Math.atan2(-r,o)):(this._x=Math.atan2(I,g),this._z=0);break;case"YXZ":this._x=Math.asin(-fn(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(a,C),this._z=Math.atan2(s,g)):(this._y=Math.atan2(-c,o),this._z=0);break;case"ZXY":this._x=Math.asin(fn(I,-1,1)),Math.abs(I)<.9999999?(this._y=Math.atan2(-c,C),this._z=Math.atan2(-r,g)):(this._y=0,this._z=Math.atan2(s,o));break;case"ZYX":this._y=Math.asin(-fn(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(I,C),this._z=Math.atan2(s,o)):(this._x=0,this._z=Math.atan2(-r,g));break;case"YZX":this._z=Math.asin(fn(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-l,g),this._y=Math.atan2(-c,o)):(this._x=0,this._y=Math.atan2(a,C));break;case"XZY":this._z=Math.asin(-fn(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(I,g),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-l,C),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Ki.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Ki,t,n)}setFromVector3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}reorder(e){return Ni.setFromEuler(this),this.setFromQuaternion(Ni,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new jn(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Mi.prototype.isEuler=!0,Mi.DefaultOrder="XYZ",Mi.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Fi{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return 0!==(this.mask&1<<e)}}let ki=0;const zi=new jn,Li=new _n,Ti=new Wi,Ei=new jn,Ji=new jn,Ui=new jn,Di=new _n,Pi=new jn(1,0,0),Qi=new jn(0,1,0),_i=new jn(0,0,1),ji={type:"added"},Oi={type:"removed"};class qi extends dn{constructor(){super(),Object.defineProperty(this,"id",{value:ki++}),this.uuid=bn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=qi.DefaultUp.clone();const e=new jn,t=new Mi,n=new _n,i=new jn(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Wi},normalMatrix:{value:new Sn}}),this.matrix=new Wi,this.matrixWorld=new Wi,this.matrixAutoUpdate=qi.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Fi,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Li.setFromAxisAngle(e,t),this.quaternion.multiply(Li),this}rotateOnWorldAxis(e,t){return Li.setFromAxisAngle(e,t),this.quaternion.premultiply(Li),this}rotateX(e){return this.rotateOnAxis(Pi,e)}rotateY(e){return this.rotateOnAxis(Qi,e)}rotateZ(e){return this.rotateOnAxis(_i,e)}translateOnAxis(e,t){return zi.copy(e).applyQuaternion(this.quaternion),this.position.add(zi.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Pi,e)}translateY(e){return this.translateOnAxis(Qi,e)}translateZ(e){return this.translateOnAxis(_i,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Ti.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Ei.copy(e):Ei.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),Ji.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ti.lookAt(Ji,Ei,this.up):Ti.lookAt(Ei,Ji,this.up),this.quaternion.setFromRotationMatrix(Ti),i&&(Ti.extractRotation(i.matrixWorld),Li.setFromRotationMatrix(Ti),this.quaternion.premultiply(Li.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(ji)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Oi)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(Oi)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Ti.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Ti.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ti),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ji,e,Ui),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ji,Di,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function o(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=o(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];o(e.shapes,i)}else o(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(o(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(o(e.materials,this.material[n]));i.material=t}else i.material=o(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(o(e.animations,n))}}if(t){const t=r(e.geometries),i=r(e.materials),o=r(e.textures),a=r(e.images),s=r(e.shapes),g=r(e.skeletons),l=r(e.animations);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),o.length>0&&(n.textures=o),a.length>0&&(n.images=a),s.length>0&&(n.shapes=s),g.length>0&&(n.skeletons=g),l.length>0&&(n.animations=l)}return n.object=i,n;function r(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let n=0;n<e.children.length;n++){const t=e.children[n];this.add(t.clone())}return this}}qi.DefaultUp=new jn(0,1,0),qi.DefaultMatrixAutoUpdate=!0,qi.prototype.isObject3D=!0;const $i=new jn,eo=new jn,to=new jn,no=new jn,io=new jn,oo=new jn,ro=new jn,ao=new jn,so=new jn,go=new jn;class lo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new jn,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new jn,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new jn;this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),$i.subVectors(e,t),i.cross($i);const o=i.lengthSq();return o>0?i.multiplyScalar(1/Math.sqrt(o)):i.set(0,0,0)}static getBarycoord(e,t,n,i,o){$i.subVectors(i,t),eo.subVectors(n,t),to.subVectors(e,t);const r=$i.dot($i),a=$i.dot(eo),s=$i.dot(to),g=eo.dot(eo),l=eo.dot(to),c=r*g-a*a;if(0===c)return o.set(-2,-1,-1);const I=1/c,C=(g*s-a*l)*I,u=(r*l-a*s)*I;return o.set(1-C-u,u,C)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,no),no.x>=0&&no.y>=0&&no.x+no.y<=1}static getUV(e,t,n,i,o,r,a,s){return this.getBarycoord(e,t,n,i,no),s.set(0,0),s.addScaledVector(o,no.x),s.addScaledVector(r,no.y),s.addScaledVector(a,no.z),s}static isFrontFacing(e,t,n,i){return $i.subVectors(n,t),eo.subVectors(e,t),$i.cross(eo).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return $i.subVectors(this.c,this.b),eo.subVectors(this.a,this.b),.5*$i.cross(eo).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return lo.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return lo.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,o){return lo.getUV(e,this.a,this.b,this.c,t,n,i,o)}containsPoint(e){return lo.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return lo.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,o=this.c;let r,a;io.subVectors(i,n),oo.subVectors(o,n),ao.subVectors(e,n);const s=io.dot(ao),g=oo.dot(ao);if(s<=0&&g<=0)return t.copy(n);so.subVectors(e,i);const l=io.dot(so),c=oo.dot(so);if(l>=0&&c<=l)return t.copy(i);const I=s*c-l*g;if(I<=0&&s>=0&&l<=0)return r=s/(s-l),t.copy(n).addScaledVector(io,r);go.subVectors(e,o);const C=io.dot(go),u=oo.dot(go);if(u>=0&&C<=u)return t.copy(o);const d=C*g-s*u;if(d<=0&&g>=0&&u<=0)return a=g/(g-u),t.copy(n).addScaledVector(oo,a);const h=l*u-C*c;if(h<=0&&c-l>=0&&C-u>=0)return ro.subVectors(o,i),a=(c-l)/(c-l+(C-u)),t.copy(i).addScaledVector(ro,a);const A=1/(h+d+I);return r=d*A,a=I*A,t.copy(n).addScaledVector(io,r).addScaledVector(oo,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let co=0;class Io extends dn{constructor(){super(),Object.defineProperty(this,"id",{value:co++}),this.uuid=bn(),this.name="",this.type="Material",this.fog=!0,this.blending=f,this.side=d,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Y,this.blendDst=K,this.blendEquation=Z,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=J,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=en,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=zt,this.stencilZFail=zt,this.stencilZPass=zt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!==e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===p;continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==f&&(n.blending=this.blending),this.side!==d&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){const t=i(e.textures),o=i(e.images);t.length>0&&(n.textures=t),o.length>0&&(n.images=o)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}Io.prototype.isMaterial=!0;class Co extends Io{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new kn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=_,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Co.prototype.isMeshBasicMaterial=!0;const uo=new jn,ho=new Wn;class Ao{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=tn,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,o=this.itemSize;i<o;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let n=0;for(let i=0,o=e.length;i<o;i++){let o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),o=new kn),t[n++]=o.r,t[n++]=o.g,t[n++]=o.b}return this}copyVector2sArray(e){const t=this.array;let n=0;for(let i=0,o=e.length;i<o;i++){let o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),o=new Wn),t[n++]=o.x,t[n++]=o.y}return this}copyVector3sArray(e){const t=this.array;let n=0;for(let i=0,o=e.length;i<o;i++){let o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),o=new jn),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z}return this}copyVector4sArray(e){const t=this.array;let n=0;for(let i=0,o=e.length;i<o;i++){let o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),o=new Un),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z,t[n++]=o.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)ho.fromBufferAttribute(this,t),ho.applyMatrix3(e),this.setXY(t,ho.x,ho.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)uo.fromBufferAttribute(this,t),uo.applyMatrix3(e),this.setXYZ(t,uo.x,uo.y,uo.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)uo.x=this.getX(t),uo.y=this.getY(t),uo.z=this.getZ(t),uo.applyMatrix4(e),this.setXYZ(t,uo.x,uo.y,uo.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)uo.x=this.getX(t),uo.y=this.getY(t),uo.z=this.getZ(t),uo.applyNormalMatrix(e),this.setXYZ(t,uo.x,uo.y,uo.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)uo.x=this.getX(t),uo.y=this.getY(t),uo.z=this.getZ(t),uo.transformDirection(e),this.setXYZ(t,uo.x,uo.y,uo.z);return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,o){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==tn&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}Ao.prototype.isBufferAttribute=!0;class po extends Ao{constructor(e,t,n){super(new Int8Array(e),t,n)}}class mo extends Ao{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class bo extends Ao{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class fo extends Ao{constructor(e,t,n){super(new Int16Array(e),t,n)}}class yo extends Ao{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Go extends Ao{constructor(e,t,n){super(new Int32Array(e),t,n)}}class vo extends Ao{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Bo extends Ao{constructor(e,t,n){super(new Uint16Array(e),t,n)}}Bo.prototype.isFloat16BufferAttribute=!0;class Zo extends Ao{constructor(e,t,n){super(new Float32Array(e),t,n)}}class wo extends Ao{constructor(e,t,n){super(new Float64Array(e),t,n)}}let Wo=0;const So=new Wi,Ro=new qi,xo=new jn,Vo=new $n,Xo=new $n,Ho=new jn;class Yo extends dn{constructor(){super(),Object.defineProperty(this,"id",{value:Wo++}),this.uuid=bn(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Rn(e)?vo:yo)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new Sn).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return So.makeRotationFromQuaternion(e),this.applyMatrix4(So),this}rotateX(e){return So.makeRotationX(e),this.applyMatrix4(So),this}rotateY(e){return So.makeRotationY(e),this.applyMatrix4(So),this}rotateZ(e){return So.makeRotationZ(e),this.applyMatrix4(So),this}translate(e,t,n){return So.makeTranslation(e,t,n),this.applyMatrix4(So),this}scale(e,t,n){return So.makeScale(e,t,n),this.applyMatrix4(So),this}lookAt(e){return Ro.lookAt(e),Ro.updateMatrix(),this.applyMatrix4(Ro.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(xo).negate(),this.translate(xo.x,xo.y,xo.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Zo(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new $n);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new jn(-1/0,-1/0,-1/0),new jn(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const e=t[n];Vo.setFromBufferAttribute(e),this.morphTargetsRelative?(Ho.addVectors(this.boundingBox.min,Vo.min),this.boundingBox.expandByPoint(Ho),Ho.addVectors(this.boundingBox.max,Vo.max),this.boundingBox.expandByPoint(Ho)):(this.boundingBox.expandByPoint(Vo.min),this.boundingBox.expandByPoint(Vo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new mi);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new jn,1/0);if(e){const n=this.boundingSphere.center;if(Vo.setFromBufferAttribute(e),t)for(let e=0,o=t.length;e<o;e++){const n=t[e];Xo.setFromBufferAttribute(n),this.morphTargetsRelative?(Ho.addVectors(Vo.min,Xo.min),Vo.expandByPoint(Ho),Ho.addVectors(Vo.max,Xo.max),Vo.expandByPoint(Ho)):(Vo.expandByPoint(Xo.min),Vo.expandByPoint(Xo.max))}Vo.getCenter(n);let i=0;for(let t=0,o=e.count;t<o;t++)Ho.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(Ho));if(t)for(let o=0,r=t.length;o<r;o++){const r=t[o],a=this.morphTargetsRelative;for(let t=0,o=r.count;t<o;t++)Ho.fromBufferAttribute(r,t),a&&(xo.fromBufferAttribute(e,t),Ho.add(xo)),i=Math.max(i,n.distanceToSquared(Ho))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,i=t.position.array,o=t.normal.array,r=t.uv.array,a=i.length/3;void 0===t.tangent&&this.setAttribute("tangent",new Ao(new Float32Array(4*a),4));const s=t.tangent.array,g=[],l=[];for(let Z=0;Z<a;Z++)g[Z]=new jn,l[Z]=new jn;const c=new jn,I=new jn,C=new jn,u=new Wn,d=new Wn,h=new Wn,A=new jn,p=new jn;function m(e,t,n){c.fromArray(i,3*e),I.fromArray(i,3*t),C.fromArray(i,3*n),u.fromArray(r,2*e),d.fromArray(r,2*t),h.fromArray(r,2*n),I.sub(c),C.sub(c),d.sub(u),h.sub(u);const o=1/(d.x*h.y-h.x*d.y);isFinite(o)&&(A.copy(I).multiplyScalar(h.y).addScaledVector(C,-d.y).multiplyScalar(o),p.copy(C).multiplyScalar(d.x).addScaledVector(I,-h.x).multiplyScalar(o),g[e].add(A),g[t].add(A),g[n].add(A),l[e].add(p),l[t].add(p),l[n].add(p))}let b=this.groups;0===b.length&&(b=[{start:0,count:n.length}]);for(let Z=0,w=b.length;Z<w;++Z){const e=b[Z],t=e.start;for(let i=t,o=t+e.count;i<o;i+=3)m(n[i+0],n[i+1],n[i+2])}const f=new jn,y=new jn,G=new jn,v=new jn;function B(e){G.fromArray(o,3*e),v.copy(G);const t=g[e];f.copy(t),f.sub(G.multiplyScalar(G.dot(t))).normalize(),y.crossVectors(v,t);const n=y.dot(l[e])<0?-1:1;s[4*e]=f.x,s[4*e+1]=f.y,s[4*e+2]=f.z,s[4*e+3]=n}for(let Z=0,w=b.length;Z<w;++Z){const e=b[Z],t=e.start;for(let i=t,o=t+e.count;i<o;i+=3)B(n[i+0]),B(n[i+1]),B(n[i+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new Ao(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new jn,o=new jn,r=new jn,a=new jn,s=new jn,g=new jn,l=new jn,c=new jn;if(e)for(let I=0,C=e.count;I<C;I+=3){const C=e.getX(I+0),u=e.getX(I+1),d=e.getX(I+2);i.fromBufferAttribute(t,C),o.fromBufferAttribute(t,u),r.fromBufferAttribute(t,d),l.subVectors(r,o),c.subVectors(i,o),l.cross(c),a.fromBufferAttribute(n,C),s.fromBufferAttribute(n,u),g.fromBufferAttribute(n,d),a.add(l),s.add(l),g.add(l),n.setXYZ(C,a.x,a.y,a.z),n.setXYZ(u,s.x,s.y,s.z),n.setXYZ(d,g.x,g.y,g.z)}else for(let e=0,I=t.count;e<I;e+=3)i.fromBufferAttribute(t,e+0),o.fromBufferAttribute(t,e+1),r.fromBufferAttribute(t,e+2),l.subVectors(r,o),c.subVectors(i,o),l.cross(c),n.setXYZ(e+0,l.x,l.y,l.z),n.setXYZ(e+1,l.x,l.y,l.z),n.setXYZ(e+2,l.x,l.y,l.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const i in n){if(void 0===e.attributes[i])continue;const o=n[i].array,r=e.attributes[i],a=r.array,s=r.itemSize*t,g=Math.min(a.length,o.length-s);for(let e=0,t=s;e<g;e++,t++)o[t]=a[e]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Ho.fromBufferAttribute(e,t),Ho.normalize(),e.setXYZ(t,Ho.x,Ho.y,Ho.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,o=e.normalized,r=new n.constructor(t.length*i);let a=0,s=0;for(let g=0,l=t.length;g<l;g++){a=e.isInterleavedBufferAttribute?t[g]*e.data.stride+e.offset:t[g]*i;for(let e=0;e<i;e++)r[s++]=n[a++]}return new Ao(r,i,o)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Yo,n=this.index.array,i=this.attributes;for(const a in i){const o=e(i[a],n);t.setAttribute(a,o)}const o=this.morphAttributes;for(const a in o){const i=[],r=o[a];for(let t=0,o=r.length;t<o;t++){const o=e(r[t],n);i.push(o)}t.morphAttributes[a]=i}t.morphTargetsRelative=this.morphTargetsRelative;const r=this.groups;for(let a=0,s=r.length;a<s;a++){const e=r[a];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const s in n){const t=n[s];e.data.attributes[s]=t.toJSON(e.data)}const i={};let o=!1;for(const s in this.morphAttributes){const t=this.morphAttributes[s],n=[];for(let i=0,o=t.length;i<o;i++){const o=t[i];n.push(o.toJSON(e.data))}n.length>0&&(i[s]=n,o=!0)}o&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const r=this.groups;r.length>0&&(e.data.groups=JSON.parse(JSON.stringify(r)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const g in i){const e=i[g];this.setAttribute(g,e.clone(t))}const o=e.morphAttributes;for(const g in o){const e=[],n=o[g];for(let i=0,o=n.length;i<o;i++)e.push(n[i].clone(t));this.morphAttributes[g]=e}this.morphTargetsRelative=e.morphTargetsRelative;const r=e.groups;for(let g=0,l=r.length;g<l;g++){const e=r[g];this.addGroup(e.start,e.count,e.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const s=e.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}Yo.prototype.isBufferGeometry=!0;const Ko=new Wi,No=new wi,Mo=new mi,Fo=new jn,ko=new jn,zo=new jn,Lo=new jn,To=new jn,Eo=new jn,Jo=new jn,Uo=new jn,Do=new jn,Po=new Wn,Qo=new Wn,_o=new Wn,jo=new jn,Oo=new jn;class qo extends qi{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yo,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Co;super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const n=this.geometry,i=this.material,o=this.matrixWorld;if(void 0===i)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),Mo.copy(n.boundingSphere),Mo.applyMatrix4(o),!1===e.ray.intersectsSphere(Mo))return;if(Ko.copy(o).invert(),No.copy(e.ray).applyMatrix4(Ko),null!==n.boundingBox&&!1===No.intersectsBox(n.boundingBox))return;let r;if(n.isBufferGeometry){const o=n.index,a=n.attributes.position,s=n.morphAttributes.position,g=n.morphTargetsRelative,l=n.attributes.uv,c=n.attributes.uv2,I=n.groups,C=n.drawRange;if(null!==o)if(Array.isArray(i))for(let n=0,u=I.length;n<u;n++){const u=I[n],d=i[u.materialIndex];for(let n=Math.max(u.start,C.start),i=Math.min(o.count,Math.min(u.start+u.count,C.start+C.count));n<i;n+=3){const i=o.getX(n),I=o.getX(n+1),C=o.getX(n+2);r=$o(this,d,e,No,a,s,g,l,c,i,I,C),r&&(r.faceIndex=Math.floor(n/3),r.face.materialIndex=u.materialIndex,t.push(r))}}else{for(let n=Math.max(0,C.start),I=Math.min(o.count,C.start+C.count);n<I;n+=3){const I=o.getX(n),C=o.getX(n+1),u=o.getX(n+2);r=$o(this,i,e,No,a,s,g,l,c,I,C,u),r&&(r.faceIndex=Math.floor(n/3),t.push(r))}}else if(void 0!==a)if(Array.isArray(i))for(let n=0,u=I.length;n<u;n++){const o=I[n],u=i[o.materialIndex];for(let n=Math.max(o.start,C.start),i=Math.min(a.count,Math.min(o.start+o.count,C.start+C.count));n<i;n+=3){r=$o(this,u,e,No,a,s,g,l,c,n,n+1,n+2),r&&(r.faceIndex=Math.floor(n/3),r.face.materialIndex=o.materialIndex,t.push(r))}}else{for(let n=Math.max(0,C.start),o=Math.min(a.count,C.start+C.count);n<o;n+=3){r=$o(this,i,e,No,a,s,g,l,c,n,n+1,n+2),r&&(r.faceIndex=Math.floor(n/3),t.push(r))}}}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function $o(e,t,n,i,o,r,a,s,g,l,c,I){Fo.fromBufferAttribute(o,l),ko.fromBufferAttribute(o,c),zo.fromBufferAttribute(o,I);const C=e.morphTargetInfluences;if(r&&C){Jo.set(0,0,0),Uo.set(0,0,0),Do.set(0,0,0);for(let e=0,t=r.length;e<t;e++){const t=C[e],n=r[e];0!==t&&(Lo.fromBufferAttribute(n,l),To.fromBufferAttribute(n,c),Eo.fromBufferAttribute(n,I),a?(Jo.addScaledVector(Lo,t),Uo.addScaledVector(To,t),Do.addScaledVector(Eo,t)):(Jo.addScaledVector(Lo.sub(Fo),t),Uo.addScaledVector(To.sub(ko),t),Do.addScaledVector(Eo.sub(zo),t)))}Fo.add(Jo),ko.add(Uo),zo.add(Do)}e.isSkinnedMesh&&(e.boneTransform(l,Fo),e.boneTransform(c,ko),e.boneTransform(I,zo));const u=function(e,t,n,i,o,r,a,s){let g;if(g=t.side===h?i.intersectTriangle(a,r,o,!0,s):i.intersectTriangle(o,r,a,t.side!==A,s),null===g)return null;Oo.copy(s),Oo.applyMatrix4(e.matrixWorld);const l=n.ray.origin.distanceTo(Oo);return l<n.near||l>n.far?null:{distance:l,point:Oo.clone(),object:e}}(e,t,n,i,Fo,ko,zo,jo);if(u){s&&(Po.fromBufferAttribute(s,l),Qo.fromBufferAttribute(s,c),_o.fromBufferAttribute(s,I),u.uv=lo.getUV(jo,Fo,ko,zo,Po,Qo,_o,new Wn)),g&&(Po.fromBufferAttribute(g,l),Qo.fromBufferAttribute(g,c),_o.fromBufferAttribute(g,I),u.uv2=lo.getUV(jo,Fo,ko,zo,Po,Qo,_o,new Wn));const e={a:l,b:c,c:I,normal:new jn,materialIndex:0};lo.getNormal(Fo,ko,zo,e.normal),u.face=e}return u}qo.prototype.isMesh=!0;class er extends Yo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:o,depthSegments:r};const a=this;i=Math.floor(i),o=Math.floor(o),r=Math.floor(r);const s=[],g=[],l=[],c=[];let I=0,C=0;function u(e,t,n,i,o,r,u,d,h,A,p){const m=r/h,b=u/A,f=r/2,y=u/2,G=d/2,v=h+1,B=A+1;let Z=0,w=0;const W=new jn;for(let a=0;a<B;a++){const r=a*b-y;for(let s=0;s<v;s++){const I=s*m-f;W[e]=I*i,W[t]=r*o,W[n]=G,g.push(W.x,W.y,W.z),W[e]=0,W[t]=0,W[n]=d>0?1:-1,l.push(W.x,W.y,W.z),c.push(s/h),c.push(1-a/A),Z+=1}}for(let a=0;a<A;a++)for(let e=0;e<h;e++){const t=I+e+v*a,n=I+e+v*(a+1),i=I+(e+1)+v*(a+1),o=I+(e+1)+v*a;s.push(t,n,o),s.push(n,i,o),w+=6}a.addGroup(C,w,p),C+=w,I+=Z}u("z","y","x",-1,-1,n,t,e,r,o,0),u("z","y","x",1,-1,n,t,-e,r,o,1),u("x","z","y",1,1,e,n,t,i,r,2),u("x","z","y",1,-1,e,n,-t,i,r,3),u("x","y","z",1,-1,e,t,n,i,o,4),u("x","y","z",-1,-1,e,t,-n,i,o,5),this.setIndex(s),this.setAttribute("position",new Zo(g,3)),this.setAttribute("normal",new Zo(l,3)),this.setAttribute("uv",new Zo(c,2))}static fromJSON(e){return new er(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function tr(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const o=e[n][i];o&&(o.isColor||o.isMatrix3||o.isMatrix4||o.isVector2||o.isVector3||o.isVector4||o.isTexture||o.isQuaternion)?t[n][i]=o.clone():Array.isArray(o)?t[n][i]=o.slice():t[n][i]=o}}return t}function nr(e){const t={};for(let n=0;n<e.length;n++){const i=tr(e[n]);for(const e in i)t[e]=i[e]}return t}const ir={clone:tr,merge:nr};class or extends Io{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=tr(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const i in this.extensions)!0===this.extensions[i]&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}or.prototype.isShaderMaterial=!0;class rr extends qi{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Wi,this.projectionMatrix=new Wi,this.projectionMatrixInverse=new Wi}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}rr.prototype.isCamera=!0;class ar extends rr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*mn*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*pn*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*mn*Math.atan(Math.tan(.5*pn*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,o,r){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=o,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*pn*this.fov)/this.zoom,n=2*t,i=this.aspect*n,o=-.5*i;const r=this.view;if(null!==this.view&&this.view.enabled){const e=r.fullWidth,a=r.fullHeight;o+=r.offsetX*i/e,t-=r.offsetY*n/a,i*=r.width/e,n*=r.height/a}const a=this.filmOffset;0!==a&&(o+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+i,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}ar.prototype.isPerspectiveCamera=!0;const sr=90;class gr extends qi{constructor(e,t,n){if(super(),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const i=new ar(sr,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new jn(1,0,0)),this.add(i);const o=new ar(sr,1,e,t);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new jn(-1,0,0)),this.add(o);const r=new ar(sr,1,e,t);r.layers=this.layers,r.up.set(0,0,1),r.lookAt(new jn(0,1,0)),this.add(r);const a=new ar(sr,1,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new jn(0,-1,0)),this.add(a);const s=new ar(sr,1,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new jn(0,0,1)),this.add(s);const g=new ar(sr,1,e,t);g.layers=this.layers,g.up.set(0,-1,0),g.lookAt(new jn(0,0,-1)),this.add(g)}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[i,o,r,a,s,g]=this.children,l=e.xr.enabled,c=e.getRenderTarget();e.xr.enabled=!1;const I=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,o),e.setRenderTarget(n,2),e.render(t,r),e.setRenderTarget(n,3),e.render(t,a),e.setRenderTarget(n,4),e.render(t,s),n.texture.generateMipmaps=I,e.setRenderTarget(n,5),e.render(t,g),e.setRenderTarget(c),e.xr.enabled=l,n.texture.needsPMREMUpdate=!0}}class lr extends En{constructor(e,t,n,i,o,r,a,s,g,l){super(e=void 0!==e?e:[],t=void 0!==t?t:re,n,i,o,r,a,s,g,l),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}lr.prototype.isCubeTexture=!0;class cr extends Dn{constructor(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n),super(e,e,t),t=t||{},this.texture=new lr(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:be}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=Me,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},i=new er(5,5,5),o=new or({name:"CubemapFromEquirect",uniforms:tr(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:h,blending:b});o.uniforms.tEquirect.value=t;const r=new qo(i,o),a=t.minFilter;t.minFilter===Ge&&(t.minFilter=be);return new gr(1,10,this).update(e,r),t.minFilter=a,r.geometry.dispose(),r.material.dispose(),this}clear(e,t,n,i){const o=e.getRenderTarget();for(let r=0;r<6;r++)e.setRenderTarget(this,r),e.clear(t,n,i);e.setRenderTarget(o)}}cr.prototype.isWebGLCubeRenderTarget=!0;const Ir=new jn,Cr=new jn,ur=new Sn;class dr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new jn(1,0,0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=Ir.subVectors(n,t).cross(Cr.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const n=e.delta(Ir),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/i;return o<0||o>1?null:t.copy(n).multiplyScalar(o).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||ur.getNormalMatrix(e),i=this.coplanarPoint(Ir).applyMatrix4(e),o=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}dr.prototype.isPlane=!0;const hr=new mi,Ar=new jn;class pr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new dr,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new dr,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new dr,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new dr,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new dr,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new dr;this.planes=[e,t,n,i,o,r]}set(e,t,n,i,o,r){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(i),a[4].copy(o),a[5].copy(r),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,i=n[0],o=n[1],r=n[2],a=n[3],s=n[4],g=n[5],l=n[6],c=n[7],I=n[8],C=n[9],u=n[10],d=n[11],h=n[12],A=n[13],p=n[14],m=n[15];return t[0].setComponents(a-i,c-s,d-I,m-h).normalize(),t[1].setComponents(a+i,c+s,d+I,m+h).normalize(),t[2].setComponents(a+o,c+g,d+C,m+A).normalize(),t[3].setComponents(a-o,c-g,d-C,m-A).normalize(),t[4].setComponents(a-r,c-l,d-u,m-p).normalize(),t[5].setComponents(a+r,c+l,d+u,m+p).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),hr.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(hr)}intersectsSprite(e){return hr.center.set(0,0,0),hr.radius=.7071067811865476,hr.applyMatrix4(e.matrixWorld),this.intersectsSphere(hr)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let o=0;o<6;o++){if(t[o].distanceToPoint(n)<i)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(Ar.x=i.normal.x>0?e.max.x:e.min.x,Ar.y=i.normal.y>0?e.max.y:e.min.y,Ar.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Ar)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function mr(){let e=null,t=!1,n=null,i=null;function o(t,r){n(t,r),i=e.requestAnimationFrame(o)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(o),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function br(e,t){const n=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=i.get(t);n&&(e.deleteBuffer(n.buffer),i.delete(t))},update:function(t,o){if(t.isGLBufferAttribute){const e=i.get(t);return void((!e||e.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const r=i.get(t);void 0===r?i.set(t,function(t,i){const o=t.array,r=t.usage,a=e.createBuffer();e.bindBuffer(i,a),e.bufferData(i,o,r),t.onUploadCallback();let s=5126;return o instanceof Float32Array?s=5126:o instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):o instanceof Uint16Array?t.isFloat16BufferAttribute?n?s=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):s=5123:o instanceof Int16Array?s=5122:o instanceof Uint32Array?s=5125:o instanceof Int32Array?s=5124:o instanceof Int8Array?s=5120:(o instanceof Uint8Array||o instanceof Uint8ClampedArray)&&(s=5121),{buffer:a,type:s,bytesPerElement:o.BYTES_PER_ELEMENT,version:t.version}}(t,o)):r.version<t.version&&(!function(t,i,o){const r=i.array,a=i.updateRange;e.bindBuffer(o,t),-1===a.count?e.bufferSubData(o,0,r):(n?e.bufferSubData(o,a.offset*r.BYTES_PER_ELEMENT,r,a.offset,a.count):e.bufferSubData(o,a.offset*r.BYTES_PER_ELEMENT,r.subarray(a.offset,a.offset+a.count)),a.count=-1)}(r.buffer,t,o),r.version=t.version)}}}class fr extends Yo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const o=e/2,r=t/2,a=Math.floor(n),s=Math.floor(i),g=a+1,l=s+1,c=e/a,I=t/s,C=[],u=[],d=[],h=[];for(let A=0;A<l;A++){const e=A*I-r;for(let t=0;t<g;t++){const n=t*c-o;u.push(n,-e,0),d.push(0,0,1),h.push(t/a),h.push(1-A/s)}}for(let A=0;A<s;A++)for(let e=0;e<a;e++){const t=e+g*A,n=e+g*(A+1),i=e+1+g*(A+1),o=e+1+g*A;C.push(t,n,o),C.push(n,i,o)}this.setIndex(C),this.setAttribute("position",new Zo(u,3)),this.setAttribute("normal",new Zo(d,3)),this.setAttribute("uv",new Zo(h,2))}static fromJSON(e){return new fr(e.width,e.height,e.widthSegments,e.heightSegments)}}const yr={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\treturn texture2D( envMap, uv ).rgb;\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {\n\t\t\tfloat texelIndex = float( vertexIndex * stride + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV ).xyz;\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\t#ifndef USE_MORPHNORMALS\n\t\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];\n\t\t\t#else\n\t\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];\n\t\t\t#endif\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Gr={common:{diffuse:{value:new kn(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Sn},uv2Transform:{value:new Sn},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Wn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new kn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new kn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Sn}},sprite:{diffuse:{value:new kn(16777215)},opacity:{value:1},center:{value:new Wn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Sn}}},vr={basic:{uniforms:nr([Gr.common,Gr.specularmap,Gr.envmap,Gr.aomap,Gr.lightmap,Gr.fog]),vertexShader:yr.meshbasic_vert,fragmentShader:yr.meshbasic_frag},lambert:{uniforms:nr([Gr.common,Gr.specularmap,Gr.envmap,Gr.aomap,Gr.lightmap,Gr.emissivemap,Gr.fog,Gr.lights,{emissive:{value:new kn(0)}}]),vertexShader:yr.meshlambert_vert,fragmentShader:yr.meshlambert_frag},phong:{uniforms:nr([Gr.common,Gr.specularmap,Gr.envmap,Gr.aomap,Gr.lightmap,Gr.emissivemap,Gr.bumpmap,Gr.normalmap,Gr.displacementmap,Gr.fog,Gr.lights,{emissive:{value:new kn(0)},specular:{value:new kn(1118481)},shininess:{value:30}}]),vertexShader:yr.meshphong_vert,fragmentShader:yr.meshphong_frag},standard:{uniforms:nr([Gr.common,Gr.envmap,Gr.aomap,Gr.lightmap,Gr.emissivemap,Gr.bumpmap,Gr.normalmap,Gr.displacementmap,Gr.roughnessmap,Gr.metalnessmap,Gr.fog,Gr.lights,{emissive:{value:new kn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:yr.meshphysical_vert,fragmentShader:yr.meshphysical_frag},toon:{uniforms:nr([Gr.common,Gr.aomap,Gr.lightmap,Gr.emissivemap,Gr.bumpmap,Gr.normalmap,Gr.displacementmap,Gr.gradientmap,Gr.fog,Gr.lights,{emissive:{value:new kn(0)}}]),vertexShader:yr.meshtoon_vert,fragmentShader:yr.meshtoon_frag},matcap:{uniforms:nr([Gr.common,Gr.bumpmap,Gr.normalmap,Gr.displacementmap,Gr.fog,{matcap:{value:null}}]),vertexShader:yr.meshmatcap_vert,fragmentShader:yr.meshmatcap_frag},points:{uniforms:nr([Gr.points,Gr.fog]),vertexShader:yr.points_vert,fragmentShader:yr.points_frag},dashed:{uniforms:nr([Gr.common,Gr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:yr.linedashed_vert,fragmentShader:yr.linedashed_frag},depth:{uniforms:nr([Gr.common,Gr.displacementmap]),vertexShader:yr.depth_vert,fragmentShader:yr.depth_frag},normal:{uniforms:nr([Gr.common,Gr.bumpmap,Gr.normalmap,Gr.displacementmap,{opacity:{value:1}}]),vertexShader:yr.meshnormal_vert,fragmentShader:yr.meshnormal_frag},sprite:{uniforms:nr([Gr.sprite,Gr.fog]),vertexShader:yr.sprite_vert,fragmentShader:yr.sprite_frag},background:{uniforms:{uvTransform:{value:new Sn},t2D:{value:null}},vertexShader:yr.background_vert,fragmentShader:yr.background_frag},cube:{uniforms:nr([Gr.envmap,{opacity:{value:1}}]),vertexShader:yr.cube_vert,fragmentShader:yr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:yr.equirect_vert,fragmentShader:yr.equirect_frag},distanceRGBA:{uniforms:nr([Gr.common,Gr.displacementmap,{referencePosition:{value:new jn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:yr.distanceRGBA_vert,fragmentShader:yr.distanceRGBA_frag},shadow:{uniforms:nr([Gr.lights,Gr.fog,{color:{value:new kn(0)},opacity:{value:1}}]),vertexShader:yr.shadow_vert,fragmentShader:yr.shadow_frag}};function Br(e,t,n,i,o,r){const a=new kn(0);let s,g,l=!0===o?0:1,c=null,I=0,C=null;function u(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,r)}return{getClearColor:function(){return a},setClearColor:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;a.set(e),l=t,u(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(e){l=e,u(a,l)},render:function(n,o){let r=!1,A=!0===o.isScene?o.background:null;A&&A.isTexture&&(A=t.get(A));const p=e.xr,m=p.getSession&&p.getSession();m&&"additive"===m.environmentBlendMode&&(A=null),null===A?u(a,l):A&&A.isColor&&(u(A,1),r=!0),(e.autoClear||r)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),A&&(A.isCubeTexture||A.mapping===le)?(void 0===g&&(g=new qo(new er(1,1,1),new or({name:"BackgroundCubeMaterial",uniforms:tr(vr.cube.uniforms),vertexShader:vr.cube.vertexShader,fragmentShader:vr.cube.fragmentShader,side:h,depthTest:!1,depthWrite:!1,fog:!1})),g.geometry.deleteAttribute("normal"),g.geometry.deleteAttribute("uv"),g.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(g.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(g)),g.material.uniforms.envMap.value=A,g.material.uniforms.flipEnvMap.value=A.isCubeTexture&&!1===A.isRenderTargetTexture?-1:1,c===A&&I===A.version&&C===e.toneMapping||(g.material.needsUpdate=!0,c=A,I=A.version,C=e.toneMapping),n.unshift(g,g.geometry,g.material,0,0,null)):A&&A.isTexture&&(void 0===s&&(s=new qo(new fr(2,2),new or({name:"BackgroundMaterial",uniforms:tr(vr.background.uniforms),vertexShader:vr.background.vertexShader,fragmentShader:vr.background.fragmentShader,side:d,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(s)),s.material.uniforms.t2D.value=A,!0===A.matrixAutoUpdate&&A.updateMatrix(),s.material.uniforms.uvTransform.value.copy(A.matrix),c===A&&I===A.version&&C===e.toneMapping||(s.material.needsUpdate=!0,c=A,I=A.version,C=e.toneMapping),n.unshift(s,s.geometry,s.material,0,0,null))}}}function Zr(e,t,n,i){const o=e.getParameter(34921),r=i.isWebGL2?null:t.get("OES_vertex_array_object"),a=i.isWebGL2||null!==r,s={},g=C(null);let l=g;function c(t){return i.isWebGL2?e.bindVertexArray(t):r.bindVertexArrayOES(t)}function I(t){return i.isWebGL2?e.deleteVertexArray(t):r.deleteVertexArrayOES(t)}function C(e){const t=[],n=[],i=[];for(let r=0;r<o;r++)t[r]=0,n[r]=0,i[r]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function u(){const e=l.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function d(e){h(e,0)}function h(n,o){const r=l.newAttributes,a=l.enabledAttributes,s=l.attributeDivisors;if(r[n]=1,0===a[n]&&(e.enableVertexAttribArray(n),a[n]=1),s[n]!==o){(i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,o),s[n]=o}}function A(){const t=l.newAttributes,n=l.enabledAttributes;for(let i=0,o=n.length;i<o;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function p(t,n,o,r,a,s){!0!==i.isWebGL2||5124!==o&&5125!==o?e.vertexAttribPointer(t,n,o,r,a,s):e.vertexAttribIPointer(t,n,o,a,s)}function m(){b(),l!==g&&(l=g,c(l.object))}function b(){g.geometry=null,g.program=null,g.wireframe=!1}return{setup:function(o,g,I,m,b){let f=!1;if(a){const t=function(t,n,o){const a=!0===o.wireframe;let g=s[t.id];void 0===g&&(g={},s[t.id]=g);let l=g[n.id];void 0===l&&(l={},g[n.id]=l);let c=l[a];void 0===c&&(c=C(i.isWebGL2?e.createVertexArray():r.createVertexArrayOES()),l[a]=c);return c}(m,I,g);l!==t&&(l=t,c(l.object)),f=function(e,t){const n=l.attributes,i=e.attributes;let o=0;for(const r in i){const e=n[r],t=i[r];if(void 0===e)return!0;if(e.attribute!==t)return!0;if(e.data!==t.data)return!0;o++}return l.attributesNum!==o||l.index!==t}(m,b),f&&function(e,t){const n={},i=e.attributes;let o=0;for(const r in i){const e=i[r],t={};t.attribute=e,e.data&&(t.data=e.data),n[r]=t,o++}l.attributes=n,l.attributesNum=o,l.index=t}(m,b)}else{const e=!0===g.wireframe;l.geometry===m.id&&l.program===I.id&&l.wireframe===e||(l.geometry=m.id,l.program=I.id,l.wireframe=e,f=!0)}!0===o.isInstancedMesh&&(f=!0),null!==b&&n.update(b,34963),f&&(!function(o,r,a,s){if(!1===i.isWebGL2&&(o.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;u();const g=s.attributes,l=a.getAttributes(),c=r.defaultAttributeValues;for(const t in l){const i=l[t];if(i.location>=0){let r=g[t];if(void 0===r&&("instanceMatrix"===t&&o.instanceMatrix&&(r=o.instanceMatrix),"instanceColor"===t&&o.instanceColor&&(r=o.instanceColor)),void 0!==r){const t=r.normalized,a=r.itemSize,g=n.get(r);if(void 0===g)continue;const l=g.buffer,c=g.type,I=g.bytesPerElement;if(r.isInterleavedBufferAttribute){const n=r.data,g=n.stride,C=r.offset;if(n&&n.isInstancedInterleavedBuffer){for(let e=0;e<i.locationSize;e++)h(i.location+e,n.meshPerAttribute);!0!==o.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let e=0;e<i.locationSize;e++)d(i.location+e);e.bindBuffer(34962,l);for(let e=0;e<i.locationSize;e++)p(i.location+e,a/i.locationSize,c,t,g*I,(C+a/i.locationSize*e)*I)}else{if(r.isInstancedBufferAttribute){for(let e=0;e<i.locationSize;e++)h(i.location+e,r.meshPerAttribute);!0!==o.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=r.meshPerAttribute*r.count)}else for(let e=0;e<i.locationSize;e++)d(i.location+e);e.bindBuffer(34962,l);for(let e=0;e<i.locationSize;e++)p(i.location+e,a/i.locationSize,c,t,a*I,a/i.locationSize*e*I)}}else if(void 0!==c){const n=c[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(i.location,n);break;case 3:e.vertexAttrib3fv(i.location,n);break;case 4:e.vertexAttrib4fv(i.location,n);break;default:e.vertexAttrib1fv(i.location,n)}}}}A()}(o,g,I,m),null!==b&&e.bindBuffer(34963,n.get(b).buffer))},reset:m,resetDefaultState:b,dispose:function(){m();for(const e in s){const t=s[e];for(const e in t){const n=t[e];for(const e in n)I(n[e].object),delete n[e];delete t[e]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0===s[e.id])return;const t=s[e.id];for(const n in t){const e=t[n];for(const t in e)I(e[t].object),delete e[t];delete t[n]}delete s[e.id]},releaseStatesOfProgram:function(e){for(const t in s){const n=s[t];if(void 0===n[e.id])continue;const i=n[e.id];for(const e in i)I(i[e].object),delete i[e];delete n[e.id]}},initAttributes:u,enableAttribute:d,disableUnusedAttributes:A}}function wr(e,t,n,i){const o=i.isWebGL2;let r;this.setMode=function(e){r=e},this.render=function(t,i){e.drawArrays(r,t,i),n.update(i,r,1)},this.renderInstances=function(i,a,s){if(0===s)return;let g,l;if(o)g=e,l="drawArraysInstanced";else if(g=t.get("ANGLE_instanced_arrays"),l="drawArraysInstancedANGLE",null===g)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");g[l](r,i,a,s),n.update(a,r,s)}}function Wr(e,t,n){let i;function o(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const r="undefined"!==typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!==typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let a=void 0!==n.precision?n.precision:"highp";const s=o(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);const g=r||t.has("WEBGL_draw_buffers"),l=!0===n.logarithmicDepthBuffer,c=e.getParameter(34930),I=e.getParameter(35660),C=e.getParameter(3379),u=e.getParameter(34076),d=e.getParameter(34921),h=e.getParameter(36347),A=e.getParameter(36348),p=e.getParameter(36349),m=I>0,b=r||t.has("OES_texture_float");return{isWebGL2:r,drawBuffers:g,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:o,precision:a,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:I,maxTextureSize:C,maxCubemapSize:u,maxAttributes:d,maxVertexUniforms:h,maxVaryings:A,maxFragmentUniforms:p,vertexTextures:m,floatFragmentTextures:b,floatVertexTextures:m&&b,maxSamples:r?e.getParameter(36183):0}}function Sr(e){const t=this;let n=null,i=0,o=!1,r=!1;const a=new dr,s=new Sn,g={value:null,needsUpdate:!1};function l(){g.value!==n&&(g.value=n,g.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function c(e,n,i,o){const r=null!==e?e.length:0;let l=null;if(0!==r){if(l=g.value,!0!==o||null===l){const t=i+4*r,o=n.matrixWorldInverse;s.getNormalMatrix(o),(null===l||l.length<t)&&(l=new Float32Array(t));for(let n=0,g=i;n!==r;++n,g+=4)a.copy(e[n]).applyMatrix4(o,s),a.normal.toArray(l,g),l[g+3]=a.constant}g.value=l,g.needsUpdate=!0}return t.numPlanes=r,t.numIntersection=0,l}this.uniform=g,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,r){const a=0!==e.length||t||0!==i||o;return o=t,n=c(e,r,0),i=e.length,a},this.beginShadows=function(){r=!0,c(null)},this.endShadows=function(){r=!1,l()},this.setState=function(t,a,s){const I=t.clippingPlanes,C=t.clipIntersection,u=t.clipShadows,d=e.get(t);if(!o||null===I||0===I.length||r&&!u)r?c(null):l();else{const e=r?0:i,t=4*e;let o=d.clippingState||null;g.value=o,o=c(I,a,t,s);for(let i=0;i!==t;++i)o[i]=n[i];d.clippingState=o,this.numIntersection=C?this.numPlanes:0,this.numPlanes+=e}}}function Rr(e){let t=new WeakMap;function n(e,t){return t===se?e.mapping=re:t===ge&&(e.mapping=ae),e}function i(e){const n=e.target;n.removeEventListener("dispose",i);const o=t.get(n);void 0!==o&&(t.delete(n),o.dispose())}return{get:function(o){if(o&&o.isTexture&&!1===o.isRenderTargetTexture){const r=o.mapping;if(r===se||r===ge){if(t.has(o)){return n(t.get(o).texture,o.mapping)}{const r=o.image;if(r&&r.height>0){const a=new cr(r.height/2);return a.fromEquirectangularTexture(e,o),t.set(o,a),o.addEventListener("dispose",i),n(a.texture,o.mapping)}return null}}}return o},dispose:function(){t=new WeakMap}}}vr.physical={uniforms:nr([vr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Wn(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new kn(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Wn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new kn(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new kn(1,1,1)},specularColorMap:{value:null}}]),vertexShader:yr.meshphysical_vert,fragmentShader:yr.meshphysical_frag};class xr extends rr{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=o,this.far=r,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,o,r){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=o,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let o=n-e,r=n+e,a=i+t,s=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=e*this.view.offsetX,r=o+e*this.view.width,a-=t*this.view.offsetY,s=a-t*this.view.height}this.projectionMatrix.makeOrthographic(o,r,a,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}xr.prototype.isOrthographicCamera=!0;class Vr extends or{constructor(e){super(e),this.type="RawShaderMaterial"}}Vr.prototype.isRawShaderMaterial=!0;const Xr=Math.pow(2,8),Hr=[.125,.215,.35,.446,.526,.582],Yr=5+Hr.length,Kr=20,Nr=new xr,{_lodPlanes:Mr,_sizeLods:Fr,_sigmas:kr}=Dr(),zr=new kn;let Lr=null;const Tr=(1+Math.sqrt(5))/2,Er=1/Tr,Jr=[new jn(1,1,1),new jn(-1,1,1),new jn(1,1,-1),new jn(-1,1,-1),new jn(0,Tr,Er),new jn(0,Tr,-Er),new jn(Er,0,Tr),new jn(-Er,0,Tr),new jn(Tr,Er,0),new jn(-Tr,Er,0)];class Ur{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=function(e){const t=new Float32Array(e),n=new jn(0,1,0);return new Vr({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:Or(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:b,depthTest:!1,depthWrite:!1})}(Kr),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;Lr=this._renderer.getRenderTarget();const o=this._allocateTargets();return this._sceneToCubeUV(e,n,i,o),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}fromCubemap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=jr(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=_r(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let e=0;e<Mr.length;e++)Mr[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Lr),e.scissorTest=!1,Qr(e,0,0,e.width,e.height)}_fromTexture(e,t){Lr=this._renderer.getRenderTarget();const n=t||this._allocateTargets(e);return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(e){const t={magFilter:be,minFilter:be,generateMipmaps:!1,type:Ve,format:Me,encoding:Ht,depthBuffer:!1},n=Pr(t);return n.depthBuffer=!e,null===this._pingPongRenderTarget&&(this._pingPongRenderTarget=Pr(t)),n}_compileMaterial(e){const t=new qo(Mr[0],e);this._renderer.compile(t,Nr)}_sceneToCubeUV(e,t,n,i){const o=new ar(90,1,t,n),r=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],s=this._renderer,g=s.autoClear,l=s.toneMapping;s.getClearColor(zr),s.toneMapping=q,s.autoClear=!1;const c=new Co({name:"PMREM.Background",side:h,depthWrite:!1,depthTest:!1}),I=new qo(new er,c);let C=!1;const u=e.background;u?u.isColor&&(c.color.copy(u),e.background=null,C=!0):(c.color.copy(zr),C=!0);for(let d=0;d<6;d++){const t=d%3;0===t?(o.up.set(0,r[d],0),o.lookAt(a[d],0,0)):1===t?(o.up.set(0,0,r[d]),o.lookAt(0,a[d],0)):(o.up.set(0,r[d],0),o.lookAt(0,0,a[d])),Qr(i,t*Xr,d>2?Xr:0,Xr,Xr),s.setRenderTarget(i),C&&s.render(I,o),s.render(e,o)}I.geometry.dispose(),I.material.dispose(),s.toneMapping=l,s.autoClear=g,e.background=u}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===re||e.mapping===ae;i?(null===this._cubemapShader&&(this._cubemapShader=jr()),this._cubemapShader.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectShader&&(this._equirectShader=_r());const o=i?this._cubemapShader:this._equirectShader,r=new qo(Mr[0],o),a=o.uniforms;a.envMap.value=e,i||a.texelSize.value.set(1/e.image.width,1/e.image.height),Qr(t,0,0,3*Xr,2*Xr),n.setRenderTarget(t),n.render(r,Nr)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let i=1;i<Yr;i++){const t=Math.sqrt(kr[i]*kr[i]-kr[i-1]*kr[i-1]),n=Jr[(i-1)%Jr.length];this._blur(e,i-1,i,t,n)}t.autoClear=n}_blur(e,t,n,i,o){const r=this._pingPongRenderTarget;this._halfBlur(e,r,t,n,i,"latitudinal",o),this._halfBlur(r,e,n,n,i,"longitudinal",o)}_halfBlur(e,t,n,i,o,r,a){const s=this._renderer,g=this._blurMaterial;"latitudinal"!==r&&"longitudinal"!==r&&console.error("blur direction must be either latitudinal or longitudinal!");const l=new qo(Mr[i],g),c=g.uniforms,I=Fr[n]-1,C=isFinite(o)?Math.PI/(2*I):2*Math.PI/39,u=o/C,d=isFinite(o)?1+Math.floor(3*u):Kr;d>Kr&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${d} samples when the maximum is set to 20`);const h=[];let A=0;for(let m=0;m<Kr;++m){const e=m/u,t=Math.exp(-e*e/2);h.push(t),0===m?A+=t:m<d&&(A+=2*t)}for(let m=0;m<h.length;m++)h[m]=h[m]/A;c.envMap.value=e.texture,c.samples.value=d,c.weights.value=h,c.latitudinal.value="latitudinal"===r,a&&(c.poleAxis.value=a),c.dTheta.value=C,c.mipInt.value=8-n;const p=Fr[i];Qr(t,3*Math.max(0,Xr-2*p),(0===i?0:2*Xr)+2*p*(i>4?i-8+4:0),3*p,2*p),s.setRenderTarget(t),s.render(l,Nr)}}function Dr(){const e=[],t=[],n=[];let i=8;for(let o=0;o<Yr;o++){const r=Math.pow(2,i);t.push(r);let a=1/r;o>4?a=Hr[o-8+4-1]:0===o&&(a=0),n.push(a);const s=1/(r-1),g=-s/2,l=1+s/2,c=[g,g,l,g,l,l,g,g,l,l,g,l],I=6,C=6,u=3,d=2,h=1,A=new Float32Array(u*C*I),p=new Float32Array(d*C*I),m=new Float32Array(h*C*I);for(let e=0;e<I;e++){const t=e%3*2/3-1,n=e>2?0:-1,i=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];A.set(i,u*C*e),p.set(c,d*C*e);const o=[e,e,e,e,e,e];m.set(o,h*C*e)}const b=new Yo;b.setAttribute("position",new Ao(A,u)),b.setAttribute("uv",new Ao(p,d)),b.setAttribute("faceIndex",new Ao(m,h)),e.push(b),i>4&&i--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}function Pr(e){const t=new Dn(3*Xr,3*Xr,e);return t.texture.mapping=le,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function Qr(e,t,n,i,o){e.viewport.set(t,n,i,o),e.scissor.set(t,n,i,o)}function _r(){const e=new Wn(1,1);return new Vr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:e}},vertexShader:Or(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = texture2D ( envMap, uv ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = texture2D ( envMap, uv ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = texture2D ( envMap, uv ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = texture2D ( envMap, uv ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t}\n\t\t",blending:b,depthTest:!1,depthWrite:!1})}function jr(){return new Vr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Or(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:b,depthTest:!1,depthWrite:!1})}function Or(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function qr(e){let t=new WeakMap,n=null;function i(e){const n=e.target;n.removeEventListener("dispose",i);const o=t.get(n);void 0!==o&&(t.delete(n),o.dispose())}return{get:function(o){if(o&&o.isTexture){const r=o.mapping,a=r===se||r===ge,s=r===re||r===ae;if(a||s){if(o.isRenderTargetTexture&&!0===o.needsPMREMUpdate){o.needsPMREMUpdate=!1;let i=t.get(o);return null===n&&(n=new Ur(e)),i=a?n.fromEquirectangular(o,i):n.fromCubemap(o,i),t.set(o,i),i.texture}if(t.has(o))return t.get(o).texture;{const r=o.image;if(a&&r&&r.height>0||s&&r&&function(e){let t=0;const n=6;for(let i=0;i<n;i++)void 0!==e[i]&&t++;return t===n}(r)){null===n&&(n=new Ur(e));const r=a?n.fromEquirectangular(o):n.fromCubemap(o);return t.set(o,r),o.addEventListener("dispose",i),r.texture}return null}}}return o},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function $r(e){const t={};function n(n){if(void 0!==t[n])return t[n];let i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function ea(e,t,n,i){const o={},r=new WeakMap;function a(e){const s=e.target;null!==s.index&&t.remove(s.index);for(const n in s.attributes)t.remove(s.attributes[n]);s.removeEventListener("dispose",a),delete o[s.id];const g=r.get(s);g&&(t.remove(g),r.delete(s)),i.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){const n=[],i=e.index,o=e.attributes.position;let a=0;if(null!==i){const e=i.array;a=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],o=e[t+1],r=e[t+2];n.push(i,o,o,r,r,i)}}else{const e=o.array;a=o.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,o=t+2;n.push(e,i,i,o,o,e)}}const s=new(Rn(n)?vo:yo)(n,1);s.version=a;const g=r.get(e);g&&t.remove(g),r.set(e,s)}return{get:function(e,t){return!0===o[t.id]||(t.addEventListener("dispose",a),o[t.id]=!0,n.memory.geometries++),t},update:function(e){const n=e.attributes;for(const o in n)t.update(n[o],34962);const i=e.morphAttributes;for(const o in i){const e=i[o];for(let n=0,i=e.length;n<i;n++)t.update(e[n],34962)}},getWireframeAttribute:function(e){const t=r.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return r.get(e)}}}function ta(e,t,n,i){const o=i.isWebGL2;let r,a,s;this.setMode=function(e){r=e},this.setIndex=function(e){a=e.type,s=e.bytesPerElement},this.render=function(t,i){e.drawElements(r,i,a,t*s),n.update(i,r,1)},this.renderInstances=function(i,g,l){if(0===l)return;let c,I;if(o)c=e,I="drawElementsInstanced";else if(c=t.get("ANGLE_instanced_arrays"),I="drawElementsInstancedANGLE",null===c)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[I](r,g,a,i*s,l),n.update(g,r,l)}}function na(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,i){switch(t.calls++,n){case 4:t.triangles+=i*(e/3);break;case 1:t.lines+=i*(e/2);break;case 3:t.lines+=i*(e-1);break;case 2:t.lines+=i*e;break;case 0:t.points+=i*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}class ia extends En{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.image={data:e,width:t,height:n,depth:i},this.magFilter=de,this.minFilter=de,this.wrapR=Ce,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}function oa(e,t){return e[0]-t[0]}function ra(e,t){return Math.abs(t[1])-Math.abs(e[1])}function aa(e,t){let n=1;const i=t.isInterleavedBufferAttribute?t.data.array:t.array;i instanceof Int8Array?n=127:i instanceof Int16Array?n=32767:i instanceof Int32Array?n=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",i),e.divideScalar(n)}function sa(e,t,n){const i={},o=new Float32Array(8),r=new WeakMap,a=new jn,s=[];for(let g=0;g<8;g++)s[g]=[g,0];return{update:function(g,l,c,I){const C=g.morphTargetInfluences;if(!0===t.isWebGL2){const u=l.morphAttributes.position.length;let d=r.get(l);if(void 0===d||d.count!==u){void 0!==d&&d.texture.dispose();const p=void 0!==l.morphAttributes.normal,m=l.morphAttributes.position,b=l.morphAttributes.normal||[],f=!0===p?2:1;let y=l.attributes.position.count*f,G=1;y>t.maxTextureSize&&(G=Math.ceil(y/t.maxTextureSize),y=t.maxTextureSize);const v=new Float32Array(y*G*4*u),B=new ia(v,y,G,u);B.format=Me,B.type=xe,B.needsUpdate=!0;const Z=4*f;for(let W=0;W<u;W++){const S=m[W],R=b[W],x=y*G*4*W;for(let V=0;V<S.count;V++){a.fromBufferAttribute(S,V),!0===S.normalized&&aa(a,S);const X=V*Z;v[x+X+0]=a.x,v[x+X+1]=a.y,v[x+X+2]=a.z,v[x+X+3]=0,!0===p&&(a.fromBufferAttribute(R,V),!0===R.normalized&&aa(a,R),v[x+X+4]=a.x,v[x+X+5]=a.y,v[x+X+6]=a.z,v[x+X+7]=0)}}function w(){B.dispose(),r.delete(l),l.removeEventListener("dispose",w)}d={count:u,texture:B,size:new Wn(y,G)},r.set(l,d),l.addEventListener("dispose",w)}let h=0;for(let H=0;H<C.length;H++)h+=C[H];const A=l.morphTargetsRelative?1:1-h;I.getUniforms().setValue(e,"morphTargetBaseInfluence",A),I.getUniforms().setValue(e,"morphTargetInfluences",C),I.getUniforms().setValue(e,"morphTargetsTexture",d.texture,n),I.getUniforms().setValue(e,"morphTargetsTextureSize",d.size)}else{const Y=void 0===C?0:C.length;let K=i[l.id];if(void 0===K||K.length!==Y){K=[];for(let z=0;z<Y;z++)K[z]=[z,0];i[l.id]=K}for(let L=0;L<Y;L++){const T=K[L];T[0]=L,T[1]=C[L]}K.sort(ra);for(let E=0;E<8;E++)E<Y&&K[E][1]?(s[E][0]=K[E][0],s[E][1]=K[E][1]):(s[E][0]=Number.MAX_SAFE_INTEGER,s[E][1]=0);s.sort(oa);const N=l.morphAttributes.position,M=l.morphAttributes.normal;let F=0;for(let J=0;J<8;J++){const U=s[J],D=U[0],P=U[1];D!==Number.MAX_SAFE_INTEGER&&P?(N&&l.getAttribute("morphTarget"+J)!==N[D]&&l.setAttribute("morphTarget"+J,N[D]),M&&l.getAttribute("morphNormal"+J)!==M[D]&&l.setAttribute("morphNormal"+J,M[D]),o[J]=P,F+=P):(N&&!0===l.hasAttribute("morphTarget"+J)&&l.deleteAttribute("morphTarget"+J),M&&!0===l.hasAttribute("morphNormal"+J)&&l.deleteAttribute("morphNormal"+J),o[J]=0)}const k=l.morphTargetsRelative?1:1-F;I.getUniforms().setValue(e,"morphTargetBaseInfluence",k),I.getUniforms().setValue(e,"morphTargetInfluences",o)}}}}function ga(e,t,n,i){let o=new WeakMap;function r(e){const t=e.target;t.removeEventListener("dispose",r),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){const a=i.render.frame,s=e.geometry,g=t.get(e,s);return o.get(g)!==a&&(t.update(g),o.set(g,a)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",r)&&e.addEventListener("dispose",r),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),g},dispose:function(){o=new WeakMap}}}ia.prototype.isDataTexture2DArray=!0;class la extends En{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.image={data:e,width:t,height:n,depth:i},this.magFilter=de,this.minFilter=de,this.wrapR=Ce,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}la.prototype.isDataTexture3D=!0;const ca=new En,Ia=new ia,Ca=new la,ua=new lr,da=[],ha=[],Aa=new Float32Array(16),pa=new Float32Array(9),ma=new Float32Array(4);function ba(e,t,n){const i=e[0];if(i<=0||i>0)return e;const o=t*n;let r=da[o];if(void 0===r&&(r=new Float32Array(o),da[o]=r),0!==t){i.toArray(r,0);for(let i=1,o=0;i!==t;++i)o+=n,e[i].toArray(r,o)}return r}function fa(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function ya(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function Ga(e,t){let n=ha[t];void 0===n&&(n=new Int32Array(t),ha[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function va(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Ba(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(fa(n,t))return;e.uniform2fv(this.addr,t),ya(n,t)}}function Za(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(fa(n,t))return;e.uniform3fv(this.addr,t),ya(n,t)}}function wa(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(fa(n,t))return;e.uniform4fv(this.addr,t),ya(n,t)}}function Wa(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(fa(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),ya(n,t)}else{if(fa(n,i))return;ma.set(i),e.uniformMatrix2fv(this.addr,!1,ma),ya(n,i)}}function Sa(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(fa(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),ya(n,t)}else{if(fa(n,i))return;pa.set(i),e.uniformMatrix3fv(this.addr,!1,pa),ya(n,i)}}function Ra(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(fa(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),ya(n,t)}else{if(fa(n,i))return;Aa.set(i),e.uniformMatrix4fv(this.addr,!1,Aa),ya(n,i)}}function xa(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Va(e,t){const n=this.cache;fa(n,t)||(e.uniform2iv(this.addr,t),ya(n,t))}function Xa(e,t){const n=this.cache;fa(n,t)||(e.uniform3iv(this.addr,t),ya(n,t))}function Ha(e,t){const n=this.cache;fa(n,t)||(e.uniform4iv(this.addr,t),ya(n,t))}function Ya(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Ka(e,t){const n=this.cache;fa(n,t)||(e.uniform2uiv(this.addr,t),ya(n,t))}function Na(e,t){const n=this.cache;fa(n,t)||(e.uniform3uiv(this.addr,t),ya(n,t))}function Ma(e,t){const n=this.cache;fa(n,t)||(e.uniform4uiv(this.addr,t),ya(n,t))}function Fa(e,t,n){const i=this.cache,o=n.allocateTextureUnit();i[0]!==o&&(e.uniform1i(this.addr,o),i[0]=o),n.safeSetTexture2D(t||ca,o)}function ka(e,t,n){const i=this.cache,o=n.allocateTextureUnit();i[0]!==o&&(e.uniform1i(this.addr,o),i[0]=o),n.setTexture3D(t||Ca,o)}function za(e,t,n){const i=this.cache,o=n.allocateTextureUnit();i[0]!==o&&(e.uniform1i(this.addr,o),i[0]=o),n.safeSetTextureCube(t||ua,o)}function La(e,t,n){const i=this.cache,o=n.allocateTextureUnit();i[0]!==o&&(e.uniform1i(this.addr,o),i[0]=o),n.setTexture2DArray(t||Ia,o)}function Ta(e,t){e.uniform1fv(this.addr,t)}function Ea(e,t){const n=ba(t,this.size,2);e.uniform2fv(this.addr,n)}function Ja(e,t){const n=ba(t,this.size,3);e.uniform3fv(this.addr,n)}function Ua(e,t){const n=ba(t,this.size,4);e.uniform4fv(this.addr,n)}function Da(e,t){const n=ba(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Pa(e,t){const n=ba(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Qa(e,t){const n=ba(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function _a(e,t){e.uniform1iv(this.addr,t)}function ja(e,t){e.uniform2iv(this.addr,t)}function Oa(e,t){e.uniform3iv(this.addr,t)}function qa(e,t){e.uniform4iv(this.addr,t)}function $a(e,t){e.uniform1uiv(this.addr,t)}function es(e,t){e.uniform2uiv(this.addr,t)}function ts(e,t){e.uniform3uiv(this.addr,t)}function ns(e,t){e.uniform4uiv(this.addr,t)}function is(e,t,n){const i=t.length,o=Ga(n,i);e.uniform1iv(this.addr,o);for(let r=0;r!==i;++r)n.safeSetTexture2D(t[r]||ca,o[r])}function os(e,t,n){const i=t.length,o=Ga(n,i);e.uniform1iv(this.addr,o);for(let r=0;r!==i;++r)n.setTexture3D(t[r]||Ca,o[r])}function rs(e,t,n){const i=t.length,o=Ga(n,i);e.uniform1iv(this.addr,o);for(let r=0;r!==i;++r)n.safeSetTextureCube(t[r]||ua,o[r])}function as(e,t,n){const i=t.length,o=Ga(n,i);e.uniform1iv(this.addr,o);for(let r=0;r!==i;++r)n.setTexture2DArray(t[r]||Ia,o[r])}function ss(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return va;case 35664:return Ba;case 35665:return Za;case 35666:return wa;case 35674:return Wa;case 35675:return Sa;case 35676:return Ra;case 5124:case 35670:return xa;case 35667:case 35671:return Va;case 35668:case 35672:return Xa;case 35669:case 35673:return Ha;case 5125:return Ya;case 36294:return Ka;case 36295:return Na;case 36296:return Ma;case 35678:case 36198:case 36298:case 36306:case 35682:return Fa;case 35679:case 36299:case 36307:return ka;case 35680:case 36300:case 36308:case 36293:return za;case 36289:case 36303:case 36311:case 36292:return La}}(t.type)}function gs(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Ta;case 35664:return Ea;case 35665:return Ja;case 35666:return Ua;case 35674:return Da;case 35675:return Pa;case 35676:return Qa;case 5124:case 35670:return _a;case 35667:case 35671:return ja;case 35668:case 35672:return Oa;case 35669:case 35673:return qa;case 5125:return $a;case 36294:return es;case 36295:return ts;case 36296:return ns;case 35678:case 36198:case 36298:case 36306:case 35682:return is;case 35679:case 36299:case 36307:return os;case 35680:case 36300:case 36308:case 36293:return rs;case 36289:case 36303:case 36311:case 36292:return as}}(t.type)}function ls(e){this.id=e,this.seq=[],this.map={}}gs.prototype.updateCache=function(e){const t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),ya(t,e)},ls.prototype.setValue=function(e,t,n){const i=this.seq;for(let o=0,r=i.length;o!==r;++o){const r=i[o];r.setValue(e,t[r.id],n)}};const cs=/(\w+)(\])?(\[|\.)?/g;function Is(e,t){e.seq.push(t),e.map[t.id]=t}function Cs(e,t,n){const i=e.name,o=i.length;for(cs.lastIndex=0;;){const r=cs.exec(i),a=cs.lastIndex;let s=r[1];const g="]"===r[2],l=r[3];if(g&&(s|=0),void 0===l||"["===l&&a+2===o){Is(n,void 0===l?new ss(s,e,t):new gs(s,e,t));break}{let e=n.map[s];void 0===e&&(e=new ls(s),Is(n,e)),n=e}}}function us(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,35718);for(let i=0;i<n;++i){const n=e.getActiveUniform(t,i);Cs(n,e.getUniformLocation(t,n.name),this)}}function ds(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}us.prototype.setValue=function(e,t,n,i){const o=this.map[t];void 0!==o&&o.setValue(e,n,i)},us.prototype.setOptional=function(e,t,n){const i=t[n];void 0!==i&&this.setValue(e,n,i)},us.upload=function(e,t,n,i){for(let o=0,r=t.length;o!==r;++o){const r=t[o],a=n[r.id];!1!==a.needsUpdate&&r.setValue(e,a.value,i)}},us.seqWithValue=function(e,t){const n=[];for(let i=0,o=e.length;i!==o;++i){const o=e[i];o.id in t&&n.push(o)}return n};let hs=0;function As(e,t,n){const i=e.getShaderParameter(t,35713),o=e.getShaderInfoLog(t).trim();return i&&""===o?"":n.toUpperCase()+"\n\n"+o+"\n\n"+function(e){const t=e.split("\n");for(let n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}(e.getShaderSource(t))}function ps(e,t){const n=function(e){switch(e){case Ht:return["Linear","( value )"];case Yt:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function ms(e,t){let n;switch(t){case $:n="Linear";break;case ee:n="Reinhard";break;case te:n="OptimizedCineon";break;case ne:n="ACESFilmic";break;case ie:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function bs(e){return""!==e}function fs(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function ys(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Gs=/^[ \t]*#include +<([\w\d./]+)>/gm;function vs(e){return e.replace(Gs,Bs)}function Bs(e,t){const n=yr[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return vs(n)}const Zs=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,ws=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Ws(e){return e.replace(ws,Rs).replace(Zs,Ss)}function Ss(e,t,n,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Rs(e,t,n,i)}function Rs(e,t,n,i){let o="";for(let r=parseInt(t);r<parseInt(n);r++)o+=i.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return o}function xs(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Vs(e,t,n,i){const o=e.getContext(),r=n.defines;let a=n.vertexShader,s=n.fragmentShader;const g=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===I?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===C?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===u&&(t="SHADOWMAP_TYPE_VSM"),t}(n),l=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case re:case ae:t="ENVMAP_TYPE_CUBE";break;case le:case ce:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),c=function(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case ae:case ce:t="ENVMAP_MODE_REFRACTION"}return t}(n),d=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case _:t="ENVMAP_BLENDING_MULTIPLY";break;case j:t="ENVMAP_BLENDING_MIX";break;case O:t="ENVMAP_BLENDING_ADD"}return t}(n),h=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(bs).join("\n")}(n),A=function(e){const t=[];for(const n in e){const i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(r),p=o.createProgram();let m,b,f=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(m=[A].filter(bs).join("\n"),m.length>0&&(m+="\n"),b=[h,A].filter(bs).join("\n"),b.length>0&&(b+="\n")):(m=[xs(n),"#define SHADER_NAME "+n.shaderName,A,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphTargets&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargets&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+g:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(bs).join("\n"),b=[h,xs(n),"#define SHADER_NAME "+n.shaderName,A,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+l:"",n.envMap?"#define "+c:"",n.envMap?"#define "+d:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+g:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==q?"#define TONE_MAPPING":"",n.toneMapping!==q?yr.tonemapping_pars_fragment:"",n.toneMapping!==q?ms("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.transparent?"":"#define OPAQUE",yr.encodings_pars_fragment,ps("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(bs).join("\n")),a=vs(a),a=fs(a,n),a=ys(a,n),s=vs(s),s=fs(s,n),s=ys(s,n),a=Ws(a),s=Ws(s),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(f="#version 300 es\n",m=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+m,b=["#define varying in",n.glslVersion===Cn?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===Cn?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+b);const y=f+b+s,G=ds(o,35633,f+m+a),v=ds(o,35632,y);if(o.attachShader(p,G),o.attachShader(p,v),void 0!==n.index0AttributeName?o.bindAttribLocation(p,0,n.index0AttributeName):!0===n.morphTargets&&o.bindAttribLocation(p,0,"position"),o.linkProgram(p),e.debug.checkShaderErrors){const e=o.getProgramInfoLog(p).trim(),t=o.getShaderInfoLog(G).trim(),n=o.getShaderInfoLog(v).trim();let i=!0,r=!0;if(!1===o.getProgramParameter(p,35714)){i=!1;const t=As(o,G,"vertex"),n=As(o,v,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(p,35715)+"\n\nProgram Info Log: "+e+"\n"+t+"\n"+n)}else""!==e?console.warn("THREE.WebGLProgram: Program Info Log:",e):""!==t&&""!==n||(r=!1);r&&(this.diagnostics={runnable:i,programLog:e,vertexShader:{log:t,prefix:m},fragmentShader:{log:n,prefix:b}})}let B,Z;return o.deleteShader(G),o.deleteShader(v),this.getUniforms=function(){return void 0===B&&(B=new us(o,p)),B},this.getAttributes=function(){return void 0===Z&&(Z=function(e,t){const n={},i=e.getProgramParameter(t,35721);for(let o=0;o<i;o++){const i=e.getActiveAttrib(t,o),r=i.name;let a=1;35674===i.type&&(a=2),35675===i.type&&(a=3),35676===i.type&&(a=4),n[r]={type:i.type,location:e.getAttribLocation(t,r),locationSize:a}}return n}(o,p)),Z},this.destroy=function(){i.releaseStatesOfProgram(this),o.deleteProgram(p),this.program=void 0},this.name=n.shaderName,this.id=hs++,this.cacheKey=t,this.usedTimes=1,this.program=p,this.vertexShader=G,this.fragmentShader=v,this}let Xs=0;class Hs{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),o=this._getShaderStage(n),r=this._getShaderCacheForMaterial(e);return!1===r.has(i)&&(r.add(i),i.usedTimes++),!1===r.has(o)&&(r.add(o),o.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,0===n.usedTimes&&this.shaderCache.delete(n);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;return!1===t.has(e)&&t.set(e,new Set),t.get(e)}_getShaderStage(e){const t=this.shaderCache;if(!1===t.has(e)){const n=new Ys;t.set(e,n)}return t.get(e)}}class Ys{constructor(){this.id=Xs++,this.usedTimes=0}}function Ks(e,t,n,i,o,r,a){const s=new Fi,g=new Hs,l=[],c=o.isWebGL2,I=o.logarithmicDepthBuffer,C=o.floatVertexTextures,u=o.maxVertexUniforms,d=o.vertexTextures;let p=o.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(r,s,l,b,f){const y=b.fog,G=r.isMeshStandardMaterial?b.environment:null,v=(r.isMeshStandardMaterial?n:t).get(r.envMap||G),B=m[r.type],Z=f.isSkinnedMesh?function(e){const t=e.skeleton.bones;if(C)return 1024;{const e=u,n=Math.floor((e-20)/4),i=Math.min(n,t.length);return i<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+i+"."),0):i}}(f):0;let w,W,S,R;if(null!==r.precision&&(p=o.getMaxPrecision(r.precision),p!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",p,"instead.")),B){const e=vr[B];w=e.vertexShader,W=e.fragmentShader}else w=r.vertexShader,W=r.fragmentShader,g.update(r),S=g.getVertexShaderID(r),R=g.getFragmentShaderID(r);const x=e.getRenderTarget(),V=r.alphaTest>0,X=r.clearcoat>0;return{isWebGL2:c,shaderID:B,shaderName:r.type,vertexShader:w,fragmentShader:W,defines:r.defines,customVertexShaderID:S,customFragmentShaderID:R,isRawShaderMaterial:!0===r.isRawShaderMaterial,glslVersion:r.glslVersion,precision:p,instancing:!0===f.isInstancedMesh,instancingColor:!0===f.isInstancedMesh&&null!==f.instanceColor,supportsVertexTextures:d,outputEncoding:null===x?e.outputEncoding:!0===x.isXRRenderTarget?x.texture.encoding:Ht,map:!!r.map,matcap:!!r.matcap,envMap:!!v,envMapMode:v&&v.mapping,envMapCubeUV:!!v&&(v.mapping===le||v.mapping===ce),lightMap:!!r.lightMap,aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,objectSpaceNormalMap:r.normalMapType===Ft,tangentSpaceNormalMap:r.normalMapType===Mt,decodeVideoTexture:!!r.map&&!0===r.map.isVideoTexture&&r.map.encoding===Yt,clearcoat:X,clearcoatMap:X&&!!r.clearcoatMap,clearcoatRoughnessMap:X&&!!r.clearcoatRoughnessMap,clearcoatNormalMap:X&&!!r.clearcoatNormalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,specularIntensityMap:!!r.specularIntensityMap,specularColorMap:!!r.specularColorMap,transparent:r.transparent,alphaMap:!!r.alphaMap,alphaTest:V,gradientMap:!!r.gradientMap,sheen:r.sheen>0,sheenColorMap:!!r.sheenColorMap,sheenRoughnessMap:!!r.sheenRoughnessMap,transmission:r.transmission>0,transmissionMap:!!r.transmissionMap,thicknessMap:!!r.thicknessMap,combine:r.combine,vertexTangents:!!r.normalMap&&!!f.geometry&&!!f.geometry.attributes.tangent,vertexColors:r.vertexColors,vertexAlphas:!0===r.vertexColors&&!!f.geometry&&!!f.geometry.attributes.color&&4===f.geometry.attributes.color.itemSize,vertexUvs:!!r.map||!!r.bumpMap||!!r.normalMap||!!r.specularMap||!!r.alphaMap||!!r.emissiveMap||!!r.roughnessMap||!!r.metalnessMap||!!r.clearcoatMap||!!r.clearcoatRoughnessMap||!!r.clearcoatNormalMap||!!r.displacementMap||!!r.transmissionMap||!!r.thicknessMap||!!r.specularIntensityMap||!!r.specularColorMap||!!r.sheenColorMap||!!r.sheenRoughnessMap,uvsVertexOnly:!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatNormalMap||r.transmission>0||r.transmissionMap||r.thicknessMap||r.specularIntensityMap||r.specularColorMap||r.sheen>0||r.sheenColorMap||r.sheenRoughnessMap)&&!!r.displacementMap,fog:!!y,useFog:r.fog,fogExp2:y&&y.isFogExp2,flatShading:!!r.flatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:I,skinning:!0===f.isSkinnedMesh&&Z>0,maxBones:Z,useVertexTexture:C,morphTargets:!!f.geometry&&!!f.geometry.morphAttributes.position,morphNormals:!!f.geometry&&!!f.geometry.morphAttributes.normal,morphTargetsCount:f.geometry&&f.geometry.morphAttributes.position?f.geometry.morphAttributes.position.length:0,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:r.dithering,shadowMapEnabled:e.shadowMap.enabled&&l.length>0,shadowMapType:e.shadowMap.type,toneMapping:r.toneMapped?e.toneMapping:q,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,doubleSided:r.side===A,flipSided:r.side===h,depthPacking:void 0!==r.depthPacking&&r.depthPacking,index0AttributeName:r.index0AttributeName,extensionDerivatives:r.extensions&&r.extensions.derivatives,extensionFragDepth:r.extensions&&r.extensions.fragDepth,extensionDrawBuffers:r.extensions&&r.extensions.drawBuffers,extensionShaderTextureLOD:r.extensions&&r.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||i.has("EXT_shader_texture_lod"),customProgramCacheKey:r.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputEncoding),e.push(t.envMapMode),e.push(t.combine),e.push(t.vertexUvs),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.maxBones),e.push(t.morphTargetsCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection)}(n,t),function(e,t){s.disableAll(),t.isWebGL2&&s.enable(0);t.supportsVertexTextures&&s.enable(1);t.instancing&&s.enable(2);t.instancingColor&&s.enable(3);t.map&&s.enable(4);t.matcap&&s.enable(5);t.envMap&&s.enable(6);t.envMapCubeUV&&s.enable(7);t.lightMap&&s.enable(8);t.aoMap&&s.enable(9);t.emissiveMap&&s.enable(10);t.bumpMap&&s.enable(11);t.normalMap&&s.enable(12);t.objectSpaceNormalMap&&s.enable(13);t.tangentSpaceNormalMap&&s.enable(14);t.clearcoat&&s.enable(15);t.clearcoatMap&&s.enable(16);t.clearcoatRoughnessMap&&s.enable(17);t.clearcoatNormalMap&&s.enable(18);t.displacementMap&&s.enable(19);t.specularMap&&s.enable(20);t.roughnessMap&&s.enable(21);t.metalnessMap&&s.enable(22);t.gradientMap&&s.enable(23);t.alphaMap&&s.enable(24);t.alphaTest&&s.enable(25);t.vertexColors&&s.enable(26);t.vertexAlphas&&s.enable(27);t.vertexUvs&&s.enable(28);t.vertexTangents&&s.enable(29);t.uvsVertexOnly&&s.enable(30);t.fog&&s.enable(31);e.push(s.mask),s.disableAll(),t.useFog&&s.enable(0);t.flatShading&&s.enable(1);t.logarithmicDepthBuffer&&s.enable(2);t.skinning&&s.enable(3);t.useVertexTexture&&s.enable(4);t.morphTargets&&s.enable(5);t.morphNormals&&s.enable(6);t.premultipliedAlpha&&s.enable(7);t.shadowMapEnabled&&s.enable(8);t.physicallyCorrectLights&&s.enable(9);t.doubleSided&&s.enable(10);t.flipSided&&s.enable(11);t.depthPacking&&s.enable(12);t.dithering&&s.enable(13);t.specularIntensityMap&&s.enable(14);t.specularColorMap&&s.enable(15);t.transmission&&s.enable(16);t.transmissionMap&&s.enable(17);t.thicknessMap&&s.enable(18);t.sheen&&s.enable(19);t.sheenColorMap&&s.enable(20);t.sheenRoughnessMap&&s.enable(21);t.decodeVideoTexture&&s.enable(22);t.transparent&&s.enable(23);e.push(s.mask)}(n,t),n.push(e.outputEncoding)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=m[e.type];let n;if(t){const e=vr[t];n=ir.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let i;for(let e=0,o=l.length;e<o;e++){const t=l[e];if(t.cacheKey===n){i=t,++i.usedTimes;break}}return void 0===i&&(i=new Vs(e,n,t,r),l.push(i)),i},releaseProgram:function(e){if(0===--e.usedTimes){const t=l.indexOf(e);l[t]=l[l.length-1],l.pop(),e.destroy()}},releaseShaderCache:function(e){g.remove(e)},programs:l,dispose:function(){g.dispose()}}}function Ns(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function Ms(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Fs(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function ks(){const e=[];let t=0;const n=[],i=[],o=[];function r(n,i,o,r,a,s){let g=e[t];return void 0===g?(g={id:n.id,object:n,geometry:i,material:o,groupOrder:r,renderOrder:n.renderOrder,z:a,group:s},e[t]=g):(g.id=n.id,g.object=n,g.geometry=i,g.material=o,g.groupOrder=r,g.renderOrder=n.renderOrder,g.z=a,g.group=s),t++,g}return{opaque:n,transmissive:i,transparent:o,init:function(){t=0,n.length=0,i.length=0,o.length=0},push:function(e,t,a,s,g,l){const c=r(e,t,a,s,g,l);a.transmission>0?i.push(c):!0===a.transparent?o.push(c):n.push(c)},unshift:function(e,t,a,s,g,l){const c=r(e,t,a,s,g,l);a.transmission>0?i.unshift(c):!0===a.transparent?o.unshift(c):n.unshift(c)},finish:function(){for(let n=t,i=e.length;n<i;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||Ms),i.length>1&&i.sort(t||Fs),o.length>1&&o.sort(t||Fs)}}}function zs(){let e=new WeakMap;return{get:function(t,n){let i;return!1===e.has(t)?(i=new ks,e.set(t,[i])):n>=e.get(t).length?(i=new ks,e.get(t).push(i)):i=e.get(t)[n],i},dispose:function(){e=new WeakMap}}}function Ls(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new jn,color:new kn};break;case"SpotLight":n={position:new jn,direction:new jn,color:new kn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new jn,color:new kn,distance:0,decay:0};break;case"HemisphereLight":n={direction:new jn,skyColor:new kn,groundColor:new kn};break;case"RectAreaLight":n={color:new kn,position:new jn,halfWidth:new jn,halfHeight:new jn}}return e[t.id]=n,n}}}let Ts=0;function Es(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Js(e,t){const n=new Ls,i=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Wn};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Wn,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),o={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let g=0;g<9;g++)o.probe.push(new jn);const r=new jn,a=new Wi,s=new Wi;return{setup:function(r,a){let s=0,g=0,l=0;for(let e=0;e<9;e++)o.probe[e].set(0,0,0);let c=0,I=0,C=0,u=0,d=0,h=0,A=0,p=0;r.sort(Es);const m=!0!==a?Math.PI:1;for(let e=0,t=r.length;e<t;e++){const t=r[e],a=t.color,b=t.intensity,f=t.distance,y=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)s+=a.r*b*m,g+=a.g*b*m,l+=a.b*b*m;else if(t.isLightProbe)for(let e=0;e<9;e++)o.probe[e].addScaledVector(t.sh.coefficients[e],b);else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*m),t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,o.directionalShadow[c]=n,o.directionalShadowMap[c]=y,o.directionalShadowMatrix[c]=t.shadow.matrix,h++}o.directional[c]=e,c++}else if(t.isSpotLight){const e=n.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(a).multiplyScalar(b*m),e.distance=f,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,o.spotShadow[C]=n,o.spotShadowMap[C]=y,o.spotShadowMatrix[C]=t.shadow.matrix,p++}o.spot[C]=e,C++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(a).multiplyScalar(b),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),o.rectArea[u]=e,u++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*m),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,o.pointShadow[I]=n,o.pointShadowMap[I]=y,o.pointShadowMatrix[I]=t.shadow.matrix,A++}o.point[I]=e,I++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(b*m),e.groundColor.copy(t.groundColor).multiplyScalar(b*m),o.hemi[d]=e,d++}}u>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(o.rectAreaLTC1=Gr.LTC_FLOAT_1,o.rectAreaLTC2=Gr.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(o.rectAreaLTC1=Gr.LTC_HALF_1,o.rectAreaLTC2=Gr.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),o.ambient[0]=s,o.ambient[1]=g,o.ambient[2]=l;const b=o.hash;b.directionalLength===c&&b.pointLength===I&&b.spotLength===C&&b.rectAreaLength===u&&b.hemiLength===d&&b.numDirectionalShadows===h&&b.numPointShadows===A&&b.numSpotShadows===p||(o.directional.length=c,o.spot.length=C,o.rectArea.length=u,o.point.length=I,o.hemi.length=d,o.directionalShadow.length=h,o.directionalShadowMap.length=h,o.pointShadow.length=A,o.pointShadowMap.length=A,o.spotShadow.length=p,o.spotShadowMap.length=p,o.directionalShadowMatrix.length=h,o.pointShadowMatrix.length=A,o.spotShadowMatrix.length=p,b.directionalLength=c,b.pointLength=I,b.spotLength=C,b.rectAreaLength=u,b.hemiLength=d,b.numDirectionalShadows=h,b.numPointShadows=A,b.numSpotShadows=p,o.version=Ts++)},setupView:function(e,t){let n=0,i=0,g=0,l=0,c=0;const I=t.matrixWorldInverse;for(let C=0,u=e.length;C<u;C++){const t=e[C];if(t.isDirectionalLight){const e=o.directional[n];e.direction.setFromMatrixPosition(t.matrixWorld),r.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(I),n++}else if(t.isSpotLight){const e=o.spot[g];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(I),e.direction.setFromMatrixPosition(t.matrixWorld),r.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(I),g++}else if(t.isRectAreaLight){const e=o.rectArea[l];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(I),s.identity(),a.copy(t.matrixWorld),a.premultiply(I),s.extractRotation(a),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),l++}else if(t.isPointLight){const e=o.point[i];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(I),i++}else if(t.isHemisphereLight){const e=o.hemi[c];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(I),e.direction.normalize(),c++}}},state:o}}function Us(e,t){const n=new Js(e,t),i=[],o=[];return{init:function(){i.length=0,o.length=0},state:{lightsArray:i,shadowsArray:o,lights:n},setupLights:function(e){n.setup(i,e)},setupLightsView:function(e){n.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){o.push(e)}}}function Ds(e,t){let n=new WeakMap;return{get:function(i){let o,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return!1===n.has(i)?(o=new Us(e,t),n.set(i,[o])):r>=n.get(i).length?(o=new Us(e,t),n.get(i).push(o)):o=n.get(i)[r],o},dispose:function(){n=new WeakMap}}}class Ps extends Io{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=Kt,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}Ps.prototype.isMeshDepthMaterial=!0;class Qs extends Io{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new jn,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}Qs.prototype.isMeshDistanceMaterial=!0;const _s="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",js="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function Os(e,t,n){let i=new pr;const o=new Wn,r=new Wn,a=new Un,s=new Ps({depthPacking:Nt}),g=new Qs,l={},c=n.maxTextureSize,C={0:h,1:d,2:A},p=new or({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Wn},radius:{value:4}},vertexShader:_s,fragmentShader:js}),m=p.clone();m.defines.HORIZONTAL_PASS=1;const f=new Yo;f.setAttribute("position",new Ao(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const y=new qo(f,p),G=this;function v(n,i){const o=t.update(y);p.defines.VSM_SAMPLES!==n.blurSamples&&(p.defines.VSM_SAMPLES=n.blurSamples,m.defines.VSM_SAMPLES=n.blurSamples,p.needsUpdate=!0,m.needsUpdate=!0),p.uniforms.shadow_pass.value=n.map.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,o,p,y,null),m.uniforms.shadow_pass.value=n.mapPass.texture,m.uniforms.resolution.value=n.mapSize,m.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,o,m,y,null)}function B(t,n,i,o,r,a,c){let I=null;const d=!0===o.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(I=void 0!==d?d:!0===o.isPointLight?g:s,e.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0){const e=I.uuid,t=i.uuid;let n=l[e];void 0===n&&(n={},l[e]=n);let o=n[t];void 0===o&&(o=I.clone(),n[t]=o),I=o}return I.visible=i.visible,I.wireframe=i.wireframe,I.side=c===u?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:C[i.side],I.alphaMap=i.alphaMap,I.alphaTest=i.alphaTest,I.clipShadows=i.clipShadows,I.clippingPlanes=i.clippingPlanes,I.clipIntersection=i.clipIntersection,I.displacementMap=i.displacementMap,I.displacementScale=i.displacementScale,I.displacementBias=i.displacementBias,I.wireframeLinewidth=i.wireframeLinewidth,I.linewidth=i.linewidth,!0===o.isPointLight&&!0===I.isMeshDistanceMaterial&&(I.referencePosition.setFromMatrixPosition(o.matrixWorld),I.nearDistance=r,I.farDistance=a),I}function Z(n,o,r,a,s){if(!1===n.visible)return;if(n.layers.test(o.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&s===u)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,n.matrixWorld);const i=t.update(n),o=n.material;if(Array.isArray(o)){const t=i.groups;for(let g=0,l=t.length;g<l;g++){const l=t[g],c=o[l.materialIndex];if(c&&c.visible){const t=B(n,0,c,a,r.near,r.far,s);e.renderBufferDirect(r,null,i,t,n,l)}}}else if(o.visible){const t=B(n,0,o,a,r.near,r.far,s);e.renderBufferDirect(r,null,i,t,n,null)}}const g=n.children;for(let e=0,t=g.length;e<t;e++)Z(g[e],o,r,a,s)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=I,this.render=function(t,n,s){if(!1===G.enabled)return;if(!1===G.autoUpdate&&!1===G.needsUpdate)return;if(0===t.length)return;const g=e.getRenderTarget(),l=e.getActiveCubeFace(),I=e.getActiveMipmapLevel(),C=e.state;C.setBlending(b),C.buffers.color.setClear(1,1,1,1),C.buffers.depth.setTest(!0),C.setScissorTest(!1);for(let d=0,h=t.length;d<h;d++){const g=t[d],l=g.shadow;if(void 0===l){console.warn("THREE.WebGLShadowMap:",g,"has no shadow.");continue}if(!1===l.autoUpdate&&!1===l.needsUpdate)continue;o.copy(l.mapSize);const I=l.getFrameExtents();if(o.multiply(I),r.copy(l.mapSize),(o.x>c||o.y>c)&&(o.x>c&&(r.x=Math.floor(c/I.x),o.x=r.x*I.x,l.mapSize.x=r.x),o.y>c&&(r.y=Math.floor(c/I.y),o.y=r.y*I.y,l.mapSize.y=r.y)),null===l.map&&!l.isPointLightShadow&&this.type===u){const e={minFilter:be,magFilter:be,format:Me};l.map=new Dn(o.x,o.y,e),l.map.texture.name=g.name+".shadowMap",l.mapPass=new Dn(o.x,o.y,e),l.camera.updateProjectionMatrix()}if(null===l.map){const e={minFilter:de,magFilter:de,format:Me};l.map=new Dn(o.x,o.y,e),l.map.texture.name=g.name+".shadowMap",l.camera.updateProjectionMatrix()}e.setRenderTarget(l.map),e.clear();const h=l.getViewportCount();for(let e=0;e<h;e++){const t=l.getViewport(e);a.set(r.x*t.x,r.y*t.y,r.x*t.z,r.y*t.w),C.viewport(a),l.updateMatrices(g,e),i=l.getFrustum(),Z(n,s,l.camera,g,this.type)}l.isPointLightShadow||this.type!==u||v(l,s),l.needsUpdate=!1}G.needsUpdate=!1,e.setRenderTarget(g,l,I)}}function qs(e,t,n){const i=n.isWebGL2;const o=new function(){let t=!1;const n=new Un;let i=null;const o=new Un(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,r,a,s){!0===s&&(t*=a,i*=a,r*=a),n.set(t,i,r,a),!1===o.equals(n)&&(e.clearColor(t,i,r,a),o.copy(n))},reset:function(){t=!1,i=null,o.set(-1,0,0,0)}}},r=new function(){let t=!1,n=null,i=null,o=null;return{setTest:function(e){e?be(2929):fe(2929)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){if(t)switch(t){case L:e.depthFunc(512);break;case T:e.depthFunc(519);break;case E:e.depthFunc(513);break;case J:e.depthFunc(515);break;case U:e.depthFunc(514);break;case D:e.depthFunc(518);break;case P:e.depthFunc(516);break;case Q:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);i=t}},setLocked:function(e){t=e},setClear:function(t){o!==t&&(e.clearDepth(t),o=t)},reset:function(){t=!1,n=null,i=null,o=null}}},l=new function(){let t=!1,n=null,i=null,o=null,r=null,a=null,s=null,g=null,l=null;return{setTest:function(e){t||(e?be(2960):fe(2960))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,a){i===t&&o===n&&r===a||(e.stencilFunc(t,n,a),i=t,o=n,r=a)},setOp:function(t,n,i){a===t&&s===n&&g===i||(e.stencilOp(t,n,i),a=t,s=n,g=i)},setLocked:function(e){t=e},setClear:function(t){l!==t&&(e.clearStencil(t),l=t)},reset:function(){t=!1,n=null,i=null,o=null,r=null,a=null,s=null,g=null,l=null}}};let c={},I={},C=new WeakMap,u=[],d=null,p=!1,m=null,_=null,j=null,O=null,q=null,$=null,ee=null,te=!1,ne=null,ie=null,oe=null,re=null,ae=null;const se=e.getParameter(35661);let ge=!1,le=0;const ce=e.getParameter(7938);-1!==ce.indexOf("WebGL")?(le=parseFloat(/^WebGL (\d)/.exec(ce)[1]),ge=le>=1):-1!==ce.indexOf("OpenGL ES")&&(le=parseFloat(/^OpenGL ES (\d)/.exec(ce)[1]),ge=le>=2);let Ie=null,Ce={};const ue=e.getParameter(3088),de=e.getParameter(2978),he=(new Un).fromArray(ue),Ae=(new Un).fromArray(de);function pe(t,n,i){const o=new Uint8Array(4),r=e.createTexture();e.bindTexture(t,r),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let a=0;a<i;a++)e.texImage2D(n+a,0,6408,1,1,0,6408,5121,o);return r}const me={};function be(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function fe(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}me[3553]=pe(3553,3553,1),me[34067]=pe(34067,34069,6),o.setClear(0,0,0,1),r.setClear(1),l.setClear(0),be(2929),r.setFunc(J),Be(!1),Ze(s),be(2884),ve(b);const ye={[Z]:32774,[w]:32778,[W]:32779};if(i)ye[S]=32775,ye[R]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(ye[S]=e.MIN_EXT,ye[R]=e.MAX_EXT)}const Ge={[x]:0,[V]:1,[X]:768,[Y]:770,[z]:776,[F]:774,[N]:772,[H]:769,[K]:771,[k]:775,[M]:773};function ve(t,n,i,o,r,a,s,g){if(t!==b){if(!1===p&&(be(3042),p=!0),t===B)r=r||n,a=a||i,s=s||o,n===_&&r===q||(e.blendEquationSeparate(ye[n],ye[r]),_=n,q=r),i===j&&o===O&&a===$&&s===ee||(e.blendFuncSeparate(Ge[i],Ge[o],Ge[a],Ge[s]),j=i,O=o,$=a,ee=s),m=t,te=null;else if(t!==m||g!==te){if(_===Z&&q===Z||(e.blendEquation(32774),_=Z,q=Z),g)switch(t){case f:e.blendFuncSeparate(1,771,1,771);break;case y:e.blendFunc(1,1);break;case G:e.blendFuncSeparate(0,769,0,1);break;case v:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case f:e.blendFuncSeparate(770,771,1,771);break;case y:e.blendFunc(770,1);break;case G:e.blendFuncSeparate(0,769,0,1);break;case v:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}j=null,O=null,$=null,ee=null,m=t,te=g}}else!0===p&&(fe(3042),p=!1)}function Be(t){ne!==t&&(t?e.frontFace(2304):e.frontFace(2305),ne=t)}function Ze(t){t!==a?(be(2884),t!==ie&&(t===s?e.cullFace(1029):t===g?e.cullFace(1028):e.cullFace(1032))):fe(2884),ie=t}function we(t,n,i){t?(be(32823),re===n&&ae===i||(e.polygonOffset(n,i),re=n,ae=i)):fe(32823)}function We(t){void 0===t&&(t=33984+se-1),Ie!==t&&(e.activeTexture(t),Ie=t)}return{buffers:{color:o,depth:r,stencil:l},enable:be,disable:fe,bindFramebuffer:function(t,n){return I[t]!==n&&(e.bindFramebuffer(t,n),I[t]=n,i&&(36009===t&&(I[36160]=n),36160===t&&(I[36009]=n)),!0)},drawBuffers:function(i,o){let r=u,a=!1;if(i)if(r=C.get(o),void 0===r&&(r=[],C.set(o,r)),i.isWebGLMultipleRenderTargets){const e=i.texture;if(r.length!==e.length||36064!==r[0]){for(let t=0,n=e.length;t<n;t++)r[t]=36064+t;r.length=e.length,a=!0}}else 36064!==r[0]&&(r[0]=36064,a=!0);else 1029!==r[0]&&(r[0]=1029,a=!0);a&&(n.isWebGL2?e.drawBuffers(r):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(r))},useProgram:function(t){return d!==t&&(e.useProgram(t),d=t,!0)},setBlending:ve,setMaterial:function(e,t){e.side===A?fe(2884):be(2884);let n=e.side===h;t&&(n=!n),Be(n),e.blending===f&&!1===e.transparent?ve(b):ve(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),r.setFunc(e.depthFunc),r.setTest(e.depthTest),r.setMask(e.depthWrite),o.setMask(e.colorWrite);const i=e.stencilWrite;l.setTest(i),i&&(l.setMask(e.stencilWriteMask),l.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),l.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),we(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?be(32926):fe(32926)},setFlipSided:Be,setCullFace:Ze,setLineWidth:function(t){t!==oe&&(ge&&e.lineWidth(t),oe=t)},setPolygonOffset:we,setScissorTest:function(e){e?be(3089):fe(3089)},activeTexture:We,bindTexture:function(t,n){null===Ie&&We();let i=Ce[Ie];void 0===i&&(i={type:void 0,texture:void 0},Ce[Ie]=i),i.type===t&&i.texture===n||(e.bindTexture(t,n||me[t]),i.type=t,i.texture=n)},unbindTexture:function(){const t=Ce[Ie];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===he.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),he.copy(t))},viewport:function(t){!1===Ae.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),Ae.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===i&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),c={},Ie=null,Ce={},I={},C=new WeakMap,u=[],d=null,p=!1,m=null,_=null,j=null,O=null,q=null,$=null,ee=null,te=!1,ne=null,ie=null,oe=null,re=null,ae=null,he.set(0,0,e.canvas.width,e.canvas.height),Ae.set(0,0,e.canvas.width,e.canvas.height),o.reset(),r.reset(),l.reset()}}}function $s(e,t,n,i,o,r,a){const s=o.isWebGL2,g=o.maxTextures,l=o.maxCubemapSize,c=o.maxTextureSize,I=o.maxSamples,C=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):void 0,u=new WeakMap;let d,h=!1;try{h="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(L){}function A(e,t){return h?new OffscreenCanvas(e,t):Xn("canvas")}function p(e,t,n,i){let o=1;if((e.width>i||e.height>i)&&(o=i/Math.max(e.width,e.height)),o<1||!0===t){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){const i=t?Zn:Math.floor,r=i(o*e.width),a=i(o*e.height);void 0===d&&(d=A(r,a));const s=n?A(r,a):d;s.width=r,s.height=a;return s.getContext("2d").drawImage(e,0,0,r,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+r+"x"+a+")."),s}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function m(e){return vn(e.width)&&vn(e.height)}function b(e,t){return e.generateMipmaps&&t&&e.minFilter!==de&&e.minFilter!==be}function f(t){e.generateMipmap(t)}function y(n,i,o,r){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!1===s)return i;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let g=i;return 6403===i&&(5126===o&&(g=33326),5131===o&&(g=33325),5121===o&&(g=33321)),33319===i&&(5126===o&&(g=33328),5131===o&&(g=33327),5121===o&&(g=33323)),6408===i&&(5126===o&&(g=34836),5131===o&&(g=34842),5121===o&&(g=r===Yt&&!1===a?35907:32856),32819===o&&(g=32854),32820===o&&(g=32855)),33325!==g&&33326!==g&&33327!==g&&33328!==g&&34842!==g&&34836!==g||t.get("EXT_color_buffer_float"),g}function G(e,t,n){return!0===b(e,n)||e.isFramebufferTexture&&e.minFilter!==de&&e.minFilter!==be?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function v(e){return e===de||e===he||e===pe?9728:9729}function B(t){const n=t.target;n.removeEventListener("dispose",B),function(t){const n=i.get(t);if(void 0===n.__webglInit)return;e.deleteTexture(n.__webglTexture),i.remove(t)}(n),n.isVideoTexture&&u.delete(n),a.memory.textures--}function Z(t){const n=t.target;n.removeEventListener("dispose",Z),function(t){const n=t.texture,o=i.get(t),r=i.get(n);if(!t)return;void 0!==r.__webglTexture&&(e.deleteTexture(r.__webglTexture),a.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let i=0;i<6;i++)e.deleteFramebuffer(o.__webglFramebuffer[i]),o.__webglDepthbuffer&&e.deleteRenderbuffer(o.__webglDepthbuffer[i]);else e.deleteFramebuffer(o.__webglFramebuffer),o.__webglDepthbuffer&&e.deleteRenderbuffer(o.__webglDepthbuffer),o.__webglMultisampledFramebuffer&&e.deleteFramebuffer(o.__webglMultisampledFramebuffer),o.__webglColorRenderbuffer&&e.deleteRenderbuffer(o.__webglColorRenderbuffer),o.__webglDepthRenderbuffer&&e.deleteRenderbuffer(o.__webglDepthRenderbuffer);if(t.isWebGLMultipleRenderTargets)for(let s=0,g=n.length;s<g;s++){const t=i.get(n[s]);t.__webglTexture&&(e.deleteTexture(t.__webglTexture),a.memory.textures--),i.remove(n[s])}i.remove(n),i.remove(t)}(n)}let w=0;function W(e,t){const o=i.get(e);if(e.isVideoTexture&&function(e){const t=a.render.frame;u.get(e)!==t&&(u.set(e,t),e.update())}(e),e.version>0&&o.__version!==e.version){const n=e.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete)return void H(o,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,o.__webglTexture)}function S(t,o){const a=i.get(t);t.version>0&&a.__version!==t.version?function(t,i,o){if(6!==i.image.length)return;X(t,i),n.activeTexture(33984+o),n.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);const a=i&&(i.isCompressedTexture||i.image[0].isCompressedTexture),g=i.image[0]&&i.image[0].isDataTexture,c=[];for(let e=0;e<6;e++)c[e]=a||g?g?i.image[e].image:i.image[e]:p(i.image[e],!1,!0,l),c[e]=F(i,c[e]);const I=c[0],C=m(I)||s,u=r.convert(i.format,i.encoding),d=r.convert(i.type),h=y(i.internalFormat,u,d,i.encoding),A=s&&!0!==i.isVideoTexture,v=void 0===t.__version;let B,Z=G(i,I,C);if(V(34067,i,C),a){A&&v&&n.texStorage2D(34067,Z,h,I.width,I.height);for(let e=0;e<6;e++){B=c[e].mipmaps;for(let t=0;t<B.length;t++){const o=B[t];i.format!==Me?null!==u?A?n.compressedTexSubImage2D(34069+e,t,0,0,o.width,o.height,u,o.data):n.compressedTexImage2D(34069+e,t,h,o.width,o.height,0,o.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):A?n.texSubImage2D(34069+e,t,0,0,o.width,o.height,u,d,o.data):n.texImage2D(34069+e,t,h,o.width,o.height,0,u,d,o.data)}}}else{B=i.mipmaps,A&&v&&(B.length>0&&Z++,n.texStorage2D(34067,Z,h,c[0].width,c[0].height));for(let e=0;e<6;e++)if(g){A?n.texSubImage2D(34069+e,0,0,0,c[e].width,c[e].height,u,d,c[e].data):n.texImage2D(34069+e,0,h,c[e].width,c[e].height,0,u,d,c[e].data);for(let t=0;t<B.length;t++){const i=B[t].image[e].image;A?n.texSubImage2D(34069+e,t+1,0,0,i.width,i.height,u,d,i.data):n.texImage2D(34069+e,t+1,h,i.width,i.height,0,u,d,i.data)}}else{A?n.texSubImage2D(34069+e,0,0,0,u,d,c[e]):n.texImage2D(34069+e,0,h,u,d,c[e]);for(let t=0;t<B.length;t++){const i=B[t];A?n.texSubImage2D(34069+e,t+1,0,0,u,d,i.image[e]):n.texImage2D(34069+e,t+1,h,u,d,i.image[e])}}}b(i,C)&&f(34067);t.__version=i.version,i.onUpdate&&i.onUpdate(i)}(a,t,o):(n.activeTexture(33984+o),n.bindTexture(34067,a.__webglTexture))}const R={[Ie]:10497,[Ce]:33071,[ue]:33648},x={[de]:9728,[he]:9984,[pe]:9986,[be]:9729,[fe]:9985,[Ge]:9987};function V(n,r,a){if(a?(e.texParameteri(n,10242,R[r.wrapS]),e.texParameteri(n,10243,R[r.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,R[r.wrapR]),e.texParameteri(n,10240,x[r.magFilter]),e.texParameteri(n,10241,x[r.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),r.wrapS===Ce&&r.wrapT===Ce||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,v(r.magFilter)),e.texParameteri(n,10241,v(r.minFilter)),r.minFilter!==de&&r.minFilter!==be&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const a=t.get("EXT_texture_filter_anisotropic");if(r.type===xe&&!1===t.has("OES_texture_float_linear"))return;if(!1===s&&r.type===Ve&&!1===t.has("OES_texture_half_float_linear"))return;(r.anisotropy>1||i.get(r).__currentAnisotropy)&&(e.texParameterf(n,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(r.anisotropy,o.getMaxAnisotropy())),i.get(r).__currentAnisotropy=r.anisotropy)}}function X(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",B),t.__webglTexture=e.createTexture(),a.memory.textures++)}function H(t,i,o){let a=3553;i.isDataTexture2DArray&&(a=35866),i.isDataTexture3D&&(a=32879),X(t,i),n.activeTexture(33984+o),n.bindTexture(a,t.__webglTexture),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);const g=function(e){return!s&&(e.wrapS!==Ce||e.wrapT!==Ce||e.minFilter!==de&&e.minFilter!==be)}(i)&&!1===m(i.image);let l=p(i.image,g,!1,c);l=F(i,l);const I=m(l)||s,C=r.convert(i.format,i.encoding);let u,d=r.convert(i.type),h=y(i.internalFormat,C,d,i.encoding,i.isVideoTexture);V(a,i,I);const A=i.mipmaps,v=s&&!0!==i.isVideoTexture,B=void 0===t.__version,Z=G(i,l,I);if(i.isDepthTexture)h=6402,s?h=i.type===xe?36012:i.type===Re?33190:i.type===Ye?35056:33189:i.type===xe&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===ze&&6402===h&&i.type!==We&&i.type!==Re&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=We,d=r.convert(i.type)),i.format===Le&&6402===h&&(h=34041,i.type!==Ye&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=Ye,d=r.convert(i.type))),v&&B?n.texStorage2D(3553,1,h,l.width,l.height):n.texImage2D(3553,0,h,l.width,l.height,0,C,d,null);else if(i.isDataTexture)if(A.length>0&&I){v&&B&&n.texStorage2D(3553,Z,h,A[0].width,A[0].height);for(let e=0,t=A.length;e<t;e++)u=A[e],v?n.texSubImage2D(3553,0,0,0,u.width,u.height,C,d,u.data):n.texImage2D(3553,e,h,u.width,u.height,0,C,d,u.data);i.generateMipmaps=!1}else v?(B&&n.texStorage2D(3553,Z,h,l.width,l.height),n.texSubImage2D(3553,0,0,0,l.width,l.height,C,d,l.data)):n.texImage2D(3553,0,h,l.width,l.height,0,C,d,l.data);else if(i.isCompressedTexture){v&&B&&n.texStorage2D(3553,Z,h,A[0].width,A[0].height);for(let e=0,t=A.length;e<t;e++)u=A[e],i.format!==Me?null!==C?v?n.compressedTexSubImage2D(3553,e,0,0,u.width,u.height,C,u.data):n.compressedTexImage2D(3553,e,h,u.width,u.height,0,u.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):v?n.texSubImage2D(3553,e,0,0,u.width,u.height,C,d,u.data):n.texImage2D(3553,e,h,u.width,u.height,0,C,d,u.data)}else if(i.isDataTexture2DArray)v?(B&&n.texStorage3D(35866,Z,h,l.width,l.height,l.depth),n.texSubImage3D(35866,0,0,0,0,l.width,l.height,l.depth,C,d,l.data)):n.texImage3D(35866,0,h,l.width,l.height,l.depth,0,C,d,l.data);else if(i.isDataTexture3D)v?(B&&n.texStorage3D(32879,Z,h,l.width,l.height,l.depth),n.texSubImage3D(32879,0,0,0,0,l.width,l.height,l.depth,C,d,l.data)):n.texImage3D(32879,0,h,l.width,l.height,l.depth,0,C,d,l.data);else if(i.isFramebufferTexture)v&&B?n.texStorage2D(3553,Z,h,l.width,l.height):n.texImage2D(3553,0,h,l.width,l.height,0,C,d,null);else if(A.length>0&&I){v&&B&&n.texStorage2D(3553,Z,h,A[0].width,A[0].height);for(let e=0,t=A.length;e<t;e++)u=A[e],v?n.texSubImage2D(3553,e,0,0,C,d,u):n.texImage2D(3553,e,h,C,d,u);i.generateMipmaps=!1}else v?(B&&n.texStorage2D(3553,Z,h,l.width,l.height),n.texSubImage2D(3553,0,0,0,C,d,l)):n.texImage2D(3553,0,h,C,d,l);b(i,I)&&f(a),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}function Y(t,o,a,s,g){const l=r.convert(a.format,a.encoding),c=r.convert(a.type),I=y(a.internalFormat,l,c,a.encoding);i.get(o).__hasExternalTextures||(32879===g||35866===g?n.texImage3D(g,0,I,o.width,o.height,o.depth,0,l,c,null):n.texImage2D(g,0,I,o.width,o.height,0,l,c,null)),n.bindFramebuffer(36160,t),o.useRenderToTexture?C.framebufferTexture2DMultisampleEXT(36160,s,g,i.get(a).__webglTexture,0,M(o)):e.framebufferTexture2D(36160,s,g,i.get(a).__webglTexture,0),n.bindFramebuffer(36160,null)}function K(t,n,i){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){let o=33189;if(i||n.useRenderToTexture){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===xe?o=36012:t.type===Re&&(o=33190));const i=M(n);n.useRenderToTexture?C.renderbufferStorageMultisampleEXT(36161,i,o,n.width,n.height):e.renderbufferStorageMultisample(36161,i,o,n.width,n.height)}else e.renderbufferStorage(36161,o,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){const o=M(n);i&&n.useRenderbuffer?e.renderbufferStorageMultisample(36161,o,35056,n.width,n.height):n.useRenderToTexture?C.renderbufferStorageMultisampleEXT(36161,o,35056,n.width,n.height):e.renderbufferStorage(36161,34041,n.width,n.height),e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,o=r.convert(t.format,t.encoding),a=r.convert(t.type),s=y(t.internalFormat,o,a,t.encoding),g=M(n);i&&n.useRenderbuffer?e.renderbufferStorageMultisample(36161,g,s,n.width,n.height):n.useRenderToTexture?C.renderbufferStorageMultisampleEXT(36161,g,s,n.width,n.height):e.renderbufferStorage(36161,s,n.width,n.height)}e.bindRenderbuffer(36161,null)}function N(t){const o=i.get(t),r=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!o.__autoAllocateDepthBuffer){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,o){if(o&&o.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,t),!o.depthTexture||!o.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(o.depthTexture).__webglTexture&&o.depthTexture.image.width===o.width&&o.depthTexture.image.height===o.height||(o.depthTexture.image.width=o.width,o.depthTexture.image.height=o.height,o.depthTexture.needsUpdate=!0),W(o.depthTexture,0);const r=i.get(o.depthTexture).__webglTexture,a=M(o);if(o.depthTexture.format===ze)o.useRenderToTexture?C.framebufferTexture2DMultisampleEXT(36160,36096,3553,r,0,a):e.framebufferTexture2D(36160,36096,3553,r,0);else{if(o.depthTexture.format!==Le)throw new Error("Unknown depthTexture format");o.useRenderToTexture?C.framebufferTexture2DMultisampleEXT(36160,33306,3553,r,0,a):e.framebufferTexture2D(36160,33306,3553,r,0)}}(o.__webglFramebuffer,t)}else if(r){o.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(36160,o.__webglFramebuffer[i]),o.__webglDepthbuffer[i]=e.createRenderbuffer(),K(o.__webglDepthbuffer[i],t,!1)}else n.bindFramebuffer(36160,o.__webglFramebuffer),o.__webglDepthbuffer=e.createRenderbuffer(),K(o.__webglDepthbuffer,t,!1);n.bindFramebuffer(36160,null)}function M(e){return s&&(e.useRenderbuffer||e.useRenderToTexture)?Math.min(I,e.samples):0}function F(e,n){const i=e.encoding,o=e.format,r=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===un||i!==Ht&&(i===Yt?!1===s?!0===t.has("EXT_sRGB")&&o===Me?(e.format=un,e.minFilter=be,e.generateMipmaps=!1):n=Ln.sRGBToLinear(n):o===Me&&r===Be||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",i)),n}let k=!1,z=!1;this.allocateTextureUnit=function(){const e=w;return e>=g&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+g),w+=1,e},this.resetTextureUnits=function(){w=0},this.setTexture2D=W,this.setTexture2DArray=function(e,t){const o=i.get(e);e.version>0&&o.__version!==e.version?H(o,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,o.__webglTexture))},this.setTexture3D=function(e,t){const o=i.get(e);e.version>0&&o.__version!==e.version?H(o,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,o.__webglTexture))},this.setTextureCube=S,this.rebindTextures=function(e,t,n){const o=i.get(e);void 0!==t&&Y(o.__webglFramebuffer,e,e.texture,36064,3553),void 0!==n&&N(e)},this.setupRenderTarget=function(t){const g=t.texture,l=i.get(t),c=i.get(g);t.addEventListener("dispose",Z),!0!==t.isWebGLMultipleRenderTargets&&(void 0===c.__webglTexture&&(c.__webglTexture=e.createTexture()),c.__version=g.version,a.memory.textures++);const I=!0===t.isWebGLCubeRenderTarget,C=!0===t.isWebGLMultipleRenderTargets,u=g.isDataTexture3D||g.isDataTexture2DArray,d=m(t)||s;if(I){l.__webglFramebuffer=[];for(let t=0;t<6;t++)l.__webglFramebuffer[t]=e.createFramebuffer()}else if(l.__webglFramebuffer=e.createFramebuffer(),C)if(o.drawBuffers){const n=t.texture;for(let t=0,o=n.length;t<o;t++){const o=i.get(n[t]);void 0===o.__webglTexture&&(o.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(t.useRenderbuffer)if(s){l.__webglMultisampledFramebuffer=e.createFramebuffer(),l.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,l.__webglColorRenderbuffer);const i=r.convert(g.format,g.encoding),o=r.convert(g.type),a=y(g.internalFormat,i,o,g.encoding),s=M(t);e.renderbufferStorageMultisample(36161,s,a,t.width,t.height),n.bindFramebuffer(36160,l.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,l.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(l.__webglDepthRenderbuffer=e.createRenderbuffer(),K(l.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(I){n.bindTexture(34067,c.__webglTexture),V(34067,g,d);for(let e=0;e<6;e++)Y(l.__webglFramebuffer[e],t,g,36064,34069+e);b(g,d)&&f(34067),n.unbindTexture()}else if(C){const e=t.texture;for(let o=0,r=e.length;o<r;o++){const r=e[o],a=i.get(r);n.bindTexture(3553,a.__webglTexture),V(3553,r,d),Y(l.__webglFramebuffer,t,r,36064+o,3553),b(r,d)&&f(3553)}n.unbindTexture()}else{let e=3553;if(u)if(s){e=g.isDataTexture3D?32879:35866}else console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.");n.bindTexture(e,c.__webglTexture),V(e,g,d),Y(l.__webglFramebuffer,t,g,36064,e),b(g,d)&&f(e),n.unbindTexture()}t.depthBuffer&&N(t)},this.updateRenderTargetMipmap=function(e){const t=m(e)||s,o=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let r=0,a=o.length;r<a;r++){const a=o[r];if(b(a,t)){const t=e.isWebGLCubeRenderTarget?34067:3553,o=i.get(a).__webglTexture;n.bindTexture(t,o),f(t),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.useRenderbuffer)if(s){const o=t.width,r=t.height;let a=16384;const s=[36064],g=t.stencilBuffer?33306:36096;t.depthBuffer&&s.push(g),t.ignoreDepthForMultisampleCopy||(t.depthBuffer&&(a|=256),t.stencilBuffer&&(a|=1024));const l=i.get(t);n.bindFramebuffer(36008,l.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,l.__webglFramebuffer),t.ignoreDepthForMultisampleCopy&&(e.invalidateFramebuffer(36008,[g]),e.invalidateFramebuffer(36009,[g])),e.blitFramebuffer(0,0,o,r,0,0,o,r,a,9728),e.invalidateFramebuffer(36008,s),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,l.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.setupDepthRenderbuffer=N,this.setupFrameBufferTexture=Y,this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===k&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),k=!0),e=e.texture),W(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===z&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),z=!0),e=e.texture),S(e,t)}}function eg(e,t,n){const i=n.isWebGL2;return{convert:function(e){let n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e===Be)return 5121;if(e===Xe)return 32819;if(e===He)return 32820;if(e===Ze)return 5120;if(e===we)return 5122;if(e===We)return 5123;if(e===Se)return 5124;if(e===Re)return 5125;if(e===xe)return 5126;if(e===Ve)return i?5131:(n=t.get("OES_texture_half_float"),null!==n?n.HALF_FLOAT_OES:null);if(e===Ke)return 6406;if(e===Me)return 6408;if(e===Fe)return 6409;if(e===ke)return 6410;if(e===ze)return 6402;if(e===Le)return 34041;if(e===Te)return 6403;if(e===Ne)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(e===un)return n=t.get("EXT_sRGB"),null!==n?n.SRGB_ALPHA_EXT:null;if(e===Ee)return 36244;if(e===Je)return 33319;if(e===Ue)return 33320;if(e===De)return 36249;if(e===Pe||e===Qe||e===_e||e===je)if(o===Yt){if(n=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===n)return null;if(e===Pe)return n.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===Qe)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===_e)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===je)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(n=t.get("WEBGL_compressed_texture_s3tc"),null===n)return null;if(e===Pe)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Qe)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===_e)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===je)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===Oe||e===qe||e===$e||e===et){if(n=t.get("WEBGL_compressed_texture_pvrtc"),null===n)return null;if(e===Oe)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===qe)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===$e)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===et)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===tt)return n=t.get("WEBGL_compressed_texture_etc1"),null!==n?n.COMPRESSED_RGB_ETC1_WEBGL:null;if(e===nt||e===it){if(n=t.get("WEBGL_compressed_texture_etc"),null===n)return null;if(e===nt)return o===Yt?n.COMPRESSED_SRGB8_ETC2:n.COMPRESSED_RGB8_ETC2;if(e===it)return o===Yt?n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:n.COMPRESSED_RGBA8_ETC2_EAC}if(e===ot||e===rt||e===at||e===st||e===gt||e===lt||e===ct||e===It||e===Ct||e===ut||e===dt||e===ht||e===At||e===pt){if(n=t.get("WEBGL_compressed_texture_astc"),null===n)return null;if(e===ot)return o===Yt?n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:n.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===rt)return o===Yt?n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:n.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===at)return o===Yt?n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:n.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===st)return o===Yt?n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:n.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===gt)return o===Yt?n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:n.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===lt)return o===Yt?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:n.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===ct)return o===Yt?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:n.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===It)return o===Yt?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:n.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===Ct)return o===Yt?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:n.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===ut)return o===Yt?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:n.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===dt)return o===Yt?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:n.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===ht)return o===Yt?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:n.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===At)return o===Yt?n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:n.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===pt)return o===Yt?n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:n.COMPRESSED_RGBA_ASTC_12x12_KHR}if(e===mt){if(n=t.get("EXT_texture_compression_bptc"),null===n)return null;if(e===mt)return o===Yt?n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:n.COMPRESSED_RGBA_BPTC_UNORM_EXT}return e===Ye?i?34042:(n=t.get("WEBGL_depth_texture"),null!==n?n.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class tg extends ar{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.cameras=e}}tg.prototype.isArrayCamera=!0;class ng extends qi{constructor(){super(),this.type="Group"}}ng.prototype.isGroup=!0;const ig={type:"move"};class og{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new ng,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new ng,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new jn,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new jn),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new ng,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new jn,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new jn),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,o=null,r=null;const a=this._targetRay,s=this._grip,g=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==a&&(i=t.getPose(e.targetRaySpace,n),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(ig))),g&&e.hand){r=!0;for(const r of e.hand.values()){const e=t.getJointPose(r,n);if(void 0===g.joints[r.jointName]){const e=new ng;e.matrixAutoUpdate=!1,e.visible=!1,g.joints[r.jointName]=e,g.add(e)}const i=g.joints[r.jointName];null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.jointRadius=e.radius),i.visible=null!==e}const i=g.joints["index-finger-tip"],o=g.joints["thumb-tip"],a=i.position.distanceTo(o.position),s=.02,l=.005;g.inputState.pinching&&a>s+l?(g.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!g.inputState.pinching&&a<=s-l&&(g.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&(o=t.getPose(e.gripSpace,n),null!==o&&(s.matrix.fromArray(o.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),o.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(o.linearVelocity)):s.hasLinearVelocity=!1,o.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(o.angularVelocity)):s.hasAngularVelocity=!1));return null!==a&&(a.visible=null!==i),null!==s&&(s.visible=null!==o),null!==g&&(g.visible=null!==r),this}}class rg extends En{constructor(e,t,n,i,o,r,a,s,g,l){if((l=void 0!==l?l:ze)!==ze&&l!==Le)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&l===ze&&(n=We),void 0===n&&l===Le&&(n=Ye),super(null,i,o,r,a,s,l,n,g),this.image={width:e,height:t},this.magFilter=void 0!==a?a:de,this.minFilter=void 0!==s?s:de,this.flipY=!1,this.generateMipmaps=!1}}rg.prototype.isDepthTexture=!0;class ag extends dn{constructor(e,t){super();const n=this;let i=null,o=1,r=null,a="local-floor";const s=e.extensions.has("WEBGL_multisampled_render_to_texture");let g=null,l=null,c=null,I=null,C=!1,u=null;const d=t.getContextAttributes();let h=null,A=null;const p=[],m=new Map,b=new ar;b.layers.enable(1),b.viewport=new Un;const f=new ar;f.layers.enable(2),f.viewport=new Un;const y=[b,f],G=new tg;G.layers.enable(1),G.layers.enable(2);let v=null,B=null;function Z(e){const t=m.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function w(){m.forEach((function(e,t){e.disconnect(t)})),m.clear(),v=null,B=null,e.setRenderTarget(h),I=null,c=null,l=null,i=null,A=null,X.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function W(e){const t=i.inputSources;for(let n=0;n<p.length;n++)m.set(t[n],p[n]);for(let n=0;n<e.removed.length;n++){const t=e.removed[n],i=m.get(t);i&&(i.dispatchEvent({type:"disconnected",data:t}),m.delete(t))}for(let n=0;n<e.added.length;n++){const t=e.added[n],i=m.get(t);i&&i.dispatchEvent({type:"connected",data:t})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=p[e];return void 0===t&&(t=new og,p[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=p[e];return void 0===t&&(t=new og,p[e]=t),t.getGripSpace()},this.getHand=function(e){let t=p[e];return void 0===t&&(t=new og,p[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){o=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){a=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return r},this.getBaseLayer=function(){return null!==c?c:I},this.getBinding=function(){return l},this.getFrame=function(){return u},this.getSession=function(){return i},this.setSession=async function(g){if(i=g,null!==i){if(h=e.getRenderTarget(),i.addEventListener("select",Z),i.addEventListener("selectstart",Z),i.addEventListener("selectend",Z),i.addEventListener("squeeze",Z),i.addEventListener("squeezestart",Z),i.addEventListener("squeezeend",Z),i.addEventListener("end",w),i.addEventListener("inputsourceschange",W),!0!==d.xrCompatible&&await t.makeXRCompatible(),void 0===i.renderState.layers||!1===e.capabilities.isWebGL2){const n={antialias:void 0!==i.renderState.layers||d.antialias,alpha:d.alpha,depth:d.depth,stencil:d.stencil,framebufferScaleFactor:o};I=new XRWebGLLayer(i,t,n),i.updateRenderState({baseLayer:I}),A=new Dn(I.framebufferWidth,I.framebufferHeight,{format:Me,type:Be,encoding:e.outputEncoding})}else{C=d.antialias;let n=null,r=null,a=null;d.depth&&(a=d.stencil?35056:33190,n=d.stencil?Le:ze,r=d.stencil?Ye:We);const g={colorFormat:e.outputEncoding===Yt?35907:32856,depthFormat:a,scaleFactor:o};l=new XRWebGLBinding(i,t),c=l.createProjectionLayer(g),i.updateRenderState({layers:[c]}),A=C?new Qn(c.textureWidth,c.textureHeight,{format:Me,type:Be,depthTexture:new rg(c.textureWidth,c.textureHeight,r,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:d.stencil,ignoreDepth:c.ignoreDepthValues,useRenderToTexture:s,encoding:e.outputEncoding}):new Dn(c.textureWidth,c.textureHeight,{format:Me,type:Be,depthTexture:new rg(c.textureWidth,c.textureHeight,r,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:d.stencil,ignoreDepth:c.ignoreDepthValues,encoding:e.outputEncoding})}A.isXRRenderTarget=!0,this.setFoveation(1),r=await i.requestReferenceSpace(a),X.setContext(i),X.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const S=new jn,R=new jn;function x(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===i)return;G.near=f.near=b.near=e.near,G.far=f.far=b.far=e.far,v===G.near&&B===G.far||(i.updateRenderState({depthNear:G.near,depthFar:G.far}),v=G.near,B=G.far);const t=e.parent,n=G.cameras;x(G,t);for(let i=0;i<n.length;i++)x(n[i],t);G.matrixWorld.decompose(G.position,G.quaternion,G.scale),e.position.copy(G.position),e.quaternion.copy(G.quaternion),e.scale.copy(G.scale),e.matrix.copy(G.matrix),e.matrixWorld.copy(G.matrixWorld);const o=e.children;for(let i=0,r=o.length;i<r;i++)o[i].updateMatrixWorld(!0);2===n.length?function(e,t,n){S.setFromMatrixPosition(t.matrixWorld),R.setFromMatrixPosition(n.matrixWorld);const i=S.distanceTo(R),o=t.projectionMatrix.elements,r=n.projectionMatrix.elements,a=o[14]/(o[10]-1),s=o[14]/(o[10]+1),g=(o[9]+1)/o[5],l=(o[9]-1)/o[5],c=(o[8]-1)/o[0],I=(r[8]+1)/r[0],C=a*c,u=a*I,d=i/(-c+I),h=d*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(h),e.translateZ(d),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const A=a+d,p=s+d,m=C-h,b=u+(i-h),f=g*s/p*A,y=l*s/p*A;e.projectionMatrix.makePerspective(m,b,f,y,A,p)}(G,b,f):G.projectionMatrix.copy(b.projectionMatrix)},this.getCamera=function(){return G},this.getFoveation=function(){return null!==c?c.fixedFoveation:null!==I?I.fixedFoveation:void 0},this.setFoveation=function(e){null!==c&&(c.fixedFoveation=e),null!==I&&void 0!==I.fixedFoveation&&(I.fixedFoveation=e)};let V=null;const X=new mr;X.setAnimationLoop((function(t,n){if(g=n.getViewerPose(r),u=n,null!==g){const t=g.views;null!==I&&(e.setRenderTargetFramebuffer(A,I.framebuffer),e.setRenderTarget(A));let n=!1;t.length!==G.cameras.length&&(G.cameras.length=0,n=!0);for(let i=0;i<t.length;i++){const o=t[i];let r=null;if(null!==I)r=I.getViewport(o);else{const t=l.getViewSubImage(c,o);r=t.viewport,0===i&&(e.setRenderTargetTextures(A,t.colorTexture,c.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(A))}const a=y[i];a.matrix.fromArray(o.transform.matrix),a.projectionMatrix.fromArray(o.projectionMatrix),a.viewport.set(r.x,r.y,r.width,r.height),0===i&&G.matrix.copy(a.matrix),!0===n&&G.cameras.push(a)}}const o=i.inputSources;for(let e=0;e<p.length;e++){const t=p[e],i=o[e];t.update(i,n,r)}V&&V(t,n),u=null})),this.setAnimationLoop=function(e){V=e},this.dispose=function(){}}}function sg(e){function t(t,n){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap),n.alphaTest>0&&(t.alphaTest.value=n.alphaTest);const i=e.get(n).envMap;let o,r;i&&(t.envMap.value=i,t.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,t.reflectivity.value=n.reflectivity,t.ior.value=n.ior,t.refractionRatio.value=n.refractionRatio),n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?o=n.map:n.specularMap?o=n.specularMap:n.displacementMap?o=n.displacementMap:n.normalMap?o=n.normalMap:n.bumpMap?o=n.bumpMap:n.roughnessMap?o=n.roughnessMap:n.metalnessMap?o=n.metalnessMap:n.alphaMap?o=n.alphaMap:n.emissiveMap?o=n.emissiveMap:n.clearcoatMap?o=n.clearcoatMap:n.clearcoatNormalMap?o=n.clearcoatNormalMap:n.clearcoatRoughnessMap?o=n.clearcoatRoughnessMap:n.specularIntensityMap?o=n.specularIntensityMap:n.specularColorMap?o=n.specularColorMap:n.transmissionMap?o=n.transmissionMap:n.thicknessMap?o=n.thicknessMap:n.sheenColorMap?o=n.sheenColorMap:n.sheenRoughnessMap&&(o=n.sheenRoughnessMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),t.uvTransform.value.copy(o.matrix)),n.aoMap?r=n.aoMap:n.lightMap&&(r=n.lightMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uv2Transform.value.copy(r.matrix))}function n(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,n.side===h&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),n.side===h&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias);e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,i,o,r,a){i.isMeshBasicMaterial?t(e,i):i.isMeshLambertMaterial?(t(e,i),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,i)):i.isMeshToonMaterial?(t(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===h&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===h&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshPhongMaterial?(t(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===h&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===h&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshStandardMaterial?(t(e,i),i.isMeshPhysicalMaterial?function(e,t,i){n(e,t),e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===h&&e.clearcoatNormalScale.value.negate()));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap);t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,i,a):n(e,i)):i.isMeshMatcapMaterial?(t(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===h&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===h&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshDepthMaterial?(t(e,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshDistanceMaterial?(t(e,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,i)):i.isMeshNormalMaterial?(t(e,i),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===h&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===h&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,n,i){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*i,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);let o;t.map?o=t.map:t.alphaMap&&(o=t.alphaMap);void 0!==o&&(!0===o.matrixAutoUpdate&&o.updateMatrix(),e.uvTransform.value.copy(o.matrix))}(e,i,o,r):i.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);let n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function gg(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=void 0!==e.canvas?e.canvas:function(){const e=Xn("canvas");return e.style.display="block",e}(),n=void 0!==e.context?e.context:null,o=void 0!==e.alpha&&e.alpha,r=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,s=void 0!==e.antialias&&e.antialias,g=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",I=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let C=null,u=null;const p=[],m=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Ht,this.physicallyCorrectLights=!1,this.toneMapping=q,this.toneMappingExposure=1;const b=this;let f=!1,y=0,G=0,v=null,B=-1,Z=null;const w=new Un,W=new Un;let S=null,R=t.width,x=t.height,V=1,X=null,H=null;const Y=new Un(0,0,R,x),K=new Un(0,0,R,x);let N=!1;const M=new pr;let F=!1,k=!1,z=null;const L=new Wi,T=new jn,E={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function J(){return null===v?V:1}let U,D,P,Q,_,j,O,$,ee,te,ne,ie,oe,re,ae,se,ge,le,ce,Ie,ue,he,Ae,pe=n;function me(e,n){for(let i=0;i<e.length;i++){const o=e[i],r=t.getContext(o,n);if(null!==r)return r}return null}try{const e={alpha:!0,depth:r,stencil:a,antialias:s,premultipliedAlpha:g,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:I};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${i}`),t.addEventListener("webglcontextlost",ye,!1),t.addEventListener("webglcontextrestored",ve,!1),null===pe){const t=["webgl2","webgl","experimental-webgl"];if(!0===b.isWebGL1Renderer&&t.shift(),pe=me(t,e),null===pe)throw me(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===pe.getShaderPrecisionFormat&&(pe.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ke){throw console.error("THREE.WebGLRenderer: "+ke.message),ke}function be(){U=new $r(pe),D=new Wr(pe,U,e),U.init(D),he=new eg(pe,U,D),P=new qs(pe,U,D),Q=new na(pe),_=new Ns,j=new $s(pe,U,P,_,D,he,Q),O=new Rr(b),$=new qr(b),ee=new br(pe,D),Ae=new Zr(pe,U,ee,D),te=new ea(pe,ee,Q,Ae),ne=new ga(pe,te,ee,Q),ce=new sa(pe,D,j),se=new Sr(_),ie=new Ks(b,O,$,U,D,Ae,se),oe=new sg(_),re=new zs,ae=new Ds(U,D),le=new Br(b,O,P,ne,o,g),ge=new Os(b,ne,D),Ie=new wr(pe,U,Q,D),ue=new ta(pe,U,Q,D),Q.programs=ie.programs,b.capabilities=D,b.extensions=U,b.properties=_,b.renderLists=re,b.shadowMap=ge,b.state=P,b.info=Q}be();const fe=new ag(b,pe);function ye(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),f=!0}function ve(){console.log("THREE.WebGLRenderer: Context Restored."),f=!1;const e=Q.autoReset,t=ge.enabled,n=ge.autoUpdate,i=ge.needsUpdate,o=ge.type;be(),Q.autoReset=e,ge.enabled=t,ge.autoUpdate=n,ge.needsUpdate=i,ge.type=o}function Ze(e){const t=e.target;t.removeEventListener("dispose",Ze),function(e){(function(e){const t=_.get(e).programs;void 0!==t&&(t.forEach((function(e){ie.releaseProgram(e)})),e.isShaderMaterial&&ie.releaseShaderCache(e))})(e),_.remove(e)}(t)}this.xr=fe,this.getContext=function(){return pe},this.getContextAttributes=function(){return pe.getContextAttributes()},this.forceContextLoss=function(){const e=U.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=U.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return V},this.setPixelRatio=function(e){void 0!==e&&(V=e,this.setSize(R,x,!1))},this.getSize=function(e){return e.set(R,x)},this.setSize=function(e,n,i){fe.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(R=e,x=n,t.width=Math.floor(e*V),t.height=Math.floor(n*V),!1!==i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(R*V,x*V).floor()},this.setDrawingBufferSize=function(e,n,i){R=e,x=n,V=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(w)},this.getViewport=function(e){return e.copy(Y)},this.setViewport=function(e,t,n,i){e.isVector4?Y.set(e.x,e.y,e.z,e.w):Y.set(e,t,n,i),P.viewport(w.copy(Y).multiplyScalar(V).floor())},this.getScissor=function(e){return e.copy(K)},this.setScissor=function(e,t,n,i){e.isVector4?K.set(e.x,e.y,e.z,e.w):K.set(e,t,n,i),P.scissor(W.copy(K).multiplyScalar(V).floor())},this.getScissorTest=function(){return N},this.setScissorTest=function(e){P.setScissorTest(N=e)},this.setOpaqueSort=function(e){X=e},this.setTransparentSort=function(e){H=e},this.getClearColor=function(e){return e.copy(le.getClearColor())},this.setClearColor=function(){le.setClearColor.apply(le,arguments)},this.getClearAlpha=function(){return le.getClearAlpha()},this.setClearAlpha=function(){le.setClearAlpha.apply(le,arguments)},this.clear=function(e,t,n){let i=0;(void 0===e||e)&&(i|=16384),(void 0===t||t)&&(i|=256),(void 0===n||n)&&(i|=1024),pe.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ye,!1),t.removeEventListener("webglcontextrestored",ve,!1),re.dispose(),ae.dispose(),_.dispose(),O.dispose(),$.dispose(),ne.dispose(),Ae.dispose(),ie.dispose(),fe.dispose(),fe.removeEventListener("sessionstart",We),fe.removeEventListener("sessionend",Se),z&&(z.dispose(),z=null),Re.stop()},this.renderBufferDirect=function(e,t,n,i,o,r){null===t&&(t=E);const a=o.isMesh&&o.matrixWorld.determinant()<0,s=function(e,t,n,i,o){!0!==t.isScene&&(t=E);j.resetTextureUnits();const r=t.fog,a=i.isMeshStandardMaterial?t.environment:null,s=null===v?b.outputEncoding:!0===v.isXRRenderTarget?v.texture.encoding:Ht,g=(i.isMeshStandardMaterial?$:O).get(i.envMap||a),l=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,c=!!i.normalMap&&!!n.attributes.tangent,I=!!n.morphAttributes.position,C=!!n.morphAttributes.normal,d=n.morphAttributes.position?n.morphAttributes.position.length:0,h=i.toneMapped?b.toneMapping:q,A=_.get(i),p=u.state.lights;if(!0===F&&(!0===k||e!==Z)){const t=e===Z&&i.id===B;se.setState(i,e,t)}let m=!1;i.version===A.__version?A.needsLights&&A.lightsStateVersion!==p.state.version||A.outputEncoding!==s||o.isInstancedMesh&&!1===A.instancing?m=!0:o.isInstancedMesh||!0!==A.instancing?o.isSkinnedMesh&&!1===A.skinning?m=!0:o.isSkinnedMesh||!0!==A.skinning?A.envMap!==g||i.fog&&A.fog!==r?m=!0:void 0===A.numClippingPlanes||A.numClippingPlanes===se.numPlanes&&A.numIntersection===se.numIntersection?(A.vertexAlphas!==l||A.vertexTangents!==c||A.morphTargets!==I||A.morphNormals!==C||A.toneMapping!==h||!0===D.isWebGL2&&A.morphTargetsCount!==d)&&(m=!0):m=!0:m=!0:m=!0:(m=!0,A.__version=i.version);let f=A.currentProgram;!0===m&&(f=Ne(i,t,o));let y=!1,G=!1,w=!1;const W=f.getUniforms(),S=A.uniforms;P.useProgram(f.program)&&(y=!0,G=!0,w=!0);i.id!==B&&(B=i.id,G=!0);if(y||Z!==e){if(W.setValue(pe,"projectionMatrix",e.projectionMatrix),D.logarithmicDepthBuffer&&W.setValue(pe,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),Z!==e&&(Z=e,G=!0,w=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const t=W.map.cameraPosition;void 0!==t&&t.setValue(pe,T.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&W.setValue(pe,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||o.isSkinnedMesh)&&W.setValue(pe,"viewMatrix",e.matrixWorldInverse)}if(o.isSkinnedMesh){W.setOptional(pe,o,"bindMatrix"),W.setOptional(pe,o,"bindMatrixInverse");const e=o.skeleton;e&&(D.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),W.setValue(pe,"boneTexture",e.boneTexture,j),W.setValue(pe,"boneTextureSize",e.boneTextureSize)):W.setOptional(pe,e,"boneMatrices"))}!n||void 0===n.morphAttributes.position&&void 0===n.morphAttributes.normal||ce.update(o,n,i,f);(G||A.receiveShadow!==o.receiveShadow)&&(A.receiveShadow=o.receiveShadow,W.setValue(pe,"receiveShadow",o.receiveShadow));G&&(W.setValue(pe,"toneMappingExposure",b.toneMappingExposure),A.needsLights&&(X=w,(R=S).ambientLightColor.needsUpdate=X,R.lightProbe.needsUpdate=X,R.directionalLights.needsUpdate=X,R.directionalLightShadows.needsUpdate=X,R.pointLights.needsUpdate=X,R.pointLightShadows.needsUpdate=X,R.spotLights.needsUpdate=X,R.spotLightShadows.needsUpdate=X,R.rectAreaLights.needsUpdate=X,R.hemisphereLights.needsUpdate=X),r&&i.fog&&oe.refreshFogUniforms(S,r),oe.refreshMaterialUniforms(S,i,V,x,z),us.upload(pe,A.uniformsList,S,j));var R,X;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(us.upload(pe,A.uniformsList,S,j),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&W.setValue(pe,"center",o.center);return W.setValue(pe,"modelViewMatrix",o.modelViewMatrix),W.setValue(pe,"normalMatrix",o.normalMatrix),W.setValue(pe,"modelMatrix",o.matrixWorld),f}(e,t,n,i,o);P.setMaterial(i,a);let g=n.index;const l=n.attributes.position;if(null===g){if(void 0===l||0===l.count)return}else if(0===g.count)return;let c,I=1;!0===i.wireframe&&(g=te.getWireframeAttribute(n),I=2),Ae.setup(o,i,s,n,g);let C=Ie;null!==g&&(c=ee.get(g),C=ue,C.setIndex(c));const d=null!==g?g.count:l.count,h=n.drawRange.start*I,A=n.drawRange.count*I,p=null!==r?r.start*I:0,m=null!==r?r.count*I:1/0,f=Math.max(h,p),y=Math.min(d,h+A,p+m)-1,G=Math.max(0,y-f+1);if(0!==G){if(o.isMesh)!0===i.wireframe?(P.setLineWidth(i.wireframeLinewidth*J()),C.setMode(1)):C.setMode(4);else if(o.isLine){let e=i.linewidth;void 0===e&&(e=1),P.setLineWidth(e*J()),o.isLineSegments?C.setMode(1):o.isLineLoop?C.setMode(2):C.setMode(3)}else o.isPoints?C.setMode(0):o.isSprite&&C.setMode(4);if(o.isInstancedMesh)C.renderInstances(f,G,o.count);else if(n.isInstancedBufferGeometry){const e=Math.min(n.instanceCount,n._maxInstanceCount);C.renderInstances(f,G,e)}else C.render(f,G)}},this.compile=function(e,t){u=ae.get(e),u.init(),m.push(u),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(u.pushLight(e),e.castShadow&&u.pushShadow(e))})),u.setupLights(b.physicallyCorrectLights),e.traverse((function(t){const n=t.material;if(n)if(Array.isArray(n))for(let i=0;i<n.length;i++){Ne(n[i],e,t)}else Ne(n,e,t)})),m.pop(),u=null};let we=null;function We(){Re.stop()}function Se(){Re.start()}const Re=new mr;function Xe(e,t,n,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)u.pushLight(e),e.castShadow&&u.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||M.intersectsSprite(e)){i&&T.setFromMatrixPosition(e.matrixWorld).applyMatrix4(L);const t=ne.update(e),o=e.material;o.visible&&C.push(e,t,o,n,T.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==Q.render.frame&&(e.skeleton.update(),e.skeleton.frame=Q.render.frame),!e.frustumCulled||M.intersectsObject(e))){i&&T.setFromMatrixPosition(e.matrixWorld).applyMatrix4(L);const t=ne.update(e),o=e.material;if(Array.isArray(o)){const i=t.groups;for(let r=0,a=i.length;r<a;r++){const a=i[r],s=o[a.materialIndex];s&&s.visible&&C.push(e,t,s,n,T.z,a)}}else o.visible&&C.push(e,t,o,n,T.z,null)}const o=e.children;for(let r=0,a=o.length;r<a;r++)Xe(o[r],t,n,i)}function He(e,t,n,i){const o=e.opaque,r=e.transmissive,a=e.transparent;u.setupLightsView(n),r.length>0&&function(e,t,n){if(null===z){const e=!0===s&&!0===D.isWebGL2;z=new(e?Qn:Dn)(1024,1024,{generateMipmaps:!0,type:null!==he.convert(Ve)?Ve:Be,minFilter:Ge,magFilter:de,wrapS:Ce,wrapT:Ce,useRenderToTexture:U.has("WEBGL_multisampled_render_to_texture")})}const i=b.getRenderTarget();b.setRenderTarget(z),b.clear();const o=b.toneMapping;b.toneMapping=q,Ye(e,t,n),b.toneMapping=o,j.updateMultisampleRenderTarget(z),j.updateRenderTargetMipmap(z),b.setRenderTarget(i)}(o,t,n),i&&P.viewport(w.copy(i)),o.length>0&&Ye(o,t,n),r.length>0&&Ye(r,t,n),a.length>0&&Ye(a,t,n)}function Ye(e,t,n){const i=!0===t.isScene?t.overrideMaterial:null;for(let o=0,r=e.length;o<r;o++){const r=e[o],a=r.object,s=r.geometry,g=null===i?r.material:i,l=r.group;a.layers.test(n.layers)&&Ke(a,t,n,s,g,l)}}function Ke(e,t,n,i,o,r){e.onBeforeRender(b,t,n,i,o,r),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),o.onBeforeRender(b,t,n,i,e,r),!0===o.transparent&&o.side===A?(o.side=h,o.needsUpdate=!0,b.renderBufferDirect(n,t,i,o,e,r),o.side=d,o.needsUpdate=!0,b.renderBufferDirect(n,t,i,o,e,r),o.side=A):b.renderBufferDirect(n,t,i,o,e,r),e.onAfterRender(b,t,n,i,o,r)}function Ne(e,t,n){!0!==t.isScene&&(t=E);const i=_.get(e),o=u.state.lights,r=u.state.shadowsArray,a=o.state.version,s=ie.getParameters(e,o.state,r,t,n),g=ie.getProgramCacheKey(s);let l=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?$:O).get(e.envMap||i.environment),void 0===l&&(e.addEventListener("dispose",Ze),l=new Map,i.programs=l);let c=l.get(g);if(void 0!==c){if(i.currentProgram===c&&i.lightsStateVersion===a)return Fe(e,s),c}else s.uniforms=ie.getUniforms(e),e.onBuild(n,s,b),e.onBeforeCompile(s,b),c=ie.acquireProgram(s,g),l.set(g,c),i.uniforms=s.uniforms;const I=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(I.clippingPlanes=se.uniform),Fe(e,s),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=a,i.needsLights&&(I.ambientLightColor.value=o.state.ambient,I.lightProbe.value=o.state.probe,I.directionalLights.value=o.state.directional,I.directionalLightShadows.value=o.state.directionalShadow,I.spotLights.value=o.state.spot,I.spotLightShadows.value=o.state.spotShadow,I.rectAreaLights.value=o.state.rectArea,I.ltc_1.value=o.state.rectAreaLTC1,I.ltc_2.value=o.state.rectAreaLTC2,I.pointLights.value=o.state.point,I.pointLightShadows.value=o.state.pointShadow,I.hemisphereLights.value=o.state.hemi,I.directionalShadowMap.value=o.state.directionalShadowMap,I.directionalShadowMatrix.value=o.state.directionalShadowMatrix,I.spotShadowMap.value=o.state.spotShadowMap,I.spotShadowMatrix.value=o.state.spotShadowMatrix,I.pointShadowMap.value=o.state.pointShadowMap,I.pointShadowMatrix.value=o.state.pointShadowMatrix);const C=c.getUniforms(),d=us.seqWithValue(C.seq,I);return i.currentProgram=c,i.uniformsList=d,c}function Fe(e,t){const n=_.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Re.setAnimationLoop((function(e){we&&we(e)})),"undefined"!==typeof window&&Re.setContext(window),this.setAnimationLoop=function(e){we=e,fe.setAnimationLoop(e),null===e?Re.stop():Re.start()},fe.addEventListener("sessionstart",We),fe.addEventListener("sessionend",Se),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===f)return;!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===fe.enabled&&!0===fe.isPresenting&&(!0===fe.cameraAutoUpdate&&fe.updateCamera(t),t=fe.getCamera()),!0===e.isScene&&e.onBeforeRender(b,e,t,v),u=ae.get(e,m.length),u.init(),m.push(u),L.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),M.setFromProjectionMatrix(L),k=this.localClippingEnabled,F=se.init(this.clippingPlanes,k,t),C=re.get(e,p.length),C.init(),p.push(C),Xe(e,t,0,b.sortObjects),C.finish(),!0===b.sortObjects&&C.sort(X,H),!0===F&&se.beginShadows();const n=u.state.shadowsArray;if(ge.render(n,e,t),!0===F&&se.endShadows(),!0===this.info.autoReset&&this.info.reset(),le.render(C,e),u.setupLights(b.physicallyCorrectLights),t.isArrayCamera){const n=t.cameras;for(let t=0,i=n.length;t<i;t++){const i=n[t];He(C,e,i,i.viewport)}}else He(C,e,t);null!==v&&(j.updateMultisampleRenderTarget(v),j.updateRenderTargetMipmap(v)),!0===e.isScene&&e.onAfterRender(b,e,t),P.buffers.depth.setTest(!0),P.buffers.depth.setMask(!0),P.buffers.color.setMask(!0),P.setPolygonOffset(!1),Ae.resetDefaultState(),B=-1,Z=null,m.pop(),u=m.length>0?m[m.length-1]:null,p.pop(),C=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return y},this.getActiveMipmapLevel=function(){return G},this.getRenderTarget=function(){return v},this.setRenderTargetTextures=function(e,t,n){_.get(e.texture).__webglTexture=t,_.get(e.depthTexture).__webglTexture=n;const i=_.get(e);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||e.useRenderToTexture&&(console.warn("render-to-texture extension was disabled because an external texture was provided"),e.useRenderToTexture=!1,e.useRenderbuffer=!0))},this.setRenderTargetFramebuffer=function(e,t){const n=_.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;v=e,y=t,G=n;let i=!0;if(e){const t=_.get(e);void 0!==t.__useDefaultFramebuffer?(P.bindFramebuffer(36160,null),i=!1):void 0===t.__webglFramebuffer?j.setupRenderTarget(e):t.__hasExternalTextures&&j.rebindTextures(e,_.get(e.texture).__webglTexture,_.get(e.depthTexture).__webglTexture)}let o=null,r=!1,a=!1;if(e){const n=e.texture;(n.isDataTexture3D||n.isDataTexture2DArray)&&(a=!0);const i=_.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(o=i[t],r=!0):o=e.useRenderbuffer?_.get(e).__webglMultisampledFramebuffer:i,w.copy(e.viewport),W.copy(e.scissor),S=e.scissorTest}else w.copy(Y).multiplyScalar(V).floor(),W.copy(K).multiplyScalar(V).floor(),S=N;if(P.bindFramebuffer(36160,o)&&D.drawBuffers&&i&&P.drawBuffers(e,o),P.viewport(w),P.scissor(W),P.setScissorTest(S),r){const i=_.get(e.texture);pe.framebufferTexture2D(36160,36064,34069+t,i.__webglTexture,n)}else if(a){const i=_.get(e.texture),o=t||0;pe.framebufferTextureLayer(36160,36064,i.__webglTexture,n||0,o)}B=-1},this.readRenderTargetPixels=function(e,t,n,i,o,r,a){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let s=_.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(s=s[a]),s){P.bindFramebuffer(36160,s);try{const a=e.texture,s=a.format,g=a.type;if(s!==Me&&he.convert(s)!==pe.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const l=g===Ve&&(U.has("EXT_color_buffer_half_float")||D.isWebGL2&&U.has("EXT_color_buffer_float"));if(g!==Be&&he.convert(g)!==pe.getParameter(35738)&&(g!==xe||!(D.isWebGL2||U.has("OES_texture_float")||U.has("WEBGL_color_buffer_float")))&&!l)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===pe.checkFramebufferStatus(36160)?t>=0&&t<=e.width-i&&n>=0&&n<=e.height-o&&pe.readPixels(t,n,i,o,he.convert(s),he.convert(g),r):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const e=null!==v?_.get(v).__webglFramebuffer:null;P.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!0!==t.isFramebufferTexture)return void console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");const i=Math.pow(2,-n),o=Math.floor(t.image.width*i),r=Math.floor(t.image.height*i);j.setTexture2D(t,0),pe.copyTexSubImage2D(3553,n,0,0,e.x,e.y,o,r),P.unbindTexture()},this.copyTextureToTexture=function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const o=t.image.width,r=t.image.height,a=he.convert(n.format),s=he.convert(n.type);j.setTexture2D(n,0),pe.pixelStorei(37440,n.flipY),pe.pixelStorei(37441,n.premultiplyAlpha),pe.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?pe.texSubImage2D(3553,i,e.x,e.y,o,r,a,s,t.image.data):t.isCompressedTexture?pe.compressedTexSubImage2D(3553,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,a,t.mipmaps[0].data):pe.texSubImage2D(3553,i,e.x,e.y,a,s,t.image),0===i&&n.generateMipmaps&&pe.generateMipmap(3553),P.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,i){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(b.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const r=e.max.x-e.min.x+1,a=e.max.y-e.min.y+1,s=e.max.z-e.min.z+1,g=he.convert(i.format),l=he.convert(i.type);let c;if(i.isDataTexture3D)j.setTexture3D(i,0),c=32879;else{if(!i.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");j.setTexture2DArray(i,0),c=35866}pe.pixelStorei(37440,i.flipY),pe.pixelStorei(37441,i.premultiplyAlpha),pe.pixelStorei(3317,i.unpackAlignment);const I=pe.getParameter(3314),C=pe.getParameter(32878),u=pe.getParameter(3316),d=pe.getParameter(3315),h=pe.getParameter(32877),A=n.isCompressedTexture?n.mipmaps[0]:n.image;pe.pixelStorei(3314,A.width),pe.pixelStorei(32878,A.height),pe.pixelStorei(3316,e.min.x),pe.pixelStorei(3315,e.min.y),pe.pixelStorei(32877,e.min.z),n.isDataTexture||n.isDataTexture3D?pe.texSubImage3D(c,o,t.x,t.y,t.z,r,a,s,g,l,A.data):n.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),pe.compressedTexSubImage3D(c,o,t.x,t.y,t.z,r,a,s,g,A.data)):pe.texSubImage3D(c,o,t.x,t.y,t.z,r,a,s,g,l,A),pe.pixelStorei(3314,I),pe.pixelStorei(32878,C),pe.pixelStorei(3316,u),pe.pixelStorei(3315,d),pe.pixelStorei(32877,h),0===o&&i.generateMipmaps&&pe.generateMipmap(c),P.unbindTexture()},this.initTexture=function(e){j.setTexture2D(e,0),P.unbindTexture()},this.resetState=function(){y=0,G=0,v=null,P.reset(),Ae.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}gg.prototype.isWebGLRenderer=!0;class lg extends gg{}lg.prototype.isWebGL1Renderer=!0;class cg{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25e-5;this.name="",this.color=new kn(e),this.density=t}clone(){return new cg(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}cg.prototype.isFogExp2=!0;class Ig{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;this.name="",this.color=new kn(e),this.near=t,this.far=n}clone(){return new Ig(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}Ig.prototype.isFog=!0;class Cg extends qi{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}Cg.prototype.isScene=!0;class ug{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=tn,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=bn()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,o=this.stride;i<o;i++)this.array[e+i]=t.array[n+i];return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=bn()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=bn()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}ug.prototype.isInterleavedBuffer=!0;const dg=new jn;class hg{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)dg.x=this.getX(t),dg.y=this.getY(t),dg.z=this.getZ(t),dg.applyMatrix4(e),this.setXYZ(t,dg.x,dg.y,dg.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)dg.x=this.getX(t),dg.y=this.getY(t),dg.z=this.getZ(t),dg.applyNormalMatrix(e),this.setXYZ(t,dg.x,dg.y,dg.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)dg.x=this.getX(t),dg.y=this.getY(t),dg.z=this.getZ(t),dg.transformDirection(e),this.setXYZ(t,dg.x,dg.y,dg.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,o){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=o,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new Ao(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new hg(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}hg.prototype.isInterleavedBufferAttribute=!0;class Ag extends Io{constructor(e){super(),this.type="SpriteMaterial",this.color=new kn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let pg;Ag.prototype.isSpriteMaterial=!0;const mg=new jn,bg=new jn,fg=new jn,yg=new Wn,Gg=new Wn,vg=new Wi,Bg=new jn,Zg=new jn,wg=new jn,Wg=new Wn,Sg=new Wn,Rg=new Wn;class xg extends qi{constructor(e){if(super(),this.type="Sprite",void 0===pg){pg=new Yo;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new ug(e,5);pg.setIndex([0,1,2,0,2,3]),pg.setAttribute("position",new hg(t,3,0,!1)),pg.setAttribute("uv",new hg(t,2,3,!1))}this.geometry=pg,this.material=void 0!==e?e:new Ag,this.center=new Wn(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),bg.setFromMatrixScale(this.matrixWorld),vg.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),fg.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&bg.multiplyScalar(-fg.z);const n=this.material.rotation;let i,o;0!==n&&(o=Math.cos(n),i=Math.sin(n));const r=this.center;Vg(Bg.set(-.5,-.5,0),fg,r,bg,i,o),Vg(Zg.set(.5,-.5,0),fg,r,bg,i,o),Vg(wg.set(.5,.5,0),fg,r,bg,i,o),Wg.set(0,0),Sg.set(1,0),Rg.set(1,1);let a=e.ray.intersectTriangle(Bg,Zg,wg,!1,mg);if(null===a&&(Vg(Zg.set(-.5,.5,0),fg,r,bg,i,o),Sg.set(0,1),a=e.ray.intersectTriangle(Bg,wg,Zg,!1,mg),null===a))return;const s=e.ray.origin.distanceTo(mg);s<e.near||s>e.far||t.push({distance:s,point:mg.clone(),uv:lo.getUV(mg,Bg,Zg,wg,Wg,Sg,Rg,new Wn),face:null,object:this})}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function Vg(e,t,n,i,o,r){yg.subVectors(e,n).addScalar(.5).multiply(i),void 0!==o?(Gg.x=r*yg.x-o*yg.y,Gg.y=o*yg.x+r*yg.y):Gg.copy(yg),e.copy(t),e.x+=Gg.x,e.y+=Gg.y,e.applyMatrix4(vg)}xg.prototype.isSprite=!0;const Xg=new jn,Hg=new jn;class Yg extends qi{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,i=t.length;n<i;n++){const e=t[n];this.addLevel(e.object.clone(),e.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t=Math.abs(t);const n=this.levels;let i;for(i=0;i<n.length&&!(t<n[i].distance);i++);return n.splice(i,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i&&!(e<t[n].distance);n++);return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){Xg.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(Xg);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Xg.setFromMatrixPosition(e.matrixWorld),Hg.setFromMatrixPosition(this.matrixWorld);const n=Xg.distanceTo(Hg)/e.zoom;let i,o;for(t[0].object.visible=!0,i=1,o=t.length;i<o&&n>=t[i].distance;i++)t[i-1].object.visible=!1,t[i].object.visible=!0;for(this._currentLevel=i-1;i<o;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let i=0,o=n.length;i<o;i++){const e=n[i];t.object.levels.push({object:e.object.uuid,distance:e.distance})}return t}}const Kg=new jn,Ng=new Un,Mg=new Un,Fg=new jn,kg=new Wi;class zg extends qo{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Wi,this.bindMatrixInverse=new Wi}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Un,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);const i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const n=this.skeleton,i=this.geometry;Ng.fromBufferAttribute(i.attributes.skinIndex,e),Mg.fromBufferAttribute(i.attributes.skinWeight,e),Kg.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let o=0;o<4;o++){const e=Mg.getComponent(o);if(0!==e){const i=Ng.getComponent(o);kg.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(Fg.copy(Kg).applyMatrix4(kg),e)}}return t.applyMatrix4(this.bindMatrixInverse)}}zg.prototype.isSkinnedMesh=!0;class Lg extends qi{constructor(){super(),this.type="Bone"}}Lg.prototype.isBone=!0;class Tg extends En{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:de,o=arguments.length>9&&void 0!==arguments[9]?arguments[9]:de;super(null,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,i,o,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>10?arguments[10]:void 0,arguments.length>11?arguments[11]:void 0),this.image={data:e,width:t,height:n},this.magFilter=i,this.minFilter=o,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Tg.prototype.isDataTexture=!0;const Eg=new Wi,Jg=new Wi;class Ug{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.uuid=bn(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Wi)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new Wi;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let o=0,r=e.length;o<r;o++){const i=e[o]?e[o].matrixWorld:Jg;Eg.multiplyMatrices(i,t[o]),Eg.toArray(n,16*o)}null!==i&&(i.needsUpdate=!0)}clone(){return new Ug(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=Bn(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new Tg(t,e,e,Me,xe);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const i=e.bones[n];let o=t[i];void 0===o&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),o=new Lg),this.bones.push(o),this.boneInverses.push((new Wi).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,o=t.length;i<o;i++){const o=t[i];e.bones.push(o.uuid);const r=n[i];e.boneInverses.push(r.toArray())}return e}}class Dg extends Ao{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;"number"===typeof n&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,n),this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}Dg.prototype.isInstancedBufferAttribute=!0;const Pg=new Wi,Qg=new Wi,_g=[],jg=new qo;class Og extends qo{constructor(e,t,n){super(e,t),this.instanceMatrix=new Dg(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const n=this.matrixWorld,i=this.count;if(jg.geometry=this.geometry,jg.material=this.material,void 0!==jg.material)for(let o=0;o<i;o++){this.getMatrixAt(o,Pg),Qg.multiplyMatrices(n,Pg),jg.matrixWorld=Qg,jg.raycast(e,_g);for(let e=0,n=_g.length;e<n;e++){const n=_g[e];n.instanceId=o,n.object=this,t.push(n)}_g.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Dg(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}Og.prototype.isInstancedMesh=!0;class qg extends Io{constructor(e){super(),this.type="LineBasicMaterial",this.color=new kn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}qg.prototype.isLineBasicMaterial=!0;const $g=new jn,el=new jn,tl=new Wi,nl=new wi,il=new mi;class ol extends qi{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yo,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new qg;super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)$g.fromBufferAttribute(t,e-1),el.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=$g.distanceTo(el);e.setAttribute("lineDistance",new Zo(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,o=e.params.Line.threshold,r=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),il.copy(n.boundingSphere),il.applyMatrix4(i),il.radius+=o,!1===e.ray.intersectsSphere(il))return;tl.copy(i).invert(),nl.copy(e.ray).applyMatrix4(tl);const a=o/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a,g=new jn,l=new jn,c=new jn,I=new jn,C=this.isLineSegments?2:1;if(n.isBufferGeometry){const i=n.index,o=n.attributes.position;if(null!==i){for(let n=Math.max(0,r.start),a=Math.min(i.count,r.start+r.count)-1;n<a;n+=C){const r=i.getX(n),a=i.getX(n+1);g.fromBufferAttribute(o,r),l.fromBufferAttribute(o,a);if(nl.distanceSqToSegment(g,l,I,c)>s)continue;I.applyMatrix4(this.matrixWorld);const C=e.ray.origin.distanceTo(I);C<e.near||C>e.far||t.push({distance:C,point:c.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else{for(let n=Math.max(0,r.start),i=Math.min(o.count,r.start+r.count)-1;n<i;n+=C){g.fromBufferAttribute(o,n),l.fromBufferAttribute(o,n+1);if(nl.distanceSqToSegment(g,l,I,c)>s)continue;I.applyMatrix4(this.matrixWorld);const i=e.ray.origin.distanceTo(I);i<e.near||i>e.far||t.push({distance:i,point:c.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}ol.prototype.isLine=!0;const rl=new jn,al=new jn;class sl extends ol{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)rl.fromBufferAttribute(t,e),al.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+rl.distanceTo(al);e.setAttribute("lineDistance",new Zo(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}sl.prototype.isLineSegments=!0;class gl extends ol{constructor(e,t){super(e,t),this.type="LineLoop"}}gl.prototype.isLineLoop=!0;class ll extends Io{constructor(e){super(),this.type="PointsMaterial",this.color=new kn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}ll.prototype.isPointsMaterial=!0;const cl=new Wi,Il=new wi,Cl=new mi,ul=new jn;class dl extends qi{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yo,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ll;super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,o=e.params.Points.threshold,r=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Cl.copy(n.boundingSphere),Cl.applyMatrix4(i),Cl.radius+=o,!1===e.ray.intersectsSphere(Cl))return;cl.copy(i).invert(),Il.copy(e.ray).applyMatrix4(cl);const a=o/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a;if(n.isBufferGeometry){const o=n.index,a=n.attributes.position;if(null!==o){for(let n=Math.max(0,r.start),g=Math.min(o.count,r.start+r.count);n<g;n++){const r=o.getX(n);ul.fromBufferAttribute(a,r),hl(ul,r,s,i,e,t,this)}}else{for(let n=Math.max(0,r.start),o=Math.min(a.count,r.start+r.count);n<o;n++)ul.fromBufferAttribute(a,n),hl(ul,n,s,i,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function hl(e,t,n,i,o,r,a){const s=Il.distanceSqToPoint(e);if(s<n){const n=new jn;Il.closestPointToPoint(e,n),n.applyMatrix4(i);const g=o.ray.origin.distanceTo(n);if(g<o.near||g>o.far)return;r.push({distance:g,distanceToRay:Math.sqrt(s),point:n,index:t,face:null,object:a})}}dl.prototype.isPoints=!0;class Al extends En{constructor(e,t,n,i,o,r,a,s,g){super(e,t,n,i,o,r,a,s,g),this.minFilter=void 0!==r?r:be,this.magFilter=void 0!==o?o:be,this.generateMipmaps=!1;const l=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){l.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}Al.prototype.isVideoTexture=!0;class pl extends En{constructor(e,t,n){super({width:e,height:t}),this.format=n,this.magFilter=de,this.minFilter=de,this.generateMipmaps=!1,this.needsUpdate=!0}}pl.prototype.isFramebufferTexture=!0;class ml extends En{constructor(e,t,n,i,o,r,a,s,g,l,c,I){super(null,r,a,s,g,l,i,o,c,I),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}ml.prototype.isCompressedTexture=!0;class bl extends En{constructor(e,t,n,i,o,r,a,s,g){super(e,t,n,i,o,r,a,s,g),this.needsUpdate=!0}}bl.prototype.isCanvasTexture=!0;class fl extends Yo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);const o=[],r=[],a=[],s=[],g=new jn,l=new Wn;r.push(0,0,0),a.push(0,0,1),s.push(.5,.5);for(let c=0,I=3;c<=t;c++,I+=3){const o=n+c/t*i;g.x=e*Math.cos(o),g.y=e*Math.sin(o),r.push(g.x,g.y,g.z),a.push(0,0,1),l.x=(r[I]/e+1)/2,l.y=(r[I+1]/e+1)/2,s.push(l.x,l.y)}for(let c=1;c<=t;c++)o.push(c,c+1,0);this.setIndex(o),this.setAttribute("position",new Zo(r,3)),this.setAttribute("normal",new Zo(a,3)),this.setAttribute("uv",new Zo(s,2))}static fromJSON(e){return new fl(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class yl extends Yo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:o,openEnded:r,thetaStart:a,thetaLength:s};const g=this;i=Math.floor(i),o=Math.floor(o);const l=[],c=[],I=[],C=[];let u=0;const d=[],h=n/2;let A=0;function p(n){const o=u,r=new Wn,d=new jn;let p=0;const m=!0===n?e:t,b=!0===n?1:-1;for(let e=1;e<=i;e++)c.push(0,h*b,0),I.push(0,b,0),C.push(.5,.5),u++;const f=u;for(let e=0;e<=i;e++){const t=e/i*s+a,n=Math.cos(t),o=Math.sin(t);d.x=m*o,d.y=h*b,d.z=m*n,c.push(d.x,d.y,d.z),I.push(0,b,0),r.x=.5*n+.5,r.y=.5*o*b+.5,C.push(r.x,r.y),u++}for(let e=0;e<i;e++){const t=o+e,i=f+e;!0===n?l.push(i,i+1,t):l.push(i+1,i,t),p+=3}g.addGroup(A,p,!0===n?1:2),A+=p}!function(){const r=new jn,p=new jn;let m=0;const b=(t-e)/n;for(let g=0;g<=o;g++){const l=[],A=g/o,m=A*(t-e)+e;for(let e=0;e<=i;e++){const t=e/i,o=t*s+a,g=Math.sin(o),d=Math.cos(o);p.x=m*g,p.y=-A*n+h,p.z=m*d,c.push(p.x,p.y,p.z),r.set(g,b,d).normalize(),I.push(r.x,r.y,r.z),C.push(t,1-A),l.push(u++)}d.push(l)}for(let e=0;e<i;e++)for(let t=0;t<o;t++){const n=d[t][e],i=d[t+1][e],o=d[t+1][e+1],r=d[t][e+1];l.push(n,i,r),l.push(i,o,r),m+=6}g.addGroup(A,m,0),A+=m}(),!1===r&&(e>0&&p(!0),t>0&&p(!1)),this.setIndex(l),this.setAttribute("position",new Zo(c,3)),this.setAttribute("normal",new Zo(I,3)),this.setAttribute("uv",new Zo(C,2))}static fromJSON(e){return new yl(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Gl extends yl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;super(0,e,t,n,i,o,r,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:o,thetaStart:r,thetaLength:a}}static fromJSON(e){return new Gl(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class vl extends Yo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const o=[],r=[];function a(e,t,n,i){const o=i+1,r=[];for(let a=0;a<=o;a++){r[a]=[];const i=e.clone().lerp(n,a/o),s=t.clone().lerp(n,a/o),g=o-a;for(let e=0;e<=g;e++)r[a][e]=0===e&&a===o?i:i.clone().lerp(s,e/g)}for(let a=0;a<o;a++)for(let e=0;e<2*(o-a)-1;e++){const t=Math.floor(e/2);e%2===0?(s(r[a][t+1]),s(r[a+1][t]),s(r[a][t])):(s(r[a][t+1]),s(r[a+1][t+1]),s(r[a+1][t]))}}function s(e){o.push(e.x,e.y,e.z)}function g(t,n){const i=3*t;n.x=e[i+0],n.y=e[i+1],n.z=e[i+2]}function l(e,t,n,i){i<0&&1===e.x&&(r[t]=e.x-1),0===n.x&&0===n.z&&(r[t]=i/2/Math.PI+.5)}function c(e){return Math.atan2(e.z,-e.x)}!function(e){const n=new jn,i=new jn,o=new jn;for(let r=0;r<t.length;r+=3)g(t[r+0],n),g(t[r+1],i),g(t[r+2],o),a(n,i,o,e)}(i),function(e){const t=new jn;for(let n=0;n<o.length;n+=3)t.x=o[n+0],t.y=o[n+1],t.z=o[n+2],t.normalize().multiplyScalar(e),o[n+0]=t.x,o[n+1]=t.y,o[n+2]=t.z}(n),function(){const e=new jn;for(let n=0;n<o.length;n+=3){e.x=o[n+0],e.y=o[n+1],e.z=o[n+2];const i=c(e)/2/Math.PI+.5,a=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);r.push(i,1-a)}var t;(function(){const e=new jn,t=new jn,n=new jn,i=new jn,a=new Wn,s=new Wn,g=new Wn;for(let I=0,C=0;I<o.length;I+=9,C+=6){e.set(o[I+0],o[I+1],o[I+2]),t.set(o[I+3],o[I+4],o[I+5]),n.set(o[I+6],o[I+7],o[I+8]),a.set(r[C+0],r[C+1]),s.set(r[C+2],r[C+3]),g.set(r[C+4],r[C+5]),i.copy(e).add(t).add(n).divideScalar(3);const u=c(i);l(a,C+0,e,u),l(s,C+2,t,u),l(g,C+4,n,u)}})(),function(){for(let e=0;e<r.length;e+=6){const t=r[e+0],n=r[e+2],i=r[e+4],o=Math.max(t,n,i),a=Math.min(t,n,i);o>.9&&a<.1&&(t<.2&&(r[e+0]+=1),n<.2&&(r[e+2]+=1),i<.2&&(r[e+4]+=1))}}()}(),this.setAttribute("position",new Zo(o,3)),this.setAttribute("normal",new Zo(o.slice(),3)),this.setAttribute("uv",new Zo(r,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new vl(e.vertices,e.indices,e.radius,e.details)}}class Bl extends vl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=(1+Math.sqrt(5))/2,i=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Bl(e.radius,e.detail)}}const Zl=new jn,wl=new jn,Wl=new jn,Sl=new lo;class Rl extends Yo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const n=4,i=Math.pow(10,n),o=Math.cos(pn*t),r=e.getIndex(),a=e.getAttribute("position"),s=r?r.count:a.count,g=[0,0,0],l=["a","b","c"],c=new Array(3),I={},C=[];for(let e=0;e<s;e+=3){r?(g[0]=r.getX(e),g[1]=r.getX(e+1),g[2]=r.getX(e+2)):(g[0]=e,g[1]=e+1,g[2]=e+2);const{a:t,b:n,c:s}=Sl;if(t.fromBufferAttribute(a,g[0]),n.fromBufferAttribute(a,g[1]),s.fromBufferAttribute(a,g[2]),Sl.getNormal(Wl),c[0]=`${Math.round(t.x*i)},${Math.round(t.y*i)},${Math.round(t.z*i)}`,c[1]=`${Math.round(n.x*i)},${Math.round(n.y*i)},${Math.round(n.z*i)}`,c[2]=`${Math.round(s.x*i)},${Math.round(s.y*i)},${Math.round(s.z*i)}`,c[0]!==c[1]&&c[1]!==c[2]&&c[2]!==c[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=c[e],i=c[t],r=Sl[l[e]],a=Sl[l[t]],s=`${n}_${i}`,u=`${i}_${n}`;u in I&&I[u]?(Wl.dot(I[u].normal)<=o&&(C.push(r.x,r.y,r.z),C.push(a.x,a.y,a.z)),I[u]=null):s in I||(I[s]={index0:g[e],index1:g[t],normal:Wl.clone()})}}for(const e in I)if(I[e]){const{index0:t,index1:n}=I[e];Zl.fromBufferAttribute(a,t),wl.fromBufferAttribute(a,n),C.push(Zl.x,Zl.y,Zl.z),C.push(wl.x,wl.y,wl.z)}this.setAttribute("position",new Zo(C,3))}}}class xl{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),o=0;t.push(0);for(let r=1;r<=e;r++)n=this.getPoint(r/e),o+=n.distanceTo(i),t.push(o),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let i=0;const o=n.length;let r;r=t||e*n[o-1];let a,s=0,g=o-1;for(;s<=g;)if(i=Math.floor(s+(g-s)/2),a=n[i]-r,a<0)s=i+1;else{if(!(a>0)){g=i;break}g=i-1}if(i=g,n[i]===r)return i/(o-1);const l=n[i];return(i+(r-l)/(n[i+1]-l))/(o-1)}getTangent(e,t){const n=1e-4;let i=e-n,o=e+n;i<0&&(i=0),o>1&&(o=1);const r=this.getPoint(i),a=this.getPoint(o),s=t||(r.isVector2?new Wn:new jn);return s.copy(a).sub(r).normalize(),s}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new jn,i=[],o=[],r=[],a=new jn,s=new Wi;for(let C=0;C<=e;C++){const t=C/e;i[C]=this.getTangentAt(t,new jn)}o[0]=new jn,r[0]=new jn;let g=Number.MAX_VALUE;const l=Math.abs(i[0].x),c=Math.abs(i[0].y),I=Math.abs(i[0].z);l<=g&&(g=l,n.set(1,0,0)),c<=g&&(g=c,n.set(0,1,0)),I<=g&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),o[0].crossVectors(i[0],a),r[0].crossVectors(i[0],o[0]);for(let C=1;C<=e;C++){if(o[C]=o[C-1].clone(),r[C]=r[C-1].clone(),a.crossVectors(i[C-1],i[C]),a.length()>Number.EPSILON){a.normalize();const e=Math.acos(fn(i[C-1].dot(i[C]),-1,1));o[C].applyMatrix4(s.makeRotationAxis(a,e))}r[C].crossVectors(i[C],o[C])}if(!0===t){let t=Math.acos(fn(o[0].dot(o[e]),-1,1));t/=e,i[0].dot(a.crossVectors(o[0],o[e]))>0&&(t=-t);for(let n=1;n<=e;n++)o[n].applyMatrix4(s.makeRotationAxis(i[n],t*n)),r[n].crossVectors(i[n],o[n])}return{tangents:i,normals:o,binormals:r}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Vl extends xl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=o,this.aEndAngle=r,this.aClockwise=a,this.aRotation=s}getPoint(e,t){const n=t||new Wn,i=2*Math.PI;let o=this.aEndAngle-this.aStartAngle;const r=Math.abs(o)<Number.EPSILON;for(;o<0;)o+=i;for(;o>i;)o-=i;o<Number.EPSILON&&(o=r?0:i),!0!==this.aClockwise||r||(o===i?o=-i:o-=i);const a=this.aStartAngle+e*o;let s=this.aX+this.xRadius*Math.cos(a),g=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=s-this.aX,i=g-this.aY;s=n*e-i*t+this.aX,g=n*t+i*e+this.aY}return n.set(s,g)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}Vl.prototype.isEllipseCurve=!0;class Xl extends Vl{constructor(e,t,n,i,o,r){super(e,t,n,n,i,o,r),this.type="ArcCurve"}}function Hl(){let e=0,t=0,n=0,i=0;function o(o,r,a,s){e=o,t=a,n=-3*o+3*r-2*a-s,i=2*o-2*r+a+s}return{initCatmullRom:function(e,t,n,i,r){o(t,n,r*(n-e),r*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,r,a,s){let g=(t-e)/r-(n-e)/(r+a)+(n-t)/a,l=(n-t)/a-(i-t)/(a+s)+(i-n)/s;g*=a,l*=a,o(t,n,g,l)},calc:function(o){const r=o*o;return e+t*o+n*r+i*(r*o)}}}Xl.prototype.isArcCurve=!0;const Yl=new jn,Kl=new Hl,Nl=new Hl,Ml=new Hl;class Fl extends xl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new jn,n=this.points,i=n.length,o=(i-(this.closed?0:1))*e;let r,a,s=Math.floor(o),g=o-s;this.closed?s+=s>0?0:(Math.floor(Math.abs(s)/i)+1)*i:0===g&&s===i-1&&(s=i-2,g=1),this.closed||s>0?r=n[(s-1)%i]:(Yl.subVectors(n[0],n[1]).add(n[0]),r=Yl);const l=n[s%i],c=n[(s+1)%i];if(this.closed||s+2<i?a=n[(s+2)%i]:(Yl.subVectors(n[i-1],n[i-2]).add(n[i-1]),a=Yl),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(r.distanceToSquared(l),e),n=Math.pow(l.distanceToSquared(c),e),i=Math.pow(c.distanceToSquared(a),e);n<1e-4&&(n=1),t<1e-4&&(t=n),i<1e-4&&(i=n),Kl.initNonuniformCatmullRom(r.x,l.x,c.x,a.x,t,n,i),Nl.initNonuniformCatmullRom(r.y,l.y,c.y,a.y,t,n,i),Ml.initNonuniformCatmullRom(r.z,l.z,c.z,a.z,t,n,i)}else"catmullrom"===this.curveType&&(Kl.initCatmullRom(r.x,l.x,c.x,a.x,this.tension),Nl.initCatmullRom(r.y,l.y,c.y,a.y,this.tension),Ml.initCatmullRom(r.z,l.z,c.z,a.z,this.tension));return t.set(Kl.calc(g),Nl.calc(g),Ml.calc(g)),t}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new jn).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function kl(e,t,n,i,o){const r=.5*(i-t),a=.5*(o-n),s=e*e;return(2*n-2*i+r+a)*(e*s)+(-3*n+3*i-2*r-a)*s+r*e+n}function zl(e,t,n,i){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function Ll(e,t,n,i,o){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,o)}Fl.prototype.isCatmullRomCurve3=!0;class Tl extends xl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Wn,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Wn,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Wn,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Wn;super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Wn,n=this.v0,i=this.v1,o=this.v2,r=this.v3;return t.set(Ll(e,n.x,i.x,o.x,r.x),Ll(e,n.y,i.y,o.y,r.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Tl.prototype.isCubicBezierCurve=!0;class El extends xl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new jn,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new jn,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new jn,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new jn;super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new jn,n=this.v0,i=this.v1,o=this.v2,r=this.v3;return t.set(Ll(e,n.x,i.x,o.x,r.x),Ll(e,n.y,i.y,o.y,r.y),Ll(e,n.z,i.z,o.z,r.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}El.prototype.isCubicBezierCurve3=!0;class Jl extends xl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Wn,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Wn;super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Wn;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new Wn;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Jl.prototype.isLineCurve=!0;class Ul extends xl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new jn,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new jn;super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new jn;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Dl extends xl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Wn,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Wn,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Wn;super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Wn,n=this.v0,i=this.v1,o=this.v2;return t.set(zl(e,n.x,i.x,o.x),zl(e,n.y,i.y,o.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Dl.prototype.isQuadraticBezierCurve=!0;class Pl extends xl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new jn,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new jn,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new jn;super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new jn,n=this.v0,i=this.v1,o=this.v2;return t.set(zl(e,n.x,i.x,o.x),zl(e,n.y,i.y,o.y),zl(e,n.z,i.z,o.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Pl.prototype.isQuadraticBezierCurve3=!0;class Ql extends xl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.type="SplineCurve",this.points=e}getPoint(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Wn,n=this.points,i=(n.length-1)*e,o=Math.floor(i),r=i-o,a=n[0===o?o:o-1],s=n[o],g=n[o>n.length-2?n.length-1:o+1],l=n[o>n.length-3?n.length-1:o+2];return t.set(kl(r,a.x,s.x,g.x,l.x),kl(r,a.y,s.y,g.y,l.y)),t}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new Wn).fromArray(n))}return this}}Ql.prototype.isSplineCurve=!0;var _l=Object.freeze({__proto__:null,ArcCurve:Xl,CatmullRomCurve3:Fl,CubicBezierCurve:Tl,CubicBezierCurve3:El,EllipseCurve:Vl,LineCurve:Jl,LineCurve3:Ul,QuadraticBezierCurve:Dl,QuadraticBezierCurve3:Pl,SplineCurve:Ql});class jl extends xl{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Jl(t,e))}getPoint(e,t){const n=e*this.getLength(),i=this.getCurveLengths();let o=0;for(;o<i.length;){if(i[o]>=n){const e=i[o]-n,r=this.curves[o],a=r.getLength(),s=0===a?0:1-e/a;return r.getPointAt(s,t)}o++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40;const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12;const t=[];let n;for(let i=0,o=this.curves;i<o.length;i++){const r=o[i],a=r&&r.isEllipseCurve?2*e:r&&(r.isLineCurve||r.isLineCurve3)?1:r&&r.isSplineCurve?e*r.points.length:e,s=r.getPoints(a);for(let e=0;e<s.length;e++){const i=s[e];n&&n.equals(i)||(t.push(i),n=i)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new _l[n.type]).fromJSON(n))}return this}}class Ol extends jl{constructor(e){super(),this.type="Path",this.currentPoint=new Wn,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new Jl(this.currentPoint.clone(),new Wn(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const o=new Dl(this.currentPoint.clone(),new Wn(e,t),new Wn(n,i));return this.curves.push(o),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,o,r){const a=new Tl(this.currentPoint.clone(),new Wn(e,t),new Wn(n,i),new Wn(o,r));return this.curves.push(a),this.currentPoint.set(o,r),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new Ql(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,o,r){const a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+a,t+s,n,i,o,r),this}absarc(e,t,n,i,o,r){return this.absellipse(e,t,n,n,i,o,r),this}ellipse(e,t,n,i,o,r,a,s){const g=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(e+g,t+l,n,i,o,r,a,s),this}absellipse(e,t,n,i,o,r,a,s){const g=new Vl(e,t,n,i,o,r,a,s);if(this.curves.length>0){const e=g.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(g);const l=g.getPoint(1);return this.currentPoint.copy(l),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class ql extends Ol{constructor(e){super(e),this.uuid=bn(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new Ol).fromJSON(n))}return this}}const $l=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const i=t&&t.length,o=i?t[0]*n:e.length;let r=ec(e,0,o,n,!0);const a=[];if(!r||r.next===r.prev)return a;let s,g,l,c,I,C,u;if(i&&(r=function(e,t,n,i){const o=[];let r,a,s,g,l;for(r=0,a=t.length;r<a;r++)s=t[r]*i,g=r<a-1?t[r+1]*i:e.length,l=ec(e,s,g,i,!1),l===l.next&&(l.steiner=!0),o.push(Ic(l));for(o.sort(sc),r=0;r<o.length;r++)gc(o[r],n),n=tc(n,n.next);return n}(e,t,r,n)),e.length>80*n){s=l=e[0],g=c=e[1];for(let t=n;t<o;t+=n)I=e[t],C=e[t+1],I<s&&(s=I),C<g&&(g=C),I>l&&(l=I),C>c&&(c=C);u=Math.max(l-s,c-g),u=0!==u?1/u:0}return nc(r,a,n,s,g,u),a};function ec(e,t,n,i,o){let r,a;if(o===function(e,t,n,i){let o=0;for(let r=t,a=n-i;r<n;r+=i)o+=(e[a]-e[r])*(e[r+1]+e[a+1]),a=r;return o}(e,t,n,i)>0)for(r=t;r<n;r+=i)a=yc(r,e[r],e[r+1],a);else for(r=n-i;r>=t;r-=i)a=yc(r,e[r],e[r+1],a);return a&&hc(a,a.next)&&(Gc(a),a=a.next),a}function tc(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!hc(i,i.next)&&0!==dc(i.prev,i,i.next))i=i.next;else{if(Gc(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function nc(e,t,n,i,o,r,a){if(!e)return;!a&&r&&function(e,t,n,i){let o=e;do{null===o.z&&(o.z=cc(o.x,o.y,t,n,i)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,function(e){let t,n,i,o,r,a,s,g,l=1;do{for(n=e,e=null,r=null,a=0;n;){for(a++,i=n,s=0,t=0;t<l&&(s++,i=i.nextZ,i);t++);for(g=l;s>0||g>0&&i;)0!==s&&(0===g||!i||n.z<=i.z)?(o=n,n=n.nextZ,s--):(o=i,i=i.nextZ,g--),r?r.nextZ=o:e=o,o.prevZ=r,r=o;n=i}r.nextZ=null,l*=2}while(a>1)}(o)}(e,i,o,r);let s,g,l=e;for(;e.prev!==e.next;)if(s=e.prev,g=e.next,r?oc(e,i,o,r):ic(e))t.push(s.i/n),t.push(e.i/n),t.push(g.i/n),Gc(e),e=g.next,l=g.next;else if((e=g)===l){a?1===a?nc(e=rc(tc(e),t,n),t,n,i,o,r,2):2===a&&ac(e,t,n,i,o,r):nc(tc(e),t,n,i,o,r,1);break}}function ic(e){const t=e.prev,n=e,i=e.next;if(dc(t,n,i)>=0)return!1;let o=e.next.next;for(;o!==e.prev;){if(Cc(t.x,t.y,n.x,n.y,i.x,i.y,o.x,o.y)&&dc(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function oc(e,t,n,i){const o=e.prev,r=e,a=e.next;if(dc(o,r,a)>=0)return!1;const s=o.x<r.x?o.x<a.x?o.x:a.x:r.x<a.x?r.x:a.x,g=o.y<r.y?o.y<a.y?o.y:a.y:r.y<a.y?r.y:a.y,l=o.x>r.x?o.x>a.x?o.x:a.x:r.x>a.x?r.x:a.x,c=o.y>r.y?o.y>a.y?o.y:a.y:r.y>a.y?r.y:a.y,I=cc(s,g,t,n,i),C=cc(l,c,t,n,i);let u=e.prevZ,d=e.nextZ;for(;u&&u.z>=I&&d&&d.z<=C;){if(u!==e.prev&&u!==e.next&&Cc(o.x,o.y,r.x,r.y,a.x,a.y,u.x,u.y)&&dc(u.prev,u,u.next)>=0)return!1;if(u=u.prevZ,d!==e.prev&&d!==e.next&&Cc(o.x,o.y,r.x,r.y,a.x,a.y,d.x,d.y)&&dc(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;u&&u.z>=I;){if(u!==e.prev&&u!==e.next&&Cc(o.x,o.y,r.x,r.y,a.x,a.y,u.x,u.y)&&dc(u.prev,u,u.next)>=0)return!1;u=u.prevZ}for(;d&&d.z<=C;){if(d!==e.prev&&d!==e.next&&Cc(o.x,o.y,r.x,r.y,a.x,a.y,d.x,d.y)&&dc(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function rc(e,t,n){let i=e;do{const o=i.prev,r=i.next.next;!hc(o,r)&&Ac(o,i,i.next,r)&&bc(o,r)&&bc(r,o)&&(t.push(o.i/n),t.push(i.i/n),t.push(r.i/n),Gc(i),Gc(i.next),i=e=r),i=i.next}while(i!==e);return tc(i)}function ac(e,t,n,i,o,r){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&uc(a,e)){let s=fc(a,e);return a=tc(a,a.next),s=tc(s,s.next),nc(a,t,n,i,o,r),void nc(s,t,n,i,o,r)}e=e.next}a=a.next}while(a!==e)}function sc(e,t){return e.x-t.x}function gc(e,t){if(t=function(e,t){let n=t;const i=e.x,o=e.y;let r,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){const e=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=i&&e>a){if(a=e,e===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===a)return r;const s=r,g=r.x,l=r.y;let c,I=1/0;n=r;do{i>=n.x&&n.x>=g&&i!==n.x&&Cc(o<l?i:a,o,g,l,o<l?a:i,o,n.x,n.y)&&(c=Math.abs(o-n.y)/(i-n.x),bc(n,e)&&(c<I||c===I&&(n.x>r.x||n.x===r.x&&lc(r,n)))&&(r=n,I=c)),n=n.next}while(n!==s);return r}(e,t),t){const n=fc(t,e);tc(t,t.next),tc(n,n.next)}}function lc(e,t){return dc(e.prev,e,t.prev)<0&&dc(t.next,e,e.next)<0}function cc(e,t,n,i,o){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*o)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*o)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ic(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Cc(e,t,n,i,o,r,a,s){return(o-a)*(t-s)-(e-a)*(r-s)>=0&&(e-a)*(i-s)-(n-a)*(t-s)>=0&&(n-a)*(r-s)-(o-a)*(i-s)>=0}function uc(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Ac(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(bc(e,t)&&bc(t,e)&&function(e,t){let n=e,i=!1;const o=(e.x+t.x)/2,r=(e.y+t.y)/2;do{n.y>r!==n.next.y>r&&n.next.y!==n.y&&o<(n.next.x-n.x)*(r-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(dc(e.prev,e,t.prev)||dc(e,t.prev,t))||hc(e,t)&&dc(e.prev,e,e.next)>0&&dc(t.prev,t,t.next)>0)}function dc(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function hc(e,t){return e.x===t.x&&e.y===t.y}function Ac(e,t,n,i){const o=mc(dc(e,t,n)),r=mc(dc(e,t,i)),a=mc(dc(n,i,e)),s=mc(dc(n,i,t));return o!==r&&a!==s||(!(0!==o||!pc(e,n,t))||(!(0!==r||!pc(e,i,t))||(!(0!==a||!pc(n,e,i))||!(0!==s||!pc(n,t,i)))))}function pc(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function mc(e){return e>0?1:e<0?-1:0}function bc(e,t){return dc(e.prev,e,e.next)<0?dc(e,t,e.next)>=0&&dc(e,e.prev,t)>=0:dc(e,t,e.prev)<0||dc(e,e.next,t)<0}function fc(e,t){const n=new vc(e.i,e.x,e.y),i=new vc(t.i,t.x,t.y),o=e.next,r=t.prev;return e.next=t,t.prev=e,n.next=o,o.prev=n,i.next=n,n.prev=i,r.next=i,i.prev=r,i}function yc(e,t,n,i){const o=new vc(e,t,n);return i?(o.next=i.next,o.prev=i,i.next.prev=o,i.next=o):(o.prev=o,o.next=o),o}function Gc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function vc(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Bc{static area(e){const t=e.length;let n=0;for(let i=t-1,o=0;o<t;i=o++)n+=e[i].x*e[o].y-e[o].x*e[i].y;return.5*n}static isClockWise(e){return Bc.area(e)<0}static triangulateShape(e,t){const n=[],i=[],o=[];Zc(e),wc(n,e);let r=e.length;t.forEach(Zc);for(let s=0;s<t.length;s++)i.push(r),r+=t[s].length,wc(n,t[s]);const a=$l(n,i);for(let s=0;s<a.length;s+=3)o.push(a.slice(s,s+3));return o}}function Zc(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function wc(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class Wc extends Yo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ql([new Wn(.5,.5),new Wn(-.5,.5),new Wn(-.5,-.5),new Wn(.5,-.5)]),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],o=[];for(let a=0,s=e.length;a<s;a++){r(e[a])}function r(e){const r=[],a=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1;let g=void 0!==t.depth?t.depth:1,l=void 0===t.bevelEnabled||t.bevelEnabled,c=void 0!==t.bevelThickness?t.bevelThickness:.2,I=void 0!==t.bevelSize?t.bevelSize:c-.1,C=void 0!==t.bevelOffset?t.bevelOffset:0,u=void 0!==t.bevelSegments?t.bevelSegments:3;const d=t.extrudePath,h=void 0!==t.UVGenerator?t.UVGenerator:Sc;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),g=t.amount);let A,p,m,b,f,y=!1;d&&(A=d.getSpacedPoints(s),y=!0,l=!1,p=d.computeFrenetFrames(s,!1),m=new jn,b=new jn,f=new jn),l||(u=0,c=0,I=0,C=0);const G=e.extractPoints(a);let v=G.shape;const B=G.holes;if(!Bc.isClockWise(v)){v=v.reverse();for(let e=0,t=B.length;e<t;e++){const t=B[e];Bc.isClockWise(t)&&(B[e]=t.reverse())}}const Z=Bc.triangulateShape(v,B),w=v;for(let t=0,n=B.length;t<n;t++){const e=B[t];v=v.concat(e)}function W(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}const S=v.length,R=Z.length;function x(e,t,n){let i,o,r;const a=e.x-t.x,s=e.y-t.y,g=n.x-e.x,l=n.y-e.y,c=a*a+s*s,I=a*l-s*g;if(Math.abs(I)>Number.EPSILON){const I=Math.sqrt(c),C=Math.sqrt(g*g+l*l),u=t.x-s/I,d=t.y+a/I,h=((n.x-l/C-u)*l-(n.y+g/C-d)*g)/(a*l-s*g);i=u+a*h-e.x,o=d+s*h-e.y;const A=i*i+o*o;if(A<=2)return new Wn(i,o);r=Math.sqrt(A/2)}else{let e=!1;a>Number.EPSILON?g>Number.EPSILON&&(e=!0):a<-Number.EPSILON?g<-Number.EPSILON&&(e=!0):Math.sign(s)===Math.sign(l)&&(e=!0),e?(i=-s,o=a,r=Math.sqrt(c)):(i=a,o=s,r=Math.sqrt(c/2))}return new Wn(i/r,o/r)}const V=[];for(let t=0,n=w.length,i=n-1,o=t+1;t<n;t++,i++,o++)i===n&&(i=0),o===n&&(o=0),V[t]=x(w[t],w[i],w[o]);const X=[];let H,Y=V.concat();for(let t=0,n=B.length;t<n;t++){const e=B[t];H=[];for(let t=0,n=e.length,i=n-1,o=t+1;t<n;t++,i++,o++)i===n&&(i=0),o===n&&(o=0),H[t]=x(e[t],e[i],e[o]);X.push(H),Y=Y.concat(H)}for(let t=0;t<u;t++){const e=t/u,n=c*Math.cos(e*Math.PI/2),i=I*Math.sin(e*Math.PI/2)+C;for(let t=0,o=w.length;t<o;t++){const e=W(w[t],V[t],i);M(e.x,e.y,-n)}for(let t=0,o=B.length;t<o;t++){const e=B[t];H=X[t];for(let t=0,o=e.length;t<o;t++){const o=W(e[t],H[t],i);M(o.x,o.y,-n)}}}const K=I+C;for(let t=0;t<S;t++){const e=l?W(v[t],Y[t],K):v[t];y?(b.copy(p.normals[0]).multiplyScalar(e.x),m.copy(p.binormals[0]).multiplyScalar(e.y),f.copy(A[0]).add(b).add(m),M(f.x,f.y,f.z)):M(e.x,e.y,0)}for(let t=1;t<=s;t++)for(let e=0;e<S;e++){const n=l?W(v[e],Y[e],K):v[e];y?(b.copy(p.normals[t]).multiplyScalar(n.x),m.copy(p.binormals[t]).multiplyScalar(n.y),f.copy(A[t]).add(b).add(m),M(f.x,f.y,f.z)):M(n.x,n.y,g/s*t)}for(let t=u-1;t>=0;t--){const e=t/u,n=c*Math.cos(e*Math.PI/2),i=I*Math.sin(e*Math.PI/2)+C;for(let t=0,o=w.length;t<o;t++){const e=W(w[t],V[t],i);M(e.x,e.y,g+n)}for(let t=0,o=B.length;t<o;t++){const e=B[t];H=X[t];for(let t=0,o=e.length;t<o;t++){const o=W(e[t],H[t],i);y?M(o.x,o.y+A[s-1].y,A[s-1].x+n):M(o.x,o.y,g+n)}}}function N(e,t){let n=e.length;for(;--n>=0;){const i=n;let o=n-1;o<0&&(o=e.length-1);for(let e=0,n=s+2*u;e<n;e++){const n=S*e,r=S*(e+1);k(t+i+n,t+o+n,t+o+r,t+i+r)}}}function M(e,t,n){r.push(e),r.push(t),r.push(n)}function F(e,t,o){z(e),z(t),z(o);const r=i.length/3,a=h.generateTopUV(n,i,r-3,r-2,r-1);L(a[0]),L(a[1]),L(a[2])}function k(e,t,o,r){z(e),z(t),z(r),z(t),z(o),z(r);const a=i.length/3,s=h.generateSideWallUV(n,i,a-6,a-3,a-2,a-1);L(s[0]),L(s[1]),L(s[3]),L(s[1]),L(s[2]),L(s[3])}function z(e){i.push(r[3*e+0]),i.push(r[3*e+1]),i.push(r[3*e+2])}function L(e){o.push(e.x),o.push(e.y)}!function(){const e=i.length/3;if(l){let e=0,t=S*e;for(let n=0;n<R;n++){const e=Z[n];F(e[2]+t,e[1]+t,e[0]+t)}e=s+2*u,t=S*e;for(let n=0;n<R;n++){const e=Z[n];F(e[0]+t,e[1]+t,e[2]+t)}}else{for(let e=0;e<R;e++){const t=Z[e];F(t[2],t[1],t[0])}for(let e=0;e<R;e++){const t=Z[e];F(t[0]+S*s,t[1]+S*s,t[2]+S*s)}}n.addGroup(e,i.length/3-e,0)}(),function(){const e=i.length/3;let t=0;N(w,t),t+=w.length;for(let n=0,i=B.length;n<i;n++){const e=B[n];N(e,t),t+=e.length}n.addGroup(e,i.length/3-e,1)}()}this.setAttribute("position",new Zo(i,3)),this.setAttribute("uv",new Zo(o,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let i=0,o=e.length;i<o;i++){const t=e[i];n.shapes.push(t.uuid)}else n.shapes.push(e.uuid);void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let o=0,r=e.shapes.length;o<r;o++){const i=t[e.shapes[o]];n.push(i)}const i=e.options.extrudePath;return void 0!==i&&(e.options.extrudePath=(new _l[i.type]).fromJSON(i)),new Wc(n,e.options)}}const Sc={generateTopUV:function(e,t,n,i,o){const r=t[3*n],a=t[3*n+1],s=t[3*i],g=t[3*i+1],l=t[3*o],c=t[3*o+1];return[new Wn(r,a),new Wn(s,g),new Wn(l,c)]},generateSideWallUV:function(e,t,n,i,o,r){const a=t[3*n],s=t[3*n+1],g=t[3*n+2],l=t[3*i],c=t[3*i+1],I=t[3*i+2],C=t[3*o],u=t[3*o+1],d=t[3*o+2],h=t[3*r],A=t[3*r+1],p=t[3*r+2];return Math.abs(s-c)<Math.abs(a-l)?[new Wn(a,1-g),new Wn(l,1-I),new Wn(C,1-d),new Wn(h,1-p)]:[new Wn(s,1-g),new Wn(c,1-I),new Wn(u,1-d),new Wn(A,1-p)]}};class Rc extends vl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Rc(e.radius,e.detail)}}class xc extends Yo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[new Wn(0,.5),new Wn(.5,0),new Wn(0,-.5)],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=fn(i,0,2*Math.PI);const o=[],r=[],a=[],s=[],g=[],l=1/t,c=new jn,I=new Wn,C=new jn,u=new jn,d=new jn;let h=0,A=0;for(let p=0;p<=e.length-1;p++)switch(p){case 0:h=e[p+1].x-e[p].x,A=e[p+1].y-e[p].y,C.x=1*A,C.y=-h,C.z=0*A,d.copy(C),C.normalize(),s.push(C.x,C.y,C.z);break;case e.length-1:s.push(d.x,d.y,d.z);break;default:h=e[p+1].x-e[p].x,A=e[p+1].y-e[p].y,C.x=1*A,C.y=-h,C.z=0*A,u.copy(C),C.x+=d.x,C.y+=d.y,C.z+=d.z,C.normalize(),s.push(C.x,C.y,C.z),d.copy(u)}for(let p=0;p<=t;p++){const o=n+p*l*i,C=Math.sin(o),u=Math.cos(o);for(let n=0;n<=e.length-1;n++){c.x=e[n].x*C,c.y=e[n].y,c.z=e[n].x*u,r.push(c.x,c.y,c.z),I.x=p/t,I.y=n/(e.length-1),a.push(I.x,I.y);const i=s[3*n+0]*C,o=s[3*n+1],l=s[3*n+0]*u;g.push(i,o,l)}}for(let p=0;p<t;p++)for(let t=0;t<e.length-1;t++){const n=t+p*e.length,i=n,r=n+e.length,a=n+e.length+1,s=n+1;o.push(i,r,s),o.push(a,s,r)}this.setIndex(o),this.setAttribute("position",new Zo(r,3)),this.setAttribute("uv",new Zo(a,2)),this.setAttribute("normal",new Zo(g,3))}static fromJSON(e){return new xc(e.points,e.segments,e.phiStart,e.phiLength)}}class Vc extends vl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Vc(e.radius,e.detail)}}class Xc extends Yo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI;super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:o,thetaLength:r},n=Math.max(3,n),i=Math.max(1,i);const a=[],s=[],g=[],l=[];let c=e;const I=(t-e)/i,C=new jn,u=new Wn;for(let d=0;d<=i;d++){for(let e=0;e<=n;e++){const i=o+e/n*r;C.x=c*Math.cos(i),C.y=c*Math.sin(i),s.push(C.x,C.y,C.z),g.push(0,0,1),u.x=(C.x/t+1)/2,u.y=(C.y/t+1)/2,l.push(u.x,u.y)}c+=I}for(let d=0;d<i;d++){const e=d*(n+1);for(let t=0;t<n;t++){const i=t+e,o=i,r=i+n+1,s=i+n+2,g=i+1;a.push(o,r,g),a.push(r,s,g)}}this.setIndex(a),this.setAttribute("position",new Zo(s,3)),this.setAttribute("normal",new Zo(g,3)),this.setAttribute("uv",new Zo(l,2))}static fromJSON(e){return new Xc(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Hc extends Yo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ql([new Wn(0,.5),new Wn(-.5,-.5),new Wn(.5,-.5)]),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],o=[],r=[];let a=0,s=0;if(!1===Array.isArray(e))g(e);else for(let l=0;l<e.length;l++)g(e[l]),this.addGroup(a,s,l),a+=s,s=0;function g(e){const a=i.length/3,g=e.extractPoints(t);let l=g.shape;const c=g.holes;!1===Bc.isClockWise(l)&&(l=l.reverse());for(let t=0,n=c.length;t<n;t++){const e=c[t];!0===Bc.isClockWise(e)&&(c[t]=e.reverse())}const I=Bc.triangulateShape(l,c);for(let t=0,n=c.length;t<n;t++){const e=c[t];l=l.concat(e)}for(let t=0,n=l.length;t<n;t++){const e=l[t];i.push(e.x,e.y,0),o.push(0,0,1),r.push(e.x,e.y)}for(let t=0,i=I.length;t<i;t++){const e=I[t],i=e[0]+a,o=e[1]+a,r=e[2]+a;n.push(i,o,r),s+=3}}this.setIndex(n),this.setAttribute("position",new Zo(i,3)),this.setAttribute("normal",new Zo(o,3)),this.setAttribute("uv",new Zo(r,2))}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,i=e.length;n<i;n++){const i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let i=0,o=e.shapes.length;i<o;i++){const o=t[e.shapes[i]];n.push(o)}return new Hc(n,e.curveSegments)}}class Yc extends Yo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:o,thetaStart:r,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const s=Math.min(r+a,Math.PI);let g=0;const l=[],c=new jn,I=new jn,C=[],u=[],d=[],h=[];for(let A=0;A<=n;A++){const C=[],p=A/n;let m=0;0==A&&0==r?m=.5/t:A==n&&s==Math.PI&&(m=-.5/t);for(let n=0;n<=t;n++){const s=n/t;c.x=-e*Math.cos(i+s*o)*Math.sin(r+p*a),c.y=e*Math.cos(r+p*a),c.z=e*Math.sin(i+s*o)*Math.sin(r+p*a),u.push(c.x,c.y,c.z),I.copy(c).normalize(),d.push(I.x,I.y,I.z),h.push(s+m,1-p),C.push(g++)}l.push(C)}for(let A=0;A<n;A++)for(let e=0;e<t;e++){const t=l[A][e+1],i=l[A][e],o=l[A+1][e],a=l[A+1][e+1];(0!==A||r>0)&&C.push(t,i,a),(A!==n-1||s<Math.PI)&&C.push(i,o,a)}this.setIndex(C),this.setAttribute("position",new Zo(u,3)),this.setAttribute("normal",new Zo(d,3)),this.setAttribute("uv",new Zo(h,2))}static fromJSON(e){return new Yc(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Kc extends vl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Kc(e.radius,e.detail)}}class Nc extends Yo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI;super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:o},n=Math.floor(n),i=Math.floor(i);const r=[],a=[],s=[],g=[],l=new jn,c=new jn,I=new jn;for(let C=0;C<=n;C++)for(let r=0;r<=i;r++){const u=r/i*o,d=C/n*Math.PI*2;c.x=(e+t*Math.cos(d))*Math.cos(u),c.y=(e+t*Math.cos(d))*Math.sin(u),c.z=t*Math.sin(d),a.push(c.x,c.y,c.z),l.x=e*Math.cos(u),l.y=e*Math.sin(u),I.subVectors(c,l).normalize(),s.push(I.x,I.y,I.z),g.push(r/i),g.push(C/n)}for(let C=1;C<=n;C++)for(let e=1;e<=i;e++){const t=(i+1)*C+e-1,n=(i+1)*(C-1)+e-1,o=(i+1)*(C-1)+e,a=(i+1)*C+e;r.push(t,n,a),r.push(n,o,a)}this.setIndex(r),this.setAttribute("position",new Zo(a,3)),this.setAttribute("normal",new Zo(s,3)),this.setAttribute("uv",new Zo(g,2))}static fromJSON(e){return new Nc(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Mc extends Yo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:o,q:r},n=Math.floor(n),i=Math.floor(i);const a=[],s=[],g=[],l=[],c=new jn,I=new jn,C=new jn,u=new jn,d=new jn,h=new jn,A=new jn;for(let m=0;m<=n;++m){const a=m/n*o*Math.PI*2;p(a,o,r,e,C),p(a+.01,o,r,e,u),h.subVectors(u,C),A.addVectors(u,C),d.crossVectors(h,A),A.crossVectors(d,h),d.normalize(),A.normalize();for(let e=0;e<=i;++e){const o=e/i*Math.PI*2,r=-t*Math.cos(o),a=t*Math.sin(o);c.x=C.x+(r*A.x+a*d.x),c.y=C.y+(r*A.y+a*d.y),c.z=C.z+(r*A.z+a*d.z),s.push(c.x,c.y,c.z),I.subVectors(c,C).normalize(),g.push(I.x,I.y,I.z),l.push(m/n),l.push(e/i)}}for(let m=1;m<=n;m++)for(let e=1;e<=i;e++){const t=(i+1)*(m-1)+(e-1),n=(i+1)*m+(e-1),o=(i+1)*m+e,r=(i+1)*(m-1)+e;a.push(t,n,r),a.push(n,o,r)}function p(e,t,n,i,o){const r=Math.cos(e),a=Math.sin(e),s=n/t*e,g=Math.cos(s);o.x=i*(2+g)*.5*r,o.y=i*(2+g)*a*.5,o.z=i*Math.sin(s)*.5}this.setIndex(a),this.setAttribute("position",new Zo(s,3)),this.setAttribute("normal",new Zo(g,3)),this.setAttribute("uv",new Zo(l,2))}static fromJSON(e){return new Mc(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Fc extends Yo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Pl(new jn(-1,-1,0),new jn(-1,1,0),new jn(1,1,0)),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:o};const r=e.computeFrenetFrames(t,o);this.tangents=r.tangents,this.normals=r.normals,this.binormals=r.binormals;const a=new jn,s=new jn,g=new Wn;let l=new jn;const c=[],I=[],C=[],u=[];function d(o){l=e.getPointAt(o/t,l);const g=r.normals[o],C=r.binormals[o];for(let e=0;e<=i;e++){const t=e/i*Math.PI*2,o=Math.sin(t),r=-Math.cos(t);s.x=r*g.x+o*C.x,s.y=r*g.y+o*C.y,s.z=r*g.z+o*C.z,s.normalize(),I.push(s.x,s.y,s.z),a.x=l.x+n*s.x,a.y=l.y+n*s.y,a.z=l.z+n*s.z,c.push(a.x,a.y,a.z)}}!function(){for(let e=0;e<t;e++)d(e);d(!1===o?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=i;n++)g.x=e/t,g.y=n/i,C.push(g.x,g.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=i;t++){const n=(i+1)*(e-1)+(t-1),o=(i+1)*e+(t-1),r=(i+1)*e+t,a=(i+1)*(e-1)+t;u.push(n,o,a),u.push(o,r,a)}}()}(),this.setIndex(u),this.setAttribute("position",new Zo(c,3)),this.setAttribute("normal",new Zo(I,3)),this.setAttribute("uv",new Zo(C,2))}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Fc((new _l[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class kc extends Yo{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],n=new Set,i=new jn,o=new jn;if(null!==e.index){const r=e.attributes.position,a=e.index;let s=e.groups;0===s.length&&(s=[{start:0,count:a.count,materialIndex:0}]);for(let e=0,g=s.length;e<g;++e){const g=s[e],l=g.start;for(let e=l,s=l+g.count;e<s;e+=3)for(let g=0;g<3;g++){const s=a.getX(e+g),l=a.getX(e+(g+1)%3);i.fromBufferAttribute(r,s),o.fromBufferAttribute(r,l),!0===zc(i,o,n)&&(t.push(i.x,i.y,i.z),t.push(o.x,o.y,o.z))}}}else{const r=e.attributes.position;for(let e=0,a=r.count/3;e<a;e++)for(let s=0;s<3;s++){const a=3*e+s,g=3*e+(s+1)%3;i.fromBufferAttribute(r,a),o.fromBufferAttribute(r,g),!0===zc(i,o,n)&&(t.push(i.x,i.y,i.z),t.push(o.x,o.y,o.z))}}this.setAttribute("position",new Zo(t,3))}}}function zc(e,t,n){const i=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,o=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==n.has(i)&&!0!==n.has(o)&&(n.add(i,o),!0)}var Lc=Object.freeze({__proto__:null,BoxGeometry:er,BoxBufferGeometry:er,CircleGeometry:fl,CircleBufferGeometry:fl,ConeGeometry:Gl,ConeBufferGeometry:Gl,CylinderGeometry:yl,CylinderBufferGeometry:yl,DodecahedronGeometry:Bl,DodecahedronBufferGeometry:Bl,EdgesGeometry:Rl,ExtrudeGeometry:Wc,ExtrudeBufferGeometry:Wc,IcosahedronGeometry:Rc,IcosahedronBufferGeometry:Rc,LatheGeometry:xc,LatheBufferGeometry:xc,OctahedronGeometry:Vc,OctahedronBufferGeometry:Vc,PlaneGeometry:fr,PlaneBufferGeometry:fr,PolyhedronGeometry:vl,PolyhedronBufferGeometry:vl,RingGeometry:Xc,RingBufferGeometry:Xc,ShapeGeometry:Hc,ShapeBufferGeometry:Hc,SphereGeometry:Yc,SphereBufferGeometry:Yc,TetrahedronGeometry:Kc,TetrahedronBufferGeometry:Kc,TorusGeometry:Nc,TorusBufferGeometry:Nc,TorusKnotGeometry:Mc,TorusKnotBufferGeometry:Mc,TubeGeometry:Fc,TubeBufferGeometry:Fc,WireframeGeometry:kc});class Tc extends Io{constructor(e){super(),this.type="ShadowMaterial",this.color=new kn(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}Tc.prototype.isShadowMaterial=!0;class Ec extends Io{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new kn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new kn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Mt,this.normalScale=new Wn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}Ec.prototype.isMeshStandardMaterial=!0;class Jc extends Ec{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Wn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return fn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.sheenColor=new kn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new kn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new kn(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!==e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!==e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!==e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}Jc.prototype.isMeshPhysicalMaterial=!0;class Uc extends Io{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new kn(16777215),this.specular=new kn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new kn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Mt,this.normalScale=new Wn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=_,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}Uc.prototype.isMeshPhongMaterial=!0;class Dc extends Io{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new kn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new kn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Mt,this.normalScale=new Wn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Dc.prototype.isMeshToonMaterial=!0;class Pc extends Io{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Mt,this.normalScale=new Wn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}Pc.prototype.isMeshNormalMaterial=!0;class Qc extends Io{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new kn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new kn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=_,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Qc.prototype.isMeshLambertMaterial=!0;class _c extends Io{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new kn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Mt,this.normalScale=new Wn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}_c.prototype.isMeshMatcapMaterial=!0;class jc extends qg{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}jc.prototype.isLineDashedMaterial=!0;var Oc=Object.freeze({__proto__:null,ShadowMaterial:Tc,SpriteMaterial:Ag,RawShaderMaterial:Vr,ShaderMaterial:or,PointsMaterial:ll,MeshPhysicalMaterial:Jc,MeshStandardMaterial:Ec,MeshPhongMaterial:Uc,MeshToonMaterial:Dc,MeshNormalMaterial:Pc,MeshLambertMaterial:Qc,MeshDepthMaterial:Ps,MeshDistanceMaterial:Qs,MeshBasicMaterial:Co,MeshMatcapMaterial:_c,LineDashedMaterial:jc,LineBasicMaterial:qg,Material:Io});const qc={arraySlice:function(e,t,n){return qc.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){const t=e.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){const i=e.length,o=new e.constructor(i);for(let r=0,a=0;a!==i;++r){const i=n[r]*t;for(let n=0;n!==t;++n)o[a++]=e[i+n]}return o},flattenJSON:function(e,t,n,i){let o=1,r=e[0];for(;void 0!==r&&void 0===r[i];)r=e[o++];if(void 0===r)return;let a=r[i];if(void 0!==a)if(Array.isArray(a))do{a=r[i],void 0!==a&&(t.push(r.time),n.push.apply(n,a)),r=e[o++]}while(void 0!==r);else if(void 0!==a.toArray)do{a=r[i],void 0!==a&&(t.push(r.time),a.toArray(n,n.length)),r=e[o++]}while(void 0!==r);else do{a=r[i],void 0!==a&&(t.push(r.time),n.push(a)),r=e[o++]}while(void 0!==r)},subclip:function(e,t,n,i){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30;const r=e.clone();r.name=t;const a=[];for(let g=0;g<r.tracks.length;++g){const e=r.tracks[g],t=e.getValueSize(),s=[],l=[];for(let r=0;r<e.times.length;++r){const a=e.times[r]*o;if(!(a<n||a>=i)){s.push(e.times[r]);for(let n=0;n<t;++n)l.push(e.values[r*t+n])}}0!==s.length&&(e.times=qc.convertArray(s,e.times.constructor),e.values=qc.convertArray(l,e.values.constructor),a.push(e))}r.tracks=a;let s=1/0;for(let g=0;g<r.tracks.length;++g)s>r.tracks[g].times[0]&&(s=r.tracks[g].times[0]);for(let g=0;g<r.tracks.length;++g)r.tracks[g].shift(-1*s);return r.resetDuration(),r},makeClipAdditive:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;i<=0&&(i=30);const o=n.tracks.length,r=t/i;for(let a=0;a<o;++a){const t=n.tracks[a],i=t.ValueTypeName;if("bool"===i||"string"===i)continue;const o=e.tracks.find((function(e){return e.name===t.name&&e.ValueTypeName===i}));if(void 0===o)continue;let s=0;const g=t.getValueSize();t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=g/3);let l=0;const c=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=c/3);const I=t.times.length-1;let C;if(r<=t.times[0]){const e=s,n=g-s;C=qc.arraySlice(t.values,e,n)}else if(r>=t.times[I]){const e=I*g+s,n=e+g-s;C=qc.arraySlice(t.values,e,n)}else{const e=t.createInterpolant(),n=s,i=g-s;e.evaluate(r),C=qc.arraySlice(e.resultBuffer,n,i)}if("quaternion"===i){(new _n).fromArray(C).normalize().conjugate().toArray(C)}const u=o.times.length;for(let e=0;e<u;++e){const t=e*c+l;if("quaternion"===i)_n.multiplyQuaternionsFlat(o.values,t,C,0,o.values,t);else{const e=c-2*l;for(let n=0;n<e;++n)o.values[t+n]-=C[n]}}}return e.blendMode=Rt,e}};class $c{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],o=t[n-1];e:{t:{let r;n:{i:if(!(e<i)){for(let r=n+2;;){if(void 0===i){if(e<o)break i;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,o)}if(n===r)break;if(o=i,i=t[++n],e<i)break t}r=t.length;break n}if(e>=o)break e;{const a=t[1];e<a&&(n=2,o=a);for(let r=n-2;;){if(void 0===o)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(n===r)break;if(i=o,o=t[--n-1],e>=o)break t}r=n,n=0}}for(;n<r;){const i=n+r>>>1;e<t[i]?r=i:n=i+1}if(i=t[n],o=t[n-1],void 0===o)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(void 0===i)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,o,e)}this._cachedIndex=n,this.intervalChanged_(n,o,i)}return this.interpolate_(n,o,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,o=e*i;for(let r=0;r!==i;++r)t[r]=n[o+r];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}$c.prototype.beforeStart_=$c.prototype.copySampleValue_,$c.prototype.afterEnd_=$c.prototype.copySampleValue_;class eI extends $c{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Zt,endingEnd:Zt}}intervalChanged_(e,t,n){const i=this.parameterPositions;let o=e-2,r=e+1,a=i[o],s=i[r];if(void 0===a)switch(this.getSettings_().endingStart){case wt:o=e,a=2*t-n;break;case Wt:o=i.length-2,a=t+i[o]-i[o+1];break;default:o=e,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case wt:r=e,s=2*n-t;break;case Wt:r=1,s=n+i[1]-i[0];break;default:r=e-1,s=t}const g=.5*(n-t),l=this.valueSize;this._weightPrev=g/(t-a),this._weightNext=g/(s-n),this._offsetPrev=o*l,this._offsetNext=r*l}interpolate_(e,t,n,i){const o=this.resultBuffer,r=this.sampleValues,a=this.valueSize,s=e*a,g=s-a,l=this._offsetPrev,c=this._offsetNext,I=this._weightPrev,C=this._weightNext,u=(n-t)/(i-t),d=u*u,h=d*u,A=-I*h+2*I*d-I*u,p=(1+I)*h+(-1.5-2*I)*d+(-.5+I)*u+1,m=(-1-C)*h+(1.5+C)*d+.5*u,b=C*h-C*d;for(let f=0;f!==a;++f)o[f]=A*r[l+f]+p*r[g+f]+m*r[s+f]+b*r[c+f];return o}}class tI extends $c{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const o=this.resultBuffer,r=this.sampleValues,a=this.valueSize,s=e*a,g=s-a,l=(n-t)/(i-t),c=1-l;for(let I=0;I!==a;++I)o[I]=r[g+I]*c+r[s+I]*l;return o}}class nI extends $c{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class iI{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=qc.convertArray(t,this.TimeBufferType),this.values=qc.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:qc.convertArray(e.times,Array),values:qc.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new nI(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new tI(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new eI(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Gt:t=this.InterpolantFactoryMethodDiscrete;break;case vt:t=this.InterpolantFactoryMethodLinear;break;case Bt:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Gt;case this.InterpolantFactoryMethodLinear:return vt;case this.InterpolantFactoryMethodSmooth:return Bt}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let o=0,r=i-1;for(;o!==i&&n[o]<e;)++o;for(;-1!==r&&n[r]>t;)--r;if(++r,0!==o||r!==i){o>=r&&(r=Math.max(r,1),o=r-1);const e=this.getValueSize();this.times=qc.arraySlice(n,o,r),this.values=qc.arraySlice(this.values,o*e,r*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,o=n.length;0===o&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let r=null;for(let a=0;a!==o;a++){const t=n[a];if("number"===typeof t&&isNaN(t)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,t),e=!1;break}if(null!==r&&r>t){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,t,r),e=!1;break}r=t}if(void 0!==i&&qc.isTypedArray(i))for(let a=0,s=i.length;a!==s;++a){const t=i[a];if(isNaN(t)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,t),e=!1;break}}return e}optimize(){const e=qc.arraySlice(this.times),t=qc.arraySlice(this.values),n=this.getValueSize(),i=this.getInterpolation()===Bt,o=e.length-1;let r=1;for(let a=1;a<o;++a){let o=!1;const s=e[a];if(s!==e[a+1]&&(1!==a||s!==e[0]))if(i)o=!0;else{const e=a*n,i=e-n,r=e+n;for(let a=0;a!==n;++a){const n=t[e+a];if(n!==t[i+a]||n!==t[r+a]){o=!0;break}}}if(o){if(a!==r){e[r]=e[a];const i=a*n,o=r*n;for(let e=0;e!==n;++e)t[o+e]=t[i+e]}++r}}if(o>0){e[r]=e[o];for(let e=o*n,i=r*n,a=0;a!==n;++a)t[i+a]=t[e+a];++r}return r!==e.length?(this.times=qc.arraySlice(e,0,r),this.values=qc.arraySlice(t,0,r*n)):(this.times=e,this.values=t),this}clone(){const e=qc.arraySlice(this.times,0),t=qc.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}iI.prototype.TimeBufferType=Float32Array,iI.prototype.ValueBufferType=Float32Array,iI.prototype.DefaultInterpolation=vt;class oI extends iI{}oI.prototype.ValueTypeName="bool",oI.prototype.ValueBufferType=Array,oI.prototype.DefaultInterpolation=Gt,oI.prototype.InterpolantFactoryMethodLinear=void 0,oI.prototype.InterpolantFactoryMethodSmooth=void 0;class rI extends iI{}rI.prototype.ValueTypeName="color";class aI extends iI{}aI.prototype.ValueTypeName="number";class sI extends $c{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const o=this.resultBuffer,r=this.sampleValues,a=this.valueSize,s=(n-t)/(i-t);let g=e*a;for(let l=g+a;g!==l;g+=4)_n.slerpFlat(o,0,r,g-a,r,g,s);return o}}class gI extends iI{InterpolantFactoryMethodLinear(e){return new sI(this.times,this.values,this.getValueSize(),e)}}gI.prototype.ValueTypeName="quaternion",gI.prototype.DefaultInterpolation=vt,gI.prototype.InterpolantFactoryMethodSmooth=void 0;class lI extends iI{}lI.prototype.ValueTypeName="string",lI.prototype.ValueBufferType=Array,lI.prototype.DefaultInterpolation=Gt,lI.prototype.InterpolantFactoryMethodLinear=void 0,lI.prototype.InterpolantFactoryMethodSmooth=void 0;class cI extends iI{}cI.prototype.ValueTypeName="vector";class II{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:St;this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=bn(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let r=0,a=n.length;r!==a;++r)t.push(CI(n[r]).scale(i));const o=new this(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let o=0,r=n.length;o!==r;++o)t.push(iI.toJSON(n[o]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const o=t.length,r=[];for(let a=0;a<o;a++){let e=[],s=[];e.push((a+o-1)%o,a,(a+1)%o),s.push(0,1,0);const g=qc.getKeyframeOrder(e);e=qc.sortedArray(e,1,g),s=qc.sortedArray(s,1,g),i||0!==e[0]||(e.push(o),s.push(s[0])),r.push(new aI(".morphTargetInfluences["+t[a].name+"]",e,s).scale(1/n))}return new this(e,-1,r)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},o=/^([\w-]*?)([\d]+)$/;for(let a=0,s=e.length;a<s;a++){const t=e[a],n=t.name.match(o);if(n&&n.length>1){const e=n[1];let o=i[e];o||(i[e]=o=[]),o.push(t)}}const r=[];for(const a in i)r.push(this.CreateFromMorphTargetSequence(a,i[a],t,n));return r}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,i,o){if(0!==n.length){const r=[],a=[];qc.flattenJSON(n,r,a,i),0!==r.length&&o.push(new e(t,r,a))}},i=[],o=e.name||"default",r=e.fps||30,a=e.blendMode;let s=e.length||-1;const g=e.hierarchy||[];for(let l=0;l<g.length;l++){const e=g[l].keys;if(e&&0!==e.length)if(e[0].morphTargets){const t={};let n;for(n=0;n<e.length;n++)if(e[n].morphTargets)for(let i=0;i<e[n].morphTargets.length;i++)t[e[n].morphTargets[i]]=-1;for(const o in t){const t=[],r=[];for(let i=0;i!==e[n].morphTargets.length;++i){const i=e[n];t.push(i.time),r.push(i.morphTarget===o?1:0)}i.push(new aI(".morphTargetInfluence["+o+"]",t,r))}s=t.length*(r||1)}else{const o=".bones["+t[l].name+"]";n(cI,o+".position",e,"pos",i),n(gI,o+".quaternion",e,"rot",i),n(cI,o+".scale",e,"scl",i)}}if(0===i.length)return null;return new this(o,s,i,a)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function CI(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return aI;case"vector":case"vector2":case"vector3":case"vector4":return cI;case"color":return rI;case"quaternion":return gI;case"bool":case"boolean":return oI;case"string":return lI}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];qc.flattenJSON(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const uI={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class dI{constructor(e,t,n){const i=this;let o,r=!1,a=0,s=0;const g=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){s++,!1===r&&void 0!==i.onStart&&i.onStart(e,a,s),r=!0},this.itemEnd=function(e){a++,void 0!==i.onProgress&&i.onProgress(e,a,s),a===s&&(r=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return o?o(e):e},this.setURLModifier=function(e){return o=e,this},this.addHandler=function(e,t){return g.push(e,t),this},this.removeHandler=function(e){const t=g.indexOf(e);return-1!==t&&g.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=g.length;t<n;t+=2){const n=g[t],i=g[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null}}}const hI=new dI;class AI{constructor(e){this.manager=void 0!==e?e:hI,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(i,o){n.load(e,i,t,o)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const pI={};class mI extends AI{constructor(e){super(e)}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const o=uI.get(e);if(void 0!==o)return this.manager.itemStart(e),setTimeout((()=>{t&&t(o),this.manager.itemEnd(e)}),0),o;if(void 0!==pI[e])return void pI[e].push({onLoad:t,onProgress:n,onError:i});pI[e]=[],pI[e].push({onLoad:t,onProgress:n,onError:i});const r=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,s=this.responseType;fetch(r).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"===typeof ReadableStream||void 0===t.body.getReader)return t;const n=pI[e],i=t.body.getReader(),o=t.headers.get("Content-Length"),r=o?parseInt(o):0,a=0!==r;let s=0;const g=new ReadableStream({start(e){!function t(){i.read().then((i=>{let{done:o,value:g}=i;if(o)e.close();else{s+=g.byteLength;const i=new ProgressEvent("progress",{lengthComputable:a,loaded:s,total:r});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(i)}e.enqueue(g),t()}}))}()}});return new Response(g)}throw Error(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`)})).then((e=>{switch(s){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,a)));case"json":return e.json();default:if(void 0===a)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(a),n=t&&t[1]?t[1].toLowerCase():void 0,i=new TextDecoder(n);return e.arrayBuffer().then((e=>i.decode(e)))}}})).then((t=>{uI.add(e,t);const n=pI[e];delete pI[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onLoad&&i.onLoad(t)}})).catch((t=>{const n=pI[e];if(void 0===n)throw this.manager.itemError(e),t;delete pI[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class bI extends AI{constructor(e){super(e)}load(e,t,n,i){const o=this,r=new mI(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(function(n){try{t(o.parse(JSON.parse(n)))}catch(r){i?i(r):console.error(r),o.manager.itemError(e)}}),n,i)}parse(e){const t=[];for(let n=0;n<e.length;n++){const i=II.parse(e[n]);t.push(i)}return t}}class fI extends AI{constructor(e){super(e)}load(e,t,n,i){const o=this,r=[],a=new ml,s=new mI(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(o.withCredentials);let g=0;function l(l){s.load(e[l],(function(e){const n=o.parse(e,!0);r[l]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},g+=1,6===g&&(1===n.mipmapCount&&(a.minFilter=be),a.image=r,a.format=n.format,a.needsUpdate=!0,t&&t(a))}),n,i)}if(Array.isArray(e))for(let c=0,I=e.length;c<I;++c)l(c);else s.load(e,(function(e){const n=o.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){r[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)r[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),r[t].format=n.format,r[t].width=n.width,r[t].height=n.height}a.image=r}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=be),a.format=n.format,a.needsUpdate=!0,t&&t(a)}),n,i);return a}}class yI extends AI{constructor(e){super(e)}load(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,r=uI.get(e);if(void 0!==r)return o.manager.itemStart(e),setTimeout((function(){t&&t(r),o.manager.itemEnd(e)}),0),r;const a=Xn("img");function s(){l(),uI.add(e,this),t&&t(this),o.manager.itemEnd(e)}function g(t){l(),i&&i(t),o.manager.itemError(e),o.manager.itemEnd(e)}function l(){a.removeEventListener("load",s,!1),a.removeEventListener("error",g,!1)}return a.addEventListener("load",s,!1),a.addEventListener("error",g,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),o.manager.itemStart(e),a.src=e,a}}class GI extends AI{constructor(e){super(e)}load(e,t,n,i){const o=new lr,r=new yI(this.manager);r.setCrossOrigin(this.crossOrigin),r.setPath(this.path);let a=0;function s(n){r.load(e[n],(function(e){o.images[n]=e,a++,6===a&&(o.needsUpdate=!0,t&&t(o))}),void 0,i)}for(let g=0;g<e.length;++g)s(g);return o}}class vI extends AI{constructor(e){super(e)}load(e,t,n,i){const o=this,r=new Tg,a=new mI(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(o.withCredentials),a.load(e,(function(e){const n=o.parse(e);n&&(void 0!==n.image?r.image=n.image:void 0!==n.data&&(r.image.width=n.width,r.image.height=n.height,r.image.data=n.data),r.wrapS=void 0!==n.wrapS?n.wrapS:Ce,r.wrapT=void 0!==n.wrapT?n.wrapT:Ce,r.magFilter=void 0!==n.magFilter?n.magFilter:be,r.minFilter=void 0!==n.minFilter?n.minFilter:be,r.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(r.encoding=n.encoding),void 0!==n.flipY&&(r.flipY=n.flipY),void 0!==n.format&&(r.format=n.format),void 0!==n.type&&(r.type=n.type),void 0!==n.mipmaps&&(r.mipmaps=n.mipmaps,r.minFilter=Ge),1===n.mipmapCount&&(r.minFilter=be),void 0!==n.generateMipmaps&&(r.generateMipmaps=n.generateMipmaps),r.needsUpdate=!0,t&&t(r,n))}),n,i),r}}class BI extends AI{constructor(e){super(e)}load(e,t,n,i){const o=new En,r=new yI(this.manager);return r.setCrossOrigin(this.crossOrigin),r.setPath(this.path),r.load(e,(function(e){o.image=e,o.needsUpdate=!0,void 0!==t&&t(o)}),n,i),o}}class ZI extends qi{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.type="Light",this.color=new kn(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}ZI.prototype.isLight=!0;class wI extends ZI{constructor(e,t,n){super(e,n),this.type="HemisphereLight",this.position.copy(qi.DefaultUp),this.updateMatrix(),this.groundColor=new kn(t)}copy(e){return ZI.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}wI.prototype.isHemisphereLight=!0;const WI=new Wi,SI=new jn,RI=new jn;class xI{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Wn(512,512),this.map=null,this.mapPass=null,this.matrix=new Wi,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new pr,this._frameExtents=new Wn(1,1),this._viewportCount=1,this._viewports=[new Un(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;SI.setFromMatrixPosition(e.matrixWorld),t.position.copy(SI),RI.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(RI),t.updateMatrixWorld(),WI.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(WI),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class VI extends xI{constructor(){super(new ar(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,n=2*mn*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,o=e.distance||t.far;n===t.fov&&i===t.aspect&&o===t.far||(t.fov=n,t.aspect=i,t.far=o,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}VI.prototype.isSpotLightShadow=!0;class XI extends ZI{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(e,t),this.type="SpotLight",this.position.copy(qi.DefaultUp),this.updateMatrix(),this.target=new qi,this.distance=n,this.angle=i,this.penumbra=o,this.decay=r,this.shadow=new VI}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}XI.prototype.isSpotLight=!0;const HI=new Wi,YI=new jn,KI=new jn;class NI extends xI{constructor(){super(new ar(90,1,.5,500)),this._frameExtents=new Wn(4,2),this._viewportCount=6,this._viewports=[new Un(2,1,1,1),new Un(0,1,1,1),new Un(3,1,1,1),new Un(1,1,1,1),new Un(3,0,1,1),new Un(1,0,1,1)],this._cubeDirections=[new jn(1,0,0),new jn(-1,0,0),new jn(0,0,1),new jn(0,0,-1),new jn(0,1,0),new jn(0,-1,0)],this._cubeUps=[new jn(0,1,0),new jn(0,1,0),new jn(0,1,0),new jn(0,1,0),new jn(0,0,1),new jn(0,0,-1)]}updateMatrices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.camera,i=this.matrix,o=e.distance||n.far;o!==n.far&&(n.far=o,n.updateProjectionMatrix()),YI.setFromMatrixPosition(e.matrixWorld),n.position.copy(YI),KI.copy(n.position),KI.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(KI),n.updateMatrixWorld(),i.makeTranslation(-YI.x,-YI.y,-YI.z),HI.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(HI)}}NI.prototype.isPointLightShadow=!0;class MI extends ZI{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(e,t),this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new NI}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}MI.prototype.isPointLight=!0;class FI extends xI{constructor(){super(new xr(-5,5,5,-5,.5,500))}}FI.prototype.isDirectionalLightShadow=!0;class kI extends ZI{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(qi.DefaultUp),this.updateMatrix(),this.target=new qi,this.shadow=new FI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}kI.prototype.isDirectionalLight=!0;class zI extends ZI{constructor(e,t){super(e,t),this.type="AmbientLight"}}zI.prototype.isAmbientLight=!0;class LI extends ZI{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;super(e,t),this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}LI.prototype.isRectAreaLight=!0;class TI{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new jn)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,o=e.z,r=this.coefficients;return t.copy(r[0]).multiplyScalar(.282095),t.addScaledVector(r[1],.488603*i),t.addScaledVector(r[2],.488603*o),t.addScaledVector(r[3],.488603*n),t.addScaledVector(r[4],n*i*1.092548),t.addScaledVector(r[5],i*o*1.092548),t.addScaledVector(r[6],.315392*(3*o*o-1)),t.addScaledVector(r[7],n*o*1.092548),t.addScaledVector(r[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,o=e.z,r=this.coefficients;return t.copy(r[0]).multiplyScalar(.886227),t.addScaledVector(r[1],1.023328*i),t.addScaledVector(r[2],1.023328*o),t.addScaledVector(r[3],1.023328*n),t.addScaledVector(r[4],.858086*n*i),t.addScaledVector(r[5],.858086*i*o),t.addScaledVector(r[6],.743125*o*o-.247708),t.addScaledVector(r[7],.858086*n*o),t.addScaledVector(r[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+3*i);return e}static getBasisAt(e,t){const n=e.x,i=e.y,o=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*o,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*o,t[6]=.315392*(3*o*o-1),t[7]=1.092548*n*o,t[8]=.546274*(n*n-i*i)}}TI.prototype.isSphericalHarmonics3=!0;class EI extends ZI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new TI;super(void 0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}EI.prototype.isLightProbe=!0;class JI extends AI{constructor(e){super(e),this.textures={}}load(e,t,n,i){const o=this,r=new mI(o.manager);r.setPath(o.path),r.setRequestHeader(o.requestHeader),r.setWithCredentials(o.withCredentials),r.load(e,(function(n){try{t(o.parse(JSON.parse(n)))}catch(r){i?i(r):console.error(r),o.manager.itemError(e)}}),n,i)}parse(e){const t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const i=new Oc[e.type];if(void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&void 0!==i.color&&i.color.setHex(e.color),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.sheen&&(i.sheen=e.sheen),void 0!==e.sheenColor&&(i.sheenColor=(new kn).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(i.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==i.emissive&&i.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==i.specular&&i.specular.setHex(e.specular),void 0!==e.specularIntensity&&(i.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearcoat&&(i.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(i.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.transmission&&(i.transmission=e.transmission),void 0!==e.thickness&&(i.thickness=e.thickness),void 0!==e.attenuationDistance&&(i.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(e.attenuationColor),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.flatShading&&(i.flatShading=e.flatShading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.combine&&(i.combine=e.combine),void 0!==e.side&&(i.side=e.side),void 0!==e.shadowSide&&(i.shadowSide=e.shadowSide),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(i.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(i.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(i.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(i.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(i.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(i.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(i.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(i.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(i.rotation=e.rotation),1!==e.linewidth&&(i.linewidth=e.linewidth),void 0!==e.dashSize&&(i.dashSize=e.dashSize),void 0!==e.gapSize&&(i.gapSize=e.gapSize),void 0!==e.scale&&(i.scale=e.scale),void 0!==e.polygonOffset&&(i.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(i.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(i.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(i.dithering=e.dithering),void 0!==e.alphaToCoverage&&(i.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(i.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.toneMapped&&(i.toneMapped=e.toneMapped),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.vertexColors&&("number"===typeof e.vertexColors?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const o in e.uniforms){const t=e.uniforms[o];switch(i.uniforms[o]={},t.type){case"t":i.uniforms[o].value=n(t.value);break;case"c":i.uniforms[o].value=(new kn).setHex(t.value);break;case"v2":i.uniforms[o].value=(new Wn).fromArray(t.value);break;case"v3":i.uniforms[o].value=(new jn).fromArray(t.value);break;case"v4":i.uniforms[o].value=(new Un).fromArray(t.value);break;case"m3":i.uniforms[o].value=(new Sn).fromArray(t.value);break;case"m4":i.uniforms[o].value=(new Wi).fromArray(t.value);break;default:i.uniforms[o].value=t.value}}if(void 0!==e.defines&&(i.defines=e.defines),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(const o in e.extensions)i.extensions[o]=e.extensions[o];if(void 0!==e.shading&&(i.flatShading=1===e.shading),void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=n(e.map)),void 0!==e.matcap&&(i.matcap=n(e.matcap)),void 0!==e.alphaMap&&(i.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(i.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(i.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),i.normalScale=(new Wn).fromArray(t)}return void 0!==e.displacementMap&&(i.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(i.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularColorMap&&(i.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(i.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(i.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(i.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(i.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(i.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(i.clearcoatNormalScale=(new Wn).fromArray(e.clearcoatNormalScale)),void 0!==e.transmissionMap&&(i.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(i.thicknessMap=n(e.thicknessMap)),void 0!==e.sheenColorMap&&(i.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(i.sheenRoughnessMap=n(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}}class UI{static decodeText(e){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let i=0,o=e.length;i<o;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(n){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}static resolveURL(e,t){return"string"!==typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class DI extends Yo{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}DI.prototype.isInstancedBufferGeometry=!0;class PI extends AI{constructor(e){super(e)}load(e,t,n,i){const o=this,r=new mI(o.manager);r.setPath(o.path),r.setRequestHeader(o.requestHeader),r.setWithCredentials(o.withCredentials),r.load(e,(function(n){try{t(o.parse(JSON.parse(n)))}catch(r){i?i(r):console.error(r),o.manager.itemError(e)}}),n,i)}parse(e){const t={},n={};function i(e,i){if(void 0!==t[i])return t[i];const o=e.interleavedBuffers[i],r=function(e,t){if(void 0!==n[t])return n[t];const i=e.arrayBuffers,o=i[t],r=new Uint32Array(o).buffer;return n[t]=r,r}(e,o.buffer),a=Vn(o.type,r),s=new ug(a,o.stride);return s.uuid=o.uuid,t[i]=s,s}const o=e.isInstancedBufferGeometry?new DI:new Yo,r=e.data.index;if(void 0!==r){const e=Vn(r.type,r.array);o.setIndex(new Ao(e,1))}const a=e.data.attributes;for(const c in a){const t=a[c];let n;if(t.isInterleavedBufferAttribute){const o=i(e.data,t.data);n=new hg(o,t.itemSize,t.offset,t.normalized)}else{const e=Vn(t.type,t.array);n=new(t.isInstancedBufferAttribute?Dg:Ao)(e,t.itemSize,t.normalized)}void 0!==t.name&&(n.name=t.name),void 0!==t.usage&&n.setUsage(t.usage),void 0!==t.updateRange&&(n.updateRange.offset=t.updateRange.offset,n.updateRange.count=t.updateRange.count),o.setAttribute(c,n)}const s=e.data.morphAttributes;if(s)for(const c in s){const t=s[c],n=[];for(let o=0,r=t.length;o<r;o++){const r=t[o];let a;if(r.isInterleavedBufferAttribute){const t=i(e.data,r.data);a=new hg(t,r.itemSize,r.offset,r.normalized)}else{const e=Vn(r.type,r.array);a=new Ao(e,r.itemSize,r.normalized)}void 0!==r.name&&(a.name=r.name),n.push(a)}o.morphAttributes[c]=n}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const g=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==g)for(let c=0,I=g.length;c!==I;++c){const e=g[c];o.addGroup(e.start,e.count,e.materialIndex)}const l=e.data.boundingSphere;if(void 0!==l){const e=new jn;void 0!==l.center&&e.fromArray(l.center),o.boundingSphere=new mi(e,l.radius)}return e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class QI extends AI{constructor(e){super(e)}load(e,t,n,i){const o=this,r=""===this.path?UI.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const a=new mI(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){let r=null;try{r=JSON.parse(n)}catch(s){return void 0!==i&&i(s),void console.error("THREE:ObjectLoader: Can't parse "+e+".",s.message)}const a=r.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?o.parse(r,t):console.error("THREE.ObjectLoader: Can't load "+e)}),n,i)}async loadAsync(e,t){const n=""===this.path?UI.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const i=new mI(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials);const o=await i.loadAsync(e,t),r=JSON.parse(o),a=r.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(r)}parse(e,t){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),o=this.parseGeometries(e.geometries,i),r=this.parseImages(e.images,(function(){void 0!==t&&t(g)})),a=this.parseTextures(e.textures,r),s=this.parseMaterials(e.materials,a),g=this.parseObject(e.object,o,s,a,n),l=this.parseSkeletons(e.skeletons,g);if(this.bindSkeletons(g,l),void 0!==t){let e=!1;for(const t in r)if(r[t]instanceof HTMLImageElement){e=!0;break}!1===e&&t(g)}return g}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,n),o=await this.parseImagesAsync(e.images),r=this.parseTextures(e.textures,o),a=this.parseMaterials(e.materials,r),s=this.parseObject(e.object,i,a,r,t),g=this.parseSkeletons(e.skeletons,s);return this.bindSkeletons(s,g),s}parseShapes(e){const t={};if(void 0!==e)for(let n=0,i=e.length;n<i;n++){const i=(new ql).fromJSON(e[n]);t[i.uuid]=i}return t}parseSkeletons(e,t){const n={},i={};if(t.traverse((function(e){e.isBone&&(i[e.uuid]=e)})),void 0!==e)for(let o=0,r=e.length;o<r;o++){const t=(new Ug).fromJSON(e[o],i);n[t.uuid]=t}return n}parseGeometries(e,t){const n={};if(void 0!==e){const i=new PI;for(let o=0,r=e.length;o<r;o++){let r;const a=e[o];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":r=i.parse(a);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:a.type in Lc?r=Lc[a.type].fromJSON(a,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${a.type}"`)}r.uuid=a.uuid,void 0!==a.name&&(r.name=a.name),!0===r.isBufferGeometry&&void 0!==a.userData&&(r.userData=a.userData),n[a.uuid]=r}}return n}parseMaterials(e,t){const n={},i={};if(void 0!==e){const o=new JI;o.setTextures(t);for(let t=0,r=e.length;t<r;t++){const r=e[t];if("MultiMaterial"===r.type){const e=[];for(let t=0;t<r.materials.length;t++){const i=r.materials[t];void 0===n[i.uuid]&&(n[i.uuid]=o.parse(i)),e.push(n[i.uuid])}i[r.uuid]=e}else void 0===n[r.uuid]&&(n[r.uuid]=o.parse(r)),i[r.uuid]=n[r.uuid]}}return i}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const i=e[n],o=II.parse(i);t[o.uuid]=o}return t}parseImages(e,t){const n=this,i={};let o;function r(e){if("string"===typeof e){const t=e;return function(e){return n.manager.itemStart(e),o.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:Vn(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new dI(t);o=new yI(n),o.setCrossOrigin(this.crossOrigin);for(let t=0,o=e.length;t<o;t++){const n=e[t],o=n.url;if(Array.isArray(o)){i[n.uuid]=[];for(let e=0,t=o.length;e<t;e++){const t=r(o[e]);null!==t&&(t instanceof HTMLImageElement?i[n.uuid].push(t):i[n.uuid].push(new Tg(t.data,t.width,t.height)))}}else{const e=r(n.url);null!==e&&(i[n.uuid]=e)}}}return i}async parseImagesAsync(e){const t=this,n={};let i;async function o(e){if("string"===typeof e){const n=e,o=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:t.resourcePath+n;return await i.loadAsync(o)}return e.data?{data:Vn(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){i=new yI(this.manager),i.setCrossOrigin(this.crossOrigin);for(let t=0,i=e.length;t<i;t++){const i=e[t],r=i.url;if(Array.isArray(r)){n[i.uuid]=[];for(let e=0,t=r.length;e<t;e++){const t=r[e],a=await o(t);null!==a&&(a instanceof HTMLImageElement?n[i.uuid].push(a):n[i.uuid].push(new Tg(a.data,a.width,a.height)))}}else{const e=await o(i.url);null!==e&&(n[i.uuid]=e)}}}return n}parseTextures(e,t){function n(e,t){return"number"===typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const i={};if(void 0!==e)for(let o=0,r=e.length;o<r;o++){const r=e[o];let a;void 0===r.image&&console.warn('THREE.ObjectLoader: No "image" specified for',r.uuid),void 0===t[r.image]&&console.warn("THREE.ObjectLoader: Undefined image",r.image);const s=t[r.image];Array.isArray(s)?(a=new lr(s),6===s.length&&(a.needsUpdate=!0)):(a=s&&s.data?new Tg(s.data,s.width,s.height):new En(s),s&&(a.needsUpdate=!0)),a.uuid=r.uuid,void 0!==r.name&&(a.name=r.name),void 0!==r.mapping&&(a.mapping=n(r.mapping,_I)),void 0!==r.offset&&a.offset.fromArray(r.offset),void 0!==r.repeat&&a.repeat.fromArray(r.repeat),void 0!==r.center&&a.center.fromArray(r.center),void 0!==r.rotation&&(a.rotation=r.rotation),void 0!==r.wrap&&(a.wrapS=n(r.wrap[0],jI),a.wrapT=n(r.wrap[1],jI)),void 0!==r.format&&(a.format=r.format),void 0!==r.type&&(a.type=r.type),void 0!==r.encoding&&(a.encoding=r.encoding),void 0!==r.minFilter&&(a.minFilter=n(r.minFilter,OI)),void 0!==r.magFilter&&(a.magFilter=n(r.magFilter,OI)),void 0!==r.anisotropy&&(a.anisotropy=r.anisotropy),void 0!==r.flipY&&(a.flipY=r.flipY),void 0!==r.premultiplyAlpha&&(a.premultiplyAlpha=r.premultiplyAlpha),void 0!==r.unpackAlignment&&(a.unpackAlignment=r.unpackAlignment),void 0!==r.userData&&(a.userData=r.userData),i[r.uuid]=a}return i}parseObject(e,t,n,i,o){let r,a,s;function g(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function l(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let i=0,o=e.length;i<o;i++){const o=e[i];void 0===n[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),t.push(n[o])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}function c(e){return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),i[e]}switch(e.type){case"Scene":r=new Cg,void 0!==e.background&&(Number.isInteger(e.background)?r.background=new kn(e.background):r.background=c(e.background)),void 0!==e.environment&&(r.environment=c(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?r.fog=new Ig(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(r.fog=new cg(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":r=new ar(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(r.focus=e.focus),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.filmGauge&&(r.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(r.filmOffset=e.filmOffset),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"OrthographicCamera":r=new xr(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"AmbientLight":r=new zI(e.color,e.intensity);break;case"DirectionalLight":r=new kI(e.color,e.intensity);break;case"PointLight":r=new MI(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":r=new LI(e.color,e.intensity,e.width,e.height);break;case"SpotLight":r=new XI(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":r=new wI(e.color,e.groundColor,e.intensity);break;case"LightProbe":r=(new EI).fromJSON(e);break;case"SkinnedMesh":a=g(e.geometry),s=l(e.material),r=new zg(a,s),void 0!==e.bindMode&&(r.bindMode=e.bindMode),void 0!==e.bindMatrix&&r.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(r.skeleton=e.skeleton);break;case"Mesh":a=g(e.geometry),s=l(e.material),r=new qo(a,s);break;case"InstancedMesh":a=g(e.geometry),s=l(e.material);const t=e.count,n=e.instanceMatrix,i=e.instanceColor;r=new Og(a,s,t),r.instanceMatrix=new Dg(new Float32Array(n.array),16),void 0!==i&&(r.instanceColor=new Dg(new Float32Array(i.array),i.itemSize));break;case"LOD":r=new Yg;break;case"Line":r=new ol(g(e.geometry),l(e.material));break;case"LineLoop":r=new gl(g(e.geometry),l(e.material));break;case"LineSegments":r=new sl(g(e.geometry),l(e.material));break;case"PointCloud":case"Points":r=new dl(g(e.geometry),l(e.material));break;case"Sprite":r=new xg(l(e.material));break;case"Group":r=new ng;break;case"Bone":r=new Lg;break;default:r=new qi}if(r.uuid=e.uuid,void 0!==e.name&&(r.name=e.name),void 0!==e.matrix?(r.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(r.matrixAutoUpdate=e.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==e.position&&r.position.fromArray(e.position),void 0!==e.rotation&&r.rotation.fromArray(e.rotation),void 0!==e.quaternion&&r.quaternion.fromArray(e.quaternion),void 0!==e.scale&&r.scale.fromArray(e.scale)),void 0!==e.castShadow&&(r.castShadow=e.castShadow),void 0!==e.receiveShadow&&(r.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(r.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(r.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(r.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&r.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(r.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.frustumCulled&&(r.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(r.renderOrder=e.renderOrder),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.layers&&(r.layers.mask=e.layers),void 0!==e.children){const a=e.children;for(let e=0;e<a.length;e++)r.add(this.parseObject(a[e],t,n,i,o))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];r.animations.push(o[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(r.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],i=r.getObjectByProperty("uuid",n.object);void 0!==i&&r.addLevel(i,n.distance)}}return r}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}}))}setTexturePath(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}const _I={UVMapping:oe,CubeReflectionMapping:re,CubeRefractionMapping:ae,EquirectangularReflectionMapping:se,EquirectangularRefractionMapping:ge,CubeUVReflectionMapping:le,CubeUVRefractionMapping:ce},jI={RepeatWrapping:Ie,ClampToEdgeWrapping:Ce,MirroredRepeatWrapping:ue},OI={NearestFilter:de,NearestMipmapNearestFilter:he,NearestMipmapLinearFilter:pe,LinearFilter:be,LinearMipmapNearestFilter:fe,LinearMipmapLinearFilter:Ge};class qI extends AI{constructor(e){super(e),"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,r=uI.get(e);if(void 0!==r)return o.manager.itemStart(e),setTimeout((function(){t&&t(r),o.manager.itemEnd(e)}),0),r;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(o.options,{colorSpaceConversion:"none"}))})).then((function(n){uI.add(e,n),t&&t(n),o.manager.itemEnd(e)})).catch((function(t){i&&i(t),o.manager.itemError(e),o.manager.itemEnd(e)})),o.manager.itemStart(e)}}let $I;qI.prototype.isImageBitmapLoader=!0;const eC={getContext:function(){return void 0===$I&&($I=new(window.AudioContext||window.webkitAudioContext)),$I},setContext:function(e){$I=e}};class tC extends AI{constructor(e){super(e)}load(e,t,n,i){const o=this,r=new mI(this.manager);r.setResponseType("arraybuffer"),r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(function(n){try{const e=n.slice(0);eC.getContext().decodeAudioData(e,(function(e){t(e)}))}catch(r){i?i(r):console.error(r),o.manager.itemError(e)}}),n,i)}}class nC extends EI{constructor(e,t){super(void 0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1);const n=(new kn).set(e),i=(new kn).set(t),o=new jn(n.r,n.g,n.b),r=new jn(i.r,i.g,i.b),a=Math.sqrt(Math.PI),s=a*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(r).multiplyScalar(a),this.sh.coefficients[1].copy(o).sub(r).multiplyScalar(s)}}nC.prototype.isHemisphereLightProbe=!0;class iC extends EI{constructor(e){super(void 0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);const t=(new kn).set(e);this.sh.coefficients[0].set(t.r,t.g,t.b).multiplyScalar(2*Math.sqrt(Math.PI))}}iC.prototype.isAmbientLightProbe=!0;const oC=new Wi,rC=new Wi,aC=new Wi;class sC{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ar,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ar,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,aC.copy(e.projectionMatrix);const n=t.eyeSep/2,i=n*t.near/t.focus,o=t.near*Math.tan(pn*t.fov*.5)/t.zoom;let r,a;rC.elements[12]=-n,oC.elements[12]=n,r=-o*t.aspect+i,a=o*t.aspect+i,aC.elements[0]=2*t.near/(a-r),aC.elements[8]=(a+r)/(a-r),this.cameraL.projectionMatrix.copy(aC),r=-o*t.aspect-i,a=o*t.aspect-i,aC.elements[0]=2*t.near/(a-r),aC.elements[8]=(a+r)/(a-r),this.cameraR.projectionMatrix.copy(aC)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(rC),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(oC)}}class gC{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=lC(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=lC();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function lC(){return("undefined"===typeof performance?Date:performance).now()}const cC=new jn,IC=new _n,CC=new jn,uC=new jn;class dC extends qi{constructor(){super(),this.type="AudioListener",this.context=eC.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new gC}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(cC,IC,CC),uC.set(0,0,-1).applyQuaternion(IC),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(cC.x,e),t.positionY.linearRampToValueAtTime(cC.y,e),t.positionZ.linearRampToValueAtTime(cC.z,e),t.forwardX.linearRampToValueAtTime(uC.x,e),t.forwardY.linearRampToValueAtTime(uC.y,e),t.forwardZ.linearRampToValueAtTime(uC.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)}else t.setPosition(cC.x,cC.y,cC.z),t.setOrientation(uC.x,uC.y,uC.z,n.x,n.y,n.z)}}class hC extends qi{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const AC=new jn,pC=new _n,mC=new jn,bC=new jn;class fC extends hC{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(AC,pC,mC),bC.set(0,0,1).applyQuaternion(pC);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(AC.x,e),t.positionY.linearRampToValueAtTime(AC.y,e),t.positionZ.linearRampToValueAtTime(AC.z,e),t.orientationX.linearRampToValueAtTime(bC.x,e),t.orientationY.linearRampToValueAtTime(bC.y,e),t.orientationZ.linearRampToValueAtTime(bC.z,e)}else t.setPosition(AC.x,AC.y,AC.z),t.setOrientation(bC.x,bC.y,bC.z)}}class yC{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2048;this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class GC{constructor(e,t,n){let i,o,r;switch(this.binding=e,this.valueSize=n,t){case"quaternion":i=this._slerp,o=this._slerpAdditive,r=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,o=this._select,r=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,o=this._lerpAdditive,r=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=o,this._setIdentity=r,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,o=e*i+i;let r=this.cumulativeWeight;if(0===r){for(let e=0;e!==i;++e)n[o+e]=n[e];r=t}else{r+=t;const e=t/r;this._mixBufferRegion(n,o,0,e,i)}this.cumulativeWeight=r}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,o=this.cumulativeWeight,r=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,o<1){const e=t*this._origIndex;this._mixBufferRegion(n,i,e,1-o,t)}r>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let s=t,g=t+t;s!==g;++s)if(n[s]!==n[s+t]){a.setValue(n,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let o=n,r=i;o!==r;++o)t[o]=t[i+o%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,o){if(i>=.5)for(let r=0;r!==o;++r)e[t+r]=e[n+r]}_slerp(e,t,n,i){_n.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,o){const r=this._workIndex*o;_n.multiplyQuaternionsFlat(e,r,e,t,e,n),_n.slerpFlat(e,t,e,t,e,r,i)}_lerp(e,t,n,i,o){const r=1-i;for(let a=0;a!==o;++a){const o=t+a;e[o]=e[o]*r+e[n+a]*i}}_lerpAdditive(e,t,n,i,o){for(let r=0;r!==o;++r){const o=t+r;e[o]=e[o]+e[n+r]*i}}}const vC="\\[\\]\\.:\\/",BC=new RegExp("["+vC+"]","g"),ZC="[^"+vC+"]",wC="[^"+vC.replace("\\.","")+"]",WC=/((?:WC+[\/:])*)/.source.replace("WC",ZC),SC=/(WCOD+)?/.source.replace("WCOD",wC),RC=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",ZC),xC=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",ZC),VC=new RegExp("^"+WC+SC+RC+xC+"$"),XC=["material","materials","bones"];class HC{constructor(e,t,n){this.path=t,this.parsedPath=n||HC.parseTrackName(t),this.node=HC.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new HC.Composite(e,t,n):new HC(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(BC,"")}static parseTrackName(e){const t=VC.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const e=n.nodeName.substring(i+1);-1!==XC.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let i=0;i<e.length;i++){const o=e[i];if(o.name===t||o.uuid===t)return o;const r=n(o.children);if(r)return r}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,o=n.length;i!==o;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,o=n.length;i!==o;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,o=n.length;i!==o;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,o=n.length;i!==o;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let o=t.propertyIndex;if(e||(e=HC.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let i=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==i){if(void 0===e[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[i]}}const r=e[i];if(void 0===r){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",e)}let a=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==o){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[o]&&(o=e.morphTargetDictionary[o])}s=this.BindingType.ArrayElement,this.resolvedProperty=r,this.propertyIndex=o}else void 0!==r.fromArray&&void 0!==r.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=r):Array.isArray(r)?(s=this.BindingType.EntireArray,this.resolvedProperty=r):this.propertyName=i;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}HC.Composite=class{constructor(e,t,n){const i=n||HC.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,o=n.length;i!==o;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},HC.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},HC.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},HC.prototype.GetterByBindingType=[HC.prototype._getValue_direct,HC.prototype._getValue_array,HC.prototype._getValue_arrayElement,HC.prototype._getValue_toArray],HC.prototype.SetterByBindingTypeAndVersioning=[[HC.prototype._setValue_direct,HC.prototype._setValue_direct_setNeedsUpdate,HC.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[HC.prototype._setValue_array,HC.prototype._setValue_array_setNeedsUpdate,HC.prototype._setValue_array_setMatrixWorldNeedsUpdate],[HC.prototype._setValue_arrayElement,HC.prototype._setValue_arrayElement_setNeedsUpdate,HC.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[HC.prototype._setValue_fromArray,HC.prototype._setValue_fromArray_setNeedsUpdate,HC.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class YC{constructor(){this.uuid=bn(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,i=arguments.length;n!==i;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,o=this._bindings,r=o.length;let a,s=e.length,g=this.nCachedObjects_;for(let l=0,c=arguments.length;l!==c;++l){const c=arguments[l],I=c.uuid;let C=t[I];if(void 0===C){C=s++,t[I]=C,e.push(c);for(let e=0,t=r;e!==t;++e)o[e].push(new HC(c,n[e],i[e]))}else if(C<g){a=e[C];const s=--g,l=e[s];t[l.uuid]=C,e[C]=l,t[I]=s,e[s]=c;for(let e=0,t=r;e!==t;++e){const t=o[e],r=t[s];let a=t[C];t[C]=r,void 0===a&&(a=new HC(c,n[e],i[e])),t[s]=a}}else e[C]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=g}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let o=this.nCachedObjects_;for(let r=0,a=arguments.length;r!==a;++r){const a=arguments[r],s=a.uuid,g=t[s];if(void 0!==g&&g>=o){const r=o++,l=e[r];t[l.uuid]=g,e[g]=l,t[s]=r,e[r]=a;for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[r],o=t[g];t[g]=i,t[r]=o}}}this.nCachedObjects_=o}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let o=this.nCachedObjects_,r=e.length;for(let a=0,s=arguments.length;a!==s;++a){const s=arguments[a].uuid,g=t[s];if(void 0!==g)if(delete t[s],g<o){const a=--o,s=e[a],l=--r,c=e[l];t[s.uuid]=g,e[g]=s,t[c.uuid]=a,e[a]=c,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[a],o=t[l];t[g]=i,t[a]=o,t.pop()}}else{const o=--r,a=e[o];o>0&&(t[a.uuid]=g),e[g]=a,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e];t[g]=t[o],t.pop()}}}this.nCachedObjects_=o}subscribe_(e,t){const n=this._bindingsIndicesByPath;let i=n[e];const o=this._bindings;if(void 0!==i)return o[i];const r=this._paths,a=this._parsedPaths,s=this._objects,g=s.length,l=this.nCachedObjects_,c=new Array(g);i=o.length,n[e]=i,r.push(e),a.push(t),o.push(c);for(let I=l,C=s.length;I!==C;++I){const n=s[I];c[I]=new HC(n,e,t)}return c}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const i=this._paths,o=this._parsedPaths,r=this._bindings,a=r.length-1,s=r[a];t[e[a]]=n,r[n]=s,r.pop(),o[n]=o[a],o.pop(),i[n]=i[a],i.pop()}}}YC.prototype.isAnimationObjectGroup=!0;class KC{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.blendMode;this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const o=t.tracks,r=o.length,a=new Array(r),s={endingStart:Zt,endingEnd:Zt};for(let g=0;g!==r;++g){const e=o[g].createInterpolant(null);a[g]=e,e.settings=s}this._interpolantSettings=s,this._interpolants=a,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=ft,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,i=e._clip.duration,o=i/n,r=n/i;e.warp(1,o,t),this.warp(r,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,o=i.time,r=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);const s=a.parameterPositions,g=a.sampleValues;return s[0]=o,s[1]=o+n,g[0]=e/r,g[1]=t/r,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled)return void this._updateWeight(e);const o=this._startTime;if(null!==o){const i=(e-o)*n;if(i<0||0===n)return;this._startTime=null,t=n*i}t*=this._updateTimeScale(e);const r=this._updateTime(t),a=this._updateWeight(e);if(a>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===Rt)for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(r),t[n].accumulateAdditive(a);else for(let n=0,o=e.length;n!==o;++n)e[n].evaluate(r),t[n].accumulate(i,a)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,o=this._loopCount;const r=n===yt;if(0===e)return-1===o?i:r&&1===(1&o)?t-i:i;if(n===bt){-1===o&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===o&&(e>=0?(o=0,this._setEndings(!0,0===this.repetitions,r)):this._setEndings(0===this.repetitions,!0,r)),i>=t||i<0){const n=Math.floor(i/t);i-=t*n,o+=Math.abs(n);const a=this.repetitions-o;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){const t=e<0;this._setEndings(t,!t,r)}else this._setEndings(!1,!1,r);this._loopCount=o,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(r&&1===(1&o))return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=wt,i.endingEnd=wt):(i.endingStart=e?this.zeroSlopeAtStart?wt:Zt:Wt,i.endingEnd=t?this.zeroSlopeAtEnd?wt:Zt:Wt)}_scheduleFading(e,t,n){const i=this._mixer,o=i.time;let r=this._weightInterpolant;null===r&&(r=i._lendControlInterpolant(),this._weightInterpolant=r);const a=r.parameterPositions,s=r.sampleValues;return a[0]=o,s[0]=t,a[1]=o+e,s[1]=n,this}}class NC extends dn{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,o=i.length,r=e._propertyBindings,a=e._interpolants,s=n.uuid,g=this._bindingsByRootAndName;let l=g[s];void 0===l&&(l={},g[s]=l);for(let c=0;c!==o;++c){const e=i[c],o=e.name;let g=l[o];if(void 0!==g)++g.referenceCount,r[c]=g;else{if(g=r[c],void 0!==g){null===g._cacheIndex&&(++g.referenceCount,this._addInactiveBinding(g,s,o));continue}const i=t&&t._propertyBindings[c].binding.parsedPath;g=new GC(HC.create(n,o,i),e.ValueTypeName,e.getValueSize()),++g.referenceCount,this._addInactiveBinding(g,s,o),r[c]=g}a[c].resultBuffer=g.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0===n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0===--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,o=this._actionsByClip;let r=o[t];if(void 0===r)r={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,o[t]=r;else{const t=r.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=i.length,i.push(e),r.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const o=e._clip.uuid,r=this._actionsByClip,a=r[o],s=a.knownActions,g=s[s.length-1],l=e._byClipCacheIndex;g._byClipCacheIndex=l,s[l]=g,s.pop(),e._byClipCacheIndex=null;delete a.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete r[o],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const e=t[n];0===--e.referenceCount&&this._removeInactiveBinding(e)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,o=t[i];e._cacheIndex=i,t[i]=e,o._cacheIndex=n,t[n]=o}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,o=t[i];e._cacheIndex=i,t[i]=e,o._cacheIndex=n,t[n]=o}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,o=this._bindings;let r=i[t];void 0===r&&(r={},i[t]=r),r[n]=e,e._cacheIndex=o.length,o.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,o=n.path,r=this._bindingsByRootAndName,a=r[i],s=t[t.length-1],g=e._cacheIndex;s._cacheIndex=g,t[g]=s,t.pop(),delete a[o],0===Object.keys(a).length&&delete r[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,o=t[i];e._cacheIndex=i,t[i]=e,o._cacheIndex=n,t[n]=o}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,o=t[i];e._cacheIndex=i,t[i]=e,o._cacheIndex=n,t[n]=o}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new tI(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,o=t[i];e.__cacheIndex=i,t[i]=e,o.__cacheIndex=n,t[n]=o}clipAction(e,t,n){const i=t||this._root,o=i.uuid;let r="string"===typeof e?II.findByName(i,e):e;const a=null!==r?r.uuid:e,s=this._actionsByClip[a];let g=null;if(void 0===n&&(n=null!==r?r.blendMode:St),void 0!==s){const e=s.actionByRoot[o];if(void 0!==e&&e.blendMode===n)return e;g=s.knownActions[0],null===r&&(r=g._clip)}if(null===r)return null;const l=new KC(this,r,t,n);return this._bindAction(l,g),this._addInactiveAction(l,a,o),l}existingAction(e,t){const n=t||this._root,i=n.uuid,o="string"===typeof e?II.findByName(n,e):e,r=o?o.uuid:e,a=this._actionsByClip[r];return void 0!==a&&a.actionByRoot[i]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,o=Math.sign(e),r=this._accuIndex^=1;for(let g=0;g!==n;++g){t[g]._update(i,e,o,r)}const a=this._bindings,s=this._nActiveBindings;for(let g=0;g!==s;++g)a[g].apply(r);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,o=i[n];if(void 0!==o){const e=o.knownActions;for(let n=0,i=e.length;n!==i;++n){const i=e[n];this._deactivateAction(i);const o=i._cacheIndex,r=t[t.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,r._cacheIndex=o,t[o]=r,t.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const o in n){const e=n[o].actionByRoot[t];void 0!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}const i=this._bindingsByRootAndName[t];if(void 0!==i)for(const o in i){const e=i[o];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}NC.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class MC{constructor(e){"string"===typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new MC(void 0===this.value.clone?this.value:this.value.clone())}}class FC extends ug{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(e,t),this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}FC.prototype.isInstancedInterleavedBuffer=!0;class kC{constructor(e,t,n,i,o){this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=o,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}kC.prototype.isGLBufferAttribute=!0;class zC{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;this.ray=new wi(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new Fi,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return TC(e,this,t,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),t.sort(LC),t}intersectObjects(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];for(let i=0,o=e.length;i<o;i++)TC(e[i],this,n,t);return n.sort(LC),n}}function LC(e,t){return e.distance-t.distance}function TC(e,t,n,i){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===i){const i=e.children;for(let e=0,o=i.length;e<o;e++)TC(i[e],t,n,!0)}}class EC{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(fn(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class JC{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}}const UC=new Wn;class DC{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Wn(1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Wn(-1/0,-1/0);this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=UC.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return UC.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}DC.prototype.isBox2=!0;const PC=new jn,QC=new jn;class _C{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new jn,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new jn;this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){PC.subVectors(e,this.start),QC.subVectors(this.end,this.start);const n=QC.dot(QC);let i=QC.dot(PC)/n;return t&&(i=fn(i,0,1)),i}closestPointToPoint(e,t,n){const i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const jC=new jn;class OC extends qi{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const n=new Yo,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let r=0,a=1,s=32;r<s;r++,a++){const e=r/s*Math.PI*2,t=a/s*Math.PI*2;i.push(Math.cos(e),Math.sin(e),1,Math.cos(t),Math.sin(t),1)}n.setAttribute("position",new Zo(i,3));const o=new qg({fog:!1,toneMapped:!1});this.cone=new sl(n,o),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),jC.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(jC),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const qC=new jn,$C=new Wi,eu=new Wi;class tu extends sl{constructor(e){const t=nu(e),n=new Yo,i=[],o=[],r=new kn(0,0,1),a=new kn(0,1,0);for(let s=0;s<t.length;s++){const e=t[s];e.parent&&e.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),o.push(r.r,r.g,r.b),o.push(a.r,a.g,a.b))}n.setAttribute("position",new Zo(i,3)),n.setAttribute("color",new Zo(o,3));super(n,new qg({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");eu.copy(this.root.matrixWorld).invert();for(let o=0,r=0;o<t.length;o++){const e=t[o];e.parent&&e.parent.isBone&&($C.multiplyMatrices(eu,e.matrixWorld),qC.setFromMatrixPosition($C),i.setXYZ(r,qC.x,qC.y,qC.z),$C.multiplyMatrices(eu,e.parent.matrixWorld),qC.setFromMatrixPosition($C),i.setXYZ(r+1,qC.x,qC.y,qC.z),r+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function nu(e){const t=[];e&&e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push.apply(t,nu(e.children[n]));return t}class iu extends qo{constructor(e,t,n){super(new Yc(t,4,2),new Co({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const ou=new jn,ru=new kn,au=new kn;class su extends qi{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const i=new Vc(t);i.rotateY(.5*Math.PI),this.material=new Co({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const o=i.getAttribute("position"),r=new Float32Array(3*o.count);i.setAttribute("color",new Ao(r,3)),this.add(new qo(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");ru.copy(this.light.color),au.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const i=e<n/2?ru:au;t.setXYZ(e,i.r,i.g,i.b)}t.needsUpdate=!0}e.lookAt(ou.setFromMatrixPosition(this.light.matrixWorld).negate())}}class gu extends sl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4473924,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8947848;n=new kn(n),i=new kn(i);const o=t/2,r=e/t,a=e/2,s=[],g=[];for(let c=0,I=0,C=-a;c<=t;c++,C+=r){s.push(-a,0,C,a,0,C),s.push(C,0,-a,C,0,a);const e=c===o?n:i;e.toArray(g,I),I+=3,e.toArray(g,I),I+=3,e.toArray(g,I),I+=3,e.toArray(g,I),I+=3}const l=new Yo;l.setAttribute("position",new Zo(s,3)),l.setAttribute("color",new Zo(g,3));super(l,new qg({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class lu extends sl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:64,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4473924,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:8947848;o=new kn(o),r=new kn(r);const a=[],s=[];for(let l=0;l<=t;l++){const n=l/t*(2*Math.PI),i=Math.sin(n)*e,g=Math.cos(n)*e;a.push(0,0,0),a.push(i,0,g);const c=1&l?o:r;s.push(c.r,c.g,c.b),s.push(c.r,c.g,c.b)}for(let l=0;l<=n;l++){const t=1&l?o:r,g=e-e/n*l;for(let e=0;e<i;e++){let n=e/i*(2*Math.PI),o=Math.sin(n)*g,r=Math.cos(n)*g;a.push(o,0,r),s.push(t.r,t.g,t.b),n=(e+1)/i*(2*Math.PI),o=Math.sin(n)*g,r=Math.cos(n)*g,a.push(o,0,r),s.push(t.r,t.g,t.b)}}const g=new Yo;g.setAttribute("position",new Zo(a,3)),g.setAttribute("color",new Zo(s,3));super(g,new qg({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const cu=new jn,Iu=new jn,Cu=new jn;class uu extends qi{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===t&&(t=1);let i=new Yo;i.setAttribute("position",new Zo([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const o=new qg({fog:!1,toneMapped:!1});this.lightPlane=new ol(i,o),this.add(this.lightPlane),i=new Yo,i.setAttribute("position",new Zo([0,0,0,0,0,1],3)),this.targetLine=new ol(i,o),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){cu.setFromMatrixPosition(this.light.matrixWorld),Iu.setFromMatrixPosition(this.light.target.matrixWorld),Cu.subVectors(Iu,cu),this.lightPlane.lookAt(Iu),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Iu),this.targetLine.scale.z=Cu.length()}}const du=new jn,hu=new rr;class Au extends sl{constructor(e){const t=new Yo,n=new qg({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],o=[],r={},a=new kn(16755200),s=new kn(16711680),g=new kn(43775),l=new kn(16777215),c=new kn(3355443);function I(e,t,n){C(e,n),C(t,n)}function C(e,t){i.push(0,0,0),o.push(t.r,t.g,t.b),void 0===r[e]&&(r[e]=[]),r[e].push(i.length/3-1)}I("n1","n2",a),I("n2","n4",a),I("n4","n3",a),I("n3","n1",a),I("f1","f2",a),I("f2","f4",a),I("f4","f3",a),I("f3","f1",a),I("n1","f1",a),I("n2","f2",a),I("n3","f3",a),I("n4","f4",a),I("p","n1",s),I("p","n2",s),I("p","n3",s),I("p","n4",s),I("u1","u2",g),I("u2","u3",g),I("u3","u1",g),I("c","t",l),I("p","c",c),I("cn1","cn2",c),I("cn3","cn4",c),I("cf1","cf2",c),I("cf3","cf4",c),t.setAttribute("position",new Zo(i,3)),t.setAttribute("color",new Zo(o,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=r,this.update()}update(){const e=this.geometry,t=this.pointMap;hu.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),pu("c",t,e,hu,0,0,-1),pu("t",t,e,hu,0,0,1),pu("n1",t,e,hu,-1,-1,-1),pu("n2",t,e,hu,1,-1,-1),pu("n3",t,e,hu,-1,1,-1),pu("n4",t,e,hu,1,1,-1),pu("f1",t,e,hu,-1,-1,1),pu("f2",t,e,hu,1,-1,1),pu("f3",t,e,hu,-1,1,1),pu("f4",t,e,hu,1,1,1),pu("u1",t,e,hu,.7,1.1,-1),pu("u2",t,e,hu,-.7,1.1,-1),pu("u3",t,e,hu,0,2,-1),pu("cf1",t,e,hu,-1,0,1),pu("cf2",t,e,hu,1,0,1),pu("cf3",t,e,hu,0,-1,1),pu("cf4",t,e,hu,0,1,1),pu("cn1",t,e,hu,-1,0,-1),pu("cn2",t,e,hu,1,0,-1),pu("cn3",t,e,hu,0,-1,-1),pu("cn4",t,e,hu,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function pu(e,t,n,i,o,r,a){du.set(o,r,a).unproject(i);const s=t[e];if(void 0!==s){const e=n.getAttribute("position");for(let t=0,n=s.length;t<n;t++)e.setXYZ(s[t],du.x,du.y,du.z)}}const mu=new $n;class bu extends sl{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),o=new Yo;o.setIndex(new Ao(n,1)),o.setAttribute("position",new Ao(i,3)),super(o,new qg({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&mu.setFromObject(this.object),mu.isEmpty())return;const t=mu.min,n=mu.max,i=this.geometry.attributes.position,o=i.array;o[0]=n.x,o[1]=n.y,o[2]=n.z,o[3]=t.x,o[4]=n.y,o[5]=n.z,o[6]=t.x,o[7]=t.y,o[8]=n.z,o[9]=n.x,o[10]=t.y,o[11]=n.z,o[12]=n.x,o[13]=n.y,o[14]=t.z,o[15]=t.x,o[16]=n.y,o[17]=t.z,o[18]=t.x,o[19]=t.y,o[20]=t.z,o[21]=n.x,o[22]=t.y,o[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return sl.prototype.copy.call(this,e),this.object=e.object,this}}class fu extends sl{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Yo;i.setIndex(new Ao(n,1)),i.setAttribute("position",new Zo([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new qg({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}class yu extends ol{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16776960,i=new Yo;i.setAttribute("position",new Zo([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),super(i,new qg({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const o=new Yo;o.setAttribute("position",new Zo([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new qo(o,new Co({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?h:d,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}}const Gu=new jn;let vu,Bu;class Zu extends qi{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new jn(0,0,1),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new jn(0,0,0),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16776960,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.2*n,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.2*o;super(),this.type="ArrowHelper",void 0===vu&&(vu=new Yo,vu.setAttribute("position",new Zo([0,0,0,0,1,0],3)),Bu=new yl(0,.5,1,5,1),Bu.translate(0,-.5,0)),this.position.copy(t),this.line=new ol(vu,new qg({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new qo(Bu,new Co({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,o,r)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Gu.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Gu,t)}}setLength(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2*e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.2*t;this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}class wu extends sl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new Yo;n.setAttribute("position",new Zo(t,3)),n.setAttribute("color",new Zo([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new qg({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){const i=new kn,o=this.geometry.attributes.color.array;return i.set(e),i.toArray(o,0),i.toArray(o,3),i.set(t),i.toArray(o,6),i.toArray(o,9),i.set(n),i.toArray(o,12),i.toArray(o,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Wu{constructor(){this.type="ShapePath",this.color=new kn,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Ol,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,o,r){return this.currentPath.bezierCurveTo(e,t,n,i,o,r),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,t){function n(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n],o=new ql;o.curves=i.curves,t.push(o)}return t}function i(e,t){const n=t.length;let i=!1;for(let o=n-1,r=0;r<n;o=r++){let n=t[o],a=t[r],s=a.x-n.x,g=a.y-n.y;if(Math.abs(g)>Number.EPSILON){if(g<0&&(n=t[r],s=-s,a=t[o],g=-g),e.y<n.y||e.y>a.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=g*(e.x-n.x)-s*(e.y-n.y);if(0===t)return!0;if(t<0)continue;i=!i}}else{if(e.y!==n.y)continue;if(a.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=a.x)return!0}}return i}const o=Bc.isClockWise,r=this.subPaths;if(0===r.length)return[];if(!0===t)return n(r);let a,s,g;const l=[];if(1===r.length)return s=r[0],g=new ql,g.curves=s.curves,l.push(g),l;let c=!o(r[0].getPoints());c=e?!c:c;const I=[],C=[];let u,d,h=[],A=0;C[A]=void 0,h[A]=[];for(let p=0,m=r.length;p<m;p++)s=r[p],u=s.getPoints(),a=o(u),a=e?!a:a,a?(!c&&C[A]&&A++,C[A]={s:new ql,p:u},C[A].s.curves=s.curves,c&&A++,h[A]=[]):h[A].push({h:s,p:u[0]});if(!C[0])return n(r);if(C.length>1){let e=!1;const t=[];for(let n=0,i=C.length;n<i;n++)I[n]=[];for(let n=0,o=C.length;n<o;n++){const o=h[n];for(let r=0;r<o.length;r++){const a=o[r];let s=!0;for(let o=0;o<C.length;o++)i(a.p,C[o].p)&&(n!==o&&t.push({froms:n,tos:o,hole:r}),s?(s=!1,I[o].push(a)):e=!0);s&&I[n].push(a)}}t.length>0&&(e||(h=I))}for(let p=0,m=C.length;p<m;p++){g=C[p].s,l.push(g),d=h[p];for(let e=0,t=d.length;e<t;e++)g.holes.push(d[e].h)}return l}}const Su=new Float32Array(1),Ru=new Int32Array(Su.buffer);class xu{static toHalfFloat(e){e>65504&&(console.warn("THREE.DataUtils.toHalfFloat(): value exceeds 65504."),e=65504),Su[0]=e;const t=Ru[0];let n=t>>16&32768,i=t>>12&2047;const o=t>>23&255;return o<103?n:o>142?(n|=31744,n|=(255==o?0:1)&&8388607&t,n):o<113?(i|=2048,n|=(i>>114-o)+(i>>113-o&1),n):(n|=o-112<<10|i>>1,n+=1&i,n)}}const Vu=0,Xu=1,Hu=0,Yu=1,Ku=2;function Nu(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e}function Mu(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e}function Fu(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new dl(e,t)}function ku(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new xg(e)}function zu(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new dl(e,t)}function Lu(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new ll(e)}function Tu(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new ll(e)}function Eu(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new ll(e)}function Ju(e,t,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new jn(e,t,n)}function Uu(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Ao(e,t).setUsage(nn)}function Du(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new po(e,t)}function Pu(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new mo(e,t)}function Qu(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new bo(e,t)}function _u(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new fo(e,t)}function ju(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new yo(e,t)}function Ou(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Go(e,t)}function qu(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new vo(e,t)}function $u(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Zo(e,t)}function ed(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new wo(e,t)}function td(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new wu(e)}function nd(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new bu(e,t)}function id(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new sl(new Rl(e.geometry),new qg({color:void 0!==t?t:16777215}))}function od(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new sl(new kc(e.geometry),new qg({color:void 0!==t?t:16777215}))}function rd(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new mI(e)}function ad(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new vI(e)}function sd(e,t,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new cr(e,n)}function gd(){console.error("THREE.CanvasRenderer has been removed")}function ld(){console.error("THREE.JSONLoader has been removed.")}xl.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(xl.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Ol.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)},gu.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},tu.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},AI.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),UI.extractUrlBase(e)},AI.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},DC.prototype.center=function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},DC.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},DC.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},DC.prototype.size=function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)},$n.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},$n.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},$n.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},$n.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},$n.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},mi.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},pr.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},_C.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Sn.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Sn.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},Sn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Sn.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},Sn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Sn.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},Wi.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},Wi.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Wi.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new jn).setFromMatrixColumn(this,3)},Wi.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},Wi.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Wi.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Wi.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Wi.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Wi.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},Wi.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Wi.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Wi.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Wi.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Wi.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Wi.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Wi.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Wi.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Wi.prototype.makeFrustum=function(e,t,n,i,o,r){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,i,n,o,r)},Wi.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},dr.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},_n.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},_n.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},wi.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},wi.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},wi.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},lo.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},lo.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},lo.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},lo.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},lo.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},lo.barycoordFromPoint=function(e,t,n,i,o){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),lo.getBarycoord(e,t,n,i,o)},lo.normal=function(e,t,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),lo.getNormal(e,t,n,i)},ql.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},ql.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Wc(this,e)},ql.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Hc(this,e)},Wn.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},Wn.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Wn.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},jn.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},jn.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},jn.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},jn.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},jn.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},jn.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},jn.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},jn.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},jn.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Un.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},Un.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},qi.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},qi.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},qi.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},qi.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},qi.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(qi.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),qo.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(qo.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),xt},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),zg.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},ar.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(ZI.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(Ao.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===nn},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(nn)}}}),Ao.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?nn:tn),this},Ao.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Ao.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Yo.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},Yo.prototype.addAttribute=function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new Ao(arguments[1],arguments[2])))},Yo.prototype.addDrawCall=function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},Yo.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},Yo.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},Yo.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},Yo.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(Yo.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),ug.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?nn:tn),this},ug.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Wc.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},Wc.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},Wc.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},Cg.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},MC.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(Io.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new kn}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===p}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(or.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),gg.prototype.clearTarget=function(e,t,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,i)},gg.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},gg.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},gg.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},gg.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},gg.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},gg.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},gg.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},gg.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},gg.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},gg.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},gg.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},gg.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},gg.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},gg.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},gg.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},gg.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},gg.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},gg.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},gg.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},gg.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},gg.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},gg.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},gg.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},gg.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(gg.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?Yt:Ht}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}}),Object.defineProperties(Os.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Dn.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),hC.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return(new tC).load(e,(function(e){t.setBuffer(e)})),this},yC.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},gr.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},gr.prototype.clear=function(e,t,n,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,n,i)},Ln.crossOrigin=void 0,Ln.loadTexture=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const o=new BI;o.setCrossOrigin(this.crossOrigin);const r=o.load(e,n,void 0,i);return t&&(r.mapping=t),r},Ln.loadTextureCube=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const o=new GI;o.setCrossOrigin(this.crossOrigin);const r=o.load(e,n,void 0,i);return t&&(r.mapping=t),r},Ln.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Ln.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const cd={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function Id(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}function Cd(){return console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),new Yo}function ud(){return console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js"),new Yo}function dd(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")}function hd(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")}function Ad(){console.error("THREE.ImmediateRenderObject has been removed.")}"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:i}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=i)}},t={};function n(i){var o=t[i];if(void 0!==o)return o.exports;var r=t[i]={id:i,loaded:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(i,o){if(1&o&&(i=this(i)),8&o)return i;if("object"===typeof i&&i){if(4&o&&i.__esModule)return i;if(16&o&&"function"===typeof i.then)return i}var r=Object.create(null);n.r(r);var a={};e=e||[null,t({}),t([]),t(t)];for(var s=2&o&&i;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((e=>a[e]=()=>i[e]));return a.default=()=>i,n.d(r,a),r}})(),n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),n.p="/",(()=>{"use strict";var e,t=n(5043),i=n.t(t,2),o=n(7950),r=n.t(o,2);function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},a.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(e||(e={}));const s="popstate";function g(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function l(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(n){}}}function c(e,t){return{usr:e.state,key:e.key,idx:t}}function I(e,t,n,i){return void 0===n&&(n=null),a({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?u(t):t,{state:n,key:t&&t.key||i||Math.random().toString(36).substr(2,8)})}function C(e){let{pathname:t="/",search:n="",hash:i=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),i&&"#"!==i&&(t+="#"===i.charAt(0)?i:"#"+i),t}function u(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let i=e.indexOf("?");i>=0&&(t.search=e.substr(i),e=e.substr(0,i)),e&&(t.pathname=e)}return t}function d(t,n,i,o){void 0===o&&(o={});let{window:r=document.defaultView,v5Compat:l=!1}=o,u=r.history,d=e.Pop,h=null,A=p();function p(){return(u.state||{idx:null}).idx}function m(){d=e.Pop;let t=p(),n=null==t?null:t-A;A=t,h&&h({action:d,location:f.location,delta:n})}function b(e){let t="null"!==r.location.origin?r.location.origin:r.location.href,n="string"===typeof e?e:C(e);return n=n.replace(/ $/,"%20"),g(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==A&&(A=0,u.replaceState(a({},u.state,{idx:A}),""));let f={get action(){return d},get location(){return t(r,u)},listen(e){if(h)throw new Error("A history only accepts one active listener");return r.addEventListener(s,m),h=e,()=>{r.removeEventListener(s,m),h=null}},createHref:e=>n(r,e),createURL:b,encodeLocation(e){let t=b(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(t,n){d=e.Push;let o=I(f.location,t,n);i&&i(o,t),A=p()+1;let a=c(o,A),s=f.createHref(o);try{u.pushState(a,"",s)}catch(g){if(g instanceof DOMException&&"DataCloneError"===g.name)throw g;r.location.assign(s)}l&&h&&h({action:d,location:f.location,delta:1})},replace:function(t,n){d=e.Replace;let o=I(f.location,t,n);i&&i(o,t),A=p();let r=c(o,A),a=f.createHref(o);u.replaceState(r,"",a),l&&h&&h({action:d,location:f.location,delta:0})},go:e=>u.go(e)};return f}var h;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(h||(h={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function A(e,t,n){return void 0===n&&(n="/"),p(e,t,n,!1)}function p(e,t,n,i){let o=V(("string"===typeof t?u(t):t).pathname||"/",n);if(null==o)return null;let r=m(e);!function(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every(((e,n)=>e===t[n]));return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}(r);let a=null;for(let s=0;null==a&&s<r.length;++s){let e=x(o);a=S(r[s],e,i)}return a}function m(e,t,n,i){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===i&&(i="");let o=(e,o,r)=>{let a={relativePath:void 0===r?e.path||"":r,caseSensitive:!0===e.caseSensitive,childrenIndex:o,route:e};a.relativePath.startsWith("/")&&(g(a.relativePath.startsWith(i),'Absolute route path "'+a.relativePath+'" nested under path "'+i+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),a.relativePath=a.relativePath.slice(i.length));let s=X([i,a.relativePath]),l=n.concat(a);e.children&&e.children.length>0&&(g(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+s+'".'),m(e.children,t,l,s)),(null!=e.path||e.index)&&t.push({path:s,score:W(s,e.index),routesMeta:l})};return e.forEach(((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let i of b(e.path))o(e,t,i);else o(e,t)})),t}function b(e){let t=e.split("/");if(0===t.length)return[];let[n,...i]=t,o=n.endsWith("?"),r=n.replace(/\?$/,"");if(0===i.length)return o?[r,""]:[r];let a=b(i.join("/")),s=[];return s.push(...a.map((e=>""===e?r:[r,e].join("/")))),o&&s.push(...a),s.map((t=>e.startsWith("/")&&""===t?"/":t))}const f=/^:[\w-]+$/,y=3,G=2,v=1,B=10,Z=-2,w=e=>"*"===e;function W(e,t){let n=e.split("/"),i=n.length;return n.some(w)&&(i+=Z),t&&(i+=G),n.filter((e=>!w(e))).reduce(((e,t)=>e+(f.test(t)?y:""===t?v:B)),i)}function S(e,t,n){void 0===n&&(n=!1);let{routesMeta:i}=e,o={},r="/",a=[];for(let s=0;s<i.length;++s){let e=i[s],g=s===i.length-1,l="/"===r?t:t.slice(r.length)||"/",c=R({path:e.relativePath,caseSensitive:e.caseSensitive,end:g},l),I=e.route;if(!c&&g&&n&&!i[i.length-1].route.index&&(c=R({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},l)),!c)return null;Object.assign(o,c.params),a.push({params:o,pathname:X([r,c.pathname]),pathnameBase:H(X([r,c.pathnameBase])),route:I}),"/"!==c.pathnameBase&&(r=X([r,c.pathnameBase]))}return a}function R(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,i]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);l("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let i=[],o="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,((e,t,n)=>(i.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)")));e.endsWith("*")?(i.push({paramName:"*"}),o+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?o+="\\/*$":""!==e&&"/"!==e&&(o+="(?:(?=\\/|$))");let r=new RegExp(o,t?void 0:"i");return[r,i]}(e.path,e.caseSensitive,e.end),o=t.match(n);if(!o)return null;let r=o[0],a=r.replace(/(.)\/+$/,"$1"),s=o.slice(1),g=i.reduce(((e,t,n)=>{let{paramName:i,isOptional:o}=t;if("*"===i){let e=s[n]||"";a=r.slice(0,r.length-e.length).replace(/(.)\/+$/,"$1")}const g=s[n];return e[i]=o&&!g?void 0:(g||"").replace(/%2F/g,"/"),e}),{});return{params:g,pathname:r,pathnameBase:a,pattern:e}}function x(e){try{return e.split("/").map((e=>decodeURIComponent(e).replace(/\//g,"%2F"))).join("/")}catch(t){return l(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function V(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,i=e.charAt(n);return i&&"/"!==i?null:e.slice(n)||"/"}const X=e=>e.join("/").replace(/\/\/+/g,"/"),H=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/");Error;function Y(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const K=["post","put","patch","delete"],N=(new Set(K),["get",...K]);new Set(N),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function M(){return M=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},M.apply(this,arguments)}const F=t.createContext(null);const k=t.createContext(null);const z=t.createContext(null);const L=t.createContext(null);const T=t.createContext({outlet:null,matches:[],isDataRoute:!1});const E=t.createContext(null);function J(){return null!=t.useContext(L)}function U(){return J()||g(!1),t.useContext(L).location}function D(n,i,o,r){J()||g(!1);let{navigator:a}=t.useContext(z),{matches:s}=t.useContext(T),l=s[s.length-1],c=l?l.params:{},I=(l&&l.pathname,l?l.pathnameBase:"/");l&&l.route;let C,d=U();if(i){var h;let e="string"===typeof i?u(i):i;"/"===I||(null==(h=e.pathname)?void 0:h.startsWith(I))||g(!1),C=e}else C=d;let p=C.pathname||"/",m=p;if("/"!==I){let e=I.replace(/^\//,"").split("/");m="/"+p.replace(/^\//,"").split("/").slice(e.length).join("/")}let b=A(n,{pathname:m});let f=O(b&&b.map((e=>Object.assign({},e,{params:Object.assign({},c,e.params),pathname:X([I,a.encodeLocation?a.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?I:X([I,a.encodeLocation?a.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])}))),s,o,r);return i&&f?t.createElement(L.Provider,{value:{location:M({pathname:"/",search:"",hash:"",state:null,key:"default"},C),navigationType:e.Pop}},f):f}function P(){let e=function(){var e;let n=t.useContext(E),i=$(q.UseRouteError),o=ee(q.UseRouteError);if(void 0!==n)return n;return null==(e=i.errors)?void 0:e[o]}(),n=Y(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),i=e instanceof Error?e.stack:null,o="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:o};return t.createElement(t.Fragment,null,t.createElement("h2",null,"Unexpected Application Error!"),t.createElement("h3",{style:{fontStyle:"italic"}},n),i?t.createElement("pre",{style:r},i):null,null)}const Q=t.createElement(P,null);class _ extends t.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?t.createElement(T.Provider,{value:this.props.routeContext},t.createElement(E.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function j(e){let{routeContext:n,match:i,children:o}=e,r=t.useContext(F);return r&&r.static&&r.staticContext&&(i.route.errorElement||i.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=i.route.id),t.createElement(T.Provider,{value:n},o)}function O(e,n,i,o){var r;if(void 0===n&&(n=[]),void 0===i&&(i=null),void 0===o&&(o=null),null==e){var a;if(!i)return null;if(i.errors)e=i.matches;else{if(!(null!=(a=o)&&a.v7_partialHydration&&0===n.length&&!i.initialized&&i.matches.length>0))return null;e=i.matches}}let s=e,l=null==(r=i)?void 0:r.errors;if(null!=l){let e=s.findIndex((e=>e.route.id&&void 0!==(null==l?void 0:l[e.route.id])));e>=0||g(!1),s=s.slice(0,Math.min(s.length,e+1))}let c=!1,I=-1;if(i&&o&&o.v7_partialHydration)for(let t=0;t<s.length;t++){let e=s[t];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(I=t),e.route.id){let{loaderData:t,errors:n}=i,o=e.route.loader&&void 0===t[e.route.id]&&(!n||void 0===n[e.route.id]);if(e.route.lazy||o){c=!0,s=I>=0?s.slice(0,I+1):[s[0]];break}}}return s.reduceRight(((e,o,r)=>{let a,g=!1,C=null,u=null;i&&(a=l&&o.route.id?l[o.route.id]:void 0,C=o.route.errorElement||Q,c&&(I<0&&0===r?(!function(e,t){t||te[e]||(te[e]=!0)}("route-fallback",!1),g=!0,u=null):I===r&&(g=!0,u=o.route.hydrateFallbackElement||null)));let d=n.concat(s.slice(0,r+1)),h=()=>{let n;return n=a?C:g?u:o.route.Component?t.createElement(o.route.Component,null):o.route.element?o.route.element:e,t.createElement(j,{match:o,routeContext:{outlet:e,matches:d,isDataRoute:null!=i},children:n})};return i&&(o.route.ErrorBoundary||o.route.errorElement||0===r)?t.createElement(_,{location:i.location,revalidation:i.revalidation,component:C,error:a,children:h(),routeContext:{outlet:null,matches:d,isDataRoute:!0}}):h()}),null)}var q=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(q||{});function $(e){let n=t.useContext(k);return n||g(!1),n}function ee(e){let n=function(){let e=t.useContext(T);return e||g(!1),e}(),i=n.matches[n.matches.length-1];return i.route.id||g(!1),i.route.id}const te={};i.startTransition;function ne(e){g(!1)}function ie(n){let{basename:i="/",children:o=null,location:r,navigationType:a=e.Pop,navigator:s,static:l=!1,future:c}=n;J()&&g(!1);let I=i.replace(/^\/*/,"/"),C=t.useMemo((()=>({basename:I,navigator:s,static:l,future:M({v7_relativeSplatPath:!1},c)})),[I,c,s,l]);"string"===typeof r&&(r=u(r));let{pathname:d="/",search:h="",hash:A="",state:p=null,key:m="default"}=r,b=t.useMemo((()=>{let e=V(d,I);return null==e?null:{location:{pathname:e,search:h,hash:A,state:p,key:m},navigationType:a}}),[I,d,h,A,p,m,a]);return null==b?null:t.createElement(z.Provider,{value:C},t.createElement(L.Provider,{children:o,value:b}))}function oe(e){let{children:t,location:n}=e;return D(re(t),n)}new Promise((()=>{}));t.Component;function re(e,n){void 0===n&&(n=[]);let i=[];return t.Children.forEach(e,((e,o)=>{if(!t.isValidElement(e))return;let r=[...n,o];if(e.type===t.Fragment)return void i.push.apply(i,re(e.props.children,r));e.type!==ne&&g(!1),e.props.index&&e.props.children&&g(!1);let a={id:e.props.id||r.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(a.children=re(e.props.children,r)),i.push(a)})),i}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);try{window.__reactRouterVersion="6"}catch(vI){}new Map;const ae=i.startTransition;r.flushSync,i.useId;function se(e){let{basename:n,children:i,future:o,window:r}=e,a=t.useRef();var s;null==a.current&&(a.current=(void 0===(s={window:r,v5Compat:!0})&&(s={}),d((function(e,t){let{pathname:n,search:i,hash:o}=e.location;return I("",{pathname:n,search:i,hash:o},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){return"string"===typeof t?t:C(t)}),null,s)));let g=a.current,[l,c]=t.useState({action:g.action,location:g.location}),{v7_startTransition:u}=o||{},h=t.useCallback((e=>{u&&ae?ae((()=>c(e))):c(e)}),[c,u]);return t.useLayoutEffect((()=>g.listen(h)),[g,h]),t.createElement(ie,{basename:n,children:i,location:l.location,navigationType:l.action,navigator:g,future:o})}"undefined"!==typeof window&&"undefined"!==typeof window.document&&window.document.createElement;var ge,le;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(ge||(ge={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(le||(le={}));var ce=n(579);const Ie=()=>(0,ce.jsx)("div",{style:{textAlign:"center"},children:(0,ce.jsx)("iframe",{src:"/brucepewpew/index.html",width:"1920",height:"1080",style:{border:"none"},title:"Game"})});var Ce=n(8587),ue=n(8168);function de(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e)){var o=e.length;for(t=0;t<o;t++)e[t]&&(n=de(e[t]))&&(i&&(i+=" "),i+=n)}else for(n in e)e[n]&&(i&&(i+=" "),i+=n);return i}const he=function(){for(var e,t,n=0,i="",o=arguments.length;n<o;n++)(e=arguments[n])&&(t=de(e))&&(i&&(i+=" "),i+=t);return i},Ae=e=>e,pe=(()=>{let e=Ae;return{configure(t){e=t},generate:t=>e(t),reset(){e=Ae}}})(),me={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",open:"open",readOnly:"readOnly",required:"required",selected:"selected"};function be(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Mui";const i=me[t];return i?`${n}-${i}`:`${pe.generate(e)}-${t}`}function fe(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;const i={};return Object.keys(e).forEach((o=>{i[o]=e[o].reduce(((e,i)=>{if(i){const o=t(i);""!==o&&e.push(o),n&&n[i]&&e.push(n[i])}return e}),[]).join(" ")})),i}var ye=n(7598);function Ge(e,t){const n=(0,ue.A)({},t);return Object.keys(e).forEach((i=>{if(i.toString().match(/^(components|slots)$/))n[i]=(0,ue.A)({},e[i],n[i]);else if(i.toString().match(/^(componentsProps|slotProps)$/)){const o=e[i]||{},r=t[i];n[i]={},r&&Object.keys(r)?o&&Object.keys(o)?(n[i]=(0,ue.A)({},r),Object.keys(o).forEach((e=>{n[i][e]=Ge(o[e],r[e])}))):n[i]=r:n[i]=o}else void 0===n[i]&&(n[i]=e[i])})),n}var ve=n(8280),Be=n(4575);const Ze=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const n=t.useContext(Be.T);return n&&(i=n,0!==Object.keys(i).length)?n:e;var i},we=(0,ve.A)();const We=function(){return Ze(arguments.length>0&&void 0!==arguments[0]?arguments[0]:we)};function Se(e){let{props:t,name:n,defaultTheme:i,themeId:o}=e,r=We(i);o&&(r=r[o]||r);const a=function(e){const{theme:t,name:n,props:i}=e;return t&&t.components&&t.components[n]&&t.components[n].defaultProps?Ge(t.components[n].defaultProps,i):i}({theme:r,name:n,props:t});return a}var Re=n(7713),xe=n(9172),Ve=n(8812);const Xe=["ownerState"],He=["variants"],Ye=["name","slot","skipVariantsResolver","skipSx","overridesResolver"];function Ke(e){return"ownerState"!==e&&"theme"!==e&&"sx"!==e&&"as"!==e}const Ne=(0,ve.A)(),Me=e=>e?e.charAt(0).toLowerCase()+e.slice(1):e;function Fe(e){let{defaultTheme:t,theme:n,themeId:i}=e;return o=n,0===Object.keys(o).length?t:n[i]||n;var o}function ke(e){return e?(t,n)=>n[e]:null}function ze(e,t){let{ownerState:n}=t,i=(0,Ce.A)(t,Xe);const o="function"===typeof e?e((0,ue.A)({ownerState:n},i)):e;if(Array.isArray(o))return o.flatMap((e=>ze(e,(0,ue.A)({ownerState:n},i))));if(o&&"object"===typeof o&&Array.isArray(o.variants)){const{variants:e=[]}=o;let t=(0,Ce.A)(o,He);return e.forEach((e=>{let o=!0;"function"===typeof e.props?o=e.props((0,ue.A)({ownerState:n},i,n)):Object.keys(e.props).forEach((t=>{(null==n?void 0:n[t])!==e.props[t]&&i[t]!==e.props[t]&&(o=!1)})),o&&(Array.isArray(t)||(t=[t]),t.push("function"===typeof e.style?e.style((0,ue.A)({ownerState:n},i,n)):e.style))})),t}return o}const Le=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{themeId:t,defaultTheme:n=Ne,rootShouldForwardProp:i=Ke,slotShouldForwardProp:o=Ke}=e,r=e=>(0,Ve.A)((0,ue.A)({},e,{theme:Fe((0,ue.A)({},e,{defaultTheme:n,themeId:t}))}));return r.__mui_systemSx=!0,function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,Re.internal_processStyles)(e,(e=>e.filter((e=>!(null!=e&&e.__mui_systemSx)))));const{name:s,slot:g,skipVariantsResolver:l,skipSx:c,overridesResolver:I=ke(Me(g))}=a,C=(0,Ce.A)(a,Ye),u=void 0!==l?l:g&&"Root"!==g&&"root"!==g||!1,d=c||!1;let h=Ke;"Root"===g||"root"===g?h=i:g?h=o:function(e){return"string"===typeof e&&e.charCodeAt(0)>96}(e)&&(h=void 0);const A=(0,Re.default)(e,(0,ue.A)({shouldForwardProp:h,label:undefined},C)),p=e=>"function"===typeof e&&e.__emotion_real!==e||(0,xe.Q)(e)?i=>ze(e,(0,ue.A)({},i,{theme:Fe({theme:i.theme,defaultTheme:n,themeId:t})})):e,m=function(i){let o=p(i);for(var a=arguments.length,g=new Array(a>1?a-1:0),l=1;l<a;l++)g[l-1]=arguments[l];const c=g?g.map(p):[];s&&I&&c.push((e=>{const i=Fe((0,ue.A)({},e,{defaultTheme:n,themeId:t}));if(!i.components||!i.components[s]||!i.components[s].styleOverrides)return null;const o=i.components[s].styleOverrides,r={};return Object.entries(o).forEach((t=>{let[n,o]=t;r[n]=ze(o,(0,ue.A)({},e,{theme:i}))})),I(e,r)})),s&&!u&&c.push((e=>{var i;const o=Fe((0,ue.A)({},e,{defaultTheme:n,themeId:t}));return ze({variants:null==o||null==(i=o.components)||null==(i=i[s])?void 0:i.variants},(0,ue.A)({},e,{theme:o}))})),d||c.push(r);const C=c.length-g.length;if(Array.isArray(i)&&C>0){const e=new Array(C).fill("");o=[...i,...e],o.raw=[...i.raw,...e]}const h=A(o,...c);return e.muiName&&(h.muiName=e.muiName),h};return A.withConfig&&(m.withConfig=A.withConfig),m}}(),Te=Le,Ee=["className","component","disableGutters","fixed","maxWidth","classes"],Je=(0,ve.A)(),Ue=Te("div",{name:"MuiContainer",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[`maxWidth${(0,ye.A)(String(n.maxWidth))}`],n.fixed&&t.fixed,n.disableGutters&&t.disableGutters]}}),De=e=>Se({props:e,name:"MuiContainer",defaultTheme:Je});const Pe=ye.A;var Qe=n(8052),_e=n(7868),je=n(7758);function Oe(e,t){return(0,ue.A)({toolbar:{minHeight:56,[e.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[e.up("sm")]:{minHeight:64}}},t)}var qe=n(7266);const $e={black:"#000",white:"#fff"},et={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"},tt={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},nt={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},it={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},ot={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},rt={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},at={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},st=["mode","contrastThreshold","tonalOffset"],gt={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:$e.white,default:$e.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},lt={text:{primary:$e.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:$e.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function ct(e,t,n,i){const o=i.light||i,r=i.dark||1.5*i;e[t]||(e.hasOwnProperty(n)?e[t]=e[n]:"light"===t?e.light=(0,qe.a)(e.main,o):"dark"===t&&(e.dark=(0,qe.e$)(e.main,r)))}function It(e){const{mode:t="light",contrastThreshold:n=3,tonalOffset:i=.2}=e,o=(0,Ce.A)(e,st),r=e.primary||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:ot[200],light:ot[50],dark:ot[400]}:{main:ot[700],light:ot[400],dark:ot[800]}}(t),a=e.secondary||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:tt[200],light:tt[50],dark:tt[400]}:{main:tt[500],light:tt[300],dark:tt[700]}}(t),s=e.error||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:nt[500],light:nt[300],dark:nt[700]}:{main:nt[700],light:nt[400],dark:nt[800]}}(t),g=e.info||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:rt[400],light:rt[300],dark:rt[700]}:{main:rt[700],light:rt[500],dark:rt[900]}}(t),l=e.success||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:at[400],light:at[300],dark:at[700]}:{main:at[800],light:at[500],dark:at[900]}}(t),c=e.warning||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:it[400],light:it[300],dark:it[700]}:{main:"#ed6c02",light:it[500],dark:it[900]}}(t);function I(e){return(0,qe.eM)(e,lt.text.primary)>=n?lt.text.primary:gt.text.primary}const C=e=>{let{color:t,name:n,mainShade:o=500,lightShade:r=300,darkShade:a=700}=e;if(t=(0,ue.A)({},t),!t.main&&t[o]&&(t.main=t[o]),!t.hasOwnProperty("main"))throw new Error((0,_e.A)(11,n?` (${n})`:"",o));if("string"!==typeof t.main)throw new Error((0,_e.A)(12,n?` (${n})`:"",JSON.stringify(t.main)));return ct(t,"light",r,i),ct(t,"dark",a,i),t.contrastText||(t.contrastText=I(t.main)),t},u={dark:lt,light:gt};return(0,xe.A)((0,ue.A)({common:(0,ue.A)({},$e),mode:t,primary:C({color:r,name:"primary"}),secondary:C({color:a,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:C({color:s,name:"error"}),warning:C({color:c,name:"warning"}),info:C({color:g,name:"info"}),success:C({color:l,name:"success"}),grey:et,contrastThreshold:n,getContrastText:I,augmentColor:C,tonalOffset:i},u[t]),o)}const Ct=["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"];const ut={textTransform:"uppercase"},dt='"Roboto", "Helvetica", "Arial", sans-serif';function ht(e,t){const n="function"===typeof t?t(e):t,{fontFamily:i=dt,fontSize:o=14,fontWeightLight:r=300,fontWeightRegular:a=400,fontWeightMedium:s=500,fontWeightBold:g=700,htmlFontSize:l=16,allVariants:c,pxToRem:I}=n,C=(0,Ce.A)(n,Ct);const u=o/14,d=I||(e=>e/l*u+"rem"),h=(e,t,n,o,r)=>{return(0,ue.A)({fontFamily:i,fontWeight:e,fontSize:d(t),lineHeight:n},i===dt?{letterSpacing:(a=o/t,Math.round(1e5*a)/1e5)+"em"}:{},r,c);var a},A={h1:h(r,96,1.167,-1.5),h2:h(r,60,1.2,-.5),h3:h(a,48,1.167,0),h4:h(a,34,1.235,.25),h5:h(a,24,1.334,0),h6:h(s,20,1.6,.15),subtitle1:h(a,16,1.75,.15),subtitle2:h(s,14,1.57,.1),body1:h(a,16,1.5,.15),body2:h(a,14,1.43,.15),button:h(s,14,1.75,.4,ut),caption:h(a,12,1.66,.4),overline:h(a,12,2.66,1,ut),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return(0,xe.A)((0,ue.A)({htmlFontSize:l,pxToRem:d,fontFamily:i,fontSize:o,fontWeightLight:r,fontWeightRegular:a,fontWeightMedium:s,fontWeightBold:g},A),C,{clone:!1})}function At(){return[`${arguments.length<=0?void 0:arguments[0]}px ${arguments.length<=1?void 0:arguments[1]}px ${arguments.length<=2?void 0:arguments[2]}px ${arguments.length<=3?void 0:arguments[3]}px rgba(0,0,0,0.2)`,`${arguments.length<=4?void 0:arguments[4]}px ${arguments.length<=5?void 0:arguments[5]}px ${arguments.length<=6?void 0:arguments[6]}px ${arguments.length<=7?void 0:arguments[7]}px rgba(0,0,0,0.14)`,`${arguments.length<=8?void 0:arguments[8]}px ${arguments.length<=9?void 0:arguments[9]}px ${arguments.length<=10?void 0:arguments[10]}px ${arguments.length<=11?void 0:arguments[11]}px rgba(0,0,0,0.12)`].join(",")}const pt=["none",At(0,2,1,-1,0,1,1,0,0,1,3,0),At(0,3,1,-2,0,2,2,0,0,1,5,0),At(0,3,3,-2,0,3,4,0,0,1,8,0),At(0,2,4,-1,0,4,5,0,0,1,10,0),At(0,3,5,-1,0,5,8,0,0,1,14,0),At(0,3,5,-1,0,6,10,0,0,1,18,0),At(0,4,5,-2,0,7,10,1,0,2,16,1),At(0,5,5,-3,0,8,10,1,0,3,14,2),At(0,5,6,-3,0,9,12,1,0,3,16,2),At(0,6,6,-3,0,10,14,1,0,4,18,3),At(0,6,7,-4,0,11,15,1,0,4,20,3),At(0,7,8,-4,0,12,17,2,0,5,22,4),At(0,7,8,-4,0,13,19,2,0,5,24,4),At(0,7,9,-4,0,14,21,2,0,5,26,4),At(0,8,9,-5,0,15,22,2,0,6,28,5),At(0,8,10,-5,0,16,24,2,0,6,30,5),At(0,8,11,-5,0,17,26,2,0,6,32,5),At(0,9,11,-5,0,18,28,2,0,7,34,6),At(0,9,12,-6,0,19,29,2,0,7,36,6),At(0,10,13,-6,0,20,31,3,0,8,38,7),At(0,10,13,-6,0,21,33,3,0,8,40,7),At(0,10,14,-6,0,22,35,3,0,8,42,7),At(0,11,14,-7,0,23,36,3,0,9,44,8),At(0,11,15,-7,0,24,38,3,0,9,46,8)],mt=["duration","easing","delay"],bt={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},ft={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function yt(e){return`${Math.round(e)}ms`}function Gt(e){if(!e)return 0;const t=e/36;return Math.round(10*(4+15*t**.25+t/5))}function vt(e){const t=(0,ue.A)({},bt,e.easing),n=(0,ue.A)({},ft,e.duration);return(0,ue.A)({getAutoHeightDuration:Gt,create:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["all"],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{duration:o=n.standard,easing:r=t.easeInOut,delay:a=0}=i;(0,Ce.A)(i,mt);return(Array.isArray(e)?e:[e]).map((e=>`${e} ${"string"===typeof o?o:yt(o)} ${r} ${"string"===typeof a?a:yt(a)}`)).join(",")}},e,{easing:t,duration:n})}const Bt={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500},Zt=["breakpoints","mixins","spacing","palette","transitions","typography","shape"];function wt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{mixins:t={},palette:n={},transitions:i={},typography:o={}}=e,r=(0,Ce.A)(e,Zt);if(e.vars)throw new Error((0,_e.A)(18));const a=It(n),s=(0,ve.A)(e);let g=(0,xe.A)(s,{mixins:Oe(s.breakpoints,t),palette:a,shadows:pt.slice(),typography:ht(a,o),transitions:vt(i),zIndex:(0,ue.A)({},Bt)});g=(0,xe.A)(g,r);for(var l=arguments.length,c=new Array(l>1?l-1:0),I=1;I<l;I++)c[I-1]=arguments[I];return g=c.reduce(((e,t)=>(0,xe.A)(e,t)),g),g.unstable_sxConfig=(0,ue.A)({},je.A,null==r?void 0:r.unstable_sxConfig),g.unstable_sx=function(e){return(0,Ve.A)({sx:e,theme:this})},g}const Wt=wt,St=Wt(),Rt="$$material";const xt=function(e){return"ownerState"!==e&&"theme"!==e&&"sx"!==e&&"as"!==e},Vt=e=>xt(e)&&"classes"!==e,Xt=(0,Qe.Ay)({themeId:Rt,defaultTheme:St,rootShouldForwardProp:Vt}),Ht=t.createContext(void 0);function Yt(e){let{props:n,name:i}=e;return function(e){const{theme:t,name:n,props:i}=e;if(!t||!t.components||!t.components[n])return i;const o=t.components[n];return o.defaultProps?Ge(o.defaultProps,i):o.styleOverrides||o.variants?i:Ge(o,i)}({props:n,name:i,theme:{components:t.useContext(Ht)}})}const Kt=function(e){let{value:t,children:n}=e;return(0,ce.jsx)(Ht.Provider,{value:t,children:n})};function Nt(e){return Yt(e)}const Mt=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{createStyledComponent:n=Ue,useThemeProps:i=De,componentName:o="MuiContainer"}=e,r=n((e=>{let{theme:t,ownerState:n}=e;return(0,ue.A)({width:"100%",marginLeft:"auto",boxSizing:"border-box",marginRight:"auto",display:"block"},!n.disableGutters&&{paddingLeft:t.spacing(2),paddingRight:t.spacing(2),[t.breakpoints.up("sm")]:{paddingLeft:t.spacing(3),paddingRight:t.spacing(3)}})}),(e=>{let{theme:t,ownerState:n}=e;return n.fixed&&Object.keys(t.breakpoints.values).reduce(((e,n)=>{const i=n,o=t.breakpoints.values[i];return 0!==o&&(e[t.breakpoints.up(i)]={maxWidth:`${o}${t.breakpoints.unit}`}),e}),{})}),(e=>{let{theme:t,ownerState:n}=e;return(0,ue.A)({},"xs"===n.maxWidth&&{[t.breakpoints.up("xs")]:{maxWidth:Math.max(t.breakpoints.values.xs,444)}},n.maxWidth&&"xs"!==n.maxWidth&&{[t.breakpoints.up(n.maxWidth)]:{maxWidth:`${t.breakpoints.values[n.maxWidth]}${t.breakpoints.unit}`}})})),a=t.forwardRef((function(e,t){const n=i(e),{className:a,component:s="div",disableGutters:g=!1,fixed:l=!1,maxWidth:c="lg"}=n,I=(0,Ce.A)(n,Ee),C=(0,ue.A)({},n,{component:s,disableGutters:g,fixed:l,maxWidth:c}),u=((e,t)=>{const{classes:n,fixed:i,disableGutters:o,maxWidth:r}=e;return fe({root:["root",r&&`maxWidth${(0,ye.A)(String(r))}`,i&&"fixed",o&&"disableGutters"]},(e=>be(t,e)),n)})(C,o);return(0,ce.jsx)(r,(0,ue.A)({as:s,ownerState:C,className:he(u.root,a),ref:t},I))}));return a}({createStyledComponent:Xt("div",{name:"MuiContainer",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[`maxWidth${Pe(String(n.maxWidth))}`],n.fixed&&t.fixed,n.disableGutters&&t.disableGutters]}}),useThemeProps:e=>Nt({props:e,name:"MuiContainer"})}),Ft=Mt;var kt=n(8698);function zt(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Mui";const i={};return t.forEach((t=>{i[t]=be(e,t,n)})),i}function Lt(e){return be("MuiTypography",e)}zt("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);const Tt=["align","className","component","gutterBottom","noWrap","paragraph","variant","variantMapping"],Et=Xt("span",{name:"MuiTypography",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.variant&&t[n.variant],"inherit"!==n.align&&t[`align${Pe(n.align)}`],n.noWrap&&t.noWrap,n.gutterBottom&&t.gutterBottom,n.paragraph&&t.paragraph]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ue.A)({margin:0},"inherit"===n.variant&&{font:"inherit"},"inherit"!==n.variant&&t.typography[n.variant],"inherit"!==n.align&&{textAlign:n.align},n.noWrap&&{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},n.gutterBottom&&{marginBottom:"0.35em"},n.paragraph&&{marginBottom:16})})),Jt={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},Ut={primary:"primary.main",textPrimary:"text.primary",secondary:"secondary.main",textSecondary:"text.secondary",error:"error.main"},Dt=t.forwardRef((function(e,t){const n=Nt({props:e,name:"MuiTypography"}),i=(e=>Ut[e]||e)(n.color),o=(0,kt.A)((0,ue.A)({},n,{color:i})),{align:r="inherit",className:a,component:s,gutterBottom:g=!1,noWrap:l=!1,paragraph:c=!1,variant:I="body1",variantMapping:C=Jt}=o,u=(0,Ce.A)(o,Tt),d=(0,ue.A)({},o,{align:r,color:i,className:a,component:s,gutterBottom:g,noWrap:l,paragraph:c,variant:I,variantMapping:C}),h=s||(c?"p":C[I]||Jt[I])||"span",A=(e=>{const{align:t,gutterBottom:n,noWrap:i,paragraph:o,variant:r,classes:a}=e;return fe({root:["root",r,"inherit"!==e.align&&`align${Pe(t)}`,n&&"gutterBottom",i&&"noWrap",o&&"paragraph"]},Lt,a)})(d);return(0,ce.jsx)(Et,(0,ue.A)({as:h,ref:t,ownerState:d,className:he(A.root,a)},u))}));function Pt(e){return be("MuiSvgIcon",e)}zt("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);const Qt=["children","className","color","component","fontSize","htmlColor","inheritViewBox","titleAccess","viewBox"],_t=Xt("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,"inherit"!==n.color&&t[`color${Pe(n.color)}`],t[`fontSize${Pe(n.fontSize)}`]]}})((e=>{let{theme:t,ownerState:n}=e;var i,o,r,a,s,g,l,c,I,C,u,d,h;return{userSelect:"none",width:"1em",height:"1em",display:"inline-block",fill:n.hasSvgAsChild?void 0:"currentColor",flexShrink:0,transition:null==(i=t.transitions)||null==(o=i.create)?void 0:o.call(i,"fill",{duration:null==(r=t.transitions)||null==(r=r.duration)?void 0:r.shorter}),fontSize:{inherit:"inherit",small:(null==(a=t.typography)||null==(s=a.pxToRem)?void 0:s.call(a,20))||"1.25rem",medium:(null==(g=t.typography)||null==(l=g.pxToRem)?void 0:l.call(g,24))||"1.5rem",large:(null==(c=t.typography)||null==(I=c.pxToRem)?void 0:I.call(c,35))||"2.1875rem"}[n.fontSize],color:null!=(C=null==(u=(t.vars||t).palette)||null==(u=u[n.color])?void 0:u.main)?C:{action:null==(d=(t.vars||t).palette)||null==(d=d.action)?void 0:d.active,disabled:null==(h=(t.vars||t).palette)||null==(h=h.action)?void 0:h.disabled,inherit:void 0}[n.color]}})),jt=t.forwardRef((function(e,n){const i=Nt({props:e,name:"MuiSvgIcon"}),{children:o,className:r,color:a="inherit",component:s="svg",fontSize:g="medium",htmlColor:l,inheritViewBox:c=!1,titleAccess:I,viewBox:C="0 0 24 24"}=i,u=(0,Ce.A)(i,Qt),d=t.isValidElement(o)&&"svg"===o.type,h=(0,ue.A)({},i,{color:a,component:s,fontSize:g,instanceFontSize:e.fontSize,inheritViewBox:c,viewBox:C,hasSvgAsChild:d}),A={};c||(A.viewBox=C);const p=(e=>{const{color:t,fontSize:n,classes:i}=e;return fe({root:["root","inherit"!==t&&`color${Pe(t)}`,`fontSize${Pe(n)}`]},Pt,i)})(h);return(0,ce.jsxs)(_t,(0,ue.A)({as:s,className:he(p.root,r),focusable:"false",color:l,"aria-hidden":!I||void 0,role:I?"img":void 0,ref:n},A,u,d&&o.props,{ownerState:h,children:[d?o.props.children:o,I?(0,ce.jsx)("title",{children:I}):null]}))}));jt.muiName="SvgIcon";const Ot=jt;const qt=function(e,n){function i(t,i){return(0,ce.jsx)(Ot,(0,ue.A)({"data-testid":`${n}Icon`,ref:i},t,{children:e}))}return i.muiName=Ot.muiName,t.memo(t.forwardRef(i))}((0,ce.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"}),"Person");function $t(e){return be("MuiAvatar",e)}zt("MuiAvatar",["root","colorDefault","circular","rounded","square","img","fallback"]);function en(e,t){"function"===typeof e?e(t):e&&(e.current=t)}function tn(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t.useMemo((()=>n.every((e=>null==e))?null:e=>{n.forEach((t=>{en(t,e)}))}),n)}const nn=function(e){return"string"===typeof e};const on=function(e,t,n){return void 0===e||nn(e)?t:(0,ue.A)({},t,{ownerState:(0,ue.A)({},t.ownerState,n)})};const rn=function(e,t,n){return"function"===typeof e?e(t,n):e};const an=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(void 0===e)return{};const n={};return Object.keys(e).filter((n=>n.match(/^on[A-Z]/)&&"function"===typeof e[n]&&!t.includes(n))).forEach((t=>{n[t]=e[t]})),n};const sn=function(e){if(void 0===e)return{};const t={};return Object.keys(e).filter((t=>!(t.match(/^on[A-Z]/)&&"function"===typeof e[t]))).forEach((n=>{t[n]=e[n]})),t};const gn=function(e){const{getSlotProps:t,additionalProps:n,externalSlotProps:i,externalForwardedProps:o,className:r}=e;if(!t){const e=he(null==n?void 0:n.className,r,null==o?void 0:o.className,null==i?void 0:i.className),t=(0,ue.A)({},null==n?void 0:n.style,null==o?void 0:o.style,null==i?void 0:i.style),a=(0,ue.A)({},n,o,i);return e.length>0&&(a.className=e),Object.keys(t).length>0&&(a.style=t),{props:a,internalRef:void 0}}const a=an((0,ue.A)({},o,i)),s=sn(i),g=sn(o),l=t(a),c=he(null==l?void 0:l.className,null==n?void 0:n.className,r,null==o?void 0:o.className,null==i?void 0:i.className),I=(0,ue.A)({},null==l?void 0:l.style,null==n?void 0:n.style,null==o?void 0:o.style,null==i?void 0:i.style),C=(0,ue.A)({},l,n,g,s);return c.length>0&&(C.className=c),Object.keys(I).length>0&&(C.style=I),{props:C,internalRef:l.ref}},ln=["className","elementType","ownerState","externalForwardedProps","getSlotOwnerState","internalForwardedProps"],cn=["component","slots","slotProps"],In=["component"];const Cn=["alt","children","className","component","slots","slotProps","imgProps","sizes","src","srcSet","variant"],un=Xt("div",{name:"MuiAvatar",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.variant],n.colorDefault&&t.colorDefault]}})((e=>{let{theme:t}=e;return{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,width:40,height:40,fontFamily:t.typography.fontFamily,fontSize:t.typography.pxToRem(20),lineHeight:1,borderRadius:"50%",overflow:"hidden",userSelect:"none",variants:[{props:{variant:"rounded"},style:{borderRadius:(t.vars||t).shape.borderRadius}},{props:{variant:"square"},style:{borderRadius:0}},{props:{colorDefault:!0},style:(0,ue.A)({color:(t.vars||t).palette.background.default},t.vars?{backgroundColor:t.vars.palette.Avatar.defaultBg}:(0,ue.A)({backgroundColor:t.palette.grey[400]},t.applyStyles("dark",{backgroundColor:t.palette.grey[600]})))}]}})),dn=Xt("img",{name:"MuiAvatar",slot:"Img",overridesResolver:(e,t)=>t.img})({width:"100%",height:"100%",textAlign:"center",objectFit:"cover",color:"transparent",textIndent:1e4}),hn=Xt(qt,{name:"MuiAvatar",slot:"Fallback",overridesResolver:(e,t)=>t.fallback})({width:"75%",height:"75%"});const An=t.forwardRef((function(e,n){const i=Nt({props:e,name:"MuiAvatar"}),{alt:o,children:r,className:a,component:s="div",slots:g={},slotProps:l={},imgProps:c,sizes:I,src:C,srcSet:u,variant:d="circular"}=i,h=(0,Ce.A)(i,Cn);let A=null;const p=function(e){let{crossOrigin:n,referrerPolicy:i,src:o,srcSet:r}=e;const[a,s]=t.useState(!1);return t.useEffect((()=>{if(!o&&!r)return;s(!1);let e=!0;const t=new Image;return t.onload=()=>{e&&s("loaded")},t.onerror=()=>{e&&s("error")},t.crossOrigin=n,t.referrerPolicy=i,t.src=o,r&&(t.srcset=r),()=>{e=!1}}),[n,i,o,r]),a}((0,ue.A)({},c,{src:C,srcSet:u})),m=C||u,b=m&&"error"!==p,f=(0,ue.A)({},i,{colorDefault:!b,component:s,variant:d}),y=(e=>{const{classes:t,variant:n,colorDefault:i}=e;return fe({root:["root",n,i&&"colorDefault"],img:["img"],fallback:["fallback"]},$t,t)})(f),[G,v]=function(e,t){const{className:n,elementType:i,ownerState:o,externalForwardedProps:r,getSlotOwnerState:a,internalForwardedProps:s}=t,g=(0,Ce.A)(t,ln),{component:l,slots:c={[e]:void 0},slotProps:I={[e]:void 0}}=r,C=(0,Ce.A)(r,cn),u=c[e]||i,d=rn(I[e],o),h=gn((0,ue.A)({className:n},g,{externalForwardedProps:"root"===e?C:void 0,externalSlotProps:d})),{props:{component:A},internalRef:p}=h,m=(0,Ce.A)(h.props,In),b=tn(p,null==d?void 0:d.ref,t.ref),f=a?a(m):{},y=(0,ue.A)({},o,f),G="root"===e?A||l:A,v=on(u,(0,ue.A)({},"root"===e&&!l&&!c[e]&&s,"root"!==e&&!c[e]&&s,m,G&&{as:G},{ref:b}),y);return Object.keys(f).forEach((e=>{delete v[e]})),[u,v]}("img",{className:y.img,elementType:dn,externalForwardedProps:{slots:g,slotProps:{img:(0,ue.A)({},c,l.img)}},additionalProps:{alt:o,src:C,srcSet:u,sizes:I},ownerState:f});return A=b?(0,ce.jsx)(G,(0,ue.A)({},v)):r||0===r?r:m&&o?o[0]:(0,ce.jsx)(hn,{ownerState:f,className:y.fallback}),(0,ce.jsx)(un,(0,ue.A)({as:s,ownerState:f,className:he(y.root,a),ref:n},h,{children:A}))})),pn=An;var mn=n(9751);function bn(){const e=We(St);return e[Rt]||e}const fn=t.createContext();function yn(e){return be("MuiGrid",e)}const Gn=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],vn=zt("MuiGrid",["root","container","item","zeroMinWidth",...[0,1,2,3,4,5,6,7,8,9,10].map((e=>`spacing-xs-${e}`)),...["column-reverse","column","row-reverse","row"].map((e=>`direction-xs-${e}`)),...["nowrap","wrap-reverse","wrap"].map((e=>`wrap-xs-${e}`)),...Gn.map((e=>`grid-xs-${e}`)),...Gn.map((e=>`grid-sm-${e}`)),...Gn.map((e=>`grid-md-${e}`)),...Gn.map((e=>`grid-lg-${e}`)),...Gn.map((e=>`grid-xl-${e}`))]),Bn=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function Zn(e){const t=parseFloat(e);return`${t}${String(e).replace(String(t),"")||"px"}`}function wn(e){let{breakpoints:t,values:n}=e,i="";Object.keys(n).forEach((e=>{""===i&&0!==n[e]&&(i=e)}));const o=Object.keys(t).sort(((e,n)=>t[e]-t[n]));return o.slice(0,o.indexOf(i))}const Wn=Xt("div",{name:"MuiGrid",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e,{container:i,direction:o,item:r,spacing:a,wrap:s,zeroMinWidth:g,breakpoints:l}=n;let c=[];i&&(c=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e||e<=0)return[];if("string"===typeof e&&!Number.isNaN(Number(e))||"number"===typeof e)return[n[`spacing-xs-${String(e)}`]];const i=[];return t.forEach((t=>{const o=e[t];Number(o)>0&&i.push(n[`spacing-${t}-${String(o)}`])})),i}(a,l,t));const I=[];return l.forEach((e=>{const i=n[e];i&&I.push(t[`grid-${e}-${String(i)}`])})),[t.root,i&&t.container,r&&t.item,g&&t.zeroMinWidth,...c,"row"!==o&&t[`direction-xs-${String(o)}`],"wrap"!==s&&t[`wrap-xs-${String(s)}`],...I]}})((e=>{let{ownerState:t}=e;return(0,ue.A)({boxSizing:"border-box"},t.container&&{display:"flex",flexWrap:"wrap",width:"100%"},t.item&&{margin:0},t.zeroMinWidth&&{minWidth:0},"wrap"!==t.wrap&&{flexWrap:t.wrap})}),(function(e){let{theme:t,ownerState:n}=e;const i=(0,mn.kW)({values:n.direction,breakpoints:t.breakpoints.values});return(0,mn.NI)({theme:t},i,(e=>{const t={flexDirection:e};return 0===e.indexOf("column")&&(t[`& > .${vn.item}`]={maxWidth:"none"}),t}))}),(function(e){let{theme:t,ownerState:n}=e;const{container:i,rowSpacing:o}=n;let r={};if(i&&0!==o){const e=(0,mn.kW)({values:o,breakpoints:t.breakpoints.values});let n;"object"===typeof e&&(n=wn({breakpoints:t.breakpoints.values,values:e})),r=(0,mn.NI)({theme:t},e,((e,i)=>{var o;const r=t.spacing(e);return"0px"!==r?{marginTop:`-${Zn(r)}`,[`& > .${vn.item}`]:{paddingTop:Zn(r)}}:null!=(o=n)&&o.includes(i)?{}:{marginTop:0,[`& > .${vn.item}`]:{paddingTop:0}}}))}return r}),(function(e){let{theme:t,ownerState:n}=e;const{container:i,columnSpacing:o}=n;let r={};if(i&&0!==o){const e=(0,mn.kW)({values:o,breakpoints:t.breakpoints.values});let n;"object"===typeof e&&(n=wn({breakpoints:t.breakpoints.values,values:e})),r=(0,mn.NI)({theme:t},e,((e,i)=>{var o;const r=t.spacing(e);return"0px"!==r?{width:`calc(100% + ${Zn(r)})`,marginLeft:`-${Zn(r)}`,[`& > .${vn.item}`]:{paddingLeft:Zn(r)}}:null!=(o=n)&&o.includes(i)?{}:{width:"100%",marginLeft:0,[`& > .${vn.item}`]:{paddingLeft:0}}}))}return r}),(function(e){let t,{theme:n,ownerState:i}=e;return n.breakpoints.keys.reduce(((e,o)=>{let r={};if(i[o]&&(t=i[o]),!t)return e;if(!0===t)r={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if("auto"===t)r={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const a=(0,mn.kW)({values:i.columns,breakpoints:n.breakpoints.values}),s="object"===typeof a?a[o]:a;if(void 0===s||null===s)return e;const g=Math.round(t/s*1e8)/1e6+"%";let l={};if(i.container&&i.item&&0!==i.columnSpacing){const e=n.spacing(i.columnSpacing);if("0px"!==e){const t=`calc(${g} + ${Zn(e)})`;l={flexBasis:t,maxWidth:t}}}r=(0,ue.A)({flexBasis:g,flexGrow:0,maxWidth:g},l)}return 0===n.breakpoints.values[o]?Object.assign(e,r):e[n.breakpoints.up(o)]=r,e}),{})}));const Sn=e=>{const{classes:t,container:n,direction:i,item:o,spacing:r,wrap:a,zeroMinWidth:s,breakpoints:g}=e;let l=[];n&&(l=function(e,t){if(!e||e<=0)return[];if("string"===typeof e&&!Number.isNaN(Number(e))||"number"===typeof e)return[`spacing-xs-${String(e)}`];const n=[];return t.forEach((t=>{const i=e[t];if(Number(i)>0){const e=`spacing-${t}-${String(i)}`;n.push(e)}})),n}(r,g));const c=[];g.forEach((t=>{const n=e[t];n&&c.push(`grid-${t}-${String(n)}`)}));return fe({root:["root",n&&"container",o&&"item",s&&"zeroMinWidth",...l,"row"!==i&&`direction-xs-${String(i)}`,"wrap"!==a&&`wrap-xs-${String(a)}`,...c]},yn,t)},Rn=t.forwardRef((function(e,n){const i=Nt({props:e,name:"MuiGrid"}),{breakpoints:o}=bn(),r=(0,kt.A)(i),{className:a,columns:s,columnSpacing:g,component:l="div",container:c=!1,direction:I="row",item:C=!1,rowSpacing:u,spacing:d=0,wrap:h="wrap",zeroMinWidth:A=!1}=r,p=(0,Ce.A)(r,Bn),m=u||d,b=g||d,f=t.useContext(fn),y=c?s||12:f,G={},v=(0,ue.A)({},p);o.keys.forEach((e=>{null!=p[e]&&(G[e]=p[e],delete v[e])}));const B=(0,ue.A)({},r,{columns:y,container:c,direction:I,item:C,rowSpacing:m,columnSpacing:b,wrap:h,zeroMinWidth:A,spacing:d},G,{breakpoints:o.keys}),Z=Sn(B);return(0,ce.jsx)(fn.Provider,{value:y,children:(0,ce.jsx)(Wn,(0,ue.A)({ownerState:B,className:he(Z.root,a),as:l,ref:n},v))})}));const xn=Rn,Vn={};const Xn=[];class Hn{constructor(){this.currentId=null,this.clear=()=>{null!==this.currentId&&(clearTimeout(this.currentId),this.currentId=null)},this.disposeEffect=()=>this.clear}static create(){return new Hn}start(e,t){this.clear(),this.currentId=setTimeout((()=>{this.currentId=null,t()}),e)}}function Yn(){const e=function(e,n){const i=t.useRef(Vn);return i.current===Vn&&(i.current=e(n)),i}(Hn.create).current;var n;return n=e.disposeEffect,t.useEffect(n,Xn),e}let Kn=!0,Nn=!1;const Mn=new Hn,Fn={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function kn(e){e.metaKey||e.altKey||e.ctrlKey||(Kn=!0)}function zn(){Kn=!1}function Ln(){"hidden"===this.visibilityState&&Nn&&(Kn=!0)}function Tn(e){const{target:t}=e;try{return t.matches(":focus-visible")}catch(n){}return Kn||function(e){const{type:t,tagName:n}=e;return!("INPUT"!==n||!Fn[t]||e.readOnly)||"TEXTAREA"===n&&!e.readOnly||!!e.isContentEditable}(t)}const En=function(){const e=t.useCallback((e=>{var t;null!=e&&((t=e.ownerDocument).addEventListener("keydown",kn,!0),t.addEventListener("mousedown",zn,!0),t.addEventListener("pointerdown",zn,!0),t.addEventListener("touchstart",zn,!0),t.addEventListener("visibilitychange",Ln,!0))}),[]),n=t.useRef(!1);return{isFocusVisibleRef:n,onFocus:function(e){return!!Tn(e)&&(n.current=!0,!0)},onBlur:function(){return!!n.current&&(Nn=!0,Mn.start(100,(()=>{Nn=!1})),n.current=!1,!0)},ref:e}},Jn=tn;function Un(e){return be("MuiLink",e)}const Dn=zt("MuiLink",["root","underlineNone","underlineHover","underlineAlways","button","focusVisible"]);var Pn=n(7162);const Qn={primary:"primary.main",textPrimary:"text.primary",secondary:"secondary.main",textSecondary:"text.secondary",error:"error.main"},_n=e=>{let{theme:t,ownerState:n}=e;const i=(e=>Qn[e]||e)(n.color),o=(0,Pn.Yn)(t,`palette.${i}`,!1)||n.color,r=(0,Pn.Yn)(t,`palette.${i}Channel`);return"vars"in t&&r?`rgba(${r} / 0.4)`:(0,qe.X4)(o,.4)},jn=["className","color","component","onBlur","onFocus","TypographyClasses","underline","variant","sx"],On=Xt(Dt,{name:"MuiLink",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[`underline${Pe(n.underline)}`],"button"===n.component&&t.button]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ue.A)({},"none"===n.underline&&{textDecoration:"none"},"hover"===n.underline&&{textDecoration:"none","&:hover":{textDecoration:"underline"}},"always"===n.underline&&(0,ue.A)({textDecoration:"underline"},"inherit"!==n.color&&{textDecorationColor:_n({theme:t,ownerState:n})},{"&:hover":{textDecorationColor:"inherit"}}),"button"===n.component&&{position:"relative",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none","&::-moz-focus-inner":{borderStyle:"none"},[`&.${Dn.focusVisible}`]:{outline:"auto"}})})),qn=t.forwardRef((function(e,n){const i=Nt({props:e,name:"MuiLink"}),{className:o,color:r="primary",component:a="a",onBlur:s,onFocus:g,TypographyClasses:l,underline:c="always",variant:I="inherit",sx:C}=i,u=(0,Ce.A)(i,jn),{isFocusVisibleRef:d,onBlur:h,onFocus:A,ref:p}=En(),[m,b]=t.useState(!1),f=Jn(n,p),y=(0,ue.A)({},i,{color:r,component:a,focusVisible:m,underline:c,variant:I}),G=(e=>{const{classes:t,component:n,focusVisible:i,underline:o}=e;return fe({root:["root",`underline${Pe(o)}`,"button"===n&&"button",i&&"focusVisible"]},Un,t)})(y);return(0,ce.jsx)(On,(0,ue.A)({color:r,className:he(G.root,o),classes:l,component:a,onBlur:e=>{h(e),!1===d.current&&b(!1),s&&s(e)},onFocus:e=>{A(e),!0===d.current&&b(!0),g&&g(e)},ref:f,ownerState:y,variant:I,sx:[...Object.keys(Qn).includes(r)?[]:[{color:r}],...Array.isArray(C)?C:[C]]},u))}));const $n=t.createContext(null);function ei(){return t.useContext($n)}const ti="function"===typeof Symbol&&Symbol.for?Symbol.for("mui.nested"):"__THEME_NESTED__";const ni=function(e){const{children:n,theme:i}=e,o=ei(),r=t.useMemo((()=>{const e=null===o?i:function(e,t){if("function"===typeof t)return t(e);return(0,ue.A)({},e,t)}(o,i);return null!=e&&(e[ti]=null!==o),e}),[i,o]);return(0,ce.jsx)($n.Provider,{value:r,children:n})},ii=["value"],oi=t.createContext();const ri=function(e){let{value:t}=e,n=(0,Ce.A)(e,ii);return(0,ce.jsx)(oi.Provider,(0,ue.A)({value:null==t||t},n))},ai={};function si(e,n,i){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return t.useMemo((()=>{const t=e&&n[e]||n;if("function"===typeof i){const r=i(t),a=e?(0,ue.A)({},n,{[e]:r}):r;return o?()=>a:a}return e?(0,ue.A)({},n,{[e]:i}):(0,ue.A)({},n,i)}),[e,n,i,o])}const gi=function(e){const{children:t,theme:n,themeId:i}=e,o=Ze(ai),r=ei()||ai,a=si(i,o,n),s=si(i,r,n,!0),g="rtl"===a.direction;return(0,ce.jsx)(ni,{theme:s,children:(0,ce.jsx)(Be.T.Provider,{value:a,children:(0,ce.jsx)(ri,{value:g,children:(0,ce.jsx)(Kt,{value:null==a?void 0:a.components,children:t})})})})},li=["theme"];function ci(e){let{theme:t}=e,n=(0,Ce.A)(e,li);const i=t[Rt];return(0,ce.jsx)(gi,(0,ue.A)({},n,{themeId:i?Rt:void 0,theme:i||t}))}const Ii=n.p+"static/media/downarrow.5cab4f7e8fb30c016c14.png",Ci=n.p+"static/media/linkedinlogo.263da0ba9e782b8ecd5b.png";function ui(e){return be("MuiCardActionArea",e)}const di=zt("MuiCardActionArea",["root","focusVisible","focusHighlight"]),hi="undefined"!==typeof window?t.useLayoutEffect:t.useEffect;const Ai=function(e){const n=t.useRef(e);return hi((()=>{n.current=e})),t.useRef((function(){return(0,n.current)(...arguments)})).current},pi=Ai;function mi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function bi(e,t){return bi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},bi(e,t)}function fi(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,bi(e,t)}const yi=t.createContext(null);function Gi(e,n){var i=Object.create(null);return e&&t.Children.map(e,(function(e){return e})).forEach((function(e){i[e.key]=function(e){return n&&(0,t.isValidElement)(e)?n(e):e}(e)})),i}function vi(e,t,n){return null!=n[t]?n[t]:e.props[t]}function Bi(e,n,i){var o=Gi(e.children),r=function(e,t){function n(n){return n in t?t[n]:e[n]}e=e||{},t=t||{};var i,o=Object.create(null),r=[];for(var a in e)a in t?r.length&&(o[a]=r,r=[]):r.push(a);var s={};for(var g in t){if(o[g])for(i=0;i<o[g].length;i++){var l=o[g][i];s[o[g][i]]=n(l)}s[g]=n(g)}for(i=0;i<r.length;i++)s[r[i]]=n(r[i]);return s}(n,o);return Object.keys(r).forEach((function(a){var s=r[a];if((0,t.isValidElement)(s)){var g=a in n,l=a in o,c=n[a],I=(0,t.isValidElement)(c)&&!c.props.in;!l||g&&!I?l||!g||I?l&&g&&(0,t.isValidElement)(c)&&(r[a]=(0,t.cloneElement)(s,{onExited:i.bind(null,s),in:c.props.in,exit:vi(s,"exit",e),enter:vi(s,"enter",e)})):r[a]=(0,t.cloneElement)(s,{in:!1}):r[a]=(0,t.cloneElement)(s,{onExited:i.bind(null,s),in:!0,exit:vi(s,"exit",e),enter:vi(s,"enter",e)})}})),r}var Zi=Object.values||function(e){return Object.keys(e).map((function(t){return e[t]}))},wi=function(e){function n(t,n){var i,o=(i=e.call(this,t,n)||this).handleExited.bind(mi(i));return i.state={contextValue:{isMounting:!0},handleExited:o,firstRender:!0},i}fi(n,e);var i=n.prototype;return i.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},i.componentWillUnmount=function(){this.mounted=!1},n.getDerivedStateFromProps=function(e,n){var i,o,r=n.children,a=n.handleExited;return{children:n.firstRender?(i=e,o=a,Gi(i.children,(function(e){return(0,t.cloneElement)(e,{onExited:o.bind(null,e),in:!0,appear:vi(e,"appear",i),enter:vi(e,"enter",i),exit:vi(e,"exit",i)})}))):Bi(e,r,a),firstRender:!1}},i.handleExited=function(e,t){var n=Gi(this.props.children);e.key in n||(e.props.onExited&&e.props.onExited(t),this.mounted&&this.setState((function(t){var n=(0,ue.A)({},t.children);return delete n[e.key],{children:n}})))},i.render=function(){var e=this.props,n=e.component,i=e.childFactory,o=(0,Ce.A)(e,["component","childFactory"]),r=this.state.contextValue,a=Zi(this.state.children).map(i);return delete o.appear,delete o.enter,delete o.exit,null===n?t.createElement(yi.Provider,{value:r},a):t.createElement(yi.Provider,{value:r},t.createElement(n,o,a))},n}(t.Component);wi.propTypes={},wi.defaultProps={component:"div",childFactory:function(e){return e}};const Wi=wi;var Si=n(3290);const Ri=function(e){const{className:n,classes:i,pulsate:o=!1,rippleX:r,rippleY:a,rippleSize:s,in:g,onExited:l,timeout:c}=e,[I,C]=t.useState(!1),u=he(n,i.ripple,i.rippleVisible,o&&i.ripplePulsate),d={width:s,height:s,top:-s/2+a,left:-s/2+r},h=he(i.child,I&&i.childLeaving,o&&i.childPulsate);return g||I||C(!0),t.useEffect((()=>{if(!g&&null!=l){const e=setTimeout(l,c);return()=>{clearTimeout(e)}}}),[l,g,c]),(0,ce.jsx)("span",{className:u,style:d,children:(0,ce.jsx)("span",{className:h})})};const xi=zt("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),Vi=["center","classes","className"];let Xi,Hi,Yi,Ki,Ni=e=>e;const Mi=(0,Si.i7)(Xi||(Xi=Ni`
  0% {
    transform: scale(0);
    opacity: 0.1;
  }

  100% {
    transform: scale(1);
    opacity: 0.3;
  }
`)),Fi=(0,Si.i7)(Hi||(Hi=Ni`
  0% {
    opacity: 1;
  }

  100% {
    opacity: 0;
  }
`)),ki=(0,Si.i7)(Yi||(Yi=Ni`
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(0.92);
  }

  100% {
    transform: scale(1);
  }
`)),zi=Xt("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),Li=Xt(Ri,{name:"MuiTouchRipple",slot:"Ripple"})(Ki||(Ki=Ni`
  opacity: 0;
  position: absolute;

  &.${0} {
    opacity: 0.3;
    transform: scale(1);
    animation-name: ${0};
    animation-duration: ${0}ms;
    animation-timing-function: ${0};
  }

  &.${0} {
    animation-duration: ${0}ms;
  }

  & .${0} {
    opacity: 1;
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: currentColor;
  }

  & .${0} {
    opacity: 0;
    animation-name: ${0};
    animation-duration: ${0}ms;
    animation-timing-function: ${0};
  }

  & .${0} {
    position: absolute;
    /* @noflip */
    left: 0px;
    top: 0;
    animation-name: ${0};
    animation-duration: 2500ms;
    animation-timing-function: ${0};
    animation-iteration-count: infinite;
    animation-delay: 200ms;
  }
`),xi.rippleVisible,Mi,550,(e=>{let{theme:t}=e;return t.transitions.easing.easeInOut}),xi.ripplePulsate,(e=>{let{theme:t}=e;return t.transitions.duration.shorter}),xi.child,xi.childLeaving,Fi,550,(e=>{let{theme:t}=e;return t.transitions.easing.easeInOut}),xi.childPulsate,ki,(e=>{let{theme:t}=e;return t.transitions.easing.easeInOut})),Ti=t.forwardRef((function(e,n){const i=Nt({props:e,name:"MuiTouchRipple"}),{center:o=!1,classes:r={},className:a}=i,s=(0,Ce.A)(i,Vi),[g,l]=t.useState([]),c=t.useRef(0),I=t.useRef(null);t.useEffect((()=>{I.current&&(I.current(),I.current=null)}),[g]);const C=t.useRef(!1),u=Yn(),d=t.useRef(null),h=t.useRef(null),A=t.useCallback((e=>{const{pulsate:t,rippleX:n,rippleY:i,rippleSize:o,cb:a}=e;l((e=>[...e,(0,ce.jsx)(Li,{classes:{ripple:he(r.ripple,xi.ripple),rippleVisible:he(r.rippleVisible,xi.rippleVisible),ripplePulsate:he(r.ripplePulsate,xi.ripplePulsate),child:he(r.child,xi.child),childLeaving:he(r.childLeaving,xi.childLeaving),childPulsate:he(r.childPulsate,xi.childPulsate)},timeout:550,pulsate:t,rippleX:n,rippleY:i,rippleSize:o},c.current)])),c.current+=1,I.current=a}),[r]),p=t.useCallback((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const{pulsate:i=!1,center:r=o||t.pulsate,fakeElement:a=!1}=t;if("mousedown"===(null==e?void 0:e.type)&&C.current)return void(C.current=!1);"touchstart"===(null==e?void 0:e.type)&&(C.current=!0);const s=a?null:h.current,g=s?s.getBoundingClientRect():{width:0,height:0,left:0,top:0};let l,c,I;if(r||void 0===e||0===e.clientX&&0===e.clientY||!e.clientX&&!e.touches)l=Math.round(g.width/2),c=Math.round(g.height/2);else{const{clientX:t,clientY:n}=e.touches&&e.touches.length>0?e.touches[0]:e;l=Math.round(t-g.left),c=Math.round(n-g.top)}if(r)I=Math.sqrt((2*g.width**2+g.height**2)/3),I%2===0&&(I+=1);else{const e=2*Math.max(Math.abs((s?s.clientWidth:0)-l),l)+2,t=2*Math.max(Math.abs((s?s.clientHeight:0)-c),c)+2;I=Math.sqrt(e**2+t**2)}null!=e&&e.touches?null===d.current&&(d.current=()=>{A({pulsate:i,rippleX:l,rippleY:c,rippleSize:I,cb:n})},u.start(80,(()=>{d.current&&(d.current(),d.current=null)}))):A({pulsate:i,rippleX:l,rippleY:c,rippleSize:I,cb:n})}),[o,A,u]),m=t.useCallback((()=>{p({},{pulsate:!0})}),[p]),b=t.useCallback(((e,t)=>{if(u.clear(),"touchend"===(null==e?void 0:e.type)&&d.current)return d.current(),d.current=null,void u.start(0,(()=>{b(e,t)}));d.current=null,l((e=>e.length>0?e.slice(1):e)),I.current=t}),[u]);return t.useImperativeHandle(n,(()=>({pulsate:m,start:p,stop:b})),[m,p,b]),(0,ce.jsx)(zi,(0,ue.A)({className:he(xi.root,r.root,a),ref:h},s,{children:(0,ce.jsx)(Wi,{component:null,exit:!0,children:g})}))}));function Ei(e){return be("MuiButtonBase",e)}const Ji=zt("MuiButtonBase",["root","disabled","focusVisible"]),Ui=["action","centerRipple","children","className","component","disabled","disableRipple","disableTouchRipple","focusRipple","focusVisibleClassName","LinkComponent","onBlur","onClick","onContextMenu","onDragLeave","onFocus","onFocusVisible","onKeyDown","onKeyUp","onMouseDown","onMouseLeave","onMouseUp","onTouchEnd","onTouchMove","onTouchStart","tabIndex","TouchRippleProps","touchRippleRef","type"],Di=Xt("button",{name:"MuiButtonBase",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},[`&.${Ji.disabled}`]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}}),Pi=t.forwardRef((function(e,n){const i=Nt({props:e,name:"MuiButtonBase"}),{action:o,centerRipple:r=!1,children:a,className:s,component:g="button",disabled:l=!1,disableRipple:c=!1,disableTouchRipple:I=!1,focusRipple:C=!1,LinkComponent:u="a",onBlur:d,onClick:h,onContextMenu:A,onDragLeave:p,onFocus:m,onFocusVisible:b,onKeyDown:f,onKeyUp:y,onMouseDown:G,onMouseLeave:v,onMouseUp:B,onTouchEnd:Z,onTouchMove:w,onTouchStart:W,tabIndex:S=0,TouchRippleProps:R,touchRippleRef:x,type:V}=i,X=(0,Ce.A)(i,Ui),H=t.useRef(null),Y=t.useRef(null),K=Jn(Y,x),{isFocusVisibleRef:N,onFocus:M,onBlur:F,ref:k}=En(),[z,L]=t.useState(!1);l&&z&&L(!1),t.useImperativeHandle(o,(()=>({focusVisible:()=>{L(!0),H.current.focus()}})),[]);const[T,E]=t.useState(!1);t.useEffect((()=>{E(!0)}),[]);const J=T&&!c&&!l;function U(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:I;return pi((i=>{t&&t(i);return!n&&Y.current&&Y.current[e](i),!0}))}t.useEffect((()=>{z&&C&&!c&&T&&Y.current.pulsate()}),[c,C,z,T]);const D=U("start",G),P=U("stop",A),Q=U("stop",p),_=U("stop",B),j=U("stop",(e=>{z&&e.preventDefault(),v&&v(e)})),O=U("start",W),q=U("stop",Z),$=U("stop",w),ee=U("stop",(e=>{F(e),!1===N.current&&L(!1),d&&d(e)}),!1),te=pi((e=>{H.current||(H.current=e.currentTarget),M(e),!0===N.current&&(L(!0),b&&b(e)),m&&m(e)})),ne=()=>{const e=H.current;return g&&"button"!==g&&!("A"===e.tagName&&e.href)},ie=t.useRef(!1),oe=pi((e=>{C&&!ie.current&&z&&Y.current&&" "===e.key&&(ie.current=!0,Y.current.stop(e,(()=>{Y.current.start(e)}))),e.target===e.currentTarget&&ne()&&" "===e.key&&e.preventDefault(),f&&f(e),e.target===e.currentTarget&&ne()&&"Enter"===e.key&&!l&&(e.preventDefault(),h&&h(e))})),re=pi((e=>{C&&" "===e.key&&Y.current&&z&&!e.defaultPrevented&&(ie.current=!1,Y.current.stop(e,(()=>{Y.current.pulsate(e)}))),y&&y(e),h&&e.target===e.currentTarget&&ne()&&" "===e.key&&!e.defaultPrevented&&h(e)}));let ae=g;"button"===ae&&(X.href||X.to)&&(ae=u);const se={};"button"===ae?(se.type=void 0===V?"button":V,se.disabled=l):(X.href||X.to||(se.role="button"),l&&(se["aria-disabled"]=l));const ge=Jn(n,k,H);const le=(0,ue.A)({},i,{centerRipple:r,component:g,disabled:l,disableRipple:c,disableTouchRipple:I,focusRipple:C,tabIndex:S,focusVisible:z}),Ie=(e=>{const{disabled:t,focusVisible:n,focusVisibleClassName:i,classes:o}=e,r=fe({root:["root",t&&"disabled",n&&"focusVisible"]},Ei,o);return n&&i&&(r.root+=` ${i}`),r})(le);return(0,ce.jsxs)(Di,(0,ue.A)({as:ae,className:he(Ie.root,s),ownerState:le,onBlur:ee,onClick:h,onContextMenu:P,onFocus:te,onKeyDown:oe,onKeyUp:re,onMouseDown:D,onMouseLeave:j,onMouseUp:_,onDragLeave:Q,onTouchEnd:q,onTouchMove:$,onTouchStart:O,ref:ge,tabIndex:l?-1:S,type:V},se,X,{children:[a,J?(0,ce.jsx)(Ti,(0,ue.A)({ref:K,center:r},R)):null]}))})),Qi=Pi,_i=["children","className","focusVisibleClassName"],ji=Xt(Qi,{name:"MuiCardActionArea",slot:"Root",overridesResolver:(e,t)=>t.root})((e=>{let{theme:t}=e;return{display:"block",textAlign:"inherit",borderRadius:"inherit",width:"100%",[`&:hover .${di.focusHighlight}`]:{opacity:(t.vars||t).palette.action.hoverOpacity,"@media (hover: none)":{opacity:0}},[`&.${di.focusVisible} .${di.focusHighlight}`]:{opacity:(t.vars||t).palette.action.focusOpacity}}})),Oi=Xt("span",{name:"MuiCardActionArea",slot:"FocusHighlight",overridesResolver:(e,t)=>t.focusHighlight})((e=>{let{theme:t}=e;return{overflow:"hidden",pointerEvents:"none",position:"absolute",top:0,right:0,bottom:0,left:0,borderRadius:"inherit",opacity:0,backgroundColor:"currentcolor",transition:t.transitions.create("opacity",{duration:t.transitions.duration.short})}})),qi=t.forwardRef((function(e,t){const n=Nt({props:e,name:"MuiCardActionArea"}),{children:i,className:o,focusVisibleClassName:r}=n,a=(0,Ce.A)(n,_i),s=n,g=(e=>{const{classes:t}=e;return fe({root:["root"],focusHighlight:["focusHighlight"]},ui,t)})(s);return(0,ce.jsxs)(ji,(0,ue.A)({className:he(g.root,o),focusVisibleClassName:he(r,g.focusVisible),ref:t,ownerState:s},a,{children:[i,(0,ce.jsx)(Oi,{className:g.focusHighlight,ownerState:s})]}))}));function $i(e){return be("MuiButton",e)}const eo=zt("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","colorPrimary","colorSecondary","colorSuccess","colorError","colorInfo","colorWarning","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","icon","iconSizeSmall","iconSizeMedium","iconSizeLarge"]);const to=t.createContext({});const no=t.createContext(void 0),io=["children","color","component","className","disabled","disableElevation","disableFocusRipple","endIcon","focusVisibleClassName","fullWidth","size","startIcon","type","variant"],oo=e=>(0,ue.A)({},"small"===e.size&&{"& > *:nth-of-type(1)":{fontSize:18}},"medium"===e.size&&{"& > *:nth-of-type(1)":{fontSize:20}},"large"===e.size&&{"& > *:nth-of-type(1)":{fontSize:22}}),ro=Xt(Qi,{shouldForwardProp:e=>Vt(e)||"classes"===e,name:"MuiButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.variant],t[`${n.variant}${Pe(n.color)}`],t[`size${Pe(n.size)}`],t[`${n.variant}Size${Pe(n.size)}`],"inherit"===n.color&&t.colorInherit,n.disableElevation&&t.disableElevation,n.fullWidth&&t.fullWidth]}})((e=>{let{theme:t,ownerState:n}=e;var i,o;const r="light"===t.palette.mode?t.palette.grey[300]:t.palette.grey[800],a="light"===t.palette.mode?t.palette.grey.A100:t.palette.grey[700];return(0,ue.A)({},t.typography.button,{minWidth:64,padding:"6px 16px",borderRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create(["background-color","box-shadow","border-color","color"],{duration:t.transitions.duration.short}),"&:hover":(0,ue.A)({textDecoration:"none",backgroundColor:t.vars?`rgba(${t.vars.palette.text.primaryChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,qe.X4)(t.palette.text.primary,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"text"===n.variant&&"inherit"!==n.color&&{backgroundColor:t.vars?`rgba(${t.vars.palette[n.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,qe.X4)(t.palette[n.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"outlined"===n.variant&&"inherit"!==n.color&&{border:`1px solid ${(t.vars||t).palette[n.color].main}`,backgroundColor:t.vars?`rgba(${t.vars.palette[n.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:(0,qe.X4)(t.palette[n.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"contained"===n.variant&&{backgroundColor:t.vars?t.vars.palette.Button.inheritContainedHoverBg:a,boxShadow:(t.vars||t).shadows[4],"@media (hover: none)":{boxShadow:(t.vars||t).shadows[2],backgroundColor:(t.vars||t).palette.grey[300]}},"contained"===n.variant&&"inherit"!==n.color&&{backgroundColor:(t.vars||t).palette[n.color].dark,"@media (hover: none)":{backgroundColor:(t.vars||t).palette[n.color].main}}),"&:active":(0,ue.A)({},"contained"===n.variant&&{boxShadow:(t.vars||t).shadows[8]}),[`&.${eo.focusVisible}`]:(0,ue.A)({},"contained"===n.variant&&{boxShadow:(t.vars||t).shadows[6]}),[`&.${eo.disabled}`]:(0,ue.A)({color:(t.vars||t).palette.action.disabled},"outlined"===n.variant&&{border:`1px solid ${(t.vars||t).palette.action.disabledBackground}`},"contained"===n.variant&&{color:(t.vars||t).palette.action.disabled,boxShadow:(t.vars||t).shadows[0],backgroundColor:(t.vars||t).palette.action.disabledBackground})},"text"===n.variant&&{padding:"6px 8px"},"text"===n.variant&&"inherit"!==n.color&&{color:(t.vars||t).palette[n.color].main},"outlined"===n.variant&&{padding:"5px 15px",border:"1px solid currentColor"},"outlined"===n.variant&&"inherit"!==n.color&&{color:(t.vars||t).palette[n.color].main,border:t.vars?`1px solid rgba(${t.vars.palette[n.color].mainChannel} / 0.5)`:`1px solid ${(0,qe.X4)(t.palette[n.color].main,.5)}`},"contained"===n.variant&&{color:t.vars?t.vars.palette.text.primary:null==(i=(o=t.palette).getContrastText)?void 0:i.call(o,t.palette.grey[300]),backgroundColor:t.vars?t.vars.palette.Button.inheritContainedBg:r,boxShadow:(t.vars||t).shadows[2]},"contained"===n.variant&&"inherit"!==n.color&&{color:(t.vars||t).palette[n.color].contrastText,backgroundColor:(t.vars||t).palette[n.color].main},"inherit"===n.color&&{color:"inherit",borderColor:"currentColor"},"small"===n.size&&"text"===n.variant&&{padding:"4px 5px",fontSize:t.typography.pxToRem(13)},"large"===n.size&&"text"===n.variant&&{padding:"8px 11px",fontSize:t.typography.pxToRem(15)},"small"===n.size&&"outlined"===n.variant&&{padding:"3px 9px",fontSize:t.typography.pxToRem(13)},"large"===n.size&&"outlined"===n.variant&&{padding:"7px 21px",fontSize:t.typography.pxToRem(15)},"small"===n.size&&"contained"===n.variant&&{padding:"4px 10px",fontSize:t.typography.pxToRem(13)},"large"===n.size&&"contained"===n.variant&&{padding:"8px 22px",fontSize:t.typography.pxToRem(15)},n.fullWidth&&{width:"100%"})}),(e=>{let{ownerState:t}=e;return t.disableElevation&&{boxShadow:"none","&:hover":{boxShadow:"none"},[`&.${eo.focusVisible}`]:{boxShadow:"none"},"&:active":{boxShadow:"none"},[`&.${eo.disabled}`]:{boxShadow:"none"}}})),ao=Xt("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.startIcon,t[`iconSize${Pe(n.size)}`]]}})((e=>{let{ownerState:t}=e;return(0,ue.A)({display:"inherit",marginRight:8,marginLeft:-4},"small"===t.size&&{marginLeft:-2},oo(t))})),so=Xt("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.endIcon,t[`iconSize${Pe(n.size)}`]]}})((e=>{let{ownerState:t}=e;return(0,ue.A)({display:"inherit",marginRight:-4,marginLeft:8},"small"===t.size&&{marginRight:-2},oo(t))})),go=t.forwardRef((function(e,n){const i=t.useContext(to),o=t.useContext(no),r=Nt({props:Ge(i,e),name:"MuiButton"}),{children:a,color:s="primary",component:g="button",className:l,disabled:c=!1,disableElevation:I=!1,disableFocusRipple:C=!1,endIcon:u,focusVisibleClassName:d,fullWidth:h=!1,size:A="medium",startIcon:p,type:m,variant:b="text"}=r,f=(0,Ce.A)(r,io),y=(0,ue.A)({},r,{color:s,component:g,disabled:c,disableElevation:I,disableFocusRipple:C,fullWidth:h,size:A,type:m,variant:b}),G=(e=>{const{color:t,disableElevation:n,fullWidth:i,size:o,variant:r,classes:a}=e,s=fe({root:["root",r,`${r}${Pe(t)}`,`size${Pe(o)}`,`${r}Size${Pe(o)}`,`color${Pe(t)}`,n&&"disableElevation",i&&"fullWidth"],label:["label"],startIcon:["icon","startIcon",`iconSize${Pe(o)}`],endIcon:["icon","endIcon",`iconSize${Pe(o)}`]},$i,a);return(0,ue.A)({},a,s)})(y),v=p&&(0,ce.jsx)(ao,{className:G.startIcon,ownerState:y,children:p}),B=u&&(0,ce.jsx)(so,{className:G.endIcon,ownerState:y,children:u}),Z=o||"";return(0,ce.jsxs)(ro,(0,ue.A)({ownerState:y,className:he(i.className,G.root,l,Z),component:g,disabled:c,focusRipple:!C,focusVisibleClassName:he(G.focusVisible,d),ref:n,type:m},f,{classes:G,children:[v,a,B]}))})),lo=e=>{let t;return t=e<1?5.11916*e**2:4.5*Math.log(e+1)+2,(t/100).toFixed(2)};function co(e){return be("MuiPaper",e)}zt("MuiPaper",["root","rounded","outlined","elevation","elevation0","elevation1","elevation2","elevation3","elevation4","elevation5","elevation6","elevation7","elevation8","elevation9","elevation10","elevation11","elevation12","elevation13","elevation14","elevation15","elevation16","elevation17","elevation18","elevation19","elevation20","elevation21","elevation22","elevation23","elevation24"]);const Io=["className","component","elevation","square","variant"],Co=Xt("div",{name:"MuiPaper",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.variant],!n.square&&t.rounded,"elevation"===n.variant&&t[`elevation${n.elevation}`]]}})((e=>{let{theme:t,ownerState:n}=e;var i;return(0,ue.A)({backgroundColor:(t.vars||t).palette.background.paper,color:(t.vars||t).palette.text.primary,transition:t.transitions.create("box-shadow")},!n.square&&{borderRadius:t.shape.borderRadius},"outlined"===n.variant&&{border:`1px solid ${(t.vars||t).palette.divider}`},"elevation"===n.variant&&(0,ue.A)({boxShadow:(t.vars||t).shadows[n.elevation]},!t.vars&&"dark"===t.palette.mode&&{backgroundImage:`linear-gradient(${(0,qe.X4)("#fff",lo(n.elevation))}, ${(0,qe.X4)("#fff",lo(n.elevation))})`},t.vars&&{backgroundImage:null==(i=t.vars.overlays)?void 0:i[n.elevation]}))})),uo=t.forwardRef((function(e,t){const n=Nt({props:e,name:"MuiPaper"}),{className:i,component:o="div",elevation:r=1,square:a=!1,variant:s="elevation"}=n,g=(0,Ce.A)(n,Io),l=(0,ue.A)({},n,{component:o,elevation:r,square:a,variant:s}),c=(e=>{const{square:t,elevation:n,variant:i,classes:o}=e;return fe({root:["root",i,!t&&"rounded","elevation"===i&&`elevation${n}`]},co,o)})(l);return(0,ce.jsx)(Co,(0,ue.A)({as:o,ownerState:l,className:he(c.root,i),ref:t},g))}));function ho(e){return be("MuiCard",e)}zt("MuiCard",["root"]);const Ao=["className","raised"],po=Xt(uo,{name:"MuiCard",slot:"Root",overridesResolver:(e,t)=>t.root})((()=>({overflow:"hidden"}))),mo=t.forwardRef((function(e,t){const n=Nt({props:e,name:"MuiCard"}),{className:i,raised:o=!1}=n,r=(0,Ce.A)(n,Ao),a=(0,ue.A)({},n,{raised:o}),s=(e=>{const{classes:t}=e;return fe({root:["root"]},ho,t)})(a);return(0,ce.jsx)(po,(0,ue.A)({className:he(s.root,i),elevation:o?8:void 0,ref:t,ownerState:a},r))}));function bo(e){return be("MuiCardContent",e)}zt("MuiCardContent",["root"]);const fo=["className","component"],yo=Xt("div",{name:"MuiCardContent",slot:"Root",overridesResolver:(e,t)=>t.root})((()=>({padding:16,"&:last-child":{paddingBottom:24}}))),Go=t.forwardRef((function(e,t){const n=Nt({props:e,name:"MuiCardContent"}),{className:i,component:o="div"}=n,r=(0,Ce.A)(n,fo),a=(0,ue.A)({},n,{component:o}),s=(e=>{const{classes:t}=e;return fe({root:["root"]},bo,t)})(a);return(0,ce.jsx)(yo,(0,ue.A)({as:o,className:he(s.root,i),ownerState:a,ref:t},r))}));function vo(e){return be("MuiCardHeader",e)}const Bo=zt("MuiCardHeader",["root","avatar","action","content","title","subheader"]),Zo=["action","avatar","className","component","disableTypography","subheader","subheaderTypographyProps","title","titleTypographyProps"],wo=Xt("div",{name:"MuiCardHeader",slot:"Root",overridesResolver:(e,t)=>(0,ue.A)({[`& .${Bo.title}`]:t.title,[`& .${Bo.subheader}`]:t.subheader},t.root)})({display:"flex",alignItems:"center",padding:16}),Wo=Xt("div",{name:"MuiCardHeader",slot:"Avatar",overridesResolver:(e,t)=>t.avatar})({display:"flex",flex:"0 0 auto",marginRight:16}),So=Xt("div",{name:"MuiCardHeader",slot:"Action",overridesResolver:(e,t)=>t.action})({flex:"0 0 auto",alignSelf:"flex-start",marginTop:-4,marginRight:-8,marginBottom:-4}),Ro=Xt("div",{name:"MuiCardHeader",slot:"Content",overridesResolver:(e,t)=>t.content})({flex:"1 1 auto"}),xo=t.forwardRef((function(e,t){const n=Nt({props:e,name:"MuiCardHeader"}),{action:i,avatar:o,className:r,component:a="div",disableTypography:s=!1,subheader:g,subheaderTypographyProps:l,title:c,titleTypographyProps:I}=n,C=(0,Ce.A)(n,Zo),u=(0,ue.A)({},n,{component:a,disableTypography:s}),d=(e=>{const{classes:t}=e;return fe({root:["root"],avatar:["avatar"],action:["action"],content:["content"],title:["title"],subheader:["subheader"]},vo,t)})(u);let h=c;null==h||h.type===Dt||s||(h=(0,ce.jsx)(Dt,(0,ue.A)({variant:o?"body2":"h5",className:d.title,component:"span",display:"block"},I,{children:h})));let A=g;return null==A||A.type===Dt||s||(A=(0,ce.jsx)(Dt,(0,ue.A)({variant:o?"body2":"body1",className:d.subheader,color:"text.secondary",component:"span",display:"block"},l,{children:A}))),(0,ce.jsxs)(wo,(0,ue.A)({className:he(d.root,r),as:a,ref:t,ownerState:u},C,{children:[o&&(0,ce.jsx)(Wo,{className:d.avatar,ownerState:u,children:o}),(0,ce.jsxs)(Ro,{className:d.content,ownerState:u,children:[h,A]}),i&&(0,ce.jsx)(So,{className:d.action,ownerState:u,children:i})]}))}));function Vo(e){return be("MuiCardMedia",e)}zt("MuiCardMedia",["root","media","img"]);const Xo=["children","className","component","image","src","style"],Ho=Xt("div",{name:"MuiCardMedia",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e,{isMediaComponent:i,isImageComponent:o}=n;return[t.root,i&&t.media,o&&t.img]}})((e=>{let{ownerState:t}=e;return(0,ue.A)({display:"block",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center"},t.isMediaComponent&&{width:"100%"},t.isImageComponent&&{objectFit:"cover"})})),Yo=["video","audio","picture","iframe","img"],Ko=["picture","img"],No=t.forwardRef((function(e,t){const n=Nt({props:e,name:"MuiCardMedia"}),{children:i,className:o,component:r="div",image:a,src:s,style:g}=n,l=(0,Ce.A)(n,Xo),c=-1!==Yo.indexOf(r),I=!c&&a?(0,ue.A)({backgroundImage:`url("${a}")`},g):g,C=(0,ue.A)({},n,{component:r,isMediaComponent:c,isImageComponent:-1!==Ko.indexOf(r)}),u=(e=>{const{classes:t,isMediaComponent:n,isImageComponent:i}=e;return fe({root:["root",n&&"media",i&&"img"]},Vo,t)})(C);return(0,ce.jsx)(Ho,(0,ue.A)({className:he(u.root,o),as:r,role:!c&&a?"img":void 0,ref:t,style:I,ownerState:C,src:c?a||s:void 0},l,{children:i}))})),Mo=No;let Fo=0;const ko=i["useId".toString()];function zo(e){if(void 0!==ko){const t=ko();return null!=e?e:t}return function(e){const[n,i]=t.useState(e),o=e||n;return t.useEffect((()=>{null==n&&(Fo+=1,i(`mui-${Fo}`))}),[n]),o}(e)}const Lo=["elementType","externalSlotProps","ownerState","skipResolvingSlotProps"];const To=function(e){var t;const{elementType:n,externalSlotProps:i,ownerState:o,skipResolvingSlotProps:r=!1}=e,a=(0,Ce.A)(e,Lo),s=r?{}:rn(i,o),{props:g,internalRef:l}=gn((0,ue.A)({},a,{externalSlotProps:s})),c=tn(l,null==s?void 0:s.ref,null==(t=e.additionalProps)?void 0:t.ref);return on(n,(0,ue.A)({},g,{ref:c}),o)};function Eo(e){return e&&e.ownerDocument||document}const Jo=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function Uo(e){const t=[],n=[];return Array.from(e.querySelectorAll(Jo)).forEach(((e,i)=>{const o=function(e){const t=parseInt(e.getAttribute("tabindex")||"",10);return Number.isNaN(t)?"true"===e.contentEditable||("AUDIO"===e.nodeName||"VIDEO"===e.nodeName||"DETAILS"===e.nodeName)&&null===e.getAttribute("tabindex")?0:e.tabIndex:t}(e);-1!==o&&function(e){return!(e.disabled||"INPUT"===e.tagName&&"hidden"===e.type||function(e){if("INPUT"!==e.tagName||"radio"!==e.type)return!1;if(!e.name)return!1;const t=t=>e.ownerDocument.querySelector(`input[type="radio"]${t}`);let n=t(`[name="${e.name}"]:checked`);return n||(n=t(`[name="${e.name}"]`)),n!==e}(e))}(e)&&(0===o?t.push(e):n.push({documentOrder:i,tabIndex:o,node:e}))})),n.sort(((e,t)=>e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex)).map((e=>e.node)).concat(t)}function Do(){return!0}const Po=function(e){const{children:n,disableAutoFocus:i=!1,disableEnforceFocus:o=!1,disableRestoreFocus:r=!1,getTabbable:a=Uo,isEnabled:s=Do,open:g}=e,l=t.useRef(!1),c=t.useRef(null),I=t.useRef(null),C=t.useRef(null),u=t.useRef(null),d=t.useRef(!1),h=t.useRef(null),A=tn(n.ref,h),p=t.useRef(null);t.useEffect((()=>{g&&h.current&&(d.current=!i)}),[i,g]),t.useEffect((()=>{if(!g||!h.current)return;const e=Eo(h.current);return h.current.contains(e.activeElement)||(h.current.hasAttribute("tabIndex")||h.current.setAttribute("tabIndex","-1"),d.current&&h.current.focus()),()=>{r||(C.current&&C.current.focus&&(l.current=!0,C.current.focus()),C.current=null)}}),[g]),t.useEffect((()=>{if(!g||!h.current)return;const e=Eo(h.current),t=t=>{p.current=t,!o&&s()&&"Tab"===t.key&&e.activeElement===h.current&&t.shiftKey&&(l.current=!0,I.current&&I.current.focus())},n=()=>{const t=h.current;if(null===t)return;if(!e.hasFocus()||!s()||l.current)return void(l.current=!1);if(t.contains(e.activeElement))return;if(o&&e.activeElement!==c.current&&e.activeElement!==I.current)return;if(e.activeElement!==u.current)u.current=null;else if(null!==u.current)return;if(!d.current)return;let n=[];if(e.activeElement!==c.current&&e.activeElement!==I.current||(n=a(h.current)),n.length>0){var i,r;const e=Boolean((null==(i=p.current)?void 0:i.shiftKey)&&"Tab"===(null==(r=p.current)?void 0:r.key)),t=n[0],o=n[n.length-1];"string"!==typeof t&&"string"!==typeof o&&(e?o.focus():t.focus())}else t.focus()};e.addEventListener("focusin",n),e.addEventListener("keydown",t,!0);const i=setInterval((()=>{e.activeElement&&"BODY"===e.activeElement.tagName&&n()}),50);return()=>{clearInterval(i),e.removeEventListener("focusin",n),e.removeEventListener("keydown",t,!0)}}),[i,o,r,s,g,a]);const m=e=>{null===C.current&&(C.current=e.relatedTarget),d.current=!0};return(0,ce.jsxs)(t.Fragment,{children:[(0,ce.jsx)("div",{tabIndex:g?0:-1,onFocus:m,ref:c,"data-testid":"sentinelStart"}),t.cloneElement(n,{ref:A,onFocus:e=>{null===C.current&&(C.current=e.relatedTarget),d.current=!0,u.current=e.target;const t=n.props.onFocus;t&&t(e)}}),(0,ce.jsx)("div",{tabIndex:g?0:-1,onFocus:m,ref:I,"data-testid":"sentinelEnd"})]})};const Qo=t.forwardRef((function(e,n){const{children:i,container:r,disablePortal:a=!1}=e,[s,g]=t.useState(null),l=tn(t.isValidElement(i)?i.ref:null,n);if(hi((()=>{a||g(function(e){return"function"===typeof e?e():e}(r)||document.body)}),[r,a]),hi((()=>{if(s&&!a)return en(n,s),()=>{en(n,null)}}),[n,s,a]),a){if(t.isValidElement(i)){const e={ref:l};return t.cloneElement(i,e)}return(0,ce.jsx)(t.Fragment,{children:i})}return(0,ce.jsx)(t.Fragment,{children:s?o.createPortal(i,s):s})})),_o=!1;var jo="unmounted",Oo="exited",qo="entering",$o="entered",er="exiting",tr=function(e){function n(t,n){var i;i=e.call(this,t,n)||this;var o,r=n&&!n.isMounting?t.enter:t.appear;return i.appearStatus=null,t.in?r?(o=Oo,i.appearStatus=qo):o=$o:o=t.unmountOnExit||t.mountOnEnter?jo:Oo,i.state={status:o},i.nextCallback=null,i}fi(n,e),n.getDerivedStateFromProps=function(e,t){return e.in&&t.status===jo?{status:Oo}:null};var i=n.prototype;return i.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},i.componentDidUpdate=function(e){var t=null;if(e!==this.props){var n=this.state.status;this.props.in?n!==qo&&n!==$o&&(t=qo):n!==qo&&n!==$o||(t=er)}this.updateStatus(!1,t)},i.componentWillUnmount=function(){this.cancelNextCallback()},i.getTimeouts=function(){var e,t,n,i=this.props.timeout;return e=t=n=i,null!=i&&"number"!==typeof i&&(e=i.exit,t=i.enter,n=void 0!==i.appear?i.appear:t),{exit:e,enter:t,appear:n}},i.updateStatus=function(e,t){if(void 0===e&&(e=!1),null!==t)if(this.cancelNextCallback(),t===qo){if(this.props.unmountOnExit||this.props.mountOnEnter){var n=this.props.nodeRef?this.props.nodeRef.current:o.findDOMNode(this);n&&function(e){e.scrollTop}(n)}this.performEnter(e)}else this.performExit();else this.props.unmountOnExit&&this.state.status===Oo&&this.setState({status:jo})},i.performEnter=function(e){var t=this,n=this.props.enter,i=this.context?this.context.isMounting:e,r=this.props.nodeRef?[i]:[o.findDOMNode(this),i],a=r[0],s=r[1],g=this.getTimeouts(),l=i?g.appear:g.enter;!e&&!n||_o?this.safeSetState({status:$o},(function(){t.props.onEntered(a)})):(this.props.onEnter(a,s),this.safeSetState({status:qo},(function(){t.props.onEntering(a,s),t.onTransitionEnd(l,(function(){t.safeSetState({status:$o},(function(){t.props.onEntered(a,s)}))}))})))},i.performExit=function(){var e=this,t=this.props.exit,n=this.getTimeouts(),i=this.props.nodeRef?void 0:o.findDOMNode(this);t&&!_o?(this.props.onExit(i),this.safeSetState({status:er},(function(){e.props.onExiting(i),e.onTransitionEnd(n.exit,(function(){e.safeSetState({status:Oo},(function(){e.props.onExited(i)}))}))}))):this.safeSetState({status:Oo},(function(){e.props.onExited(i)}))},i.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},i.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},i.setNextCallback=function(e){var t=this,n=!0;return this.nextCallback=function(i){n&&(n=!1,t.nextCallback=null,e(i))},this.nextCallback.cancel=function(){n=!1},this.nextCallback},i.onTransitionEnd=function(e,t){this.setNextCallback(t);var n=this.props.nodeRef?this.props.nodeRef.current:o.findDOMNode(this),i=null==e&&!this.props.addEndListener;if(n&&!i){if(this.props.addEndListener){var r=this.props.nodeRef?[this.nextCallback]:[n,this.nextCallback],a=r[0],s=r[1];this.props.addEndListener(a,s)}null!=e&&setTimeout(this.nextCallback,e)}else setTimeout(this.nextCallback,0)},i.render=function(){var e=this.state.status;if(e===jo)return null;var n=this.props,i=n.children,o=(n.in,n.mountOnEnter,n.unmountOnExit,n.appear,n.enter,n.exit,n.timeout,n.addEndListener,n.onEnter,n.onEntering,n.onEntered,n.onExit,n.onExiting,n.onExited,n.nodeRef,(0,Ce.A)(n,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]));return t.createElement(yi.Provider,{value:null},"function"===typeof i?i(e,o):t.cloneElement(t.Children.only(i),o))},n}(t.Component);function nr(){}tr.contextType=yi,tr.propTypes={},tr.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:nr,onEntering:nr,onEntered:nr,onExit:nr,onExiting:nr,onExited:nr},tr.UNMOUNTED=jo,tr.EXITED=Oo,tr.ENTERING=qo,tr.ENTERED=$o,tr.EXITING=er;const ir=tr;function or(e,t){var n,i;const{timeout:o,easing:r,style:a={}}=e;return{duration:null!=(n=a.transitionDuration)?n:"number"===typeof o?o:o[t.mode]||0,easing:null!=(i=a.transitionTimingFunction)?i:"object"===typeof r?r[t.mode]:r,delay:a.transitionDelay}}const rr=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"],ar={entering:{opacity:1},entered:{opacity:1}},sr=t.forwardRef((function(e,n){const i=bn(),o={enter:i.transitions.duration.enteringScreen,exit:i.transitions.duration.leavingScreen},{addEndListener:r,appear:a=!0,children:s,easing:g,in:l,onEnter:c,onEntered:I,onEntering:C,onExit:u,onExited:d,onExiting:h,style:A,timeout:p=o,TransitionComponent:m=ir}=e,b=(0,Ce.A)(e,rr),f=t.useRef(null),y=Jn(f,s.ref,n),G=e=>t=>{if(e){const n=f.current;void 0===t?e(n):e(n,t)}},v=G(C),B=G(((e,t)=>{(e=>{e.scrollTop})(e);const n=or({style:A,timeout:p,easing:g},{mode:"enter"});e.style.webkitTransition=i.transitions.create("opacity",n),e.style.transition=i.transitions.create("opacity",n),c&&c(e,t)})),Z=G(I),w=G(h),W=G((e=>{const t=or({style:A,timeout:p,easing:g},{mode:"exit"});e.style.webkitTransition=i.transitions.create("opacity",t),e.style.transition=i.transitions.create("opacity",t),u&&u(e)})),S=G(d);return(0,ce.jsx)(m,(0,ue.A)({appear:a,in:l,nodeRef:f,onEnter:B,onEntered:Z,onEntering:v,onExit:W,onExited:S,onExiting:w,addEndListener:e=>{r&&r(f.current,e)},timeout:p},b,{children:(e,n)=>t.cloneElement(s,(0,ue.A)({style:(0,ue.A)({opacity:0,visibility:"exited"!==e||l?void 0:"hidden"},ar[e],A,s.props.style),ref:y},n))}))})),gr=sr;function lr(e){return be("MuiBackdrop",e)}zt("MuiBackdrop",["root","invisible"]);const cr=["children","className","component","components","componentsProps","invisible","open","slotProps","slots","TransitionComponent","transitionDuration"],Ir=Xt("div",{name:"MuiBackdrop",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.invisible&&t.invisible]}})((e=>{let{ownerState:t}=e;return(0,ue.A)({position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent"},t.invisible&&{backgroundColor:"transparent"})})),Cr=t.forwardRef((function(e,t){var n,i,o;const r=Nt({props:e,name:"MuiBackdrop"}),{children:a,className:s,component:g="div",components:l={},componentsProps:c={},invisible:I=!1,open:C,slotProps:u={},slots:d={},TransitionComponent:h=gr,transitionDuration:A}=r,p=(0,Ce.A)(r,cr),m=(0,ue.A)({},r,{component:g,invisible:I}),b=(e=>{const{classes:t,invisible:n}=e;return fe({root:["root",n&&"invisible"]},lr,t)})(m),f=null!=(n=u.root)?n:c.root;return(0,ce.jsx)(h,(0,ue.A)({in:C,timeout:A},p,{children:(0,ce.jsx)(Ir,(0,ue.A)({"aria-hidden":!0},f,{as:null!=(i=null!=(o=d.root)?o:l.Root)?i:g,className:he(b.root,s,null==f?void 0:f.className),ownerState:(0,ue.A)({},m,null==f?void 0:f.ownerState),classes:b,ref:t,children:a}))}))}));function ur(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(((e,t)=>null==t?e:function(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];e.apply(this,i),t.apply(this,i)}),(()=>{}))}function dr(e){return Eo(e).defaultView||window}function hr(e,t){t?e.setAttribute("aria-hidden","true"):e.removeAttribute("aria-hidden")}function Ar(e){return parseInt(dr(e).getComputedStyle(e).paddingRight,10)||0}function pr(e,t,n,i,o){const r=[t,n,...i];[].forEach.call(e.children,(e=>{const t=-1===r.indexOf(e),n=!function(e){const t=-1!==["TEMPLATE","SCRIPT","STYLE","LINK","MAP","META","NOSCRIPT","PICTURE","COL","COLGROUP","PARAM","SLOT","SOURCE","TRACK"].indexOf(e.tagName),n="INPUT"===e.tagName&&"hidden"===e.getAttribute("type");return t||n}(e);t&&n&&hr(e,o)}))}function mr(e,t){let n=-1;return e.some(((e,i)=>!!t(e)&&(n=i,!0))),n}function br(e,t){const n=[],i=e.container;if(!t.disableScrollLock){if(function(e){const t=Eo(e);return t.body===e?dr(e).innerWidth>t.documentElement.clientWidth:e.scrollHeight>e.clientHeight}(i)){const e=function(e){const t=e.documentElement.clientWidth;return Math.abs(window.innerWidth-t)}(Eo(i));n.push({value:i.style.paddingRight,property:"padding-right",el:i}),i.style.paddingRight=`${Ar(i)+e}px`;const t=Eo(i).querySelectorAll(".mui-fixed");[].forEach.call(t,(t=>{n.push({value:t.style.paddingRight,property:"padding-right",el:t}),t.style.paddingRight=`${Ar(t)+e}px`}))}let e;if(i.parentNode instanceof DocumentFragment)e=Eo(i).body;else{const t=i.parentElement,n=dr(i);e="HTML"===(null==t?void 0:t.nodeName)&&"scroll"===n.getComputedStyle(t).overflowY?t:i}n.push({value:e.style.overflow,property:"overflow",el:e},{value:e.style.overflowX,property:"overflow-x",el:e},{value:e.style.overflowY,property:"overflow-y",el:e}),e.style.overflow="hidden"}return()=>{n.forEach((e=>{let{value:t,el:n,property:i}=e;t?n.style.setProperty(i,t):n.style.removeProperty(i)}))}}const fr=new class{constructor(){this.containers=void 0,this.modals=void 0,this.modals=[],this.containers=[]}add(e,t){let n=this.modals.indexOf(e);if(-1!==n)return n;n=this.modals.length,this.modals.push(e),e.modalRef&&hr(e.modalRef,!1);const i=function(e){const t=[];return[].forEach.call(e.children,(e=>{"true"===e.getAttribute("aria-hidden")&&t.push(e)})),t}(t);pr(t,e.mount,e.modalRef,i,!0);const o=mr(this.containers,(e=>e.container===t));return-1!==o?(this.containers[o].modals.push(e),n):(this.containers.push({modals:[e],container:t,restore:null,hiddenSiblings:i}),n)}mount(e,t){const n=mr(this.containers,(t=>-1!==t.modals.indexOf(e))),i=this.containers[n];i.restore||(i.restore=br(i,t))}remove(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n=this.modals.indexOf(e);if(-1===n)return n;const i=mr(this.containers,(t=>-1!==t.modals.indexOf(e))),o=this.containers[i];if(o.modals.splice(o.modals.indexOf(e),1),this.modals.splice(n,1),0===o.modals.length)o.restore&&o.restore(),e.modalRef&&hr(e.modalRef,t),pr(o.container,e.mount,e.modalRef,o.hiddenSiblings,!1),this.containers.splice(i,1);else{const e=o.modals[o.modals.length-1];e.modalRef&&hr(e.modalRef,!1)}return n}isTopModal(e){return this.modals.length>0&&this.modals[this.modals.length-1]===e}};const yr=function(e){const{container:n,disableEscapeKeyDown:i=!1,disableScrollLock:o=!1,manager:r=fr,closeAfterTransition:a=!1,onTransitionEnter:s,onTransitionExited:g,children:l,onClose:c,open:I,rootRef:C}=e,u=t.useRef({}),d=t.useRef(null),h=t.useRef(null),A=tn(h,C),[p,m]=t.useState(!I),b=function(e){return!!e&&e.props.hasOwnProperty("in")}(l);let f=!0;"false"!==e["aria-hidden"]&&!1!==e["aria-hidden"]||(f=!1);const y=()=>(u.current.modalRef=h.current,u.current.mount=d.current,u.current),G=()=>{r.mount(y(),{disableScrollLock:o}),h.current&&(h.current.scrollTop=0)},v=Ai((()=>{const e=function(e){return"function"===typeof e?e():e}(n)||Eo(d.current).body;r.add(y(),e),h.current&&G()})),B=t.useCallback((()=>r.isTopModal(y())),[r]),Z=Ai((e=>{d.current=e,e&&(I&&B()?G():h.current&&hr(h.current,f))})),w=t.useCallback((()=>{r.remove(y(),f)}),[f,r]);t.useEffect((()=>()=>{w()}),[w]),t.useEffect((()=>{I?v():b&&a||w()}),[I,w,b,a,v]);const W=e=>t=>{var n;null==(n=e.onKeyDown)||n.call(e,t),"Escape"===t.key&&229!==t.which&&B()&&(i||(t.stopPropagation(),c&&c(t,"escapeKeyDown")))},S=e=>t=>{var n;null==(n=e.onClick)||n.call(e,t),t.target===t.currentTarget&&c&&c(t,"backdropClick")};return{getRootProps:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=an(e);delete n.onTransitionEnter,delete n.onTransitionExited;const i=(0,ue.A)({},n,t);return(0,ue.A)({role:"presentation"},i,{onKeyDown:W(i),ref:A})},getBackdropProps:function(){const e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,ue.A)({"aria-hidden":!0},e,{onClick:S(e),open:I})},getTransitionProps:()=>({onEnter:ur((()=>{m(!1),s&&s()}),null==l?void 0:l.props.onEnter),onExited:ur((()=>{m(!0),g&&g(),a&&w()}),null==l?void 0:l.props.onExited)}),rootRef:A,portalRef:Z,isTopModal:B,exited:p,hasTransition:b}};function Gr(e){return be("MuiModal",e)}zt("MuiModal",["root","hidden","backdrop"]);const vr=["BackdropComponent","BackdropProps","classes","className","closeAfterTransition","children","container","component","components","componentsProps","disableAutoFocus","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","onBackdropClick","onClose","onTransitionEnter","onTransitionExited","open","slotProps","slots","theme"],Br=Xt("div",{name:"MuiModal",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,!n.open&&n.exited&&t.hidden]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ue.A)({position:"fixed",zIndex:(t.vars||t).zIndex.modal,right:0,bottom:0,top:0,left:0},!n.open&&n.exited&&{visibility:"hidden"})})),Zr=Xt(Cr,{name:"MuiModal",slot:"Backdrop",overridesResolver:(e,t)=>t.backdrop})({zIndex:-1}),wr=t.forwardRef((function(e,n){var i,o,r,a,s,g;const l=Nt({name:"MuiModal",props:e}),{BackdropComponent:c=Zr,BackdropProps:I,className:C,closeAfterTransition:u=!1,children:d,container:h,component:A,components:p={},componentsProps:m={},disableAutoFocus:b=!1,disableEnforceFocus:f=!1,disableEscapeKeyDown:y=!1,disablePortal:G=!1,disableRestoreFocus:v=!1,disableScrollLock:B=!1,hideBackdrop:Z=!1,keepMounted:w=!1,onBackdropClick:W,open:S,slotProps:R,slots:x}=l,V=(0,Ce.A)(l,vr),X=(0,ue.A)({},l,{closeAfterTransition:u,disableAutoFocus:b,disableEnforceFocus:f,disableEscapeKeyDown:y,disablePortal:G,disableRestoreFocus:v,disableScrollLock:B,hideBackdrop:Z,keepMounted:w}),{getRootProps:H,getBackdropProps:Y,getTransitionProps:K,portalRef:N,isTopModal:M,exited:F,hasTransition:k}=yr((0,ue.A)({},X,{rootRef:n})),z=(0,ue.A)({},X,{exited:F}),L=(e=>{const{open:t,exited:n,classes:i}=e;return fe({root:["root",!t&&n&&"hidden"],backdrop:["backdrop"]},Gr,i)})(z),T={};if(void 0===d.props.tabIndex&&(T.tabIndex="-1"),k){const{onEnter:e,onExited:t}=K();T.onEnter=e,T.onExited=t}const E=null!=(i=null!=(o=null==x?void 0:x.root)?o:p.Root)?i:Br,J=null!=(r=null!=(a=null==x?void 0:x.backdrop)?a:p.Backdrop)?r:c,U=null!=(s=null==R?void 0:R.root)?s:m.root,D=null!=(g=null==R?void 0:R.backdrop)?g:m.backdrop,P=To({elementType:E,externalSlotProps:U,externalForwardedProps:V,getSlotProps:H,additionalProps:{ref:n,as:A},ownerState:z,className:he(C,null==U?void 0:U.className,null==L?void 0:L.root,!z.open&&z.exited&&(null==L?void 0:L.hidden))}),Q=To({elementType:J,externalSlotProps:D,additionalProps:I,getSlotProps:e=>Y((0,ue.A)({},e,{onClick:t=>{W&&W(t),null!=e&&e.onClick&&e.onClick(t)}})),className:he(null==D?void 0:D.className,null==I?void 0:I.className,null==L?void 0:L.backdrop),ownerState:z});return w||S||k&&!F?(0,ce.jsx)(Qo,{ref:N,container:h,disablePortal:G,children:(0,ce.jsxs)(E,(0,ue.A)({},P,{children:[!Z&&c?(0,ce.jsx)(J,(0,ue.A)({},Q)):null,(0,ce.jsx)(Po,{disableEnforceFocus:f,disableAutoFocus:b,disableRestoreFocus:v,isEnabled:M,open:S,children:t.cloneElement(d,T)})]}))}):null})),Wr=wr;function Sr(e){return be("MuiDialog",e)}const Rr=zt("MuiDialog",["root","scrollPaper","scrollBody","container","paper","paperScrollPaper","paperScrollBody","paperWidthFalse","paperWidthXs","paperWidthSm","paperWidthMd","paperWidthLg","paperWidthXl","paperFullWidth","paperFullScreen"]);const xr=t.createContext({}),Vr=["aria-describedby","aria-labelledby","BackdropComponent","BackdropProps","children","className","disableEscapeKeyDown","fullScreen","fullWidth","maxWidth","onBackdropClick","onClick","onClose","open","PaperComponent","PaperProps","scroll","TransitionComponent","transitionDuration","TransitionProps"],Xr=Xt(Cr,{name:"MuiDialog",slot:"Backdrop",overrides:(e,t)=>t.backdrop})({zIndex:-1}),Hr=Xt(Wr,{name:"MuiDialog",slot:"Root",overridesResolver:(e,t)=>t.root})({"@media print":{position:"absolute !important"}}),Yr=Xt("div",{name:"MuiDialog",slot:"Container",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.container,t[`scroll${Pe(n.scroll)}`]]}})((e=>{let{ownerState:t}=e;return(0,ue.A)({height:"100%","@media print":{height:"auto"},outline:0},"paper"===t.scroll&&{display:"flex",justifyContent:"center",alignItems:"center"},"body"===t.scroll&&{overflowY:"auto",overflowX:"hidden",textAlign:"center","&::after":{content:'""',display:"inline-block",verticalAlign:"middle",height:"100%",width:"0"}})})),Kr=Xt(uo,{name:"MuiDialog",slot:"Paper",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.paper,t[`scrollPaper${Pe(n.scroll)}`],t[`paperWidth${Pe(String(n.maxWidth))}`],n.fullWidth&&t.paperFullWidth,n.fullScreen&&t.paperFullScreen]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ue.A)({margin:32,position:"relative",overflowY:"auto","@media print":{overflowY:"visible",boxShadow:"none"}},"paper"===n.scroll&&{display:"flex",flexDirection:"column",maxHeight:"calc(100% - 64px)"},"body"===n.scroll&&{display:"inline-block",verticalAlign:"middle",textAlign:"left"},!n.maxWidth&&{maxWidth:"calc(100% - 64px)"},"xs"===n.maxWidth&&{maxWidth:"px"===t.breakpoints.unit?Math.max(t.breakpoints.values.xs,444):`max(${t.breakpoints.values.xs}${t.breakpoints.unit}, 444px)`,[`&.${Rr.paperScrollBody}`]:{[t.breakpoints.down(Math.max(t.breakpoints.values.xs,444)+64)]:{maxWidth:"calc(100% - 64px)"}}},n.maxWidth&&"xs"!==n.maxWidth&&{maxWidth:`${t.breakpoints.values[n.maxWidth]}${t.breakpoints.unit}`,[`&.${Rr.paperScrollBody}`]:{[t.breakpoints.down(t.breakpoints.values[n.maxWidth]+64)]:{maxWidth:"calc(100% - 64px)"}}},n.fullWidth&&{width:"calc(100% - 64px)"},n.fullScreen&&{margin:0,width:"100%",maxWidth:"100%",height:"100%",maxHeight:"none",borderRadius:0,[`&.${Rr.paperScrollBody}`]:{margin:0,maxWidth:"100%"}})})),Nr=t.forwardRef((function(e,n){const i=Nt({props:e,name:"MuiDialog"}),o=bn(),r={enter:o.transitions.duration.enteringScreen,exit:o.transitions.duration.leavingScreen},{"aria-describedby":a,"aria-labelledby":s,BackdropComponent:g,BackdropProps:l,children:c,className:I,disableEscapeKeyDown:C=!1,fullScreen:u=!1,fullWidth:d=!1,maxWidth:h="sm",onBackdropClick:A,onClick:p,onClose:m,open:b,PaperComponent:f=uo,PaperProps:y={},scroll:G="paper",TransitionComponent:v=gr,transitionDuration:B=r,TransitionProps:Z}=i,w=(0,Ce.A)(i,Vr),W=(0,ue.A)({},i,{disableEscapeKeyDown:C,fullScreen:u,fullWidth:d,maxWidth:h,scroll:G}),S=(e=>{const{classes:t,scroll:n,maxWidth:i,fullWidth:o,fullScreen:r}=e;return fe({root:["root"],container:["container",`scroll${Pe(n)}`],paper:["paper",`paperScroll${Pe(n)}`,`paperWidth${Pe(String(i))}`,o&&"paperFullWidth",r&&"paperFullScreen"]},Sr,t)})(W),R=t.useRef(),x=zo(s),V=t.useMemo((()=>({titleId:x})),[x]);return(0,ce.jsx)(Hr,(0,ue.A)({className:he(S.root,I),closeAfterTransition:!0,components:{Backdrop:Xr},componentsProps:{backdrop:(0,ue.A)({transitionDuration:B,as:g},l)},disableEscapeKeyDown:C,onClose:m,open:b,ref:n,onClick:e=>{p&&p(e),R.current&&(R.current=null,A&&A(e),m&&m(e,"backdropClick"))},ownerState:W},w,{children:(0,ce.jsx)(v,(0,ue.A)({appear:!0,in:b,timeout:B,role:"presentation"},Z,{children:(0,ce.jsx)(Yr,{className:he(S.container),onMouseDown:e=>{R.current=e.target===e.currentTarget},ownerState:W,children:(0,ce.jsx)(Kr,(0,ue.A)({as:f,elevation:24,role:"dialog","aria-describedby":a,"aria-labelledby":x},y,{className:he(S.paper,y.className),ownerState:W,children:(0,ce.jsx)(xr.Provider,{value:V,children:c})}))})}))}))}));function Mr(e){return be("MuiDialogActions",e)}zt("MuiDialogActions",["root","spacing"]);const Fr=["className","disableSpacing"],kr=Xt("div",{name:"MuiDialogActions",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,!n.disableSpacing&&t.spacing]}})((e=>{let{ownerState:t}=e;return(0,ue.A)({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",flex:"0 0 auto"},!t.disableSpacing&&{"& > :not(style) ~ :not(style)":{marginLeft:8}})})),zr=t.forwardRef((function(e,t){const n=Nt({props:e,name:"MuiDialogActions"}),{className:i,disableSpacing:o=!1}=n,r=(0,Ce.A)(n,Fr),a=(0,ue.A)({},n,{disableSpacing:o}),s=(e=>{const{classes:t,disableSpacing:n}=e;return fe({root:["root",!n&&"spacing"]},Mr,t)})(a);return(0,ce.jsx)(kr,(0,ue.A)({className:he(s.root,i),ownerState:a,ref:t},r))}));function Lr(e){return be("MuiDialogContent",e)}zt("MuiDialogContent",["root","dividers"]);function Tr(e){return be("MuiDialogTitle",e)}const Er=zt("MuiDialogTitle",["root"]),Jr=["className","dividers"],Ur=Xt("div",{name:"MuiDialogContent",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.dividers&&t.dividers]}})((e=>{let{theme:t,ownerState:n}=e;return(0,ue.A)({flex:"1 1 auto",WebkitOverflowScrolling:"touch",overflowY:"auto",padding:"20px 24px"},n.dividers?{padding:"16px 24px",borderTop:`1px solid ${(t.vars||t).palette.divider}`,borderBottom:`1px solid ${(t.vars||t).palette.divider}`}:{[`.${Er.root} + &`]:{paddingTop:0}})})),Dr=t.forwardRef((function(e,t){const n=Nt({props:e,name:"MuiDialogContent"}),{className:i,dividers:o=!1}=n,r=(0,Ce.A)(n,Jr),a=(0,ue.A)({},n,{dividers:o}),s=(e=>{const{classes:t,dividers:n}=e;return fe({root:["root",n&&"dividers"]},Lr,t)})(a);return(0,ce.jsx)(Ur,(0,ue.A)({className:he(s.root,i),ownerState:a,ref:t},r))}));function Pr(e){return be("MuiDialogContentText",e)}zt("MuiDialogContentText",["root"]);const Qr=["children","className"],_r=Xt(Dt,{shouldForwardProp:e=>Vt(e)||"classes"===e,name:"MuiDialogContentText",slot:"Root",overridesResolver:(e,t)=>t.root})({}),jr=t.forwardRef((function(e,t){const n=Nt({props:e,name:"MuiDialogContentText"}),{className:i}=n,o=(0,Ce.A)(n,Qr),r=(e=>{const{classes:t}=e,n=fe({root:["root"]},Pr,t);return(0,ue.A)({},t,n)})(o);return(0,ce.jsx)(_r,(0,ue.A)({component:"p",variant:"body1",color:"text.secondary",ref:t,ownerState:o,className:he(r.root,i)},n,{classes:r}))})),Or=["className","id"],qr=Xt(Dt,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(e,t)=>t.root})({padding:"16px 24px",flex:"0 0 auto"}),$r=t.forwardRef((function(e,n){const i=Nt({props:e,name:"MuiDialogTitle"}),{className:o,id:r}=i,a=(0,Ce.A)(i,Or),s=i,g=(e=>{const{classes:t}=e;return fe({root:["root"]},Tr,t)})(s),{titleId:l=r}=t.useContext(xr);return(0,ce.jsx)(qr,(0,ue.A)({component:"h2",className:he(g.root,o),ownerState:s,ref:n,variant:"h6",id:null!=r?r:l},a))}));var ea="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};const ta="object"===("undefined"===typeof window?"undefined":ea(window))&&"object"===("undefined"===typeof document?"undefined":ea(document))&&9===document.nodeType;function na(e){return na="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},na(e)}function ia(e){var t=function(e,t){if("object"!=na(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=na(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==na(t)?t:t+""}function oa(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,ia(i.key),i)}}function ra(e,t,n){return t&&oa(e.prototype,t),n&&oa(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var aa={}.constructor;function sa(e){if(null==e||"object"!==typeof e)return e;if(Array.isArray(e))return e.map(sa);if(e.constructor!==aa)return e;var t={};for(var n in e)t[n]=sa(e[n]);return t}function ga(e,t,n){void 0===e&&(e="unnamed");var i=n.jss,o=sa(t),r=i.plugins.onCreateRule(e,o,n);return r||(e[0],null)}var la=function(e,t){for(var n="",i=0;i<e.length&&"!important"!==e[i];i++)n&&(n+=t),n+=e[i];return n},ca=function(e){if(!Array.isArray(e))return e;var t="";if(Array.isArray(e[0]))for(var n=0;n<e.length&&"!important"!==e[n];n++)t&&(t+=", "),t+=la(e[n]," ");else t=la(e,", ");return"!important"===e[e.length-1]&&(t+=" !important"),t};function Ia(e){return e&&!1===e.format?{linebreak:"",space:""}:{linebreak:"\n",space:" "}}function Ca(e,t){for(var n="",i=0;i<t;i++)n+="  ";return n+e}function ua(e,t,n){void 0===n&&(n={});var i="";if(!t)return i;var o=n.indent,r=void 0===o?0:o,a=t.fallbacks;!1===n.format&&(r=-1/0);var s=Ia(n),g=s.linebreak,l=s.space;if(e&&r++,a)if(Array.isArray(a))for(var c=0;c<a.length;c++){var I=a[c];for(var C in I){var u=I[C];null!=u&&(i&&(i+=g),i+=Ca(C+":"+l+ca(u)+";",r))}}else for(var d in a){var h=a[d];null!=h&&(i&&(i+=g),i+=Ca(d+":"+l+ca(h)+";",r))}for(var A in t){var p=t[A];null!=p&&"fallbacks"!==A&&(i&&(i+=g),i+=Ca(A+":"+l+ca(p)+";",r))}return(i||n.allowEmpty)&&e?(i&&(i=""+g+i+g),Ca(""+e+l+"{"+i,--r)+Ca("}",r)):i}var da=/([[\].#*$><+~=|^:(),"'`\s])/g,ha="undefined"!==typeof CSS&&CSS.escape,Aa=function(e){return ha?ha(e):e.replace(da,"\\$1")},pa=function(){function e(e,t,n){this.type="style",this.isProcessed=!1;var i=n.sheet,o=n.Renderer;this.key=e,this.options=n,this.style=t,i?this.renderer=i.renderer:o&&(this.renderer=new o)}return e.prototype.prop=function(e,t,n){if(void 0===t)return this.style[e];var i=!!n&&n.force;if(!i&&this.style[e]===t)return this;var o=t;n&&!1===n.process||(o=this.options.jss.plugins.onChangeValue(t,e,this));var r=null==o||!1===o,a=e in this.style;if(r&&!a&&!i)return this;var s=r&&a;if(s?delete this.style[e]:this.style[e]=o,this.renderable&&this.renderer)return s?this.renderer.removeProperty(this.renderable,e):this.renderer.setProperty(this.renderable,e,o),this;var g=this.options.sheet;return g&&g.attached,this},e}(),ma=function(e){function t(t,n,i){var o;o=e.call(this,t,n,i)||this;var r=i.selector,a=i.scoped,s=i.sheet,g=i.generateId;return r?o.selectorText=r:!1!==a&&(o.id=g(mi(mi(o)),s),o.selectorText="."+Aa(o.id)),o}fi(t,e);var n=t.prototype;return n.applyTo=function(e){var t=this.renderer;if(t){var n=this.toJSON();for(var i in n)t.setProperty(e,i,n[i])}return this},n.toJSON=function(){var e={};for(var t in this.style){var n=this.style[t];"object"!==typeof n?e[t]=n:Array.isArray(n)&&(e[t]=ca(n))}return e},n.toString=function(e){var t=this.options.sheet,n=!!t&&t.options.link?(0,ue.A)({},e,{allowEmpty:!0}):e;return ua(this.selectorText,this.style,n)},ra(t,[{key:"selector",set:function(e){if(e!==this.selectorText){this.selectorText=e;var t=this.renderer,n=this.renderable;if(n&&t)t.setSelector(n,e)||t.replaceRule(n,this)}},get:function(){return this.selectorText}}]),t}(pa),ba={onCreateRule:function(e,t,n){return"@"===e[0]||n.parent&&"keyframes"===n.parent.type?null:new ma(e,t,n)}},fa={indent:1,children:!0},ya=/@([\w-]+)/,Ga=function(){function e(e,t,n){this.type="conditional",this.isProcessed=!1,this.key=e;var i=e.match(ya);for(var o in this.at=i?i[1]:"unknown",this.query=n.name||"@"+this.at,this.options=n,this.rules=new Da((0,ue.A)({},n,{parent:this})),t)this.rules.add(o,t[o]);this.rules.process()}var t=e.prototype;return t.getRule=function(e){return this.rules.get(e)},t.indexOf=function(e){return this.rules.indexOf(e)},t.addRule=function(e,t,n){var i=this.rules.add(e,t,n);return i?(this.options.jss.plugins.onProcessRule(i),i):null},t.replaceRule=function(e,t,n){var i=this.rules.replace(e,t,n);return i&&this.options.jss.plugins.onProcessRule(i),i},t.toString=function(e){void 0===e&&(e=fa);var t=Ia(e).linebreak;if(null==e.indent&&(e.indent=fa.indent),null==e.children&&(e.children=fa.children),!1===e.children)return this.query+" {}";var n=this.rules.toString(e);return n?this.query+" {"+t+n+t+"}":""},e}(),va=/@container|@media|@supports\s+/,Ba={onCreateRule:function(e,t,n){return va.test(e)?new Ga(e,t,n):null}},Za={indent:1,children:!0},wa=/@keyframes\s+([\w-]+)/,Wa=function(){function e(e,t,n){this.type="keyframes",this.at="@keyframes",this.isProcessed=!1;var i=e.match(wa);i&&i[1]?this.name=i[1]:this.name="noname",this.key=this.type+"-"+this.name,this.options=n;var o=n.scoped,r=n.sheet,a=n.generateId;for(var s in this.id=!1===o?this.name:Aa(a(this,r)),this.rules=new Da((0,ue.A)({},n,{parent:this})),t)this.rules.add(s,t[s],(0,ue.A)({},n,{parent:this}));this.rules.process()}return e.prototype.toString=function(e){void 0===e&&(e=Za);var t=Ia(e).linebreak;if(null==e.indent&&(e.indent=Za.indent),null==e.children&&(e.children=Za.children),!1===e.children)return this.at+" "+this.id+" {}";var n=this.rules.toString(e);return n&&(n=""+t+n+t),this.at+" "+this.id+" {"+n+"}"},e}(),Sa=/@keyframes\s+/,Ra=/\$([\w-]+)/g,xa=function(e,t){return"string"===typeof e?e.replace(Ra,(function(e,n){return n in t?t[n]:e})):e},Va=function(e,t,n){var i=e[t],o=xa(i,n);o!==i&&(e[t]=o)},Xa={onCreateRule:function(e,t,n){return"string"===typeof e&&Sa.test(e)?new Wa(e,t,n):null},onProcessStyle:function(e,t,n){return"style"===t.type&&n?("animation-name"in e&&Va(e,"animation-name",n.keyframes),"animation"in e&&Va(e,"animation",n.keyframes),e):e},onChangeValue:function(e,t,n){var i=n.options.sheet;if(!i)return e;switch(t){case"animation":case"animation-name":return xa(e,i.keyframes);default:return e}}},Ha=function(e){function t(){return e.apply(this,arguments)||this}return fi(t,e),t.prototype.toString=function(e){var t=this.options.sheet,n=!!t&&t.options.link?(0,ue.A)({},e,{allowEmpty:!0}):e;return ua(this.key,this.style,n)},t}(pa),Ya={onCreateRule:function(e,t,n){return n.parent&&"keyframes"===n.parent.type?new Ha(e,t,n):null}},Ka=function(){function e(e,t,n){this.type="font-face",this.at="@font-face",this.isProcessed=!1,this.key=e,this.style=t,this.options=n}return e.prototype.toString=function(e){var t=Ia(e).linebreak;if(Array.isArray(this.style)){for(var n="",i=0;i<this.style.length;i++)n+=ua(this.at,this.style[i]),this.style[i+1]&&(n+=t);return n}return ua(this.at,this.style,e)},e}(),Na=/@font-face/,Ma={onCreateRule:function(e,t,n){return Na.test(e)?new Ka(e,t,n):null}},Fa=function(){function e(e,t,n){this.type="viewport",this.at="@viewport",this.isProcessed=!1,this.key=e,this.style=t,this.options=n}return e.prototype.toString=function(e){return ua(this.key,this.style,e)},e}(),ka={onCreateRule:function(e,t,n){return"@viewport"===e||"@-ms-viewport"===e?new Fa(e,t,n):null}},za=function(){function e(e,t,n){this.type="simple",this.isProcessed=!1,this.key=e,this.value=t,this.options=n}return e.prototype.toString=function(e){if(Array.isArray(this.value)){for(var t="",n=0;n<this.value.length;n++)t+=this.key+" "+this.value[n]+";",this.value[n+1]&&(t+="\n");return t}return this.key+" "+this.value+";"},e}(),La={"@charset":!0,"@import":!0,"@namespace":!0},Ta={onCreateRule:function(e,t,n){return e in La?new za(e,t,n):null}},Ea=[ba,Ba,Xa,Ya,Ma,ka,Ta],Ja={process:!0},Ua={force:!0,process:!0},Da=function(){function e(e){this.map={},this.raw={},this.index=[],this.counter=0,this.options=e,this.classes=e.classes,this.keyframes=e.keyframes}var t=e.prototype;return t.add=function(e,t,n){var i=this.options,o=i.parent,r=i.sheet,a=i.jss,s=i.Renderer,g=i.generateId,l=i.scoped,c=(0,ue.A)({classes:this.classes,parent:o,sheet:r,jss:a,Renderer:s,generateId:g,scoped:l,name:e,keyframes:this.keyframes,selector:void 0},n),I=e;e in this.raw&&(I=e+"-d"+this.counter++),this.raw[I]=t,I in this.classes&&(c.selector="."+Aa(this.classes[I]));var C=ga(I,t,c);if(!C)return null;this.register(C);var u=void 0===c.index?this.index.length:c.index;return this.index.splice(u,0,C),C},t.replace=function(e,t,n){var i=this.get(e),o=this.index.indexOf(i);i&&this.remove(i);var r=n;return-1!==o&&(r=(0,ue.A)({},n,{index:o})),this.add(e,t,r)},t.get=function(e){return this.map[e]},t.remove=function(e){this.unregister(e),delete this.raw[e.key],this.index.splice(this.index.indexOf(e),1)},t.indexOf=function(e){return this.index.indexOf(e)},t.process=function(){var e=this.options.jss.plugins;this.index.slice(0).forEach(e.onProcessRule,e)},t.register=function(e){this.map[e.key]=e,e instanceof ma?(this.map[e.selector]=e,e.id&&(this.classes[e.key]=e.id)):e instanceof Wa&&this.keyframes&&(this.keyframes[e.name]=e.id)},t.unregister=function(e){delete this.map[e.key],e instanceof ma?(delete this.map[e.selector],delete this.classes[e.key]):e instanceof Wa&&delete this.keyframes[e.name]},t.update=function(){var e,t,n;if("string"===typeof(arguments.length<=0?void 0:arguments[0])?(e=arguments.length<=0?void 0:arguments[0],t=arguments.length<=1?void 0:arguments[1],n=arguments.length<=2?void 0:arguments[2]):(t=arguments.length<=0?void 0:arguments[0],n=arguments.length<=1?void 0:arguments[1],e=null),e)this.updateOne(this.get(e),t,n);else for(var i=0;i<this.index.length;i++)this.updateOne(this.index[i],t,n)},t.updateOne=function(t,n,i){void 0===i&&(i=Ja);var o=this.options,r=o.jss.plugins,a=o.sheet;if(t.rules instanceof e)t.rules.update(n,i);else{var s=t.style;if(r.onUpdate(n,t,a,i),i.process&&s&&s!==t.style){for(var g in r.onProcessStyle(t.style,t,a),t.style){var l=t.style[g];l!==s[g]&&t.prop(g,l,Ua)}for(var c in s){var I=t.style[c],C=s[c];null==I&&I!==C&&t.prop(c,null,Ua)}}}},t.toString=function(e){for(var t="",n=this.options.sheet,i=!!n&&n.options.link,o=Ia(e).linebreak,r=0;r<this.index.length;r++){var a=this.index[r].toString(e);(a||i)&&(t&&(t+=o),t+=a)}return t},e}(),Pa=function(){function e(e,t){for(var n in this.attached=!1,this.deployed=!1,this.classes={},this.keyframes={},this.options=(0,ue.A)({},t,{sheet:this,parent:this,classes:this.classes,keyframes:this.keyframes}),t.Renderer&&(this.renderer=new t.Renderer(this)),this.rules=new Da(this.options),e)this.rules.add(n,e[n]);this.rules.process()}var t=e.prototype;return t.attach=function(){return this.attached||(this.renderer&&this.renderer.attach(),this.attached=!0,this.deployed||this.deploy()),this},t.detach=function(){return this.attached?(this.renderer&&this.renderer.detach(),this.attached=!1,this):this},t.addRule=function(e,t,n){var i=this.queue;this.attached&&!i&&(this.queue=[]);var o=this.rules.add(e,t,n);return o?(this.options.jss.plugins.onProcessRule(o),this.attached?this.deployed?(i?i.push(o):(this.insertRule(o),this.queue&&(this.queue.forEach(this.insertRule,this),this.queue=void 0)),o):o:(this.deployed=!1,o)):null},t.replaceRule=function(e,t,n){var i=this.rules.get(e);if(!i)return this.addRule(e,t,n);var o=this.rules.replace(e,t,n);return o&&this.options.jss.plugins.onProcessRule(o),this.attached?this.deployed?(this.renderer&&(o?i.renderable&&this.renderer.replaceRule(i.renderable,o):this.renderer.deleteRule(i)),o):o:(this.deployed=!1,o)},t.insertRule=function(e){this.renderer&&this.renderer.insertRule(e)},t.addRules=function(e,t){var n=[];for(var i in e){var o=this.addRule(i,e[i],t);o&&n.push(o)}return n},t.getRule=function(e){return this.rules.get(e)},t.deleteRule=function(e){var t="object"===typeof e?e:this.rules.get(e);return!(!t||this.attached&&!t.renderable)&&(this.rules.remove(t),!(this.attached&&t.renderable&&this.renderer)||this.renderer.deleteRule(t.renderable))},t.indexOf=function(e){return this.rules.indexOf(e)},t.deploy=function(){return this.renderer&&this.renderer.deploy(),this.deployed=!0,this},t.update=function(){var e;return(e=this.rules).update.apply(e,arguments),this},t.updateOne=function(e,t,n){return this.rules.updateOne(e,t,n),this},t.toString=function(e){return this.rules.toString(e)},e}(),Qa=function(){function e(){this.plugins={internal:[],external:[]},this.registry={}}var t=e.prototype;return t.onCreateRule=function(e,t,n){for(var i=0;i<this.registry.onCreateRule.length;i++){var o=this.registry.onCreateRule[i](e,t,n);if(o)return o}return null},t.onProcessRule=function(e){if(!e.isProcessed){for(var t=e.options.sheet,n=0;n<this.registry.onProcessRule.length;n++)this.registry.onProcessRule[n](e,t);e.style&&this.onProcessStyle(e.style,e,t),e.isProcessed=!0}},t.onProcessStyle=function(e,t,n){for(var i=0;i<this.registry.onProcessStyle.length;i++)t.style=this.registry.onProcessStyle[i](t.style,t,n)},t.onProcessSheet=function(e){for(var t=0;t<this.registry.onProcessSheet.length;t++)this.registry.onProcessSheet[t](e)},t.onUpdate=function(e,t,n,i){for(var o=0;o<this.registry.onUpdate.length;o++)this.registry.onUpdate[o](e,t,n,i)},t.onChangeValue=function(e,t,n){for(var i=e,o=0;o<this.registry.onChangeValue.length;o++)i=this.registry.onChangeValue[o](i,t,n);return i},t.use=function(e,t){void 0===t&&(t={queue:"external"});var n=this.plugins[t.queue];-1===n.indexOf(e)&&(n.push(e),this.registry=[].concat(this.plugins.external,this.plugins.internal).reduce((function(e,t){for(var n in t)n in e&&e[n].push(t[n]);return e}),{onCreateRule:[],onProcessRule:[],onProcessStyle:[],onProcessSheet:[],onChangeValue:[],onUpdate:[]}))},e}(),_a=function(){function e(){this.registry=[]}var t=e.prototype;return t.add=function(e){var t=this.registry,n=e.options.index;if(-1===t.indexOf(e))if(0===t.length||n>=this.index)t.push(e);else for(var i=0;i<t.length;i++)if(t[i].options.index>n)return void t.splice(i,0,e)},t.reset=function(){this.registry=[]},t.remove=function(e){var t=this.registry.indexOf(e);this.registry.splice(t,1)},t.toString=function(e){for(var t=void 0===e?{}:e,n=t.attached,i=(0,Ce.A)(t,["attached"]),o=Ia(i).linebreak,r="",a=0;a<this.registry.length;a++){var s=this.registry[a];null!=n&&s.attached!==n||(r&&(r+=o),r+=s.toString(i))}return r},ra(e,[{key:"index",get:function(){return 0===this.registry.length?0:this.registry[this.registry.length-1].options.index}}]),e}(),ja=new _a,Oa="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window&&window.Math===Math?window:"undefined"!==typeof self&&self.Math===Math?self:Function("return this")(),qa="2f1acc6c3a606b082e5eef5e54414ffb";null==Oa[qa]&&(Oa[qa]=0);var $a=Oa[qa]++,es=function(e){void 0===e&&(e={});var t=0;return function(n,i){t+=1;var o="",r="";return i&&(i.options.classNamePrefix&&(r=i.options.classNamePrefix),null!=i.options.jss.id&&(o=String(i.options.jss.id))),e.minify?""+(r||"c")+$a+o+t:r+n.key+"-"+$a+(o?"-"+o:"")+"-"+t}},ts=function(e){var t;return function(){return t||(t=e()),t}},ns=function(e,t){try{return e.attributeStyleMap?e.attributeStyleMap.get(t):e.style.getPropertyValue(t)}catch(n){return""}},is=function(e,t,n){try{var i=n;if(Array.isArray(n)&&(i=ca(n)),e.attributeStyleMap)e.attributeStyleMap.set(t,i);else{var o=i?i.indexOf("!important"):-1,r=o>-1?i.substr(0,o-1):i;e.style.setProperty(t,r,o>-1?"important":"")}}catch(a){return!1}return!0},os=function(e,t){try{e.attributeStyleMap?e.attributeStyleMap.delete(t):e.style.removeProperty(t)}catch(n){}},rs=function(e,t){return e.selectorText=t,e.selectorText===t},as=ts((function(){return document.querySelector("head")}));function ss(e){var t=ja.registry;if(t.length>0){var n=function(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(i.attached&&i.options.index>t.index&&i.options.insertionPoint===t.insertionPoint)return i}return null}(t,e);if(n&&n.renderer)return{parent:n.renderer.element.parentNode,node:n.renderer.element};if(n=function(e,t){for(var n=e.length-1;n>=0;n--){var i=e[n];if(i.attached&&i.options.insertionPoint===t.insertionPoint)return i}return null}(t,e),n&&n.renderer)return{parent:n.renderer.element.parentNode,node:n.renderer.element.nextSibling}}var i=e.insertionPoint;if(i&&"string"===typeof i){var o=function(e){for(var t=as(),n=0;n<t.childNodes.length;n++){var i=t.childNodes[n];if(8===i.nodeType&&i.nodeValue.trim()===e)return i}return null}(i);if(o)return{parent:o.parentNode,node:o.nextSibling}}return!1}var gs=ts((function(){var e=document.querySelector('meta[property="csp-nonce"]');return e?e.getAttribute("content"):null})),ls=function(e,t,n){try{"insertRule"in e?e.insertRule(t,n):"appendRule"in e&&e.appendRule(t)}catch(i){return!1}return e.cssRules[n]},cs=function(e,t){var n=e.cssRules.length;return void 0===t||t>n?n:t},Is=function(){function e(e){this.getPropertyValue=ns,this.setProperty=is,this.removeProperty=os,this.setSelector=rs,this.hasInsertedRules=!1,this.cssRules=[],e&&ja.add(e),this.sheet=e;var t=this.sheet?this.sheet.options:{},n=t.media,i=t.meta,o=t.element;this.element=o||function(){var e=document.createElement("style");return e.textContent="\n",e}(),this.element.setAttribute("data-jss",""),n&&this.element.setAttribute("media",n),i&&this.element.setAttribute("data-meta",i);var r=gs();r&&this.element.setAttribute("nonce",r)}var t=e.prototype;return t.attach=function(){if(!this.element.parentNode&&this.sheet){!function(e,t){var n=t.insertionPoint,i=ss(t);if(!1!==i&&i.parent)i.parent.insertBefore(e,i.node);else if(n&&"number"===typeof n.nodeType){var o=n,r=o.parentNode;r&&r.insertBefore(e,o.nextSibling)}else as().appendChild(e)}(this.element,this.sheet.options);var e=Boolean(this.sheet&&this.sheet.deployed);this.hasInsertedRules&&e&&(this.hasInsertedRules=!1,this.deploy())}},t.detach=function(){if(this.sheet){var e=this.element.parentNode;e&&e.removeChild(this.element),this.sheet.options.link&&(this.cssRules=[],this.element.textContent="\n")}},t.deploy=function(){var e=this.sheet;e&&(e.options.link?this.insertRules(e.rules):this.element.textContent="\n"+e.toString()+"\n")},t.insertRules=function(e,t){for(var n=0;n<e.index.length;n++)this.insertRule(e.index[n],n,t)},t.insertRule=function(e,t,n){if(void 0===n&&(n=this.element.sheet),e.rules){var i=e,o=n;if("conditional"===e.type||"keyframes"===e.type){var r=cs(n,t);if(!1===(o=ls(n,i.toString({children:!1}),r)))return!1;this.refCssRule(e,r,o)}return this.insertRules(i.rules,o),o}var a=e.toString();if(!a)return!1;var s=cs(n,t),g=ls(n,a,s);return!1!==g&&(this.hasInsertedRules=!0,this.refCssRule(e,s,g),g)},t.refCssRule=function(e,t,n){e.renderable=n,e.options.parent instanceof Pa&&this.cssRules.splice(t,0,n)},t.deleteRule=function(e){var t=this.element.sheet,n=this.indexOf(e);return-1!==n&&(t.deleteRule(n),this.cssRules.splice(n,1),!0)},t.indexOf=function(e){return this.cssRules.indexOf(e)},t.replaceRule=function(e,t){var n=this.indexOf(e);return-1!==n&&(this.element.sheet.deleteRule(n),this.cssRules.splice(n,1),this.insertRule(t,n))},t.getRules=function(){return this.element.sheet.cssRules},e}(),Cs=0,us=function(){function e(e){this.id=Cs++,this.version="10.10.0",this.plugins=new Qa,this.options={id:{minify:!1},createGenerateId:es,Renderer:ta?Is:null,plugins:[]},this.generateId=es({minify:!1});for(var t=0;t<Ea.length;t++)this.plugins.use(Ea[t],{queue:"internal"});this.setup(e)}var t=e.prototype;return t.setup=function(e){return void 0===e&&(e={}),e.createGenerateId&&(this.options.createGenerateId=e.createGenerateId),e.id&&(this.options.id=(0,ue.A)({},this.options.id,e.id)),(e.createGenerateId||e.id)&&(this.generateId=this.options.createGenerateId(this.options.id)),null!=e.insertionPoint&&(this.options.insertionPoint=e.insertionPoint),"Renderer"in e&&(this.options.Renderer=e.Renderer),e.plugins&&this.use.apply(this,e.plugins),this},t.createStyleSheet=function(e,t){void 0===t&&(t={});var n=t.index;"number"!==typeof n&&(n=0===ja.index?0:ja.index+1);var i=new Pa(e,(0,ue.A)({},t,{jss:this,generateId:t.generateId||this.generateId,insertionPoint:this.options.insertionPoint,Renderer:this.options.Renderer,index:n}));return this.plugins.onProcessSheet(i),i},t.removeStyleSheet=function(e){return e.detach(),ja.remove(e),this},t.createRule=function(e,t,n){if(void 0===t&&(t={}),void 0===n&&(n={}),"object"===typeof e)return this.createRule(void 0,e,t);var i=(0,ue.A)({},n,{name:e,jss:this,Renderer:this.options.Renderer});i.generateId||(i.generateId=this.generateId),i.classes||(i.classes={}),i.keyframes||(i.keyframes={});var o=ga(e,t,i);return o&&this.plugins.onProcessRule(o),o},t.use=function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return n.forEach((function(t){e.plugins.use(t)})),this},e}(),ds=function(e){return new us(e)},hs="object"===typeof CSS&&null!=CSS&&"number"in CSS;function As(e){var t=null;for(var n in e){var i=e[n],o=typeof i;if("function"===o)t||(t={}),t[n]=i;else if("object"===o&&null!==i&&!Array.isArray(i)){var r=As(i);r&&(t||(t={}),t[n]=r)}}return t}ds();function ps(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{baseClasses:t,newClasses:n,Component:i}=e;if(!n)return t;const o=(0,ue.A)({},t);return Object.keys(n).forEach((e=>{n[e]&&(o[e]=`${t[e]} ${n[e]}`)})),o}const ms={set:(e,t,n,i)=>{let o=e.get(t);o||(o=new Map,e.set(t,o)),o.set(n,i)},get:(e,t,n)=>{const i=e.get(t);return i?i.get(n):void 0},delete:(e,t,n)=>{e.get(t).delete(n)}},bs=ms;const fs=["checked","disabled","error","focused","focusVisible","required","expanded","selected"];var ys=Date.now(),Gs="fnValues"+ys,vs="fnStyle"+ ++ys;const Bs=function(){return{onCreateRule:function(e,t,n){if("function"!==typeof t)return null;var i=ga(e,{},n);return i[vs]=t,i},onProcessStyle:function(e,t){if(Gs in t||vs in t)return e;var n={};for(var i in e){var o=e[i];"function"===typeof o&&(delete e[i],n[i]=o)}return t[Gs]=n,e},onUpdate:function(e,t,n,i){var o=t,r=o[vs];r&&(o.style=r(e)||{});var a=o[Gs];if(a)for(var s in a)o.prop(s,a[s](e),i)}}};var Zs="@global",ws="@global ",Ws=function(){function e(e,t,n){for(var i in this.type="global",this.at=Zs,this.isProcessed=!1,this.key=e,this.options=n,this.rules=new Da((0,ue.A)({},n,{parent:this})),t)this.rules.add(i,t[i]);this.rules.process()}var t=e.prototype;return t.getRule=function(e){return this.rules.get(e)},t.addRule=function(e,t,n){var i=this.rules.add(e,t,n);return i&&this.options.jss.plugins.onProcessRule(i),i},t.replaceRule=function(e,t,n){var i=this.rules.replace(e,t,n);return i&&this.options.jss.plugins.onProcessRule(i),i},t.indexOf=function(e){return this.rules.indexOf(e)},t.toString=function(e){return this.rules.toString(e)},e}(),Ss=function(){function e(e,t,n){this.type="global",this.at=Zs,this.isProcessed=!1,this.key=e,this.options=n;var i=e.substr(8);this.rule=n.jss.createRule(i,t,(0,ue.A)({},n,{parent:this}))}return e.prototype.toString=function(e){return this.rule?this.rule.toString(e):""},e}(),Rs=/\s*,\s*/g;function xs(e,t){for(var n=e.split(Rs),i="",o=0;o<n.length;o++)i+=t+" "+n[o].trim(),n[o+1]&&(i+=", ");return i}const Vs=function(){return{onCreateRule:function(e,t,n){if(!e)return null;if(e===Zs)return new Ws(e,t,n);if("@"===e[0]&&e.substr(0,8)===ws)return new Ss(e,t,n);var i=n.parent;return i&&("global"===i.type||i.options.parent&&"global"===i.options.parent.type)&&(n.scoped=!1),n.selector||!1!==n.scoped||(n.selector=e),null},onProcessRule:function(e,t){"style"===e.type&&t&&(function(e,t){var n=e.options,i=e.style,o=i?i[Zs]:null;if(o){for(var r in o)t.addRule(r,o[r],(0,ue.A)({},n,{selector:xs(r,e.selector)}));delete i[Zs]}}(e,t),function(e,t){var n=e.options,i=e.style;for(var o in i)if("@"===o[0]&&o.substr(0,Zs.length)===Zs){var r=xs(o.substr(Zs.length),e.selector);t.addRule(r,i[o],(0,ue.A)({},n,{selector:r})),delete i[o]}}(e,t))}}};var Xs=/\s*,\s*/g,Hs=/&/g,Ys=/\$([\w-]+)/g;const Ks=function(){function e(e,t){return function(n,i){var o=e.getRule(i)||t&&t.getRule(i);return o?o.selector:i}}function t(e,t){for(var n=t.split(Xs),i=e.split(Xs),o="",r=0;r<n.length;r++)for(var a=n[r],s=0;s<i.length;s++){var g=i[s];o&&(o+=", "),o+=-1!==g.indexOf("&")?g.replace(Hs,a):a+" "+g}return o}function n(e,t,n){if(n)return(0,ue.A)({},n,{index:n.index+1});var i=e.options.nestingLevel;i=void 0===i?1:i+1;var o=(0,ue.A)({},e.options,{nestingLevel:i,index:t.indexOf(e)+1});return delete o.name,o}return{onProcessStyle:function(i,o,r){if("style"!==o.type)return i;var a,s,g=o,l=g.options.parent;for(var c in i){var I=-1!==c.indexOf("&"),C="@"===c[0];if(I||C){if(a=n(g,l,a),I){var u=t(c,g.selector);s||(s=e(l,r)),u=u.replace(Ys,s);var d=g.key+"-"+c;"replaceRule"in l?l.replaceRule(d,i[c],(0,ue.A)({},a,{selector:u})):l.addRule(d,i[c],(0,ue.A)({},a,{selector:u}))}else C&&l.addRule(c,{},a).addRule(g.key,i[c],{selector:g.selector});delete i[c]}}return i}}};var Ns=/[A-Z]/g,Ms=/^ms-/,Fs={};function ks(e){return"-"+e.toLowerCase()}const zs=function(e){if(Fs.hasOwnProperty(e))return Fs[e];var t=e.replace(Ns,ks);return Fs[e]=Ms.test(t)?"-"+t:t};function Ls(e){var t={};for(var n in e){t[0===n.indexOf("--")?n:zs(n)]=e[n]}return e.fallbacks&&(Array.isArray(e.fallbacks)?t.fallbacks=e.fallbacks.map(Ls):t.fallbacks=Ls(e.fallbacks)),t}const Ts=function(){return{onProcessStyle:function(e){if(Array.isArray(e)){for(var t=0;t<e.length;t++)e[t]=Ls(e[t]);return e}return Ls(e)},onChangeValue:function(e,t,n){if(0===t.indexOf("--"))return e;var i=zs(t);return t===i?e:(n.prop(i,e),null)}}};var Es=hs&&CSS?CSS.px:"px",Js=hs&&CSS?CSS.ms:"ms",Us=hs&&CSS?CSS.percent:"%";function Ds(e){var t=/(-[a-z])/g,n=function(e){return e[1].toUpperCase()},i={};for(var o in e)i[o]=e[o],i[o.replace(t,n)]=e[o];return i}var Ps=Ds({"animation-delay":Js,"animation-duration":Js,"background-position":Es,"background-position-x":Es,"background-position-y":Es,"background-size":Es,border:Es,"border-bottom":Es,"border-bottom-left-radius":Es,"border-bottom-right-radius":Es,"border-bottom-width":Es,"border-left":Es,"border-left-width":Es,"border-radius":Es,"border-right":Es,"border-right-width":Es,"border-top":Es,"border-top-left-radius":Es,"border-top-right-radius":Es,"border-top-width":Es,"border-width":Es,"border-block":Es,"border-block-end":Es,"border-block-end-width":Es,"border-block-start":Es,"border-block-start-width":Es,"border-block-width":Es,"border-inline":Es,"border-inline-end":Es,"border-inline-end-width":Es,"border-inline-start":Es,"border-inline-start-width":Es,"border-inline-width":Es,"border-start-start-radius":Es,"border-start-end-radius":Es,"border-end-start-radius":Es,"border-end-end-radius":Es,margin:Es,"margin-bottom":Es,"margin-left":Es,"margin-right":Es,"margin-top":Es,"margin-block":Es,"margin-block-end":Es,"margin-block-start":Es,"margin-inline":Es,"margin-inline-end":Es,"margin-inline-start":Es,padding:Es,"padding-bottom":Es,"padding-left":Es,"padding-right":Es,"padding-top":Es,"padding-block":Es,"padding-block-end":Es,"padding-block-start":Es,"padding-inline":Es,"padding-inline-end":Es,"padding-inline-start":Es,"mask-position-x":Es,"mask-position-y":Es,"mask-size":Es,height:Es,width:Es,"min-height":Es,"max-height":Es,"min-width":Es,"max-width":Es,bottom:Es,left:Es,top:Es,right:Es,inset:Es,"inset-block":Es,"inset-block-end":Es,"inset-block-start":Es,"inset-inline":Es,"inset-inline-end":Es,"inset-inline-start":Es,"box-shadow":Es,"text-shadow":Es,"column-gap":Es,"column-rule":Es,"column-rule-width":Es,"column-width":Es,"font-size":Es,"font-size-delta":Es,"letter-spacing":Es,"text-decoration-thickness":Es,"text-indent":Es,"text-stroke":Es,"text-stroke-width":Es,"word-spacing":Es,motion:Es,"motion-offset":Es,outline:Es,"outline-offset":Es,"outline-width":Es,perspective:Es,"perspective-origin-x":Us,"perspective-origin-y":Us,"transform-origin":Us,"transform-origin-x":Us,"transform-origin-y":Us,"transform-origin-z":Us,"transition-delay":Js,"transition-duration":Js,"vertical-align":Es,"flex-basis":Es,"shape-margin":Es,size:Es,gap:Es,grid:Es,"grid-gap":Es,"row-gap":Es,"grid-row-gap":Es,"grid-column-gap":Es,"grid-template-rows":Es,"grid-template-columns":Es,"grid-auto-rows":Es,"grid-auto-columns":Es,"box-shadow-x":Es,"box-shadow-y":Es,"box-shadow-blur":Es,"box-shadow-spread":Es,"font-line-height":Es,"text-shadow-x":Es,"text-shadow-y":Es,"text-shadow-blur":Es});function Qs(e,t,n){if(null==t)return t;if(Array.isArray(t))for(var i=0;i<t.length;i++)t[i]=Qs(e,t[i],n);else if("object"===typeof t)if("fallbacks"===e)for(var o in t)t[o]=Qs(o,t[o],n);else for(var r in t)t[r]=Qs(e+"-"+r,t[r],n);else if("number"===typeof t&&!1===isNaN(t)){var a=n[e]||Ps[e];return!a||0===t&&a===Es?t.toString():"function"===typeof a?a(t).toString():""+t+a}return t}const _s=function(e){void 0===e&&(e={});var t=Ds(e);return{onProcessStyle:function(e,n){if("style"!==n.type)return e;for(var i in e)e[i]=Qs(i,e[i],t);return e},onChangeValue:function(e,n){return Qs(n,e,t)}}};function js(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function Os(e){return function(e){if(Array.isArray(e))return js(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return js(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?js(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var qs="",$s="",eg="",tg="",ng=ta&&"ontouchstart"in document.documentElement;if(ta){var ig={Moz:"-moz-",ms:"-ms-",O:"-o-",Webkit:"-webkit-"},og=document.createElement("p").style;for(var rg in ig)if(rg+"Transform"in og){qs=rg,$s=ig[rg];break}"Webkit"===qs&&"msHyphens"in og&&(qs="ms",$s=ig.ms,tg="edge"),"Webkit"===qs&&"-apple-trailing-word"in og&&(eg="apple")}var ag={js:qs,css:$s,vendor:eg,browser:tg,isTouch:ng};var sg={noPrefill:["appearance"],supportedProperty:function(e){return"appearance"===e&&("ms"===ag.js?"-webkit-"+e:ag.css+e)}},gg={noPrefill:["color-adjust"],supportedProperty:function(e){return"color-adjust"===e&&("Webkit"===ag.js?ag.css+"print-"+e:e)}},lg=/[-\s]+(.)?/g;function cg(e,t){return t?t.toUpperCase():""}function Ig(e){return e.replace(lg,cg)}function Cg(e){return Ig("-"+e)}var ug,dg={noPrefill:["mask"],supportedProperty:function(e,t){if(!/^mask/.test(e))return!1;if("Webkit"===ag.js){var n="mask-image";if(Ig(n)in t)return e;if(ag.js+Cg(n)in t)return ag.css+e}return e}},hg={noPrefill:["text-orientation"],supportedProperty:function(e){return"text-orientation"===e&&("apple"!==ag.vendor||ag.isTouch?e:ag.css+e)}},Ag={noPrefill:["transform"],supportedProperty:function(e,t,n){return"transform"===e&&(n.transform?e:ag.css+e)}},pg={noPrefill:["transition"],supportedProperty:function(e,t,n){return"transition"===e&&(n.transition?e:ag.css+e)}},mg={noPrefill:["writing-mode"],supportedProperty:function(e){return"writing-mode"===e&&("Webkit"===ag.js||"ms"===ag.js&&"edge"!==ag.browser?ag.css+e:e)}},bg={noPrefill:["user-select"],supportedProperty:function(e){return"user-select"===e&&("Moz"===ag.js||"ms"===ag.js||"apple"===ag.vendor?ag.css+e:e)}},fg={supportedProperty:function(e,t){return!!/^break-/.test(e)&&("Webkit"===ag.js?"WebkitColumn"+Cg(e)in t&&ag.css+"column-"+e:"Moz"===ag.js&&("page"+Cg(e)in t&&"page-"+e))}},yg={supportedProperty:function(e,t){if(!/^(border|margin|padding)-inline/.test(e))return!1;if("Moz"===ag.js)return e;var n=e.replace("-inline","");return ag.js+Cg(n)in t&&ag.css+n}},Gg={supportedProperty:function(e,t){return Ig(e)in t&&e}},vg={supportedProperty:function(e,t){var n=Cg(e);return"-"===e[0]||"-"===e[0]&&"-"===e[1]?e:ag.js+n in t?ag.css+e:"Webkit"!==ag.js&&"Webkit"+n in t&&"-webkit-"+e}},Bg={supportedProperty:function(e){return"scroll-snap"===e.substring(0,11)&&("ms"===ag.js?""+ag.css+e:e)}},Zg={supportedProperty:function(e){return"overscroll-behavior"===e&&("ms"===ag.js?ag.css+"scroll-chaining":e)}},wg={"flex-grow":"flex-positive","flex-shrink":"flex-negative","flex-basis":"flex-preferred-size","justify-content":"flex-pack",order:"flex-order","align-items":"flex-align","align-content":"flex-line-pack"},Wg={supportedProperty:function(e,t){var n=wg[e];return!!n&&(ag.js+Cg(n)in t&&ag.css+n)}},Sg={flex:"box-flex","flex-grow":"box-flex","flex-direction":["box-orient","box-direction"],order:"box-ordinal-group","align-items":"box-align","flex-flow":["box-orient","box-direction"],"justify-content":"box-pack"},Rg=Object.keys(Sg),xg=function(e){return ag.css+e},Vg={supportedProperty:function(e,t,n){var i=n.multiple;if(Rg.indexOf(e)>-1){var o=Sg[e];if(!Array.isArray(o))return ag.js+Cg(o)in t&&ag.css+o;if(!i)return!1;for(var r=0;r<o.length;r++)if(!(ag.js+Cg(o[0])in t))return!1;return o.map(xg)}return!1}},Xg=[sg,gg,dg,hg,Ag,pg,mg,bg,fg,yg,Gg,vg,Bg,Zg,Wg,Vg],Hg=Xg.filter((function(e){return e.supportedProperty})).map((function(e){return e.supportedProperty})),Yg=Xg.filter((function(e){return e.noPrefill})).reduce((function(e,t){return e.push.apply(e,Os(t.noPrefill)),e}),[]),Kg={};if(ta){ug=document.createElement("p");var Ng=window.getComputedStyle(document.documentElement,"");for(var Mg in Ng)isNaN(Mg)||(Kg[Ng[Mg]]=Ng[Mg]);Yg.forEach((function(e){return delete Kg[e]}))}function Fg(e,t){if(void 0===t&&(t={}),!ug)return e;if(null!=Kg[e])return Kg[e];"transition"!==e&&"transform"!==e||(t[e]=e in ug.style);for(var n=0;n<Hg.length&&(Kg[e]=Hg[n](e,ug.style,t),!Kg[e]);n++);try{ug.style[e]=""}catch(i){return!1}return Kg[e]}var kg,zg={},Lg={transition:1,"transition-property":1,"-webkit-transition":1,"-webkit-transition-property":1},Tg=/(^\s*[\w-]+)|, (\s*[\w-]+)(?![^()]*\))/g;function Eg(e,t,n){if("var"===t)return"var";if("all"===t)return"all";if("all"===n)return", all";var i=t?Fg(t):", "+Fg(n);return i||(t||n)}function Jg(e,t){var n=t;if(!kg||"content"===e)return t;if("string"!==typeof n||!isNaN(parseInt(n,10)))return n;var i=e+n;if(null!=zg[i])return zg[i];try{kg.style[e]=n}catch(o){return zg[i]=!1,!1}if(Lg[e])n=n.replace(Tg,Eg);else if(""===kg.style[e]&&("-ms-flex"===(n=ag.css+n)&&(kg.style[e]="-ms-flexbox"),kg.style[e]=n,""===kg.style[e]))return zg[i]=!1,!1;return kg.style[e]="",zg[i]=n,zg[i]}ta&&(kg=document.createElement("p"));const Ug=function(){function e(t){for(var n in t){var i=t[n];if("fallbacks"===n&&Array.isArray(i))t[n]=i.map(e);else{var o=!1,r=Fg(n);r&&r!==n&&(o=!0);var a=!1,s=Jg(r,ca(i));s&&s!==i&&(a=!0),(o||a)&&(o&&delete t[n],t[r||n]=s||i)}}return t}return{onProcessRule:function(e){if("keyframes"===e.type){var t=e;t.at=function(e){return"-"===e[1]||"ms"===ag.js?e:"@"+ag.css+"keyframes"+e.substr(10)}(t.at)}},onProcessStyle:function(t,n){return"style"!==n.type?t:e(t)},onChangeValue:function(e,t){return Jg(t,ca(e))||e}}};const Dg=function(){var e=function(e,t){return e.length===t.length?e>t?1:-1:e.length-t.length};return{onProcessStyle:function(t,n){if("style"!==n.type)return t;for(var i={},o=Object.keys(t).sort(e),r=0;r<o.length;r++)i[o[r]]=t[o[r]];return i}}};const Pg=ds({plugins:[Bs(),Vs(),Ks(),Ts(),_s(),"undefined"===typeof window?null:Ug(),Dg()]}),Qg={disableGeneration:!1,generateClassName:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{disableGlobal:t=!1,productionPrefix:n="jss",seed:i=""}=e,o=""===i?"":`${i}-`;let r=0;const a=()=>(r+=1,r);return(e,r)=>{const s=r.options.name;if(s&&0===s.indexOf("Mui")&&!r.options.link&&!t){if(-1!==fs.indexOf(e.key))return`Mui-${e.key}`;const t=`${o}${s}-${e.key}`;return r.options.theme[ti]&&""===i?`${t}-${a()}`:t}return`${o}${n}${a()}`}}(),jss:Pg,sheetsCache:null,sheetsManager:new Map,sheetsRegistry:null},_g=t.createContext(Qg);let jg=-1e9;const Og=["variant"];function qg(e){return 0===e.length}function $g(e){const t="function"===typeof e;return{create:(n,i)=>{let o;try{o=t?e(n):e}catch(g){throw g}if(!i||!n.components||!n.components[i]||!n.components[i].styleOverrides&&!n.components[i].variants)return o;const r=n.components[i].styleOverrides||{},a=n.components[i].variants||[],s=(0,ue.A)({},o);return Object.keys(r).forEach((e=>{s[e]=(0,xe.A)(s[e]||{},r[e])})),a.forEach((e=>{const t=function(e){const{variant:t}=e,n=(0,Ce.A)(e,Og);let i=t||"";return Object.keys(n).sort().forEach((t=>{i+="color"===t?qg(i)?e[t]:(0,ye.A)(e[t]):`${qg(i)?t:(0,ye.A)(t)}${(0,ye.A)(e[t].toString())}`})),i}(e.props);s[t]=(0,xe.A)(s[t]||{},e.style)})),s},options:{}}}const el={},tl=["name","classNamePrefix","Component","defaultTheme"];function nl(e,t){let{state:n,theme:i,stylesOptions:o,stylesCreator:r,name:a}=e;if(o.disableGeneration)return;let s=bs.get(o.sheetsManager,r,i);s||(s={refs:0,staticSheet:null,dynamicStyles:null},bs.set(o.sheetsManager,r,i,s));const g=(0,ue.A)({},r.options,o,{theme:i,flip:"boolean"===typeof o.flip?o.flip:"rtl"===i.direction});g.generateId=g.serverGenerateClassName||g.generateClassName;const l=o.sheetsRegistry;if(0===s.refs){let e;o.sheetsCache&&(e=bs.get(o.sheetsCache,r,i));const t=r.create(i,a);e||(e=o.jss.createStyleSheet(t,(0,ue.A)({link:!1},g)),e.attach(),o.sheetsCache&&bs.set(o.sheetsCache,r,i,e)),l&&l.add(e),s.staticSheet=e,s.dynamicStyles=As(t)}if(s.dynamicStyles){const e=o.jss.createStyleSheet(s.dynamicStyles,(0,ue.A)({link:!0},g));e.update(t),e.attach(),n.dynamicSheet=e,n.classes=ps({baseClasses:s.staticSheet.classes,newClasses:e.classes}),l&&l.add(e)}else n.classes=s.staticSheet.classes;s.refs+=1}function il(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{name:i,classNamePrefix:o,Component:r,defaultTheme:a=el}=n,s=(0,Ce.A)(n,tl),g=$g(e),l=i||o||"makeStyles";g.options={index:(jg+=1,jg),name:i,meta:l,classNamePrefix:l};return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=function(){var e;const t=ei();return null!=(e=null==t?void 0:t.$$material)?e:t}()||a,o=(0,ue.A)({},t.useContext(_g),s),l=t.useRef(),c=t.useRef();!function(e,n){const i=t.useRef([]);let o;const r=t.useMemo((()=>({})),n);i.current!==r&&(i.current=r,o=e()),t.useEffect((()=>()=>{o&&o()}),[r])}((()=>{const t={name:i,state:{},stylesCreator:g,stylesOptions:o,theme:n};return nl(t,e),c.current=!1,l.current=t,()=>{!function(e){let{state:t,theme:n,stylesOptions:i,stylesCreator:o}=e;if(i.disableGeneration)return;const r=bs.get(i.sheetsManager,o,n);r.refs-=1;const a=i.sheetsRegistry;0===r.refs&&(bs.delete(i.sheetsManager,o,n),i.jss.removeStyleSheet(r.staticSheet),a&&a.remove(r.staticSheet)),t.dynamicSheet&&(i.jss.removeStyleSheet(t.dynamicSheet),a&&a.remove(t.dynamicSheet))}(t)}}),[n,g]),t.useEffect((()=>{c.current&&function(e,t){let{state:n}=e;n.dynamicSheet&&n.dynamicSheet.update(t)}(l.current,e),c.current=!0}));const I=function(e,t,n){let{state:i,stylesOptions:o}=e;if(o.disableGeneration)return t||{};i.cacheClasses||(i.cacheClasses={value:null,lastProp:null,lastJSS:{}});let r=!1;return i.classes!==i.cacheClasses.lastJSS&&(i.cacheClasses.lastJSS=i.classes,r=!0),t!==i.cacheClasses.lastProp&&(i.cacheClasses.lastProp=t,r=!0),r&&(i.cacheClasses.value=ps({baseClasses:i.cacheClasses.lastJSS,newClasses:t,Component:n})),i.cacheClasses.value}(l.current,e.classes,r);return I}}var ol=n(7115),rl=n.n(ol),al=n(1577);const sl=n.p+"static/media/ARPG_img_0.be0b4af55d9e1716463d.png",gl=n.p+"static/media/ARPG_img_1.ca1f695c0ca4658290a2.png",ll=n.p+"static/media/ARPG_img_2.d50670d347f4372a5242.png",cl=n.p+"static/media/ARPG_img_3.16e30963b2195badd2a6.png",Il=n.p+"static/media/ARPG_img_4.6f9c7a0a6d6a374b9ad3.png",Cl=n.p+"static/media/ARPG_img_5.aacf4df1beb35dfe3db7.png",ul=n.p+"static/media/ARPG_img_6.0e15fffc9439c6081d12.png",dl=n.p+"static/media/BPP_img_1.0388976829f0dd4d51a7.png",hl=n.p+"static/media/BPP_img_2.b8f7d8f302946d4c38d7.png",Al=n.p+"static/media/BPP_img_3.5b38d3be13acc0e1e894.png",pl=n.p+"static/media/GOA1_img_1.e91234b37807910f237c.png",ml=n.p+"static/media/GOA1_img_2.b6563505051aebaf00e6.png",bl=n.p+"static/media/GOA1_img_3.5c647c72ebc05111a9d3.png",fl=n.p+"static/media/GOA1_img_4.13a4d6f0df3b3982e05f.png",yl=n.p+"static/media/GOA1_img_5.f44b8ed9f8548e0cabe3.png",Gl=n.p+"static/media/GOA1_img_6.d51e3848d95a4d0ca41c.png",vl=n.p+"static/media/goa2_1.5a4ebcb21da6f5dc5bd3.png",Bl=n.p+"static/media/goa2_2.f2eb0adeb236ca9e7ec5.png",Zl=n.p+"static/media/goa2_3.090142719631ec17415c.png",wl=n.p+"static/media/goa2_4.d4561b4ed8f1f8a5550f.png",Wl=n.p+"static/media/goa2_5.c1eb5a394bac794b7ab9.png",Sl=n.p+"static/media/goa2_6.c6f8c3572c515f2aba07.png",Rl=n.p+"static/media/javaprojec_img1.477abf608c5a8a4e3281.png",xl=n.p+"static/media/javaprojec_img2.7de431021fec798d8b76.png",Vl=n.p+"static/media/javaprojec_img3.27b9aeb14f1b94033e39.png",Xl=n.p+"static/media/javaprojec_img4.b595535f7a32e3f929b8.png",Hl=n.p+"static/media/personalSite_img_1.dd857c7535734eeef0d0.png",Yl=n.p+"static/media/swarmed_splash.71ad6d2487bda90ed892.png",Kl=n.p+"static/media/doodlle1.ab8bb4bf1aff0c10de71.png",Nl=il({projectCard:{"&:hover":{transition:"transform .2s ease-in-out",transform:"scale(1.05)"}},projectCarousel:{}}),Ml=[{title:"Swarmed",subtitle:"Summer 2024",description:"How long can you last in this minigame?",descriptionLong:[""],thumbnail:Yl,images:[Yl],githubrepo:"https://github.com/BradPeng/Swarmed-Release",webdemo:"https://bradpeng.ca/swarmed"},{title:"Doodlle - React Web App",subtitle:"Summer 2024",description:"Draw Doodles and guess what other people have drawn!",descriptionLong:[""],thumbnail:Kl,images:[Kl],githubrepo:"",webdemo:"https://doodlle.web.app/"},{title:"2D Platforming RPG (Game Maker)",subtitle:"Fall 2021",description:"Jump around, destroy enemies and explore in this 2D platforming RPG!",descriptionLong:["This game resulted from my second adventure with Game Maker Studio 2. I've always wanted to make an RPG-style game, and a 2D platforming approach seemed like the perfect way to tackle my ideas, as well as learn some new game development tricks. The most important aspect of a platformer is the player movement. I wanted to have multiple attacks and precise movement, so I had to find a clever way to write maintainable code. That's where the player states come in. Every move the player can make is associated with a so-called player state. In each specific state, the player can only perform certain actions. This way, I isolate the player's movement depending on the state, allowing me to effortlessly code the specific movements I want. I also had the opportunity to play with some simple math functions while coding the enemy AI. For example, I implemented basic parabolas into the spider's arched movements and did some basic trigonometry to make the bat enemy fly toward the player at a constant speed."],thumbnail:sl,images:[sl,gl,ll,cl,Il,Cl,ul],githubrepo:"https://github.com/BradPeng/adventure-platforming-game",webdemo:"https://bradpeng.ca/adventure-platformer"},{title:"Bruce Pew Pew (Game Maker)",subtitle:"Summer 2021",description:"Play a fun arcade-style 2D top-down shooting game!",descriptionLong:["Bruce Pew Pew was the first game I developed using the Game Maker Studio 2 Engine. Written in the Game Maker Language (GML), which is similar to JavaScript, the development process of Bruce Pew Pew taught me the fundamentals I needed to know to develop games. Despite being a straightforward game, I learned about various game development techniques, such as handling precise movement and animation tricks done with sprites. This was the first time I had the opportunity to bring my creative ideas to life. I had a lot of fun coming up with enemy types, enemy attacks and powerups. The result, while simple, is an enjoyable game that I enjoyed playing with my friends. This also cemented in me a love for game development, and I plan to pursue more projects in the future."],thumbnail:dl,images:[dl,hl,Al],githubrepo:"https://github.com/BradPeng/space-shooter-game",webdemo:"https://bradpeng.ca/brucepewpew"},{title:"Personal Portfolio Website (React)",subtitle:"Winter 2022",description:"A portfolio website made with React to display my projects through a visual medium.",descriptionLong:["During my internship with the Institute of Applied Design and Technology Education Society, I learned how to use the Material UI library and React. It had been a while since I worked with React. Since I happen to be looking for work, creating a portfolio website seemed like the perfect way to get some practice in while also showing off some of my abilities. This site was primarily built with Material UI, a React component library created with Google's Material Design principles in mind.","Using the Material UI components as a base, I made more complex compound components that this project is built on. Throughout the development of the project, I was able to play with React states, React hooks and React refs, which let me dive a little bit deeper into the capabilities of React. I also played with some CSS overriding, which was excellent practice. I also had the opportunity to deploy a website for the first time. I bought the domain through Google domains, and I am hosting the website using Github Pages."],thumbnail:Hl,images:[Hl],githubrepo:"https://github.com/BradPeng/personal-site",webdemo:""},{title:"Student Volunteer Opportunities App (iOS)",subtitle:"Fall 2017",description:"A simple app for students to find volunteer opportunities.",descriptionLong:['This project resulted from my first year participating in the Game of Apps program - an iOS app design and development. The theme of this year\'s competition was "Making a Change," and we decided to embody that idea by creating an app that would enable anyone to make an impact on the world.',"Being my first significant exposure to programming, I learned a lot from experience. Starting from basic coding principles like variables, loops and conditionals, I then moved on to more complex iOS development tools like optional values, structures, and Storyboarding. More specifically, I learned a lot about using reusable cell elements. I remember spending many hours learning how to create table view cells and mapping data from a list onto them. Being on a team with two other developers, I also had a chance to learn how to use git. Git was quite terrifying at first, but being able to freely execute commands in my project made me feel a lot more confident when I moved on to using git in company work during my internships. By the end of the hackathon, our team received an award for the best-designed app. Unfortunately, the application has been lost to time, and I could only recover some images of the project mockups we made in Figma, which are the pictures displayed in the carousel above."],thumbnail:pl,images:[pl,ml,bl,fl,yl,Gl],githubrepo:"",webdemo:""},{title:"Youth Financial Tracking App (iOS)",subtitle:"Fall 2018",description:"A lightweight application that teaches youth financial tracking habits.",descriptionLong:['In my senior year of high school, I participated in the Game of Apps program for the second time. The Game of Apps program is a mobile app design and development course and competition. This year, the hackathon theme was "A day in the Life." My team and I decided that finance tracking was a problem we wanted to solve. We noticed that a lot of spending would often go untracked in day-to-day life. It was often inconvenient to record cash purchases, especially on the go. So we decided to create a very lightweight application for tracking finances. Because we could not compete with existing solutions like Mint, we decided to target a much younger demographic.',"We built the app for children without credit and debit cards or youth who primarily buy things with cash. We hoped to get young users to begin developing healthy financial tracking habits early by creating a straightforward application with a low entry-level. The app features everything you would expect, such as recording transactions and income separated by categories. The app comes with a few preloaded categories or tags and allows users to create their own. The tags will enable the user to see a breakdown of their spending easily. Another unique feature provided by the app is the goal feature. Users can create a target for purchase and view their progress as they start to save money.","Three developers and three designers worked on the project. The dev portion of the application was built using Xcode 9.3 and Swift 4, and version control was maintained through git and Bitbucket. A significant focus of my tasks on the application was on Storyboarding the views and creating the reusable CollectionView cells and TableView cells present throughout the app. "],thumbnail:vl,images:[vl,Bl,Sl,Zl,wl,Wl],githubrepo:"",webdemo:""},{title:"Desktop Reminder Manager (Java)",subtitle:"Fall 2020",description:"A project for a Software Construction Course made with object oriented design principles.",descriptionLong:["I built this project for my Software Construction course using plain Java in conjunction with the Java Swing library and a JSON library for application persistence. I first made the project a console application, where console commands were used to create reminders and add reminders to a list. At this point, I had already implemented multiple type-hierarchies and used the iterator design pattern.","The second phase of the project was to add persistence to the application. In other words, I wanted users of the application to have the option to load their saved data from their last session. Because of the simple list-like nature of the application, the user's data could easily be stored in a JSON file as JSON objects. So I used a very lightweight JSON library to convert my custom classes into JSON objects. Once the user saved their data into a JSON file, it was simple enough to parse through and reconstruct the Java objects from the data.","The next part of the project was to create a graphical user interface (GUI) for the application. Since the project's backbone had already been coded and tested, I just had to make the GUI elements and map each button press to an existing function. Of course, some minor changes had to be made to accommodate the new method of entering data. Still, it ended up being an excellent opportunity to practice code refactoring. As a bonus, I also went over my code again and made minor improvements."],thumbnail:xl,images:[Rl,xl,Vl,Xl],githubrepo:"https://github.com/BradPeng/cpsc_210_project",webdemo:""}];const Fl=function(){const e=Nl(),[n,i]=t.useState(!1),[o,r]=t.useState(),[a,s]=t.useState([]),[g,l]=t.useState([]),[c,I]=t.useState(),[C,u]=t.useState(),d=(e,t,n,o,a)=>()=>{i(!0),r(e),s(t),l(n),I(o),u(a)},h=()=>{i(!1)},A=t.useRef(null);t.useEffect((()=>{if(n){const{current:e}=A;null!==e&&e.focus()}}),[n]);let p=Ml.map(((t,i)=>(0,ce.jsxs)(xn,{item:!0,xs:12,sm:6,md:4,children:[(0,ce.jsxs)(Nr,{open:n,onClose:h,BackdropProps:{invisible:!0},maxWidth:"md",children:[(0,ce.jsxs)($r,{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline"},children:[o,(0,ce.jsxs)("div",{style:{display:"flex"},children:[(0,ce.jsx)("div",{style:{paddingRight:"20px"},children:""!=C?(0,ce.jsx)(qn,{target:"_blank",rel:"noopener",href:C,children:"Demo"}):(0,ce.jsx)(ce.Fragment,{})}),""!=c?(0,ce.jsx)(qn,{target:"_blank",rel:"noopener",href:c,children:"GitHub Repo"}):(0,ce.jsx)(ce.Fragment,{})]})]}),(0,ce.jsxs)(Dr,{children:[(0,ce.jsx)(al.FN,{emulateTouch:!0,useKeyboardArrows:!0,swipeable:!0,className:"project-carousel",children:g.map((e=>(0,ce.jsx)("div",{children:(0,ce.jsx)("img",{style:{maxHeight:"600px"},src:e})},o)))}),(0,ce.jsx)(jr,{children:a.map((e=>(0,ce.jsxs)(ce.Fragment,{children:[(0,ce.jsx)(Dt,{children:e}),(0,ce.jsx)("br",{})]})))})]}),(0,ce.jsx)(zr,{children:(0,ce.jsx)(go,{onClick:h,children:"Close"})})]}),(0,ce.jsx)(mo,{"data-aos":"flip-up",sx:{maxWidth:345,minWidth:200},className:e.projectCard,children:(0,ce.jsxs)(qi,{onClick:d(t.title,t.descriptionLong,t.images,t.githubrepo,t.webdemo),children:[(0,ce.jsx)(xo,{title:t.title,subheader:t.subtitle}),(0,ce.jsx)(Mo,{component:"img",height:"194",image:t.thumbnail}),(0,ce.jsx)(Go,{children:(0,ce.jsx)(Dt,{variant:"body2",color:"text.secondary",children:t.description})})]})})]},i)));return(0,t.useEffect)((()=>{rl().init({duration:1200,delay:100})}),[]),(0,ce.jsxs)(Ft,{style:{paddingBottom:"250px"},children:[(0,ce.jsx)(Dt,{gutterBottom:!0,variant:"h3",component:"h1",children:"Personal Projects"}),(0,ce.jsx)(xn,{justifyContent:"flex-start",alignItems:"center",container:!0,spacing:12,rowSpacing:6,children:p})]})};function kl(e){let{props:t,name:n}=e;return Se({props:t,name:n,defaultTheme:St,themeId:Rt})}const zl=t.createContext({});function Ll(e){return be("MuiTimeline",e)}zt("MuiTimeline",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse"]);function Tl(e){return"alternate-reverse"===e?"positionAlternateReverse":`position${Pe(e)}`}const El=["position","className"],Jl=Xt("ul",{name:"MuiTimeline",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.position&&t[Tl(n.position)]]}})({display:"flex",flexDirection:"column",padding:"6px 16px",flexGrow:1}),Ul=t.forwardRef((function(e,n){const i=kl({props:e,name:"MuiTimeline"}),{position:o="right",className:r}=i,a=(0,Ce.A)(i,El),s=(0,ue.A)({},i,{position:o}),g=(e=>{const{position:t,classes:n}=e;return fe({root:["root",t&&Tl(t)]},Ll,n)})(s),l=t.useMemo((()=>({position:o})),[o]);return(0,ce.jsx)(zl.Provider,{value:l,children:(0,ce.jsx)(Jl,(0,ue.A)({className:he(g.root,r),ownerState:s,ref:n},a))})}));function Dl(e){return be("MuiTimelineConnector",e)}zt("MuiTimelineConnector",["root"]);const Pl=["className"],Ql=Xt("span",{name:"MuiTimelineConnector",slot:"Root",overridesResolver:(e,t)=>t.root})((e=>{let{theme:t}=e;return{width:2,backgroundColor:(t.vars||t).palette.grey[400],flexGrow:1}})),_l=t.forwardRef((function(e,t){const n=kl({props:e,name:"MuiTimelineConnector"}),{className:i}=n,o=(0,Ce.A)(n,Pl),r=n,a=(e=>{const{classes:t}=e;return fe({root:["root"]},Dl,t)})(r);return(0,ce.jsx)(Ql,(0,ue.A)({className:he(a.root,i),ownerState:r,ref:t},o))}));function jl(e){return be("MuiTimelineContent",e)}const Ol=zt("MuiTimelineContent",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse"]),ql=["className"],$l=Xt(Dt,{name:"MuiTimelineContent",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[Tl(n.position)]]}})((e=>{let{ownerState:t}=e;return(0,ue.A)({flex:1,padding:"6px 16px",textAlign:"left"},"left"===t.position&&{textAlign:"right"})})),ec=t.forwardRef((function(e,n){const i=kl({props:e,name:"MuiTimelineContent"}),{className:o}=i,r=(0,Ce.A)(i,ql),{position:a}=t.useContext(zl),s=(0,ue.A)({},i,{position:a||"right"}),g=(e=>{const{position:t,classes:n}=e;return fe({root:["root",Tl(t)]},jl,n)})(s);return(0,ce.jsx)($l,(0,ue.A)({component:"div",className:he(g.root,o),ownerState:s,ref:n},r))}));function tc(e){return be("MuiTimelineDot",e)}zt("MuiTimelineDot",["root","filled","outlined","filledGrey","outlinedGrey","filledPrimary","outlinedPrimary","filledSecondary","outlinedSecondary"]);const nc=["className","color","variant"],ic=Xt("span",{name:"MuiTimelineDot",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t["inherit"!==n.color&&`${n.variant}${Pe(n.color)}`],t[n.variant]]}})((e=>{let{ownerState:t,theme:n}=e;return(0,ue.A)({display:"flex",alignSelf:"baseline",borderStyle:"solid",borderWidth:2,padding:4,borderRadius:"50%",boxShadow:(n.vars||n).shadows[1],margin:"11.5px 0"},"filled"===t.variant&&(0,ue.A)({borderColor:"transparent"},"inherit"!==t.color&&(0,ue.A)({},"grey"===t.color?{color:(n.vars||n).palette.grey[50],backgroundColor:(n.vars||n).palette.grey[400]}:{color:(n.vars||n).palette[t.color].contrastText,backgroundColor:(n.vars||n).palette[t.color].main})),"outlined"===t.variant&&(0,ue.A)({boxShadow:"none",backgroundColor:"transparent"},"inherit"!==t.color&&(0,ue.A)({},"grey"===t.color?{borderColor:(n.vars||n).palette.grey[400]}:{borderColor:(n.vars||n).palette[t.color].main})))})),oc=t.forwardRef((function(e,t){const n=kl({props:e,name:"MuiTimelineDot"}),{className:i,color:o="grey",variant:r="filled"}=n,a=(0,Ce.A)(n,nc),s=(0,ue.A)({},n,{color:o,variant:r}),g=(e=>{const{color:t,variant:n,classes:i}=e;return fe({root:["root",n,"inherit"!==t&&`${n}${Pe(t)}`]},tc,i)})(s);return(0,ce.jsx)(ic,(0,ue.A)({className:he(g.root,i),ownerState:s,ref:t},a))}));const rc=function(e,n){var i,o;return t.isValidElement(e)&&-1!==n.indexOf(null!=(i=e.type.muiName)?i:null==(o=e.type)||null==(o=o._payload)||null==(o=o.value)?void 0:o.muiName)};function ac(e){return be("MuiTimelineOppositeContent",e)}const sc=zt("MuiTimelineOppositeContent",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse"]);function gc(e){return be("MuiTimelineItem",e)}zt("MuiTimelineItem",["root","positionLeft","positionRight","positionAlternate","positionAlternateReverse","missingOppositeContent"]);const lc=["position","className"],cc=Xt("li",{name:"MuiTimelineItem",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[Tl(n.position)]]}})((e=>{let{ownerState:t}=e;return(0,ue.A)({listStyle:"none",display:"flex",position:"relative",minHeight:70},"left"===t.position&&{flexDirection:"row-reverse"},("alternate"===t.position||"alternate-reverse"===t.position)&&{[`&:nth-of-type(${"alternate"===t.position?"even":"odd"})`]:{flexDirection:"row-reverse",[`& .${Ol.root}`]:{textAlign:"right"},[`& .${sc.root}`]:{textAlign:"left"}}},!t.hasOppositeContent&&{"&::before":{content:'""',flex:1,padding:"6px 16px"}})})),Ic=t.forwardRef((function(e,n){const i=kl({props:e,name:"MuiTimelineItem"}),{position:o,className:r}=i,a=(0,Ce.A)(i,lc),{position:s}=t.useContext(zl);let g=!1;t.Children.forEach(i.children,(e=>{rc(e,["TimelineOppositeContent"])&&(g=!0)}));const l=(0,ue.A)({},i,{position:o||s||"right",hasOppositeContent:g}),c=(e=>{const{position:t,classes:n,hasOppositeContent:i}=e;return fe({root:["root",Tl(t),!i&&"missingOppositeContent"]},gc,n)})(l),I=t.useMemo((()=>({position:l.position})),[l.position]);return(0,ce.jsx)(zl.Provider,{value:I,children:(0,ce.jsx)(cc,(0,ue.A)({className:he(c.root,r),ownerState:l,ref:n},a))})}));function Cc(e){return be("MuiTimelineSeparator",e)}zt("MuiTimelineSeparator",["root"]);const uc=["className"],dc=Xt("div",{name:"MuiTimelineSeparator",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"flex",flexDirection:"column",flex:0,alignItems:"center"}),hc=t.forwardRef((function(e,t){const n=kl({props:e,name:"MuiTimelineSeparator"}),{className:i}=n,o=(0,Ce.A)(n,uc),r=n,a=(e=>{const{classes:t}=e;return fe({root:["root"]},Cc,t)})(r);return(0,ce.jsx)(dc,(0,ue.A)({className:he(a.root,i),ownerState:r,ref:t},o))})),Ac="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAAAAAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/2wBDAQMEBAUEBQkFBQkUDQsNFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBT/wAARCABkAGQDASIAAhEBAxEB/8QAHAABAAIDAQEBAAAAAAAAAAAAAAcIBAUGAgED/8QANxAAAQMCAwUFBgUFAQAAAAAAAQACAwQFBhFBByExNbESE1FycwgiI2FxgRQygpGhM0WT0dPw/8QAHAEAAgMBAQEBAAAAAAAAAAAAAAUCAwYEBwEI/8QALBEAAQMDAgMIAgMAAAAAAAAAAQACAwQFERIxITJxBhMzQVGBkeFCobHB8P/aAAwDAQACEQMRAD8AuwiIvzuvWETQomhQEKOrxzSr9V3VYiy7xzSr9V3VYict5QtPF4beiIiKQVi5LEvMz5AtSttiXmZ8gWpTuHkC6G7IiIrVJEREIVk0RFhFikTQomhQEKOrxzSr9V3VYiy7xzSr9V3VYict5QtPF4beiIiKQVi5LEvMz5AtSttiXmZ8gWpTuHkC6G7IiIrVJEREIVks/Feo4nSuDWNL3HgGjMr9rfQvuNbDTR/mkeGgnT5qX7NYqWy0wigjHay955HvOPiSk1ps8lzJOrS0bnfj6BeZ11wbRgDGXHyUNywSwHKWN8ZOj2kLwAu+2jXeOOJlvjydI7J8hyz7I0H1P/uK4HiFw3Gkjo6gwxv1Y3OMcfTzXTRzuqYu8c3TlR3d+aVfqu6rFY0vcGtBLjuAGqzLox0l4qWNBc50xAA4k5qxOANn1FhO3RPfCyW4vaDLO4ZkE8WtOgHDdxTq2299e7S04A3Kc191jtkDCRlx2CrjUW+qo29qemmga7gZIy0H91jq4NTRw1kL4Z4WSwvGTo3tBaR8wVXvazgWLCdziqaJpbQVefZYN/duHFo+W/MffwTGvsr6OPvWO1NG/DGFw2ztAyul7iRmlx245BUK4l5mfIFqVtsS8zPkCwaChqLlWwUlNG6WonkbFFG3i5xOQC5oBqY0BbTUGs1OX4BpDe1kcicgV8VpMS7C6c7JobRRRtkvFA01TJWjfNKR8Rv0cBkPo3wVXHNLXOBBBG4g6JjU0r6UjV5j/D2Su23OK5NeY/xOPbyPuviIi404VqcIVDKXEdHJIQGdstzOhcCB/JUxNPgVAw3712di2hvo4RDXxOnAGQljPvH6g8fqo9nrrBRtdTznAJyD+uPwvI7tQyTuEsQyQMYXVVeDLVXVMk88Lnyv3ucZHf7XA4yt1BbLgymomlgbH2nguJ3k7uPy6rfV+0xhhLaKmf3hG582QA+wJz/dcNUVEtZNJLM4vkee05x4kr5e623yR93StBcTkuAx+/UotlNVMdrmcQ0bDP8AS4J9UyixS2oeO1HDVCRw8QHAnorW088dRCySN4exzQWuacwQeBVR7wMrpV+q7qu3wJtdq8L0raGshNbQs3M7LsnxjwGe4j5Hh46K+x18dISybgHY4+hT292yWthjkg4uaNvUFWFzzy3blEntA10LbdbKIEGZ0ply1DQ0j+S4fsvVw2/0DaZ34K3VL58twnLWNB+oJJUQ36/1mJLlLXV0veTP3AAZNY3RrRoAnN1ulO6AxRO1F3wEostlqWVLZ526Q35JXBYl5mfIFMvszbPfxVVNiiti+HCXRUTXD8z+D5PsPdHzLvBQ7fxGbywTOc2IhvbcwZuDdSASMz91Pdh9o7B2HrRS22jtV1jpqWMRxjuo+A1PxN5PEnxK4bUIg4SSuwBt1+lrL66pdTdxSsLi7cjyH3/CnfRVO9ofZ8cL4lF4pI8rdc3F7uyNzJ+Lh+r8w/V4KSR7VWGB/bbr/ij/AOi57He3jB+N8MVtoqLbdG983OOV0MZ7t43td/U0P8ZjVaGslpqiEtDxkbLHWenuNvqmyGI6Twd0+t1X1ERY9etqyaIiwixSJoUTQoCFHV35nV+o7qsRZd35nV+o7qsROW8oWni8NvRERFJWLksS8zPkC1K22JeZnyBalO4eQLobsiIitUkREQhWTREWEWKRNCiaFAQo6u/M6v1HdViLLu/M6v1HdViJy3lC08Xht6IiIpBWLksS8zPkC1K22JeZnyBalO4eQLobsiIitUkREQhWTREWEWKRNCiICFHV35nV+o7qsRETlvKFp4vDb0RERSCsXJYl5mfIFqURO4eQLobsiIitUkREQhf/2Q==",pc=["className"],mc=Xt(Dt,{name:"MuiTimelineOppositeContent",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[Tl(n.position)]]}})((e=>{let{ownerState:t}=e;return(0,ue.A)({padding:"6px 16px",marginRight:"auto",textAlign:"right",flex:1},"left"===t.position&&{textAlign:"left"})})),bc=t.forwardRef((function(e,n){const i=kl({props:e,name:"MuiTimelineOppositeContent"}),{className:o}=i,r=(0,Ce.A)(i,pc),{position:a}=t.useContext(zl),s=(0,ue.A)({},i,{position:a||"left"}),g=(e=>{const{position:t,classes:n}=e;return fe({root:["root",Tl(t)]},ac,n)})(s);return(0,ce.jsx)(mc,(0,ue.A)({component:"div",className:he(g.root,o),ownerState:s,ref:n},r))}));bc.muiName="TimelineOppositeContent";const fc=bc,yc=il({timelineCard:{"&:hover":{transition:"transform .2s ease-in-out",transform:"scale(1.03)"}},logo:{width:"64px",height:"64px"}}),Gc=[{title:"Software Development Intern",subtitle:"Alida",date:"May 2022 - December 2022",logo:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAAAAAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/2wBDAQMEBAUEBQkFBQkUDQsNFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBT/wAARCABkAGQDASIAAhEBAxEB/8QAHQABAAICAwEBAAAAAAAAAAAAAAUGAwcBAgQICf/EADcQAAEEAgECAwYDBQkAAAAAAAEAAgMEBREGEiEHEzEUIkFRYZFxgaEVI0JSwRYkJjJ0krGy0f/EABkBAQACAwAAAAAAAAAAAAAAAAABBQIDBv/EACkRAAEEAgIBAwMFAQAAAAAAAAEAAgMRBCEFMVESEyJBcYEUYZGh8PH/2gAMAwEAAhEDEQA/AP09REWC1IiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiKM5JmmYDC2rrtF0bfcb/M89mj76WuWRsLHSONACz9gs42GR4jaLJ0Fgo8tp3uRW8PHvz67eovOulx7dQH1Gx+vyU0vnurdvcW5Uyzaa5tuGbrmafVwd3d9wT91vp8dXM48CRjLFSdod0uG2uHqP6LmuG5Z3IMla9tPYTrrR6v/iveU41uC6NzDbXAb739aXlm5NjK92Ck65G61M/oZFGep2/qB6fmsmR5FjcRYjguXYq8sv8Ala92iR8/oPqVqHi9eKDxPbBGwMjjtztYwegA69D9FdudcYwmTvRXsjkxQc1gY5vW3bwCSNA999ytGPy+Vk40krGtDmu9NE0KHZsrdNxuPBMyNzjTm3YFmzdaFq8eqw271fHwukszx14x/HK8NH3K564adYEvbHBG0Dqc7QA/Eqi+JDMRk+M3L9Z1a1ajdG3z4nNe5o6gNbH4nsrzOzDi47pW0XNBNE10LVRiYwyJxG6w0kCwPKt+G5BRzzZ3UZvPZC/y3PDSATrfYn19VIKgeDA/w7c/1R/6MVwmz2MrSGObIVYpB2LXzNB+xKx4/N/UYjMiYgFwvwP7WWZi+zkvhiBIb+Svei6xSMmYHxuD2OGw5p2CuytWuDhbVXV6UREUoip2ad/aPmdHEt96rjx7XaPwL/4Gn77/AAKtd2z7HSsT+W+bymF/lxjbnaG9AfNa14fyKxiDkbF3CZSxeuzmV8kNYlvT8G99emyqHk52B8eO801xt2idDda8mlb4MTvQ+Zu3AUOuzq/wLXTxiwXRLWysbezv3Muvn6tP/I/IKa8JM6MjgH0ZHbnpu6Rv4sPdv27j8gsPJeUHOYS3RPHswHSxkML6vZrh3aT3+YCpvB/2pxnkEViXG3G15B5U393f2afjrXwOiuRklbh8yMjHBMbxTtHV6vrzRXRxsOVxZgmNPZtuxv8A3Sz8fAPiq8EbBuT9v968/iJja2O5eYK0DIISyM9DBobPqvVhq9qt4gHKTULjKRtTSeb7LIfdd1aOunfxC555XtZnlJuU6NyasGsHWKsg3r17Fqp5I3OwXt9Py90ka3XkfWlaxyNGWx1/H26Pi/H3XbxUzFi/yMYxry2vXDB0b7F7gD1H8iAp/nnEcbhuFvkqV2wyw+WDIzs6QdQB6/5vn3+IUL4hcftZDJHN42CeevMAJNQua9j2gDZaQDrQHfXzU5msve5txKapVxVuOx0tfM6VnSzbe5DPi4kjsNKzDS5+a3Ib6nOHw1djdUf4Vf6g1mIYXU1p+W6o6u1HcEryWvDvNRRWmU3vmcBPIelrfcZvZ+AI7b+qxcYgw9LjmVqyuGUuyscXmrXfI2NvT7vv9Oh32d/+KNxFK/c4ZkMTDUtC0bAsdJhcGvYGgFu9a323o+uuymPD+xYq4PI4kY217dM93S50RawbaG+84+gGj/TZWrEcXGCMs6YRZBO96A0LWeQ2hM8O7eDQIGvJPdLjwWyE5s36RcXVxGJWsJ7NdvR1+O/0W1Vp/wANxb47mr0NmhabPLF5bP3Li0PB7bIHYfX0Vl4FmeTZHL24svDI2q1hIdJB5fQ/Y0GnQ2Nb+fp977gc32cWLHla4ucSOuqN78fsqnmMX3ciWeMgNAB77sfTyr2iIu4XJIiIooFTZCIiJQU2URESgllEREoKLKIiJQU2URESgosoiIpRERERERERERERERERERERERERERERERERERERERERERERERERERERERERf//Z",dotColor:"error",isLast:!1,description:"During my time at Alida, I primarily worked on the team's Foundation Effort, which focused on breaking down our monolithic application architecture into a microservices-driven approach. This internship was where I first gained hands-on experience with REST and backend web infrastructure.",bullets:["Rerouted data processing from a monolithic ASP.NET C# application to microservices by implementing RESTful APIs, reducing load and improving scalability.","Ensured stateless authentication on microservices with JWT validation, providing secure API access.","Developed integration tests to ensure data synchronization between the monolith's MSSQL database and the microservices' PostgreSQL databases to ensure smooth deployments.","Enhanced debugging with error and information logging to Kibana, improving system visibility and problem resolution."]},{title:"Web Development Intern",subtitle:"Bank of Canada",date:"September 2021 - April 2022",logo:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAAAAAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/wAALCABkAGQBAREA/8QAHgABAAEEAwEBAAAAAAAAAAAAAAgCBgcJAQMKBQT/xABFEAABAgQEAgQJBwsFAQAAAAABAgMABAUGBwgREgkhEzE5QRQiUWFxdXa0tRU3OHN0srMWGSQyNldigZK20xcjY4KElf/aAAgBAQAAPwDVVCEIQhCEIQhCEIQhCEIQhCEIQi8MOMIb0xdrHyXZVr1S5p3lvbpsqp0NA9RcUBtQPOogeeJzYMcIe5pdMrc+M900Wx7dlFomJundMl95TYIKm3XQpLTQI5bkrXprGZr7yT5VMydGet7A687Zte8ZGaK1OU+fcqCplISoFstOP6lskg9I3roR39UQmxs4bmOmCxmJl+1lXZRWtT8qWyTOICR3qaADqQB1ko0HliMLrK5dxbbiFIcQSlSVDQgjrBEdUIQhCMqZYMGmMwOOlqYezNUcozNbedaVPNMh1TWxhx3UIJAOuzTrHXGxj8xvb/72ql/8Rv8AzRKPKVkvbymWFeFu0O85qqTVedD7VSdp7bapJwNFCVBsqUlehIVorkdNDGHMT+FfVMZqkZ298wN3XK8DuQiek21NNH/jaDgQ2PMlIEWWxwRbXlnkOtYq1ttxCgpK0UxoKBHUQd/IxLTLZlyu7AZ9+Wq2Mdx4h0FUsWWKXXmG1eDubklLiHiVOaBIUnZu2+N1chEXL84M9Evu+bjuV3FGfk3KzUpmoql00ZCw0XnVOFIPTDXTdprp3RgfNbwraPlywGufESWxCna69R/Btsg7S0Mpd6WZaZOqw6ojQOa9XdGu6EIQidnCfy7XFf8AjfTcT6fPUxmh2XPFE/LTLjiZl0vyzyEdEkIKToTz3KT/ADjb5dmPWHljXxSrNuC76XSboqvQ+A0mae2vzHSuFtrYnv3LBSPOIHHzDtOJ/wDpybwpYvjdt+Qem/Steh6bTb9X4/oji1cfMO70vuq2XQrvpdVuull4TtIlntz8uWlht3cnu2rISfOY/HZ+ZbC2/aZcdRty+aPWJG3ZYzlWflX9yZJkJWorcPcNG1n/AKmKaRmYwsrth1m9qdfVHnLTo7qWKhV2pjWXlnFFASlau4kuI/qEczOZjCyTw8lL8fvqjtWdNzRkmK2p/wDRnHxu1bCvL4i/6TFmZocOnc3OVGu25YNapT35TNScxTqpNOrEm42iaZeKtyEKVoUtnTRJ5kemPPhdNuv2lc1Xoc2407NUyceknlsklCltrKFFJIB01SdNQI+PCEI25cDn9hMVvWUj+E7FqZ/+1EwE9Nu/F3oome3FT9pT/b8UZFu1Rx1+uuP4o3GOeHR8yOcX2Lc92n46MvnZSZjPX8l+LIRVenY72B7cO/eno2f5Gvog4R+zsr9yPP8AY1/PJf3r+f8AeHIsuEIRty4HP7CYrespH8J2LUz/APaiYCem3fi70UTPbip+0p/t+KMi3ao46/XXH8UbjHPDo+ZHOL7Fue7T8dGXzspMxnr+S/FkIqvTsd7A9uHfvT0bP8jX0QcI/Z2V+5Hn+xr+eS/vX8/7w5FlwhCNvHBBkphrDvE+aWw4iWeqkoht5SCELUlpe4A9RI3J1HduHlizs/8A2omAnpt34u9FEz24qftKf7fijIt2qOOv11x/FG4xzw6PmRzi+xbnu0/HRl87KTMZ6/kvxZCKr07HewPbh3709Gz/ACNfRBwj9nZX7kaBcdpOYp+NuIEvNMOS0w3cE+FtPIKFJPhDnWDzEWJCESk4adj29iFm5tWhXRRJC4aM/Kz6nafU5dD7DhTKuKSShQIOhAI84jdrdd24Z5UMLF1CoJptiWVTlpQlinSRS0hbjmmiGWUEklStTtSe8nkCY+vMYfYfYjVOjXrM2xbtx1Nptl6m12ZpzMxMNISouNFp5SSpO1RKhoRoSTyMfqOE9km9fyyNn0I3bu3fL/yaz4fr0fR69Pt3/qeJ1/q8uqPi1e3MLcGF13EaeoVsWe9opyqXKmnsy7yw64neXX0pClb3CknUnU6E84xzhPiTlcrtbm7Qw7msPl1K5GVy0zSKHJS7ZqTSW1qW26hCAHEhHSEhWo0KvKYytT8FMPaZa1RtmSsS2pK26itLs7R2KRLolJlYKSFOMhGxZBQnQkH9UeQRy7gth5MWkxarth207a7D5mWqKukS5km3fG1cSyUbArxleMBr4x8pj5Fbxaw0wYuOzMOZqo062ahW98vQ6NKSxbZCWwDtAbTsZTzATu2gnkNdDGFeIVgpYFQy5YpXtM2VQZi72aTvbrzlOaM6lSVISkh7bu1CeQOvVyjQfCES94UBAzs2eSdB4HUfc3Yl3xubQnalh1hrdDG5chSqlNyMwEnUJVMNtqbUR/5ljX+IDviTPDitCcsjJlhrIVLciamZR6pbFnmluYmHH2vR/tuIP84ksCFDUHURGniTfQkxT+xy3vjMaluF59OXDT01D4dMx6AIoLiUnQqAMaR+KFhPXKnnsZlJJtx9+9WKYmmaakFZSmU2D0La1I/iB742X57ZdEjkpxQlUuF0M0LowtR1KtFIGp8/KPPHCEVNrUg6pUUnyg6RUp91wbVOLUPIVExyJl4DQOrA8gUYmnl74pt9ZesIaDh9SbQoFVkKOHw1Nz63+mc6V9x47tqwORcIGg6gI7ceeKrfWPmElx2BVbNt6nU6tNNtOzUmp8uthDqHAU7lkdaAOY74jVl4xrqWXjF6gYhUenylVqNHL5alJ0qDK+lYcZO7aQeQcJGh6wImn+e5xL/d/an9cz/kiHWZDMJWsyeK9SvysSMrSJ+dZYZXKU9a+hSGm0tgjcSeYTqecYtL7ilBRWoqHUSeYjkzDpBBdWQe4qMdUIQhCEIQhCEIQhCEIQhCEIQj/9k=",dotColor:"warning",isLast:!1,description:"As a part of the front-end web team at the Bank of Canada, I contributed to the development and maintenance of six internal and external-facing sites. This internship provided valuable learning opportunities, allowing me to collaborate with experienced developers and solve challenges alongside fellow interns.",bullets:["Assisted in migrating from amCharts 3 to amCharts 4 by updating WordPress components, ensuring seamless functionality and introducing new features.","Developed and executed BDD test cases with Behat, ensuring the functionality of web components.","Helped enable economists to visualize data on a web app using amCharts 4, facilitating research and data analysis.","Improved UX and resolved bugs, enhancing site functionality.","Achieved significant time savings in code review by identifying bugs through thorough quality assurance procedures."]},{title:"Web Development Intern",subtitle:"Institute of Applied Design and Technology Education Society",date:"July 2020 - August 2020",logo:Ac,dotColor:"success",isLast:!1,description:"Similar to my previous internship, I joined a team tasked with building a project from the ground up\u2014this time, a React-based website. It was during this internship that I first gained experience with both React and TypeScript, laying the foundation for my front-end development skills.",bullets:["Developed and documented 10+ core React components, enhancing the website's flexibility with user-adjustable props for diverse use cases.","Assembled webpages using customizable React components and styled them with the Styled Components library.","Improved code coverage for React components, ensuring functionality was preserved during future updates.","Collaborated with the design team to ensure accurate implementation of design mockups."]},{title:"iOS Development Intern",subtitle:"Institute of Applied Design and Technology Education Society",date:"July 2018 - August 2018",logo:Ac,dotColor:"info",isLast:!0,description:"My first internship was with the Institute of Applied Design and Technology Education Society, a new non-profit hosting a mobile app development course and competition. I was part of the team responsible for developing and launching the first iOS version of the companion app for students. I contributed to the development of key app views and wrote scripts to manage our Google Firebase backend.",bullets:["Created a parallax scrolling method that was applied to most views.","Brought design mockups to life using XVode's Storyboard functionality","Ensured layouts functioned on all current iOS devices through software and hardware testing","Wrote scripts that populated and managed our Firestore DB with mock data for development purposes."]}];const vc=function(){const e=yc();let n=Gc.map((t=>(0,ce.jsxs)(Ic,{children:[(0,ce.jsxs)(fc,{"data-aos":"slide-right",children:[(0,ce.jsx)(Dt,{variant:"h6",children:t.date}),(0,ce.jsx)("img",{src:t.logo,className:e.logo})]}),(0,ce.jsxs)(hc,{"data-aos":"fade",children:[(0,ce.jsx)(oc,{color:t.dotColor}),!t.isLast&&(0,ce.jsx)(_l,{})]}),(0,ce.jsx)(ec,{"data-aos":"fade",children:(0,ce.jsx)(mo,{className:e.timelineCard,children:(0,ce.jsx)(Go,{children:(0,ce.jsxs)(Ft,{children:[(0,ce.jsx)(Dt,{sx:{fontWeight:"bold"},variant:"h5",children:t.title}),(0,ce.jsx)(Dt,{variant:"body1",color:"textSecondary",children:t.subtitle}),(0,ce.jsx)(Dt,{gutterBottom:!0,variant:"body1",children:t.description}),t.bullets&&(0,ce.jsxs)(ce.Fragment,{children:[(0,ce.jsx)(Dt,{sx:{fontWeight:"bold"},children:"Work Summary"}),(0,ce.jsx)("ul",{children:t.bullets.map(((e,t)=>(0,ce.jsx)("li",{children:e},t)))})]})]})})})})]},t.date)));return(0,t.useEffect)((()=>{rl().init({duration:1200,delay:100})}),[]),(0,ce.jsx)(Ft,{children:(0,ce.jsx)(Ul,{sx:{[`& .${sc.root}`]:{flex:.2}},children:n})})},Bc=Wt({palette:{mode:"dark"}});const Zc=function(){const e=(0,t.useRef)();return(0,ce.jsx)(ci,{theme:Bc,children:(0,ce.jsxs)("div",{className:"App",children:[(0,ce.jsxs)(Ft,{maxWidth:"xl",children:[(0,ce.jsxs)("div",{style:{height:"100vh",flexDirection:"column",display:"flex",justifyContent:"center"},children:[(0,ce.jsx)(Dt,{variant:"h3",component:"h1",children:"Brad Peng"}),(0,ce.jsx)(Dt,{gutterBottom:!0,variant:"h5",children:"Computer Science, The University of British Columbia (2019 - 2024)"}),(0,ce.jsx)(Ft,{style:{paddingBottom:"16px"},children:(0,ce.jsx)(Dt,{variant:"body1",align:"left",children:"Hi, I'm Brad, a Computer Science graduate from the University of British Columbia. This website outlines my software development journey, which has focused on web and game development. Below, you'll find some information about my past work experiences and some of the projects I made while learning about different tech stacks. Some of my projects even have convenient web demos available, so make sure to check them out if you get a chance!"})}),(0,ce.jsxs)(xn,{justifyContent:"center",container:!0,spacing:1,children:[(0,ce.jsx)(xn,{item:!0,children:(0,ce.jsx)(qn,{target:"_blank",rel:"noopener",href:"https://github.com/BradPeng",children:(0,ce.jsx)(pn,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAjAAAAIwCAMAAACvL6FdAAAC/VBMVEX////8/Pzp6enW1tbAwMCtrKyamZmLiop8e3ttbGxfXV1QT09EQ0NAPj4zMTEsKiolIyMdGxsXFRUtKytFRESbmprX19fq6urx8fHS0tKysbGWlZV7enpiYGBHRkYYFhZIR0fy8vL7+/vd3d22traPjo5raWlJR0cpJydLSUlsamrv7u7DwsJqaWkcGhqXlpbw7+/19fXHxsaUk5NjYWEyMTGVlJTIx8fn5+evrq53dXVCQEAaGBhDQUF4d3epqalvbm43NTVxcHCqqqro6Oi7uro+PDw/PT19fHy8u7vh4eGcm5tXVVUcGxtYVladnJzi4uL+/v7Ozc2DgoI8Ozs9PDzQz8/9/f16eXkxMDDNzc0uLCx+fX3Pzs7c3NyIh4c2NDSko6NNS0sfHR3w8PDT09NubW1wb2/U1NS0tLRPTk61tbX09PSYl5c0MjKZmJjr6+uGhYUmJCQmJSWHhobs7Ozk4+N2dHQeHBze3t4bGRlycXEhHx+lpKS+vr7g4OBgXl729vYwLy/j4+NbWlpdXFwgHh5EQkL5+fnMzMw6OTk7Ojr6+voZFxcqKCi9vLz6+flKSEgnJiYoJiaJiIhZV1ezs7OOjY34+PhpaGjb2trc29vIyMizsrKKiYl5eHj39/dSUVFhX1+4t7e5uLjKysrLy8s6ODhRUFC/v7/z8/NjYmJVU1OQj4+RkJAjISG9vb3m5uZUUlIrKSmVlZVGRUV/fn5mZWXEw8Nta2usq6vJycmFhIRlZGSBf3/a2dk5NzdeXV04NjZOTEyEg4OMi4toZ2dZWFjt7e0vLS3Y2Nh1dHQiICCAf3+SkZGjoqK6ubnGxcXf39+TkpKBgIC3t7fS0dHl5OTBwcGnpqbu7u6op6c1MzOioaEkIiLZ2NhzcnJcW1vCwsKhoKDFxMRBPz9OTU3m5eXV1dV0c3OenZ0wLi6mpaV3dnagoKBTUlJWVFSpqKiCgYGNjIyfn5+rq6uxsLBkY2Ofnp5nZmZaWVmwr6/R0NBMSkqura1uBeqMAAAYhElEQVR4AezBtQHCAAAAsLo77vL/kUxM6N4kwVsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGEUJ2mWF2VVN23XD+P0NA6Lrl3WVVnkqzRZb8Jgxtju9ofj6dxfpn9dFtdTcdjvbsGccH+wSw9ocoVBAAB7bXWcfFibY6xt27Zt27xvjjB6+NF1hkpKTklNS0fvpWdkpiQn+QERXVb2v5yoXFRGXFRqXnY+EDEVGIwmMyov2mSxFgARis3ucBaiegqLiu3+QIRgKyktQy2UlVdUAtdIQVVoNWqpprauAPhE6hsam1B7cc0trcAZ0tbe0Yn66erobgNekB5rbx/qrS/U2gMcIP21A8iGgcEhYBsZHhlFlpSNJAGrSMJYBrJnfCwBGESsORPIpolUK7CFTAZ3Isu6GiaBGWRqegJZNzEzCywgfnPzyIeIhR7QGVlcikZ+LK8sgo7I6to68mVjcwt0QrZ3dpE/u45t0AHZC9tHPuXO7IHmqEsh8qswbA80RLbLC5FvhQfboBGyGtqE/NsN3QINkIKQQxTDYUgBEJX5jQ2gOAaOeoCo6bgGxRIVCEQ1J+EontN6IKoo2IxDEcVtnoHyyMI5iuo8GRRGLi5RZFcXoCCSaJxAsV1bEkEpZKoIxXczBYogt2uFKIP9tVvwHbm7R1k83IGPyOPaE8qjcPMRfEF+OlEuRT/Ba6TtXxPKJu5fG3iH+DeijBp/gTdI3TPK6fkFPEZea1Feg4/gGbL9hjJ72wZPkJd3lNvHC7iN+G0i+ewB95D8LySIX/ngDvKzDKX3n/16VrQrCoMAPHFSnoltNTGqqE4Vq4m7sIp5bdv2Kx7bZ+91tdd8z/BjJuzWDkhhHT8YIT86UIDc6WSCHL8Dyaerm8mkuwuS286TTCWndyIX6XlPSfe+F5JdXwslU0sfJJs9Pko2vn5Ipu0HKdkdvA1JN8DcZBNSyKPrzEcG7yBB6rqZn3QfQYw0lbMQKW9ChPwtZ2FSPoQQ+TvMYsjwX4jmRROjedHErJB5keEu9aOiibrSmhGWRvavgb3ubKGUassdWGsfpXT7YKtNFCc2wU4vKM68gI1G6ynO1I/BPuOvKE69moBtvrZSnGv9Crucm6QbUnMONmmaojsy1QSLvKVbchP22Ev3ZC9sMV1P96R+Gnb4+pliwuevsMHMfYoZ92fgfXcuUUyZvQPPO0sx5yy87uo3ijnfrsLb1m6lmPRsLbzs0RzFrLlH8LB5imkL8K7xAHnXoC1XEARP7OTZto9i27ixbdvmUWzb9rNt2/iPmG81O7W407sf0D23toaNAsQb3zi+tZGOvrs+ZXXb0e8/EPijP7wc3XbtlOvvjkqtznw8Aai4PaIbop4N4Lvi/7OQ1zyr/uIq9X367PV/r0Oke8VssoHrUATkMAVz7g7hF0RMZQl3cFf4lgOIxVCifIlAQOmh9GzX4uZAP6HY4jcwsoXSD5mLWI2gqYBkhmASpbIX0YjQXYKwZVf0CJXCWTGIYTOK6kozO0Fgx6oxbdc2TgC6xLW1U/MNqyDbnQjerTdCiEzXEKBqHX9K3qkI8c80hH0SIPsbyfHFEysSmKrRgeS0S7570R1J4/hHY2UEntQ2pEQMcpaQyfYkM1nSxWzqJobRh2FOEmdS25Cg3/kWTF6WvfaT3y3aexnT2D3AtDJam5J0AkPDh9XRuivyWmXeJK9jHXoK5umERIkwqSDug9hdpX2Wz1lmwug09oHvB52lEuJLHxT5g1o9+AyWR9DAtYNWzyMLUH99yPBlWTcQinQtHWbIQZZ2vLYSnyhK3ZZRIUwmgAJnsGQEWIprZgaeheIeaD1mONk5kwhfZsC6NpM41At6ZrE/kxyxmhicnZPbJy9/ecGmZX9T8Z8v23RweX5en9zCmIBLn2azH45O5HAUsraF98AZNJ5g3ODVnau5xbtQjXU9vqFF44pLtrMfqEuKxxWF+m7VmMxfyiVIB+PkRuIxZj9+HFjH57lMlWL6qSfOUeWRFdyfVBFZGeX8RFUwouotn1U7Eq2p8Kyp0zAMVdyixlEKNQpvEgdWT9FNP+3DUxYPTKxRSI4q4rbeA0bqNIFcqnn4vOnI772V7z9b/Mi9izNm6nrDrd1fN+qftcZqFb+tehyqeeIHHUNwFLYB/lv0/HFUDVlysUx/daXPG9ol/vhO89eIDNZUHKoQ4YOQh4zeNNKzk8vUt/oXdThcNtV3yXXIRKMOsDokOF+adPEEZiptLd7qAqwmsSvvrXSBwXUTIUysLsDqLHR9voNOHtlNRfLlsE7QchAYAQ+d5NrWmAhfvrJ3181xXUsQwDtg5jazLSvMDOYwSC5vWe+tHWZmzkphEkthTszMDjMzMzMzM0e1/z7sUzX3zPl9hK2+PNsDPEKBO0qQWa9SYSN4cToVXkVWTd6ZCu/Ci05U2HkyMupwSnSAF+9R4nBk0+TulGgPL86iRPfJPk4wKTDtqXG4lxNMCoznU0xPingKjEhrZE/zJIp4CozIpGZkzstUGQcvyqjyMrImX0GVg+DFQVSpyCNjSikzHF4Mp0wpMmYvynSGFxtRZi9ky67U6QYvulFnV2TKpRTqAx/6UOg+ZMn7BQrdDh9up1DhfWTILVSaDh+mU+keZEdzI5UOhw+HU6mxGZnRilKj4MMoSrVCZtxNqbvhw92U2gtZsQK1FuXgQW4RtT5wemolh8GDE0mfl/Lqoyk2Gh6MpthR1ciEzaj2ITz4kGqbIRPmU+0ueHAX1eYjC84YTLkdEL8dKDf4DK97HT9C/D6i3gJkQAX1liJ+86lXAfv2ZQAjlkfseo9gAPvCvNsYwjqI3ToM4TZYl/+YIQxB7M5lCA/mYdwmDKGwGLFbXGAIm8C46xjCJ4jfiwxhF9iWm8QALoAHVzGASTmYVsMABubgQW5DBlDj7xlp20Pgw3qd/D0n1VLuqFPgxQ5HUa4Wlg2j3pXw42DqDYNhh1LuU3gyinKHwrDZVNvmEnhSPZxqs2FXnwLFCvvCl331P+E+ni7BbeBNG6odCLOOp9i79fCmZCTFHoZZr1BsJvypGUytV2DVUxSrhEeVFHsKRn1GrfMegEdrnEetz2DU9WlqSuJwal0Po7pQ6rBm+NT8CqW6wKbdqHUTvGpFrcth0p6UqsjDq3wFpfaESStTajP4tRmlVoZJY6k0tgR+LSf+LWHRsbGeRiO4vB8Lg56g0nmT4dlpR1PpifibMyfAt2eodAsMWkqhhuPg2/jBFPocBh1NoTJ49wWFjoq+3qQVvGsVe8HOgRR6bTK8O21R5ENUx1BofyQ3UugYmHMmhaYjmUahM2FOZ+pUVSOZXMWYl5QdQqFbkQAbUmhozCvY+DIS4CQK1UTdbvI+EuCMqBt2dqHOLCTqz/+7wJg309+p5R6mzpswpiLNZsp9SZ062JIvN11QkZaGlufjvUE7D39L8q9R5wyY8lb6Uh3A59R5C6Y8HuCGPplIncdhygUBXhkkn8VbXbtfgJeSyfrU2S/eq+26SFocEe+U5h2UeQRFSTfK3AFTTqDMP5AEOA5PgCVzqXMhkhBX+rmxFjq/gaJkdersBkNmUOcrJCFmAG6GIRdR52kUJV9T5yIY8g11XkUIaTXxN7Huqr4SRcm3se6wfoY6pShKSqlzW6zVsicjhBSYShgyjzrvoChpos48GDI/SGCSd6izFIasYj4wKTCrwJDh5gOT/l89PNY1Jk0oSkpjXWpyuvnH6hSYj2FIV/OBSTVUXWFIFXW+Q1HyMnXOhiH2qxtSYAhDmD4+BrFjCsy/twGKkotTYP69I1GUPJoC8++NQlFSmQLz762FouT7FBir1TcO+uNhSIE6d6MoGUKdEbG+6a1FEuIbXddYA1OFoqRbrIE5n0Jz0SJ5gELnxdobz8vQIvmAQp2jDcwLaJE0RRuYOgptiSTAbtnaWGd6uRAtkjaMdaZ3HIXGoEWyMoXGwZDrKbQXWiSDot0p9CGFzkeL5DUKfQhDviJTK6Jcbyp9BUMWUmkmBFLrquX2hh+o9CXk0lM1f4h3K/cu+EsyMd7d8S9Q6T38JVmN0b5Av4xKj+QBJCUnUOl2GDKUUpcBSD6g1FBYcjaVbgKQfEKlvWHKLCptByD5lEqzYEoHKvUAkAynUgeYch+VGtZFcuxgKv0IU56hVCmSKyn1DExpTam2SEZRqjVMaaLUtkhqKbU1THmKWr3h3RJqDYMpJQVKPQ7vPqNUoQS23EWpn+DdOErdBWN+olT5IfCtz9qRH4EDqPVd6s+UGgBjdqTWj6kZRmpHGDOHWmfPhWdD96bWHBizFcU+gWevUmwrWLOMWu+lYTuhZTCnjGLD4NduFPsC5jxDsWPg1wSKPRP/cyCXVcOryY0UuwnmPES1T+DV41TrBXNKulFs2xx8ylVQrFsJ7LmWaium4qmYZ14/pVoZfJpPtU9hUCvKXQGPnqRcKxg0nnId4NF7lBsPi3am3Bz4s5hyO8OkeZRbJQdvch0pNw8mHUq9zeDNTdRbBybtRL0H58KXod2ptxNMqj+BerfBl12od0IzbJpPvcLr8KTXCOrNh1EbM4C78/BjudUYwAYwqi9D2Bh+PMYQ+sKoXCMDKO8FL/YtZwCr5mDVfQxheD18qO7EEO6DWS8yiO3gw0QG8SLMep9h/AwPbmIYz8OuCgZR9RDi98HZDKIOhn3FMGb1QezWHcswnoFhMxlIWQni1jyFgcyEYfnuDGT/HGKWa8dAuudh2cMM5RjE7FGG8iFMW8xgHkO8FjKYJphW/RqD+cbdFwGB16ph2/UMp7+3vAhcD+N+ZkBtEKHcBAa0GYyb/AgDqlwOsWlemQFVnQbrbmRI95+GuPRZypBuhHlzGFTH4xCTp7ZhUHNg3nLdGdSqayIeTxzFoLovB/u2Y1gNG+cQh/wFDGw7ZMBzDO3M3ojBcbMZ2j+RBXUMbdVpyL4tuzK02kjecwv8wd5deLdVhnEc/6VF5jv9zYeEhXV6CA7zrTsTbJLRQ3Bti823eqHMNZAZLnN3x525uzs2N9wqtGuq9yY3b668n7/hm1x/ntbVYWzVfmXwzYUhhDkZfJV+gYG59/Vm8KWEwRh+pQgr0mFUP9anCLNgEIcpRMTWGBhRm9YeCnEYBuGKohhj7h0Jo+n6fhrFiHLBKBZTlKinvMbKZf0YinIrDGNlBwrz0CkvjCLmjTEUpkM8jOM7qjPYSf89ErkbRrD56rUU6DsYyMNU6tXSG6a0GQr0/OviuelJ9E/ST+HQOfdlg+wUahiM5Gkq0tv3FOTNy1pUon/qvtQV+rXjfHcK9jcM5UUqEbEa+dnajqN/1rbaaYMeVT97n4fCPQ9DcX/l/6jvH29oRv9UenCqG/pSq/HEDgyBKDeM5Wcq8DQK93lH+qti6sbx0IuETmecDI2fYTD9RrNk9tUoQtvu9NszK7qtRsh1nXx1NENm9M0wmr5U4GkH8vmof+/ZhwF0TWUgVt1w5G0XQqXhxnP1UxhKvWA4YUlUINUFX5WY4R9k2NiHgalXZs7O6hDM+9iFVtF2hlhSGIynFJVo4oKP6czwFTKll2fA7MOXzX2tEYSodrhb6eYdqAelYEBtkqjErH7Ia/OTJK9FlptfoTb6/N36xrYH3kSQNPzrvTta1e9N3UhqAyMqRUWGXI+8xrcs1XcBstlSqaVH/r5h7K6jDminWpVSZZrOo96UAkz8F8O0lijS/fr+QNt1jlqRfzBAKSr0VpiwYi5AW2NJ+Qcj+i+GnNfJjXx+vvbLy5ChCbUUCa09Kv9gtFOKir2wAz6q5kydsk2kdp6F5mxl5B+MZlbup2JjDheyirc2gPGVqZXrvNBe1+HUlf3xMK45VM5zwac1Z+6W0B8qUhv770EwhEdQTyJhYOOPU4VPkMcnzHAcmQ57qIk94tf+iLdqPIxsF9Vo4UIu20+XXjPsSy2cQZDYrqV+nIChuctTjauRxwNz7u2HLCObMnDOtxEsXezUi/ZuGNtrmjxljW2m79EXcdSLu2F0s6nKkWANPk5bieBJcFIfFsLwDqRQDc98FObm2xmg+w0yAV2uVP2MqvTeDF83NUKGjQxMRDUEU7qdGpFLm2euoirH+iGvK5qx6dTAJ0bHIbjKUCtyLXzjQO7fj48g2WE5cNNxXQ/v2kkdaAxzmBDAJzUDmOn4eOCwnf4rjyBz386Qm4Bcljrv5Zg2yDVyMHPe8r2S/luMYOsrz3i1s5XqlClw/bEOgGsg/ZaAYAuXZ7za6fcV1amNXPEP5a6liImmnyoj+J5kaH3VD+axier0n4lcyc3J/enItOM4/TMWwbeUobUcZnKS6qzDJe6dF9sgW3g9+mUKgu9uhlQiTKXWQ1TFeQ98BVRMmgPB19XJEHqoFszlZY02iYVXpHqzIUJd+dBRS6WpThcUrvMIfZ7CAA8ydD6E6cSsoiodUUDVTfEAYsZRrUkQ4SOGzKrdMJ8ZAc5oc/1KepaFAe7zHqqTABHCGTLzYUYfUJVB8DWVmfpvBjBsONVIgxDeZgyRFjCl8SOoSix8tGWWpg4Ab37SgcpNhxhfMDRG9IM5PdchkBO5RnZmqYlM6ROp0MIXbRDjD4ZEhxowqypUo0NP+Ijz/f898Hszlijq284QZg1DogdMy/UH1TgPH7WGMNM3yPHD2AosTvknYiFSJENhhQvmtfI4VTjugI+Zpe1kvc24xDXlXHkWam/plgsg2AmGwPGVMLMpKVThPeSTcPnFlcin56S+ZYYnMYfnobKl11/WECEwieI1exfmtli7V8iSY9sg1+7ruxw9emdserWRCJk7Kd4WmJzrFY0WLNz5Bcn2Z10o2sz35kbe7YUwVSncly6YXa1pmjw17NqbWeq4UQTXrWuZIeptiNKZon1RHea3Oo3KTS7x17wPuaq+1OOjRsjRi9kmmDeYtKqwgveoXNSbKNzQRcz2Jf6XUJYZPE28+V5POQ5R2lCwX2ANY6ncOhThNafvgC7HCN93oeP5vyYQJYZi9YVFuMpQMfstKMID05nhdAyyPcb/fYVsqcyyop9ZgxnkhlXMLE/FKtyEovzQ9vnPkSOsWb5jlO3E6QrTbtvmgkmDaTcT1jGgIhVbYYMinTzMtPce+DJpMIsGwEq6PEPFlkKZ505e13Rgp36wRDBJw2At79mpWBUYQwLFqQmr6UblzsIQOlOYq2A9paiY54gMxsfVsCD3LCp3qwwmj9tssCLvQirXxCGDyXHaC2uauYTKvRAmg8lWrhasKj6ayj0yXwaTaVo8rOuHKKrwwUzIYJ78AVaWfpwq9K9t+WCOJ8PakldRjdN/WTuYep/D6tROfPm0hoWDqRcOtWQx7Hi328DBiO9FFsPbz2+2VDCyF1/Jx6laufU/uqDIyOdGmiOY46vhP1kMWanBvlgHitNw6qnUJR0YY/xgfK+PpB1R9M8zo+K21N4e5oaP6p9f1jIy7u/RzNbQDMFEdcYlUnx5BsJTKbpc2UNlMkyv/MWiJPrqbIJg2ochL6l6fWpMfDDpDJq6N8GX1O+Q4YOJZbCs6If8JNuzMpgixDlQkOR6XwZTqF4uFEra5ZTBFJDyFKSi7Nwvg8ln/8uQinaguwzGR4VwFEda+T0197lxg3m6J4oneVtTa7GGDSbOixJJvzllMFlS7oWkxC2LZDAZ6i2HpMwPoyiDuTYBklLeBy0fzEkvVJD+XGvpYNI+gjrS9c0tHMyxt6GWNLSFZYNZ8yYkP2wbQ00cNVYwo1+E5J9GZwwVzFFq4fQCSP5y9YiwWDARi90IgPT2EksFM6QqAiM5vnVaJpiUK0ciYFLVURYJ5tpwSFpwV0mzQDCDu9kgaSRhnOmDOXMPJA1drEe/zdd/MKPPQtLW7jUe+qm23oOxp8ZD0lyNp00azKgHEAyS6+Ijug5mG/2xaI8LQSLNPOfUcTC1qV7Ko7UQRNLjt5kqmIlvI8ikLtNNE8zXUyCAdPcxUwTTbjLEkNwXuxs+mId2uSGM5D2lIpmz+gvmoVNeCCU59kRRoT16CybqiBfCSY7Low0ZTNQeB6SQcDceoqdzmI1UoHxjB6TQ2VTGzpL8BTF+ZEnsA3dCCrHkD9JYrIihEMPxDIv1TOI7kHQg5o6HWIxBEOUaFmNV5G5IOmGbfKgZizIDolzGothX1HZA0pNG529noe6DOLNZqP5XDoCkO+6Xr0lhAccbQZwfXmUBnkOTbZD0aeWpr+lrbzJECr+dvure2xOSniWsP8ZczjUxopNt5WGu6Mh0SPq3+pMX+kcw4qFxNy6AeJ3nLnyEdK4qey4WkuX91x4cCwAAAAAM8reexa4KAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4ESkReJY8+4+aAAAAAElFTkSuQmCC"})})}),(0,ce.jsx)(xn,{item:!0,children:(0,ce.jsx)(qn,{target:"_blank",rel:"noopener",href:"https://www.linkedin.com/in/brad-peng-165206214/",children:(0,ce.jsx)(pn,{style:{backgroundColor:"white"},src:Ci})})})]}),(0,ce.jsx)("div",{style:{width:50,textAlign:"center",position:"absolute",bottom:50,right:0,left:0,marginLeft:"auto",marginRight:"auto",cursor:"pointer"},children:(0,ce.jsx)(qn,{onClick:()=>{var t;t=e,window.scrollTo({behavior:"smooth",top:t.current.offsetTop})},children:(0,ce.jsx)(pn,{src:Ii})})})]}),(0,ce.jsx)("div",{ref:e,style:{paddingTop:75},id:"work"}),(0,ce.jsx)(vc,{}),(0,ce.jsx)(Fl,{})]}),(0,ce.jsxs)(Ft,{style:{paddingBottom:"250px"},children:[(0,ce.jsx)(Dt,{variant:"h3",component:"h1",children:"Volunteer Work"}),(0,ce.jsx)(qn,{target:"_blank",rel:"noopener",href:"https://gameofapps.org/",gutterBottom:!0,variant:"h4",children:"Game of Apps (2020 - Present)"}),(0,ce.jsx)(Dt,{style:{paddingTop:40},align:"left",variant:"body1",children:"The Game of Apps program is a course available to public school students in the Greater Vancouver Area. The program's mission statement is to introduce real-world technology design and development to students and create interest in STEM fields. I have volunteered in both the senior and junior programs. The senior program teaches app design and development through Java and Android studio. I scripted and recorded lessons for the students and directly mentored one of the teams during the program. The junior program is a lot lighter and only teaches programming fundamentals. I spend my time during and after lectures answering student questions about basic coding principles and the Swift language."})]})]})})},wc=n.p+"static/media/rengoku.af5b8184489bfa521cab.jpg";const Wc=function(){return(0,ce.jsxs)("div",{children:["RENGOKU SAAAAAAAAAAAAAAN",(0,ce.jsx)("br",{}),(0,ce.jsx)("img",{style:{height:"100vh",width:"100%"},src:wc})]})};var Sc=n(295),Rc=n(9408),xc=Object.defineProperty,Vc=(e,t,n)=>(((e,t,n)=>{t in e?xc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!==typeof t?t+"":t,n),n);const Xc=new Rc.Ray,Hc=new Rc.Plane,Yc=Math.cos(Math.PI/180*70),Kc=(e,t)=>(e%t+t)%t;class Nc extends Rc.EventDispatcher{constructor(e,t){super(),Vc(this,"object"),Vc(this,"domElement"),Vc(this,"enabled",!0),Vc(this,"target",new Rc.Vector3),Vc(this,"minDistance",0),Vc(this,"maxDistance",1/0),Vc(this,"minZoom",0),Vc(this,"maxZoom",1/0),Vc(this,"minPolarAngle",0),Vc(this,"maxPolarAngle",Math.PI),Vc(this,"minAzimuthAngle",-1/0),Vc(this,"maxAzimuthAngle",1/0),Vc(this,"enableDamping",!1),Vc(this,"dampingFactor",.05),Vc(this,"enableZoom",!0),Vc(this,"zoomSpeed",1),Vc(this,"enableRotate",!0),Vc(this,"rotateSpeed",1),Vc(this,"enablePan",!0),Vc(this,"panSpeed",1),Vc(this,"screenSpacePanning",!0),Vc(this,"keyPanSpeed",7),Vc(this,"zoomToCursor",!1),Vc(this,"autoRotate",!1),Vc(this,"autoRotateSpeed",2),Vc(this,"reverseOrbit",!1),Vc(this,"reverseHorizontalOrbit",!1),Vc(this,"reverseVerticalOrbit",!1),Vc(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),Vc(this,"mouseButtons",{LEFT:Rc.MOUSE.ROTATE,MIDDLE:Rc.MOUSE.DOLLY,RIGHT:Rc.MOUSE.PAN}),Vc(this,"touches",{ONE:Rc.TOUCH.ROTATE,TWO:Rc.TOUCH.DOLLY_PAN}),Vc(this,"target0"),Vc(this,"position0"),Vc(this,"zoom0"),Vc(this,"_domElementKeyEvents",null),Vc(this,"getPolarAngle"),Vc(this,"getAzimuthalAngle"),Vc(this,"setPolarAngle"),Vc(this,"setAzimuthalAngle"),Vc(this,"getDistance"),Vc(this,"listenToKeyEvents"),Vc(this,"stopListenToKeyEvents"),Vc(this,"saveState"),Vc(this,"reset"),Vc(this,"update"),Vc(this,"connect"),Vc(this,"dispose"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>l.phi,this.getAzimuthalAngle=()=>l.theta,this.setPolarAngle=e=>{let t=Kc(e,2*Math.PI),i=l.phi;i<0&&(i+=2*Math.PI),t<0&&(t+=2*Math.PI);let o=Math.abs(t-i);2*Math.PI-o<o&&(t<i?t+=2*Math.PI:i+=2*Math.PI),c.phi=t-i,n.update()},this.setAzimuthalAngle=e=>{let t=Kc(e,2*Math.PI),i=l.theta;i<0&&(i+=2*Math.PI),t<0&&(t+=2*Math.PI);let o=Math.abs(t-i);2*Math.PI-o<o&&(t<i?t+=2*Math.PI:i+=2*Math.PI),c.theta=t-i,n.update()},this.getDistance=()=>n.object.position.distanceTo(n.target),this.listenToKeyEvents=e=>{e.addEventListener("keydown",_),this._domElementKeyEvents=e},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",_),this._domElementKeyEvents=null},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(i),n.update(),s=a.NONE},this.update=(()=>{const t=new Rc.Vector3,o=new Rc.Vector3(0,1,0),r=(new Rc.Quaternion).setFromUnitVectors(e.up,o),u=r.clone().invert(),d=new Rc.Vector3,h=new Rc.Quaternion,A=2*Math.PI;return function(){const p=n.object.position;r.setFromUnitVectors(e.up,o),u.copy(r).invert(),t.copy(p).sub(n.target),t.applyQuaternion(r),l.setFromVector3(t),n.autoRotate&&s===a.NONE&&S(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(l.theta+=c.theta*n.dampingFactor,l.phi+=c.phi*n.dampingFactor):(l.theta+=c.theta,l.phi+=c.phi);let m=n.minAzimuthAngle,b=n.maxAzimuthAngle;isFinite(m)&&isFinite(b)&&(m<-Math.PI?m+=A:m>Math.PI&&(m-=A),b<-Math.PI?b+=A:b>Math.PI&&(b-=A),l.theta=m<=b?Math.max(m,Math.min(b,l.theta)):l.theta>(m+b)/2?Math.max(m,l.theta):Math.min(b,l.theta)),l.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,l.phi)),l.makeSafe(),!0===n.enableDamping?n.target.addScaledVector(C,n.dampingFactor):n.target.add(C),n.zoomToCursor&&B||n.object.isOrthographicCamera?l.radius=N(l.radius):l.radius=N(l.radius*I),t.setFromSpherical(l),t.applyQuaternion(u),p.copy(n.target).add(t),n.object.matrixAutoUpdate||n.object.updateMatrix(),n.object.lookAt(n.target),!0===n.enableDamping?(c.theta*=1-n.dampingFactor,c.phi*=1-n.dampingFactor,C.multiplyScalar(1-n.dampingFactor)):(c.set(0,0,0),C.set(0,0,0));let f=!1;if(n.zoomToCursor&&B){let i=null;if(n.object instanceof Rc.PerspectiveCamera&&n.object.isPerspectiveCamera){const e=t.length();i=N(e*I);const o=e-i;n.object.position.addScaledVector(G,o),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){const e=new Rc.Vector3(v.x,v.y,0);e.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/I)),n.object.updateProjectionMatrix(),f=!0;const o=new Rc.Vector3(v.x,v.y,0);o.unproject(n.object),n.object.position.sub(o).add(e),n.object.updateMatrixWorld(),i=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;null!==i&&(n.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(i).add(n.object.position):(Xc.origin.copy(n.object.position),Xc.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(Xc.direction))<Yc?e.lookAt(n.target):(Hc.setFromNormalAndCoplanarPoint(n.object.up,n.target),Xc.intersectPlane(Hc,n.target))))}else n.object instanceof Rc.OrthographicCamera&&n.object.isOrthographicCamera&&(f=1!==I,f&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/I)),n.object.updateProjectionMatrix()));return I=1,B=!1,!!(f||d.distanceToSquared(n.object.position)>g||8*(1-h.dot(n.object.quaternion))>g)&&(n.dispatchEvent(i),d.copy(n.object.position),h.copy(n.object.quaternion),f=!1,!0)}})(),this.connect=e=>{n.domElement=e,n.domElement.style.touchAction="none",n.domElement.addEventListener("contextmenu",j),n.domElement.addEventListener("pointerdown",U),n.domElement.addEventListener("pointercancel",P),n.domElement.addEventListener("wheel",Q)},this.dispose=()=>{var e,t,i,o,r,a;n.domElement&&(n.domElement.style.touchAction="auto"),null==(e=n.domElement)||e.removeEventListener("contextmenu",j),null==(t=n.domElement)||t.removeEventListener("pointerdown",U),null==(i=n.domElement)||i.removeEventListener("pointercancel",P),null==(o=n.domElement)||o.removeEventListener("wheel",Q),null==(r=n.domElement)||r.ownerDocument.removeEventListener("pointermove",D),null==(a=n.domElement)||a.ownerDocument.removeEventListener("pointerup",P),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",_)};const n=this,i={type:"change"},o={type:"start"},r={type:"end"},a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=a.NONE;const g=1e-6,l=new Rc.Spherical,c=new Rc.Spherical;let I=1;const C=new Rc.Vector3,u=new Rc.Vector2,d=new Rc.Vector2,h=new Rc.Vector2,A=new Rc.Vector2,p=new Rc.Vector2,m=new Rc.Vector2,b=new Rc.Vector2,f=new Rc.Vector2,y=new Rc.Vector2,G=new Rc.Vector3,v=new Rc.Vector2;let B=!1;const Z=[],w={};function W(){return Math.pow(.95,n.zoomSpeed)}function S(e){n.reverseOrbit||n.reverseHorizontalOrbit?c.theta+=e:c.theta-=e}function R(e){n.reverseOrbit||n.reverseVerticalOrbit?c.phi+=e:c.phi-=e}const x=(()=>{const e=new Rc.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),C.add(e)}})(),V=(()=>{const e=new Rc.Vector3;return function(t,i){!0===n.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),C.add(e)}})(),X=(()=>{const e=new Rc.Vector3;return function(t,i){const o=n.domElement;if(o&&n.object instanceof Rc.PerspectiveCamera&&n.object.isPerspectiveCamera){const r=n.object.position;e.copy(r).sub(n.target);let a=e.length();a*=Math.tan(n.object.fov/2*Math.PI/180),x(2*t*a/o.clientHeight,n.object.matrix),V(2*i*a/o.clientHeight,n.object.matrix)}else o&&n.object instanceof Rc.OrthographicCamera&&n.object.isOrthographicCamera?(x(t*(n.object.right-n.object.left)/n.object.zoom/o.clientWidth,n.object.matrix),V(i*(n.object.top-n.object.bottom)/n.object.zoom/o.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}})();function H(e){n.object instanceof Rc.PerspectiveCamera&&n.object.isPerspectiveCamera||n.object instanceof Rc.OrthographicCamera&&n.object.isOrthographicCamera?I/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function Y(e){n.object instanceof Rc.PerspectiveCamera&&n.object.isPerspectiveCamera||n.object instanceof Rc.OrthographicCamera&&n.object.isOrthographicCamera?I*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function K(e){if(!n.zoomToCursor||!n.domElement)return;B=!0;const t=n.domElement.getBoundingClientRect(),i=e.clientX-t.left,o=e.clientY-t.top,r=t.width,a=t.height;v.x=i/r*2-1,v.y=-o/a*2+1,G.set(v.x,v.y,1).unproject(n.object).sub(n.object.position).normalize()}function N(e){return Math.max(n.minDistance,Math.min(n.maxDistance,e))}function M(e){u.set(e.clientX,e.clientY)}function F(e){A.set(e.clientX,e.clientY)}function k(){if(1==Z.length)u.set(Z[0].pageX,Z[0].pageY);else{const e=.5*(Z[0].pageX+Z[1].pageX),t=.5*(Z[0].pageY+Z[1].pageY);u.set(e,t)}}function z(){if(1==Z.length)A.set(Z[0].pageX,Z[0].pageY);else{const e=.5*(Z[0].pageX+Z[1].pageX),t=.5*(Z[0].pageY+Z[1].pageY);A.set(e,t)}}function L(){const e=Z[0].pageX-Z[1].pageX,t=Z[0].pageY-Z[1].pageY,n=Math.sqrt(e*e+t*t);b.set(0,n)}function T(e){if(1==Z.length)d.set(e.pageX,e.pageY);else{const t=q(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);d.set(n,i)}h.subVectors(d,u).multiplyScalar(n.rotateSpeed);const t=n.domElement;t&&(S(2*Math.PI*h.x/t.clientHeight),R(2*Math.PI*h.y/t.clientHeight)),u.copy(d)}function E(e){if(1==Z.length)p.set(e.pageX,e.pageY);else{const t=q(e),n=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);p.set(n,i)}m.subVectors(p,A).multiplyScalar(n.panSpeed),X(m.x,m.y),A.copy(p)}function J(e){const t=q(e),i=e.pageX-t.x,o=e.pageY-t.y,r=Math.sqrt(i*i+o*o);f.set(0,r),y.set(0,Math.pow(f.y/b.y,n.zoomSpeed)),H(y.y),b.copy(f)}function U(e){var t,i;!1!==n.enabled&&(0===Z.length&&(null==(t=n.domElement)||t.ownerDocument.addEventListener("pointermove",D),null==(i=n.domElement)||i.ownerDocument.addEventListener("pointerup",P)),function(e){Z.push(e)}(e),"touch"===e.pointerType?function(e){switch(O(e),Z.length){case 1:switch(n.touches.ONE){case Rc.TOUCH.ROTATE:if(!1===n.enableRotate)return;k(),s=a.TOUCH_ROTATE;break;case Rc.TOUCH.PAN:if(!1===n.enablePan)return;z(),s=a.TOUCH_PAN;break;default:s=a.NONE}break;case 2:switch(n.touches.TWO){case Rc.TOUCH.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;n.enableZoom&&L(),n.enablePan&&z(),s=a.TOUCH_DOLLY_PAN;break;case Rc.TOUCH.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;n.enableZoom&&L(),n.enableRotate&&k(),s=a.TOUCH_DOLLY_ROTATE;break;default:s=a.NONE}break;default:s=a.NONE}s!==a.NONE&&n.dispatchEvent(o)}(e):function(e){let t;switch(e.button){case 0:t=n.mouseButtons.LEFT;break;case 1:t=n.mouseButtons.MIDDLE;break;case 2:t=n.mouseButtons.RIGHT;break;default:t=-1}switch(t){case Rc.MOUSE.DOLLY:if(!1===n.enableZoom)return;!function(e){K(e),b.set(e.clientX,e.clientY)}(e),s=a.DOLLY;break;case Rc.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;F(e),s=a.PAN}else{if(!1===n.enableRotate)return;M(e),s=a.ROTATE}break;case Rc.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enableRotate)return;M(e),s=a.ROTATE}else{if(!1===n.enablePan)return;F(e),s=a.PAN}break;default:s=a.NONE}s!==a.NONE&&n.dispatchEvent(o)}(e))}function D(e){!1!==n.enabled&&("touch"===e.pointerType?function(e){switch(O(e),s){case a.TOUCH_ROTATE:if(!1===n.enableRotate)return;T(e),n.update();break;case a.TOUCH_PAN:if(!1===n.enablePan)return;E(e),n.update();break;case a.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&J(e),n.enablePan&&E(e)}(e),n.update();break;case a.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&J(e),n.enableRotate&&T(e)}(e),n.update();break;default:s=a.NONE}}(e):function(e){if(!1===n.enabled)return;switch(s){case a.ROTATE:if(!1===n.enableRotate)return;!function(e){d.set(e.clientX,e.clientY),h.subVectors(d,u).multiplyScalar(n.rotateSpeed);const t=n.domElement;t&&(S(2*Math.PI*h.x/t.clientHeight),R(2*Math.PI*h.y/t.clientHeight)),u.copy(d),n.update()}(e);break;case a.DOLLY:if(!1===n.enableZoom)return;!function(e){f.set(e.clientX,e.clientY),y.subVectors(f,b),y.y>0?H(W()):y.y<0&&Y(W()),b.copy(f),n.update()}(e);break;case a.PAN:if(!1===n.enablePan)return;!function(e){p.set(e.clientX,e.clientY),m.subVectors(p,A).multiplyScalar(n.panSpeed),X(m.x,m.y),A.copy(p),n.update()}(e)}}(e))}function P(e){var t,i,o;!function(e){delete w[e.pointerId];for(let t=0;t<Z.length;t++)if(Z[t].pointerId==e.pointerId)return void Z.splice(t,1)}(e),0===Z.length&&(null==(t=n.domElement)||t.releasePointerCapture(e.pointerId),null==(i=n.domElement)||i.ownerDocument.removeEventListener("pointermove",D),null==(o=n.domElement)||o.ownerDocument.removeEventListener("pointerup",P)),n.dispatchEvent(r),s=a.NONE}function Q(e){!1===n.enabled||!1===n.enableZoom||s!==a.NONE&&s!==a.ROTATE||(e.preventDefault(),n.dispatchEvent(o),function(e){K(e),e.deltaY<0?Y(W()):e.deltaY>0&&H(W()),n.update()}(e),n.dispatchEvent(r))}function _(e){!1!==n.enabled&&!1!==n.enablePan&&function(e){let t=!1;switch(e.code){case n.keys.UP:X(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:X(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:X(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:X(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function j(e){!1!==n.enabled&&e.preventDefault()}function O(e){let t=w[e.pointerId];void 0===t&&(t=new Rc.Vector2,w[e.pointerId]=t),t.set(e.pageX,e.pageY)}function q(e){const t=e.pointerId===Z[0].pointerId?Z[1]:Z[0];return w[t.pointerId]}void 0!==t&&this.connect(t),this.update()}}const Mc=t.forwardRef(((e,n)=>{let{makeDefault:i,camera:o,regress:r,domElement:a,enableDamping:s=!0,onChange:g,onStart:l,onEnd:c,...I}=e;const C=(0,Sc.yk)((e=>e.invalidate)),u=(0,Sc.yk)((e=>e.camera)),d=(0,Sc.yk)((e=>e.gl)),h=(0,Sc.yk)((e=>e.events)),A=(0,Sc.yk)((e=>e.set)),p=(0,Sc.yk)((e=>e.get)),m=(0,Sc.yk)((e=>e.performance)),b=o||u,f=a||h.connected||d.domElement,y=t.useMemo((()=>new Nc(b)),[b]);return(0,Sc.j$)((()=>{y.enabled&&y.update()})),t.useEffect((()=>(y.connect(f),()=>{y.dispose()})),[f,r,y,C]),t.useEffect((()=>{const e=e=>{C(),r&&m.regress(),g&&g(e)};return y.addEventListener("change",e),l&&y.addEventListener("start",l),c&&y.addEventListener("end",c),()=>{l&&y.removeEventListener("start",l),c&&y.removeEventListener("end",c),y.removeEventListener("change",e)}}),[g,l,c]),t.useEffect((()=>{if(i){const e=p().controls;return A({controls:y}),()=>A({controls:e})}}),[i,y]),t.createElement("primitive",(0,ue.A)({ref:n,object:y,enableDamping:s},I))}));class Fc extends Rc.ShaderMaterial{constructor(){super({uniforms:{time:{value:0},fade:{value:1}},vertexShader:"\n      uniform float time;\n      attribute float size;\n      varying vec3 vColor;\n      void main() {\n        vColor = color;\n        vec4 mvPosition = modelViewMatrix * vec4(position, 0.5);\n        gl_PointSize = size * (30.0 / -mvPosition.z) * (3.0 + sin(mvPosition.x + 2.0 * time + 100.0));\n        gl_Position = projectionMatrix * mvPosition;\n      }",fragmentShader:"\n      uniform sampler2D pointTexture;\n      uniform float fade;\n      varying vec3 vColor;\n      void main() {\n        float opacity = 1.0;\n        if (fade == 1.0) {\n          float d = distance(gl_PointCoord, vec2(0.5, 0.5));\n          opacity = 1.0 / (1.0 + exp(16.0 * (d - 0.25)));\n        }\n        gl_FragColor = vec4(vColor, opacity);\n\n        #include <tonemapping_fragment>\n\t      #include <encodings_fragment>\n      }"})}}const kc=e=>(new Rc.Vector3).setFromSpherical(new Rc.Spherical(e,Math.acos(1-2*Math.random()),2*Math.random()*Math.PI)),zc=t.forwardRef(((e,n)=>{let{radius:i=100,depth:o=50,count:r=5e3,saturation:a=0,factor:s=4,fade:g=!1}=e;const l=t.useRef(),[c,I,C]=t.useMemo((()=>{const e=[],t=[],n=Array.from({length:r},(()=>(.5+.5*Math.random())*s)),g=new Rc.Color;let l=i+o;const c=o/r;for(let i=0;i<r;i++)l-=c*Math.random(),e.push(...kc(l).toArray()),g.setHSL(i/r,a,.9),t.push(g.r,g.g,g.b);return[new Float32Array(e),new Float32Array(t),new Float32Array(n)]}),[r,o,s,i,a]);(0,Sc.j$)((e=>l.current&&(l.current.uniforms.time.value=e.clock.getElapsedTime())));const[u]=t.useState((()=>new Fc));return t.createElement("points",{ref:n},t.createElement("bufferGeometry",{attach:"geometry"},t.createElement("bufferAttribute",{attachObject:["attributes","position"],args:[c,3]}),t.createElement("bufferAttribute",{attachObject:["attributes","color"],args:[I,3]}),t.createElement("bufferAttribute",{attachObject:["attributes","size"],args:[C,1]})),t.createElement("primitive",{dispose:void 0,ref:l,object:u,attach:"material",blending:Rc.AdditiveBlending,"uniforms-fade-value":g,transparent:!0,vertexColors:!0}))}));var Lc=n(8055);const Tc=n.p+"static/media/bruce.ac1bf32c395915ca0565.JPG",Ec={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};const Jc=new class{constructor(e,t,n){const i=this;let o,r=!1,a=0,s=0;const g=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){s++,!1===r&&void 0!==i.onStart&&i.onStart(e,a,s),r=!0},this.itemEnd=function(e){a++,void 0!==i.onProgress&&i.onProgress(e,a,s),a===s&&(r=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return o?o(e):e},this.setURLModifier=function(e){return o=e,this},this.addHandler=function(e,t){return g.push(e,t),this},this.removeHandler=function(e){const t=g.indexOf(e);return-1!==t&&g.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=g.length;t<n;t+=2){const n=g[t],i=g[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null}}};class Uc{constructor(e){this.manager=void 0!==e?e:Jc,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(i,o){n.load(e,i,t,o)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;function Dc(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}class Pc extends Uc{constructor(e){super(e)}load(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,r=Ec.get(e);if(void 0!==r)return o.manager.itemStart(e),setTimeout((function(){t&&t(r),o.manager.itemEnd(e)}),0),r;const a=Dc("img");function s(){l(),Ec.add(e,this),t&&t(this),o.manager.itemEnd(e)}function g(t){l(),i&&i(t),o.manager.itemError(e),o.manager.itemEnd(e)}function l(){a.removeEventListener("load",s,!1),a.removeEventListener("error",g,!1)}return a.addEventListener("load",s,!1),a.addEventListener("error",g,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),o.manager.itemStart(e),a.src=e,a}}class Qc{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}const _c=1001,jc=[];for(let n=0;n<256;n++)jc[n]=(n<16?"0":"")+n.toString(16);Math.PI,Math.PI;function Oc(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(jc[255&e]+jc[e>>8&255]+jc[e>>16&255]+jc[e>>24&255]+"-"+jc[255&t]+jc[t>>8&255]+"-"+jc[t>>16&15|64]+jc[t>>24&255]+"-"+jc[63&n|128]+jc[n>>8&255]+"-"+jc[n>>16&255]+jc[n>>24&255]+jc[255&i]+jc[i>>8&255]+jc[i>>16&255]+jc[i>>24&255]).toUpperCase()}function qc(e,t,n){return Math.max(t,Math.min(n,e))}function $c(e,t){return(e%t+t)%t}function eI(e,t,n){return(1-n)*e+n*t}class tI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),o=this.x-e.x,r=this.y-e.y;return this.x=o*n-r*i+e.x,this.y=o*i+r*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}tI.prototype.isVector2=!0;class nI{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,o,r,a,s,g){const l=this.elements;return l[0]=e,l[1]=i,l[2]=a,l[3]=t,l[4]=o,l[5]=s,l[6]=n,l[7]=r,l[8]=g,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,o=this.elements,r=n[0],a=n[3],s=n[6],g=n[1],l=n[4],c=n[7],I=n[2],C=n[5],u=n[8],d=i[0],h=i[3],A=i[6],p=i[1],m=i[4],b=i[7],f=i[2],y=i[5],G=i[8];return o[0]=r*d+a*p+s*f,o[3]=r*h+a*m+s*y,o[6]=r*A+a*b+s*G,o[1]=g*d+l*p+c*f,o[4]=g*h+l*m+c*y,o[7]=g*A+l*b+c*G,o[2]=I*d+C*p+u*f,o[5]=I*h+C*m+u*y,o[8]=I*A+C*b+u*G,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],o=e[3],r=e[4],a=e[5],s=e[6],g=e[7],l=e[8];return t*r*l-t*a*g-n*o*l+n*a*s+i*o*g-i*r*s}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],o=e[3],r=e[4],a=e[5],s=e[6],g=e[7],l=e[8],c=l*r-a*g,I=a*s-l*o,C=g*o-r*s,u=t*c+n*I+i*C;if(0===u)return this.set(0,0,0,0,0,0,0,0,0);const d=1/u;return e[0]=c*d,e[1]=(i*g-l*n)*d,e[2]=(a*n-i*r)*d,e[3]=I*d,e[4]=(l*t-i*s)*d,e[5]=(i*o-a*t)*d,e[6]=C*d,e[7]=(n*s-g*t)*d,e[8]=(r*t-n*o)*d,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,o,r,a){const s=Math.cos(o),g=Math.sin(o);return this.set(n*s,n*g,-n*(s*r+g*a)+r+e,-i*g,i*s,-i*(-g*r+s*a)+a+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),i=this.elements,o=i[0],r=i[3],a=i[6],s=i[1],g=i[4],l=i[7];return i[0]=t*o+n*s,i[3]=t*r+n*g,i[6]=t*a+n*l,i[1]=-n*o+t*s,i[4]=-n*r+t*g,i[7]=-n*a+t*l,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}nI.prototype.isMatrix3=!0;const iI={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},oI={h:0,s:0,l:0},rI={h:0,s:0,l:0};function aI(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function sI(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function gI(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class lI{constructor(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"===typeof e?this.setHex(e):"string"===typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){if(e=$c(e,1),t=qc(t,0,1),n=qc(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,o=2*n-i;this.r=aI(o,i,e+1/3),this.g=aI(o,i,e),this.b=aI(o,i,e-1/3)}return this}setStyle(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const i=n[1],o=n[2];switch(i){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){const n=parseFloat(e[1])/360,i=parseInt(e[2],10)/100,o=parseInt(e[3],10)/100;return t(e[4]),this.setHSL(n,i,o)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=n[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=iI[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=sI(e.r),this.g=sI(e.g),this.b=sI(e.b),this}copyLinearToSRGB(e){return this.r=gI(e.r),this.g=gI(e.g),this.b=gI(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){const t=this.r,n=this.g,i=this.b,o=Math.max(t,n,i),r=Math.min(t,n,i);let a,s;const g=(r+o)/2;if(r===o)a=0,s=0;else{const e=o-r;switch(s=g<=.5?e/(o+r):e/(2-o-r),o){case t:a=(n-i)/e+(n<i?6:0);break;case n:a=(i-t)/e+2;break;case i:a=(t-n)/e+4}a/=6}return e.h=a,e.s=s,e.l=g,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,n){return this.getHSL(oI),oI.h+=e,oI.s+=t,oI.l+=n,this.setHSL(oI.h,oI.s,oI.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(oI),e.getHSL(rI);const n=eI(oI.h,rI.h,t),i=eI(oI.s,rI.s,t),o=eI(oI.l,rI.l,t);return this.setHSL(n,i,o),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}let cI;lI.NAMES=iI,lI.prototype.isColor=!0,lI.prototype.r=1,lI.prototype.g=1,lI.prototype.b=1;class II{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===cI&&(cI=Dc("canvas")),cI.width=e.width,cI.height=e.height;const n=cI.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=cI}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){const t=Dc("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),o=i.data;for(let e=0;e<o.length;e++)o[e]=255*sI(o[e]/255);return n.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*sI(t[e]/255)):t[e]=sI(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let CI=0;class uI extends Qc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:uI.DEFAULT_IMAGE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:uI.DEFAULT_MAPPING,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_c,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:_c,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1006,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1008,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1023,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1009,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:3e3;super(),Object.defineProperty(this,"id",{value:CI++}),this.uuid=Oc(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=i,this.magFilter=o,this.minFilter=r,this.anisotropy=g,this.format=a,this.internalFormat=null,this.type=s,this.offset=new tI(0,0),this.repeat=new tI(1,1),this.center=new tI(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new nI,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=l,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this}toJSON(e){const t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const i=this.image;if(void 0===i.uuid&&(i.uuid=Oc()),!t&&void 0===e.images[i.uuid]){let t;if(Array.isArray(i)){t=[];for(let e=0,n=i.length;e<n;e++)i[e].isDataTexture?t.push(dI(i[e].image)):t.push(dI(i[e]))}else t=dI(i);e.images[i.uuid]={uuid:i.uuid,url:t}}n.image=i.uuid}return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case _c:e.x=e.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case _c:e.y=e.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&this.version++}}function dI(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?II.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}uI.DEFAULT_IMAGE=void 0,uI.DEFAULT_MAPPING=300,uI.prototype.isTexture=!0;class hI extends Uc{constructor(e){super(e)}load(e,t,n,i){const o=new uI,r=new Pc(this.manager);return r.setCrossOrigin(this.crossOrigin),r.setPath(this.path),r.load(e,(function(e){o.image=e,o.needsUpdate=!0,void 0!==t&&t(o)}),n,i),o}}function AI(e){const[t,n]=(0,Lc.z9)((()=>({mass:1}))),i=(0,Sc.pn)(hI,Tc);function o(){return 50*Math.random()*Math.random()<.5?-1:1}return(0,ce.jsxs)("mesh",{onClick:()=>{n.velocity.set(o(),o(),Math.abs(o()))},ref:t,position:[0,2,0],children:[(0,ce.jsx)("boxBufferGeometry",{attach:"geometry"}),(0,ce.jsx)("meshStandardMaterial",{map:i,attach:"material"})]})}function pI(e){const[t,n]=(0,Lc.z9)((()=>({mass:1}))),i=(0,Sc.pn)(hI,Tc);function o(){return 50*Math.random()*Math.random()<.5?-1:1}return(0,ce.jsxs)("mesh",{onClick:()=>{n.velocity.set(o(),o(),Math.abs(o()))},ref:t,position:[0,2,0],children:[(0,ce.jsx)("sphereBufferGeometry",{attach:"geometry"}),(0,ce.jsx)("meshStandardMaterial",{map:i,attach:"material"})]})}function mI(e){const[t]=(0,Lc.ON)((()=>({rotation:[-Math.PI/2,0,0]})));return(0,ce.jsxs)("mesh",{position:[0,0,0],rotation:[-Math.PI/2,0,0],children:[(0,ce.jsx)("planeBufferGeometry",{attach:"geometry",args:[100,100]}),(0,ce.jsx)("meshLambertMaterial",{attach:"material",color:"lightblue"})]})}const bI=function(){return(0,ce.jsxs)(Sc.Hl,{children:[(0,ce.jsx)(Mc,{}),(0,ce.jsx)(zc,{}),(0,ce.jsx)("ambientLight",{intensity:.5}),(0,ce.jsx)("spotLight",{position:10,angle:.3}),(0,ce.jsxs)(Lc.AQ,{children:[(0,ce.jsx)(AI,{}),(0,ce.jsx)(mI,{}),(0,ce.jsx)(pI,{})]})]})},fI=()=>(0,ce.jsx)("div",{style:{textAlign:"center"},children:(0,ce.jsx)("iframe",{src:"/adventurePlatformer/index.html",width:"2000",height:"1280",style:{border:"none"},title:"Game"})}),yI=()=>(0,ce.jsx)("div",{style:{textAlign:"center"},children:(0,ce.jsx)("iframe",{src:"/swarmed/index.html",width:"1920",height:"1080",style:{border:"none"},title:"Game"})});const GI=function(){return(0,ce.jsx)(se,{children:(0,ce.jsxs)(oe,{children:[(0,ce.jsx)(ne,{path:"/",exact:!0,element:(0,ce.jsx)(Zc,{})}),(0,ce.jsx)(ne,{path:"/brucepewpew",exact:!0,element:(0,ce.jsx)(Ie,{})}),(0,ce.jsx)(ne,{path:"/rengoku",exact:!0,element:(0,ce.jsx)(Wc,{})}),(0,ce.jsx)(ne,{path:"/bruce",exact:!0,element:(0,ce.jsx)(bI,{})}),(0,ce.jsx)(ne,{path:"/adventure-platformer",exact:!0,element:(0,ce.jsx)(fI,{})}),(0,ce.jsx)(ne,{path:"/swarmed",exact:!0,element:(0,ce.jsx)(yI,{})})]})})};o.render((0,ce.jsx)(t.StrictMode,{children:(0,ce.jsx)(GI,{})}),document.getElementById("root"))})()})();
//# sourceMappingURL=main.3e0cb181.js.map